var hY=Object.defineProperty;var K4=e=>{throw TypeError(e)};var fY=(e,t,n)=>t in e?hY(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var k=(e,t,n)=>fY(e,typeof t!="symbol"?t+"":t,n),Sx=(e,t,n)=>t.has(e)||K4("Cannot "+n);var Q=(e,t,n)=>(Sx(e,t,"read from private field"),n?n.call(e):t.get(e)),Mt=(e,t,n)=>t.has(e)?K4("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),Je=(e,t,n,s)=>(Sx(e,t,"write to private field"),s?s.call(e,n):t.set(e,n),n),We=(e,t,n)=>(Sx(e,t,"access private method"),n);var rm=(e,t,n,s)=>({set _(i){Je(e,t,i,n)},get _(){return Q(e,t,s)}});import{g as Qu,w as pY,a as E3,b as gY,r as u,i as Vf,c as jx,d as rf,I as mY,u as wl,t as yY,e as bY,S as xY,f as vY,h as CY,j as wY,k as Z4,l as M3,m as P3,n as SY,o as jY,p as kY,q as _Y,v as IY,s as TY,x as zf,y as AY,z as EY,A as ii,B as MY,C as oi,D as $n,E as At,F as ae,$ as PY,G as I,H as L3,J as D3,K as R3,L as LY,M as Oe,N as Wn,O as Yn,P as Ww,Q as A,R as ge,T as qe,U as G,V as O3,W as Uw,X as qw,Y as py,Z as N3,_ as Xn,a0 as fe,a1 as F3,a2 as DY,a3 as Qe,a4 as we,a5 as Pn,a6 as RY,a7 as Ju,a8 as jp,a9 as OY,aa as sn,ab as B3,ac as $3,ad as V3,ae as z3,af as Yo,ag as Gf,ah as Hs,ai as gy,aj as G3,ak as H3,al as Kw,am as W3,an as U3,ao as Zw,ap as q3,aq as K3,ar as Yw,as as Z3,at as Y3,au as dn,av as Xw,aw as NY,ax as Qw,ay as ed,az as Tl,aA as kp,aB as Pe,aC as X3,aD as Q3,aE as J3,aF as eM,aG as M0,aH as tM,aI as P0,aJ as nM,aK as td,aL as sM,aM as tt,aN as nd,aO as rM,aP as iM,aQ as _p,aR as Pr,aS as Jw,aT as Ls,aU as ot,aV as L0,aW as oM,aX as aM,aY as lM,aZ as cM,a_ as uM,a$ as eS,b0 as fs,b1 as Un,b2 as Ci,b3 as FY,b4 as BY,b5 as Qt,b6 as $Y,b7 as dM,b8 as Y4,b9 as kx,ba as _x,bb as Ix,bc as X4,bd as r,be as T,bf as Lr,bg as q,bh as gt,bi as hM,bj as be,bk as Se,bl as Ip,bm as Ya,bn as fM,bo as Ee,bp as de,bq as pM,br as VY,bs as or,bt as Rt,bu as Kn,bv as oe,bw as tS,bx as lt,by as ta,bz as kt,bA as co,bB as zY,bC as Hi,bD as Te,bE as sr,bF as Po,bG as nS,bH as GY,bI as HY,bJ as K,bK as J,bL as Js,bM as Tp,bN as wt,bO as Ft,bP as WY,bQ as gM,bR as mM,bS as Sn,bT as UY,bU as yM,bV as qY,bW as KY,bX as ZY,bY as YY,bZ as XY,b_ as sc,b$ as rc,c0 as _n,c1 as sd,c2 as Rn,c3 as QY,c4 as JY,c5 as eX,c6 as tX,c7 as nX,c8 as sX,c9 as rX,ca as iX,cb as oX,cc as aX,cd as sS,ce as lX,cf as bM,cg as cX,ch as xM,ci as uX,cj as rS,ck as iS,cl as dX,cm as hX,cn as fX,co as pX,cp as gX,cq as D0,cr as my,cs as yy,ct as oS,cu as ic,cv as oc,cw as vM,cx as ac,cy as lc,cz as Ta,cA as by,cB as Bo,cC as Kc,cD as er,cE as s0,cF as mX,cG as xy,cH as yX,cI as aS,cJ as bX,cK as xX,cL as Hf,cM as CM,cN as I2,cO as wM,cP as vX,cQ as CX,cR as wX,cS as SM,cT as Ap,cU as Q4,cV as SX,cW as jX,cX as kX,cY as _X,cZ as va,c_ as rd,c$ as J4,d0 as jM,d1 as eI,d2 as IX,d3 as TX,d4 as vy,d5 as AX,d6 as EX,d7 as MX,d8 as PX,d9 as LX,da as DX,db as Ep,dc as Fn,dd as Mp,de as R0,df as tI,dg as pt,dh as RX,di as Xa,dj as OX,dk as kM,dl as Pp,dm as Lp,dn as hn,dp as NX,dq as FX,dr as nI,ds as lS,dt as ai,du as Ne,dv as _M,dw as cc,dx as BX,dy as Ei,dz as Cy,dA as Va,dB as id,dC as uc,dD as Dp,dE as wy,dF as $X,dG as T2,dH as A2,dI as Qa,dJ as VX,dK as sI,dL as zX,dM as GX,dN as O0,dO as E2,dP as Rp,dQ as HX,dR as IM,dS as Wf,dT as ds,dU as Mi,dV as Wl,dW as cS,dX as uS,dY as N0,dZ as M2,d_ as Op,d$ as dS,e0 as Sy,e1 as WX,e2 as UX,e3 as Lc,e4 as of,e5 as TM,e6 as Lt,e7 as AM,e8 as Dr,e9 as ar,ea as Rr,eb as lr,ec as Pi,ed as Ws,ee as xo,ef as dc,eg as Np,eh as hS,ei as Nt,ej as qX,ek as jr,el as KX,em as Ss,en as EM,eo as rI,ep as ZX,eq as YX,er as et,es as MM,et as XX,eu as PM,ev as QX,ew as JX,ex as fS,ey as LM,ez as Fp,eA as Ge,eB as DM,eC as rs,eD as gs,eE as hc,eF as RM,eG as is,eH as OM,eI as ms,eJ as Wt,eK as it,eL as eQ,eM as tQ,eN as nQ,eO as Ze,eP as Ie,eQ as sQ,eR as NM,eS as jy,eT as rQ,eU as iQ,eV as oQ,eW as aQ,eX as lQ,eY as cQ,eZ as uQ,e_ as dQ,e$ as FM,f0 as pS,f1 as gS,f2 as mS,f3 as yS,f4 as bS,f5 as BM,f6 as pe,f7 as Es,f8 as hQ,f9 as fQ,fa as pQ,fb as en,fc as tn,fd as Tt,fe as vo,ff as Dc,fg as gQ,fh as Tr,fi as mQ,fj as Bp,fk as xS,fl as vS,fm as $M,fn as fc,fo as ky,fp as VM,fq as za,fr as CS,fs as pc,ft as _y,fu as Ja,fv as Iy,fw as af,fx as wS,fy as yQ,fz as Zn,fA as bQ,fB as zM,fC as GM,fD as xQ,fE as HM,fF as iI,fG as WM,fH as UM,fI as vQ,fJ as oI,fK as aI,fL as _i,fM as CQ,fN as wQ,fO as qM,fP as SS,fQ as SQ,fR as jQ,fS as Ar,fT as xt,fU as lI,fV as kQ,fW as _Q,fX as Bl,fY as ss,fZ as IQ,f_ as TQ,f$ as KM,g0 as AQ,g1 as EQ,g2 as MQ,g3 as PQ,g4 as LQ,g5 as ZM,g6 as DQ,g7 as RQ,g8 as YM,g9 as OQ,ga as Ki,gb as NQ,gc as XM,gd as QM,ge as $p,gf as FQ,gg as Tn,gh as Or,gi as BQ,gj as Ty,gk as r0,gl as Ay,gm as gc,gn as $Q,go as JM,gp as eP,gq as tP,gr as Qn,gs as Sr,gt as VQ,gu as zQ,gv as GQ,gw as HQ,gx as jS,gy as nP,gz as WQ,gA as P2,gB as UQ,gC as tr,gD as Aa,gE as L2,gF as i0,gG as sP,gH as rP,gI as iP,gJ as qQ,gK as oP,gL as aP,gM as lP,gN as cP,gO as KQ,gP as uP,gQ as Ey,gR as D2,gS as Vp,gT as ZQ,gU as dP,gV as My,gW as iu,gX as hP,gY as YQ,gZ as cI,g_ as kS,g$ as fP,h0 as XQ,h1 as pP,h2 as gP,h3 as mP,h4 as _S,h5 as yP,h6 as QQ,h7 as bP,h8 as xP,h9 as R2,ha as JQ,hb as eJ,hc as tJ,hd as ca,he as qr,hf as uo,hg as eo,hh as nJ,hi as vP,hj as uI,hk as Tx,hl as dI,hm as hI,hn as fI,ho as pI,hp as O2,hq as sJ,hr as N2,hs as CP,ht as wP,hu as im,hv as rJ,hw as $o,hx as SP,hy as jP,hz as kP,hA as _P,hB as IP,hC as iJ,hD as oJ,hE as el,hF as F2,hG as aJ,hH as gI,hI as mI,hJ as F0,hK as lJ,hL as cJ,hM as TP,hN as uJ,hO as dJ,hP as hJ,hQ as fJ,hR as pJ,hS as AP,hT as EP,hU as B2,hV as zp,hW as gJ,hX as mJ,hY as yJ,hZ as bJ,h_ as xJ,h$ as IS,i0 as vJ,i1 as CJ,i2 as wJ,i3 as SJ,i4 as $2,i5 as jJ,i6 as kJ,i7 as _J,i8 as yI,i9 as IJ,ia as Py,ib as Gp,ic as TS,id as MP,ie as TJ,ig as AJ,ih as EJ,ii as lf,ij as MJ,ik as PJ,il as LJ,im as DJ,io as RJ,ip as OJ,iq as NJ,ir as FJ,is as BJ,it as $J,iu as VJ,iv as zJ,iw as GJ,ix as HJ,iy as WJ,iz as Li,iA as tl,iB as Hp,iC as Ly,iD as Dy,iE as UJ,iF as qJ,iG as PP,iH as LP,iI as DP,iJ as RP,iK as OP,iL as KJ,iM as xu,iN as V2,iO as NP,iP as FP,iQ as AS,iR as Ax,iS as ZJ,iT as YJ,iU as XJ,iV as cf,iW as BP,iX as $P,iY as mc,iZ as QJ,i_ as JJ,i$ as Rc,j0 as xl,j1 as Wp,j2 as eee,j3 as od,j4 as tee,j5 as nee,j6 as see,j7 as ree,j8 as iee,j9 as VP,ja as oee,jb as nl,jc as aee,jd as ES,je as lee,jf as zP,jg as GP,jh as cee,ji as HP,jj as WP,jk as UP,jl as cr,jm as uee,jn as dee,jo as Ry,jp as Oy,jq as MS,jr as hee,js as fee,jt as pee,ju as gee,jv as bI,jw as mee,jx as yee,jy as bee,jz as xee,jA as vee,jB as Ga,jC as Cee,jD as wee,jE as See,jF as jee,jG as kee,jH as _ee,jI as Iee,jJ as Tee,jK as Aee,jL as Eee,jM as Mee,jN as Pee,jO as Lee,jP as qP,jQ as KP,jR as Dee,jS as Ree,jT as Oee,jU as Nee,jV as Fee,jW as Bee,jX as Ny,jY as $ee,jZ as Up,j_ as Vee,j$ as zee,k0 as Gee,k1 as Hee,k2 as Wee,k3 as xI,k4 as Uee,k5 as qee,k6 as ZP,k7 as Kee,k8 as Zee,k9 as Yee,ka as PS,kb as Xee,kc as Qee,kd as Jee,ke as B0,kf as ad,kg as YP,kh as qp,ki as XP,kj as ete,kk as LS,kl as Fy,km as tte,kn as nte,ko as ste,kp as rte,kq as ite,kr as ote,ks as ate,kt as lte,ku as vI,kv as cte,kw as ute,kx as QP,ky as dte,kz as hte,kA as fte,kB as pte,kC as gte,kD as DS,kE as JP,kF as RS,kG as mte,kH as yte,kI as bte,kJ as xte,kK as OS,kL as vte,kM as eL,kN as NS,kO as Cte,kP as FS,kQ as Xr,kR as z2,kS as CI,kT as G2,kU as BS,kV as wte,kW as Ste,kX as jte,kY as tL,kZ as $S,k_ as kte,k$ as ld,l0 as By,l1 as Fu,l2 as VS,l3 as cd,l4 as nL,l5 as ns,l6 as zS,l7 as _te,l8 as H2,l9 as Ite,la as Tte,lb as sL,lc as Ate,ld as Cf,le as GS,lf as Ete,lg as rL,lh as Mte,li as Co,lj as iL,lk as oL,ll as Pte,lm as Lte,ln as aL,lo as lL,lp as Ve,lq as HS,lr as Dte,ls as rt,lt as si,lu as wI,lv as Rte,lw as Ex,lx as SI,ly as jI,lz as kI,lA as _I,lB as Ote,lC as II,lD as Nte,lE as TI,lF as Fte,lG as Mx,lH as AI,lI as EI,lJ as MI,lK as Bte,lL as Px,lM as PI,lN as $te,lO as LI,lP as DI,lQ as RI,lR as Vte,lS as zte,lT as Gte,lU as yc,lV as Hte,lW as Wte,lX as cL,lY as Ute,lZ as uL,l_ as Kp,l$ as qte,m0 as Kte,m1 as Zte,m2 as Yte,m3 as Xte,m4 as Qte,m5 as Jte,m6 as ene,m7 as tne,m8 as nne,m9 as Zp,ma as sne,mb as ho,mc as rne,md as ine,me as one,mf as WS,mg as ane,mh as lne,mi as cne,mj as une,mk as dne,ml as hne,mm as fne,mn as pne,mo as gne,mp as mne,mq as yne,mr as bne,ms as xne,mt as vne,mu as Cne,mv as wne,mw as Sne,mx as jne,my as kne,mz as _ne,mA as Ine,mB as Tne,mC as Ane,mD as Ene,mE as Mne,mF as Pne,mG as Lne,mH as Dne,mI as Rne,mJ as One,mK as Nne,mL as Fne,mM as Bne,mN as $ne,mO as Vne,mP as zne,mQ as Gne,mR as Hne,mS as Wne,mT as Une,mU as qne,mV as Kne,mW as Zne,mX as Yne,mY as Xne,mZ as Qne,m_ as Jne,m$ as ese,n0 as tse,n1 as nse,n2 as sse,n3 as rse,n4 as ise,n5 as ose,n6 as ase,n7 as lse,n8 as cse,n9 as use,na as dse,nb as hse,nc as fse,nd as dL,ne as Al,nf as US,ng as hL,nh as fL,ni as pse,nj as pL,nk as gL,nl as mL,nm as yL,nn as bL,no as gse,np as mse,nq as yse,nr as xL,ns as bse,nt as xse,nu as vse,nv as Cse,nw as wse,nx as Sse,ny as $y,nz as vL,nA as jse,nB as kse,nC as _se,nD as Ise,nE as Tse,nF as Ase,nG as Ese,nH as Mse,nI as Pse,nJ as Lse,nK as Dse,nL as ks,nM as Rse,nN as Ose,nO as Nse,nP as qS,nQ as Fse,nR as Bse,nS as W2,nT as KS,nU as $se,nV as Vse,nW as ZS,nX as zse,nY as Gse,nZ as Vy,n_ as o0,n$ as YS,o0 as Yp,o1 as CL,o2 as Hse,o3 as Wse,o4 as wL,o5 as Use,o6 as qse,o7 as Kse,o8 as Zse,o9 as Yse,oa as SL,ob as jL,oc as Xse,od as Qse,oe as Jse,of as ere,og as tre,oh as nre,oi as sre,oj as rre,ok as ire,ol as ore,om,on as are,oo as lre,op as cre,oq as ure,or as dre,os as hre,ot as XS,ou as kL,ov as _L,ow as fre,ox as pre,oy as gre,oz as IL,oA as mre,oB as TL,oC as AL,oD as yre,oE as bre,oF as xre,oG as ud,oH as vre,oI as Cre,oJ as wre,oK as Sre,oL as jre,oM as kre,oN as _re,oO as Ire,oP as Tre,oQ as Are,oR as Ere,oS as Xp,oT as EL,oU as Mre,oV as Pre,oW as Lre,oX as Dre,oY as Rre,oZ as Ore,o_ as Nre,o$ as Fre,p0 as Bre,p1 as $re,p2 as Vre,p3 as zre,p4 as Gre,p5 as Hre,p6 as Wre,p7 as QS,p8 as Ure,p9 as ML,pa as zy,pb as qre,pc as PL,pd as LL,pe as Kre,pf as DL,pg as Zre,ph as RL,pi as JS,pj as Yre,pk as Xre,pl as Qre,pm as ej,pn as tj,po as Jre,pp as eie,pq as tie,pr as nie,ps as sie,pt as rie,pu as iie,pv as nj,pw as oie,px as aie,py as lie,pz as Qp,pA as cie,pB as uie,pC as die,pD as hie,pE as fie,pF as pie,pG as gie,pH as OI,pI as OL,pJ as mie,pK as yie,pL as bie,pM as xie,pN as vie,pO as Cie,pP as wie,pQ as NL,pR as Sie,pS as jie,pT as kie,pU as _ie,pV as NI,pW as Iie,pX as Tie,pY as Aie,pZ as Eie,p_ as Mie,p$ as Pie,q0 as Lie,q1 as Die,q2 as Rie,q3 as Oie,q4 as Nie,q5 as Fie,q6 as Bie,q7 as Uf,q8 as sj,q9 as FI,qa as $ie,qb as Vie,qc as zie,qd as Gie,qe as U2,qf as FL,qg as BL,qh as BI,qi as $I,qj as Jp,qk as Hie,ql as Wie,qm as Oc,qn as Gy,qo as q2,qp as Hy,qq as Uie,qr as qie,qs as eg,qt as Kie,qu as Zie,qv as Yie,qw as Xie,qx as Qie,qy as Jie,qz as eoe,qA as $L,qB as toe,qC as noe,qD as soe,qE as roe,qF as ioe,qG as ooe,qH as aoe,qI as loe,qJ as VL,qK as K2,qL as coe,qM as uoe,qN as Zc,qO as am,qP as Ca,qQ as vu,qR as xr,qS as rj,qT as Cu,qU as Zi,qV as $l,qW as zL,qX as GL,qY as doe,qZ as hoe,q_ as foe,q$ as HL,r0 as WL,r1 as UL,r2 as Wy,r3 as qL,r4 as KL,r5 as poe,r6 as goe,r7 as moe,r8 as yoe,r9 as boe,ra as xoe,rb as voe,rc as ij,rd as ou,re as ZL,rf as YL,rg as XL,rh as Coe,ri as oj,rj as QL,rk as JL,rl as eD,rm as tg,rn as woe,ro as tD,rp as dd,rq as Ea,rr as Ma,rs as nD,rt as Soe,ru as joe,rv as koe,rw as _oe,rx as Ioe,ry as Toe,rz as VI,rA as zI,rB as Aoe,rC as Eoe,rD as GI,rE as HI,rF as Moe,rG as Poe,rH as Loe,rI as Doe,rJ as Lx,rK as Roe,rL as Ooe,rM as Noe,rN as Foe,rO as Boe,rP as $oe,rQ as sD,rR as Voe,rS as zoe,rT as Goe,rU as Uy,rV as Hoe,rW as Woe,rX as Uoe,rY as qoe,rZ as Koe,r_ as Zoe,r$ as Yoe,s0 as Xoe,s1 as Qoe,s2 as Joe,s3 as eae,s4 as tae,s5 as nae,s6 as sae,s7 as rae,s8 as iae,s9 as oae,sa as aae,sb as lae,sc as cae,sd as uae,se as dae,sf as hae,sg as fae,sh as pae,si as rD,sj as gae,sk as mae,sl as yae,sm as bae,sn as xae,so as iD,sp as vae,sq as Cae,sr as wae,ss as Sae,st as jae,su as oD,sv as kae,sw as _ae,sx as Iae,sy as Tae,sz as WI,sA as Aae,sB as Eae,sC as UI,sD as Mae}from"./index-em548e7X.js";var Dx,qI;function Pae(){return qI||(qI=1,Dx={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0}),Dx}var Lae=Pae();const Dae=Qu(Lae);var Rae=/\s([^'"/\s><]+?)[\s/>]|([^\s=]+)=\s?(".*?"|'.*?')/g;function KI(e){var t={type:"tag",name:"",voidElement:!1,attrs:{},children:[]},n=e.match(/<\/?([^\s]+?)[/\s>]/);if(n&&(t.name=n[1],(Dae[n[1]]||e.charAt(e.length-2)==="/")&&(t.voidElement=!0),t.name.startsWith("!--"))){var s=e.indexOf("-->");return{type:"comment",comment:s!==-1?e.slice(4,s):""}}for(var i=new RegExp(Rae),o=null;(o=i.exec(e))!==null;)if(o[0].trim())if(o[1]){var a=o[1].trim(),l=[a,""];a.indexOf("=")>-1&&(l=a.split("=")),t.attrs[l[0]]=l[1],i.lastIndex--}else o[2]&&(t.attrs[o[2]]=o[3].trim().substring(1,o[3].length-1));return t}var Oae=/<[a-zA-Z0-9\-\!\/](?:"[^"]*"|'[^']*'|[^'">])*>/g,Nae=/^\s*$/,Fae=Object.create(null);function aD(e,t){switch(t.type){case"text":return e+t.content;case"tag":return e+="<"+t.name+(t.attrs?function(n){var s=[];for(var i in n)s.push(i+'="'+n[i]+'"');return s.length?" "+s.join(" "):""}(t.attrs):"")+(t.voidElement?"/>":">"),t.voidElement?e:e+t.children.reduce(aD,"")+"</"+t.name+">";case"comment":return e+"<!--"+t.comment+"-->"}}var Bae={parse:function(e,t){t||(t={}),t.components||(t.components=Fae);var n,s=[],i=[],o=-1,a=!1;if(e.indexOf("<")!==0){var l=e.indexOf("<");s.push({type:"text",content:l===-1?e:e.substring(0,l)})}return e.replace(Oae,function(c,d){if(a){if(c!=="</"+n.name+">")return;a=!1}var h,f=c.charAt(1)!=="/",p=c.startsWith("<!--"),g=d+c.length,m=e.charAt(g);if(p){var y=KI(c);return o<0?(s.push(y),s):((h=i[o]).children.push(y),s)}if(f&&(o++,(n=KI(c)).type==="tag"&&t.components[n.name]&&(n.type="component",a=!0),n.voidElement||a||!m||m==="<"||n.children.push({type:"text",content:e.slice(g,e.indexOf("<",g))}),o===0&&s.push(n),(h=i[o-1])&&h.children.push(n),i[o]=n),(!f||n.voidElement)&&(o>-1&&(n.voidElement||n.name===c.slice(2,-1))&&(o--,n=o===-1?s:i[o]),!a&&m!=="<"&&m)){h=o===-1?s:i[o].children;var b=e.indexOf("<",g),C=e.slice(g,b===-1?void 0:b);Nae.test(C)&&(C=" "),(b>-1&&o+h.length>=0||C!==" ")&&h.push({type:"text",content:C})}}),s},stringify:function(e){return e.reduce(function(t,n){return t+aD("",n)},"")}};const Rx=(e,t)=>{var s;if(!e)return!1;const n=((s=e.props)==null?void 0:s.children)??e.children;return t?n.length>0:!!n},Ox=e=>{var n,s;if(!e)return[];const t=((n=e.props)==null?void 0:n.children)??e.children;return(s=e.props)!=null&&s.i18nIsDynamicList?au(t):t},$ae=e=>Array.isArray(e)&&e.every(u.isValidElement),au=e=>Array.isArray(e)?e:[e],Vae=(e,t)=>{const n={...t};return n.props=Object.assign(e.props,t.props),n},lD=(e,t)=>{if(!e)return"";let n="";const s=au(e),i=t!=null&&t.transSupportBasicHtmlNodes?t.transKeepBasicHtmlNodesFor??[]:[];return s.forEach((o,a)=>{if(Vf(o))n+=`${o}`;else if(u.isValidElement(o)){const{props:l,type:c}=o,d=Object.keys(l).length,h=i.indexOf(c)>-1,f=l.children;if(!f&&h&&!d)n+=`<${c}/>`;else if(!f&&(!h||d)||l.i18nIsDynamicList)n+=`<${a}></${a}>`;else if(h&&d===1&&Vf(f))n+=`<${c}>${f}</${c}>`;else{const p=lD(f,t);n+=`<${a}>${p}</${a}>`}}else if(o===null)jx("Trans: the passed in value is invalid - seems you passed in a null child.");else if(rf(o)){const{format:l,...c}=o,d=Object.keys(c);if(d.length===1){const h=l?`${d[0]}, ${l}`:d[0];n+=`{{${h}}}`}else jx("react-i18next: the passed in object contained more than one variable - the object should look like {{ value, format }} where format is optional.",o)}else jx("Trans: the passed in value is invalid - seems you passed in a variable like {number} - please pass in variables for interpolation as full objects like {{number}}.",o)}),n},zae=(e,t,n,s,i,o)=>{if(t==="")return[];const a=s.transKeepBasicHtmlNodesFor||[],l=t&&new RegExp(a.map(b=>`<${b}`).join("|")).test(t);if(!e&&!l&&!o)return[t];const c={},d=b=>{au(b).forEach(x=>{Vf(x)||(Rx(x)?d(Ox(x)):rf(x)&&!u.isValidElement(x)&&Object.assign(c,x))})};d(e);const h=Bae.parse(`<0>${t}</0>`),f={...c,...i},p=(b,C,x)=>{var S;const v=Ox(b),w=m(v,C.children,x);return $ae(v)&&w.length===0||(S=b.props)!=null&&S.i18nIsDynamicList?v:w},g=(b,C,x,v,w)=>{b.dummy?(b.children=C,x.push(u.cloneElement(b,{key:v},w?void 0:C))):x.push(...u.Children.map([b],S=>{const j={...S.props};return delete j.i18nIsDynamicList,u.createElement(S.type,{...j,key:v,ref:S.ref},w?null:C)}))},m=(b,C,x)=>{const v=au(b);return au(C).reduce((S,j,P)=>{var D,M;const E=((M=(D=j.children)==null?void 0:D[0])==null?void 0:M.content)&&n.services.interpolator.interpolate(j.children[0].content,f,n.language);if(j.type==="tag"){let R=v[parseInt(j.name,10)];x.length===1&&!R&&(R=x[0][j.name]),R||(R={});const F=Object.keys(j.attrs).length!==0?Vae({props:j.attrs},R):R,_=u.isValidElement(F),L=_&&Rx(j,!0)&&!j.voidElement,O=l&&rf(F)&&F.dummy&&!_,B=rf(e)&&Object.hasOwnProperty.call(e,j.name);if(Vf(F)){const z=n.services.interpolator.interpolate(F,f,n.language);S.push(z)}else if(Rx(F)||L){const z=p(F,j,x);g(F,z,S,P)}else if(O){const z=m(v,j.children,x);g(F,z,S,P)}else if(Number.isNaN(parseFloat(j.name)))if(B){const z=p(F,j,x);g(F,z,S,P,j.voidElement)}else if(s.transSupportBasicHtmlNodes&&a.indexOf(j.name)>-1)if(j.voidElement)S.push(u.createElement(j.name,{key:`${j.name}-${P}`}));else{const z=m(v,j.children,x);S.push(u.createElement(j.name,{key:`${j.name}-${P}`},z))}else if(j.voidElement)S.push(`<${j.name} />`);else{const z=m(v,j.children,x);S.push(`<${j.name}>${z}</${j.name}>`)}else if(rf(F)&&!_){const z=j.children[0]?E:null;z&&S.push(z)}else g(F,E,S,P,j.children.length!==1||!E)}else if(j.type==="text"){const R=s.transWrapTextNodes,F=o?s.unescape(n.services.interpolator.interpolate(j.content,f,n.language)):n.services.interpolator.interpolate(j.content,f,n.language);R?S.push(u.createElement(R,{key:`${j.name}-${P}`},F)):S.push(F)}return S},[])},y=m([{dummy:!0,children:e||[]}],h,au(e||[]));return Ox(y[0])};function Gae({children:e,count:t,parent:n,i18nKey:s,context:i,tOptions:o={},values:a,defaults:l,components:c,ns:d,i18n:h,t:f,shouldUnescape:p,...g}){var R,F,_,L,O,B;const m=h||E3();if(!m)return pY("You will need to pass in an i18next instance by using i18nextReactModule"),e;const y=f||m.t.bind(m)||(z=>z),b={...gY(),...(R=m.options)==null?void 0:R.react};let C=d||y.ns||((F=m.options)==null?void 0:F.defaultNS);C=Vf(C)?[C]:C||["translation"];const x=lD(e,b),v=l||x||b.transEmptyNodeValue||s,{hashTransKey:w}=b,S=s||(w?w(x||v):x||v);(L=(_=m.options)==null?void 0:_.interpolation)!=null&&L.defaultVariables&&(a=a&&Object.keys(a).length>0?{...a,...m.options.interpolation.defaultVariables}:{...m.options.interpolation.defaultVariables});const j=a||t!==void 0&&!((B=(O=m.options)==null?void 0:O.interpolation)!=null&&B.alwaysFormat)||!e?o.interpolation:{interpolation:{...o.interpolation,prefix:"#$?",suffix:"?$#"}},P={...o,context:i||o.context,count:t,...a,...j,defaultValue:v,ns:C},E=S?y(S,P):v;c&&Object.keys(c).forEach(z=>{const ee=c[z];if(typeof ee.type=="function"||!ee.props||!ee.props.children||E.indexOf(`${z}/>`)<0&&E.indexOf(`${z} />`)<0)return;function ne(){return u.createElement(u.Fragment,null,ee)}c[z]=u.createElement(ne)});const D=zae(c||e,E,m,b,P,p),M=n??b.defaultTransParent;return M?u.createElement(M,g,D):D}function Ut({children:e,count:t,parent:n,i18nKey:s,context:i,tOptions:o={},values:a,defaults:l,components:c,ns:d,i18n:h,t:f,shouldUnescape:p,...g}){var x;const{i18n:m,defaultNS:y}=u.useContext(mY)||{},b=h||m||E3(),C=f||(b==null?void 0:b.t.bind(b));return Gae({children:e,count:t,parent:n,i18nKey:s,context:i,tOptions:o,values:a,defaults:l,components:c,ns:d||(C==null?void 0:C.ns)||y||((x=b==null?void 0:b.options)==null?void 0:x.defaultNS),i18n:b,t:f,shouldUnescape:p,...g})}function aj(e){return Object.keys(e)}function Hae(e){return Object.entries(e)}function Wae(e){return wl(yY(e).toLowerCase())}var Uae=bY(function(e,t,n){return t=t.toLowerCase(),e+(n?Wae(t):t)}),qae=200;function Kae(e,t,n,s){var i=-1,o=vY,a=!0,l=e.length,c=[],d=t.length;if(!l)return c;t.length>=qae&&(o=CY,a=!1,t=new xY(t));e:for(;++i<l;){var h=e[i],f=h;if(h=h!==0?h:0,a&&f===f){for(var p=d;p--;)if(t[p]===f)continue e;c.push(h)}else o(t,f,s)||c.push(h)}return c}var Zae=wY(function(e,t){return Z4(e)?Kae(e,M3(t,1,Z4,!0)):[]});function Yae(e,t){var n=-1,s=P3(e)?Array(e.length):[];return SY(e,function(i,o,a){s[++n]=t(i,o,a)}),s}function fo(e,t){var n=_Y(e)?jY:Yae;return n(e,kY(t))}function Xae(e,t){return M3(fo(e,t))}var Qae=Math.max;function Jae(e,t,n,s){e=P3(e)?e:IY(e),n=n?TY(n):0;var i=e.length;return n<0&&(n=Qae(i+n,0)),zf(e)?n<=i&&e.indexOf(t,n)>-1:!!i&&AY(e,t,n)>-1}var ele="Expected a function";function cD(e){if(typeof e!="function")throw new TypeError(ele);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}var tle="Expected a function";function Z2(e,t,n){var s=!0,i=!0;if(typeof e!="function")throw new TypeError(tle);return EY(n)&&(s="leading"in n?!!n.leading:s,i="trailing"in n?!!n.trailing:i),ii(e,t,{leading:s,maxWait:t,trailing:i})}function uD(e,t){return t=typeof t=="function"?t:void 0,e&&e.length?MY(e,void 0,t):[]}const ZI=document.title,nle="assets/images/invoke-favicon.svg",sle="assets/images/invoke-alert-favicon.svg",rle=()=>{const{queueSize:e}=oi(void 0,{selectFromResult:t=>({queueSize:t.data?t.data.queue.pending+t.data.queue.in_progress:0})});u.useEffect(()=>{document.title=e>0?`(${e}) ${ZI}`:ZI;const t=document.getElementById("invoke-favicon");t instanceof HTMLLinkElement&&(t.href=e>0?sle:nle)},[e])},ile=e=>u.useMemo(()=>$n(e),[e]),ole=()=>{At("useSyncLoggingConfig");const e=ae(PY),t=I(L3),n=I(D3),s=I(R3);u.useLayoutEffect(()=>{LY((e==null?void 0:e.logIsEnabled)??s,(e==null?void 0:e.logLevel)??t,(e==null?void 0:e.logNamespaces)??n)},[s,t,n,e==null?void 0:e.logIsEnabled,e==null?void 0:e.logLevel,e==null?void 0:e.logNamespaces])},dD=$n("system"),wu={gallery:new Set,layers:new Set,canvas:new Set,workflows:new Set,viewer:new Set},ng=Oe(null),ale=aj(wu).reduce((e,t)=>(e[`$${t}`]=Wn(ng,n=>n===t),e),{}),Y2=e=>{ng.set(e),dD.trace(`Focus changed: ${e}`)},sg=(e,t,n)=>{u.useEffect(()=>{if(!t.current)return;const{focusOnMount:s=!1}={focusOnMount:!1,...n},i=t.current;return wu[e].add(i),s&&Y2(e),()=>{wu[e].delete(i),wu[e].size===0&&ng.get()===e&&Y2(null)}},[n,t,e])},Ms=e=>ae(ale[`$${e}`]),YI=e=>{var i;const t=document.activeElement;if(!(t instanceof HTMLElement))return;const n=[];for(const o of aj(wu))for(const a of wu[o])a.contains(t)&&n.push({region:o,element:a});if(n.length===0)return;n.sort((o,a)=>a.element.contains(o.element)?-1:o.element.contains(a.element)?1:0);const s=(i=n[0])==null?void 0:i.region;if(!s){dD.warn("No focused region found");return}Y2(s)},lle=()=>{At("useFocusRegionWatcher"),u.useEffect(()=>(window.addEventListener("focus",YI,{capture:!0}),()=>{window.removeEventListener("focus",YI,{capture:!0})}),[])},qy=()=>{const e=ae(Yn),{data:t}=oi(),[n,{isLoading:s}]=Ww(),{t:i}=A(),o=u.useMemo(()=>t==null?void 0:t.queue.item_id,[t==null?void 0:t.queue.item_id]),a=u.useCallback(async()=>{if(o)try{await n(o).unwrap(),ge({id:"QUEUE_CANCEL_SUCCEEDED",title:i("queue.cancelSucceeded"),status:"success"})}catch{ge({id:"QUEUE_CANCEL_FAILED",title:i("queue.cancelFailed"),status:"error"})}},[o,i,n]),l=u.useMemo(()=>!e||qe(o),[e,o]);return{cancelQueueItem:a,isLoading:s,currentQueueItemId:o,isDisabled:l}},hD=()=>{const{t:e}=A(),t=G(),{data:n}=oi(),s=ae(Yn),[i,{isLoading:o}]=O3({fixedCacheKey:"clearQueue"}),a=u.useCallback(async()=>{if(n!=null&&n.queue.total)try{await i().unwrap(),ge({id:"QUEUE_CLEAR_SUCCEEDED",title:e("queue.clearSucceeded"),status:"success"}),t(Uw(void 0)),t(qw(void 0))}catch{ge({id:"QUEUE_CLEAR_FAILED",title:e("queue.clearFailed"),status:"error"})}},[n==null?void 0:n.queue.total,i,t,e]),l=u.useMemo(()=>!s||!(n!=null&&n.queue.total),[s,n==null?void 0:n.queue.total]);return{clearQueue:a,isLoading:o,queueStatus:n,isDisabled:l}},na=Oe(!1),Xo=Oe(null),Ha=Oe(!1),cle=Wn([na,Xo,Ha],(e,t,n)=>e&&t!==null&&!n),$0=Oe(null),fD=()=>{const e=ae($0),{isValidationRunInProgress:t}=F3(e!=null&&e.batchId?{batch_id:e.batchId}:Xn,{selectFromResult:({currentData:n})=>n?n&&n.in_progress>0?{isValidationRunInProgress:!0}:{isValidationRunInProgress:!1}:{isValidationRunInProgress:!1}});return e!==null||t},pD=fe(DY,Qe,(e,t)=>{const n=[];for(const s of e){const i=t.nodes.find(o=>o.id===s.nodeId);we(Pn(i),`Node ${s.nodeId} not found`),n.push({nodeId:s.nodeId,fieldName:s.fieldName,type:i.data.type})}return n}),gD=(e,t)=>{var i;const n=[],s=[];for(const o of e){const a=(i=t[o.type])==null?void 0:i.inputs[o.fieldName];if(!a){s.push(o);continue}if(RY(a.type)){s.push(o);continue}n.push(o)}return{publishable:n,unpublishable:s}},Ky=()=>{const e=ae(sn),t=I(pD);return u.useMemo(()=>gD(t,e),[t,e])},ule={selectFromResult:({currentData:e})=>e?{isPublished:e.is_published}:{isPublished:!1}},bc=()=>{const e=I(py),{isPublished:t}=N3(e??Xn,ule);return t},dle=["metadata_to_model","metadata_to_sdxl_model","metadata_to_vae","metadata_to_lora_collection","metadata_to_loras","metadata_to_sdlx_loras","metadata_to_controlnets","metadata_to_ip_adapters","metadata_to_t2i_adapters"],mD=fe(Ju,e=>{for(const t of e)if(!Pn(t)||jp(t)||OY(t)||dle.includes(t.data.type))return!0;return!1}),wo=()=>{const e=ae(na),t=bc(),n=fD();return e||t||n},Nx=$n("workflows"),hle=(e,t)=>{const{value:n}=e;if(n==="auto"||!n){const s=Hs(t);return s==="none"?void 0:{board_id:s}}if(n!=="none")return n},fle=(e,t)=>{const{nodes:n,edges:s}=Qe(e),i=n.filter(Pn).filter(B3),o=i.reduce((h,f)=>{const{id:p,data:g}=f,{type:m,inputs:y,isIntermediate:b}=g,C=t[m];if(!C)return Nx.warn({id:p,type:m},"Node template not found!"),h;const x=$3(y,(w,S,j)=>{const P=C.inputs[j];return P?(V3(P)&&z3(S)?w[j]=hle(S,e):w[j]=S.value,w):(Nx.warn({id:p,name:j},"Field template not found!"),w)},{});x.use_cache=f.data.useCache;const v={type:m,id:p,...x,is_intermediate:b};return Object.assign(h,{[p]:v}),h},{}),a=i.map(({id:h})=>h),c=s.filter(h=>h.type!=="collapsed").filter(h=>a.includes(h.source)&&a.includes(h.target)).reduce((h,f)=>{const{source:p,target:g,sourceHandle:m,targetHandle:y}=f;return!m||!y?(Nx.warn({source:p,target:g,sourceHandle:m,targetHandle:y},"Missing source or taget handle for edge"),h):(h.push({source:{node_id:p,field:m},destination:{node_id:g,field:y}}),h)},[]);return c.forEach(h=>{const f=o[h.destination.node_id],p=h.destination.field;o[h.destination.node_id]=Yo(f,p)}),{id:Gf(),nodes:o,edges:c}},ba=async e=>{const{node:t,dispatch:n,nodesState:s}=e,{nodes:i,edges:o}=s,a=i.filter(Pn);if(t.data.type==="image_batch"){we(gy(t.data.inputs.images));const l=t.data.inputs.images.value??[],c=o.find(p=>p.target===t.id&&p.targetHandle==="images");if(!c)return l??[];const d=a.find(p=>p.id===c.source);we(d,"Missing edge from image generator to image batch");const h=d.data.inputs.generator;return we(G3(h),"Invalid image generator field"),await H3(h,n)}else if(t.data.type==="string_batch"){we(Kw(t.data.inputs.strings));const l=t.data.inputs.strings.value,c=o.find(p=>p.target===t.id&&p.targetHandle==="strings");if(!c)return l??[];const d=a.find(p=>p.id===c.source);we(d,"Missing edge from string generator to string batch");const h=d.data.inputs.generator;return we(W3(h),"Invalid string generator"),await U3(h,n)}else if(t.data.type==="float_batch"){we(Zw(t.data.inputs.floats));const l=t.data.inputs.floats.value,c=o.find(p=>p.target===t.id&&p.targetHandle==="floats");if(!c)return l??[];const d=a.find(p=>p.id===c.source);we(d,"Missing edge from float generator to float batch");const h=d.data.inputs.generator;return we(q3(h),"Invalid float generator"),K3(h)}else if(t.data.type==="integer_batch"){we(Yw(t.data.inputs.integers));const l=t.data.inputs.integers.value,c=o.find(p=>p.target===t.id&&p.targetHandle==="integers");if(!c)return l??[];const d=a.find(p=>p.id===c.source);we(d,"Missing edge from integer generator to integer batch");const h=d.data.inputs.generator;return we(Z3(h),"Invalid integer generator field"),Y3(h)}we(!1,"Invalid batch node type")},ple=async(e,t)=>{const{nodes:n}=e,s=n.filter(Pn).filter(jp),i=s.filter(x=>{var v;return((v=x.data.inputs.batch_group_id)==null?void 0:v.value)==="None"}),o=s.filter(x=>{var v;return((v=x.data.inputs.batch_group_id)==null?void 0:v.value)==="Group 1"}),a=s.filter(x=>{var v;return((v=x.data.inputs.batch_group_id)==null?void 0:v.value)==="Group 2"}),l=s.filter(x=>{var v;return((v=x.data.inputs.batch_group_id)==null?void 0:v.value)==="Group 3"}),c=s.filter(x=>{var v;return((v=x.data.inputs.batch_group_id)==null?void 0:v.value)==="Group 4"}),d=s.filter(x=>{var v;return((v=x.data.inputs.batch_group_id)==null?void 0:v.value)==="Group 5"}),h=await Promise.all(i.map(async x=>(await ba({nodesState:e,dispatch:t,node:x})).length)),f=await Promise.all(o.map(async x=>(await ba({nodesState:e,dispatch:t,node:x})).length)),p=await Promise.all(a.map(async x=>(await ba({nodesState:e,dispatch:t,node:x})).length)),g=await Promise.all(l.map(async x=>(await ba({nodesState:e,dispatch:t,node:x})).length)),m=await Promise.all(c.map(async x=>(await ba({nodesState:e,dispatch:t,node:x})).length)),y=await Promise.all(d.map(async x=>(await ba({nodesState:e,dispatch:t,node:x})).length)),b=[...h,...f,...p,...g,...m,...y];if(b.length===0)return"NO_BATCHES";if(b.some(x=>x===0))return"EMPTY_BATCHES";for(const x of[f,p,g,m,y])if(x.length!==0&&x.some(v=>v!==x[0]))return"MISMATCHED_BATCH_GROUP";return[...h,f[0]??1,p[0]??1,g[0]??1,m[0]??1,y[0]??1].reduce((x,v)=>x*v,1)},gle=Xw("app/enqueueRequestedWorkflows"),yD=()=>{const{getState:e,dispatch:t}=dn();return u.useCallback(async(s,i)=>{t(gle());const o=e(),a=Qe(o),l=sn.get(),c=fle(o,l),d=NY(a);d&&delete d.id;const h=[],p=a.nodes.filter(Pn).filter(jp),g=Qw(p,C=>{var x;return(x=C.data.inputs.batch_group_id)==null?void 0:x.value});for(const[C,x]of Object.entries(g)){const v=[];for(const w of x){const S=await ba({nodesState:a,node:w,dispatch:t}),j=w.data.type==="image_batch"?"image":"value",P=a.edges.filter(E=>E.source===w.id&&E.sourceHandle===j);if(C!=="None")for(const E of P){if(!E.targetHandle)break;v.push({node_path:E.target,field_name:E.targetHandle,items:S})}else{const E=[];for(const D of P){if(!D.targetHandle)break;E.push({node_path:D.target,field_name:D.targetHandle,items:S})}E.length>0&&h.push(E)}}C!=="None"&&v.length>0&&h.push(v)}const m={batch:{graph:c,workflow:d,runs:o.params.iterations,origin:"workflows",destination:"gallery",data:h},prepend:s};if(i){const C=pD(o),v=gD(C,l).publishable.map(({nodeId:D,fieldName:M})=>({kind:"input",node_id:D,field_name:M})),w=Xo.get();we(w!==null,"Output node not selected");const S=ed(Qe(o),w).type,j=l[S];we(j,`Template for node type ${S} not found`);const E=Object.keys(j.outputs).map(D=>({kind:"output",node_id:w,field_name:D}));we(a.id,"Workflow without ID cannot be used for API validation run"),m.validation_run_data={workflow_id:a.id,input_fields:v,output_fields:E},m.batch.runs=1}const b=await t(Tl.endpoints.enqueueBatch.initiate(m,{...kp,track:!1})).unwrap();return{batchConfig:m,enqueueResult:b}},[t,e])},mle=Oe(!1),Zd=Oe(!0),yle=/.*\{[\s\S]*\}.*/,lj=e=>yle.test(e),ble=(e,t)=>{const n=[],{minItems:s,maxItems:i}=t,o=e.length;return s!==void 0&&s>0&&o===0?n.push(Pe("parameters.invoke.collectionEmpty")):(s!==void 0&&o<s&&n.push(Pe("parameters.invoke.collectionTooFewItems",{count:o,minItems:s})),i!==void 0&&o>i&&n.push(Pe("parameters.invoke.collectionTooManyItems",{count:o,maxItems:i}))),n},xle=(e,t)=>{const n=[],{minItems:s,maxItems:i,minLength:o,maxLength:a}=t,l=e.length;s!==void 0&&s>0&&l===0?n.push(Pe("parameters.invoke.collectionEmpty")):(s!==void 0&&l<s&&n.push(Pe("parameters.invoke.collectionTooFewItems",{count:l,minItems:s})),i!==void 0&&l>i&&n.push(Pe("parameters.invoke.collectionTooManyItems",{count:l,maxItems:i})));for(const c of e)a!==void 0&&c.length>a&&n.push(Pe("parameters.invoke.collectionStringTooLong",{value:e,maxLength:a})),o!==void 0&&c.length<o&&n.push(Pe("parameters.invoke.collectionStringTooShort",{value:e,minLength:o}));return n},XI=(e,t)=>{const n=[],{minItems:s,maxItems:i,minimum:o,maximum:a,exclusiveMinimum:l,exclusiveMaximum:c,multipleOf:d}=t,h=e.length;s!==void 0&&s>0&&h===0?n.push(Pe("parameters.invoke.collectionEmpty")):(s!==void 0&&h<s&&n.push(Pe("parameters.invoke.collectionTooFewItems",{count:h,minItems:s})),i!==void 0&&h>i&&n.push(Pe("parameters.invoke.collectionTooManyItems",{count:h,maxItems:i})));for(const f of e)a!==void 0&&f>a&&n.push(Pe("parameters.invoke.collectionNumberGTMax",{value:e,maximum:a})),o!==void 0&&f<o&&n.push(Pe("parameters.invoke.collectionNumberLTMin",{value:e,minimum:o})),c!==void 0&&f>=c&&n.push(Pe("parameters.invoke.collectionNumberGTExclusiveMax",{value:e,exclusiveMaximum:c})),l!==void 0&&f<=l&&n.push(Pe("parameters.invoke.collectionNumberLTExclusiveMin",{value:e,exclusiveMinimum:l})),d!==void 0&&f%d!==0&&n.push(Pe("parameters.invoke.collectionNumberNotMultipleOf",{value:e,multipleOf:d}));return n},QI=(e,t)=>{const n=[],{minimum:s,maximum:i,exclusiveMinimum:o,exclusiveMaximum:a,multipleOf:l}=t;return i!==void 0&&e>i&&n.push(Pe("parameters.invoke.collectionNumberGTMax",{value:e,maximum:i})),s!==void 0&&e<s&&n.push(Pe("parameters.invoke.collectionNumberLTMin",{value:e,minimum:s})),a!==void 0&&e>=a&&n.push(Pe("parameters.invoke.collectionNumberGTExclusiveMax",{value:e,exclusiveMaximum:a})),o!==void 0&&e<=o&&n.push(Pe("parameters.invoke.collectionNumberLTExclusiveMin",{value:e,exclusiveMinimum:o})),l!==void 0&&e%l!==0&&n.push(Pe("parameters.invoke.collectionNumberNotMultipleOf",{value:e,multipleOf:l})),n},vle=(e,t,n,s)=>`${e.data.label||t.title} -> ${n.label||s.title}`,Cle=(e,t,n)=>s=>({type:"field-error",nodeId:e,fieldName:t,prefix:n,issue:s}),cj=(e,t,n,s,i)=>{const o=[],a=vle(e,t,n,s),l=Cle(e.data.id,n.name,a),c=e.data.id,d=n.name,h=i.edges.find(f=>f.target===c&&f.targetHandle===d)!==void 0;return s.required&&!h&&n.value===void 0?o.push({type:"field-error",nodeId:c,fieldName:d,prefix:a,issue:Pe("parameters.invoke.missingInputForField")}):h||n.value!==void 0&&(X3(s)&&gy(n)?o.push(...ble(n.value,s).map(l)):Q3(s)&&Kw(n)?o.push(...xle(n.value,s).map(l)):J3(s)&&Yw(n)?o.push(...XI(n.value,s).map(l)):eM(s)&&Zw(n)?o.push(...XI(n.value,s).map(l)):M0(s)&&tM(n)?o.push(...QI(n.value,s).map(l)):P0(s)&&nM(n)&&o.push(...QI(n.value,s).map(l))),o},bD=(e,t,n)=>{const s=[],i=n.nodes.find(a=>a.id===e);we(Pn(i),`Node ${e} is not an invocation node`);const o=t[i.data.type];if(!o)return s.push({type:"node-error",nodeId:e,issue:Pe("parameters.invoke.missingNodeTemplate")}),s;for(const[a,l]of Object.entries(i.data.inputs)){const c=o.inputs[a];if(!c){s.push({type:"node-error",nodeId:e,issue:Pe("parameters.invoke.missingFieldTemplate")});continue}s.push(...cj(i,o,l,c,n))}return s},An=fe(td,e=>e.activeTab),xD=fe(td,e=>e.shouldShowImageDetails),uj=fe(td,e=>e.shouldShowProgressInViewer),qf=fe(td,e=>e.activeTabCanvasRightPanel),Yd={reference_image:"controlLayers.referenceImage",inpaint_mask:"controlLayers.inpaintMask",regional_guidance:"controlLayers.regionalGuidance",raster_layer:"controlLayers.rasterLayer",control_layer:"controlLayers.controlLayer"},Pa=Oe([]),hd=Wn(Pa,e=>e.length===0),wle=ii(async(e,t,n,s,i,o,a,l,c,d,h,f,p,g,m,y,b)=>{if(e==="canvas"){const C=Jw(y.getState()),x=await _le({isConnected:t,model:C,canvas:n,params:s,dynamicPrompts:i,canvasIsFiltering:o,canvasIsTransforming:a,canvasIsRasterizing:l,canvasIsCompositing:c,canvasIsSelectingObject:d});Pa.set(x)}else if(e==="workflows"){const C=await jle({dispatch:y.dispatch,nodesState:h,workflowSettingsState:f,isConnected:t,templates:p,isInPublishFlow:b});Pa.set(C)}else if(e==="upscaling"){const C=kle({isConnected:t,upscale:g,config:m,params:s});Pa.set(C)}else Pa.set(Ls)},300),Sle=()=>{At("useReadinessWatcher");const e=dn(),t=sM(),n=I(An),s=I(tt),i=I(nd),o=I(rM),a=I(Qe),l=I(iM),c=I(_p),d=I(Pr),h=ae(sn),f=ae(Yn),p=ae((t==null?void 0:t.stateApi.$isFiltering)??Zd),g=ae((t==null?void 0:t.stateApi.$isTransforming)??Zd),m=ae((t==null?void 0:t.stateApi.$isRasterizing)??Zd),y=ae((t==null?void 0:t.stateApi.$isSegmenting)??Zd),b=ae((t==null?void 0:t.compositor.$isBusy)??Zd),C=ae(na);u.useEffect(()=>{wle(n,f,s,i,o,p,g,m,b,y,a,l,h,c,d,e,C)},[e,s,b,p,m,y,g,d,o,f,a,i,n,h,c,l,C])},dj=e=>({content:e("parameters.invoke.systemDisconnected")}),jle=async e=>{const{dispatch:t,nodesState:n,workflowSettingsState:s,isConnected:i,templates:o,isInPublishFlow:a}=e,l=[];if(i||l.push(dj(ot.t)),s.shouldValidateGraph||a){const{nodes:c,edges:d}=n,h=c.filter(Pn),f=h.filter(jp);h.filter(B3).length||l.push({content:ot.t("parameters.invoke.noNodesInGraph")});for(const g of f)d.find(m=>m.source===g.id)===void 0&&l.push({content:ot.t("parameters.invoke.batchNodeNotConnected",{label:g.data.label})});if(f.length>0){const g=[],m=Qw(f,y=>{var b;return(b=y.data.inputs.batch_group_id)==null?void 0:b.value});for(const[y,b]of Object.entries(m)){const C=[];for(const x of b){const v=(await ba({dispatch:t,nodesState:n,node:x})).length;y==="None"?g.push(v):C.push(v)}C.some(x=>x!==C[0])&&l.push({content:ot.t("parameters.invoke.batchNodeCollectionSizeMismatch",{batchGroupId:y})}),C[0]!==void 0&&g.push(C[0])}g.some(y=>y===0)&&l.push({content:ot.t("parameters.invoke.batchNodeEmptyCollection")})}h.forEach(g=>{if(!Pn(g))return;const m=bD(g.data.id,o,n);for(const y of m)y.type==="node-error"?l.push({content:y.issue}):l.push({prefix:y.prefix,content:y.issue})})}return l},kle=e=>{const{isConnected:t,upscale:n,config:s,params:i}=e,o=[];if(t||o.push(dj(ot.t)),!n.upscaleInitialImage)o.push({content:ot.t("upscaling.missingUpscaleInitialImage")});else if(s.maxUpscaleDimension){const{width:l,height:c}=n.upscaleInitialImage,{scale:d}=n,h=s.maxUpscaleDimension**2;l*d*c*d>h&&o.push({content:ot.t("upscaling.exceedsMaxSize")})}const a=i.model;return a&&!["sd-1","sdxl"].includes(a.base)?o.push({content:ot.t("upscaling.incompatibleBaseModel")}):(a||o.push({content:ot.t("parameters.invoke.noModelSelected")}),n.upscaleModel||o.push({content:ot.t("upscaling.missingUpscaleModel")}),n.tileControlnetModel||o.push({content:ot.t("upscaling.missingTileControlNetModel")})),o},_le=e=>{const{isConnected:t,model:n,canvas:s,params:i,dynamicPrompts:o,canvasIsFiltering:a,canvasIsTransforming:l,canvasIsRasterizing:c,canvasIsCompositing:d,canvasIsSelectingObject:h}=e,{positivePrompt:f}=i,p=[];if(t||p.push(dj(ot.t)),a&&p.push({content:ot.t("parameters.invoke.canvasIsFiltering")}),l&&p.push({content:ot.t("parameters.invoke.canvasIsTransforming")}),c&&p.push({content:ot.t("parameters.invoke.canvasIsRasterizing")}),d&&p.push({content:ot.t("parameters.invoke.canvasIsCompositing")}),h&&p.push({content:ot.t("parameters.invoke.canvasIsSelectingObject")}),o.prompts.length===0&&lj(f)&&p.push({content:ot.t("parameters.invoke.noPrompts")}),n||p.push({content:ot.t("parameters.invoke.noModelSelected")}),(n==null?void 0:n.base)==="flux"){i.t5EncoderModel||p.push({content:ot.t("parameters.invoke.noT5EncoderModelSelected")}),i.clipEmbedModel||p.push({content:ot.t("parameters.invoke.noCLIPEmbedModelSelected")}),i.fluxVAE||p.push({content:ot.t("parameters.invoke.noFLUXVAEModelSelected")});const{bbox:y}=s,b=L0("flux");y.scaleMethod==="none"?(y.rect.width%b!==0&&p.push({content:ot.t("parameters.invoke.modelIncompatibleBboxWidth",{model:"FLUX",width:y.rect.width,multiple:b})}),y.rect.height%b!==0&&p.push({content:ot.t("parameters.invoke.modelIncompatibleBboxHeight",{model:"FLUX",height:y.rect.height,multiple:b})})):(y.scaledSize.width%b!==0&&p.push({content:ot.t("parameters.invoke.modelIncompatibleScaledBboxWidth",{model:"FLUX",width:y.scaledSize.width,multiple:b})}),y.scaledSize.height%b!==0&&p.push({content:ot.t("parameters.invoke.modelIncompatibleScaledBboxHeight",{model:"FLUX",height:y.scaledSize.height,multiple:b})}))}if((n==null?void 0:n.base)==="cogview4"){const{bbox:y}=s,b=L0("cogview4");y.scaleMethod==="none"?(y.rect.width%b!==0&&p.push({content:ot.t("parameters.invoke.modelIncompatibleBboxWidth",{model:"CogView4",width:y.rect.width,multiple:b})}),y.rect.height%b!==0&&p.push({content:ot.t("parameters.invoke.modelIncompatibleBboxHeight",{model:"CogView4",height:y.rect.height,multiple:b})})):(y.scaledSize.width%b!==0&&p.push({content:ot.t("parameters.invoke.modelIncompatibleScaledBboxWidth",{model:"CogView4",width:y.scaledSize.width,multiple:b})}),y.scaledSize.height%b!==0&&p.push({content:ot.t("parameters.invoke.modelIncompatibleScaledBboxHeight",{model:"CogView4",height:y.scaledSize.height,multiple:b})}))}const g=s.controlLayers.entities.filter(y=>y.isEnabled),m=g.filter(y=>{var b,C;return((C=(b=y.controlAdapter)==null?void 0:b.model)==null?void 0:C.type)==="control_lora"}).length;return(n==null?void 0:n.base)==="flux"&&m>1&&p.push({content:ot.t("parameters.invoke.fluxModelMultipleControlLoRAs")}),g.forEach((y,b)=>{const C=ot.t("controlLayers.layer_one"),x=b+1,v=ot.t(Yd.control_layer),w=`${C} #${x} (${v})`,S=oM(y,n);if(S.length){const j=wl(S.map(P=>ot.t(P)).join(", "));p.push({prefix:w,content:j})}}),s.referenceImages.entities.filter(y=>y.isEnabled).forEach((y,b)=>{const C=ot.t("controlLayers.layer_one"),x=b+1,v=ot.t(Yd[y.type]),w=`${C} #${x} (${v})`,S=aM(y,n);if(S.length){const j=wl(S.map(P=>ot.t(P)).join(", "));p.push({prefix:w,content:j})}}),s.regionalGuidance.entities.filter(y=>y.isEnabled).forEach((y,b)=>{const C=ot.t("controlLayers.layer_one"),x=b+1,v=ot.t(Yd[y.type]),w=`${C} #${x} (${v})`,S=lM(y,n);if(S.length){const j=wl(S.map(P=>ot.t(P)).join(", "));p.push({prefix:w,content:j})}}),s.rasterLayers.entities.filter(y=>y.isEnabled).forEach((y,b)=>{const C=ot.t("controlLayers.layer_one"),x=b+1,v=ot.t(Yd[y.type]),w=`${C} #${x} (${v})`,S=cM();if(S.length){const j=wl(S.map(P=>ot.t(P)).join(", "));p.push({prefix:w,content:j})}}),s.inpaintMasks.entities.filter(y=>y.isEnabled).forEach((y,b)=>{const C=ot.t("controlLayers.layer_one"),x=b+1,v=ot.t(Yd[y.type]),w=`${C} #${x} (${v})`,S=uM();if(S.length){const j=wl(S.map(P=>ot.t(P)).join(", "));p.push({prefix:w,content:j})}}),p},Ile=fe(nd,rM,(e,t)=>lj(e.positivePrompt)?t.prompts.length:1),JI=$n("generation"),hj=()=>{const e=G(),t=I(An),n=ae(hd),s=wo(),i=yD(),[o,{isLoading:a}]=eS(kp),l=u.useCallback(async(h,f)=>{if(n){if(t==="workflows"){const p=await fs(()=>i(h,f));p.isErr()?JI.error({error:Un(p.error)},"Failed to enqueue batch"):JI.debug(Ci(p.value),"Enqueued batch")}if(t==="upscaling"){e(FY({prepend:h}));return}if(t==="canvas"){e(BY({prepend:h}));return}}},[e,i,n,t]),c=u.useCallback(()=>{l(!1,!1)},[l]),d=u.useCallback(()=>{l(!0,!1)},[l]);return{enqueueBack:c,enqueueFront:d,isLoading:a,isDisabled:!n||s,enqueue:l}},Bt=e=>{const t=u.useMemo(()=>fe(Pr,s=>!(s.disabledFeatures.includes(e)||s.disabledSDFeatures.includes(e)||s.disabledTabs.includes(e))),[e]);return I(t)};function X2(){return X2=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},X2.apply(this,arguments)}var vD=["shift","alt","meta","mod","ctrl"],Tle={esc:"escape",return:"enter",".":"period",",":"comma","-":"slash"," ":"space","`":"backquote","#":"backslash","+":"bracketright",ShiftLeft:"shift",ShiftRight:"shift",AltLeft:"alt",AltRight:"alt",MetaLeft:"meta",MetaRight:"meta",OSLeft:"meta",OSRight:"meta",ControlLeft:"ctrl",ControlRight:"ctrl"};function La(e){return(Tle[e]||e).trim().toLowerCase().replace(/key|digit|numpad|arrow/,"")}function Ale(e){return vD.includes(e)}function Fx(e,t){return t===void 0&&(t=","),e.split(t)}function Bx(e,t,n){t===void 0&&(t="+");var s=e.toLocaleLowerCase().split(t).map(function(a){return La(a)}),i={alt:s.includes("alt"),ctrl:s.includes("ctrl")||s.includes("control"),shift:s.includes("shift"),meta:s.includes("meta"),mod:s.includes("mod")},o=s.filter(function(a){return!vD.includes(a)});return X2({},i,{keys:o,description:n})}(function(){typeof document<"u"&&(document.addEventListener("keydown",function(e){e.key!==void 0&&CD([La(e.key),La(e.code)])}),document.addEventListener("keyup",function(e){e.key!==void 0&&wD([La(e.key),La(e.code)])})),typeof window<"u"&&window.addEventListener("blur",function(){Da.clear()})})();var Da=new Set;function fj(e){return Array.isArray(e)}function Ele(e,t){t===void 0&&(t=",");var n=fj(e)?e:e.split(t);return n.every(function(s){return Da.has(s.trim().toLowerCase())})}function CD(e){var t=Array.isArray(e)?e:[e];Da.has("meta")&&Da.forEach(function(n){return!Ale(n)&&Da.delete(n.toLowerCase())}),t.forEach(function(n){return Da.add(n.toLowerCase())})}function wD(e){var t=Array.isArray(e)?e:[e];e==="meta"?Da.clear():t.forEach(function(n){return Da.delete(n.toLowerCase())})}function Mle(e,t,n){(typeof n=="function"&&n(e,t)||n===!0)&&e.preventDefault()}function Ple(e,t,n){return typeof n=="function"?n(e,t):n===!0||n===void 0}function Lle(e){return SD(e,["input","textarea","select"])}function SD(e,t){var n=e.target;t===void 0&&(t=!1);var s=n&&n.tagName;return fj(t)?!!(s&&t&&t.some(function(i){return i.toLowerCase()===s.toLowerCase()})):!!(s&&t&&t===!0)}function Dle(e,t){return e.length===0&&t?(console.warn('A hotkey has the "scopes" option set, however no active scopes were found. If you want to use the global scopes feature, you need to wrap your app in a <HotkeysProvider>'),!0):t?e.some(function(n){return t.includes(n)})||e.includes("*"):!0}var Rle=function(t,n,s){s===void 0&&(s=!1);var i=n.alt,o=n.meta,a=n.mod,l=n.shift,c=n.ctrl,d=n.keys,h=t.key,f=t.code,p=t.ctrlKey,g=t.metaKey,m=t.shiftKey,y=t.altKey,b=La(f),C=h.toLowerCase();if(!(d!=null&&d.includes(b))&&!(d!=null&&d.includes(C))&&!["ctrl","control","unknown","meta","alt","shift","os"].includes(b))return!1;if(!s){if(i===!y&&C!=="alt"||l===!m&&C!=="shift")return!1;if(a){if(!g&&!p)return!1}else if(o===!g&&C!=="meta"&&C!=="os"||c===!p&&C!=="ctrl"&&C!=="control")return!1}return d&&d.length===1&&(d.includes(C)||d.includes(b))?!0:d?Ele(d):!d},Ole=u.createContext(void 0),Nle=function(){return u.useContext(Ole)};function jD(e,t){return e&&t&&typeof e=="object"&&typeof t=="object"?Object.keys(e).length===Object.keys(t).length&&Object.keys(e).reduce(function(n,s){return n&&jD(e[s],t[s])},!0):e===t}var Fle=u.createContext({hotkeys:[],enabledScopes:[],toggleScope:function(){},enableScope:function(){},disableScope:function(){}}),Ble=function(){return u.useContext(Fle)};function $le(e){var t=u.useRef(void 0);return jD(t.current,e)||(t.current=e),t.current}var e5=function(t){t.stopPropagation(),t.preventDefault(),t.stopImmediatePropagation()},Vle=typeof window<"u"?u.useLayoutEffect:u.useEffect;function Ii(e,t,n,s){var i=u.useRef(null),o=u.useRef(!1),a=n instanceof Array?s instanceof Array?void 0:s:n,l=fj(e)?e.join(a==null?void 0:a.splitKey):e,c=n instanceof Array?n:s instanceof Array?s:void 0,d=u.useCallback(t,c??[]),h=u.useRef(d);c?h.current=d:h.current=t;var f=$le(a),p=Ble(),g=p.enabledScopes,m=Nle();return Vle(function(){if(!((f==null?void 0:f.enabled)===!1||!Dle(g,f==null?void 0:f.scopes))){var y=function(w,S){var j;if(S===void 0&&(S=!1),!(Lle(w)&&!SD(w,f==null?void 0:f.enableOnFormTags))){if(i.current!==null){var P=i.current.getRootNode();if((P instanceof Document||P instanceof ShadowRoot)&&P.activeElement!==i.current&&!i.current.contains(P.activeElement)){e5(w);return}}(j=w.target)!=null&&j.isContentEditable&&!(f!=null&&f.enableOnContentEditable)||Fx(l,f==null?void 0:f.splitKey).forEach(function(E){var D,M=Bx(E,f==null?void 0:f.combinationKey);if(Rle(w,M,f==null?void 0:f.ignoreModifiers)||(D=M.keys)!=null&&D.includes("*")){if(f!=null&&f.ignoreEventWhen!=null&&f.ignoreEventWhen(w)||S&&o.current)return;if(Mle(w,M,f==null?void 0:f.preventDefault),!Ple(w,M,f==null?void 0:f.enabled)){e5(w);return}h.current(w,M),S||(o.current=!0)}})}},b=function(w){w.key!==void 0&&(CD(La(w.code)),((f==null?void 0:f.keydown)===void 0&&(f==null?void 0:f.keyup)!==!0||f!=null&&f.keydown)&&y(w))},C=function(w){w.key!==void 0&&(wD(La(w.code)),o.current=!1,f!=null&&f.keyup&&y(w,!0))},x=i.current||(a==null?void 0:a.document)||document;return x.addEventListener("keyup",C),x.addEventListener("keydown",b),m&&Fx(l,f==null?void 0:f.splitKey).forEach(function(v){return m.addHotkey(Bx(v,f==null?void 0:f.combinationKey,f==null?void 0:f.description))}),function(){x.removeEventListener("keyup",C),x.removeEventListener("keydown",b),m&&Fx(l,f==null?void 0:f.splitKey).forEach(function(v){return m.removeHotkey(Bx(v,f==null?void 0:f.combinationKey,f==null?void 0:f.description))})}}},[l,f,g]),i}const zle=(e,t)=>e.map(n=>t?n.split("+").map(s=>s.replaceAll("mod","cmd").replaceAll("alt","option")):n.split("+").map(s=>s.replaceAll("mod","ctrl"))),kD=()=>{const{t:e}=A(),t=Bt("modelManager"),n=u.useMemo(()=>navigator.userAgent.toLowerCase().includes("mac"),[]);return u.useMemo(()=>{const i={app:{title:e("hotkeys.app.title"),hotkeys:{}},canvas:{title:e("hotkeys.canvas.title"),hotkeys:{}},viewer:{title:e("hotkeys.viewer.title"),hotkeys:{}},gallery:{title:e("hotkeys.gallery.title"),hotkeys:{}},workflows:{title:e("hotkeys.workflows.title"),hotkeys:{}}},o=(a,l,c)=>{i[a].hotkeys[l]={id:l,category:a,title:e(`hotkeys.${a}.${l}.title`),desc:e(`hotkeys.${a}.${l}.desc`),hotkeys:c,platformKeys:zle(c,n)}};return o("app","invoke",["mod+enter"]),o("app","invokeFront",["mod+shift+enter"]),o("app","cancelQueueItem",["shift+x"]),o("app","clearQueue",["mod+shift+x"]),o("app","selectCanvasTab",["1"]),o("app","selectUpscalingTab",["2"]),o("app","selectWorkflowsTab",["3"]),t&&o("app","selectModelsTab",["4"]),o("app","selectQueueTab",t?["5"]:["4"]),o("app","focusPrompt",["alt+a"]),o("app","toggleLeftPanel",["t","o"]),o("app","toggleRightPanel",["g"]),o("app","resetPanelLayout",["shift+r"]),o("app","togglePanels",["f"]),o("canvas","selectBrushTool",["b"]),o("canvas","selectBboxTool",["c"]),o("canvas","decrementToolWidth",["["]),o("canvas","incrementToolWidth",["]"]),o("canvas","selectEraserTool",["e"]),o("canvas","selectMoveTool",["v"]),o("canvas","selectRectTool",["u"]),o("canvas","selectViewTool",["h"]),o("canvas","selectColorPickerTool",["i"]),o("canvas","setFillToWhite",["d"]),o("canvas","fitLayersToCanvas",["mod+0"]),o("canvas","fitBboxToCanvas",["mod+shift+0"]),o("canvas","setZoomTo100Percent",["mod+1"]),o("canvas","setZoomTo200Percent",["mod+2"]),o("canvas","setZoomTo400Percent",["mod+3"]),o("canvas","setZoomTo800Percent",["mod+4"]),o("canvas","quickSwitch",["q"]),o("canvas","deleteSelected",["delete","backspace"]),o("canvas","resetSelected",["shift+c"]),o("canvas","transformSelected",["shift+t"]),o("canvas","filterSelected",["shift+f"]),o("canvas","undo",["mod+z"]),o("canvas","redo",["mod+shift+z","mod+y"]),o("canvas","nextEntity",["alt+]"]),o("canvas","prevEntity",["alt+["]),o("canvas","applyFilter",["enter"]),o("canvas","cancelFilter",["esc"]),o("canvas","applyTransform",["enter"]),o("canvas","cancelTransform",["esc"]),o("canvas","applySegmentAnything",["enter"]),o("canvas","cancelSegmentAnything",["esc"]),o("workflows","addNode",["shift+a","space"]),o("workflows","copySelection",["mod+c"]),o("workflows","pasteSelection",["mod+v"]),o("workflows","pasteSelectionWithEdges",["mod+shift+v"]),o("workflows","selectAll",["mod+a"]),o("workflows","deleteSelection",["delete","backspace"]),o("workflows","undo",["mod+z"]),o("workflows","redo",["mod+shift+z","mod+y"]),o("viewer","toggleViewer",["z"]),o("viewer","swapImages",["c"]),o("viewer","nextComparisonMode",["m"]),o("viewer","loadWorkflow",["w"]),o("viewer","recallAll",["a"]),o("viewer","recallSeed",["s"]),o("viewer","recallPrompts",["p"]),o("viewer","remix",["r"]),o("viewer","useSize",["d"]),o("viewer","runPostprocessing",["shift+u"]),o("viewer","toggleMetadata",["i"]),o("gallery","selectAllOnPage",["mod+a"]),o("gallery","clearSelection",["esc"]),o("gallery","galleryNavUp",["up"]),o("gallery","galleryNavRight",["right"]),o("gallery","galleryNavDown",["down"]),o("gallery","galleryNavLeft",["left"]),o("gallery","galleryNavUpAlt",["alt+up"]),o("gallery","galleryNavRightAlt",["alt+right"]),o("gallery","galleryNavDownAlt",["alt+down"]),o("gallery","galleryNavLeftAlt",["alt+left"]),o("gallery","deleteSelection",["delete","backspace"]),i},[n,t,e])},Re=({id:e,category:t,callback:n,options:s,dependencies:i})=>{const o=kD(),a=u.useMemo(()=>{var c;const l=(c=o[t].hotkeys[e])==null?void 0:c.hotkeys;return we(l!==void 0,`Hotkey ${t}.${e} not found`),l},[t,o,e]);return Ii(a,n,s,i)},Gle=()=>{const e=G(),t=Bt("modelManager"),n=hj();Re({id:"invoke",category:"app",callback:n.enqueueBack,options:{enabled:!n.isDisabled&&!n.isLoading,preventDefault:!0,enableOnFormTags:["input","textarea","select"]},dependencies:[n]}),Re({id:"invokeFront",category:"app",callback:n.enqueueFront,options:{enabled:!n.isDisabled&&!n.isLoading,preventDefault:!0,enableOnFormTags:["input","textarea","select"]},dependencies:[n]});const{cancelQueueItem:s,isDisabled:i,isLoading:o}=qy();Re({id:"cancelQueueItem",category:"app",callback:s,options:{enabled:!i&&!o,preventDefault:!0},dependencies:[s,i,o]});const{clearQueue:a,isDisabled:l,isLoading:c}=hD();Re({id:"clearQueue",category:"app",callback:a,options:{enabled:!l&&!c,preventDefault:!0},dependencies:[a,l,c]}),Re({id:"selectCanvasTab",category:"app",callback:()=>{e(Qt("canvas"))},dependencies:[e]}),Re({id:"selectUpscalingTab",category:"app",callback:()=>{e(Qt("upscaling"))},dependencies:[e]}),Re({id:"selectWorkflowsTab",category:"app",callback:()=>{e(Qt("workflows"))},dependencies:[e]}),Re({id:"selectModelsTab",category:"app",callback:()=>{e(Qt("models"))},options:{enabled:t},dependencies:[e,t]}),Re({id:"selectQueueTab",category:"app",callback:()=>{e(Qt("queue"))},dependencies:[e,t]})},Hle=1e3,Wle=()=>{const{getState:e,dispatch:t}=dn(),n=I($Y),s=I(dM),i=Bt("dynamicPrompting"),o=u.useMemo(()=>ii(async(a,l)=>{try{const d=await t(Y4.endpoints.dynamicPrompts.initiate({prompt:a,max_prompts:l},{subscribe:!1})).unwrap();t(kx(d.prompts)),t(_x(d.error)),t(Ix(!1))}catch{t(Ix(!0)),t(X4(!1))}},Hle),[t]);u.useEffect(()=>{if(!i)return;const{positivePrompt:a}=n,l=e(),c=Y4.endpoints.dynamicPrompts.select({prompt:a,max_prompts:s})(l).data;if(c){t(kx(c.prompts)),t(_x(c.error));return}if(!lj(a)){t(kx([a])),t(_x(void 0)),t(Ix(!1));return}l.dynamicPrompts.isLoading||t(X4(!0)),o(a,s)},[o,t,i,e,s,n])},Jn=u.memo(({loadingMessage:e})=>r.jsx(T,{flexDirection:"column",gap:4,borderRadius:"base",p:4,bg:"base.800",children:r.jsxs(T,{justifyContent:"center",alignItems:"center",flexDirection:"column",p:4,gap:8,children:[r.jsx(Lr,{}),r.jsx(q,{variant:"subtext",children:e||"Fetching..."})]})}));Jn.displayName="FetchingModelsLoader";function qn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(){t.forEach(function(i){return i()})}}function Ule(e){if(Array.isArray(e))return e}function qle(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var s,i,o,a,l=[],c=!0,d=!1;try{if(o=(n=n.call(e)).next,t===0){if(Object(n)!==n)return;c=!1}else for(;!(c=(s=o.call(n)).done)&&(l.push(s.value),l.length!==t);c=!0);}catch(h){d=!0,i=h}finally{try{if(!c&&n.return!=null&&(a=n.return(),Object(a)!==a))return}finally{if(d)throw i}}return l}}function Q2(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=Array(t);n<t;n++)s[n]=e[n];return s}function _D(e,t){if(e){if(typeof e=="string")return Q2(e,t);var n={}.toString.call(e).slice(8,-1);return n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set"?Array.from(e):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Q2(e,t):void 0}}function Kle(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function pj(e,t){return Ule(e)||qle(e,t)||_D(e,t)||Kle()}var $x={},Xd={},t5;function ID(){if(t5)return Xd;t5=1,Object.defineProperty(Xd,"__esModule",{value:!0}),Xd.bind=void 0;function e(t,n){var s=n.type,i=n.listener,o=n.options;return t.addEventListener(s,i,o),function(){t.removeEventListener(s,i,o)}}return Xd.bind=e,Xd}var pl={},n5;function Zle(){if(n5)return pl;n5=1;var e=pl&&pl.__assign||function(){return e=Object.assign||function(o){for(var a,l=1,c=arguments.length;l<c;l++){a=arguments[l];for(var d in a)Object.prototype.hasOwnProperty.call(a,d)&&(o[d]=a[d])}return o},e.apply(this,arguments)};Object.defineProperty(pl,"__esModule",{value:!0}),pl.bindAll=void 0;var t=ID();function n(o){if(!(typeof o>"u"))return typeof o=="boolean"?{capture:o}:o}function s(o,a){if(a==null)return o;var l=e(e({},o),{options:e(e({},n(a)),n(o.options))});return l}function i(o,a,l){var c=a.map(function(d){var h=s(d,l);return(0,t.bind)(o,h)});return function(){c.forEach(function(h){return h()})}}return pl.bindAll=i,pl}var s5;function Yle(){return s5||(s5=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.bindAll=e.bind=void 0;var t=ID();Object.defineProperty(e,"bind",{enumerable:!0,get:function(){return t.bind}});var n=Zle();Object.defineProperty(e,"bindAll",{enumerable:!0,get:function(){return n.bindAll}})}($x)),$x}var po=Yle(),TD="data-pdnd-honey-pot";function AD(e){return e instanceof Element&&e.hasAttribute(TD)}function gj(e){var t=document.elementsFromPoint(e.x,e.y),n=pj(t,2),s=n[0],i=n[1];return s?AD(s)?i??null:s:null}function Kf(e){"@babel/helpers - typeof";return Kf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Kf(e)}function Xle(e,t){if(Kf(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(Kf(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Qle(e){var t=Xle(e,"string");return Kf(t)=="symbol"?t:t+""}function Si(e,t,n){return(t=Qle(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ED=2147483647;function r5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,s)}return n}function i5(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?r5(Object(n),!0).forEach(function(s){Si(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r5(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}var Zf=2,o5=Zf/2;function Jle(e){return{x:Math.floor(e.x),y:Math.floor(e.y)}}function ece(e){return{x:e.x-o5,y:e.y-o5}}function tce(e){return{x:Math.max(e.x,0),y:Math.max(e.y,0)}}function nce(e){return{x:Math.min(e.x,window.innerWidth-Zf),y:Math.min(e.y,window.innerHeight-Zf)}}function a5(e){var t=e.client,n=nce(tce(ece(Jle(t))));return DOMRect.fromRect({x:n.x,y:n.y,width:Zf,height:Zf})}function l5(e){var t=e.clientRect;return{left:"".concat(t.left,"px"),top:"".concat(t.top,"px"),width:"".concat(t.width,"px"),height:"".concat(t.height,"px")}}function sce(e){var t=e.client,n=e.clientRect;return t.x>=n.x&&t.x<=n.x+n.width&&t.y>=n.y&&t.y<=n.y+n.height}function rce(e){var t=e.initial,n=document.createElement("div");n.setAttribute(TD,"true");var s=a5({client:t});Object.assign(n.style,i5(i5({backgroundColor:"transparent",position:"fixed",padding:0,margin:0,boxSizing:"border-box"},l5({clientRect:s})),{},{pointerEvents:"auto",zIndex:ED})),document.body.appendChild(n);var i=po.bind(window,{type:"pointermove",listener:function(a){var l={x:a.clientX,y:a.clientY};s=a5({client:l}),Object.assign(n.style,l5({clientRect:s}))},options:{capture:!0}});return function(a){var l=a.current;if(i(),sce({client:l,clientRect:s})){n.remove();return}function c(){d(),n.remove()}var d=po.bindAll(window,[{type:"pointerdown",listener:c},{type:"pointermove",listener:c},{type:"focusin",listener:c},{type:"focusout",listener:c},{type:"dragstart",listener:c},{type:"dragenter",listener:c},{type:"dragover",listener:c}],{capture:!0})}}function ice(){var e=null;function t(){return e=null,po.bind(window,{type:"pointermove",listener:function(i){e={x:i.clientX,y:i.clientY}},options:{capture:!0}})}function n(){var s=null;return function(o){var a=o.eventName,l=o.payload;if(a==="onDragStart"){var c,d=l.location.initial.input,h=(c=e)!==null&&c!==void 0?c:{x:d.clientX,y:d.clientY};s=rce({initial:h})}if(a==="onDrop"){var f,p=l.location.current.input;(f=s)===null||f===void 0||f({current:{x:p.clientX,y:p.clientY}}),s=null,e=null}}}return{bindEvents:t,getOnPostDispatch:n}}function oce(e){if(Array.isArray(e))return Q2(e)}function ace(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function lce(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Zy(e){return oce(e)||ace(e)||_D(e)||lce()}function mj(e){var t=null;return function(){if(!t){for(var s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];var a=e.apply(this,i);t={result:a}}return t.result}}var MD=mj(function(){return navigator.userAgent.includes("Firefox")}),fd=mj(function(){var t=navigator,n=t.userAgent;return n.includes("AppleWebKit")&&!n.includes("Chrome")}),V0={isLeavingWindow:Symbol("leaving"),isEnteringWindow:Symbol("entering")};function cce(e){var t=e.dragEnter;return fd()?t.hasOwnProperty(V0.isEnteringWindow):!1}function uce(e){var t=e.dragLeave;return fd()?t.hasOwnProperty(V0.isLeavingWindow):!1}(function(){if(typeof window>"u"||!fd())return;function t(){return{enterCount:0,isOverWindow:!1}}var n=t();function s(){n=t()}po.bindAll(window,[{type:"dragstart",listener:function(){n.enterCount=0,n.isOverWindow=!0}},{type:"drop",listener:s},{type:"dragend",listener:s},{type:"dragenter",listener:function(o){!n.isOverWindow&&n.enterCount===0&&(o[V0.isEnteringWindow]=!0),n.isOverWindow=!0,n.enterCount++}},{type:"dragleave",listener:function(o){n.enterCount--,n.isOverWindow&&n.enterCount===0&&(o[V0.isLeavingWindow]=!0,n.isOverWindow=!1)}}],{capture:!0})})();function dce(e){return"nodeName"in e}function PD(e){return dce(e)&&e.ownerDocument!==document}function hce(e){var t=e.dragLeave,n=t.type,s=t.relatedTarget;return n!=="dragleave"?!1:fd()?uce({dragLeave:t}):s==null?!0:MD()?PD(s):s instanceof HTMLIFrameElement}function yj(e){var t=e.onDragEnd;return[{type:"pointermove",listener:function(){var n=0;return function(){if(n<20){n++;return}t()}}()},{type:"pointerdown",listener:t}]}function wf(e){return{altKey:e.altKey,button:e.button,buttons:e.buttons,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey,clientX:e.clientX,clientY:e.clientY,pageX:e.pageX,pageY:e.pageY}}var fce=function(t){var n=[],s=null,i=function(){for(var a=arguments.length,l=new Array(a),c=0;c<a;c++)l[c]=arguments[c];n=l,!s&&(s=requestAnimationFrame(function(){s=null,t.apply(void 0,n)}))};return i.cancel=function(){s&&(cancelAnimationFrame(s),s=null)},i},Vx=fce(function(e){return e()}),lm=function(){var e=null;function t(s){var i=requestAnimationFrame(function(){e=null,s()});e={frameId:i,fn:s}}function n(){e&&(cancelAnimationFrame(e.frameId),e.fn(),e=null)}return{schedule:t,flush:n}}();function pce(e){var t=e.source,n=e.initial,s=e.dispatchEvent,i={dropTargets:[]};function o(l){s(l),i={dropTargets:l.payload.location.current.dropTargets}}var a={start:function(c){var d=c.nativeSetDragImage,h={current:n,previous:i,initial:n};o({eventName:"onGenerateDragPreview",payload:{source:t,location:h,nativeSetDragImage:d}}),lm.schedule(function(){o({eventName:"onDragStart",payload:{source:t,location:h}})})},dragUpdate:function(c){var d=c.current;lm.flush(),Vx.cancel(),o({eventName:"onDropTargetChange",payload:{source:t,location:{initial:n,previous:i,current:d}}})},drag:function(c){var d=c.current;Vx(function(){lm.flush();var h={initial:n,previous:i,current:d};o({eventName:"onDrag",payload:{source:t,location:h}})})},drop:function(c){var d=c.current,h=c.updatedSourcePayload;lm.flush(),Vx.cancel(),o({eventName:"onDrop",payload:{source:h??t,location:{current:d,previous:i,initial:n}}})}};return a}var J2={isActive:!1};function LD(){return!J2.isActive}function gce(e){return e.dataTransfer?e.dataTransfer.setDragImage.bind(e.dataTransfer):null}function mce(e){var t=e.current,n=e.next;if(t.length!==n.length)return!0;for(var s=0;s<t.length;s++)if(t[s].element!==n[s].element)return!0;return!1}function yce(e){var t=e.event,n=e.dragType,s=e.getDropTargetsOver,i=e.dispatchEvent;if(!LD())return;var o=bce({event:t,dragType:n,getDropTargetsOver:s});J2.isActive=!0;var a={current:o};zx({event:t,current:o.dropTargets});var l=pce({source:n.payload,dispatchEvent:i,initial:o});function c(g){var m=mce({current:a.current.dropTargets,next:g.dropTargets});a.current=g,m&&l.dragUpdate({current:a.current})}function d(g){var m=wf(g),y=AD(g.target)?gj({x:m.clientX,y:m.clientY}):g.target,b=s({target:y,input:m,source:n.payload,current:a.current.dropTargets});b.length&&(g.preventDefault(),zx({event:g,current:b})),c({dropTargets:b,input:m})}function h(){a.current.dropTargets.length&&c({dropTargets:[],input:a.current.input}),l.drop({current:a.current,updatedSourcePayload:null}),f()}function f(){J2.isActive=!1,p()}var p=po.bindAll(window,[{type:"dragover",listener:function(m){d(m),l.drag({current:a.current})}},{type:"dragenter",listener:d},{type:"dragleave",listener:function(m){hce({dragLeave:m})&&(c({input:a.current.input,dropTargets:[]}),n.startedFrom==="external"&&h())}},{type:"drop",listener:function(m){if(a.current={dropTargets:a.current.dropTargets,input:wf(m)},!a.current.dropTargets.length){h();return}m.preventDefault(),zx({event:m,current:a.current.dropTargets}),l.drop({current:a.current,updatedSourcePayload:n.type==="external"?n.getDropPayload(m):null}),f()}},{type:"dragend",listener:function(m){a.current={dropTargets:a.current.dropTargets,input:wf(m)},h()}}].concat(Zy(yj({onDragEnd:h}))),{capture:!0});l.start({nativeSetDragImage:gce(t)})}function zx(e){var t,n=e.event,s=e.current,i=(t=s[0])===null||t===void 0?void 0:t.dropEffect;i!=null&&n.dataTransfer&&(n.dataTransfer.dropEffect=i)}function bce(e){var t=e.event,n=e.dragType,s=e.getDropTargetsOver,i=wf(t);if(n.startedFrom==="external")return{input:i,dropTargets:[]};var o=s({input:i,source:n.payload,target:t.target,current:[]});return{input:i,dropTargets:o}}var c5={canStart:LD,start:yce},eC=new Map;function xce(e){var t=e.typeKey,n=e.mount,s=eC.get(t);if(s)return s.usageCount++,s;var i={typeKey:t,unmount:n(),usageCount:1};return eC.set(t,i),i}function vce(e){var t=xce(e);return function(){t.usageCount--,!(t.usageCount>0)&&(t.unmount(),eC.delete(e.typeKey))}}function DD(e,t){var n=t.attribute,s=t.value;return e.setAttribute(n,s),function(){return e.removeAttribute(n)}}function u5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,s)}return n}function ua(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?u5(Object(n),!0).forEach(function(s){Si(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u5(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function Gx(e,t){var n=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=Cce(e))||t){n&&(e=n);var s=0,i=function(){};return{s:i,n:function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o,a=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var d=n.next();return a=d.done,d},e:function(d){l=!0,o=d},f:function(){try{a||n.return==null||n.return()}finally{if(l)throw o}}}}function Cce(e,t){if(e){if(typeof e=="string")return d5(e,t);var n={}.toString.call(e).slice(8,-1);return n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set"?Array.from(e):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d5(e,t):void 0}}function d5(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=Array(t);n<t;n++)s[n]=e[n];return s}function Hx(e){return e.slice(0).reverse()}function wce(e){var t=e.typeKey,n=e.defaultDropEffect,s=new WeakMap,i="data-drop-target-for-".concat(t),o="[".concat(i,"]");function a(g){return s.set(g.element,g),function(){return s.delete(g.element)}}function l(g){return qn(DD(g.element,{attribute:i,value:"true"}),a(g))}function c(g){var m,y,b,C,x=g.source,v=g.target,w=g.input,S=g.result,j=S===void 0?[]:S;if(v==null)return j;if(!(v instanceof Element))return v instanceof Node?c({source:x,target:v.parentElement,input:w,result:j}):j;var P=v.closest(o);if(P==null)return j;var E=s.get(P);if(E==null)return j;var D={input:w,source:x,element:E.element};if(E.canDrop&&!E.canDrop(D))return c({source:x,target:E.element.parentElement,input:w,result:j});var M=(m=(y=E.getData)===null||y===void 0?void 0:y.call(E,D))!==null&&m!==void 0?m:{},R=(b=(C=E.getDropEffect)===null||C===void 0?void 0:C.call(E,D))!==null&&b!==void 0?b:n,F={data:M,element:E.element,dropEffect:R,isActiveDueToStickiness:!1};return c({source:x,target:E.element.parentElement,input:w,result:[].concat(Zy(j),[F])})}function d(g){var m=g.eventName,y=g.payload,b=Gx(y.location.current.dropTargets),C;try{for(b.s();!(C=b.n()).done;){var x,v=C.value,w=s.get(v.element),S=ua(ua({},y),{},{self:v});w==null||(x=w[m])===null||x===void 0||x.call(w,S)}}catch(j){b.e(j)}finally{b.f()}}var h={onGenerateDragPreview:d,onDrag:d,onDragStart:d,onDrop:d,onDropTargetChange:function(m){var y=m.payload,b=new Set(y.location.current.dropTargets.map(function(z){return z.element})),C=new Set,x=Gx(y.location.previous.dropTargets),v;try{for(x.s();!(v=x.n()).done;){var w,S=v.value;C.add(S.element);var j=s.get(S.element),P=b.has(S.element),E=ua(ua({},y),{},{self:S});if(j==null||(w=j.onDropTargetChange)===null||w===void 0||w.call(j,E),!P){var D;j==null||(D=j.onDragLeave)===null||D===void 0||D.call(j,E)}}}catch(z){x.e(z)}finally{x.f()}var M=Gx(y.location.current.dropTargets),R;try{for(M.s();!(R=M.n()).done;){var F,_,L=R.value;if(!C.has(L.element)){var O=ua(ua({},y),{},{self:L}),B=s.get(L.element);B==null||(F=B.onDropTargetChange)===null||F===void 0||F.call(B,O),B==null||(_=B.onDragEnter)===null||_===void 0||_.call(B,O)}}}catch(z){M.e(z)}finally{M.f()}}};function f(g){h[g.eventName](g)}function p(g){var m=g.source,y=g.target,b=g.input,C=g.current,x=c({source:m,target:y,input:b});if(x.length>=C.length)return x;for(var v=Hx(C),w=Hx(x),S=[],j=0;j<v.length;j++){var P,E=v[j],D=w[j];if(D!=null){S.push(D);continue}var M=S[j-1],R=v[j-1];if((M==null?void 0:M.element)!==(R==null?void 0:R.element))break;var F=s.get(E.element);if(!F)break;var _={input:b,source:m,element:F.element};if(F.canDrop&&!F.canDrop(_)||!((P=F.getIsSticky)!==null&&P!==void 0&&P.call(F,_)))break;S.push(ua(ua({},E),{},{isActiveDueToStickiness:!0}))}return Hx(S)}return{dropTargetForConsumers:l,getIsOver:p,dispatchEvent:f}}function Sce(e,t){var n=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=jce(e))||t){n&&(e=n);var s=0,i=function(){};return{s:i,n:function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o,a=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var d=n.next();return a=d.done,d},e:function(d){l=!0,o=d},f:function(){try{a||n.return==null||n.return()}finally{if(l)throw o}}}}function jce(e,t){if(e){if(typeof e=="string")return h5(e,t);var n={}.toString.call(e).slice(8,-1);return n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set"?Array.from(e):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?h5(e,t):void 0}}function h5(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=Array(t);n<t;n++)s[n]=e[n];return s}function f5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,s)}return n}function kce(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?f5(Object(n),!0).forEach(function(s){Si(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f5(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function _ce(){var e=new Set,t=null;function n(o){t&&(!o.canMonitor||o.canMonitor(t.canMonitorArgs))&&t.active.add(o)}function s(o){var a=kce({},o);return e.add(a),n(a),function(){e.delete(a),t&&t.active.delete(a)}}function i(o){var a=o.eventName,l=o.payload;if(a==="onGenerateDragPreview"){t={canMonitorArgs:{initial:l.location.initial,source:l.source},active:new Set};var c=Sce(e),d;try{for(c.s();!(d=c.n()).done;){var h=d.value;n(h)}}catch(b){c.e(b)}finally{c.f()}}if(t){for(var f=Array.from(t.active),p=0,g=f;p<g.length;p++){var m=g[p];if(t.active.has(m)){var y;(y=m[a])===null||y===void 0||y.call(m,l)}}a==="onDrop"&&(t.active.clear(),t=null)}}return{dispatchEvent:i,monitorForConsumers:s}}function RD(e){var t=e.typeKey,n=e.mount,s=e.dispatchEventToSource,i=e.onPostDispatch,o=e.defaultDropEffect,a=_ce(),l=wce({typeKey:t,defaultDropEffect:o});function c(f){s==null||s(f),l.dispatchEvent(f),a.dispatchEvent(f),i==null||i(f)}function d(f){var p=f.event,g=f.dragType;c5.start({event:p,dragType:g,getDropTargetsOver:l.getIsOver,dispatchEvent:c})}function h(){function f(){var p={canStart:c5.canStart,start:d};return n(p)}return vce({typeKey:t,mount:f})}return{registerUsage:h,dropTarget:l.dropTargetForConsumers,monitor:a.monitorForConsumers}}var Ice=mj(function(){return navigator.userAgent.toLocaleLowerCase().includes("android")}),OD="pdnd:android-fallback",tC="text/plain",Tce="text/uri-list",ND="application/vnd.pdnd",z0=new WeakMap;function Ace(e){return z0.set(e.element,e),function(){z0.delete(e.element)}}var p5=ice(),bj=RD({typeKey:"element",defaultDropEffect:"move",mount:function(t){return qn(p5.bindEvents(),po.bind(document,{type:"dragstart",listener:function(s){var i,o,a,l,c,d;if(t.canStart(s)&&!s.defaultPrevented&&s.dataTransfer){var h=s.target;if(!(h instanceof HTMLElement))return null;var f=z0.get(h);if(!f)return null;var p=wf(s),g={element:f.element,dragHandle:(i=f.dragHandle)!==null&&i!==void 0?i:null,input:p};if(f.canDrag&&!f.canDrag(g))return s.preventDefault(),null;if(f.dragHandle){var m=gj({x:p.clientX,y:p.clientY});if(!f.dragHandle.contains(m))return s.preventDefault(),null}var y=(o=(a=f.getInitialDataForExternal)===null||a===void 0?void 0:a.call(f,g))!==null&&o!==void 0?o:null;if(y)for(var b=0,C=Object.entries(y);b<C.length;b++){var x=pj(C[b],2),v=x[0],w=x[1];s.dataTransfer.setData(v,w??"")}Ice()&&!s.dataTransfer.types.includes(tC)&&!s.dataTransfer.types.includes(Tce)&&s.dataTransfer.setData(tC,OD),s.dataTransfer.setData(ND,"");var S={element:f.element,dragHandle:(l=f.dragHandle)!==null&&l!==void 0?l:null,data:(c=(d=f.getInitialData)===null||d===void 0?void 0:d.call(f,g))!==null&&c!==void 0?c:{}},j={type:"element",payload:S,startedFrom:"internal"};t.start({event:s,dragType:j})}}}))},dispatchEventToSource:function(t){var n,s,i=t.eventName,o=t.payload;(n=z0.get(o.source.element))===null||n===void 0||(s=n[i])===null||s===void 0||s.call(n,o)},onPostDispatch:p5.getOnPostDispatch()}),Bu=bj.dropTarget,to=bj.monitor;function pd(e){return qn(bj.registerUsage(),Ace(e),DD(e.element,{attribute:"draggable",value:"true"}))}var Yf=new Map,a0=new Set;function FD(e){Ece(e);var t=Yf.get(e);if(t)return t;var n={timeOfEngagementStart:Date.now()};return Yf.set(e,n),n}function Ece(e){a0.add(e)}function Mce(e){a0.clear(),e(),Yf.forEach(function(t,n){a0.has(n)||Yf.delete(n)}),a0.clear()}function Pce(){Yf.clear()}var g5=new Map;function Lce(e){var t=g5.get(e);if(t)return t;var n=Dce(e);return g5.set(e,n),n}function Dce(e){var t={type:"idle"},n=[];function s(c){if(t.type==="running"){var d=c-t.timeLastFrameFinished,h=t,f=h.latestArgs,p=gj({x:f.location.current.input.clientX,y:f.location.current.input.clientY});Mce(function(){n.forEach(function(g){return g({underUsersPointer:p,latestArgs:f,timeSinceLastFrame:d})})}),t.timeLastFrameFinished=c,t.frameId=requestAnimationFrame(s)}}function i(){t.type!=="idle"&&(cancelAnimationFrame(t.frameId),Pce(),t={type:"idle"})}function o(c){t.type==="idle"&&(t={type:"initializing",latestArgs:c,frameId:requestAnimationFrame(function(d){t.type==="initializing"&&(t={type:"running",timeLastFrameFinished:d,latestArgs:t.latestArgs,frameId:requestAnimationFrame(s)})})})}function a(c){if(t.type==="idle"){o(c);return}t.latestArgs=c}e({onDragStart:o,onDropTargetChange:a,onDrag:a,onDrop:i});var l={onFrame:function(d){n.push(d)}};return l}var nC="data-auto-scrollable",Rce="[".concat(nC,'="true"]');function Oce(e){return e.setAttribute(nC,"true"),function(){return e.removeAttribute(nC)}}function m5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,s)}return n}function y5(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?m5(Object(n),!0).forEach(function(s){Si(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m5(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}var Nce={startHitboxAtPercentageRemainingOfElement:{top:.25,right:.25,bottom:.25,left:.25},maxScrollAtPercentageRemainingOfHitbox:{top:.5,right:.5,bottom:.5,left:.5},timeDampeningDurationMs:300,maxMainAxisHitboxSize:180},Fce={standard:15*60,fast:25*60};function BD(e){var t;return y5(y5({},Nce),{},{maxPixelScrollPerSecond:Fce[(t=e==null?void 0:e.maxScrollSpeed)!==null&&t!==void 0?t:"standard"]})}var Bce={top:function(t){return t.scrollTop>0},right:function(t){return Math.ceil(t.scrollLeft)+t.clientWidth<t.scrollWidth},bottom:function(t){return Math.ceil(t.scrollTop)+t.clientHeight<t.scrollHeight},left:function(t){return t.scrollLeft>0}},$ce=["top","right","bottom","left"],Vce={top:"vertical",right:"horizontal",bottom:"vertical",left:"horizontal"},b5={start:"top",end:"bottom",point:"y",size:"height"},x5={start:"left",end:"right",point:"x",size:"width"},$D={vertical:{mainAxis:b5,crossAxis:x5},horizontal:{mainAxis:x5,crossAxis:b5}},xj={top:"start",right:"end",bottom:"end",left:"start"};function cm(e){var t=e.edge,n=e.axis;return function(i){var o,a=i.clientRect,l=i.config,c=$D[n],d=c.mainAxis,h=c.crossAxis,f=xj[t],p=Math.min(l.startHitboxAtPercentageRemainingOfElement[t]*a[d.size],l.maxMainAxisHitboxSize);return DOMRect.fromRect((o={},Si(o,d.point,f==="start"?a[d.point]:a[d.point]+a[d.size]-p),Si(o,h.point,a[h.point]),Si(o,d.size,p),Si(o,h.size,a[h.size]),o))}}var zce={top:cm({axis:"vertical",edge:"top"}),right:cm({axis:"horizontal",edge:"right"}),bottom:cm({axis:"vertical",edge:"bottom"}),left:cm({axis:"horizontal",edge:"left"})};function sC(e){var t=e.startOfRange,n=e.endOfRange,s=e.value,i=t<n;if(!i||s<t)return 0;if(s>n)return 1;var o=n-t;return(s-t)/o}function Gce(e){var t=e.timeSinceLastFrame,n=e.config,s=n.maxPixelScrollPerSecond/1e3,i=Math.ceil(s*t),o=n.maxPixelScrollPerSecond/60;return Math.min(i,o)}function Hce(e){var t=e.client,n=e.axis,s=e.edge,i=e.hitbox,o=e.config,a=$D[n].mainAxis,l=xj[s],c=i[a.size]*o.maxScrollAtPercentageRemainingOfHitbox[s];if(l==="end")return sC({startOfRange:i[a.start],endOfRange:i[a.end]-c,value:t[a.point]});var d=sC({startOfRange:i[a.start]+c,endOfRange:i[a.end],value:t[a.point]});return 1-d}function um(e){var t=e.client,n=e.timeSinceLastFrame,s=e.engagement,i=e.axis,o=e.hitbox,a=e.edge,l=e.isDistanceDampeningEnabled,c=e.config,d=Gce({timeSinceLastFrame:n,config:c}),h=l?Hce({client:t,edge:a,hitbox:o,axis:i,config:c}):1,f=sC({startOfRange:s.timeOfEngagementStart,endOfRange:s.timeOfEngagementStart+c.timeDampeningDurationMs,value:Date.now()}),p=h*f,g=Math.max(d*p,1),m=xj[a];return m==="end"?g:-1*g}function Wce(e,t){return t==="all"||e===t}function Uce(e){var t=e.client,n=e.clientRect;return t.x>=n.x&&t.x<=n.x+n.width&&t.y>=n.y&&t.y<=n.y+n.height}function qce(e){return e.getBoundingClientRect()}function VD(e){var t=e.element,n=e.input,s=e.timeSinceLastFrame,i=e.engagement,o=e.config,a=e.allowedAxis,l=e.getRect,c=l===void 0?qce:l,d={x:n.clientX,y:n.clientY},h=c(t),f=$ce.reduce(function(m,y){var b=zce[y]({clientRect:h,config:o}),C=Vce[y];return!Wce(C,a)||!Uce({client:d,clientRect:b})||!Bce[y](t)||m.set(y,{edge:y,hitbox:b}),m},new Map),p=function(){var m="horizontal",y=f.get("left");if(y)return um({client:d,edge:y.edge,hitbox:y.hitbox,axis:m,timeSinceLastFrame:s,engagement:i,isDistanceDampeningEnabled:!0,config:o});var b=f.get("right");return b?um({client:d,edge:b.edge,hitbox:b.hitbox,axis:m,timeSinceLastFrame:s,engagement:i,isDistanceDampeningEnabled:!0,config:o}):0}(),g=function(){var m="vertical",y=f.get("bottom");if(y)return um({client:d,edge:y.edge,hitbox:y.hitbox,axis:m,timeSinceLastFrame:s,engagement:i,isDistanceDampeningEnabled:!0,config:o});var b=f.get("top");return b?um({client:d,edge:b.edge,hitbox:b.hitbox,axis:m,timeSinceLastFrame:s,engagement:i,isDistanceDampeningEnabled:!0,config:o}):0}();return{left:p,top:g}}function Kce(e,t){var n=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=Zce(e))||t){n&&(e=n);var s=0,i=function(){};return{s:i,n:function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,l;return{s:function(){n=n.call(e)},n:function(){var d=n.next();return o=d.done,d},e:function(d){a=!0,l=d},f:function(){try{!o&&n.return!=null&&n.return()}finally{if(a)throw l}}}}function Zce(e,t){if(e){if(typeof e=="string")return v5(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return v5(e,t)}}function v5(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}function zD(e){return!!(e.top||e.left)}function GD(e){var t,n,s,i=e.target,o=e.input,a=e.source,l=e.findEntry,c=e.timeSinceLastFrame,d=e.available,h=d===void 0?{top:!0,left:!0}:d;if(!zD(h)||!i)return h;var f=i.closest(Rce);if(!f)return h;var p=l(f);if(!p)return h;function g(){var w;return GD({target:(w=f==null?void 0:f.parentElement)!==null&&w!==void 0?w:null,findEntry:l,source:a,timeSinceLastFrame:c,input:o,available:h})}var m={input:o,source:a,element:f};if(p.canScroll&&!p.canScroll(m))return g();var y=FD(f),b=BD((t=p.getConfiguration)===null||t===void 0?void 0:t.call(p,m)),C=(n=(s=p.getAllowedAxis)===null||s===void 0?void 0:s.call(p,m))!==null&&n!==void 0?n:"all",x=VD({element:f,engagement:y,input:o,timeSinceLastFrame:c,allowedAxis:C,config:b}),v={top:0,left:0};return h.top&&x.top!==0&&(v.top=x.top,h.top=!1),h.left&&x.left!==0&&(v.left=x.left,h.left=!1),(v.top!==0||v.left!==0)&&f.scrollBy(v),g()}function Yce(e){var t=e.input,n=e.timeSinceLastFrame,s=e.available,i=e.source,o=e.entries,a=document.documentElement,l={input:t,source:i,element:a},c=Kce(o),d;try{for(c.s();!(d=c.n()).done;){var h,f,p,g=d.value;if(!(g.canScroll&&!g.canScroll(l))){var m=FD(a),y=BD((h=g.getConfiguration)===null||h===void 0?void 0:h.call(g,l)),b=(f=(p=g.getAllowedAxis)===null||p===void 0?void 0:p.call(g,l))!==null&&f!==void 0?f:"all",C=VD({element:a,engagement:m,input:t,config:y,allowedAxis:b,getRect:function(w){return DOMRect.fromRect({y:0,x:0,width:w.clientWidth,height:w.clientHeight})},timeSinceLastFrame:n}),x={top:s.top?C.top:0,left:s.left?C.left:0};(x.top!==0||x.left!==0)&&a.scrollBy(x);break}}}catch(v){c.e(v)}finally{c.f()}}function Xce(e){var t=e.input,n=e.findEntry,s=e.timeSinceLastFrame,i=e.source,o=e.getWindowScrollEntries,a=e.underUsersPointer,l=GD({target:a,timeSinceLastFrame:s,input:t,source:i,findEntry:n});zD(l)&&Yce({input:t,source:i,entries:o(),timeSinceLastFrame:s,available:l})}function C5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,s)}return n}function Qce(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?C5(Object(n),!0).forEach(function(s){Si(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C5(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function HD(e){var t=e.monitor,n=new Map,s=new Set;function i(d){return n.set(d.element,d),qn(Oce(d.element),function(){return n.delete(d.element)})}function o(){var d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},h=Qce({},d);return s.add(h),function(){return s.delete(h)}}function a(d){var h;return(h=n.get(d))!==null&&h!==void 0?h:null}function l(){return Array.from(s)}function c(d){var h=d.latestArgs,f=d.underUsersPointer,p=d.timeSinceLastFrame;Xce({input:h.location.current.input,source:h.source,findEntry:a,underUsersPointer:f,timeSinceLastFrame:p,getWindowScrollEntries:l})}return Lce(t).onFrame(c),{autoScroll:i,autoScrollWindow:o}}var Jce=HD({monitor:to}),vj=Jce.autoScroll;function eue(e){var t=e.dragEnter,n=t.type,s=t.relatedTarget;return n!=="dragenter"?!1:fd()?cce({dragEnter:t}):s==null?!0:MD()?PD(s):s instanceof HTMLIFrameElement}function Cj(e){var t=e.type,n=e.value;return!(t===ND||t===tC&&n===OD)}function tue(e){return Array.from(e.types).filter(function(t){return Cj({type:t,value:e.getData(t)})})}function nue(e){return Array.from(e.items).filter(function(t){return t.kind==="file"||Cj({type:t.type,value:e.getData(t.type)})})}var rC=!1,wj=RD({typeKey:"external",defaultDropEffect:"copy",mount:function(t){return po.bind(window,{type:"dragenter",listener:function(s){if(!rC&&s.dataTransfer&&t.canStart(s)&&eue({dragEnter:s})){var i=tue(s.dataTransfer);if(i.length){var o={types:i,items:[],getStringData:function(){return null}};t.start({event:s,dragType:{type:"external",startedFrom:"external",payload:o,getDropPayload:function(l){if(!l.dataTransfer)return o;var c=nue(l.dataTransfer),d=l.dataTransfer.getData.bind(l.dataTransfer);return{types:i,items:c,getStringData:function(f){if(!i.includes(f))return null;var p=d(f);return Cj({type:f,value:p})?p:null}}}}})}}}})}});function iC(e){return wj.dropTarget(e)}function Sf(e){return wj.monitor(e)}(function(){if(typeof window>"u")return;wj.registerUsage();var t={type:"idle"},n=t;function s(){n.type==="dragging"&&(rC=!1,n.cleanup(),n=t)}function i(){return po.bindAll(window,[{type:"dragend",listener:s}].concat(Zy(yj({onDragEnd:s}))),{capture:!0})}po.bind(window,{type:"dragstart",listener:function(){n.type==="idle"&&(rC=!0,n={type:"dragging",cleanup:i()})},options:{capture:!0}})})();var sue=HD({monitor:Sf}),WD=sue.autoScroll;/*!
 * OverlayScrollbars
 * Version: 2.10.0
 *
 * Copyright (c) Rene Haas | KingSora.
 * https://github.com/KingSora
 *
 * Released under the MIT license.
 */const mr=(e,t)=>{const{o:n,i:s,u:i}=e;let o=n,a;const l=(h,f)=>{const p=o,g=h,m=f||(s?!s(p,g):p!==g);return(m||i)&&(o=g,a=p),[o,m,a]};return[t?h=>l(t(o,a),h):l,h=>[o,!!h,a]]},rue=typeof window<"u"&&typeof HTMLElement<"u"&&!!window.document,nr=rue?window:{},G0=Math.max,iue=Math.min,oC=Math.round,H0=Math.abs,w5=Math.sign,Sj=nr.cancelAnimationFrame,Yy=nr.requestAnimationFrame,W0=nr.setTimeout,aC=nr.clearTimeout,Xy=e=>typeof nr[e]<"u"?nr[e]:void 0,oue=Xy("MutationObserver"),S5=Xy("IntersectionObserver"),U0=Xy("ResizeObserver"),l0=Xy("ScrollTimeline"),jj=e=>e===void 0,Qy=e=>e===null,no=e=>typeof e=="number",rg=e=>typeof e=="string",kj=e=>typeof e=="boolean",Er=e=>typeof e=="function",go=e=>Array.isArray(e),q0=e=>typeof e=="object"&&!go(e)&&!Qy(e),_j=e=>{const t=!!e&&e.length,n=no(t)&&t>-1&&t%1==0;return go(e)||!Er(e)&&n?t>0&&q0(e)?t-1 in e:!0:!1},K0=e=>!!e&&e.constructor===Object,Z0=e=>e instanceof HTMLElement,Jy=e=>e instanceof Element,j5=()=>performance.now(),Wx=(e,t,n,s,i)=>{let o=0;const a=j5(),l=G0(0,n),c=d=>{const h=j5(),p=h-a>=l,g=d?1:1-(G0(0,a+l-h)/l||0),m=(t-e)*(Er(i)?i(g,g*l,0,1,l):g)+e,y=p||g===1;s&&s(m,g,y),o=y?0:Yy(()=>c())};return c(),d=>{Sj(o),d&&c(d)}};function Kt(e,t){if(_j(e))for(let n=0;n<e.length&&t(e[n],n,e)!==!1;n++);else e&&Kt(Object.keys(e),n=>t(e[n],n,e));return e}const UD=(e,t)=>e.indexOf(t)>=0,Xf=(e,t)=>e.concat(t),Cn=(e,t,n)=>(!rg(t)&&_j(t)?Array.prototype.push.apply(e,t):e.push(t),e),sl=e=>Array.from(e||[]),Ij=e=>go(e)?e:!rg(e)&&_j(e)?sl(e):[e],lC=e=>!!e&&!e.length,cC=e=>sl(new Set(e)),kr=(e,t,n)=>{Kt(e,i=>i?i.apply(void 0,t||[]):!0),!n&&(e.length=0)},qD="paddingTop",KD="paddingRight",ZD="paddingLeft",YD="paddingBottom",XD="marginLeft",QD="marginRight",JD="marginBottom",eR="overflowX",tR="overflowY",eb="width",tb="height",wa="visible",El="hidden",$u="scroll",aue=e=>{const t=String(e||"");return t?t[0].toUpperCase()+t.slice(1):""},nb=(e,t,n,s)=>{if(e&&t){let i=!0;return Kt(n,o=>{const a=e[o],l=t[o];a!==l&&(i=!1)}),i}return!1},nR=(e,t)=>nb(e,t,["w","h"]),c0=(e,t)=>nb(e,t,["x","y"]),lue=(e,t)=>nb(e,t,["t","r","b","l"]),Na=()=>{},at=(e,...t)=>e.bind(0,...t),Ml=e=>{let t;const n=e?W0:Yy,s=e?aC:Sj;return[i=>{s(t),t=n(()=>i(),Er(e)?e():e)},()=>s(t)]},uC=(e,t)=>{const{_:n,v:s,p:i,S:o}=t||{};let a,l,c,d,h=Na;const f=function(b){h(),aC(a),d=a=l=void 0,h=Na,e.apply(this,b)},p=y=>o&&l?o(l,y):y,g=()=>{h!==Na&&f(p(c)||c)},m=function(){const b=sl(arguments),C=Er(n)?n():n;if(no(C)&&C>=0){const v=Er(s)?s():s,w=no(v)&&v>=0,S=C>0?W0:Yy,j=C>0?aC:Sj,E=p(b)||b,D=f.bind(0,E);let M;h(),i&&!d?(D(),d=!0,M=S(()=>d=void 0,C)):(M=S(D,C),w&&!a&&(a=W0(g,v))),h=()=>j(M),l=c=E}else f(b)};return m.m=g,m},sR=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),Ti=e=>e?Object.keys(e):[],Dt=(e,t,n,s,i,o,a)=>{const l=[t,n,s,i,o,a];return(typeof e!="object"||Qy(e))&&!Er(e)&&(e={}),Kt(l,c=>{Kt(c,(d,h)=>{const f=c[h];if(e===f)return!0;const p=go(f);if(f&&K0(f)){const g=e[h];let m=g;p&&!go(g)?m=[]:!p&&!K0(g)&&(m={}),e[h]=Dt(m,f)}else e[h]=p?f.slice():f})}),e},rR=(e,t)=>Kt(Dt({},e),(n,s,i)=>{n===void 0?delete i[s]:n&&K0(n)&&(i[s]=rR(n))}),Tj=e=>!Ti(e).length,iR=(e,t,n)=>G0(e,iue(t,n)),Vl=e=>cC((go(e)?e:(e||"").split(" ")).filter(t=>t)),Aj=(e,t)=>e&&e.getAttribute(t),k5=(e,t)=>e&&e.hasAttribute(t),Do=(e,t,n)=>{Kt(Vl(t),s=>{e&&e.setAttribute(s,String(n||""))})},Vi=(e,t)=>{Kt(Vl(t),n=>e&&e.removeAttribute(n))},sb=(e,t)=>{const n=Vl(Aj(e,t)),s=at(Do,e,t),i=(o,a)=>{const l=new Set(n);return Kt(Vl(o),c=>{l[a](c)}),sl(l).join(" ")};return{O:o=>s(i(o,"delete")),$:o=>s(i(o,"add")),C:o=>{const a=Vl(o);return a.reduce((l,c)=>l&&n.includes(c),a.length>0)}}},oR=(e,t,n)=>(sb(e,t).O(n),at(Ej,e,t,n)),Ej=(e,t,n)=>(sb(e,t).$(n),at(oR,e,t,n)),Y0=(e,t,n,s)=>(s?Ej:oR)(e,t,n),Mj=(e,t,n)=>sb(e,t).C(n),aR=e=>sb(e,"class"),lR=(e,t)=>{aR(e).O(t)},Pj=(e,t)=>(aR(e).$(t),at(lR,e,t)),cR=(e,t)=>{const n=t?Jy(t)&&t:document;return n?sl(n.querySelectorAll(e)):[]},cue=(e,t)=>{const n=t?Jy(t)&&t:document;return n&&n.querySelector(e)},dC=(e,t)=>Jy(e)&&e.matches(t),uR=e=>dC(e,"body"),hC=e=>e?sl(e.childNodes):[],Qf=e=>e&&e.parentElement,lu=(e,t)=>Jy(e)&&e.closest(t),fC=e=>document.activeElement,uue=(e,t,n)=>{const s=lu(e,t),i=e&&cue(n,s),o=lu(i,t)===s;return s&&i?s===e||i===e||o&&lu(lu(e,n),t)!==s:!1},Vu=e=>{Kt(Ij(e),t=>{const n=Qf(t);t&&n&&n.removeChild(t)})},vr=(e,t)=>at(Vu,e&&t&&Kt(Ij(t),n=>{n&&e.appendChild(n)})),Su=e=>{const t=document.createElement("div");return Do(t,"class",e),t},dR=e=>{const t=Su();return t.innerHTML=e.trim(),Kt(hC(t),n=>Vu(n))},_5=(e,t)=>e.getPropertyValue(t)||e[t]||"",hR=e=>{const t=e||0;return isFinite(t)?t:0},dm=e=>hR(parseFloat(e||"")),pC=e=>Math.round(e*1e4)/1e4,fR=e=>`${pC(hR(e))}px`;function Jf(e,t){e&&t&&Kt(t,(n,s)=>{try{const i=e.style,o=Qy(n)||kj(n)?"":no(n)?fR(n):n;s.indexOf("--")===0?i.setProperty(s,o):i[s]=o}catch{}})}function Qo(e,t,n){const s=rg(t);let i=s?"":{};if(e){const o=nr.getComputedStyle(e,n)||e.style;i=s?_5(o,t):sl(t).reduce((a,l)=>(a[l]=_5(o,l),a),i)}return i}const I5=(e,t,n)=>{const s=t?`${t}-`:"",i=n?`-${n}`:"",o=`${s}top${i}`,a=`${s}right${i}`,l=`${s}bottom${i}`,c=`${s}left${i}`,d=Qo(e,[o,a,l,c]);return{t:dm(d[o]),r:dm(d[a]),b:dm(d[l]),l:dm(d[c])}},due=(e,t)=>`translate${q0(e)?`(${e.x},${e.y})`:`Y(${e})`}`,hue=e=>!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length),fue={w:0,h:0},rb=(e,t)=>t?{w:t[`${e}Width`],h:t[`${e}Height`]}:fue,pue=e=>rb("inner",e||nr),ju=at(rb,"offset"),pR=at(rb,"client"),X0=at(rb,"scroll"),Lj=e=>{const t=parseFloat(Qo(e,eb))||0,n=parseFloat(Qo(e,tb))||0;return{w:t-oC(t),h:n-oC(n)}},Ux=e=>e.getBoundingClientRect(),gue=e=>!!e&&hue(e),gC=e=>!!(e&&(e[tb]||e[eb])),gR=(e,t)=>{const n=gC(e);return!gC(t)&&n},T5=(e,t,n,s)=>{Kt(Vl(t),i=>{e&&e.removeEventListener(i,n,s)})},gn=(e,t,n,s)=>{var i;const o=(i=s&&s.H)!=null?i:!0,a=s&&s.I||!1,l=s&&s.A||!1,c={passive:o,capture:a};return at(kr,Vl(t).map(d=>{const h=l?f=>{T5(e,d,h,a),n&&n(f)}:n;return e&&e.addEventListener(d,h,c),at(T5,e,d,h,a)}))},mR=e=>e.stopPropagation(),mC=e=>e.preventDefault(),yR=e=>mR(e)||mC(e),Xi=(e,t)=>{const{x:n,y:s}=no(t)?{x:t,y:t}:t||{};no(n)&&(e.scrollLeft=n),no(s)&&(e.scrollTop=s)},Cr=e=>({x:e.scrollLeft,y:e.scrollTop}),bR=()=>({D:{x:0,y:0},M:{x:0,y:0}}),mue=(e,t)=>{const{D:n,M:s}=e,{w:i,h:o}=t,a=(f,p,g)=>{let m=w5(f)*g,y=w5(p)*g;if(m===y){const b=H0(f),C=H0(p);y=b>C?0:y,m=b<C?0:m}return m=m===y?0:m,[m+0,y+0]},[l,c]=a(n.x,s.x,i),[d,h]=a(n.y,s.y,o);return{D:{x:l,y:d},M:{x:c,y:h}}},A5=({D:e,M:t})=>{const n=(s,i)=>s===0&&s<=i;return{x:n(e.x,t.x),y:n(e.y,t.y)}},E5=({D:e,M:t},n)=>{const s=(i,o,a)=>iR(0,1,(i-a)/(i-o)||0);return{x:s(e.x,t.x,n.x),y:s(e.y,t.y,n.y)}},yC=e=>{e&&e.focus&&e.focus({preventScroll:!0})},M5=(e,t)=>{Kt(Ij(t),e)},bC=e=>{const t=new Map,n=(o,a)=>{if(o){const l=t.get(o);M5(c=>{l&&l[c?"delete":"clear"](c)},a)}else t.forEach(l=>{l.clear()}),t.clear()},s=(o,a)=>{if(rg(o)){const d=t.get(o)||new Set;return t.set(o,d),M5(h=>{Er(h)&&d.add(h)},a),at(n,o,a)}kj(a)&&a&&n();const l=Ti(o),c=[];return Kt(l,d=>{const h=o[d];h&&Cn(c,s(d,h))}),at(kr,c)},i=(o,a)=>{Kt(sl(t.get(o)),l=>{a&&!lC(a)?l.apply(0,a):l()})};return s(e||{}),[s,n,i]},P5=e=>JSON.stringify(e,(t,n)=>{if(Er(n))throw 0;return n}),L5=(e,t)=>e?`${t}`.split(".").reduce((n,s)=>n&&sR(n,s)?n[s]:void 0,e):void 0,yue={paddingAbsolute:!1,showNativeOverlaidScrollbars:!1,update:{elementEvents:[["img","load"]],debounce:[0,33],attributes:null,ignoreMutation:null},overflow:{x:"scroll",y:"scroll"},scrollbars:{theme:"os-theme-dark",visibility:"auto",autoHide:"never",autoHideDelay:1300,autoHideSuspend:!1,dragScroll:!0,clickScroll:!1,pointers:["mouse","touch","pen"]}},xR=(e,t)=>{const n={},s=Xf(Ti(t),Ti(e));return Kt(s,i=>{const o=e[i],a=t[i];if(q0(o)&&q0(a))Dt(n[i]={},xR(o,a)),Tj(n[i])&&delete n[i];else if(sR(t,i)&&a!==o){let l=!0;if(go(o)||go(a))try{P5(o)===P5(a)&&(l=!1)}catch{}l&&(n[i]=a)}}),n},D5=(e,t,n)=>s=>[L5(e,s),n||L5(t,s)!==void 0],gd="data-overlayscrollbars",u0="os-environment",hm=`${u0}-scrollbar-hidden`,qx=`${gd}-initialize`,d0="noClipping",R5=`${gd}-body`,Fa=gd,bue="host",Ro=`${gd}-viewport`,xue=eR,vue=tR,Cue="arrange",vR="measuring",wue="scrolling",CR="scrollbarHidden",Sue="noContent",xC=`${gd}-padding`,O5=`${gd}-content`,Dj="os-size-observer",jue=`${Dj}-appear`,kue=`${Dj}-listener`,_ue="os-trinsic-observer",Iue="os-theme-none",Nr="os-scrollbar",Tue=`${Nr}-rtl`,Aue=`${Nr}-horizontal`,Eue=`${Nr}-vertical`,wR=`${Nr}-track`,Rj=`${Nr}-handle`,Mue=`${Nr}-visible`,Pue=`${Nr}-cornerless`,N5=`${Nr}-interaction`,F5=`${Nr}-unusable`,vC=`${Nr}-auto-hide`,B5=`${vC}-hidden`,$5=`${Nr}-wheel`,Lue=`${wR}-interactive`,Due=`${Rj}-interactive`;let SR;const Rue=()=>SR,Oue=e=>{SR=e};let Kx;const Nue=()=>{const e=(w,S,j)=>{vr(document.body,w),vr(document.body,w);const P=pR(w),E=ju(w),D=Lj(S);return j&&Vu(w),{x:E.h-P.h+D.h,y:E.w-P.w+D.w}},t=w=>{let S=!1;const j=Pj(w,hm);try{S=Qo(w,"scrollbar-width")==="none"||Qo(w,"display","::-webkit-scrollbar")==="none"}catch{}return j(),S},n=`.${u0}{scroll-behavior:auto!important;position:fixed;opacity:0;visibility:hidden;overflow:scroll;height:200px;width:200px;z-index:-1}.${u0} div{width:200%;height:200%;margin:10px 0}.${hm}{scrollbar-width:none!important}.${hm}::-webkit-scrollbar,.${hm}::-webkit-scrollbar-corner{appearance:none!important;display:none!important;width:0!important;height:0!important}`,i=dR(`<div class="${u0}"><div></div><style>${n}</style></div>`)[0],o=i.firstChild,a=i.lastChild,l=Rue();l&&(a.nonce=l);const[c,,d]=bC(),[h,f]=mr({o:e(i,o),i:c0},at(e,i,o,!0)),[p]=f(),g=t(i),m={x:p.x===0,y:p.y===0},y={elements:{host:null,padding:!g,viewport:w=>g&&uR(w)&&w,content:!1},scrollbars:{slot:!0},cancel:{nativeScrollbarsOverlaid:!1,body:null}},b=Dt({},yue),C=at(Dt,{},b),x=at(Dt,{},y),v={T:p,k:m,R:g,V:!!l0,L:at(c,"r"),U:x,P:w=>Dt(y,w)&&x(),N:C,q:w=>Dt(b,w)&&C(),B:Dt({},y),F:Dt({},b)};if(Vi(i,"style"),Vu(i),gn(nr,"resize",()=>{d("r",[])}),Er(nr.matchMedia)&&!g&&(!m.x||!m.y)){const w=S=>{const j=nr.matchMedia(`(resolution: ${nr.devicePixelRatio}dppx)`);gn(j,"change",()=>{S(),w(S)},{A:!0})};w(()=>{const[S,j]=h();Dt(v.T,S),d("r",[j])})}return v},So=()=>(Kx||(Kx=Nue()),Kx),jR=(e,t)=>Er(t)?t.apply(0,e):t,Fue=(e,t,n,s)=>{const i=jj(s)?n:s;return jR(e,i)||t.apply(0,e)},kR=(e,t,n,s)=>{const i=jj(s)?n:s,o=jR(e,i);return!!o&&(Z0(o)?o:t.apply(0,e))},Bue=(e,t)=>{const{nativeScrollbarsOverlaid:n,body:s}=t||{},{k:i,R:o,U:a}=So(),{nativeScrollbarsOverlaid:l,body:c}=a().cancel,d=n??l,h=jj(s)?c:s,f=(i.x||i.y)&&d,p=e&&(Qy(h)?!o:h);return!!f||!!p},Oj=new WeakMap,$ue=(e,t)=>{Oj.set(e,t)},Vue=e=>{Oj.delete(e)},_R=e=>Oj.get(e),zue=(e,t,n)=>{let s=!1;const i=n?new WeakMap:!1,o=()=>{s=!0},a=l=>{if(i&&n){const c=n.map(d=>{const[h,f]=d||[];return[f&&h?(l||cR)(h,e):[],f]});Kt(c,d=>Kt(d[0],h=>{const f=d[1],p=i.get(h)||[];if(e.contains(h)&&f){const m=gn(h,f,y=>{s?(m(),i.delete(h)):t(y)});i.set(h,Cn(p,m))}else kr(p),i.delete(h)}))}};return a(),[o,a]},V5=(e,t,n,s)=>{let i=!1;const{j:o,X:a,Y:l,W:c,J:d,G:h}=s||{},f=uC(()=>i&&n(!0),{_:33,v:99}),[p,g]=zue(e,f,l),m=o||[],y=a||[],b=Xf(m,y),C=(v,w)=>{if(!lC(w)){const S=d||Na,j=h||Na,P=[],E=[];let D=!1,M=!1;if(Kt(w,R=>{const{attributeName:F,target:_,type:L,oldValue:O,addedNodes:B,removedNodes:z}=R,ee=L==="attributes",ne=L==="childList",re=e===_,te=ee&&F,H=te&&Aj(_,F||""),V=rg(H)?H:null,X=te&&O!==V,W=UD(y,F)&&X;if(t&&(ne||!re)){const Y=ee&&X,$=Y&&c&&dC(_,c),U=($?!S(_,F,O,V):!ee||Y)&&!j(R,!!$,e,s);Kt(B,ie=>Cn(P,ie)),Kt(z,ie=>Cn(P,ie)),M=M||U}!t&&re&&X&&!S(_,F,O,V)&&(Cn(E,F),D=D||W)}),g(R=>cC(P).reduce((F,_)=>(Cn(F,cR(R,_)),dC(_,R)?Cn(F,_):F),[])),t)return!v&&M&&n(!1),[!1];if(!lC(E)||D){const R=[cC(E),D];return!v&&n.apply(0,R),R}}},x=new oue(at(C,!1));return[()=>(x.observe(e,{attributes:!0,attributeOldValue:!0,attributeFilter:b,subtree:t,childList:t,characterData:t}),i=!0,()=>{i&&(p(),x.disconnect(),i=!1)}),()=>{if(i)return f.m(),C(!0,x.takeRecords())}]},IR={},TR={},Gue=e=>{Kt(e,t=>Kt(t,(n,s)=>{IR[s]=t[s]}))},AR=(e,t,n)=>Ti(e).map(s=>{const{static:i,instance:o}=e[s],[a,l,c]=n||[],d=n?o:i;if(d){const h=n?d(a,l,t):d(t);return(c||TR)[s]=h}}),ig=e=>TR[e],Hue="__osOptionsValidationPlugin",Wue="__osSizeObserverPlugin",Uue=(e,t)=>{const{k:n}=t,[s,i]=e("showNativeOverlaidScrollbars");return[s&&n.x&&n.y,i]},zu=e=>e.indexOf(wa)===0,que=(e,t)=>{const n=(i,o,a,l)=>{const c=i===wa?El:i.replace(`${wa}-`,""),d=zu(i),h=zu(a);return!o&&!l?El:d&&h?wa:d?o&&l?c:o?wa:El:o?c:h&&l?wa:El},s={x:n(t.x,e.x,t.y,e.y),y:n(t.y,e.y,t.x,e.x)};return{K:s,Z:{x:s.x===$u,y:s.y===$u}}},ER="__osScrollbarsHidingPlugin",MR="__osClickScrollPlugin",Kue={[MR]:{static:()=>(e,t,n,s)=>{let i=!1,o=Na;const a=133,l=222,[c,d]=Ml(a),h=Math.sign(t),f=n*h,p=f/2,g=C=>1-(1-C)*(1-C),m=(C,x)=>Wx(C,x,l,e,g),y=(C,x)=>Wx(C,t-f,a*x,(v,w,S)=>{e(v),S&&(o=m(v,t))}),b=Wx(0,f,l,(C,x,v)=>{if(e(C),v&&(s(i),!i)){const w=t-C;Math.sign(w-p)===h&&c(()=>{const j=w-f;o=Math.sign(j)===h?y(C,Math.abs(j)/n):m(C,t)})}},g);return C=>{i=!0,C&&b(),d(),o()}}}},PR=(e,t,n)=>{const{dt:s}=n||{},i=ig(Wue),[o]=mr({o:!1,u:!0});return()=>{const a=[],c=dR(`<div class="${Dj}"><div class="${kue}"></div></div>`)[0],d=c.firstChild,h=f=>{const p=f instanceof ResizeObserverEntry;let g=!1,m=!1;if(p){const[y,,b]=o(f.contentRect),C=gC(y);m=gR(y,b),g=!m&&!C}else m=f===!0;g||t({ft:!0,dt:m})};if(U0){const f=new U0(p=>h(p.pop()));f.observe(d),Cn(a,()=>{f.disconnect()})}else if(i){const[f,p]=i(d,h,s);Cn(a,Xf([Pj(c,jue),gn(c,"animationstart",f)],p))}else return Na;return at(kr,Cn(a,vr(e,c)))}},Zue=(e,t)=>{let n;const s=c=>c.h===0||c.isIntersecting||c.intersectionRatio>0,i=Su(_ue),[o]=mr({o:!1}),a=(c,d)=>{if(c){const h=o(s(c)),[,f]=h;return f&&!d&&t(h)&&[h]}},l=(c,d)=>a(d.pop(),c);return[()=>{const c=[];if(S5)n=new S5(at(l,!1),{root:e}),n.observe(i),Cn(c,()=>{n.disconnect()});else{const d=()=>{const h=ju(i);a(h)};Cn(c,PR(i,d)()),d()}return at(kr,Cn(c,vr(e,i)))},()=>n&&l(!0,n.takeRecords())]},Yue=(e,t,n,s)=>{let i,o,a,l,c,d;const h=`[${Fa}]`,f=`[${Ro}]`,p=["id","class","style","open","wrap","cols","rows"],{vt:g,ht:m,ot:y,gt:b,bt:C,nt:x,wt:v,yt:w,St:S,Ot:j}=e,P=W=>Qo(W,"direction")==="rtl",E={$t:!1,ct:P(g)},D=So(),M=ig(ER),[R]=mr({i:nR,o:{w:0,h:0}},()=>{const W=M&&M.tt(e,t,E,D,n).ut,$=!(v&&x)&&Mj(m,Fa,d0),N=!x&&w(Cue),U=N&&Cr(b),ie=U&&j(),ue=S(vR,$),xe=N&&W&&W()[0],Me=X0(y),je=Lj(y);return xe&&xe(),Xi(b,U),ie&&ie(),$&&ue(),{w:Me.w+je.w,h:Me.h+je.h}}),F=uC(s,{_:()=>i,v:()=>o,S(W,Y){const[$]=W,[N]=Y;return[Xf(Ti($),Ti(N)).reduce((U,ie)=>(U[ie]=$[ie]||N[ie],U),{})]}}),_=W=>{const Y=P(g);Dt(W,{Ct:d!==Y}),Dt(E,{ct:Y}),d=Y},L=(W,Y)=>{const[$,N]=W,U={xt:N};return Dt(E,{$t:$}),!Y&&s(U),U},O=({ft:W,dt:Y})=>{const N=!(W&&!Y)&&D.R?F:s,U={ft:W||Y,dt:Y};_(U),N(U)},B=(W,Y)=>{const[,$]=R(),N={Ht:$};return _(N),$&&!Y&&(W?s:F)(N),N},z=(W,Y,$)=>{const N={Et:Y};return _(N),Y&&!$&&F(N),N},[ee,ne]=C?Zue(m,L):[],re=!x&&PR(m,O,{dt:!0}),[te,H]=V5(m,!1,z,{X:p,j:p}),V=x&&U0&&new U0(W=>{const Y=W[W.length-1].contentRect;O({ft:!0,dt:gR(Y,c)}),c=Y}),X=uC(()=>{const[,W]=R();s({Ht:W})},{_:222,p:!0});return[()=>{V&&V.observe(m);const W=re&&re(),Y=ee&&ee(),$=te(),N=D.L(U=>{U?F({zt:U}):X()});return()=>{V&&V.disconnect(),W&&W(),Y&&Y(),l&&l(),$(),N()}},({It:W,At:Y,Dt:$})=>{const N={},[U]=W("update.ignoreMutation"),[ie,ue]=W("update.attributes"),[xe,Me]=W("update.elementEvents"),[je,Fe]=W("update.debounce"),nt=Me||ue,$e=Y||$,Z=se=>Er(U)&&U(se);if(nt){a&&a(),l&&l();const[se,le]=V5(C||y,!0,B,{j:Xf(p,ie||[]),Y:xe,W:h,G:(ve,ye)=>{const{target:me,attributeName:ce}=ve;return(!ye&&ce&&!x?uue(me,h,f):!1)||!!lu(me,`.${Nr}`)||!!Z(ve)}});l=se(),a=le}if(Fe)if(F.m(),go(je)){const se=je[0],le=je[1];i=no(se)&&se,o=no(le)&&le}else no(je)?(i=je,o=!1):(i=!1,o=!1);if($e){const se=H(),le=ne&&ne(),ve=a&&a();se&&Dt(N,z(se[0],se[1],$e)),le&&Dt(N,L(le[0],$e)),ve&&Dt(N,B(ve[0],$e))}return _(N),N},E]},Xue=(e,t,n,s)=>{const i="--os-viewport-percent",o="--os-scroll-percent",a="--os-scroll-direction",{U:l}=So(),{scrollbars:c}=l(),{slot:d}=c,{vt:h,ht:f,ot:p,Mt:g,gt:m,wt:y,nt:b}=t,{scrollbars:C}=g?{}:e,{slot:x}=C||{},v=[],w=[],S=[],j=kR([h,f,p],()=>b&&y?h:f,d,x),P=te=>{if(l0){const H=new l0({source:m,axis:te});return{kt:X=>{const W=X.Tt.animate({clear:["left"],[o]:[0,1]},{timeline:H});return()=>W.cancel()}}}},E={x:P("x"),y:P("y")},D=()=>{const{Rt:te,Vt:H}=n,V=(X,W)=>iR(0,1,X/(X+W)||0);return{x:V(H.x,te.x),y:V(H.y,te.y)}},M=(te,H,V)=>{const X=V?Pj:lR;Kt(te,W=>{X(W.Tt,H)})},R=(te,H)=>{Kt(te,V=>{const[X,W]=H(V);Jf(X,W)})},F=(te,H,V)=>{const X=kj(V),W=X?V:!0,Y=X?!V:!0;W&&M(w,te,H),Y&&M(S,te,H)},_=()=>{const te=D(),H=V=>X=>[X.Tt,{[i]:pC(V)+""}];R(w,H(te.x)),R(S,H(te.y))},L=()=>{if(!l0){const{Lt:te}=n,H=E5(te,Cr(m)),V=X=>W=>[W.Tt,{[o]:pC(X)+""}];R(w,V(H.x)),R(S,V(H.y))}},O=()=>{const{Lt:te}=n,H=A5(te),V=X=>W=>[W.Tt,{[a]:X?"0":"1"}];R(w,V(H.x)),R(S,V(H.y))},B=()=>{if(b&&!y){const{Rt:te,Lt:H}=n,V=A5(H),X=E5(H,Cr(m)),W=Y=>{const{Tt:$}=Y,N=Qf($)===p&&$,U=(ie,ue,xe)=>{const Me=ue*ie;return fR(xe?Me:-Me)};return[N,N&&{transform:due({x:U(X.x,te.x,V.x),y:U(X.y,te.y,V.y)})}]};R(w,W),R(S,W)}},z=te=>{const H=te?"x":"y",X=Su(`${Nr} ${te?Aue:Eue}`),W=Su(wR),Y=Su(Rj),$={Tt:X,Ut:W,Pt:Y},N=E[H];return Cn(te?w:S,$),Cn(v,[vr(X,W),vr(W,Y),at(Vu,X),N&&N.kt($),s($,F,te)]),$},ee=at(z,!0),ne=at(z,!1),re=()=>(vr(j,w[0].Tt),vr(j,S[0].Tt),at(kr,v));return ee(),ne(),[{Nt:_,qt:L,Bt:O,Ft:B,jt:F,Xt:{Yt:w,Wt:ee,Jt:at(R,w)},Gt:{Yt:S,Wt:ne,Jt:at(R,S)}},re]},Que=(e,t,n,s)=>(i,o,a)=>{const{ht:l,ot:c,nt:d,gt:h,Kt:f,Ot:p}=t,{Tt:g,Ut:m,Pt:y}=i,[b,C]=Ml(333),[x,v]=Ml(444),w=P=>{Er(h.scrollBy)&&h.scrollBy({behavior:"smooth",left:P.x,top:P.y})},S=()=>{const P="pointerup pointercancel lostpointercapture",E=`client${a?"X":"Y"}`,D=a?eb:tb,M=a?"left":"top",R=a?"w":"h",F=a?"x":"y",_=(O,B)=>z=>{const{Rt:ee}=n,ne=ju(m)[R]-ju(y)[R],te=B*z/ne*ee[F];Xi(h,{[F]:O+te})},L=[];return gn(m,"pointerdown",O=>{const B=lu(O.target,`.${Rj}`)===y,z=B?y:m,ee=e.scrollbars,ne=ee[B?"dragScroll":"clickScroll"],{button:re,isPrimary:te,pointerType:H}=O,{pointers:V}=ee;if(re===0&&te&&ne&&(V||[]).includes(H)){kr(L),v();const W=!B&&(O.shiftKey||ne==="instant"),Y=at(Ux,y),$=at(Ux,m),N=(ye,me)=>(ye||Y())[M]-(me||$())[M],U=oC(Ux(h)[D])/ju(h)[R]||1,ie=_(Cr(h)[F],1/U),ue=O[E],xe=Y(),Me=$(),je=xe[D],Fe=N(xe,Me)+je/2,nt=ue-Me[M],$e=B?0:nt-Fe,Z=ye=>{kr(ve),z.releasePointerCapture(ye.pointerId)},se=B||W,le=p(),ve=[gn(f,P,Z),gn(f,"selectstart",ye=>mC(ye),{H:!1}),gn(m,P,Z),se&&gn(m,"pointermove",ye=>ie($e+(ye[E]-ue))),se&&(()=>{const ye=Cr(h);le();const me=Cr(h),ce={x:me.x-ye.x,y:me.y-ye.y};(H0(ce.x)>3||H0(ce.y)>3)&&(p(),Xi(h,ye),w(ce),x(le))})];if(z.setPointerCapture(O.pointerId),W)ie($e);else if(!B){const ye=ig(MR);if(ye){const me=ye(ie,$e,je,ce=>{ce?le():Cn(ve,le)});Cn(ve,me),Cn(L,at(me,!0))}}}})};let j=!0;return at(kr,[gn(y,"pointermove pointerleave",s),gn(g,"pointerenter",()=>{o(N5,!0)}),gn(g,"pointerleave pointercancel",()=>{o(N5,!1)}),!d&&gn(g,"mousedown",()=>{const P=fC();(k5(P,Ro)||k5(P,Fa)||P===document.body)&&W0(at(yC,c),25)}),gn(g,"wheel",P=>{const{deltaX:E,deltaY:D,deltaMode:M}=P;j&&M===0&&Qf(g)===l&&w({x:E,y:D}),j=!1,o($5,!0),b(()=>{j=!0,o($5)}),mC(P)},{H:!1,I:!0}),gn(g,"pointerdown",at(gn,f,"click",yR,{A:!0,I:!0,H:!1}),{I:!0}),S(),C,v])},Jue=(e,t,n,s,i,o)=>{let a,l,c,d,h,f=Na,p=0;const g=te=>te.pointerType==="mouse",[m,y]=Ml(),[b,C]=Ml(100),[x,v]=Ml(100),[w,S]=Ml(()=>p),[j,P]=Xue(e,i,s,Que(t,i,s,te=>g(te)&&z())),{ht:E,Qt:D,wt:M}=i,{jt:R,Nt:F,qt:_,Bt:L,Ft:O}=j,B=(te,H)=>{if(S(),te)R(B5);else{const V=at(R,B5,!0);p>0&&!H?w(V):V()}},z=()=>{(c?!a:!d)&&(B(!0),b(()=>{B(!1)}))},ee=te=>{R(vC,te,!0),R(vC,te,!1)},ne=te=>{g(te)&&(a=c,c&&B(!0))},re=[S,C,v,y,()=>f(),gn(E,"pointerover",ne,{A:!0}),gn(E,"pointerenter",ne),gn(E,"pointerleave",te=>{g(te)&&(a=!1,c&&B(!1))}),gn(E,"pointermove",te=>{g(te)&&l&&z()}),gn(D,"scroll",te=>{m(()=>{_(),z()}),o(te),O()})];return[()=>at(kr,Cn(re,P())),({It:te,Dt:H,Zt:V,tn:X})=>{const{nn:W,sn:Y,en:$,cn:N}=X||{},{Ct:U,dt:ie}=V||{},{ct:ue}=n,{k:xe}=So(),{K:Me,rn:je}=s,[Fe,nt]=te("showNativeOverlaidScrollbars"),[$e,Z]=te("scrollbars.theme"),[se,le]=te("scrollbars.visibility"),[ve,ye]=te("scrollbars.autoHide"),[me,ce]=te("scrollbars.autoHideSuspend"),[Ce]=te("scrollbars.autoHideDelay"),[He,Xe]=te("scrollbars.dragScroll"),[mt,rn]=te("scrollbars.clickScroll"),[pn,bn]=te("overflow"),ls=ie&&!H,Os=je.x||je.y,xn=W||Y||N||U||H,Bi=$||le||bn,la=Fe&&xe.x&&xe.y,bs=(qs,ui,Pc)=>{const Jg=qs.includes($u)&&(se===wa||se==="auto"&&ui===$u);return R(Mue,Jg,Pc),Jg};if(p=Ce,ls&&(me&&Os?(ee(!1),f(),x(()=>{f=gn(D,"scroll",at(ee,!0),{A:!0})})):ee(!0)),nt&&R(Iue,la),Z&&(R(h),R($e,!0),h=$e),ce&&!me&&ee(!0),ye&&(l=ve==="move",c=ve==="leave",d=ve==="never",B(d,!0)),Xe&&R(Due,He),rn&&R(Lue,!!mt),Bi){const qs=bs(pn.x,Me.x,!0),ui=bs(pn.y,Me.y,!1);R(Pue,!(qs&&ui))}xn&&(_(),F(),O(),N&&L(),R(F5,!je.x,!0),R(F5,!je.y,!1),R(Tue,ue&&!M))},{},j]},ede=e=>{const t=So(),{U:n,R:s}=t,{elements:i}=n(),{padding:o,viewport:a,content:l}=i,c=Z0(e),d=c?{}:e,{elements:h}=d,{padding:f,viewport:p,content:g}=h||{},m=c?e:d.target,y=uR(m),b=m.ownerDocument,C=b.documentElement,x=()=>b.defaultView||nr,v=at(Fue,[m]),w=at(kR,[m]),S=at(Su,""),j=at(v,S,a),P=at(w,S,l),E=je=>{const Fe=ju(je),nt=X0(je),$e=Qo(je,eR),Z=Qo(je,tR);return nt.w-Fe.w>0&&!zu($e)||nt.h-Fe.h>0&&!zu(Z)},D=j(p),M=D===m,R=M&&y,F=!M&&P(g),_=!M&&D===F,L=R?C:D,O=R?L:m,B=!M&&w(S,o,f),z=!_&&F,ee=[z,L,B,O].map(je=>Z0(je)&&!Qf(je)&&je),ne=je=>je&&UD(ee,je),re=!ne(L)&&E(L)?L:m,te=R?C:L,V={vt:m,ht:O,ot:L,ln:B,bt:z,gt:te,Qt:R?b:L,an:y?C:re,Kt:b,wt:y,Mt:c,nt:M,un:x,yt:je=>Mj(L,Ro,je),St:(je,Fe)=>Y0(L,Ro,je,Fe),Ot:()=>Y0(te,Ro,wue,!0)},{vt:X,ht:W,ln:Y,ot:$,bt:N}=V,U=[()=>{Vi(W,[Fa,qx]),Vi(X,qx),y&&Vi(C,[qx,Fa])}];let ie=hC([N,$,Y,W,X].find(je=>je&&!ne(je)));const ue=R?X:N||$,xe=at(kr,U);return[V,()=>{const je=x(),Fe=fC(),nt=ve=>{vr(Qf(ve),hC(ve)),Vu(ve)},$e=ve=>gn(ve,"focusin focusout focus blur",yR,{I:!0,H:!1}),Z="tabindex",se=Aj($,Z),le=$e(Fe);return Do(W,Fa,M?"":bue),Do(Y,xC,""),Do($,Ro,""),Do(N,O5,""),M||(Do($,Z,se||"-1"),y&&Do(C,R5,"")),vr(ue,ie),vr(W,Y),vr(Y||W,!M&&$),vr($,N),Cn(U,[le,()=>{const ve=fC(),ye=ne($),me=ye&&ve===$?X:ve,ce=$e(me);Vi(Y,xC),Vi(N,O5),Vi($,Ro),y&&Vi(C,R5),se?Do($,Z,se):Vi($,Z),ne(N)&&nt(N),ye&&nt($),ne(Y)&&nt(Y),yC(me),ce()}]),s&&!M&&(Ej($,Ro,CR),Cn(U,at(Vi,$,Ro))),yC(!M&&y&&Fe===X&&je.top===je?$:Fe),le(),ie=0,xe},xe]},tde=({bt:e})=>({Zt:t,_n:n,Dt:s})=>{const{xt:i}=t||{},{$t:o}=n;e&&(i||s)&&Jf(e,{[tb]:o&&"100%"})},nde=({ht:e,ln:t,ot:n,nt:s},i)=>{const[o,a]=mr({i:lue,o:I5()},at(I5,e,"padding",""));return({It:l,Zt:c,_n:d,Dt:h})=>{let[f,p]=a(h);const{R:g}=So(),{ft:m,Ht:y,Ct:b}=c||{},{ct:C}=d,[x,v]=l("paddingAbsolute");(m||p||(h||y))&&([f,p]=o(h));const S=!s&&(v||b||p);if(S){const j=!x||!t&&!g,P=f.r+f.l,E=f.t+f.b,D={[QD]:j&&!C?-P:0,[JD]:j?-E:0,[XD]:j&&C?-P:0,top:j?-f.t:0,right:j?C?-f.r:"auto":0,left:j?C?"auto":-f.l:0,[eb]:j&&`calc(100% + ${P}px)`},M={[qD]:j?f.t:0,[KD]:j?f.r:0,[YD]:j?f.b:0,[ZD]:j?f.l:0};Jf(t||n,D),Jf(n,M),Dt(i,{ln:f,dn:!j,rt:t?M:Dt({},D,M)})}return{fn:S}}},sde=(e,t)=>{const n=So(),{ht:s,ln:i,ot:o,nt:a,Qt:l,gt:c,wt:d,St:h,un:f}=e,{R:p}=n,g=d&&a,m=at(G0,0),y={display:()=>!1,direction:H=>H!=="ltr",flexDirection:H=>H.endsWith("-reverse"),writingMode:H=>H!=="horizontal-tb"},b=Ti(y),C={i:nR,o:{w:0,h:0}},x={i:c0,o:{}},v=H=>{h(vR,!g&&H)},w=H=>{if(!b.some(ue=>{const xe=H[ue];return xe&&y[ue](xe)}))return{D:{x:0,y:0},M:{x:1,y:1}};v(!0);const X=Cr(c),W=h(Sue,!0),Y=gn(l,$u,ue=>{const xe=Cr(c);ue.isTrusted&&xe.x===X.x&&xe.y===X.y&&mR(ue)},{I:!0,A:!0});Xi(c,{x:0,y:0}),W();const $=Cr(c),N=X0(c);Xi(c,{x:N.w,y:N.h});const U=Cr(c);Xi(c,{x:U.x-$.x<1&&-N.w,y:U.y-$.y<1&&-N.h});const ie=Cr(c);return Xi(c,X),Yy(()=>Y()),{D:$,M:ie}},S=(H,V)=>{const X=nr.devicePixelRatio%1!==0?1:0,W={w:m(H.w-V.w),h:m(H.h-V.h)};return{w:W.w>X?W.w:0,h:W.h>X?W.h:0}},[j,P]=mr(C,at(Lj,o)),[E,D]=mr(C,at(X0,o)),[M,R]=mr(C),[F]=mr(x),[_,L]=mr(C),[O]=mr(x),[B]=mr({i:(H,V)=>nb(H,V,b),o:{}},()=>gue(o)?Qo(o,b):{}),[z,ee]=mr({i:(H,V)=>c0(H.D,V.D)&&c0(H.M,V.M),o:bR()}),ne=ig(ER),re=(H,V)=>`${V?xue:vue}${aue(H)}`,te=H=>{const V=W=>[wa,El,$u].map(Y=>re(Y,W)),X=V(!0).concat(V()).join(" ");h(X),h(Ti(H).map(W=>re(H[W],W==="x")).join(" "),!0)};return({It:H,Zt:V,_n:X,Dt:W},{fn:Y})=>{const{ft:$,Ht:N,Ct:U,dt:ie,zt:ue}=V||{},xe=ne&&ne.tt(e,t,X,n,H),{it:Me,ut:je,_t:Fe}=xe||{},[nt,$e]=Uue(H,n),[Z,se]=H("overflow"),le=zu(Z.x),ve=zu(Z.y);let ye=P(W),me=D(W),ce=R(W),Ce=L(W);$e&&p&&h(CR,!nt);{Mj(s,Fa,d0)&&v(!0);const[U4]=je?je():[],[em]=ye=j(W),[tm]=me=E(W),nm=pR(o),sm=g&&pue(f()),dY={w:m(tm.w+em.w),h:m(tm.h+em.h)},q4={w:m((sm?sm.w:nm.w+m(nm.w-tm.w))+em.w),h:m((sm?sm.h:nm.h+m(nm.h-tm.h))+em.h)};U4&&U4(),Ce=_(q4),ce=M(S(dY,q4),W)}const[He,Xe]=Ce,[mt,rn]=ce,[pn,bn]=me,[ls,Os]=ye,[xn,Bi]=F({x:mt.w>0,y:mt.h>0}),la=le&&ve&&(xn.x||xn.y)||le&&xn.x&&!xn.y||ve&&xn.y&&!xn.x,bs=que(xn,Z),[qs,ui]=O(bs.K),[Pc,Jg]=B(W),W4=U||ie||Jg||Bi||W,[cY,uY]=W4?z(w(Pc),W):ee();return ui&&te(bs.K),Fe&&Me&&Jf(o,Fe(bs,X,Me(bs,pn,ls))),v(!1),Y0(s,Fa,d0,la),Y0(i,xC,d0,la),Dt(t,{K:qs,Vt:{x:He.w,y:He.h},Rt:{x:mt.w,y:mt.h},rn:xn,Lt:mue(cY,mt)}),{en:ui,nn:Xe,sn:rn,cn:uY||rn,vn:W4}}},rde=e=>{const[t,n,s]=ede(e),i={ln:{t:0,r:0,b:0,l:0},dn:!1,rt:{[QD]:0,[JD]:0,[XD]:0,[qD]:0,[KD]:0,[YD]:0,[ZD]:0},Vt:{x:0,y:0},Rt:{x:0,y:0},K:{x:El,y:El},rn:{x:!1,y:!1},Lt:bR()},{vt:o,gt:a,nt:l,Ot:c}=t,{R:d,k:h}=So(),f=!d&&(h.x||h.y),p=[tde(t),nde(t,i),sde(t,i)];return[n,g=>{const m={},b=f&&Cr(a),C=b&&c();return Kt(p,x=>{Dt(m,x(g,m)||{})}),Xi(a,b),C&&C(),!l&&Xi(o,0),m},i,t,s]},ide=(e,t,n,s,i)=>{let o=!1;const a=D5(t,{}),[l,c,d,h,f]=rde(e),[p,g,m]=Yue(h,d,a,w=>{v({},w)}),[y,b,,C]=Jue(e,t,m,d,h,i),x=w=>Ti(w).some(S=>!!w[S]),v=(w,S)=>{if(n())return!1;const{pn:j,Dt:P,At:E,hn:D}=w,M=j||{},R=!!P||!o,F={It:D5(t,M,R),pn:M,Dt:R};if(D)return b(F),!1;const _=S||g(Dt({},F,{At:E})),L=c(Dt({},F,{_n:m,Zt:_}));b(Dt({},F,{Zt:_,tn:L}));const O=x(_),B=x(L),z=O||B||!Tj(M)||R;return o=!0,z&&s(w,{Zt:_,tn:L}),z};return[()=>{const{an:w,gt:S,Ot:j}=h,P=Cr(w),E=[p(),l(),y()],D=j();return Xi(S,P),D(),at(kr,E)},v,()=>({gn:m,bn:d}),{wn:h,yn:C},f]},ji=(e,t,n)=>{const{N:s}=So(),i=Z0(e),o=i?e:e.target,a=_R(o);if(t&&!a){let l=!1;const c=[],d={},h=M=>{const R=rR(M),F=ig(Hue);return F?F(R,!0):R},f=Dt({},s(),h(t)),[p,g,m]=bC(),[y,b,C]=bC(n),x=(M,R)=>{C(M,R),m(M,R)},[v,w,S,j,P]=ide(e,f,()=>l,({pn:M,Dt:R},{Zt:F,tn:_})=>{const{ft:L,Ct:O,xt:B,Ht:z,Et:ee,dt:ne}=F,{nn:re,sn:te,en:H,cn:V}=_;x("updated",[D,{updateHints:{sizeChanged:!!L,directionChanged:!!O,heightIntrinsicChanged:!!B,overflowEdgeChanged:!!re,overflowAmountChanged:!!te,overflowStyleChanged:!!H,scrollCoordinatesChanged:!!V,contentMutation:!!z,hostMutation:!!ee,appear:!!ne},changedOptions:M||{},force:!!R}])},M=>x("scroll",[D,M])),E=M=>{Vue(o),kr(c),l=!0,x("destroyed",[D,M]),g(),b()},D={options(M,R){if(M){const F=R?s():{},_=xR(f,Dt(F,h(M)));Tj(_)||(Dt(f,_),w({pn:_}))}return Dt({},f)},on:y,off:(M,R)=>{M&&R&&b(M,R)},state(){const{gn:M,bn:R}=S(),{ct:F}=M,{Vt:_,Rt:L,K:O,rn:B,ln:z,dn:ee,Lt:ne}=R;return Dt({},{overflowEdge:_,overflowAmount:L,overflowStyle:O,hasOverflow:B,scrollCoordinates:{start:ne.D,end:ne.M},padding:z,paddingAbsolute:ee,directionRTL:F,destroyed:l})},elements(){const{vt:M,ht:R,ln:F,ot:_,bt:L,gt:O,Qt:B}=j.wn,{Xt:z,Gt:ee}=j.yn,ne=te=>{const{Pt:H,Ut:V,Tt:X}=te;return{scrollbar:X,track:V,handle:H}},re=te=>{const{Yt:H,Wt:V}=te,X=ne(H[0]);return Dt({},X,{clone:()=>{const W=ne(V());return w({hn:!0}),W}})};return Dt({},{target:M,host:R,padding:F||_,viewport:_,content:L||_,scrollOffsetElement:O,scrollEventElement:B,scrollbarHorizontal:re(z),scrollbarVertical:re(ee)})},update:M=>w({Dt:M,At:!0}),destroy:at(E,!1),plugin:M=>d[Ti(M)[0]]};return Cn(c,[P]),$ue(o,D),AR(IR,ji,[D,p,d]),Bue(j.wn.wt,!i&&e.cancel)?(E(!0),D):(Cn(c,v()),x("initialized",[D]),D.update(),D)}return a};ji.plugin=e=>{const t=go(e),n=t?e:[e],s=n.map(i=>AR(i,ji)[0]);return Gue(n),t?s:s[0]};ji.valid=e=>{const t=e&&e.elements,n=Er(t)&&t();return K0(n)&&!!_R(n.target)};ji.env=()=>{const{T:e,k:t,R:n,V:s,B:i,F:o,U:a,P:l,N:c,q:d}=So();return Dt({},{scrollbarsSize:e,scrollbarsOverlaid:t,scrollbarsHiding:n,scrollTimeline:s,staticDefaultInitialization:i,staticDefaultOptions:o,getDefaultInitialization:a,setDefaultInitialization:l,getDefaultOptions:c,setDefaultOptions:d})};ji.nonce=Oue;ji.plugin(Kue);const Ul={defer:!0,options:{scrollbars:{visibility:"auto",autoHide:"scroll",autoHideDelay:1300,theme:"os-theme-dark",clickScroll:!0},overflow:{x:"hidden"}}},li=({overflowX:e="hidden",overflowY:t="scroll",visibility:n="auto"})=>{const s=gt(Ul);return hM(s,{options:{overflow:{y:t,x:e},scrollbars:{visibility:n,autoHide:n==="visible"?"never":"scroll"}}}),s},jo={height:"100%",width:"100%"},ode=()=>{if(typeof window>"u"){const d=()=>{};return[d,d]}let e,t;const n=window,s=typeof n.requestIdleCallback=="function",i=n.requestAnimationFrame,o=n.cancelAnimationFrame,a=s?n.requestIdleCallback:i,l=s?n.cancelIdleCallback:o,c=()=>{l(e),o(t)};return[(d,h)=>{c(),e=a(s?()=>{c(),t=i(d)}:d,typeof h=="object"?h:{timeout:2233})},c]},LR=e=>{const{options:t,events:n,defer:s}=e||{},[i,o]=u.useMemo(ode,[]),a=u.useRef(null),l=u.useRef(s),c=u.useRef(t),d=u.useRef(n);return u.useEffect(()=>{l.current=s},[s]),u.useEffect(()=>{const{current:h}=a;c.current=t,ji.valid(h)&&h.options(t||{},!0)},[t]),u.useEffect(()=>{const{current:h}=a;d.current=n,ji.valid(h)&&h.on(n||{},!0)},[n]),u.useEffect(()=>()=>{var h;o(),(h=a.current)==null||h.destroy()},[]),u.useMemo(()=>[h=>{const f=a.current;if(ji.valid(f))return;const p=l.current,g=c.current||{},m=d.current||{},y=()=>a.current=ji(h,g,m);p?i(y,p):y()},()=>a.current],[])},ade=(e,t)=>{const{element:n="div",options:s,events:i,defer:o,children:a,...l}=e,c=n,d=u.useRef(null),h=u.useRef(null),[f,p]=LR({options:s,events:i,defer:o});return u.useEffect(()=>{const{current:g}=d,{current:m}=h;if(!g)return;const y=g;return f(n==="body"?{target:y,cancel:{body:null}}:{target:y,elements:{viewport:m,content:m}}),()=>{var b;return(b=p())==null?void 0:b.destroy()}},[f,n]),u.useImperativeHandle(t,()=>({osInstance:p,getElement:()=>d.current}),[]),be.createElement(c,{"data-overlayscrollbars-initialize":"",ref:d,...l},n==="body"?a:be.createElement("div",{"data-overlayscrollbars-contents":"",ref:h},a))},ps=u.forwardRef(ade),lde={position:"absolute",top:0,left:0,right:0,bottom:0},cde=({children:e,maxHeight:t,overflowX:n="hidden",overflowY:s="scroll"})=>{const i=u.useMemo(()=>li({overflowX:n,overflowY:s}).options,[n,s]),[o,a]=u.useState(null);return u.useEffect(()=>{const l=o==null?void 0:o.osInstance();if(!l)return;const c=l.elements().viewport,d=c.style.overflowY;c.style.setProperty("overflow-y","scroll","important");const h=qn(vj({element:c}),WD({element:c}));return c.style.setProperty("overflow-y",d),h},[o]),r.jsx(T,{w:"full",h:"full",maxHeight:t,position:"relative",children:r.jsx(Se,{position:"absolute",top:0,left:0,right:0,bottom:0,children:r.jsx(ps,{ref:a,style:lde,options:i,children:e})})})},os=u.memo(cde);var DR={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},z5=be.createContext&&be.createContext(DR),ude=["attr","size","title"];function dde(e,t){if(e==null)return{};var n=hde(e,t),s,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)s=o[i],!(t.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(e,s)&&(n[s]=e[s])}return n}function hde(e,t){if(e==null)return{};var n={};for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){if(t.indexOf(s)>=0)continue;n[s]=e[s]}return n}function Q0(){return Q0=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Q0.apply(this,arguments)}function G5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,s)}return n}function J0(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?G5(Object(n),!0).forEach(function(s){fde(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):G5(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function fde(e,t,n){return t=pde(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function pde(e){var t=gde(e,"string");return typeof t=="symbol"?t:t+""}function gde(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function RR(e){return e&&e.map((t,n)=>be.createElement(t.tag,J0({key:n},t.attr),RR(t.child)))}function he(e){return t=>be.createElement(mde,Q0({attr:J0({},e.attr)},t),RR(e.child))}function mde(e){var t=n=>{var{attr:s,size:i,title:o}=e,a=dde(e,ude),l=i||n.size||"1em",c;return n.className&&(c=n.className),e.className&&(c=(c?c+" ":"")+e.className),be.createElement("svg",Q0({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},n.attr,s,a,{className:c,style:J0(J0({color:e.color||n.color},n.style),e.style),height:l,width:l,xmlns:"http://www.w3.org/2000/svg"}),o&&be.createElement("title",null,o),e.children)};return z5!==void 0?be.createElement(z5.Consumer,null,n=>t(n)):t(DR)}function OR(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M224,44H32A20,20,0,0,0,12,64V88a20,20,0,0,0,16,19.6V192a20,20,0,0,0,20,20H208a20,20,0,0,0,20-20V107.6A20,20,0,0,0,244,88V64A20,20,0,0,0,224,44ZM36,68H220V84H36ZM52,188V108H204v80Zm112-52a12,12,0,0,1-12,12H104a12,12,0,0,1,0-24h48A12,12,0,0,1,164,136Z"},child:[]}]})(e)}function NR(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M236,200a12,12,0,0,1-24,0,84.09,84.09,0,0,0-84-84H61l27.52,27.51a12,12,0,0,1-17,17l-48-48a12,12,0,0,1,0-17l48-48a12,12,0,0,1,17,17L61,92h67A108.12,108.12,0,0,1,236,200Z"},child:[]}]})(e)}function yde(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M244,56v48a12,12,0,0,1-12,12H184a12,12,0,1,1,0-24H201.1l-19-17.38c-.13-.12-.26-.24-.38-.37A76,76,0,1,0,127,204h1a75.53,75.53,0,0,0,52.15-20.72,12,12,0,0,1,16.49,17.45A99.45,99.45,0,0,1,128,228h-1.37A100,100,0,1,1,198.51,57.06L220,76.72V56a12,12,0,0,1,24,0Z"},child:[]}]})(e)}function ur(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,128a100,100,0,0,1-98.66,100H128a99.39,99.39,0,0,1-68.62-27.29,12,12,0,0,1,16.48-17.45,76,76,0,1,0-1.57-109c-.13.13-.25.25-.39.37L54.89,92H72a12,12,0,0,1,0,24H24a12,12,0,0,1-12-12V56a12,12,0,0,1,24,0V76.72L57.48,57.06A100,100,0,0,1,228,128Z"},child:[]}]})(e)}function bde(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208.49,152.49l-72,72a12,12,0,0,1-17,0l-72-72a12,12,0,0,1,17-17L116,187V40a12,12,0,0,1,24,0V187l51.51-51.52a12,12,0,0,1,17,17Z"},child:[]}]})(e)}function xde(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,128a12,12,0,0,1-12,12H69l51.52,51.51a12,12,0,0,1-17,17l-72-72a12,12,0,0,1,0-17l72-72a12,12,0,0,1,17,17L69,116H216A12,12,0,0,1,228,128Z"},child:[]}]})(e)}function vde(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M47.51,112.49a12,12,0,0,1,17-17L116,147V32a12,12,0,0,1,24,0V147l51.51-51.52a12,12,0,0,1,17,17l-72,72a12,12,0,0,1-17,0ZM216,204H40a12,12,0,0,0,0,24H216a12,12,0,0,0,0-24Z"},child:[]}]})(e)}function Cde(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M184.49,119.51a12,12,0,0,1,0,17l-72,72a12,12,0,0,1-17-17L147,140H32a12,12,0,0,1,0-24H147L95.51,64.49a12,12,0,0,1,17-17ZM216,28a12,12,0,0,0-12,12V216a12,12,0,0,0,24,0V40A12,12,0,0,0,216,28Z"},child:[]}]})(e)}function wde(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208.49,143.51a12,12,0,0,1-17,17L140,109V224a12,12,0,0,1-24,0V109L64.49,160.49a12,12,0,0,1-17-17l72-72a12,12,0,0,1,17,0ZM216,28H40a12,12,0,0,0,0,24H216a12,12,0,0,0,0-24Z"},child:[]}]})(e)}function Sde(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M224.49,136.49l-72,72a12,12,0,0,1-17-17L187,140H40a12,12,0,0,1,0-24H187L135.51,64.48a12,12,0,0,1,17-17l72,72A12,12,0,0,1,224.49,136.49Z"},child:[]}]})(e)}function ib(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,104a12,12,0,0,1-24,0V69l-59.51,59.51a12,12,0,0,1-17-17L187,52H152a12,12,0,0,1,0-24h64a12,12,0,0,1,12,12Zm-44,24a12,12,0,0,0-12,12v64H52V84h64a12,12,0,0,0,0-24H48A20,20,0,0,0,28,80V208a20,20,0,0,0,20,20H176a20,20,0,0,0,20-20V140A12,12,0,0,0,184,128Z"},child:[]}]})(e)}function FR(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208.49,120.49a12,12,0,0,1-17,0L140,69V216a12,12,0,0,1-24,0V69L64.49,120.49a12,12,0,0,1-17-17l72-72a12,12,0,0,1,17,0l72,72A12,12,0,0,1,208.49,120.49Z"},child:[]}]})(e)}function jde(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,48V96a12,12,0,0,1-12,12H168a12,12,0,0,1,0-24h19l-7.8-7.8a75.55,75.55,0,0,0-53.32-22.26h-.43A75.49,75.49,0,0,0,72.39,75.57,12,12,0,1,1,55.61,58.41a99.38,99.38,0,0,1,69.87-28.47H126A99.42,99.42,0,0,1,196.2,59.23L204,67V48a12,12,0,0,1,24,0ZM183.61,180.43a75.49,75.49,0,0,1-53.09,21.63h-.43A75.55,75.55,0,0,1,76.77,179.8L69,172H88a12,12,0,0,0,0-24H40a12,12,0,0,0-12,12v48a12,12,0,0,0,24,0V189l7.8,7.8A99.42,99.42,0,0,0,130,226.06h.56a99.38,99.38,0,0,0,69.87-28.47,12,12,0,0,0-16.78-17.16Z"},child:[]}]})(e)}function e1(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M88,108H40A12,12,0,0,1,28,96V48a12,12,0,0,1,24,0V67l7.8-7.8A99.42,99.42,0,0,1,130,29.94h.56a99.38,99.38,0,0,1,69.87,28.47,12,12,0,0,1-16.78,17.16,76,76,0,0,0-106.84.63L69,84H88a12,12,0,0,1,0,24Zm128,40H168a12,12,0,0,0,0,24h19l-7.8,7.8a75.55,75.55,0,0,1-53.32,22.26h-.43a75.49,75.49,0,0,1-53.09-21.63,12,12,0,0,0-16.78,17.16,99.38,99.38,0,0,0,69.87,28.47H126a99.42,99.42,0,0,0,70.16-29.29L204,189v19a12,12,0,0,0,24,0V160A12,12,0,0,0,216,148Z"},child:[]}]})(e)}function kde(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M120.49,167.51a12,12,0,0,1,0,17l-32,32a12,12,0,0,1-17,0l-32-32a12,12,0,1,1,17-17L68,179V48a12,12,0,0,1,24,0V179l11.51-11.52A12,12,0,0,1,120.49,167.51Zm96-96-32-32a12,12,0,0,0-17,0l-32,32a12,12,0,0,0,17,17L164,77V208a12,12,0,0,0,24,0V77l11.51,11.52a12,12,0,0,0,17-17Z"},child:[]}]})(e)}function _de(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216.49,184.49l-32,32a12,12,0,0,1-17-17L179,188H48a12,12,0,0,1,0-24H179l-11.52-11.51a12,12,0,0,1,17-17l32,32A12,12,0,0,1,216.49,184.49Zm-145-64a12,12,0,0,0,17-17L77,92H208a12,12,0,0,0,0-24H77L88.49,56.49a12,12,0,0,0-17-17l-32,32a12,12,0,0,0,0,17Z"},child:[]}]})(e)}function ob(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M220,48V96a12,12,0,0,1-24,0V77l-35.51,35.52a12,12,0,0,1-17-17L179,60H160a12,12,0,0,1,0-24h48A12,12,0,0,1,220,48ZM95.51,143.51,60,179V160a12,12,0,0,0-24,0v48a12,12,0,0,0,12,12H96a12,12,0,0,0,0-24H77l35.52-35.51a12,12,0,0,0-17-17ZM208,148a12,12,0,0,0-12,12v19l-35.51-35.52a12,12,0,0,0-17,17L179,196H160a12,12,0,0,0,0,24h48a12,12,0,0,0,12-12V160A12,12,0,0,0,208,148ZM77,60H96a12,12,0,0,0,0-24H48A12,12,0,0,0,36,48V96a12,12,0,0,0,24,0V77l35.51,35.52a12,12,0,0,0,17-17Z"},child:[]}]})(e)}function BR(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M218.29,182.17a12,12,0,0,1-16.47,4.12L140,149.19V216a12,12,0,0,1-24,0V149.19l-61.82,37.1a12,12,0,1,1-12.35-20.58L104.68,128,41.83,90.29A12,12,0,1,1,54.18,69.71L116,106.81V40a12,12,0,0,1,24,0v66.81l61.82-37.1a12,12,0,1,1,12.35,20.58L151.32,128l62.85,37.71A12,12,0,0,1,218.29,182.17Z"},child:[]}]})(e)}function Ide(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M184,28H72A20,20,0,0,0,52,48V224a12,12,0,0,0,18.36,10.18l57.63-36,57.65,36A12,12,0,0,0,204,224V48A20,20,0,0,0,184,28Zm-4,174.35-45.65-28.53a12,12,0,0,0-12.72,0L76,202.35V52H180Z"},child:[]}]})(e)}function rl(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208,100a20,20,0,0,0,20-20V48a20,20,0,0,0-20-20H176a20,20,0,0,0-20,20v4H100V48A20,20,0,0,0,80,28H48A20,20,0,0,0,28,48V80a20,20,0,0,0,20,20h4v56H48a20,20,0,0,0-20,20v32a20,20,0,0,0,20,20H80a20,20,0,0,0,20-20v-4h56v4a20,20,0,0,0,20,20h32a20,20,0,0,0,20-20V176a20,20,0,0,0-20-20h-4V100ZM180,52h24V76H180ZM52,52H76V76H52ZM76,204H52V180H76Zm128,0H180V180h24Zm-24-48h-4a20,20,0,0,0-20,20v4H100v-4a20,20,0,0,0-20-20H76V100h4a20,20,0,0,0,20-20V76h56v4a20,20,0,0,0,20,20h4Z"},child:[]}]})(e)}function Tde(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M54.8,119.49A35.06,35.06,0,0,1,49.05,128a35.06,35.06,0,0,1,5.75,8.51C60,147.24,60,159.83,60,172c0,25.94,1.84,32,20,32a12,12,0,0,1,0,24c-19.14,0-32.2-6.9-38.8-20.51C36,196.76,36,184.17,36,172c0-25.94-1.84-32-20-32a12,12,0,0,1,0-24c18.16,0,20-6.06,20-32,0-12.17,0-24.76,5.2-35.49C47.8,34.9,60.86,28,80,28a12,12,0,0,1,0,24c-18.16,0-20,6.06-20,32C60,96.17,60,108.76,54.8,119.49ZM240,116c-18.16,0-20-6.06-20-32,0-12.17,0-24.76-5.2-35.49C208.2,34.9,195.14,28,176,28a12,12,0,0,0,0,24c18.16,0,20,6.06,20,32,0,12.17,0,24.76,5.2,35.49A35.06,35.06,0,0,0,207,128a35.06,35.06,0,0,0-5.75,8.51C196,147.24,196,159.83,196,172c0,25.94-1.84,32-20,32a12,12,0,0,0,0,24c19.14,0,32.2-6.9,38.8-20.51C220,196.76,220,184.17,220,172c0-25.94,1.84-32,20-32a12,12,0,0,0,0-24Z"},child:[]}]})(e)}function Ade(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M237.24,213.21C216.12,203,204,180.64,204,152V134.73a19.94,19.94,0,0,0-12.62-18.59l-24.86-9.81a4,4,0,0,1-2.26-5.14l21.33-53A32,32,0,0,0,167.17,6,32.13,32.13,0,0,0,126.25,24.2l-.07.18-21,53.09a3.94,3.94,0,0,1-2.14,2.2,3.89,3.89,0,0,1-3,.06L74.6,69.43A19.89,19.89,0,0,0,52.87,74C31.06,96.43,20,122.68,20,152a115.46,115.46,0,0,0,32.29,80.3A12,12,0,0,0,61,236H232a12,12,0,0,0,5.24-22.79ZM68.19,92.73,91.06,102A28,28,0,0,0,127.5,86.31l20.95-53a8.32,8.32,0,0,1,10.33-4.81,8,8,0,0,1,4.61,10.57,1.17,1.17,0,0,0,0,.11L142,92.29a28.05,28.05,0,0,0,15.68,36.33L180,137.45V152c0,1,0,2.07.05,3.1l-122.44-49A101.91,101.91,0,0,1,68.19,92.73ZM116.74,212a83.73,83.73,0,0,1-22.09-39,12,12,0,0,0-23.25,6,110.27,110.27,0,0,0,14.49,33H66.25A91.53,91.53,0,0,1,44,152a84,84,0,0,1,3.41-24.11l136.67,54.66A86.58,86.58,0,0,0,198.66,212Z"},child:[]}]})(e)}function Ede(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M224,160a12,12,0,0,0,0-24H212V120h12a12,12,0,0,0,0-24H210.45a83.7,83.7,0,0,0-18.78-38.7l16.82-16.81a12,12,0,1,0-17-17l-18,18a83.7,83.7,0,0,0-91.1,0l-18-18a12,12,0,0,0-17,17L64.33,57.3A83.7,83.7,0,0,0,45.55,96H32a12,12,0,0,0,0,24H44v16H32a12,12,0,0,0,0,24H44a83.55,83.55,0,0,0,1.55,16H32a12,12,0,0,0,0,24H54.15a84,84,0,0,0,147.7,0H224a12,12,0,0,0,0-24H210.45A83.55,83.55,0,0,0,212,160ZM128,52a60.1,60.1,0,0,1,57.82,44H70.18A60.1,60.1,0,0,1,128,52Zm12,166.79V148a12,12,0,0,0-24,0v70.79A60.09,60.09,0,0,1,68,160V120H188v40A60.09,60.09,0,0,1,140,218.79Z"},child:[]}]})(e)}function Di(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216.49,104.49l-80,80a12,12,0,0,1-17,0l-80-80a12,12,0,0,1,17-17L128,159l71.51-71.52a12,12,0,0,1,17,17Z"},child:[]}]})(e)}function Nj(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M168.49,199.51a12,12,0,0,1-17,17l-80-80a12,12,0,0,1,0-17l80-80a12,12,0,0,1,17,17L97,128Z"},child:[]}]})(e)}function ab(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M184.49,136.49l-80,80a12,12,0,0,1-17-17L159,128,87.51,56.49a12,12,0,1,1,17-17l80,80A12,12,0,0,1,184.49,136.49Z"},child:[]}]})(e)}function $R(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216.49,168.49a12,12,0,0,1-17,0L128,97,56.49,168.49a12,12,0,0,1-17-17l80-80a12,12,0,0,1,17,0l80,80A12,12,0,0,1,216.49,168.49Z"},child:[]}]})(e)}function og(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M232.49,80.49l-128,128a12,12,0,0,1-17,0l-56-56a12,12,0,1,1,17-17L96,183,215.51,63.51a12,12,0,0,1,17,17Z"},child:[]}]})(e)}function Mde(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M128,20A108,108,0,1,0,236,128,108.12,108.12,0,0,0,128,20Zm0,192a84,84,0,1,1,84-84A84.09,84.09,0,0,1,128,212Z"},child:[]}]})(e)}function Pde(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M236,128a108,108,0,0,1-216,0c0-42.52,24.73-81.34,63-98.9A12,12,0,1,1,93,50.91C63.24,64.57,44,94.83,44,128a84,84,0,0,0,168,0c0-33.17-19.24-63.43-49-77.09A12,12,0,1,1,173,29.1C211.27,46.66,236,85.48,236,128Z"},child:[]}]})(e)}function VR(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208,28H48A20,20,0,0,0,28,48V208a20,20,0,0,0,20,20H208a20,20,0,0,0,20-20V48A20,20,0,0,0,208,28ZM52,52H76v95.22a24,24,0,1,0,24,0V125l40,40v39H52ZM204,204H164V160a12,12,0,0,0-3.51-8.49L100,91V52h24V72a12,12,0,0,0,3.51,8.49l17.31,17.3a24,24,0,1,0,17-17L148,67V52h56Z"},child:[]}]})(e)}function Lde(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M71.68,97.22,34.74,128l36.94,30.78a12,12,0,1,1-15.36,18.44l-48-40a12,12,0,0,1,0-18.44l48-40A12,12,0,0,1,71.68,97.22Zm176,21.56-48-40a12,12,0,1,0-15.36,18.44L221.26,128l-36.94,30.78a12,12,0,1,0,15.36,18.44l48-40a12,12,0,0,0,0-18.44ZM164.1,28.72a12,12,0,0,0-15.38,7.18l-64,176a12,12,0,0,0,7.18,15.37A11.79,11.79,0,0,0,96,228a12,12,0,0,0,11.28-7.9l64-176A12,12,0,0,0,164.1,28.72Z"},child:[]}]})(e)}function un(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,28H88A12,12,0,0,0,76,40V76H40A12,12,0,0,0,28,88V216a12,12,0,0,0,12,12H168a12,12,0,0,0,12-12V180h36a12,12,0,0,0,12-12V40A12,12,0,0,0,216,28ZM156,204H52V100H156Zm48-48H180V88a12,12,0,0,0-12-12H100V52H204Z"},child:[]}]})(e)}function zR(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M244,192a12,12,0,0,1-12,12H204v28a12,12,0,0,1-24,0V204H64a12,12,0,0,1-12-12V76H24a12,12,0,0,1,0-24H52V24a12,12,0,0,1,24,0V180H232A12,12,0,0,1,244,192ZM104,76h76v76a12,12,0,0,0,24,0V64a12,12,0,0,0-12-12H104a12,12,0,0,0,0,24Z"},child:[]}]})(e)}function Dde(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M225.6,62.64l-88-48.17a19.91,19.91,0,0,0-19.2,0l-88,48.17A20,20,0,0,0,20,80.19v95.62a20,20,0,0,0,10.4,17.55l88,48.17a19.89,19.89,0,0,0,19.2,0l88-48.17A20,20,0,0,0,236,175.81V80.19A20,20,0,0,0,225.6,62.64ZM128,36.57,200,76,128,115.4,56,76ZM44,96.79l72,39.4v76.67L44,173.44Zm96,116.07V136.19l72-39.4v76.65Z"},child:[]}]})(e)}function Rde(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M224.15,179.17l-46.83-46.82,37.93-13.51.76-.3a20,20,0,0,0-1.76-37.27L54.16,29A20,20,0,0,0,29,54.16L81.27,214.24A20,20,0,0,0,118.54,216c.11-.25.21-.5.3-.76l13.51-37.92,46.83,46.82a20,20,0,0,0,28.28,0l16.69-16.68A20,20,0,0,0,224.15,179.17Zm-30.83,25.17-48.48-48.48A20,20,0,0,0,130.7,150a20.66,20.66,0,0,0-3.74.35A20,20,0,0,0,112.35,162c-.11.25-.21.5-.3.76L100.4,195.5,54.29,54.29l141.21,46.1-32.71,11.66c-.26.09-.51.19-.76.3a20,20,0,0,0-6.17,32.48h0l48.49,48.48Z"},child:[]}]})(e)}function GR(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M144,128a16,16,0,1,1-16-16A16,16,0,0,1,144,128ZM60,112a16,16,0,1,0,16,16A16,16,0,0,0,60,112Zm136,0a16,16,0,1,0,16,16A16,16,0,0,0,196,112Z"},child:[]}]})(e)}function HR(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M71.51,88.49a12,12,0,0,1,17-17L116,99V24a12,12,0,0,1,24,0V99l27.51-27.52a12,12,0,0,1,17,17l-48,48a12,12,0,0,1-17,0ZM224,116H188a12,12,0,0,0,0,24h32v56H36V140H68a12,12,0,0,0,0-24H32a20,20,0,0,0-20,20v64a20,20,0,0,0,20,20H224a20,20,0,0,0,20-20V136A20,20,0,0,0,224,116Zm-20,52a16,16,0,1,0-16,16A16,16,0,0,0,204,168Z"},child:[]}]})(e)}function md(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,144v64a12,12,0,0,1-12,12H40a12,12,0,0,1-12-12V144a12,12,0,0,1,24,0v52H204V144a12,12,0,0,1,24,0Zm-108.49,8.49a12,12,0,0,0,17,0l40-40a12,12,0,0,0-17-17L140,115V32a12,12,0,0,0-24,0v83L96.49,95.51a12,12,0,0,0-17,17Z"},child:[]}]})(e)}function Ode(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M134.88,6.17a12,12,0,0,0-13.76,0,259,259,0,0,0-42.18,39C50.85,77.43,36,111.63,36,144a92,92,0,0,0,184,0C220,66.64,138.36,8.6,134.88,6.17ZM194.08,160H140V144h56A68,68,0,0,1,194.08,160ZM140,120V104h47a115,115,0,0,1,5.68,16Zm19.3-58.71A197.29,197.29,0,0,1,173.68,80H140V41.46A243.5,243.5,0,0,1,159.3,61.29ZM60,144c0-33.31,20-63.37,36.7-82.71A243.5,243.5,0,0,1,116,41.46V210.92A68.1,68.1,0,0,1,60,144Zm80,66.92V184h42.94A68,68,0,0,1,140,210.92Z"},child:[]}]})(e)}function Nde(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,204H141l86.84-86.84a28,28,0,0,0,0-39.6L186.43,36.19a28,28,0,0,0-39.6,0L28.19,154.82a28,28,0,0,0,0,39.6l30.06,30.07A12,12,0,0,0,66.74,228H216a12,12,0,0,0,0-24ZM163.8,53.16a4,4,0,0,1,5.66,0l41.38,41.38a4,4,0,0,1,0,5.65L160,151l-47-47ZM71.71,204,45.16,177.45a4,4,0,0,1,0-5.65L96,121l47,47-36,36Z"},child:[]}]})(e)}function WR(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M148,200a20,20,0,1,1-20-20A20,20,0,0,1,148,200Zm-20-40a12,12,0,0,0,12-12V48a12,12,0,0,0-24,0V148A12,12,0,0,0,128,160Z"},child:[]}]})(e)}function yd(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M251,123.13c-.37-.81-9.13-20.26-28.48-39.61C196.63,57.67,164,44,128,44S59.37,57.67,33.51,83.52C14.16,102.87,5.4,122.32,5,123.13a12.08,12.08,0,0,0,0,9.75c.37.82,9.13,20.26,28.49,39.61C59.37,198.34,92,212,128,212s68.63-13.66,94.48-39.51c19.36-19.35,28.12-38.79,28.49-39.61A12.08,12.08,0,0,0,251,123.13Zm-46.06,33C183.47,177.27,157.59,188,128,188s-55.47-10.73-76.91-31.88A130.36,130.36,0,0,1,29.52,128,130.45,130.45,0,0,1,51.09,99.89C72.54,78.73,98.41,68,128,68s55.46,10.73,76.91,31.89A130.36,130.36,0,0,1,226.48,128,130.45,130.45,0,0,1,204.91,156.12ZM128,84a44,44,0,1,0,44,44A44.05,44.05,0,0,0,128,84Zm0,64a20,20,0,1,1,20-20A20,20,0,0,1,128,148Z"},child:[]}]})(e)}function Fde(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M234.42,162A12,12,0,1,1,213.58,174l-16.86-29.5a127.19,127.19,0,0,1-30.17,13.86L171.84,190a12,12,0,0,1-9.87,13.8,11.22,11.22,0,0,1-2,.17,12,12,0,0,1-11.82-10L143,163.17a136.5,136.5,0,0,1-30.06,0L107.84,194A12,12,0,0,1,96,204a11.22,11.22,0,0,1-2-.17A12,12,0,0,1,84.16,190l5.29-31.72a127.19,127.19,0,0,1-30.17-13.86L42.42,174A12,12,0,1,1,21.58,162L40,129.85a159.73,159.73,0,0,1-17.31-18.31A12,12,0,0,1,41.34,96.46C57.38,116.32,85.44,140,128,140s70.62-23.68,86.66-43.54a12,12,0,0,1,18.67,15.08A159.73,159.73,0,0,1,216,129.85Z"},child:[]}]})(e)}function Bde(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M56.88,31.93A12,12,0,1,0,39.12,48.07l16,17.65C20.67,88.66,5.72,121.58,5,123.13a12.08,12.08,0,0,0,0,9.75c.37.82,9.13,20.26,28.49,39.61C59.37,198.34,92,212,128,212a131.34,131.34,0,0,0,51-10l20.09,22.1a12,12,0,0,0,17.76-16.14ZM128,188c-29.59,0-55.47-10.73-76.91-31.88A130.69,130.69,0,0,1,29.52,128c5.27-9.31,18.79-29.9,42-44.29l90.09,99.11A109.33,109.33,0,0,1,128,188Zm123-55.12c-.36.81-9,20-28,39.16a12,12,0,1,1-17-16.9A130.48,130.48,0,0,0,226.48,128a130.36,130.36,0,0,0-21.57-28.12C183.46,78.73,157.59,68,128,68c-3.35,0-6.7.14-10,.42a12,12,0,1,1-2-23.91c3.93-.34,8-.51,12-.51,36,0,68.63,13.67,94.49,39.52,19.35,19.35,28.11,38.8,28.48,39.61A12.08,12.08,0,0,1,251,132.88Z"},child:[]}]})(e)}function $de(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,67.24a39.77,39.77,0,0,0-12.51-28.52C199.91,24,174.71,24.5,159.29,39.93L142.48,56.84a28,28,0,0,0-35.64,3.29l-9,9a20,20,0,0,0-.73,27.49L48.9,144.84A43.76,43.76,0,0,0,37,185.28l-7.5,17.19a17.66,17.66,0,0,0,3.71,19.65,19.9,19.9,0,0,0,22.15,4.19l16.31-7.13a43.88,43.88,0,0,0,39.45-12.09l48.24-48.26a20,20,0,0,0,27.47-.73l9-9a28.06,28.06,0,0,0,3.26-35.72l17.23-17.33A39.69,39.69,0,0,0,228,67.24ZM94.15,190.11a20,20,0,0,1-20,5,11.93,11.93,0,0,0-8.32.47L57,199.38,60.69,191a12,12,0,0,0,.37-8.64,19.92,19.92,0,0,1,4.81-20.55l48.2-48.22,28.28,28.3Zm105.14-111-25.37,25.52a12,12,0,0,0,0,16.95l4.88,4.89a4,4,0,0,1,0,5.66l-6.14,6.15-55-55.05,6.14-6.14a4,4,0,0,1,5.65,0L134.35,82a12,12,0,0,0,8.49,3.51h0A12,12,0,0,0,151.34,82l24.94-25.08c6.3-6.3,16.48-6.63,22.71-.74a16,16,0,0,1,.3,23Z"},child:[]}]})(e)}function fm(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216.49,79.52l-56-56A12,12,0,0,0,152,20H56A20,20,0,0,0,36,40V216a20,20,0,0,0,20,20H200a20,20,0,0,0,20-20V88A12,12,0,0,0,216.49,79.52ZM160,57l23,23H160ZM60,212V44h76V92a12,12,0,0,0,12,12h48V212Z"},child:[]}]})(e)}function ep(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216.49,79.51l-56-56A12,12,0,0,0,152,20H56A20,20,0,0,0,36,40V216a20,20,0,0,0,20,20H200a20,20,0,0,0,20-20V88A12,12,0,0,0,216.49,79.51ZM160,57l23,23H160ZM60,212V44h76V92a12,12,0,0,0,12,12h48V212Zm104-60a12,12,0,0,1-12,12H140v12a12,12,0,0,1-24,0V164H104a12,12,0,0,1,0-24h12V128a12,12,0,0,1,24,0v12h12A12,12,0,0,1,164,152Z"},child:[]}]})(e)}function Fj(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M225.15,197.71,164,95.81V44h4a12,12,0,0,0,0-24H88a12,12,0,0,0,0,24h4V95.81L30.85,197.71A20,20,0,0,0,48,228H208a20,20,0,0,0,17.15-30.29ZM140,44V99.14a12,12,0,0,0,1.71,6.17l35.13,58.54c-10.79.86-25.15-1.31-43.42-10.56-14-7.08-27.46-11.33-40.27-12.76l21.14-35.22A12,12,0,0,0,116,99.14V44ZM55.06,204,79,164.19c13-1.11,27.62,2.42,43.62,10.52,19.61,9.92,36.25,13.31,49.85,13.31A75.44,75.44,0,0,0,190.11,186l10.83,18Z"},child:[]}]})(e)}function so(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M222.14,69.17,186.83,33.86A19.86,19.86,0,0,0,172.69,28H48A20,20,0,0,0,28,48V208a20,20,0,0,0,20,20H208a20,20,0,0,0,20-20V83.31A19.86,19.86,0,0,0,222.14,69.17ZM164,204H92V160h72Zm40,0H188V156a20,20,0,0,0-20-20H88a20,20,0,0,0-20,20v48H52V52H171l33,33ZM164,84a12,12,0,0,1-12,12H96a12,12,0,0,1,0-24h56A12,12,0,0,1,164,84Z"},child:[]}]})(e)}function lb(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M248.49,71.51l-32-32a12,12,0,0,0-17,17L211,68h-3c-52,0-64.8,30.71-75.08,55.38-8.82,21.17-15.45,37.05-42.75,40.09a44,44,0,1,0,.28,24.08c43.34-3.87,55.07-32,64.63-54.93C164.9,109,172,92,208,92h3l-11.52,11.51a12,12,0,0,0,17,17l32-32A12,12,0,0,0,248.49,71.51ZM48,196a20,20,0,1,1,20-20A20,20,0,0,1,48,196Z"},child:[]}]})(e)}function UR(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,56H160L133.33,36a20.12,20.12,0,0,0-12-4H76A20,20,0,0,0,56,52V72H36A20,20,0,0,0,16,92V204a20,20,0,0,0,20,20H188.89A19.13,19.13,0,0,0,208,204.89V184h20.89A19.13,19.13,0,0,0,248,164.89V76A20,20,0,0,0,228,56ZM184,200H40V96H80l28.8,21.6A12,12,0,0,0,116,120h68Zm40-40H208V116a20,20,0,0,0-20-20H120L93.33,76a20.12,20.12,0,0,0-12-4H80V56h40l28.8,21.6A12,12,0,0,0,156,80h68Z"},child:[]}]})(e)}function ag(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M140,88a12,12,0,0,1,12-12h32a12,12,0,0,1,12,12v32a12,12,0,0,1-24,0V100H152A12,12,0,0,1,140,88ZM72,180h32a12,12,0,0,0,0-24H84V136a12,12,0,0,0-24,0v32A12,12,0,0,0,72,180ZM236,56V200a20,20,0,0,1-20,20H40a20,20,0,0,1-20-20V56A20,20,0,0,1,40,36H216A20,20,0,0,1,236,56Zm-24,4H44V196H212Z"},child:[]}]})(e)}function Vde(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M234.29,47.91A20,20,0,0,0,216,36H40A20,20,0,0,0,25.2,69.45l.12.14L92,140.75V216a20,20,0,0,0,31.1,16.64l32-21.33A20,20,0,0,0,164,194.66V140.75l66.67-71.16.12-.14A20,20,0,0,0,234.29,47.91Zm-91,79.89A12,12,0,0,0,140,136v56.52l-24,16V136a12,12,0,0,0-3.25-8.2L49.23,60H206.77Z"},child:[]}]})(e)}function zde(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M240,116H219.22A92.21,92.21,0,0,0,140,36.78V16a12,12,0,0,0-24,0V36.78A92.21,92.21,0,0,0,36.78,116H16a12,12,0,0,0,0,24H36.78A92.21,92.21,0,0,0,116,219.22V240a12,12,0,0,0,24,0V219.22A92.21,92.21,0,0,0,219.22,140H240a12,12,0,0,0,0-24ZM128,196a68,68,0,1,1,68-68A68.07,68.07,0,0,1,128,196Zm0-112a44,44,0,1,0,44,44A44.05,44.05,0,0,0,128,84Zm0,64a20,20,0,1,1,20-20A20,20,0,0,1,128,148Z"},child:[]}]})(e)}function qR(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M250.18,105.17,186.71,41.25a100.11,100.11,0,0,0-141.43,0l-.13.14L31.37,55.61a12,12,0,1,0,17.24,16.7L62.32,58.16A75.68,75.68,0,0,1,77.49,46.43L119,88,25.85,181.16a20,20,0,0,0,0,28.29l20.69,20.69a20,20,0,0,0,28.28,0L168,137l1.51,1.51h0l23.65,23.66a20,20,0,0,0,28.29,0l28.69-28.7A20,20,0,0,0,250.18,105.17ZM60.68,210.34l-15-15L108,133l15,15ZM140,131l-15-15,19.51-19.51a12,12,0,0,0,0-17L102.24,37.24a75.94,75.94,0,0,1,67.47,20.95l31.44,31.67L178,113l-1.51-1.51a12,12,0,0,0-17,0Zm67.32,11.31L195,130l23.09-23.09,12.3,12.39Z"},child:[]}]})(e)}function Gde(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M188,44a32,32,0,0,0-8,1V44a32,32,0,0,0-60.79-14A32,32,0,0,0,76,60v50.83a32,32,0,0,0-52,36.7C55.82,214.6,75.35,244,128,244a92.1,92.1,0,0,0,92-92V76A32,32,0,0,0,188,44Zm8,108a68.08,68.08,0,0,1-68,68c-35.83,0-49.71-14-82.48-83.14-.14-.29-.29-.58-.45-.86a8,8,0,0,1,13.85-8l.21.35,18.68,30A12,12,0,0,0,100,152V60a8,8,0,0,1,16,0v60a12,12,0,0,0,24,0V44a8,8,0,0,1,16,0v76a12,12,0,0,0,24,0V76a8,8,0,0,1,16,0Z"},child:[]}]})(e)}function Hde(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M184,20H72A20,20,0,0,0,52,40V76a20.1,20.1,0,0,0,8,16l48,36L60,164a20.1,20.1,0,0,0-8,16v36a20,20,0,0,0,20,20H184a20,20,0,0,0,20-20V180.36a20.13,20.13,0,0,0-7.94-16L147.9,128l48.16-36.4a20.13,20.13,0,0,0,7.94-16V40A20,20,0,0,0,184,20Zm-4,24V60H76V44Zm-52,69L89.33,84h77Zm52,99H76V182l52-39,52,39.33Z"},child:[]}]})(e)}function Gu(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M144,96a16,16,0,1,1,16,16A16,16,0,0,1,144,96Zm92-40V200a20,20,0,0,1-20,20H40a20,20,0,0,1-20-20V56A20,20,0,0,1,40,36H216A20,20,0,0,1,236,56ZM44,60v79.72l33.86-33.86a20,20,0,0,1,28.28,0L147.31,147l17.18-17.17a20,20,0,0,1,28.28,0L212,149.09V60Zm0,136H162.34L92,125.66l-48,48Zm168,0V183l-33.37-33.37L164.28,164l32,32Z"},child:[]}]})(e)}function KR(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M160,88a16,16,0,1,1,16,16A16,16,0,0,1,160,88Zm76-32V160a20,20,0,0,1-20,20H204v20a20,20,0,0,1-20,20H40a20,20,0,0,1-20-20V88A20,20,0,0,1,40,68H60V56A20,20,0,0,1,80,36H216A20,20,0,0,1,236,56ZM180,180H80a20,20,0,0,1-20-20V92H44V196H180Zm-21.66-24L124,121.66,89.66,156ZM212,60H84v67.72l25.86-25.86a20,20,0,0,1,28.28,0L192.28,156H212Z"},child:[]}]})(e)}function Wde(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208,28H88A20,20,0,0,0,68,48V60H48A20,20,0,0,0,28,80V208a20,20,0,0,0,20,20H176a20,20,0,0,0,20-20V188h12a20,20,0,0,0,20-20V48A20,20,0,0,0,208,28ZM92,52H204v59.72l-9.86-9.86a20,20,0,0,0-28.28,0L103.72,164H92Zm80,152H52V84H68v84a20,20,0,0,0,20,20h84Zm-34.34-40L180,121.66l24,24V164ZM108,88a20,20,0,1,1,20,20A20,20,0,0,1,108,88Z"},child:[]}]})(e)}function bd(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M108,84a16,16,0,1,1,16,16A16,16,0,0,1,108,84Zm128,44A108,108,0,1,1,128,20,108.12,108.12,0,0,1,236,128Zm-24,0a84,84,0,1,0-84,84A84.09,84.09,0,0,0,212,128Zm-72,36.68V132a20,20,0,0,0-20-20,12,12,0,0,0-4,23.32V168a20,20,0,0,0,20,20,12,12,0,0,0,4-23.32Z"},child:[]}]})(e)}function Ude(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M224,44H32A20,20,0,0,0,12,64V192a20,20,0,0,0,20,20H224a20,20,0,0,0,20-20V64A20,20,0,0,0,224,44Zm-4,144H36V68H220ZM52,128a12,12,0,0,1,12-12H192a12,12,0,0,1,0,24H64A12,12,0,0,1,52,128Zm0-36A12,12,0,0,1,64,80H192a12,12,0,0,1,0,24H64A12,12,0,0,1,52,92Zm0,72a12,12,0,0,1,12-12h8a12,12,0,0,1,0,24H64A12,12,0,0,1,52,164Zm108,0a12,12,0,0,1-12,12H108a12,12,0,0,1,0-24h40A12,12,0,0,1,160,164Zm44,0a12,12,0,0,1-12,12h-8a12,12,0,0,1,0-24h8A12,12,0,0,1,204,164Z"},child:[]}]})(e)}function qde(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M180,232a12,12,0,0,1-12,12H88a12,12,0,0,1,0-24h80A12,12,0,0,1,180,232Zm40-128a92.47,92.47,0,0,1-37,73.73,7.81,7.81,0,0,0-3,6.27,20,20,0,0,1-20,20H96a20,20,0,0,1-20-20v-.23a7.76,7.76,0,0,0-3.25-6.2,91.36,91.36,0,0,1-36.75-73C35.73,54.69,76,13.2,125.79,12A92,92,0,0,1,220,104Zm-24,0a68,68,0,0,0-69.65-68C89.56,36.89,59.8,67.56,60,104.39a67.52,67.52,0,0,0,27.18,54h0A32.14,32.14,0,0,1,99.77,180H116V149L87.51,120.49a12,12,0,0,1,17-17L128,127l23.51-23.51a12,12,0,0,1,17,17L140,149v31h16.25a31.89,31.89,0,0,1,12.41-21.49A67.45,67.45,0,0,0,196,104Z"},child:[]}]})(e)}function Kde(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M87.5,151.52l64-64a12,12,0,0,1,17,17l-64,64a12,12,0,0,1-17-17Zm131-114a60.08,60.08,0,0,0-84.87,0L103.51,67.61a12,12,0,0,0,17,17l30.07-30.06a36,36,0,0,1,50.93,50.92L171.4,135.52a12,12,0,1,0,17,17l30.08-30.06A60.09,60.09,0,0,0,218.45,37.55ZM135.52,171.4l-30.07,30.08a36,36,0,0,1-50.92-50.93l30.06-30.07a12,12,0,0,0-17-17L37.55,133.58a60,60,0,0,0,84.88,84.87l30.06-30.07a12,12,0,0,0-17-17Z"},child:[]}]})(e)}function Zde(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M218.45,122.43l-30.08,30.06a12,12,0,0,1-17-17l30.08-30.07a36,36,0,0,0-50.93-50.92L120.48,84.59a12,12,0,0,1-17-17l30.07-30.06a60,60,0,0,1,84.87,84.88Zm-82.93,49-30.07,30.08a36,36,0,0,1-50.92-50.93l30.06-30.07a12,12,0,0,0-17-17L37.55,133.58a60,60,0,0,0,84.88,84.87l30.06-30.07a12,12,0,0,0-17-17Z"},child:[]}]})(e)}function Yde(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,128a12,12,0,0,1-12,12H40a12,12,0,0,1,0-24H216A12,12,0,0,1,228,128ZM40,76H216a12,12,0,0,0,0-24H40a12,12,0,0,0,0,24ZM216,180H40a12,12,0,0,0,0,24H216a12,12,0,0,0,0-24Z"},child:[]}]})(e)}function Xde(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208,76H180V56A52,52,0,0,0,76,56V76H48A20,20,0,0,0,28,96V208a20,20,0,0,0,20,20H208a20,20,0,0,0,20-20V96A20,20,0,0,0,208,76ZM100,56a28,28,0,0,1,56,0V76H100ZM204,204H52V100H204Zm-60-52a16,16,0,1,1-16-16A16,16,0,0,1,144,152Z"},child:[]}]})(e)}function Qde(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208,76H100V56a28,28,0,0,1,28-28c13.51,0,25.65,9.62,28.24,22.39a12,12,0,1,0,23.52-4.78C174.87,21.5,153.1,4,128,4A52.06,52.06,0,0,0,76,56V76H48A20,20,0,0,0,28,96V208a20,20,0,0,0,20,20H208a20,20,0,0,0,20-20V96A20,20,0,0,0,208,76Zm-4,128H52V100H204Zm-92-52a16,16,0,1,1,16,16A16,16,0,0,1,112,152Z"},child:[]}]})(e)}function ZR(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208,76H100V56a28,28,0,0,1,28-28c13.51,0,25.65,9.62,28.24,22.39a12,12,0,1,0,23.52-4.78C174.87,21.5,153.1,4,128,4A52.06,52.06,0,0,0,76,56V76H48A20,20,0,0,0,28,96V208a20,20,0,0,0,20,20H208a20,20,0,0,0,20-20V96A20,20,0,0,0,208,76Zm-4,128H52V100H204Z"},child:[]}]})(e)}function YR(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M232.49,215.51,185,168a92.12,92.12,0,1,0-17,17l47.53,47.54a12,12,0,0,0,17-17ZM44,112a68,68,0,1,1,68,68A68.07,68.07,0,0,1,44,112Z"},child:[]}]})(e)}function XR(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M156,112a12,12,0,0,1-12,12H80a12,12,0,0,1,0-24h64A12,12,0,0,1,156,112Zm76.49,120.49a12,12,0,0,1-17,0L168,185a92.12,92.12,0,1,1,17-17l47.54,47.53A12,12,0,0,1,232.49,232.49ZM112,180a68,68,0,1,0-68-68A68.08,68.08,0,0,0,112,180Z"},child:[]}]})(e)}function QR(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M156,112a12,12,0,0,1-12,12H124v20a12,12,0,0,1-24,0V124H80a12,12,0,0,1,0-24h20V80a12,12,0,0,1,24,0v20h20A12,12,0,0,1,156,112Zm76.49,120.49a12,12,0,0,1-17,0L168,185a92.12,92.12,0,1,1,17-17l47.54,47.53A12,12,0,0,1,232.49,232.49ZM112,180a68,68,0,1,0-68-68A68.08,68.08,0,0,0,112,180Z"},child:[]}]})(e)}function Jde(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M128,60a44,44,0,1,0,44,44A44.05,44.05,0,0,0,128,60Zm0,64a20,20,0,1,1,20-20A20,20,0,0,1,128,124Zm0-112a92.1,92.1,0,0,0-92,92c0,77.36,81.64,135.4,85.12,137.83a12,12,0,0,0,13.76,0,259,259,0,0,0,42.18-39C205.15,170.57,220,136.37,220,104A92.1,92.1,0,0,0,128,12Zm31.3,174.71A249.35,249.35,0,0,1,128,216.89a249.35,249.35,0,0,1-31.3-30.18C80,167.37,60,137.31,60,104a68,68,0,0,1,136,0C196,137.31,176,167.37,159.3,186.71Z"},child:[]}]})(e)}function ehe(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M84,108A12,12,0,0,1,96,96h64a12,12,0,0,1,0,24H96A12,12,0,0,1,84,108Zm32,28H96a12,12,0,0,0,0,24h20a12,12,0,0,0,0-24ZM228,48V156.69a19.86,19.86,0,0,1-5.86,14.14l-51.31,51.31A19.86,19.86,0,0,1,156.69,228H48a20,20,0,0,1-20-20V48A20,20,0,0,1,48,28H208A20,20,0,0,1,228,48ZM52,204h92V156a12,12,0,0,1,12-12h48V52H52Zm139-36H168v23Z"},child:[]}]})(e)}function Bj(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M236,32a12,12,0,0,0-12-12c-44.78,0-90,48.54-115.9,82a64,64,0,0,0-80,62c0,12-3.1,22.71-9.23,31.76A43,43,0,0,1,9.4,206.05a11.88,11.88,0,0,0-4.91,13.38A12.07,12.07,0,0,0,16.11,228h76A64,64,0,0,0,154,148C187.49,122.05,236,76.8,236,32ZM209.62,46.39c-4,12.92-13.15,27.49-26.92,42.91-3,3.39-6.16,6.7-9.35,9.89a104.31,104.31,0,0,0-16.5-16.51c3.19-3.19,6.49-6.32,9.88-9.35C182.15,59.55,196.71,50.43,209.62,46.39ZM92.07,204H42a80.17,80.17,0,0,0,10.14-40,40,40,0,1,1,40,40Zm38.18-91.32c3.12-3.93,6.55-8.09,10.23-12.35a80.52,80.52,0,0,1,15.23,15.24c-4.26,3.68-8.42,7.11-12.35,10.23A64.43,64.43,0,0,0,130.25,112.68Z"},child:[]}]})(e)}function cb(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M230.14,70.54,185.46,25.85a20,20,0,0,0-28.29,0L33.86,149.17A19.85,19.85,0,0,0,28,163.31V208a20,20,0,0,0,20,20H92.69a19.86,19.86,0,0,0,14.14-5.86L230.14,98.82a20,20,0,0,0,0-28.28ZM93,180l71-71,11,11-71,71ZM76,163,65,152l71-71,11,11ZM52,173l15.51,15.51h0L83,204H52ZM192,103,153,64l18.34-18.34,39,39Z"},child:[]}]})(e)}function JR(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M255.62,51.65a12,12,0,0,0-11.27-11.27c-53.27-3.13-96.2,13.36-114.84,44.14-12.14,20-12.56,44.17-1.46,67.3a75.14,75.14,0,0,0-12.28,23l-12.66-12.66c7.19-16.77,6.43-34.11-2.4-48.69C86.73,90.36,54.89,78,15.55,80.27A12,12,0,0,0,4.28,91.55C2,130.89,14.36,162.73,37.45,176.71a49.76,49.76,0,0,0,26,7.27,57.54,57.54,0,0,0,22.7-4.87L112,205v23a12,12,0,0,0,24,0V198.51a51.63,51.63,0,0,1,9.49-29.95,76.82,76.82,0,0,0,32.1,7.39,64.91,64.91,0,0,0,33.89-9.46C242.25,147.85,258.76,104.92,255.62,51.65ZM49.88,156.18c-13.19-8-21.18-27.46-21.83-52.13,24.67.65,44.14,8.64,52.13,21.83a26,26,0,0,1,3.63,17L72.48,131.51a12,12,0,0,0-17,17l11.34,11.34A26.27,26.27,0,0,1,49.88,156.18ZM199.05,146c-10.66,6.45-23,7.67-35.81,3.76l37.25-37.24a12,12,0,0,0-17-17l-37.25,37.24C142.37,120,143.59,107.61,150,97c12.7-21,42.65-33,81.32-33H232C232.14,103,220.14,133.18,199.05,146Z"},child:[]}]})(e)}function Vt(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,128a12,12,0,0,1-12,12H140v76a12,12,0,0,1-24,0V140H40a12,12,0,0,1,0-24h76V40a12,12,0,0,1,24,0v76h76A12,12,0,0,1,228,128Z"},child:[]}]})(e)}function e7(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M28,64A12,12,0,0,1,40,52H216a12,12,0,0,1,0,24H40A12,12,0,0,1,28,64Zm104,52H40a12,12,0,0,0,0,24h92a12,12,0,0,0,0-24Zm0,64H40a12,12,0,0,0,0,24h92a12,12,0,0,0,0-24Zm120-20a12,12,0,0,1-5.64,10.18l-64,40A12,12,0,0,1,164,200V120a12,12,0,0,1,18.36-10.18l64,40A12,12,0,0,1,252,160Zm-34.64,0L188,141.65v36.7Z"},child:[]}]})(e)}function t7(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M100,52H40A20,20,0,0,0,20,72v64a20,20,0,0,0,20,20H96v4a28,28,0,0,1-28,28,12,12,0,0,0,0,24,52.06,52.06,0,0,0,52-52V72A20,20,0,0,0,100,52Zm-4,80H44V76H96ZM216,52H156a20,20,0,0,0-20,20v64a20,20,0,0,0,20,20h56v4a28,28,0,0,1-28,28,12,12,0,0,0,0,24,52.06,52.06,0,0,0,52-52V72A20,20,0,0,0,216,52Zm-4,80H160V76h52Z"},child:[]}]})(e)}function the(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,36H40A20,20,0,0,0,20,56V200a20,20,0,0,0,20,20H216a20,20,0,0,0,20-20V56A20,20,0,0,0,216,36Zm-4,160H44V60H212Z"},child:[]}]})(e)}function nhe(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M136,108H48a12,12,0,0,0-12,12v88a12,12,0,0,0,12,12h88a12,12,0,0,0,12-12V120A12,12,0,0,0,136,108Zm-12,88H60V132h64Zm96-8v12a20,20,0,0,1-20,20H180a12,12,0,0,1,0-24h16v-8a12,12,0,0,1,24,0Zm0-72v24a12,12,0,0,1-24,0V116a12,12,0,0,1,24,0Zm0-60V72a12,12,0,0,1-24,0V60H184a12,12,0,0,1,0-24h16A20,20,0,0,1,220,56Zm-68-8a12,12,0,0,1-12,12H116a12,12,0,0,1,0-24h24A12,12,0,0,1,152,48ZM36,76V56A20,20,0,0,1,56,36H68a12,12,0,0,1,0,24H60V76a12,12,0,0,1-24,0Z"},child:[]}]})(e)}function she(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M238.15,70.54,185.46,17.86a20,20,0,0,0-28.29,0L17.85,157.17a20,20,0,0,0,0,28.29l52.69,52.68a20,20,0,0,0,28.29,0L238.15,98.83A20,20,0,0,0,238.15,70.54ZM84.68,218.34l-47-47L64,145l23.52,23.52a12,12,0,0,0,17-17L81,128l15-15,23.51,23.52a12,12,0,0,0,17-17L113,96l15-15,23.52,23.52a12,12,0,0,0,17-17L145,64l26.35-26.34,47,47Z"},child:[]}]})(e)}function rhe(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M156,216a12,12,0,0,1-12,12H112a12,12,0,0,1,0-24h32A12,12,0,0,1,156,216ZM40,156a12,12,0,0,0,12-12V112a12,12,0,0,0-24,0v32A12,12,0,0,0,40,156Zm32,48H52V184a12,12,0,0,0-24,0v24a20,20,0,0,0,20,20H72a12,12,0,0,0,0-24ZM228,48V208a20,20,0,0,1-20,20H184a12,12,0,0,1,0-24h3L52,69v3a12,12,0,0,1-24,0V48A20,20,0,0,1,48,28H208A20,20,0,0,1,228,48Zm-24,4H69L204,187Z"},child:[]}]})(e)}function n7(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M240.49,103.52l-80-80A12,12,0,0,0,140,32V68.74c-25.76,3.12-53.66,15.89-76.75,35.47-29.16,24.74-47.32,56.69-51.14,90A16,16,0,0,0,39.67,207h0c10.46-11.14,47-45.74,100.33-50.42V192a12,12,0,0,0,20.48,8.48l80-80A12,12,0,0,0,240.49,103.52ZM164,163V144a12,12,0,0,0-12-12c-49,0-86.57,21.56-109.79,40.11,7.13-18.16,19.63-35.22,36.57-49.59C101.3,103.41,128.67,92,152,92a12,12,0,0,0,12-12V61l51,51Z"},child:[]}]})(e)}function ihe(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M240.49,175.51a12,12,0,0,1,0,17l-24,24a12,12,0,0,1-17-17L203,196h-2.09a76.17,76.17,0,0,1-61.85-31.83L97.38,105.78A52.1,52.1,0,0,0,55.06,84H32a12,12,0,0,1,0-24H55.06a76.17,76.17,0,0,1,61.85,31.83l41.71,58.39A52.1,52.1,0,0,0,200.94,172H203l-3.52-3.51a12,12,0,0,1,17-17Zm-95.62-72.62a12,12,0,0,0,16.93-1.13A52,52,0,0,1,200.94,84H203l-3.52,3.51a12,12,0,0,0,17,17l24-24a12,12,0,0,0,0-17l-24-24a12,12,0,0,0-17,17L203,60h-2.09a76,76,0,0,0-57.2,26A12,12,0,0,0,144.87,102.89Zm-33.74,50.22a12,12,0,0,0-16.93,1.13A52,52,0,0,1,55.06,172H32a12,12,0,0,0,0,24H55.06a76,76,0,0,0,57.2-26A12,12,0,0,0,111.13,153.11Z"},child:[]}]})(e)}function ohe(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M40,92H70.06a36,36,0,0,0,67.88,0H216a12,12,0,0,0,0-24H137.94a36,36,0,0,0-67.88,0H40a12,12,0,0,0,0,24Zm64-24A12,12,0,1,1,92,80,12,12,0,0,1,104,68Zm112,96H201.94a36,36,0,0,0-67.88,0H40a12,12,0,0,0,0,24h94.06a36,36,0,0,0,67.88,0H216a12,12,0,0,0,0-24Zm-48,24a12,12,0,1,1,12-12A12,12,0,0,1,168,188Z"},child:[]}]})(e)}function ahe(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M234.36,170A12,12,0,0,1,230,186.37l-96,56a12,12,0,0,1-12.1,0l-96-56a12,12,0,0,1,12.09-20.74l90,52.48L218,165.63A12,12,0,0,1,234.36,170ZM218,117.63,128,170.11,38.05,117.63A12,12,0,0,0,26,138.37l96,56a12,12,0,0,0,12.1,0l96-56A12,12,0,0,0,218,117.63ZM20,80a12,12,0,0,1,6-10.37l96-56a12.06,12.06,0,0,1,12.1,0l96,56a12,12,0,0,1,0,20.74l-96,56a12,12,0,0,1-12.1,0l-96-56A12,12,0,0,1,20,80Zm35.82,0L128,122.11,200.18,80,128,37.89Z"},child:[]}]})(e)}function s7(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M10.05,110.42l112,64a12,12,0,0,0,11.9,0l112-64a12,12,0,0,0,0-20.84l-112-64a12,12,0,0,0-11.9,0l-112,64a12,12,0,0,0,0,20.84Zm118-60.6L215.81,100,128,150.18,40.19,100Zm122.42,92.23A12,12,0,0,1,246,158.42l-112,64a12,12,0,0,1-11.9,0l-112-64A12,12,0,1,1,22,137.58l106,60.6,106-60.6A12,12,0,0,1,250.42,142.05Z"},child:[]}]})(e)}function $j(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M243,96a20.33,20.33,0,0,0-17.74-14l-56.59-4.57L146.83,24.62a20.36,20.36,0,0,0-37.66,0L87.35,77.44,30.76,82A20.45,20.45,0,0,0,19.1,117.88l43.18,37.24-13.2,55.7A20.37,20.37,0,0,0,79.57,233L128,203.19,176.43,233a20.39,20.39,0,0,0,30.49-22.15l-13.2-55.7,43.18-37.24A20.43,20.43,0,0,0,243,96ZM172.53,141.7a12,12,0,0,0-3.84,11.86L181.58,208l-47.29-29.08a12,12,0,0,0-12.58,0L74.42,208l12.89-54.4a12,12,0,0,0-3.84-11.86L41.2,105.24l55.4-4.47a12,12,0,0,0,10.13-7.38L128,41.89l21.27,51.5a12,12,0,0,0,10.13,7.38l55.4,4.47Z"},child:[]}]})(e)}function Qr(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,48V152a20,20,0,0,1-20,20H112.92a12,12,0,0,1-17.41,16.49l-20-20a12,12,0,0,1,0-17l20-20A12,12,0,0,1,112.92,148H204V52H100a12,12,0,0,1-24,0V48A20,20,0,0,1,96,28H208A20,20,0,0,1,228,48ZM168,192a12,12,0,0,0-12,12H52V108h91.08a12,12,0,0,0,17.41,16.49l20-20a12,12,0,0,0,0-17l-20-20A12,12,0,0,0,143.08,84H48a20,20,0,0,0-20,20V208a20,20,0,0,0,20,20H160a20,20,0,0,0,20-20v-4A12,12,0,0,0,168,192Z"},child:[]}]})(e)}function Vj(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,48H180V36A28,28,0,0,0,152,8H104A28,28,0,0,0,76,36V48H40a12,12,0,0,0,0,24h4V208a20,20,0,0,0,20,20H192a20,20,0,0,0,20-20V72h4a12,12,0,0,0,0-24ZM100,36a4,4,0,0,1,4-4h48a4,4,0,0,1,4,4V48H100Zm88,168H68V72H188ZM116,104v64a12,12,0,0,1-24,0V104a12,12,0,0,1,24,0Zm48,0v64a12,12,0,0,1-24,0V104a12,12,0,0,1,24,0Z"},child:[]}]})(e)}function ri(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,48H40a12,12,0,0,0,0,24h4V208a20,20,0,0,0,20,20H192a20,20,0,0,0,20-20V72h4a12,12,0,0,0,0-24ZM188,204H68V72H188ZM76,20A12,12,0,0,1,88,8h80a12,12,0,0,1,0,24H88A12,12,0,0,1,76,20Z"},child:[]}]})(e)}function lg(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M188,184a16,16,0,1,1,16-16A16,16,0,0,1,188,184Zm36-68H180a12,12,0,0,0,0,24h40v56H36V140H76a12,12,0,0,0,0-24H32a20,20,0,0,0-20,20v64a20,20,0,0,0,20,20H224a20,20,0,0,0,20-20V136A20,20,0,0,0,224,116ZM88.49,80.49,116,53v75a12,12,0,0,0,24,0V53l27.51,27.52a12,12,0,1,0,17-17l-48-48a12,12,0,0,0-17,0l-48,48a12,12,0,1,0,17,17Z"},child:[]}]})(e)}function cg(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,144v64a12,12,0,0,1-12,12H40a12,12,0,0,1-12-12V144a12,12,0,0,1,24,0v52H204V144a12,12,0,0,1,24,0ZM96.49,80.49,116,61v83a12,12,0,0,0,24,0V61l19.51,19.52a12,12,0,1,0,17-17l-40-40a12,12,0,0,0-17,0l-40,40a12,12,0,1,0,17,17Z"},child:[]}]})(e)}function zj(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M125.18,156.94a64,64,0,1,0-82.36,0,100.23,100.23,0,0,0-39.49,32,12,12,0,0,0,19.35,14.2,76,76,0,0,1,122.64,0,12,12,0,0,0,19.36-14.2A100.33,100.33,0,0,0,125.18,156.94ZM44,108a40,40,0,1,1,40,40A40,40,0,0,1,44,108Zm206.1,97.67a12,12,0,0,1-16.78-2.57A76.31,76.31,0,0,0,172,172a12,12,0,0,1,0-24,40,40,0,1,0-10.3-78.67,12,12,0,1,1-6.16-23.19,64,64,0,0,1,57.64,110.8,100.23,100.23,0,0,1,39.49,32A12,12,0,0,1,250.1,205.67Z"},child:[]}]})(e)}function ug(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M240.26,186.1,152.81,34.23h0a28.74,28.74,0,0,0-49.62,0L15.74,186.1a27.45,27.45,0,0,0,0,27.71A28.31,28.31,0,0,0,40.55,228h174.9a28.31,28.31,0,0,0,24.79-14.19A27.45,27.45,0,0,0,240.26,186.1Zm-20.8,15.7a4.46,4.46,0,0,1-4,2.2H40.55a4.46,4.46,0,0,1-4-2.2,3.56,3.56,0,0,1,0-3.73L124,46.2a4.77,4.77,0,0,1,8,0l87.44,151.87A3.56,3.56,0,0,1,219.46,201.8ZM116,136V104a12,12,0,0,1,24,0v32a12,12,0,0,1-24,0Zm28,40a16,16,0,1,1-16-16A16,16,0,0,1,144,176Z"},child:[]}]})(e)}function r7(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M128,20A108,108,0,1,0,236,128,108.12,108.12,0,0,0,128,20Zm0,192a84,84,0,1,1,84-84A84.09,84.09,0,0,1,128,212Zm-12-80V80a12,12,0,0,1,24,0v52a12,12,0,0,1-24,0Zm28,40a16,16,0,1,1-16-16A16,16,0,0,1,144,172Z"},child:[]}]})(e)}function Ot(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208.49,191.51a12,12,0,0,1-17,17L128,145,64.49,208.49a12,12,0,0,1-17-17L111,128,47.51,64.49a12,12,0,0,1,17-17L128,111l63.51-63.52a12,12,0,0,1,17,17L145,128Z"},child:[]}]})(e)}function lhe(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M224,48H32A16,16,0,0,0,16,64V88a16,16,0,0,0,16,16v88a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V104a16,16,0,0,0,16-16V64A16,16,0,0,0,224,48Zm-72,96H104a8,8,0,0,1,0-16h48a8,8,0,0,1,0,16Zm72-56H32V64H224V88Z"},child:[]}]})(e)}function che(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M184,32H72A16,16,0,0,0,56,48V224a8,8,0,0,0,12.24,6.78L128,193.43l59.77,37.35A8,8,0,0,0,200,224V48A16,16,0,0,0,184,32Z"},child:[]}]})(e)}function uhe(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M232,128A104,104,0,1,1,128,24,104.13,104.13,0,0,1,232,128Z"},child:[]}]})(e)}function i7(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32Zm-8,128H176V88a8,8,0,0,0-8-8H96V48H208Z"},child:[]}]})(e)}function dhe(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M156,128a28,28,0,1,1-28-28A28,28,0,0,1,156,128Z"},child:[]}]})(e)}function Gj(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M156,128a28,28,0,1,1-28-28A28,28,0,0,1,156,128ZM48,100a28,28,0,1,0,28,28A28,28,0,0,0,48,100Zm160,0a28,28,0,1,0,28,28A28,28,0,0,0,208,100Z"},child:[]}]})(e)}function hhe(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M156,128a28,28,0,1,1-28-28A28,28,0,0,1,156,128ZM128,76a28,28,0,1,0-28-28A28,28,0,0,0,128,76Zm0,104a28,28,0,1,0,28,28A28,28,0,0,0,128,180Z"},child:[]}]})(e)}function fhe(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M245,110.64A16,16,0,0,0,232,104H216V88a16,16,0,0,0-16-16H130.67L102.94,51.2a16.14,16.14,0,0,0-9.6-3.2H40A16,16,0,0,0,24,64V208h0a8,8,0,0,0,8,8H211.1a8,8,0,0,0,7.59-5.47l28.49-85.47A16.05,16.05,0,0,0,245,110.64ZM93.34,64,123.2,86.4A8,8,0,0,0,128,88h72v16H69.77a16,16,0,0,0-15.18,10.94L40,158.7V64Z"},child:[]}]})(e)}function xd(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M237.94,107.21a8,8,0,0,0-3.89-5.4l-29.83-17-.12-33.62a8,8,0,0,0-2.83-6.08,111.91,111.91,0,0,0-36.72-20.67,8,8,0,0,0-6.46.59L128,41.85,97.88,25a8,8,0,0,0-6.47-.6A111.92,111.92,0,0,0,54.73,45.15a8,8,0,0,0-2.83,6.07l-.15,33.65-29.83,17a8,8,0,0,0-3.89,5.4,106.47,106.47,0,0,0,0,41.56,8,8,0,0,0,3.89,5.4l29.83,17,.12,33.63a8,8,0,0,0,2.83,6.08,111.91,111.91,0,0,0,36.72,20.67,8,8,0,0,0,6.46-.59L128,214.15,158.12,231a7.91,7.91,0,0,0,3.9,1,8.09,8.09,0,0,0,2.57-.42,112.1,112.1,0,0,0,36.68-20.73,8,8,0,0,0,2.83-6.07l.15-33.65,29.83-17a8,8,0,0,0,3.89-5.4A106.47,106.47,0,0,0,237.94,107.21ZM128,168a40,40,0,1,1,40-40A40,40,0,0,1,128,168Z"},child:[]}]})(e)}function vd(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M213.85,125.46l-112,120a8,8,0,0,1-13.69-7l14.66-73.33L45.19,143.49a8,8,0,0,1-3-13l112-120a8,8,0,0,1,13.69,7L153.18,90.9l57.63,21.61a8,8,0,0,1,3,12.95Z"},child:[]}]})(e)}function o7(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208,80H176V56a48,48,0,0,0-96,0V80H48A16,16,0,0,0,32,96V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V96A16,16,0,0,0,208,80ZM96,56a32,32,0,0,1,64,0V80H96Z"},child:[]}]})(e)}function a7(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,48V208a16,16,0,0,1-16,16H160a16,16,0,0,1-16-16V48a16,16,0,0,1,16-16h40A16,16,0,0,1,216,48ZM96,32H56A16,16,0,0,0,40,48V208a16,16,0,0,0,16,16H96a16,16,0,0,0,16-16V48A16,16,0,0,0,96,32Z"},child:[]}]})(e)}function phe(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M227.31,73.37,182.63,28.68a16,16,0,0,0-22.63,0L36.69,152A15.86,15.86,0,0,0,32,163.31V208a16,16,0,0,0,16,16H92.69A15.86,15.86,0,0,0,104,219.31L227.31,96a16,16,0,0,0,0-22.63ZM192,108.68,147.31,64l24-24L216,84.68Z"},child:[]}]})(e)}function l7(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M240,128a15.74,15.74,0,0,1-7.6,13.51L88.32,229.65a16,16,0,0,1-16.2.3A15.86,15.86,0,0,1,64,216.13V39.87a15.86,15.86,0,0,1,8.12-13.82,16,16,0,0,1,16.2.3L232.4,114.49A15.74,15.74,0,0,1,240,128Z"},child:[]}]})(e)}function ghe(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,40H40A16,16,0,0,0,24,56V200a16,16,0,0,0,16,16H216a16,16,0,0,0,16-16V56A16,16,0,0,0,216,40ZM80,192H64a16,16,0,0,1-16-16V144a8,8,0,0,1,16,0v32H80a8,8,0,0,1,0,16ZM80,80H64v32a8,8,0,0,1-16,0V80A16,16,0,0,1,64,64H80a8,8,0,0,1,0,16Zm64,112H112a8,8,0,0,1,0-16h32a8,8,0,0,1,0,16Zm0-112H112a8,8,0,0,1,0-16h32a8,8,0,0,1,0,16Zm64,96a16,16,0,0,1-16,16H176a8,8,0,0,1,0-16h16V144a8,8,0,0,1,16,0Zm0-64a8,8,0,0,1-16,0V80H176a8,8,0,0,1,0-16h16a16,16,0,0,1,16,16Z"},child:[]}]})(e)}function c7(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M111.59,181.47A8,8,0,0,1,104,192H24a8,8,0,0,1-7.59-10.53l40-120a8,8,0,0,1,15.18,0ZM208,76a52,52,0,1,0-52,52A52.06,52.06,0,0,0,208,76Zm16,68H136a8,8,0,0,0-8,8v56a8,8,0,0,0,8,8h88a8,8,0,0,0,8-8V152A8,8,0,0,0,224,144Z"},child:[]}]})(e)}function mhe(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M212,200a36,36,0,1,1-69.85-12.25l-53-34.05a36,36,0,1,1,0-51.4l53-34a36.09,36.09,0,1,1,8.67,13.45l-53,34.05a36,36,0,0,1,0,24.5l53,34.05A36,36,0,0,1,212,200Z"},child:[]}]})(e)}function Hj(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M235.24,84.38l-28.06,23.68,8.56,35.39a13.34,13.34,0,0,1-5.09,13.91,13.54,13.54,0,0,1-15,.69L164,139l-31.65,19.06a13.51,13.51,0,0,1-15-.69,13.32,13.32,0,0,1-5.1-13.91l8.56-35.39L92.76,84.38a13.39,13.39,0,0,1,7.66-23.58l36.94-2.92,14.21-33.66a13.51,13.51,0,0,1,24.86,0l14.21,33.66,36.94,2.92a13.39,13.39,0,0,1,7.66,23.58ZM88.11,111.89a8,8,0,0,0-11.32,0L18.34,170.34a8,8,0,0,0,11.32,11.32l58.45-58.45A8,8,0,0,0,88.11,111.89Zm-.5,61.19L34.34,226.34a8,8,0,0,0,11.32,11.32l53.26-53.27a8,8,0,0,0-11.31-11.31Zm73-1-54.29,54.28a8,8,0,0,0,11.32,11.32l54.28-54.28a8,8,0,0,0-11.31-11.32Z"},child:[]}]})(e)}function ub(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208,144a15.78,15.78,0,0,1-10.42,14.94L146,178l-19,51.62a15.92,15.92,0,0,1-29.88,0L78,178l-51.62-19a15.92,15.92,0,0,1,0-29.88L78,110l19-51.62a15.92,15.92,0,0,1,29.88,0L146,110l51.62,19A15.78,15.78,0,0,1,208,144ZM152,48h16V64a8,8,0,0,0,16,0V48h16a8,8,0,0,0,0-16H184V16a8,8,0,0,0-16,0V32H152a8,8,0,0,0,0,16Zm88,32h-8V72a8,8,0,0,0-16,0v8h-8a8,8,0,0,0,0,16h8v8a8,8,0,0,0,16,0V96h8a8,8,0,0,0,0-16Z"},child:[]}]})(e)}function db(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M234.29,114.85l-45,38.83L203,211.75a16.4,16.4,0,0,1-24.5,17.82L128,198.49,77.47,229.57A16.4,16.4,0,0,1,53,211.75l13.76-58.07-45-38.83A16.46,16.46,0,0,1,31.08,86l59-4.76,22.76-55.08a16.36,16.36,0,0,1,30.27,0l22.75,55.08,59,4.76a16.46,16.46,0,0,1,9.37,28.86Z"},child:[]}]})(e)}function yhe(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M176,56H80a72,72,0,0,0,0,144h96a72,72,0,0,0,0-144Zm0,112a40,40,0,1,1,40-40A40,40,0,0,1,176,168Z"},child:[]}]})(e)}function hb(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M224,56a8,8,0,0,1-8,8h-8V208a16,16,0,0,1-16,16H64a16,16,0,0,1-16-16V64H40a8,8,0,0,1,0-16H216A8,8,0,0,1,224,56ZM88,32h80a8,8,0,0,0,0-16H88a8,8,0,0,0,0,16Z"},child:[]}]})(e)}function bhe(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M74.34,77.66a8,8,0,0,1,0-11.32l48-48a8,8,0,0,1,11.32,0l48,48a8,8,0,0,1-11.32,11.32L136,43.31V128a8,8,0,0,1-16,0V43.31L85.66,77.66A8,8,0,0,1,74.34,77.66ZM240,136v64a16,16,0,0,1-16,16H32a16,16,0,0,1-16-16V136a16,16,0,0,1,16-16h68a4,4,0,0,1,4,4v3.46c0,13.45,11,24.79,24.46,24.54A24,24,0,0,0,152,128v-4a4,4,0,0,1,4-4h68A16,16,0,0,1,240,136Zm-40,32a12,12,0,1,0-12,12A12,12,0,0,0,200,168Z"},child:[]}]})(e)}function u7(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M232,96a72,72,0,0,1-100.94,66L79,222.22c-.12.14-.26.29-.39.42a32,32,0,0,1-45.26-45.26c.14-.13.28-.27.43-.39L94,124.94a72.07,72.07,0,0,1,83.54-98.78,8,8,0,0,1,3.93,13.19L144,80l5.66,26.35L176,112l40.65-37.52a8,8,0,0,1,13.19,3.93A72.6,72.6,0,0,1,232,96Z"},child:[]}]})(e)}function xhe(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M234.33,69.52a24,24,0,0,0-14.49-16.4C185.56,39.88,131,40,128,40s-57.56-.12-91.84,13.12a24,24,0,0,0-14.49,16.4C19.08,79.5,16,97.74,16,128s3.08,48.5,5.67,58.48a24,24,0,0,0,14.49,16.41C69,215.56,120.4,216,127.34,216h1.32c6.94,0,58.37-.44,91.18-13.11a24,24,0,0,0,14.49-16.41c2.59-10,5.67-28.22,5.67-58.48S236.92,79.5,234.33,69.52Zm-73.74,65-40,28A8,8,0,0,1,108,156V100a8,8,0,0,1,12.59-6.55l40,28a8,8,0,0,1,0,13.1Z"},child:[]}]})(e)}function H5(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M104,60A12,12,0,1,1,92,48,12,12,0,0,1,104,60Zm60,12a12,12,0,1,0-12-12A12,12,0,0,0,164,72ZM92,116a12,12,0,1,0,12,12A12,12,0,0,0,92,116Zm72,0a12,12,0,1,0,12,12A12,12,0,0,0,164,116ZM92,184a12,12,0,1,0,12,12A12,12,0,0,0,92,184Zm72,0a12,12,0,1,0,12,12A12,12,0,0,0,164,184Z"},child:[]}]})(e)}function W5(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M72,92A12,12,0,1,1,60,80,12,12,0,0,1,72,92Zm56-12a12,12,0,1,0,12,12A12,12,0,0,0,128,80Zm68,24a12,12,0,1,0-12-12A12,12,0,0,0,196,104ZM60,152a12,12,0,1,0,12,12A12,12,0,0,0,60,152Zm68,0a12,12,0,1,0,12,12A12,12,0,0,0,128,152Zm68,0a12,12,0,1,0,12,12A12,12,0,0,0,196,152Z"},child:[]}]})(e)}function vhe(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208,32H48A16,16,0,0,0,32,48V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V48A16,16,0,0,0,208,32ZM48,48H208v77.38l-24.69-24.7a16,16,0,0,0-22.62,0L53.37,208H48ZM208,208H76l96-96,36,36v60ZM96,120A24,24,0,1,0,72,96,24,24,0,0,0,96,120Zm0-32a8,8,0,1,1-8,8A8,8,0,0,1,96,88Z"},child:[]}]})(e)}function Wj(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,40H40A16,16,0,0,0,24,56V200a16,16,0,0,0,16,16H216a16,16,0,0,0,16-16V56A16,16,0,0,0,216,40Zm0,16V158.75l-26.07-26.06a16,16,0,0,0-22.63,0l-20,20-44-44a16,16,0,0,0-22.62,0L40,149.37V56ZM40,172l52-52,80,80H40Zm176,28H194.63l-36-36,20-20L216,181.38V200ZM144,100a12,12,0,1,1,12,12A12,12,0,0,1,144,100Z"},child:[]}]})(e)}function Che(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M140,180a12,12,0,1,1-12-12A12,12,0,0,1,140,180ZM128,72c-22.06,0-40,16.15-40,36v4a8,8,0,0,0,16,0v-4c0-11,10.77-20,24-20s24,9,24,20-10.77,20-24,20a8,8,0,0,0-8,8v8a8,8,0,0,0,16,0v-.72c18.24-3.35,32-17.9,32-35.28C168,88.15,150.06,72,128,72Zm104,56A104,104,0,1,1,128,24,104.11,104.11,0,0,1,232,128Zm-16,0a88,88,0,1,0-88,88A88.1,88.1,0,0,0,216,128Z"},child:[]}]})(e)}function d7(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M136,32V64a8,8,0,0,1-16,0V32a8,8,0,0,1,16,0Zm37.25,58.75a8,8,0,0,0,5.66-2.35l22.63-22.62a8,8,0,0,0-11.32-11.32L167.6,77.09a8,8,0,0,0,5.65,13.66ZM224,120H192a8,8,0,0,0,0,16h32a8,8,0,0,0,0-16Zm-45.09,47.6a8,8,0,0,0-11.31,11.31l22.62,22.63a8,8,0,0,0,11.32-11.32ZM128,184a8,8,0,0,0-8,8v32a8,8,0,0,0,16,0V192A8,8,0,0,0,128,184ZM77.09,167.6,54.46,190.22a8,8,0,0,0,11.32,11.32L88.4,178.91A8,8,0,0,0,77.09,167.6ZM72,128a8,8,0,0,0-8-8H32a8,8,0,0,0,0,16H64A8,8,0,0,0,72,128ZM65.78,54.46A8,8,0,0,0,54.46,65.78L77.09,88.4A8,8,0,0,0,88.4,77.09Z"},child:[]}]})(e)}function fb(e){return he({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M165.66,101.66,139.31,128l26.35,26.34a8,8,0,0,1-11.32,11.32L128,139.31l-26.34,26.35a8,8,0,0,1-11.32-11.32L116.69,128,90.34,101.66a8,8,0,0,1,11.32-11.32L128,116.69l26.34-26.35a8,8,0,0,1,11.32,11.32ZM232,128A104,104,0,1,1,128,24,104.11,104.11,0,0,1,232,128Zm-16,0a88,88,0,1,0-88,88A88.1,88.1,0,0,0,216,128Z"},child:[]}]})(e)}const CC=e=>[e,...e.dependencies||[]],h7=()=>{const{modelList:e}=Ip(void 0,{selectFromResult:({data:s})=>({modelList:s?Ya.selectAll(s):Ls})}),t=u.useCallback(({source:s,name:i,base:o,type:a,is_installed:l,previous_names:c})=>e.some(d=>l||s===d.source||o===d.base&&(i===d.name||(c==null?void 0:c.includes(i)))&&a===d.type),[e]),n=u.useCallback(s=>{const{name:i,base:o,type:a,source:l,description:c,format:d}=s;return{config:{name:i,base:o,type:a,description:c,format:d},source:l}},[]);return{getIsInstalled:t,buildModelInstallArg:n}},whe=({bundleName:e,bundle:t})=>{const[n]=fM(),{getIsInstalled:s,buildModelInstallArg:i}=h7(),{t:o}=A(),a=u.useMemo(()=>{const c=Xae(t,CC),d=uD(c,(p,g)=>p.source===g.source||p.name===g.name&&p.base===g.base&&p.type===g.type),h=d.filter(cD(s)).map(i),f=d.filter(s).map(i);return{install:h,skip:f}},[i,t,s]),l=u.useCallback(()=>{a.install.forEach(n);let c=o("modelManager.installingXModels",{count:a.install.length});a.skip.length>1&&(c+=o("modelManager.skippingXDuplicates",{count:a.skip.length-1})),ge({status:"info",title:o("modelManager.installingBundle"),description:c})},[a.install,a.skip.length,n,o]);return r.jsx(Ee,{label:r.jsxs(T,{flexDir:"column",p:1,children:[r.jsxs(q,{children:[o("modelManager.includesNModels",{n:t.length}),":"]}),r.jsx(or,{children:t.map((c,d)=>r.jsx(Rt,{wordBreak:"break-all",children:c.name},d))})]}),children:r.jsx(de,{size:"sm",onClick:l,py:6,isDisabled:a.install.length===0,children:r.jsxs(T,{flexDir:"column",children:[r.jsx(q,{children:VY(e)?pM[e]:e}),a.install.length>0&&r.jsxs(q,{fontSize:"xs",children:["(",t.length," ",o("settings.models"),")"]}),a.install.length===0&&r.jsx(q,{fontSize:"xs",children:o("common.installed")})]})})})},Cd=()=>{const{t:e}=A(),[t,n]=fM();return[u.useCallback(({source:i,inplace:o,config:a,onSuccess:l,onError:c})=>{a||(a={}),t({source:i,inplace:o,config:a}).unwrap().then(d=>{l&&l(),ge({id:"MODEL_INSTALL_QUEUED",title:e("toast.modelAddedSimple"),status:"success"})}).catch(d=>{c&&c(d),d&&ge({id:"MODEL_INSTALL_QUEUE_FAILED",title:`${d.data.detail} `,status:"error"})})},[t,e]),n]},She={any:"base","sd-1":"green","sd-2":"teal","sd-3":"purple",sdxl:"invokeBlue","sdxl-refiner":"invokeBlue",flux:"gold",cogview4:"orange"},jhe=({base:e})=>r.jsx(Kn,{flexGrow:0,colorScheme:She[e],variant:"subtle",h:"min-content",children:pM[e]}),f7=u.memo(jhe),p7=u.memo(({starterModel:e})=>{const{t}=A(),{getIsInstalled:n,buildModelInstallArg:s}=h7(),i=u.useMemo(()=>CC(e).every(n),[n,e]),o=u.useMemo(()=>CC(e).filter(cD(n)).map(s),[n,e,s]),[a]=Cd(),l=u.useCallback(()=>{o.forEach(a),ge({status:"info",title:t("modelManager.installingModel"),description:t("modelManager.installingXModels",{count:o.length})})},[o,a,t]);return r.jsxs(T,{alignItems:"center",justifyContent:"space-between",w:"100%",gap:3,children:[r.jsxs(T,{fontSize:"sm",flexDir:"column",children:[r.jsxs(T,{gap:3,children:[r.jsx(Kn,{h:"min-content",children:e.type.replaceAll("_"," ")}),r.jsx(f7,{base:e.base}),r.jsx(q,{fontWeight:"semibold",children:e.name})]}),r.jsx(q,{variant:"subtext",children:e.description})]}),r.jsx(Se,{children:i?r.jsx(Kn,{children:t("common.installed")}):r.jsx(oe,{"aria-label":t("modelManager.install"),icon:r.jsx(Vt,{}),onClick:l,size:"sm"})})]})});p7.displayName="StarterModelsResultItem";const g7=u.memo(({results:e})=>{const{t}=A(),[n,s]=u.useState(""),i=u.useMemo(()=>e.starter_models.filter(l=>{const c=n.trim().toLowerCase(),d=[l.name.toLowerCase(),l.type.toLowerCase().replaceAll("_"," "),l.description.toLowerCase(),l.base.toLowerCase()];return l.type==="spandrel_image_to_image"&&(d.push("upscale"),d.push("post-processing"),d.push("postprocessing"),d.push("post processing")),d.some(h=>h.includes(c))}),[e,n]),o=u.useCallback(l=>{s(l.target.value)},[]),a=u.useCallback(()=>{s("")},[]);return r.jsxs(T,{flexDir:"column",gap:3,height:"100%",children:[r.jsxs(T,{justifyContent:"space-between",alignItems:"center",children:[tS(e.starter_bundles)>0&&r.jsxs(T,{gap:4,alignItems:"center",children:[r.jsxs(T,{gap:2,alignItems:"center",children:[r.jsx(q,{color:"base.200",fontWeight:"semibold",children:t("modelManager.starterBundles")}),r.jsx(Ee,{label:t("modelManager.starterBundleHelpText"),children:r.jsx(T,{alignItems:"center",children:r.jsx(lt,{as:bd,color:"base.200"})})})]}),r.jsx(T,{gap:2,children:fo(e.starter_bundles,(l,c)=>r.jsx(whe,{bundleName:c,bundle:l},c))})]}),r.jsxs(ta,{w:64,size:"xs",children:[r.jsx(kt,{placeholder:t("modelManager.search"),value:n,"data-testid":"board-search-input",onChange:o,size:"xs"}),n&&r.jsx(co,{h:"full",pe:2,children:r.jsx(oe,{size:"sm",variant:"link","aria-label":t("boards.clearSearch"),icon:r.jsx(Ot,{}),onClick:a,flexShrink:0})})]})]}),r.jsx(T,{height:"100%",layerStyle:"third",borderRadius:"base",p:3,children:r.jsx(os,{children:r.jsx(T,{flexDir:"column",gap:3,children:i.map(l=>r.jsx(p7,{starterModel:l},l.source))})})})]})});g7.displayName="StarterModelsResults";const m7=u.memo(()=>{const{isLoading:e,data:t}=zY(),{t:n}=A();return r.jsxs(T,{flexDir:"column",height:"100%",gap:3,children:[e&&r.jsx(Jn,{loadingMessage:n("common.loading")}),t&&r.jsx(g7,{results:t})]})});m7.displayName="StarterModelsForm";const U5=$n("events"),khe=Hi.endpoints.listModelInstalls.select(),t1=Te("unauthorized-toast"),q5=Te("forbidden-toast"),_he=e=>{switch(e){case"invalid":return Pe("modelManager.hfTokenInvalid");case"unknown":return Pe("modelManager.hfTokenUnableToVerify");case"valid":return"HF Token is valid, but does not have access to model"}},Ihe=async e=>{const t=e(Hi.endpoints.getHFTokenStatus.initiate(void 0,{subscribe:!1}));try{return await t.unwrap()}catch{return null}},The=(e,t)=>async n=>{U5.error({data:n},"Model install error");const s=khe(e()).data;if(n.error==="Unauthorized")if(n.source.type==="hf"){const o=await Ihe(t);if(o===null)U5.error("Error getting HF token status");else{const a=_he(o);ge({id:t1,title:a,description:r.jsx(Ahe,{}),status:"error",isClosable:!0,duration:null})}}else n.source.type==="url"?ge({id:t1,title:"Model requires authorization",description:r.jsxs(q,{fontSize:"md",children:[Pe("modelManager.urlUnauthorizedErrorMessage"),r.jsx(sr,{label:Pe("modelManager.urlUnauthorizedErrorMessage2"),href:"https://invoke-ai.github.io/InvokeAI/configuration/#model-marketplace-api-keys"})]}),status:"error",isClosable:!0,duration:null}):we(!1,"Unexpected unauthorized error for path source");else n.error==="Forbidden"?n.source.type==="hf"?ge({id:q5,title:Pe("modelManager.hfForbidden"),description:r.jsxs(q,{fontSize:"md",children:[Pe("modelManager.hfForbiddenErrorMessage"),r.jsx(sr,{label:n.source.repo_id,href:`https://huggingface.co/${n.source.repo_id}`})]}),status:"error",isClosable:!0,duration:null}):n.source.type==="url"?ge({id:q5,title:Pe("modelManager.urlForbidden"),description:Pe("modelManager.urlForbiddenErrorMessage"),status:"error",isClosable:!0,duration:null}):we(!1,"Unexpected forbidden error for path source"):ge({title:"Model install error",description:n.error,status:"error",isClosable:!0,duration:null});const i=s==null?void 0:s.find(o=>o.id===n.id);i?(i.source,t(Hi.util.updateQueryData("listModelInstalls",void 0,o=>{const a=o.find(l=>l.id===n.id);return a&&(a.status="error",a.error_reason=n.error_type,a.error=n.error),o}))):t(Po.util.invalidateTags([{type:"ModelInstalls"}]))},Ahe=()=>{const e=Bt("hfToken"),{data:t}=nS(e?void 0:Xn),{t:n}=A(),s=G(),i=u.useCallback(()=>{s(Qt("models")),GY.close(t1)},[s]);if(!t)return r.jsx(Lr,{});if(t==="invalid")return r.jsxs(q,{fontSize:"md",children:[n("modelManager.hfTokenInvalidErrorMessage")," ",n("modelManager.hfTokenRequired")," ",n("modelManager.hfTokenInvalidErrorMessage2"),r.jsxs(de,{onClick:i,variant:"link",color:"base.50",flexGrow:0,children:[n("modelManager.modelManager"),"."]})]});if(t==="unknown")return r.jsxs(q,{fontSize:"md",children:[n("modelManager.hfTokenUnableToErrorMessage")," ",r.jsxs(de,{onClick:i,variant:"link",color:"base.50",flexGrow:0,children:[n("modelManager.modelManager"),"."]})]});we(!1,"Unexpected valid HF token with unauthorized error")},Ehe=()=>{const{t:e}=A(),t=Bt("hfToken"),[n,s]=u.useState(""),{currentData:i}=nS(t?void 0:Xn),[o,{isLoading:a,isUninitialized:l}]=HY(),c=u.useCallback(f=>{s(f.target.value)},[]),d=u.useCallback(()=>{o({token:n}).unwrap().then(f=>{f==="valid"&&(s(""),ge({id:t1,title:e("modelManager.hfTokenSaved"),status:"success",duration:3e3}))})},[e,n,o]),h=u.useMemo(()=>!i||l||a?null:i==="invalid"?e("modelManager.hfTokenInvalidErrorMessage"):i==="unknown"?e("modelManager.hfTokenUnableToVerifyErrorMessage"):null,[i,a,l,e]);return!i||i==="valid"?null:r.jsx(T,{borderRadius:"base",w:"full",children:r.jsxs(K,{isInvalid:!l&&!!h,orientation:"vertical",children:[r.jsx(J,{children:e("modelManager.hfTokenLabel")}),r.jsxs(T,{gap:3,alignItems:"center",w:"full",children:[r.jsx(kt,{type:"password",value:n,onChange:c}),r.jsx(de,{onClick:d,size:"sm",isDisabled:n.trim().length===0,isLoading:a,children:e("common.save")})]}),r.jsx(Js,{children:r.jsx(sr,{label:e("modelManager.hfTokenHelperText"),href:"https://huggingface.co/settings/tokens"})}),r.jsx(Tp,{children:h})]})})},y7=u.memo(({result:e})=>{const{t}=A(),[n]=Cd(),s=u.useCallback(()=>{n({source:e})},[n,e]);return r.jsxs(T,{alignItems:"center",justifyContent:"space-between",w:"100%",gap:3,children:[r.jsxs(T,{fontSize:"sm",flexDir:"column",children:[r.jsx(q,{fontWeight:"semibold",children:e.split("/").slice(-1)[0]}),r.jsx(q,{variant:"subtext",noOfLines:1,wordBreak:"break-all",children:e})]}),r.jsx(oe,{"aria-label":t("modelManager.install"),icon:r.jsx(Vt,{}),onClick:s,size:"sm"})]})});y7.displayName="HuggingFaceResultItem";const b7=u.memo(({results:e})=>{const{t}=A(),[n,s]=u.useState(""),[i]=Cd(),o=u.useMemo(()=>e.filter(d=>{const h=d.split("/").slice(-1)[0];return h==null?void 0:h.toLowerCase().includes(n.toLowerCase())}),[e,n]),a=u.useCallback(d=>{s(d.target.value.trim())},[]),l=u.useCallback(()=>{s("")},[]),c=u.useCallback(()=>{for(const d of o)i({source:d})},[o,i]);return r.jsxs(r.Fragment,{children:[r.jsx(wt,{}),r.jsxs(T,{flexDir:"column",gap:3,height:"100%",children:[r.jsxs(T,{justifyContent:"space-between",alignItems:"center",children:[r.jsx(Ft,{size:"sm",children:t("modelManager.availableModels")}),r.jsxs(T,{alignItems:"center",gap:3,children:[r.jsx(de,{size:"sm",onClick:c,isDisabled:e.length===0,flexShrink:0,children:t("modelManager.installAll")}),r.jsxs(ta,{w:64,size:"xs",children:[r.jsx(kt,{placeholder:t("modelManager.search"),value:n,"data-testid":"board-search-input",onChange:a,size:"xs"}),n&&r.jsx(co,{h:"full",pe:2,children:r.jsx(oe,{size:"sm",variant:"link","aria-label":t("boards.clearSearch"),icon:r.jsx(Ot,{}),onClick:l})})]})]})]}),r.jsx(T,{height:"100%",layerStyle:"third",borderRadius:"base",p:3,children:r.jsx(os,{children:r.jsx(T,{flexDir:"column",gap:3,children:o.map(d=>r.jsx(y7,{result:d},d))})})})]})]})});b7.displayName="HuggingFaceResults";const x7=u.memo(()=>{const[e,t]=u.useState(""),[n,s]=u.useState(!1),[i,o]=u.useState(""),{t:a}=A(),l=Bt("hfToken"),{currentData:c}=nS(l?void 0:Xn),[d,{isLoading:h,data:f}]=WY(),[p]=Cd(),g=u.useCallback(()=>{d(e).unwrap().then(y=>{var b;y.is_diffusers?(p({source:e}),s(!1)):((b=y.urls)==null?void 0:b.length)===1&&y.urls[0]?(p({source:y.urls[0]}),s(!1)):s(!0)}).catch(y=>{o(y.data.detail||"")})},[d,p,e]),m=u.useCallback(y=>{t(y.target.value),o("")},[]);return r.jsxs(T,{flexDir:"column",height:"100%",gap:4,children:[r.jsxs(K,{isInvalid:!!i.length,w:"full",orientation:"vertical",flexShrink:0,children:[r.jsx(J,{children:a("modelManager.huggingFaceRepoID")}),r.jsxs(T,{gap:3,alignItems:"center",w:"full",children:[r.jsx(kt,{placeholder:a("modelManager.huggingFacePlaceholder"),value:e,onChange:m}),r.jsx(de,{onClick:g,isLoading:h,isDisabled:e.length===0,size:"sm",flexShrink:0,children:a("modelManager.installRepo")})]}),r.jsx(Js,{children:a("modelManager.huggingFaceHelper")}),!!i.length&&r.jsx(Tp,{children:i})]}),c!=="valid"&&r.jsx(Ehe,{}),f&&f.urls&&n&&r.jsx(b7,{results:f.urls})]})});x7.displayName="HuggingFaceForm";var dg=e=>e.type==="checkbox",cu=e=>e instanceof Date,Vs=e=>e==null;const v7=e=>typeof e=="object";var Bn=e=>!Vs(e)&&!Array.isArray(e)&&v7(e)&&!cu(e),C7=e=>Bn(e)&&e.target?dg(e.target)?e.target.checked:e.target.value:e,Mhe=e=>e.substring(0,e.search(/\.\d+(\.|$)/))||e,w7=(e,t)=>e.has(Mhe(t)),Phe=e=>{const t=e.constructor&&e.constructor.prototype;return Bn(t)&&t.hasOwnProperty("isPrototypeOf")},Uj=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function Ys(e){let t;const n=Array.isArray(e);if(e instanceof Date)t=new Date(e);else if(e instanceof Set)t=new Set(e);else if(!(Uj&&(e instanceof Blob||e instanceof FileList))&&(n||Bn(e)))if(t=n?[]:{},!n&&!Phe(e))t=e;else for(const s in e)e.hasOwnProperty(s)&&(t[s]=Ys(e[s]));else return e;return t}var pb=e=>Array.isArray(e)?e.filter(Boolean):[],kn=e=>e===void 0,Le=(e,t,n)=>{if(!t||!Bn(e))return n;const s=pb(t.split(/[,[\].]+?/)).reduce((i,o)=>Vs(i)?i:i[o],e);return kn(s)||s===e?kn(e[t])?n:e[t]:s},Kr=e=>typeof e=="boolean",qj=e=>/^\w*$/.test(e),S7=e=>pb(e.replace(/["|']|\]/g,"").split(/\.|\[/)),Xt=(e,t,n)=>{let s=-1;const i=qj(t)?[t]:S7(t),o=i.length,a=o-1;for(;++s<o;){const l=i[s];let c=n;if(s!==a){const d=e[l];c=Bn(d)||Array.isArray(d)?d:isNaN(+i[s+1])?{}:[]}if(l==="__proto__")return;e[l]=c,e=e[l]}return e};const n1={BLUR:"blur",FOCUS_OUT:"focusout",CHANGE:"change"},wi={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},Io={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"},Lhe=be.createContext(null),Kj=()=>be.useContext(Lhe);var j7=(e,t,n,s=!0)=>{const i={defaultValues:t._defaultValues};for(const o in e)Object.defineProperty(i,o,{get:()=>{const a=o;return t._proxyFormState[a]!==wi.all&&(t._proxyFormState[a]=!s||wi.all),n&&(n[a]=!0),e[a]}});return i},Xs=e=>Bn(e)&&!Object.keys(e).length,k7=(e,t,n,s)=>{n(e);const{name:i,...o}=e;return Xs(o)||Object.keys(o).length>=Object.keys(t).length||Object.keys(o).find(a=>t[a]===(!s||wi.all))},jf=e=>Array.isArray(e)?e:[e],_7=(e,t,n)=>!e||!t||e===t||jf(e).some(s=>s&&(n?s===t:s.startsWith(t)||t.startsWith(s)));function Zj(e){const t=be.useRef(e);t.current=e,be.useEffect(()=>{const n=!e.disabled&&t.current.subject&&t.current.subject.subscribe({next:t.current.next});return()=>{n&&n.unsubscribe()}},[e.disabled])}function Dhe(e){const t=Kj(),{control:n=t.control,disabled:s,name:i,exact:o}=e||{},[a,l]=be.useState(n._formState),c=be.useRef(!0),d=be.useRef({isDirty:!1,isLoading:!1,dirtyFields:!1,touchedFields:!1,validatingFields:!1,isValidating:!1,isValid:!1,errors:!1}),h=be.useRef(i);return h.current=i,Zj({disabled:s,next:f=>c.current&&_7(h.current,f.name,o)&&k7(f,d.current,n._updateFormState)&&l({...n._formState,...f}),subject:n._subjects.state}),be.useEffect(()=>(c.current=!0,d.current.isValid&&n._updateValid(!0),()=>{c.current=!1}),[n]),j7(a,n,d.current,!1)}var Qi=e=>typeof e=="string",I7=(e,t,n,s,i)=>Qi(e)?(s&&t.watch.add(e),Le(n,e,i)):Array.isArray(e)?e.map(o=>(s&&t.watch.add(o),Le(n,o))):(s&&(t.watchAll=!0),n);function Rhe(e){const t=Kj(),{control:n=t.control,name:s,defaultValue:i,disabled:o,exact:a}=e||{},l=be.useRef(s);l.current=s,Zj({disabled:o,subject:n._subjects.values,next:h=>{_7(l.current,h.name,a)&&d(Ys(I7(l.current,n._names,h.values||n._formValues,!1,i)))}});const[c,d]=be.useState(n._getWatch(s,i));return be.useEffect(()=>n._removeUnmounted()),c}function ys(e){const t=Kj(),{name:n,disabled:s,control:i=t.control,shouldUnregister:o}=e,a=w7(i._names.array,n),l=Rhe({control:i,name:n,defaultValue:Le(i._formValues,n,Le(i._defaultValues,n,e.defaultValue)),exact:!0}),c=Dhe({control:i,name:n,exact:!0}),d=be.useRef(i.register(n,{...e.rules,value:l,...Kr(e.disabled)?{disabled:e.disabled}:{}}));return be.useEffect(()=>{const h=i._options.shouldUnregister||o,f=(p,g)=>{const m=Le(i._fields,p);m&&m._f&&(m._f.mount=g)};if(f(n,!0),h){const p=Ys(Le(i._options.defaultValues,n));Xt(i._defaultValues,n,p),kn(Le(i._formValues,n))&&Xt(i._formValues,n,p)}return()=>{(a?h&&!i._state.action:h)?i.unregister(n):f(n,!1)}},[n,i,a,o]),be.useEffect(()=>{Le(i._fields,n)&&i._updateDisabledField({disabled:s,fields:i._fields,name:n,value:Le(i._fields,n)._f.value})},[s,n,i]),{field:{name:n,value:l,...Kr(s)||c.disabled?{disabled:c.disabled||s}:{},onChange:be.useCallback(h=>d.current.onChange({target:{value:C7(h),name:n},type:n1.CHANGE}),[n]),onBlur:be.useCallback(()=>d.current.onBlur({target:{value:Le(i._formValues,n),name:n},type:n1.BLUR}),[n,i]),ref:be.useCallback(h=>{const f=Le(i._fields,n);f&&h&&(f._f.ref={focus:()=>h.focus(),select:()=>h.select(),setCustomValidity:p=>h.setCustomValidity(p),reportValidity:()=>h.reportValidity()})},[i._fields,n])},formState:c,fieldState:Object.defineProperties({},{invalid:{enumerable:!0,get:()=>!!Le(c.errors,n)},isDirty:{enumerable:!0,get:()=>!!Le(c.dirtyFields,n)},isTouched:{enumerable:!0,get:()=>!!Le(c.touchedFields,n)},isValidating:{enumerable:!0,get:()=>!!Le(c.validatingFields,n)},error:{enumerable:!0,get:()=>Le(c.errors,n)}})}}var Ohe=(e,t,n,s,i)=>t?{...n[e],types:{...n[e]&&n[e].types?n[e].types:{},[s]:i||!0}}:{},K5=e=>({isOnSubmit:!e||e===wi.onSubmit,isOnBlur:e===wi.onBlur,isOnChange:e===wi.onChange,isOnAll:e===wi.all,isOnTouch:e===wi.onTouched}),Z5=(e,t,n)=>!n&&(t.watchAll||t.watch.has(e)||[...t.watch].some(s=>e.startsWith(s)&&/^\.\w+/.test(e.slice(s.length))));const kf=(e,t,n,s)=>{for(const i of n||Object.keys(e)){const o=Le(e,i);if(o){const{_f:a,...l}=o;if(a){if(a.refs&&a.refs[0]&&t(a.refs[0],i)&&!s)return!0;if(a.ref&&t(a.ref,a.name)&&!s)return!0;if(kf(l,t))break}else if(Bn(l)&&kf(l,t))break}}};var Nhe=(e,t,n)=>{const s=jf(Le(e,n));return Xt(s,"root",t[n]),Xt(e,n,s),e},Yj=e=>e.type==="file",zo=e=>typeof e=="function",s1=e=>{if(!Uj)return!1;const t=e?e.ownerDocument:0;return e instanceof(t&&t.defaultView?t.defaultView.HTMLElement:HTMLElement)},h0=e=>Qi(e),Xj=e=>e.type==="radio",r1=e=>e instanceof RegExp;const Y5={value:!1,isValid:!1},X5={value:!0,isValid:!0};var T7=e=>{if(Array.isArray(e)){if(e.length>1){const t=e.filter(n=>n&&n.checked&&!n.disabled).map(n=>n.value);return{value:t,isValid:!!t.length}}return e[0].checked&&!e[0].disabled?e[0].attributes&&!kn(e[0].attributes.value)?kn(e[0].value)||e[0].value===""?X5:{value:e[0].value,isValid:!0}:X5:Y5}return Y5};const Q5={isValid:!1,value:null};var A7=e=>Array.isArray(e)?e.reduce((t,n)=>n&&n.checked&&!n.disabled?{isValid:!0,value:n.value}:t,Q5):Q5;function J5(e,t,n="validate"){if(h0(e)||Array.isArray(e)&&e.every(h0)||Kr(e)&&!e)return{type:n,message:h0(e)?e:"",ref:t}}var Nc=e=>Bn(e)&&!r1(e)?e:{value:e,message:""},e6=async(e,t,n,s,i)=>{const{ref:o,refs:a,required:l,maxLength:c,minLength:d,min:h,max:f,pattern:p,validate:g,name:m,valueAsNumber:y,mount:b,disabled:C}=e._f,x=Le(t,m);if(!b||C)return{};const v=a?a[0]:o,w=F=>{s&&v.reportValidity&&(v.setCustomValidity(Kr(F)?"":F||""),v.reportValidity())},S={},j=Xj(o),P=dg(o),E=j||P,D=(y||Yj(o))&&kn(o.value)&&kn(x)||s1(o)&&o.value===""||x===""||Array.isArray(x)&&!x.length,M=Ohe.bind(null,m,n,S),R=(F,_,L,O=Io.maxLength,B=Io.minLength)=>{const z=F?_:L;S[m]={type:F?O:B,message:z,ref:o,...M(F?O:B,z)}};if(i?!Array.isArray(x)||!x.length:l&&(!E&&(D||Vs(x))||Kr(x)&&!x||P&&!T7(a).isValid||j&&!A7(a).isValid)){const{value:F,message:_}=h0(l)?{value:!!l,message:l}:Nc(l);if(F&&(S[m]={type:Io.required,message:_,ref:v,...M(Io.required,_)},!n))return w(_),S}if(!D&&(!Vs(h)||!Vs(f))){let F,_;const L=Nc(f),O=Nc(h);if(!Vs(x)&&!isNaN(x)){const B=o.valueAsNumber||x&&+x;Vs(L.value)||(F=B>L.value),Vs(O.value)||(_=B<O.value)}else{const B=o.valueAsDate||new Date(x),z=re=>new Date(new Date().toDateString()+" "+re),ee=o.type=="time",ne=o.type=="week";Qi(L.value)&&x&&(F=ee?z(x)>z(L.value):ne?x>L.value:B>new Date(L.value)),Qi(O.value)&&x&&(_=ee?z(x)<z(O.value):ne?x<O.value:B<new Date(O.value))}if((F||_)&&(R(!!F,L.message,O.message,Io.max,Io.min),!n))return w(S[m].message),S}if((c||d)&&!D&&(Qi(x)||i&&Array.isArray(x))){const F=Nc(c),_=Nc(d),L=!Vs(F.value)&&x.length>+F.value,O=!Vs(_.value)&&x.length<+_.value;if((L||O)&&(R(L,F.message,_.message),!n))return w(S[m].message),S}if(p&&!D&&Qi(x)){const{value:F,message:_}=Nc(p);if(r1(F)&&!x.match(F)&&(S[m]={type:Io.pattern,message:_,ref:o,...M(Io.pattern,_)},!n))return w(_),S}if(g){if(zo(g)){const F=await g(x,t),_=J5(F,v);if(_&&(S[m]={..._,...M(Io.validate,_.message)},!n))return w(_.message),S}else if(Bn(g)){let F={};for(const _ in g){if(!Xs(F)&&!n)break;const L=J5(await g[_](x,t),v,_);L&&(F={...L,...M(_,L.message)},w(L.message),n&&(S[m]=F))}if(!Xs(F)&&(S[m]={ref:v,...F},!n))return S}}return w(!0),S};function Fhe(e,t){const n=t.slice(0,-1).length;let s=0;for(;s<n;)e=kn(e)?s++:e[t[s++]];return e}function Bhe(e){for(const t in e)if(e.hasOwnProperty(t)&&!kn(e[t]))return!1;return!0}function Vn(e,t){const n=Array.isArray(t)?t:qj(t)?[t]:S7(t),s=n.length===1?e:Fhe(e,n),i=n.length-1,o=n[i];return s&&delete s[o],i!==0&&(Bn(s)&&Xs(s)||Array.isArray(s)&&Bhe(s))&&Vn(e,n.slice(0,-1)),e}var Zx=()=>{let e=[];return{get observers(){return e},next:i=>{for(const o of e)o.next&&o.next(i)},subscribe:i=>(e.push(i),{unsubscribe:()=>{e=e.filter(o=>o!==i)}}),unsubscribe:()=>{e=[]}}},i1=e=>Vs(e)||!v7(e);function Sa(e,t){if(i1(e)||i1(t))return e===t;if(cu(e)&&cu(t))return e.getTime()===t.getTime();const n=Object.keys(e),s=Object.keys(t);if(n.length!==s.length)return!1;for(const i of n){const o=e[i];if(!s.includes(i))return!1;if(i!=="ref"){const a=t[i];if(cu(o)&&cu(a)||Bn(o)&&Bn(a)||Array.isArray(o)&&Array.isArray(a)?!Sa(o,a):o!==a)return!1}}return!0}var E7=e=>e.type==="select-multiple",$he=e=>Xj(e)||dg(e),Yx=e=>s1(e)&&e.isConnected,M7=e=>{for(const t in e)if(zo(e[t]))return!0;return!1};function o1(e,t={}){const n=Array.isArray(e);if(Bn(e)||n)for(const s in e)Array.isArray(e[s])||Bn(e[s])&&!M7(e[s])?(t[s]=Array.isArray(e[s])?[]:{},o1(e[s],t[s])):Vs(e[s])||(t[s]=!0);return t}function P7(e,t,n){const s=Array.isArray(e);if(Bn(e)||s)for(const i in e)Array.isArray(e[i])||Bn(e[i])&&!M7(e[i])?kn(t)||i1(n[i])?n[i]=Array.isArray(e[i])?o1(e[i],[]):{...o1(e[i])}:P7(e[i],Vs(t)?{}:t[i],n[i]):n[i]=!Sa(e[i],t[i]);return n}var pm=(e,t)=>P7(e,t,o1(t)),L7=(e,{valueAsNumber:t,valueAsDate:n,setValueAs:s})=>kn(e)?e:t?e===""?NaN:e&&+e:n&&Qi(e)?new Date(e):s?s(e):e;function Xx(e){const t=e.ref;if(!(e.refs?e.refs.every(n=>n.disabled):t.disabled))return Yj(t)?t.files:Xj(t)?A7(e.refs).value:E7(t)?[...t.selectedOptions].map(({value:n})=>n):dg(t)?T7(e.refs).value:L7(kn(t.value)?e.ref.value:t.value,e)}var Vhe=(e,t,n,s)=>{const i={};for(const o of e){const a=Le(t,o);a&&Xt(i,o,a._f)}return{criteriaMode:n,names:[...e],fields:i,shouldUseNativeValidation:s}},Qd=e=>kn(e)?e:r1(e)?e.source:Bn(e)?r1(e.value)?e.value.source:e.value:e;const t6="AsyncFunction";var zhe=e=>(!e||!e.validate)&&!!(zo(e.validate)&&e.validate.constructor.name===t6||Bn(e.validate)&&Object.values(e.validate).find(t=>t.constructor.name===t6)),Ghe=e=>e.mount&&(e.required||e.min||e.max||e.maxLength||e.minLength||e.pattern||e.validate);function n6(e,t,n){const s=Le(e,n);if(s||qj(n))return{error:s,name:n};const i=n.split(".");for(;i.length;){const o=i.join("."),a=Le(t,o),l=Le(e,o);if(a&&!Array.isArray(a)&&n!==o)return{name:n};if(l&&l.type)return{name:o,error:l};i.pop()}return{name:n}}var Hhe=(e,t,n,s,i)=>i.isOnAll?!1:!n&&i.isOnTouch?!(t||e):(n?s.isOnBlur:i.isOnBlur)?!e:(n?s.isOnChange:i.isOnChange)?e:!0,Whe=(e,t)=>!pb(Le(e,t)).length&&Vn(e,t);const Uhe={mode:wi.onSubmit,reValidateMode:wi.onChange,shouldFocusError:!0};function qhe(e={}){let t={...Uhe,...e},n={submitCount:0,isDirty:!1,isLoading:zo(t.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:t.errors||{},disabled:t.disabled||!1},s={},i=Bn(t.defaultValues)||Bn(t.values)?Ys(t.defaultValues||t.values)||{}:{},o=t.shouldUnregister?{}:Ys(i),a={action:!1,mount:!1,watch:!1},l={mount:new Set,unMount:new Set,array:new Set,watch:new Set},c,d=0;const h={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1},f={values:Zx(),array:Zx(),state:Zx()},p=K5(t.mode),g=K5(t.reValidateMode),m=t.criteriaMode===wi.all,y=Z=>se=>{clearTimeout(d),d=setTimeout(Z,se)},b=async Z=>{if(h.isValid||Z){const se=t.resolver?Xs((await E()).errors):await M(s,!0);se!==n.isValid&&f.state.next({isValid:se})}},C=(Z,se)=>{(h.isValidating||h.validatingFields)&&((Z||Array.from(l.mount)).forEach(le=>{le&&(se?Xt(n.validatingFields,le,se):Vn(n.validatingFields,le))}),f.state.next({validatingFields:n.validatingFields,isValidating:!Xs(n.validatingFields)}))},x=(Z,se=[],le,ve,ye=!0,me=!0)=>{if(ve&&le){if(a.action=!0,me&&Array.isArray(Le(s,Z))){const ce=le(Le(s,Z),ve.argA,ve.argB);ye&&Xt(s,Z,ce)}if(me&&Array.isArray(Le(n.errors,Z))){const ce=le(Le(n.errors,Z),ve.argA,ve.argB);ye&&Xt(n.errors,Z,ce),Whe(n.errors,Z)}if(h.touchedFields&&me&&Array.isArray(Le(n.touchedFields,Z))){const ce=le(Le(n.touchedFields,Z),ve.argA,ve.argB);ye&&Xt(n.touchedFields,Z,ce)}h.dirtyFields&&(n.dirtyFields=pm(i,o)),f.state.next({name:Z,isDirty:F(Z,se),dirtyFields:n.dirtyFields,errors:n.errors,isValid:n.isValid})}else Xt(o,Z,se)},v=(Z,se)=>{Xt(n.errors,Z,se),f.state.next({errors:n.errors})},w=Z=>{n.errors=Z,f.state.next({errors:n.errors,isValid:!1})},S=(Z,se,le,ve)=>{const ye=Le(s,Z);if(ye){const me=Le(o,Z,kn(le)?Le(i,Z):le);kn(me)||ve&&ve.defaultChecked||se?Xt(o,Z,se?me:Xx(ye._f)):O(Z,me),a.mount&&b()}},j=(Z,se,le,ve,ye)=>{let me=!1,ce=!1;const Ce={name:Z},He=!!(Le(s,Z)&&Le(s,Z)._f&&Le(s,Z)._f.disabled);if(!le||ve){h.isDirty&&(ce=n.isDirty,n.isDirty=Ce.isDirty=F(),me=ce!==Ce.isDirty);const Xe=He||Sa(Le(i,Z),se);ce=!!(!He&&Le(n.dirtyFields,Z)),Xe||He?Vn(n.dirtyFields,Z):Xt(n.dirtyFields,Z,!0),Ce.dirtyFields=n.dirtyFields,me=me||h.dirtyFields&&ce!==!Xe}if(le){const Xe=Le(n.touchedFields,Z);Xe||(Xt(n.touchedFields,Z,le),Ce.touchedFields=n.touchedFields,me=me||h.touchedFields&&Xe!==le)}return me&&ye&&f.state.next(Ce),me?Ce:{}},P=(Z,se,le,ve)=>{const ye=Le(n.errors,Z),me=h.isValid&&Kr(se)&&n.isValid!==se;if(e.delayError&&le?(c=y(()=>v(Z,le)),c(e.delayError)):(clearTimeout(d),c=null,le?Xt(n.errors,Z,le):Vn(n.errors,Z)),(le?!Sa(ye,le):ye)||!Xs(ve)||me){const ce={...ve,...me&&Kr(se)?{isValid:se}:{},errors:n.errors,name:Z};n={...n,...ce},f.state.next(ce)}},E=async Z=>{C(Z,!0);const se=await t.resolver(o,t.context,Vhe(Z||l.mount,s,t.criteriaMode,t.shouldUseNativeValidation));return C(Z),se},D=async Z=>{const{errors:se}=await E(Z);if(Z)for(const le of Z){const ve=Le(se,le);ve?Xt(n.errors,le,ve):Vn(n.errors,le)}else n.errors=se;return se},M=async(Z,se,le={valid:!0})=>{for(const ve in Z){const ye=Z[ve];if(ye){const{_f:me,...ce}=ye;if(me){const Ce=l.array.has(me.name),He=ye._f&&zhe(ye._f);He&&h.validatingFields&&C([ve],!0);const Xe=await e6(ye,o,m,t.shouldUseNativeValidation&&!se,Ce);if(He&&h.validatingFields&&C([ve]),Xe[me.name]&&(le.valid=!1,se))break;!se&&(Le(Xe,me.name)?Ce?Nhe(n.errors,Xe,me.name):Xt(n.errors,me.name,Xe[me.name]):Vn(n.errors,me.name))}!Xs(ce)&&await M(ce,se,le)}}return le.valid},R=()=>{for(const Z of l.unMount){const se=Le(s,Z);se&&(se._f.refs?se._f.refs.every(le=>!Yx(le)):!Yx(se._f.ref))&&Y(Z)}l.unMount=new Set},F=(Z,se)=>(Z&&se&&Xt(o,Z,se),!Sa(te(),i)),_=(Z,se,le)=>I7(Z,l,{...a.mount?o:kn(se)?i:Qi(Z)?{[Z]:se}:se},le,se),L=Z=>pb(Le(a.mount?o:i,Z,e.shouldUnregister?Le(i,Z,[]):[])),O=(Z,se,le={})=>{const ve=Le(s,Z);let ye=se;if(ve){const me=ve._f;me&&(!me.disabled&&Xt(o,Z,L7(se,me)),ye=s1(me.ref)&&Vs(se)?"":se,E7(me.ref)?[...me.ref.options].forEach(ce=>ce.selected=ye.includes(ce.value)):me.refs?dg(me.ref)?me.refs.length>1?me.refs.forEach(ce=>(!ce.defaultChecked||!ce.disabled)&&(ce.checked=Array.isArray(ye)?!!ye.find(Ce=>Ce===ce.value):ye===ce.value)):me.refs[0]&&(me.refs[0].checked=!!ye):me.refs.forEach(ce=>ce.checked=ce.value===ye):Yj(me.ref)?me.ref.value="":(me.ref.value=ye,me.ref.type||f.values.next({name:Z,values:{...o}})))}(le.shouldDirty||le.shouldTouch)&&j(Z,ye,le.shouldTouch,le.shouldDirty,!0),le.shouldValidate&&re(Z)},B=(Z,se,le)=>{for(const ve in se){const ye=se[ve],me=`${Z}.${ve}`,ce=Le(s,me);(l.array.has(Z)||!i1(ye)||ce&&!ce._f)&&!cu(ye)?B(me,ye,le):O(me,ye,le)}},z=(Z,se,le={})=>{const ve=Le(s,Z),ye=l.array.has(Z),me=Ys(se);Xt(o,Z,me),ye?(f.array.next({name:Z,values:{...o}}),(h.isDirty||h.dirtyFields)&&le.shouldDirty&&f.state.next({name:Z,dirtyFields:pm(i,o),isDirty:F(Z,me)})):ve&&!ve._f&&!Vs(me)?B(Z,me,le):O(Z,me,le),Z5(Z,l)&&f.state.next({...n}),f.values.next({name:a.mount?Z:void 0,values:{...o}})},ee=async Z=>{a.mount=!0;const se=Z.target;let le=se.name,ve=!0;const ye=Le(s,le),me=()=>se.type?Xx(ye._f):C7(Z),ce=Ce=>{ve=Number.isNaN(Ce)||Sa(Ce,Le(o,le,Ce))};if(ye){let Ce,He;const Xe=me(),mt=Z.type===n1.BLUR||Z.type===n1.FOCUS_OUT,rn=!Ghe(ye._f)&&!t.resolver&&!Le(n.errors,le)&&!ye._f.deps||Hhe(mt,Le(n.touchedFields,le),n.isSubmitted,g,p),pn=Z5(le,l,mt);Xt(o,le,Xe),mt?(ye._f.onBlur&&ye._f.onBlur(Z),c&&c(0)):ye._f.onChange&&ye._f.onChange(Z);const bn=j(le,Xe,mt,!1),ls=!Xs(bn)||pn;if(!mt&&f.values.next({name:le,type:Z.type,values:{...o}}),rn)return h.isValid&&(e.mode==="onBlur"?mt&&b():b()),ls&&f.state.next({name:le,...pn?{}:bn});if(!mt&&pn&&f.state.next({...n}),t.resolver){const{errors:Os}=await E([le]);if(ce(Xe),ve){const xn=n6(n.errors,s,le),Bi=n6(Os,s,xn.name||le);Ce=Bi.error,le=Bi.name,He=Xs(Os)}}else C([le],!0),Ce=(await e6(ye,o,m,t.shouldUseNativeValidation))[le],C([le]),ce(Xe),ve&&(Ce?He=!1:h.isValid&&(He=await M(s,!0)));ve&&(ye._f.deps&&re(ye._f.deps),P(le,He,Ce,bn))}},ne=(Z,se)=>{if(Le(n.errors,se)&&Z.focus)return Z.focus(),1},re=async(Z,se={})=>{let le,ve;const ye=jf(Z);if(t.resolver){const me=await D(kn(Z)?Z:ye);le=Xs(me),ve=Z?!ye.some(ce=>Le(me,ce)):le}else Z?(ve=(await Promise.all(ye.map(async me=>{const ce=Le(s,me);return await M(ce&&ce._f?{[me]:ce}:ce)}))).every(Boolean),!(!ve&&!n.isValid)&&b()):ve=le=await M(s);return f.state.next({...!Qi(Z)||h.isValid&&le!==n.isValid?{}:{name:Z},...t.resolver||!Z?{isValid:le}:{},errors:n.errors}),se.shouldFocus&&!ve&&kf(s,ne,Z?ye:l.mount),ve},te=Z=>{const se={...a.mount?o:i};return kn(Z)?se:Qi(Z)?Le(se,Z):Z.map(le=>Le(se,le))},H=(Z,se)=>({invalid:!!Le((se||n).errors,Z),isDirty:!!Le((se||n).dirtyFields,Z),error:Le((se||n).errors,Z),isValidating:!!Le(n.validatingFields,Z),isTouched:!!Le((se||n).touchedFields,Z)}),V=Z=>{Z&&jf(Z).forEach(se=>Vn(n.errors,se)),f.state.next({errors:Z?n.errors:{}})},X=(Z,se,le)=>{const ve=(Le(s,Z,{_f:{}})._f||{}).ref,ye=Le(n.errors,Z)||{},{ref:me,message:ce,type:Ce,...He}=ye;Xt(n.errors,Z,{...He,...se,ref:ve}),f.state.next({name:Z,errors:n.errors,isValid:!1}),le&&le.shouldFocus&&ve&&ve.focus&&ve.focus()},W=(Z,se)=>zo(Z)?f.values.subscribe({next:le=>Z(_(void 0,se),le)}):_(Z,se,!0),Y=(Z,se={})=>{for(const le of Z?jf(Z):l.mount)l.mount.delete(le),l.array.delete(le),se.keepValue||(Vn(s,le),Vn(o,le)),!se.keepError&&Vn(n.errors,le),!se.keepDirty&&Vn(n.dirtyFields,le),!se.keepTouched&&Vn(n.touchedFields,le),!se.keepIsValidating&&Vn(n.validatingFields,le),!t.shouldUnregister&&!se.keepDefaultValue&&Vn(i,le);f.values.next({values:{...o}}),f.state.next({...n,...se.keepDirty?{isDirty:F()}:{}}),!se.keepIsValid&&b()},$=({disabled:Z,name:se,field:le,fields:ve,value:ye})=>{if(Kr(Z)&&a.mount||Z){const me=Z?void 0:kn(ye)?Xx(le?le._f:Le(ve,se)._f):ye;Xt(o,se,me),j(se,me,!1,!1,!0)}},N=(Z,se={})=>{let le=Le(s,Z);const ve=Kr(se.disabled)||Kr(e.disabled);return Xt(s,Z,{...le||{},_f:{...le&&le._f?le._f:{ref:{name:Z}},name:Z,mount:!0,...se}}),l.mount.add(Z),le?$({field:le,disabled:Kr(se.disabled)?se.disabled:e.disabled,name:Z,value:se.value}):S(Z,!0,se.value),{...ve?{disabled:se.disabled||e.disabled}:{},...t.progressive?{required:!!se.required,min:Qd(se.min),max:Qd(se.max),minLength:Qd(se.minLength),maxLength:Qd(se.maxLength),pattern:Qd(se.pattern)}:{},name:Z,onChange:ee,onBlur:ee,ref:ye=>{if(ye){N(Z,se),le=Le(s,Z);const me=kn(ye.value)&&ye.querySelectorAll&&ye.querySelectorAll("input,select,textarea")[0]||ye,ce=$he(me),Ce=le._f.refs||[];if(ce?Ce.find(He=>He===me):me===le._f.ref)return;Xt(s,Z,{_f:{...le._f,...ce?{refs:[...Ce.filter(Yx),me,...Array.isArray(Le(i,Z))?[{}]:[]],ref:{type:me.type,name:Z}}:{ref:me}}}),S(Z,!1,void 0,me)}else le=Le(s,Z,{}),le._f&&(le._f.mount=!1),(t.shouldUnregister||se.shouldUnregister)&&!(w7(l.array,Z)&&a.action)&&l.unMount.add(Z)}}},U=()=>t.shouldFocusError&&kf(s,ne,l.mount),ie=Z=>{Kr(Z)&&(f.state.next({disabled:Z}),kf(s,(se,le)=>{const ve=Le(s,le);ve&&(se.disabled=ve._f.disabled||Z,Array.isArray(ve._f.refs)&&ve._f.refs.forEach(ye=>{ye.disabled=ve._f.disabled||Z}))},0,!1))},ue=(Z,se)=>async le=>{let ve;le&&(le.preventDefault&&le.preventDefault(),le.persist&&le.persist());let ye=Ys(o);if(f.state.next({isSubmitting:!0}),t.resolver){const{errors:me,values:ce}=await E();n.errors=me,ye=ce}else await M(s);if(Vn(n.errors,"root"),Xs(n.errors)){f.state.next({errors:{}});try{await Z(ye,le)}catch(me){ve=me}}else se&&await se({...n.errors},le),U(),setTimeout(U);if(f.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:Xs(n.errors)&&!ve,submitCount:n.submitCount+1,errors:n.errors}),ve)throw ve},xe=(Z,se={})=>{Le(s,Z)&&(kn(se.defaultValue)?z(Z,Ys(Le(i,Z))):(z(Z,se.defaultValue),Xt(i,Z,Ys(se.defaultValue))),se.keepTouched||Vn(n.touchedFields,Z),se.keepDirty||(Vn(n.dirtyFields,Z),n.isDirty=se.defaultValue?F(Z,Ys(Le(i,Z))):F()),se.keepError||(Vn(n.errors,Z),h.isValid&&b()),f.state.next({...n}))},Me=(Z,se={})=>{const le=Z?Ys(Z):i,ve=Ys(le),ye=Xs(Z),me=ye?i:ve;if(se.keepDefaultValues||(i=le),!se.keepValues){if(se.keepDirtyValues)for(const ce of l.mount)Le(n.dirtyFields,ce)?Xt(me,ce,Le(o,ce)):z(ce,Le(me,ce));else{if(Uj&&kn(Z))for(const ce of l.mount){const Ce=Le(s,ce);if(Ce&&Ce._f){const He=Array.isArray(Ce._f.refs)?Ce._f.refs[0]:Ce._f.ref;if(s1(He)){const Xe=He.closest("form");if(Xe){Xe.reset();break}}}}s={}}o=e.shouldUnregister?se.keepDefaultValues?Ys(i):{}:Ys(me),f.array.next({values:{...me}}),f.values.next({values:{...me}})}l={mount:se.keepDirtyValues?l.mount:new Set,unMount:new Set,array:new Set,watch:new Set,watchAll:!1,focus:""},a.mount=!h.isValid||!!se.keepIsValid||!!se.keepDirtyValues,a.watch=!!e.shouldUnregister,f.state.next({submitCount:se.keepSubmitCount?n.submitCount:0,isDirty:ye?!1:se.keepDirty?n.isDirty:!!(se.keepDefaultValues&&!Sa(Z,i)),isSubmitted:se.keepIsSubmitted?n.isSubmitted:!1,dirtyFields:ye?{}:se.keepDirtyValues?se.keepDefaultValues&&o?pm(i,o):n.dirtyFields:se.keepDefaultValues&&Z?pm(i,Z):se.keepDirty?n.dirtyFields:{},touchedFields:se.keepTouched?n.touchedFields:{},errors:se.keepErrors?n.errors:{},isSubmitSuccessful:se.keepIsSubmitSuccessful?n.isSubmitSuccessful:!1,isSubmitting:!1})},je=(Z,se)=>Me(zo(Z)?Z(o):Z,se);return{control:{register:N,unregister:Y,getFieldState:H,handleSubmit:ue,setError:X,_executeSchema:E,_getWatch:_,_getDirty:F,_updateValid:b,_removeUnmounted:R,_updateFieldArray:x,_updateDisabledField:$,_getFieldArray:L,_reset:Me,_resetDefaultValues:()=>zo(t.defaultValues)&&t.defaultValues().then(Z=>{je(Z,t.resetOptions),f.state.next({isLoading:!1})}),_updateFormState:Z=>{n={...n,...Z}},_disableForm:ie,_subjects:f,_proxyFormState:h,_setErrors:w,get _fields(){return s},get _formValues(){return o},get _state(){return a},set _state(Z){a=Z},get _defaultValues(){return i},get _names(){return l},set _names(Z){l=Z},get _formState(){return n},set _formState(Z){n=Z},get _options(){return t},set _options(Z){t={...t,...Z}}},trigger:re,register:N,handleSubmit:ue,watch:W,setValue:z,getValues:te,reset:je,resetField:xe,clearErrors:V,unregister:Y,setError:X,setFocus:(Z,se={})=>{const le=Le(s,Z),ve=le&&le._f;if(ve){const ye=ve.refs?ve.refs[0]:ve.ref;ye.focus&&(ye.focus(),se.shouldSelect&&ye.select())}},getFieldState:H}}function hg(e={}){const t=be.useRef(),n=be.useRef(),[s,i]=be.useState({isDirty:!1,isValidating:!1,isLoading:zo(e.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1,defaultValues:zo(e.defaultValues)?void 0:e.defaultValues});t.current||(t.current={...qhe(e),formState:s});const o=t.current.control;return o._options=e,Zj({subject:o._subjects.state,next:a=>{k7(a,o._proxyFormState,o._updateFormState,!0)&&i({...o._formState})}}),be.useEffect(()=>o._disableForm(e.disabled),[o,e.disabled]),be.useEffect(()=>{if(o._proxyFormState.isDirty){const a=o._getDirty();a!==s.isDirty&&o._subjects.state.next({isDirty:a})}},[o,s.isDirty]),be.useEffect(()=>{e.values&&!Sa(e.values,n.current)?(o._reset(e.values,o._options.resetOptions),n.current=e.values,i(a=>({...a}))):o._resetDefaultValues()},[e.values,o]),be.useEffect(()=>{e.errors&&o._setErrors(e.errors)},[e.errors,o]),be.useEffect(()=>{o._state.mount||(o._updateValid(),o._state.mount=!0),o._state.watch&&(o._state.watch=!1,o._subjects.state.next({...o._formState})),o._removeUnmounted()}),be.useEffect(()=>{e.shouldUnregister&&o._subjects.values.next({values:o._getWatch()})},[e.shouldUnregister,o]),t.current.formState=j7(s,o),t.current}const D7=u.memo(()=>{const e=I(gM),t=G(),[n,{isLoading:s}]=Cd(),{register:i,handleSubmit:o,formState:a,reset:l}=hg({defaultValues:{location:""},mode:"onChange"}),c=u.useCallback(()=>l(void 0,{keepValues:!0}),[l]),d=u.useCallback(f=>{f!=null&&f.location&&n({source:f.location,inplace:e,onSuccess:c,onError:c})},[n,c,e]),h=u.useCallback(f=>{t(mM(f.target.checked))},[t]);return r.jsx("form",{onSubmit:o(d),children:r.jsxs(T,{flexDir:"column",gap:4,children:[r.jsx(T,{gap:2,alignItems:"flex-end",justifyContent:"space-between",children:r.jsxs(K,{orientation:"vertical",children:[r.jsx(J,{children:Pe("modelManager.urlOrLocalPath")}),r.jsxs(T,{alignItems:"center",gap:3,w:"full",children:[r.jsx(kt,{placeholder:Pe("modelManager.simpleModelPlaceholder"),...i("location")}),r.jsx(de,{onClick:o(d),isDisabled:!a.dirtyFields.location,isLoading:s,size:"sm",children:Pe("modelManager.install")})]}),r.jsx(Js,{children:Pe("modelManager.urlOrLocalPathHelper")})]})}),r.jsx(K,{children:r.jsxs(T,{flexDir:"column",gap:2,children:[r.jsxs(T,{gap:4,children:[r.jsx(Sn,{isChecked:e,onChange:h}),r.jsxs(J,{children:[Pe("modelManager.inplaceInstall")," (",Pe("modelManager.localOnly"),")"]})]}),r.jsx(Js,{children:Pe("modelManager.inplaceInstallDesc")})]})})]})})});D7.displayName="InstallModelForm";const Qx={waiting:{colorScheme:"cyan",translationKey:"queue.pending"},downloading:{colorScheme:"yellow",translationKey:"queue.in_progress"},downloads_done:{colorScheme:"yellow",translationKey:"queue.in_progress"},running:{colorScheme:"yellow",translationKey:"queue.in_progress"},completed:{colorScheme:"green",translationKey:"queue.completed"},error:{colorScheme:"red",translationKey:"queue.failed"},cancelled:{colorScheme:"orange",translationKey:"queue.canceled"}},Khe=({status:e})=>{const{t}=A();return!e||!Object.keys(Qx).includes(e)?null:r.jsx(Kn,{textAlign:"center",w:"134px",colorScheme:Qx[e].colorScheme,children:t(Qx[e].translationKey)})},Zhe=u.memo(Khe),s6=e=>{const t=["B","KB","MB","GB","TB"];let n=0;for(n;e>=1024&&n<4;n++)e/=1024;return`${e.toFixed(2)} ${t[n]}`},R7=u.memo(e=>{const{installJob:t}=e,[n]=UY(),s=u.useCallback(()=>{n(t.id).unwrap().then(l=>{ge({id:"MODEL_INSTALL_CANCELED",title:Pe("toast.modelImportCanceled"),status:"success"})}).catch(l=>{l&&ge({id:"MODEL_INSTALL_CANCEL_FAILED",title:`${l.data.detail} `,status:"error"})})},[n,t]),i=u.useMemo(()=>{switch(t.source.type){case"hf":return t.source.repo_id;case"url":return t.source.url;case"local":return t.source.path;default:return Pe("common.unknown")}},[t.source]),o=u.useMemo(()=>{switch(t.source.type){case"hf":return t.source.repo_id;case"url":return t.source.url.split("/").slice(-1)[0]??Pe("common.unknown");case"local":return t.source.path.split("\\").slice(-1)[0]??Pe("common.unknown");default:return Pe("common.unknown")}},[t.source]),a=u.useMemo(()=>t.status==="completed"||t.status==="error"||t.status==="cancelled"?100:qe(t.bytes)||qe(t.total_bytes)?null:t.total_bytes===0?0:t.bytes/t.total_bytes*100,[t.bytes,t.status,t.total_bytes]);return r.jsxs(T,{gap:3,w:"full",alignItems:"center",children:[r.jsx(Ee,{maxW:600,label:r.jsx(O7,{name:o,source:i,installJob:t}),children:r.jsxs(T,{gap:3,w:"full",alignItems:"center",children:[r.jsx(q,{w:96,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",children:o}),r.jsx(yM,{w:"full",flexGrow:1,value:a??0,isIndeterminate:a===null,"aria-label":Pe("accessibility.invokeProgressBar"),h:2}),r.jsx(Zhe,{status:t.status})]})}),r.jsx(oe,{isDisabled:t.status!=="downloading"&&t.status!=="waiting"&&t.status!=="running",size:"xs",tooltip:Pe("modelManager.cancel"),"aria-label":Pe("modelManager.cancel"),icon:r.jsx(Ot,{}),onClick:s,variant:"ghost"})]})});R7.displayName="ModelInstallQueueItem";const O7=u.memo(({name:e,source:t,installJob:n})=>{const s=u.useMemo(()=>n.status!=="downloading"||n.bytes===void 0||n.total_bytes===void 0?"":`${s6(n.bytes)} / ${s6(n.total_bytes)}`,[n.bytes,n.total_bytes,n.status]);return r.jsxs(r.Fragment,{children:[r.jsxs(T,{gap:3,justifyContent:"space-between",children:[r.jsx(q,{fontWeight:"semibold",children:e}),s&&r.jsx(q,{children:s})]}),r.jsx(q,{fontStyle:"italic",wordBreak:"break-all",children:t}),n.error_reason&&r.jsxs(q,{color:"error.500",children:[Pe("queue.failed"),": ",n.error]})]})});O7.displayName="TooltipLabel";const N7=u.memo(()=>{const{data:e}=qY(),[t]=KY(),n=u.useCallback(()=>{t().unwrap().then(i=>{ge({id:"MODEL_INSTALL_QUEUE_PRUNED",title:Pe("toast.prunedQueue"),status:"success"})}).catch(i=>{i&&ge({id:"MODEL_INSTALL_QUEUE_PRUNE_FAILED",title:`${i.data.detail} `,status:"error"})})},[t]),s=u.useMemo(()=>e==null?void 0:e.some(i=>i.status==="cancelled"||i.status==="error"||i.status==="completed"),[e]);return r.jsxs(T,{flexDir:"column",p:3,h:"full",gap:3,children:[r.jsxs(T,{justifyContent:"space-between",alignItems:"center",children:[r.jsx(Ft,{size:"sm",children:Pe("modelManager.installQueue")}),r.jsx(de,{size:"sm",isDisabled:!s,onClick:n,tooltip:Pe("modelManager.pruneTooltip"),children:Pe("modelManager.prune")})]}),r.jsx(Se,{layerStyle:"first",p:3,borderRadius:"base",w:"full",h:"full",children:r.jsx(os,{children:r.jsx(T,{flexDir:"column-reverse",gap:"2",w:"full",children:e==null?void 0:e.map(i=>r.jsx(R7,{installJob:i},i.id))})})})]})});N7.displayName="ModelInstallQueue";const F7=u.memo(({result:e,installModel:t})=>{const{t:n}=A(),s=u.useCallback(()=>{t(e.path)},[t,e]);return r.jsxs(T,{alignItems:"center",justifyContent:"space-between",w:"100%",gap:3,children:[r.jsxs(T,{fontSize:"sm",flexDir:"column",children:[r.jsx(q,{fontWeight:"semibold",children:e.path.split("\\").slice(-1)[0]}),r.jsx(q,{variant:"subtext",children:e.path})]}),r.jsx(Se,{children:e.is_installed?r.jsx(Kn,{children:n("common.installed")}):r.jsx(oe,{"aria-label":n("modelManager.install"),icon:r.jsx(Vt,{}),onClick:s,size:"sm"})})]})});F7.displayName="ScanModelResultItem";const B7=u.memo(({results:e})=>{const t=I(gM),n=G(),{t:s}=A(),[i,o]=u.useState(""),[a]=Cd(),l=u.useMemo(()=>e.filter(g=>{const m=g.path.split("\\").slice(-1)[0];return m==null?void 0:m.toLowerCase().includes(i.toLowerCase())}),[e,i]),c=u.useCallback(g=>{o(g.target.value.trim())},[]),d=u.useCallback(g=>{n(mM(g.target.checked))},[n]),h=u.useCallback(()=>{o("")},[]),f=u.useCallback(()=>{for(const g of l)g.is_installed||a({source:g.path,inplace:t})},[l,a,t]),p=u.useCallback(g=>{a({source:g,inplace:t})},[a,t]);return r.jsxs(r.Fragment,{children:[r.jsx(wt,{}),r.jsxs(T,{flexDir:"column",gap:3,height:"100%",children:[r.jsxs(T,{justifyContent:"space-between",alignItems:"center",children:[r.jsx(Ft,{size:"sm",children:s("modelManager.scanResults")}),r.jsxs(T,{alignItems:"center",gap:3,children:[r.jsxs(K,{w:"min-content",children:[r.jsx(J,{m:0,children:s("modelManager.inplaceInstall")}),r.jsx(Sn,{isChecked:t,onChange:d,size:"md"})]}),r.jsx(de,{size:"sm",onClick:f,isDisabled:l.length===0,children:s("modelManager.installAll")}),r.jsxs(ta,{w:64,size:"xs",children:[r.jsx(kt,{placeholder:s("modelManager.search"),value:i,"data-testid":"board-search-input",onChange:c,size:"xs"}),i&&r.jsx(co,{h:"full",pe:2,children:r.jsx(oe,{size:"sm",variant:"link","aria-label":s("boards.clearSearch"),icon:r.jsx(Ot,{}),onClick:h,flexShrink:0})})]})]})]}),r.jsx(T,{height:"100%",layerStyle:"third",borderRadius:"base",p:3,children:r.jsx(os,{children:r.jsx(T,{flexDir:"column",gap:3,children:l.map(g=>r.jsx(F7,{result:g,installModel:p},g.path))})})})]})]})});B7.displayName="ScanModelsResults";const Yhe=ZY(e=>e.scanPath),$7=u.memo(()=>{const e=I(Yhe),t=G(),[n,s]=u.useState(""),{t:i}=A(),[o,{isLoading:a,data:l}]=YY(),c=u.useCallback(()=>{o({scan_path:e}).unwrap().catch(h=>{h&&s(h.data.detail)})},[o,e]),d=u.useCallback(h=>{t(XY(h.target.value)),s("")},[t]);return r.jsxs(T,{flexDir:"column",height:"100%",gap:3,children:[r.jsxs(K,{isInvalid:!!n.length,w:"full",orientation:"vertical",flexShrink:0,children:[r.jsx(J,{children:i("common.folder")}),r.jsxs(T,{gap:3,alignItems:"center",w:"full",children:[r.jsx(kt,{placeholder:i("modelManager.scanPlaceholder"),value:e,onChange:d}),r.jsx(de,{onClick:c,isLoading:a,isDisabled:e===void 0||e.length===0,size:"sm",flexShrink:0,children:i("modelManager.scanFolder")})]}),r.jsx(Js,{children:i("modelManager.scanFolderHelper")}),!!n.length&&r.jsx(Tp,{children:n})]}),l&&r.jsx(B7,{results:l})]})});$7.displayName="ScanModelsForm";const ql=Oe(0),V7=u.memo(()=>{const{t:e}=A(),t=ae(ql),n=u.useCallback(i=>{ql.set(i)},[]),s=u.useCallback(()=>{window.open("https://support.invoke.ai/support/solutions/articles/151000170961-supported-models")},[]);return r.jsxs(T,{layerStyle:"first",borderRadius:"base",w:"full",h:"full",flexDir:"column",gap:4,children:[r.jsxs(T,{alignItems:"center",justifyContent:"space-between",children:[r.jsx(Ft,{fontSize:"xl",children:e("modelManager.addModel")}),r.jsx(de,{alignItems:"center",variant:"link",leftIcon:r.jsx(bd,{}),onClick:s,children:r.jsx(q,{variant:"subtext",children:e("modelManager.learnMoreAboutSupportedModels")})})]}),r.jsxs(sc,{variant:"collapse",height:"50%",display:"flex",flexDir:"column",index:t,onChange:n,children:[r.jsxs(rc,{children:[r.jsx(_n,{children:e("modelManager.urlOrLocalPath")}),r.jsx(_n,{children:e("modelManager.huggingFace")}),r.jsx(_n,{children:e("modelManager.scanFolder")}),r.jsx(_n,{children:e("modelManager.starterModels")})]}),r.jsxs(sd,{p:3,height:"100%",children:[r.jsx(Rn,{children:r.jsx(D7,{})}),r.jsx(Rn,{height:"100%",children:r.jsx(x7,{})}),r.jsx(Rn,{height:"100%",children:r.jsx($7,{})}),r.jsx(Rn,{height:"100%",children:r.jsx(m7,{})})]})]}),r.jsx(Se,{layerStyle:"second",borderRadius:"base",h:"50%",children:r.jsx(N7,{})})]})});V7.displayName="InstallModels";const yn=(e,t)=>(n=()=>!0)=>{const s=Ip(void 0);return[u.useMemo(()=>s.data?Ya.selectAll(s.data).filter(o=>e(o,t)).filter(n):Ls,[n,s.data]),s]},gb=yn(D0),Xhe=yn(dX),mb=yn(JY),Qhe=yn(hX),Jhe=yn(fX),efe=yn(pX),tfe=yn(gX),yb=yn(QY),z7=yn(bM),nfe=yn(iS),Qj=yn(iX),G7=yn(aX),Jj=e=>yn(nX,e==null?void 0:e.excludeSubmodels)(),xc=e=>yn(sX,e==null?void 0:e.excludeSubmodels)(),fg=yn(rX),H7=yn(sS),W7=yn(oX),bb=e=>yn(tX,e==null?void 0:e.excludeSubmodels)(),U7=e=>yn(eX,e==null?void 0:e.excludeSubmodels)(),sfe=yn(lX),q7=yn(cX),K7=yn(xM),rfe=yn(e=>sS(e)||xM(e)),Z7=yn(uX),ife=(e,t)=>fe(rS,n=>n.data?Ya.selectAll(n.data).filter(t).find(s=>s.key===e)??null:null),f0="starterModels",ofe=()=>{const{t:e}=A(),t=Bt("starterModels"),[n,s]=u.useState(!1),[i,{data:o}]=gb(),a=my();u.useEffect(()=>{if(a.isActive(f0)){if(i.length===0)return;a.close(f0)}o&&i.length===0&&!n&&t&&a({id:f0,title:e("modelManager.noModelsInstalled"),description:r.jsx(afe,{}),status:"info",isClosable:!0,duration:null,onCloseComplete:()=>s(!0)})},[o,n,t,i.length,e,a])},afe=()=>{const{t:e}=A(),t=G(),n=my(),s=u.useCallback(()=>{t(Qt("models")),ql.set(3),n.close(f0)},[t,n]);return r.jsxs(q,{fontSize:"md",children:[e("modelManager.noModelsInstalledDesc1")," ",r.jsxs(de,{onClick:s,variant:"link",color:"base.50",flexGrow:0,children:[e("ui.tabs.modelsTab"),"."]})]})},Y7=fe(yy,e=>e.language),lfe="default",cfe=Oe(lfe),ufe="https://invoke-ai.github.io/InvokeAI/faq/#unable-to-copy-on-firefox",il=()=>{const{t:e}=A(),t=u.useCallback(()=>{ge({id:"CLIPBOARD_UNAVAILABLE",title:e("toast.unableToCopy"),description:r.jsx(r.Fragment,{children:r.jsxs(q,{fontSize:"md",children:[e("toast.unableToCopyDesc"),r.jsx(sr,{display:"inline",fontWeight:"semibold",href:ufe,label:e("toast.unableToCopyDesc_theseSteps")}),"."]})}),status:"error"})},[e]),n=u.useMemo(()=>!(!navigator.clipboard||!window.ClipboardItem),[]),s=u.useCallback((a,l)=>{if(!n){t();return}navigator.clipboard.writeText(a),l==null||l()},[t,n]),i=u.useCallback((a,l)=>{if(!n){t();return}navigator.clipboard.write(a),l==null||l()},[t,n]),o=u.useCallback((a,l)=>{if(!n){t();return}const c=[new ClipboardItem({"image/png":a})];navigator.clipboard.write(c),l==null||l()},[t,n]);return{isAvailable:n,writeText:s,write:i,writeImage:o}},dfe=u.memo(e=>e.image?r.jsx(oS,{w:`${e.image.width}px`,h:"auto",objectFit:"contain",aspectRatio:`${e.image.width}/${e.image.height}`}):r.jsx(T,{opacity:.7,w:"full",h:"full",alignItems:"center",justifyContent:"center",borderRadius:"base",bg:"base.900",children:r.jsx(Lr,{size:"xl"})}));dfe.displayName="IAILoadingImageFallback";const Pt=u.memo(e=>{const{icon:t=Gu,boxSize:n=16,...s}=e;return r.jsxs(T,{w:"full",h:"full",alignItems:"center",justifyContent:"center",borderRadius:"base",flexDir:"column",gap:2,userSelect:"none",opacity:.7,color:"base.500",fontSize:"md",...s,children:[t&&r.jsx(lt,{as:t,boxSize:n,opacity:.7}),e.label&&r.jsx(q,{textAlign:"center",children:e.label})]})});Pt.displayName="IAINoContentFallback";const xb=u.memo(e=>{const{sx:t,...n}=e,s=u.useMemo(()=>({w:"full",h:"full",alignItems:"center",justifyContent:"center",borderRadius:"base",flexDir:"column",gap:2,userSelect:"none",opacity:.7,color:"base.500",...t}),[t]);return r.jsxs(T,{sx:s,...n,children:[r.jsx(Lr,{size:"xl"}),e.label&&r.jsx(q,{textAlign:"center",children:e.label})]})});xb.displayName="IAINoContentFallbackWithSpinner";const X7=u.memo(e=>r.jsx(lt,{boxSize:8,opacity:1,stroke:"base.500",viewBox:"0 0 66 66",fill:"none",...e,children:r.jsx("path",{d:"M43.9137 16H63.1211V3H3.12109V16H22.3285L43.9137 50H63.1211V63H3.12109V50H22.3285",strokeWidth:"5"})}));X7.displayName="InvokeLogoIcon";const Q7=Symbol("LOADING"),hfe=()=>{const{data:e,isLoading:t}=ic({include_archived:!0}),{data:n,isLoading:s}=oc({board_id:"none",offset:0,limit:0,is_intermediate:!1});return u.useMemo(()=>t||s?Q7:e&&e.length>0&&e.filter(a=>a.image_count>0).length>0?!0:n?n.total>0:!0,[e,n,t,s])},J7=u.memo(()=>{const e=hfe(),[t,{data:n}]=gb(),s=I(vM),i=Bt("starterModels"),o=I(An),{t:a}=A(),l=u.useMemo(()=>i&&n&&t.length===0,[t.length,n,i]);return e===Q7?r.jsx(ffe,{}):e?r.jsx(Pt,{icon:Gu,label:a("gallery.noImageSelected")}):r.jsxs(T,{flexDir:"column",gap:8,alignItems:"center",textAlign:"center",maxW:"400px",children:[r.jsx(X7,{w:32,h:32}),r.jsxs(T,{flexDir:"column",gap:4,alignItems:"center",textAlign:"center",children:[s?r.jsx(pfe,{}):o==="workflows"?r.jsx(mfe,{}):r.jsx(gfe,{}),l&&r.jsx(bfe,{}),r.jsx(wt,{}),r.jsx(yfe,{}),s&&r.jsx(xfe,{})]})]})});J7.displayName="NoContentForViewer";const ffe=()=>r.jsx(T,{position:"relative",width:"full",height:"full",alignItems:"center",justifyContent:"center",children:r.jsx(Lr,{label:"Loading",color:"grey",position:"absolute",size:"sm",width:8,height:8,right:4,bottom:4})}),vb=e=>r.jsx(de,{as:by,variant:"unstyled",isExternal:!0,display:"inline-flex",alignItems:"center",rightIcon:r.jsx(ib,{}),color:"base.50",mt:-1,...e}),r6=e=>r.jsx(de,{variant:"link",size:"md",onClick:e.onClick,color:"base.50",children:e.children}),ek=r.jsx(q,{as:"span",color:"base.50",fontSize:"md"}),pfe=()=>r.jsx(q,{fontSize:"md",color:"base.200",children:r.jsx(Ut,{i18nKey:"newUserExperience.toGetStartedLocal",components:{StrongComponent:ek}})}),gfe=()=>r.jsx(q,{fontSize:"md",color:"base.200",children:r.jsx(Ut,{i18nKey:"newUserExperience.toGetStarted",components:{StrongComponent:ek}})}),mfe=()=>r.jsx(q,{fontSize:"md",color:"base.200",children:r.jsx(Ut,{i18nKey:"newUserExperience.toGetStartedWorkflow",components:{StrongComponent:ek}})}),yfe=()=>r.jsx(q,{fontSize:"md",color:"base.200",children:r.jsx(Ut,{i18nKey:"newUserExperience.gettingStartedSeries",components:{LinkComponent:r.jsx(vb,{href:"https://www.youtube.com/playlist?list=PLvWK1Kc8iXGrQy8r9TYg6QdUuJ5MMx-ZO"})}})}),bfe=()=>{const e=G(),t=u.useCallback(()=>{e(Qt("models")),ql.set(3)},[e]),n=u.useCallback(()=>{e(Qt("models")),ql.set(0)},[e]);return r.jsx(q,{fontSize:"md",color:"base.200",children:r.jsx(Ut,{i18nKey:"newUserExperience.noModelsInstalled",components:{DownloadStarterModelsButton:r.jsx(r6,{onClick:t}),ImportModelsButton:r.jsx(r6,{onClick:n})}})})},xfe=()=>r.jsxs(ac,{status:"warning",borderRadius:"base",fontSize:"md",shadow:"md",w:"fit-content",children:[r.jsx(lc,{}),r.jsx(Ta,{children:r.jsx(Ut,{i18nKey:"newUserExperience.lowVRAMMode",components:{LinkComponent:r.jsx(vb,{href:"https://invoke-ai.github.io/InvokeAI/features/low-vram/"})}})})]}),vfe=e=>e==="OutOfMemoryError"?Pe("toast.outOfMemoryError"):Pe("toast.serverError");function Cfe({errorType:e,isLocal:t,sessionId:n,errorMessage:s}){const{t:i}=A(),o=il(),a=u.useMemo(()=>{if(e==="OutOfMemoryError")return t?r.jsx(Ut,{i18nKey:"toast.outOfMemoryErrorDescLocal",components:{LinkComponent:r.jsx(vb,{href:"https://invoke-ai.github.io/InvokeAI/features/low-vram/"})}}):i("toast.outOfMemoryErrorDesc");if(s)return`${e}: ${s}`},[s,e,t,i]),l=u.useCallback(()=>o.writeText(n),[n,o]);return r.jsxs(T,{flexDir:"column",children:[a&&r.jsx(q,{noOfLines:4,fontSize:"md",children:a}),!t&&r.jsxs(T,{gap:"2",alignItems:"center",children:[r.jsx(q,{fontSize:"sm",fontStyle:"italic",children:i("toast.sessionRef",{sessionId:n})}),r.jsx(oe,{size:"sm","aria-label":"Copy",icon:r.jsx(un,{}),onClick:l,variant:"ghost",sx:{svg:{fill:"base.50"}}})]})]})}const i6=$n("events"),wfe=e=>e.invocation_source_id.split(":")[0]===vX,Sfe=["load_image","image"],jfe=(e,t)=>{const n=(l,c)=>{if(Sfe.includes(l.invocation.type)){i6.trace("Skipping node type denylisted");return}if(c.is_intermediate)return;t(yX.util.updateQueryData("getBoardImagesTotal",c.board_id??"none",g=>{g.total+=1})),t(aS.util.invalidateTags([{type:"Board",id:c.board_id??"none"},{type:"ImageList",id:bX({board_id:c.board_id??"none",categories:xX(c)})}]));const{shouldAutoSwitch:d,selectedBoardId:h,galleryView:f,offset:p}=e().gallery;d&&(c.board_id&&c.board_id!==h?t(Hf({boardId:c.board_id,selectedImageName:c.image_name})):!c.board_id&&h!=="none"?t(Hf({boardId:"none",selectedImageName:c.image_name})):(t(CM(c)),f!=="images"?t(I2("images")):p>0&&t(wM({offset:0}))))},s=l=>{const{result:c}=l;return c.type==="image_output"?xy(c.image.image_name):null},i=async l=>{const{result:c,invocation_source_id:d}=l,h=gt(Kc.get()[d]);h&&(h.status=er.enum.COMPLETED,h.progress!==null&&(h.progress=1),h.outputs.push(c),s0(h.nodeId,h));const f=await s(l);f&&!f.is_intermediate&&n(l,f)},o=async l=>{const c=await s(l);c&&(l.destination==="canvas"?wfe(l)&&(l.result.type==="image_output"&&t(mX({stagingAreaImage:{imageDTO:c,offsetX:0,offsetY:0}})),n(l,c)):c.is_intermediate||n(l,c))},a=async l=>{const c=await s(l);c&&!c.is_intermediate&&n(l,c)};return async l=>{i6.debug({data:l},`Invocation complete (${l.invocation.type}, ${l.invocation_source_id})`),l.origin==="workflows"?await i(l):l.origin==="canvas"?await o(l):await a(l),Bo.set(null)}},nn=$n("events"),Fc=Hi.endpoints.listModelInstalls.select(),kfe=({socket:e,store:t,setIsConnected:n})=>{const{dispatch:s,getState:i}=t;e.on("connect",()=>{nn.debug("Connected"),n(!0),s(CX());const l=wX.get();if(e.emit("subscribe_queue",{queue_id:l}),!SM.get()){const c=cfe.get();e.emit("subscribe_bulk_download",{bulk_download_id:c})}Bo.set(null)}),e.on("connect_error",l=>{nn.debug("Connect error"),n(!1),Bo.set(null),l&&l.message&&l.data==="ERR_UNAUTHENTICATED"&&ge({id:`connect-error-${l.message}`,title:l.message,status:"error",duration:1e4})}),e.on("disconnect",()=>{nn.debug("Disconnected"),Bo.set(null),n(!1)}),e.on("invocation_started",l=>{const{invocation_source_id:c,invocation:d}=l;nn.debug({data:l},`Invocation started (${d.type}, ${c})`);const h=gt(Kc.get()[c]);h&&(h.status=er.enum.IN_PROGRESS,s0(h.nodeId,h))}),e.on("invocation_progress",l=>{const{invocation_source_id:c,invocation:d,image:h,origin:f,percentage:p,message:g}=l;let m="Invocation progress";if(g&&(m+=`: ${g}`),qe(p)||(m+=` ${Ap(p*100,2)}%`),m+=` (${d.type}, ${c})`,nn.trace({data:l},m),Bo.set(l),f==="workflows"){const y=gt(Kc.get()[c]);y&&(y.status=er.enum.IN_PROGRESS,y.progress=p,y.progressImage=h??null,s0(y.nodeId,y))}}),e.on("invocation_error",l=>{const{invocation_source_id:c,invocation:d,error_type:h,error_message:f,error_traceback:p}=l;nn.error({data:l},`Invocation error (${d.type}, ${c})`);const g=gt(Kc.get()[c]);g&&(g.status=er.enum.FAILED,g.progress=null,g.progressImage=null,g.error={error_type:h,error_message:f,error_traceback:p},s0(g.nodeId,g))});const o=jfe(i,s);e.on("invocation_complete",o),e.on("model_load_started",l=>{const{config:c,submodel_type:d}=l,{name:h,base:f,type:p}=c,g=[f,p];d&&g.push(d);const m=`Model load started: ${h} (${g.join(", ")})`;nn.debug({data:l},m)}),e.on("model_load_complete",l=>{const{config:c,submodel_type:d}=l,{name:h,base:f,type:p}=c,g=[f,p];d&&g.push(d);const m=`Model load complete: ${h} (${g.join(", ")})`;nn.debug({data:l},m)}),e.on("download_started",l=>{nn.debug({data:l},"Download started")}),e.on("download_progress",l=>{nn.trace({data:l},"Download progress")}),e.on("download_complete",l=>{nn.debug({data:l},"Download complete")}),e.on("download_cancelled",l=>{nn.warn({data:l},"Download cancelled")}),e.on("download_error",l=>{nn.error({data:l},"Download error")}),e.on("model_install_started",l=>{nn.debug({data:l},"Model install started");const{id:c}=l,d=Fc(i()).data;d!=null&&d.find(h=>h.id===c)?s(Hi.util.updateQueryData("listModelInstalls",void 0,h=>{const f=h.find(p=>p.id===c);return f&&(f.status="running"),h})):s(Po.util.invalidateTags([{type:"ModelInstalls"}]))}),e.on("model_install_download_started",l=>{nn.debug({data:l},"Model install download started");const{id:c}=l,d=Fc(i()).data;d!=null&&d.find(h=>h.id===c)?s(Hi.util.updateQueryData("listModelInstalls",void 0,h=>{const f=h.find(p=>p.id===c);return f&&(f.status="downloading"),h})):s(Po.util.invalidateTags([{type:"ModelInstalls"}]))}),e.on("model_install_download_progress",l=>{nn.trace({data:l},"Model install download progress");const{bytes:c,total_bytes:d,id:h}=l,f=Fc(i()).data;f!=null&&f.find(p=>p.id===h)?s(Hi.util.updateQueryData("listModelInstalls",void 0,p=>{const g=p.find(m=>m.id===h);return g&&(g.bytes=c,g.total_bytes=d,g.status="downloading"),p})):s(Po.util.invalidateTags([{type:"ModelInstalls"}]))}),e.on("model_install_downloads_complete",l=>{nn.debug({data:l},"Model install downloads complete");const{id:c}=l,d=Fc(i()).data;d!=null&&d.find(h=>h.id===c)?s(Hi.util.updateQueryData("listModelInstalls",void 0,h=>{const f=h.find(p=>p.id===c);return f&&(f.status="downloads_done"),h})):s(Po.util.invalidateTags([{type:"ModelInstalls"}]))}),e.on("model_install_complete",l=>{nn.debug({data:l},"Model install complete");const{id:c}=l,d=Fc(i()).data;d!=null&&d.find(h=>h.id===c)?s(Hi.util.updateQueryData("listModelInstalls",void 0,h=>{const f=h.find(p=>p.id===c);return f&&(f.status="completed"),h})):s(Po.util.invalidateTags([{type:"ModelInstalls"}])),s(Po.util.invalidateTags([{type:"ModelConfig",id:Q4}])),s(Po.util.invalidateTags([{type:"ModelScanFolderResults",id:Q4}]))});const a=The(i,s);e.on("model_install_error",a),e.on("model_install_cancelled",l=>{nn.warn({data:l},"Model install cancelled");const{id:c}=l,d=Fc(i()).data;d!=null&&d.find(h=>h.id===c)?s(Hi.util.updateQueryData("listModelInstalls",void 0,h=>{const f=h.find(p=>p.id===c);return f&&(f.status="cancelled"),h})):s(Po.util.invalidateTags([{type:"ModelInstalls"}]))}),e.on("queue_item_status_changed",l=>{const{item_id:c,session_id:d,status:h,started_at:f,updated_at:p,completed_at:g,batch_status:m,queue_status:y,error_type:b,error_message:C,error_traceback:x,destination:v}=l;nn.debug({data:l},`Queue item ${c} status updated: ${h}`),s(Tl.util.updateQueryData("listQueueItems",void 0,S=>{SX.updateOne(S,{id:String(c),changes:{status:h,started_at:f,updated_at:p??void 0,completed_at:g??void 0,error_type:b,error_message:C,error_traceback:x}})})),s(Tl.util.updateQueryData("getQueueStatus",void 0,S=>{S&&Object.assign(S.queue,y)})),s(Tl.util.updateQueryData("getBatchStatus",{batch_id:m.batch_id},()=>m));const w=["CurrentSessionQueueItem","NextSessionQueueItem","InvocationCacheStatus",{type:"SessionQueueItem",id:c}];if(v&&w.push({type:"QueueCountsByDestination",id:v}),s(Tl.util.invalidateTags(w)),h==="in_progress")jX(Kc.get(),S=>{if(!S)return;const j=gt(S);j.status=er.enum.PENDING,j.error=null,j.progress=null,j.progressImage=null,j.outputs=[],Kc.setKey(j.nodeId,j)});else if(h==="completed"||h==="failed"||h==="canceled"){if(h==="failed"&&b){const j=i().config.isLocal??!0,P=d;ge({id:`INVOCATION_ERROR_${b}`,title:vfe(b),status:"error",duration:null,updateDescription:j,description:r.jsx(Cfe,{errorType:b,errorMessage:C,sessionId:P,isLocal:j})})}Bo.set(null);const S=$0.get();if(!S||m.batch_id!==S.batchId||h!=="completed")return;kX.startListening({matcher:_X(va.endpoints.getWorkflow.matchFulfilled,va.endpoints.getWorkflow.matchRejected),effect:(j,P)=>{va.endpoints.getWorkflow.matchFulfilled(j)?j.payload.workflow_id===S.workflowId&&(P.unsubscribe(),$0.set(null),na.set(!1),Xo.set(null)):va.endpoints.getWorkflow.matchRejected(j)&&P.unsubscribe()}}),s(va.util.invalidateTags([{type:"Workflow",id:S.workflowId}]))}}),e.on("queue_cleared",l=>{nn.debug({data:l},"Queue cleared")}),e.on("batch_enqueued",l=>{nn.debug({data:l},"Batch enqueued")}),e.on("queue_items_retried",l=>{nn.debug({data:l},"Queue items retried")}),e.on("bulk_download_started",l=>{nn.debug({data:l},"Bulk gallery download preparation started")}),e.on("bulk_download_complete",l=>{nn.debug({data:l},"Bulk gallery download ready");const{bulk_download_item_name:c}=l,d=`/api/v1/images/download/${c}`;ge({id:c,title:Pe("gallery.bulkDownloadReady","Download ready"),status:"success",description:r.jsx(sr,{label:Pe("gallery.clickToDownload","Click here to download"),href:d,download:c}),duration:null})}),e.on("bulk_download_error",l=>{nn.error({data:l},"Bulk gallery download error");const{bulk_download_item_name:c,error:d}=l;ge({id:c,title:Pe("gallery.bulkDownloadFailed"),status:"error",description:d,duration:null})})},mo=Object.create(null);mo.open="0";mo.close="1";mo.ping="2";mo.pong="3";mo.message="4";mo.upgrade="5";mo.noop="6";const p0=Object.create(null);Object.keys(mo).forEach(e=>{p0[mo[e]]=e});const wC={type:"error",data:"parser error"},e9=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",t9=typeof ArrayBuffer=="function",n9=e=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,tk=({type:e,data:t},n,s)=>e9&&t instanceof Blob?n?s(t):o6(t,s):t9&&(t instanceof ArrayBuffer||n9(t))?n?s(t):o6(new Blob([t]),s):s(mo[e]+(t||"")),o6=(e,t)=>{const n=new FileReader;return n.onload=function(){const s=n.result.split(",")[1];t("b"+(s||""))},n.readAsDataURL(e)};function a6(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}let Jx;function _fe(e,t){if(e9&&e.data instanceof Blob)return e.data.arrayBuffer().then(a6).then(t);if(t9&&(e.data instanceof ArrayBuffer||n9(e.data)))return t(a6(e.data));tk(e,!1,n=>{Jx||(Jx=new TextEncoder),t(Jx.encode(n))})}const l6="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",uf=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let e=0;e<l6.length;e++)uf[l6.charCodeAt(e)]=e;const Ife=e=>{let t=e.length*.75,n=e.length,s,i=0,o,a,l,c;e[e.length-1]==="="&&(t--,e[e.length-2]==="="&&t--);const d=new ArrayBuffer(t),h=new Uint8Array(d);for(s=0;s<n;s+=4)o=uf[e.charCodeAt(s)],a=uf[e.charCodeAt(s+1)],l=uf[e.charCodeAt(s+2)],c=uf[e.charCodeAt(s+3)],h[i++]=o<<2|a>>4,h[i++]=(a&15)<<4|l>>2,h[i++]=(l&3)<<6|c&63;return d},Tfe=typeof ArrayBuffer=="function",nk=(e,t)=>{if(typeof e!="string")return{type:"message",data:s9(e,t)};const n=e.charAt(0);return n==="b"?{type:"message",data:Afe(e.substring(1),t)}:p0[n]?e.length>1?{type:p0[n],data:e.substring(1)}:{type:p0[n]}:wC},Afe=(e,t)=>{if(Tfe){const n=Ife(e);return s9(n,t)}else return{base64:!0,data:e}},s9=(e,t)=>{switch(t){case"blob":return e instanceof Blob?e:new Blob([e]);case"arraybuffer":default:return e instanceof ArrayBuffer?e:e.buffer}},r9="",Efe=(e,t)=>{const n=e.length,s=new Array(n);let i=0;e.forEach((o,a)=>{tk(o,!1,l=>{s[a]=l,++i===n&&t(s.join(r9))})})},Mfe=(e,t)=>{const n=e.split(r9),s=[];for(let i=0;i<n.length;i++){const o=nk(n[i],t);if(s.push(o),o.type==="error")break}return s};function Pfe(){return new TransformStream({transform(e,t){_fe(e,n=>{const s=n.length;let i;if(s<126)i=new Uint8Array(1),new DataView(i.buffer).setUint8(0,s);else if(s<65536){i=new Uint8Array(3);const o=new DataView(i.buffer);o.setUint8(0,126),o.setUint16(1,s)}else{i=new Uint8Array(9);const o=new DataView(i.buffer);o.setUint8(0,127),o.setBigUint64(1,BigInt(s))}e.data&&typeof e.data!="string"&&(i[0]|=128),t.enqueue(i),t.enqueue(n)})}})}let ev;function gm(e){return e.reduce((t,n)=>t+n.length,0)}function mm(e,t){if(e[0].length===t)return e.shift();const n=new Uint8Array(t);let s=0;for(let i=0;i<t;i++)n[i]=e[0][s++],s===e[0].length&&(e.shift(),s=0);return e.length&&s<e[0].length&&(e[0]=e[0].slice(s)),n}function Lfe(e,t){ev||(ev=new TextDecoder);const n=[];let s=0,i=-1,o=!1;return new TransformStream({transform(a,l){for(n.push(a);;){if(s===0){if(gm(n)<1)break;const c=mm(n,1);o=(c[0]&128)===128,i=c[0]&127,i<126?s=3:i===126?s=1:s=2}else if(s===1){if(gm(n)<2)break;const c=mm(n,2);i=new DataView(c.buffer,c.byteOffset,c.length).getUint16(0),s=3}else if(s===2){if(gm(n)<8)break;const c=mm(n,8),d=new DataView(c.buffer,c.byteOffset,c.length),h=d.getUint32(0);if(h>Math.pow(2,21)-1){l.enqueue(wC);break}i=h*Math.pow(2,32)+d.getUint32(4),s=3}else{if(gm(n)<i)break;const c=mm(n,i);l.enqueue(nk(o?c:ev.decode(c),t)),s=0}if(i===0||i>e){l.enqueue(wC);break}}}})}const i9=4;function On(e){if(e)return Dfe(e)}function Dfe(e){for(var t in On.prototype)e[t]=On.prototype[t];return e}On.prototype.on=On.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this};On.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this};On.prototype.off=On.prototype.removeListener=On.prototype.removeAllListeners=On.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var n=this._callbacks["$"+e];if(!n)return this;if(arguments.length==1)return delete this._callbacks["$"+e],this;for(var s,i=0;i<n.length;i++)if(s=n[i],s===t||s.fn===t){n.splice(i,1);break}return n.length===0&&delete this._callbacks["$"+e],this};On.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),n=this._callbacks["$"+e],s=1;s<arguments.length;s++)t[s-1]=arguments[s];if(n){n=n.slice(0);for(var s=0,i=n.length;s<i;++s)n[s].apply(this,t)}return this};On.prototype.emitReserved=On.prototype.emit;On.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]};On.prototype.hasListeners=function(e){return!!this.listeners(e).length};const Cb=typeof Promise=="function"&&typeof Promise.resolve=="function"?t=>Promise.resolve().then(t):(t,n)=>n(t,0),Zr=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),Rfe="arraybuffer";function o9(e,...t){return t.reduce((n,s)=>(e.hasOwnProperty(s)&&(n[s]=e[s]),n),{})}const Ofe=Zr.setTimeout,Nfe=Zr.clearTimeout;function wb(e,t){t.useNativeTimers?(e.setTimeoutFn=Ofe.bind(Zr),e.clearTimeoutFn=Nfe.bind(Zr)):(e.setTimeoutFn=Zr.setTimeout.bind(Zr),e.clearTimeoutFn=Zr.clearTimeout.bind(Zr))}const Ffe=1.33;function Bfe(e){return typeof e=="string"?$fe(e):Math.ceil((e.byteLength||e.size)*Ffe)}function $fe(e){let t=0,n=0;for(let s=0,i=e.length;s<i;s++)t=e.charCodeAt(s),t<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(s++,n+=4);return n}function a9(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function Vfe(e){let t="";for(let n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t}function zfe(e){let t={},n=e.split("&");for(let s=0,i=n.length;s<i;s++){let o=n[s].split("=");t[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return t}class Gfe extends Error{constructor(t,n,s){super(t),this.description=n,this.context=s,this.type="TransportError"}}class sk extends On{constructor(t){super(),this.writable=!1,wb(this,t),this.opts=t,this.query=t.query,this.socket=t.socket,this.supportsBinary=!t.forceBase64}onError(t,n,s){return super.emitReserved("error",new Gfe(t,n,s)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(t){this.readyState==="open"&&this.write(t)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(t){const n=nk(t,this.socket.binaryType);this.onPacket(n)}onPacket(t){super.emitReserved("packet",t)}onClose(t){this.readyState="closed",super.emitReserved("close",t)}pause(t){}createUri(t,n={}){return t+"://"+this._hostname()+this._port()+this.opts.path+this._query(n)}_hostname(){const t=this.opts.hostname;return t.indexOf(":")===-1?t:"["+t+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(t){const n=Vfe(t);return n.length?"?"+n:""}}class Hfe extends sk{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(t){this.readyState="pausing";const n=()=>{this.readyState="paused",t()};if(this._polling||!this.writable){let s=0;this._polling&&(s++,this.once("pollComplete",function(){--s||n()})),this.writable||(s++,this.once("drain",function(){--s||n()}))}else n()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(t){const n=s=>{if(this.readyState==="opening"&&s.type==="open"&&this.onOpen(),s.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(s)};Mfe(t,this.socket.binaryType).forEach(n),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const t=()=>{this.write([{type:"close"}])};this.readyState==="open"?t():this.once("open",t)}write(t){this.writable=!1,Efe(t,n=>{this.doWrite(n,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const t=this.opts.secure?"https":"http",n=this.query||{};return this.opts.timestampRequests!==!1&&(n[this.opts.timestampParam]=a9()),!this.supportsBinary&&!n.sid&&(n.b64=1),this.createUri(t,n)}}let l9=!1;try{l9=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const Wfe=l9;function Ufe(){}class qfe extends Hfe{constructor(t){if(super(t),typeof location<"u"){const n=location.protocol==="https:";let s=location.port;s||(s=n?"443":"80"),this.xd=typeof location<"u"&&t.hostname!==location.hostname||s!==t.port}}doWrite(t,n){const s=this.request({method:"POST",data:t});s.on("success",n),s.on("error",(i,o)=>{this.onError("xhr post error",i,o)})}doPoll(){const t=this.request();t.on("data",this.onData.bind(this)),t.on("error",(n,s)=>{this.onError("xhr poll error",n,s)}),this.pollXhr=t}}class ro extends On{constructor(t,n,s){super(),this.createRequest=t,wb(this,s),this._opts=s,this._method=s.method||"GET",this._uri=n,this._data=s.data!==void 0?s.data:null,this._create()}_create(){var t;const n=o9(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");n.xdomain=!!this._opts.xd;const s=this._xhr=this.createRequest(n);try{s.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){s.setDisableHeaderCheck&&s.setDisableHeaderCheck(!0);for(let i in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(i)&&s.setRequestHeader(i,this._opts.extraHeaders[i])}}catch{}if(this._method==="POST")try{s.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{s.setRequestHeader("Accept","*/*")}catch{}(t=this._opts.cookieJar)===null||t===void 0||t.addCookies(s),"withCredentials"in s&&(s.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(s.timeout=this._opts.requestTimeout),s.onreadystatechange=()=>{var i;s.readyState===3&&((i=this._opts.cookieJar)===null||i===void 0||i.parseCookies(s.getResponseHeader("set-cookie"))),s.readyState===4&&(s.status===200||s.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof s.status=="number"?s.status:0)},0))},s.send(this._data)}catch(i){this.setTimeoutFn(()=>{this._onError(i)},0);return}typeof document<"u"&&(this._index=ro.requestsCount++,ro.requests[this._index]=this)}_onError(t){this.emitReserved("error",t,this._xhr),this._cleanup(!0)}_cleanup(t){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=Ufe,t)try{this._xhr.abort()}catch{}typeof document<"u"&&delete ro.requests[this._index],this._xhr=null}}_onLoad(){const t=this._xhr.responseText;t!==null&&(this.emitReserved("data",t),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}ro.requestsCount=0;ro.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",c6);else if(typeof addEventListener=="function"){const e="onpagehide"in Zr?"pagehide":"unload";addEventListener(e,c6,!1)}}function c6(){for(let e in ro.requests)ro.requests.hasOwnProperty(e)&&ro.requests[e].abort()}const Kfe=function(){const e=c9({xdomain:!1});return e&&e.responseType!==null}();class Zfe extends qfe{constructor(t){super(t);const n=t&&t.forceBase64;this.supportsBinary=Kfe&&!n}request(t={}){return Object.assign(t,{xd:this.xd},this.opts),new ro(c9,this.uri(),t)}}function c9(e){const t=e.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!t||Wfe))return new XMLHttpRequest}catch{}if(!t)try{return new Zr[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const u9=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class Yfe extends sk{get name(){return"websocket"}doOpen(){const t=this.uri(),n=this.opts.protocols,s=u9?{}:o9(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(s.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(t,n,s)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=t=>this.onClose({description:"websocket connection closed",context:t}),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=!1;for(let n=0;n<t.length;n++){const s=t[n],i=n===t.length-1;tk(s,this.supportsBinary,o=>{try{this.doWrite(s,o)}catch{}i&&Cb(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){const t=this.opts.secure?"wss":"ws",n=this.query||{};return this.opts.timestampRequests&&(n[this.opts.timestampParam]=a9()),this.supportsBinary||(n.b64=1),this.createUri(t,n)}}const tv=Zr.WebSocket||Zr.MozWebSocket;let Xfe=class extends Yfe{createSocket(t,n,s){return u9?new tv(t,n,s):n?new tv(t,n):new tv(t)}doWrite(t,n){this.ws.send(n)}};class Qfe extends sk{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(t){return this.emitReserved("error",t)}this._transport.closed.then(()=>{this.onClose()}).catch(t=>{this.onError("webtransport error",t)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(t=>{const n=Lfe(Number.MAX_SAFE_INTEGER,this.socket.binaryType),s=t.readable.pipeThrough(n).getReader(),i=Pfe();i.readable.pipeTo(t.writable),this._writer=i.writable.getWriter();const o=()=>{s.read().then(({done:l,value:c})=>{l||(this.onPacket(c),o())}).catch(l=>{})};o();const a={type:"open"};this.query.sid&&(a.data=`{"sid":"${this.query.sid}"}`),this._writer.write(a).then(()=>this.onOpen())})})}write(t){this.writable=!1;for(let n=0;n<t.length;n++){const s=t[n],i=n===t.length-1;this._writer.write(s).then(()=>{i&&Cb(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var t;(t=this._transport)===null||t===void 0||t.close()}}const Jfe={websocket:Xfe,webtransport:Qfe,polling:Zfe},epe=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,tpe=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function SC(e){if(e.length>8e3)throw"URI too long";const t=e,n=e.indexOf("["),s=e.indexOf("]");n!=-1&&s!=-1&&(e=e.substring(0,n)+e.substring(n,s).replace(/:/g,";")+e.substring(s,e.length));let i=epe.exec(e||""),o={},a=14;for(;a--;)o[tpe[a]]=i[a]||"";return n!=-1&&s!=-1&&(o.source=t,o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":"),o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":"),o.ipv6uri=!0),o.pathNames=npe(o,o.path),o.queryKey=spe(o,o.query),o}function npe(e,t){const n=/\/{2,9}/g,s=t.replace(n,"/").split("/");return(t.slice(0,1)=="/"||t.length===0)&&s.splice(0,1),t.slice(-1)=="/"&&s.splice(s.length-1,1),s}function spe(e,t){const n={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(s,i,o){i&&(n[i]=o)}),n}const jC=typeof addEventListener=="function"&&typeof removeEventListener=="function",g0=[];jC&&addEventListener("offline",()=>{g0.forEach(e=>e())},!1);class Ba extends On{constructor(t,n){if(super(),this.binaryType=Rfe,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,t&&typeof t=="object"&&(n=t,t=null),t){const s=SC(t);n.hostname=s.host,n.secure=s.protocol==="https"||s.protocol==="wss",n.port=s.port,s.query&&(n.query=s.query)}else n.host&&(n.hostname=SC(n.host).host);wb(this,n),this.secure=n.secure!=null?n.secure:typeof location<"u"&&location.protocol==="https:",n.hostname&&!n.port&&(n.port=this.secure?"443":"80"),this.hostname=n.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=n.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},n.transports.forEach(s=>{const i=s.prototype.name;this.transports.push(i),this._transportsByName[i]=s}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},n),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=zfe(this.opts.query)),jC&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},g0.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(t){const n=Object.assign({},this.opts.query);n.EIO=i9,n.transport=t,this.id&&(n.sid=this.id);const s=Object.assign({},this.opts,{query:n,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[t]);return new this._transportsByName[t](s)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const t=this.opts.rememberUpgrade&&Ba.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const n=this.createTransport(t);n.open(),this.setTransport(n)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",n=>this._onClose("transport close",n))}onOpen(){this.readyState="open",Ba.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const n=new Error("server error");n.code=t.data,this._onError(n);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data);break}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this._pingInterval=t.pingInterval,this._pingTimeout=t.pingTimeout,this._maxPayload=t.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const t=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+t,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},t),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const t=this._getWritablePackets();this.transport.send(t),this._prevBufferLen=t.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let n=1;for(let s=0;s<this.writeBuffer.length;s++){const i=this.writeBuffer[s].data;if(i&&(n+=Bfe(i)),s>0&&n>this._maxPayload)return this.writeBuffer.slice(0,s);n+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const t=Date.now()>this._pingTimeoutTime;return t&&(this._pingTimeoutTime=0,Cb(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),t}write(t,n,s){return this._sendPacket("message",t,n,s),this}send(t,n,s){return this._sendPacket("message",t,n,s),this}_sendPacket(t,n,s,i){if(typeof n=="function"&&(i=n,n=void 0),typeof s=="function"&&(i=s,s=null),this.readyState==="closing"||this.readyState==="closed")return;s=s||{},s.compress=s.compress!==!1;const o={type:t,data:n,options:s};this.emitReserved("packetCreate",o),this.writeBuffer.push(o),i&&this.once("flush",i),this.flush()}close(){const t=()=>{this._onClose("forced close"),this.transport.close()},n=()=>{this.off("upgrade",n),this.off("upgradeError",n),t()},s=()=>{this.once("upgrade",n),this.once("upgradeError",n)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?s():t()}):this.upgrading?s():t()),this}_onError(t){if(Ba.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",t),this._onClose("transport error",t)}_onClose(t,n){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),jC&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const s=g0.indexOf(this._offlineEventListener);s!==-1&&g0.splice(s,1)}this.readyState="closed",this.id=null,this.emitReserved("close",t,n),this.writeBuffer=[],this._prevBufferLen=0}}}Ba.protocol=i9;class rpe extends Ba{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let t=0;t<this._upgrades.length;t++)this._probe(this._upgrades[t])}_probe(t){let n=this.createTransport(t),s=!1;Ba.priorWebsocketSuccess=!1;const i=()=>{s||(n.send([{type:"ping",data:"probe"}]),n.once("packet",f=>{if(!s)if(f.type==="pong"&&f.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",n),!n)return;Ba.priorWebsocketSuccess=n.name==="websocket",this.transport.pause(()=>{s||this.readyState!=="closed"&&(h(),this.setTransport(n),n.send([{type:"upgrade"}]),this.emitReserved("upgrade",n),n=null,this.upgrading=!1,this.flush())})}else{const p=new Error("probe error");p.transport=n.name,this.emitReserved("upgradeError",p)}}))};function o(){s||(s=!0,h(),n.close(),n=null)}const a=f=>{const p=new Error("probe error: "+f);p.transport=n.name,o(),this.emitReserved("upgradeError",p)};function l(){a("transport closed")}function c(){a("socket closed")}function d(f){n&&f.name!==n.name&&o()}const h=()=>{n.removeListener("open",i),n.removeListener("error",a),n.removeListener("close",l),this.off("close",c),this.off("upgrading",d)};n.once("open",i),n.once("error",a),n.once("close",l),this.once("close",c),this.once("upgrading",d),this._upgrades.indexOf("webtransport")!==-1&&t!=="webtransport"?this.setTimeoutFn(()=>{s||n.open()},200):n.open()}onHandshake(t){this._upgrades=this._filterUpgrades(t.upgrades),super.onHandshake(t)}_filterUpgrades(t){const n=[];for(let s=0;s<t.length;s++)~this.transports.indexOf(t[s])&&n.push(t[s]);return n}}let ipe=class extends rpe{constructor(t,n={}){const s=typeof t=="object"?t:n;(!s.transports||s.transports&&typeof s.transports[0]=="string")&&(s.transports=(s.transports||["polling","websocket","webtransport"]).map(i=>Jfe[i]).filter(i=>!!i)),super(t,s)}};function ope(e,t="",n){let s=e;n=n||typeof location<"u"&&location,e==null&&(e=n.protocol+"//"+n.host),typeof e=="string"&&(e.charAt(0)==="/"&&(e.charAt(1)==="/"?e=n.protocol+e:e=n.host+e),/^(https?|wss?):\/\//.test(e)||(typeof n<"u"?e=n.protocol+"//"+e:e="https://"+e),s=SC(e)),s.port||(/^(http|ws)$/.test(s.protocol)?s.port="80":/^(http|ws)s$/.test(s.protocol)&&(s.port="443")),s.path=s.path||"/";const o=s.host.indexOf(":")!==-1?"["+s.host+"]":s.host;return s.id=s.protocol+"://"+o+":"+s.port+t,s.href=s.protocol+"://"+o+(n&&n.port===s.port?"":":"+s.port),s}const ape=typeof ArrayBuffer=="function",lpe=e=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer,d9=Object.prototype.toString,cpe=typeof Blob=="function"||typeof Blob<"u"&&d9.call(Blob)==="[object BlobConstructor]",upe=typeof File=="function"||typeof File<"u"&&d9.call(File)==="[object FileConstructor]";function rk(e){return ape&&(e instanceof ArrayBuffer||lpe(e))||cpe&&e instanceof Blob||upe&&e instanceof File}function m0(e,t){if(!e||typeof e!="object")return!1;if(Array.isArray(e)){for(let n=0,s=e.length;n<s;n++)if(m0(e[n]))return!0;return!1}if(rk(e))return!0;if(e.toJSON&&typeof e.toJSON=="function"&&arguments.length===1)return m0(e.toJSON(),!0);for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&m0(e[n]))return!0;return!1}function dpe(e){const t=[],n=e.data,s=e;return s.data=kC(n,t),s.attachments=t.length,{packet:s,buffers:t}}function kC(e,t){if(!e)return e;if(rk(e)){const n={_placeholder:!0,num:t.length};return t.push(e),n}else if(Array.isArray(e)){const n=new Array(e.length);for(let s=0;s<e.length;s++)n[s]=kC(e[s],t);return n}else if(typeof e=="object"&&!(e instanceof Date)){const n={};for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&(n[s]=kC(e[s],t));return n}return e}function hpe(e,t){return e.data=_C(e.data,t),delete e.attachments,e}function _C(e,t){if(!e)return e;if(e&&e._placeholder===!0){if(typeof e.num=="number"&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}else if(Array.isArray(e))for(let n=0;n<e.length;n++)e[n]=_C(e[n],t);else if(typeof e=="object")for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(e[n]=_C(e[n],t));return e}const fpe=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],ppe=5;var It;(function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"})(It||(It={}));class gpe{constructor(t){this.replacer=t}encode(t){return(t.type===It.EVENT||t.type===It.ACK)&&m0(t)?this.encodeAsBinary({type:t.type===It.EVENT?It.BINARY_EVENT:It.BINARY_ACK,nsp:t.nsp,data:t.data,id:t.id}):[this.encodeAsString(t)]}encodeAsString(t){let n=""+t.type;return(t.type===It.BINARY_EVENT||t.type===It.BINARY_ACK)&&(n+=t.attachments+"-"),t.nsp&&t.nsp!=="/"&&(n+=t.nsp+","),t.id!=null&&(n+=t.id),t.data!=null&&(n+=JSON.stringify(t.data,this.replacer)),n}encodeAsBinary(t){const n=dpe(t),s=this.encodeAsString(n.packet),i=n.buffers;return i.unshift(s),i}}function u6(e){return Object.prototype.toString.call(e)==="[object Object]"}class ik extends On{constructor(t){super(),this.reviver=t}add(t){let n;if(typeof t=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");n=this.decodeString(t);const s=n.type===It.BINARY_EVENT;s||n.type===It.BINARY_ACK?(n.type=s?It.EVENT:It.ACK,this.reconstructor=new mpe(n),n.attachments===0&&super.emitReserved("decoded",n)):super.emitReserved("decoded",n)}else if(rk(t)||t.base64)if(this.reconstructor)n=this.reconstructor.takeBinaryData(t),n&&(this.reconstructor=null,super.emitReserved("decoded",n));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+t)}decodeString(t){let n=0;const s={type:Number(t.charAt(0))};if(It[s.type]===void 0)throw new Error("unknown packet type "+s.type);if(s.type===It.BINARY_EVENT||s.type===It.BINARY_ACK){const o=n+1;for(;t.charAt(++n)!=="-"&&n!=t.length;);const a=t.substring(o,n);if(a!=Number(a)||t.charAt(n)!=="-")throw new Error("Illegal attachments");s.attachments=Number(a)}if(t.charAt(n+1)==="/"){const o=n+1;for(;++n&&!(t.charAt(n)===","||n===t.length););s.nsp=t.substring(o,n)}else s.nsp="/";const i=t.charAt(n+1);if(i!==""&&Number(i)==i){const o=n+1;for(;++n;){const a=t.charAt(n);if(a==null||Number(a)!=a){--n;break}if(n===t.length)break}s.id=Number(t.substring(o,n+1))}if(t.charAt(++n)){const o=this.tryParse(t.substr(n));if(ik.isPayloadValid(s.type,o))s.data=o;else throw new Error("invalid payload")}return s}tryParse(t){try{return JSON.parse(t,this.reviver)}catch{return!1}}static isPayloadValid(t,n){switch(t){case It.CONNECT:return u6(n);case It.DISCONNECT:return n===void 0;case It.CONNECT_ERROR:return typeof n=="string"||u6(n);case It.EVENT:case It.BINARY_EVENT:return Array.isArray(n)&&(typeof n[0]=="number"||typeof n[0]=="string"&&fpe.indexOf(n[0])===-1);case It.ACK:case It.BINARY_ACK:return Array.isArray(n)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class mpe{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){const n=hpe(this.reconPack,this.buffers);return this.finishedReconstruction(),n}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const ype=Object.freeze(Object.defineProperty({__proto__:null,Decoder:ik,Encoder:gpe,get PacketType(){return It},protocol:ppe},Symbol.toStringTag,{value:"Module"}));function vi(e,t,n){return e.on(t,n),function(){e.off(t,n)}}const bpe=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class h9 extends On{constructor(t,n,s){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=n,s&&s.auth&&(this.auth=s.auth),this._opts=Object.assign({},s),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const t=this.io;this.subs=[vi(t,"open",this.onopen.bind(this)),vi(t,"packet",this.onpacket.bind(this)),vi(t,"error",this.onerror.bind(this)),vi(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...t){return t.unshift("message"),this.emit.apply(this,t),this}emit(t,...n){var s,i,o;if(bpe.hasOwnProperty(t))throw new Error('"'+t.toString()+'" is a reserved event name');if(n.unshift(t),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(n),this;const a={type:It.EVENT,data:n};if(a.options={},a.options.compress=this.flags.compress!==!1,typeof n[n.length-1]=="function"){const h=this.ids++,f=n.pop();this._registerAckCallback(h,f),a.id=h}const l=(i=(s=this.io.engine)===null||s===void 0?void 0:s.transport)===null||i===void 0?void 0:i.writable,c=this.connected&&!(!((o=this.io.engine)===null||o===void 0)&&o._hasPingExpired());return this.flags.volatile&&!l||(c?(this.notifyOutgoingListeners(a),this.packet(a)):this.sendBuffer.push(a)),this.flags={},this}_registerAckCallback(t,n){var s;const i=(s=this.flags.timeout)!==null&&s!==void 0?s:this._opts.ackTimeout;if(i===void 0){this.acks[t]=n;return}const o=this.io.setTimeoutFn(()=>{delete this.acks[t];for(let l=0;l<this.sendBuffer.length;l++)this.sendBuffer[l].id===t&&this.sendBuffer.splice(l,1);n.call(this,new Error("operation has timed out"))},i),a=(...l)=>{this.io.clearTimeoutFn(o),n.apply(this,l)};a.withError=!0,this.acks[t]=a}emitWithAck(t,...n){return new Promise((s,i)=>{const o=(a,l)=>a?i(a):s(l);o.withError=!0,n.push(o),this.emit(t,...n)})}_addToQueue(t){let n;typeof t[t.length-1]=="function"&&(n=t.pop());const s={id:this._queueSeq++,tryCount:0,pending:!1,args:t,flags:Object.assign({fromQueue:!0},this.flags)};t.push((i,...o)=>s!==this._queue[0]?void 0:(i!==null?s.tryCount>this._opts.retries&&(this._queue.shift(),n&&n(i)):(this._queue.shift(),n&&n(null,...o)),s.pending=!1,this._drainQueue())),this._queue.push(s),this._drainQueue()}_drainQueue(t=!1){if(!this.connected||this._queue.length===0)return;const n=this._queue[0];n.pending&&!t||(n.pending=!0,n.tryCount++,this.flags=n.flags,this.emit.apply(this,n.args))}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){typeof this.auth=="function"?this.auth(t=>{this._sendConnectPacket(t)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(t){this.packet({type:It.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},t):t})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t,n){this.connected=!1,delete this.id,this.emitReserved("disconnect",t,n),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(t=>{if(!this.sendBuffer.some(s=>String(s.id)===t)){const s=this.acks[t];delete this.acks[t],s.withError&&s.call(this,new Error("socket has been disconnected"))}})}onpacket(t){if(t.nsp===this.nsp)switch(t.type){case It.CONNECT:t.data&&t.data.sid?this.onconnect(t.data.sid,t.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case It.EVENT:case It.BINARY_EVENT:this.onevent(t);break;case It.ACK:case It.BINARY_ACK:this.onack(t);break;case It.DISCONNECT:this.ondisconnect();break;case It.CONNECT_ERROR:this.destroy();const s=new Error(t.data.message);s.data=t.data.data,this.emitReserved("connect_error",s);break}}onevent(t){const n=t.data||[];t.id!=null&&n.push(this.ack(t.id)),this.connected?this.emitEvent(n):this.receiveBuffer.push(Object.freeze(n))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){const n=this._anyListeners.slice();for(const s of n)s.apply(this,t)}super.emit.apply(this,t),this._pid&&t.length&&typeof t[t.length-1]=="string"&&(this._lastOffset=t[t.length-1])}ack(t){const n=this;let s=!1;return function(...i){s||(s=!0,n.packet({type:It.ACK,id:t,data:i}))}}onack(t){const n=this.acks[t.id];typeof n=="function"&&(delete this.acks[t.id],n.withError&&t.data.unshift(null),n.apply(this,t.data))}onconnect(t,n){this.id=t,this.recovered=n&&this._pid===n,this._pid=n,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(t=>this.emitEvent(t)),this.receiveBuffer=[],this.sendBuffer.forEach(t=>{this.notifyOutgoingListeners(t),this.packet(t)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(t=>t()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:It.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}timeout(t){return this.flags.timeout=t,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(!this._anyListeners)return this;if(t){const n=this._anyListeners;for(let s=0;s<n.length;s++)if(t===n[s])return n.splice(s,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(t),this}prependAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(t),this}offAnyOutgoing(t){if(!this._anyOutgoingListeners)return this;if(t){const n=this._anyOutgoingListeners;for(let s=0;s<n.length;s++)if(t===n[s])return n.splice(s,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const n=this._anyOutgoingListeners.slice();for(const s of n)s.apply(this,t.data)}}}function wd(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}wd.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=Math.floor(t*10)&1?e+n:e-n}return Math.min(e,this.max)|0};wd.prototype.reset=function(){this.attempts=0};wd.prototype.setMin=function(e){this.ms=e};wd.prototype.setMax=function(e){this.max=e};wd.prototype.setJitter=function(e){this.jitter=e};class IC extends On{constructor(t,n){var s;super(),this.nsps={},this.subs=[],t&&typeof t=="object"&&(n=t,t=void 0),n=n||{},n.path=n.path||"/socket.io",this.opts=n,wb(this,n),this.reconnection(n.reconnection!==!1),this.reconnectionAttempts(n.reconnectionAttempts||1/0),this.reconnectionDelay(n.reconnectionDelay||1e3),this.reconnectionDelayMax(n.reconnectionDelayMax||5e3),this.randomizationFactor((s=n.randomizationFactor)!==null&&s!==void 0?s:.5),this.backoff=new wd({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(n.timeout==null?2e4:n.timeout),this._readyState="closed",this.uri=t;const i=n.parser||ype;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=n.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,t||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(t){return t===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var n;return t===void 0?this._reconnectionDelay:(this._reconnectionDelay=t,(n=this.backoff)===null||n===void 0||n.setMin(t),this)}randomizationFactor(t){var n;return t===void 0?this._randomizationFactor:(this._randomizationFactor=t,(n=this.backoff)===null||n===void 0||n.setJitter(t),this)}reconnectionDelayMax(t){var n;return t===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,(n=this.backoff)===null||n===void 0||n.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new ipe(this.uri,this.opts);const n=this.engine,s=this;this._readyState="opening",this.skipReconnect=!1;const i=vi(n,"open",function(){s.onopen(),t&&t()}),o=l=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",l),t?t(l):this.maybeReconnectOnOpen()},a=vi(n,"error",o);if(this._timeout!==!1){const l=this._timeout,c=this.setTimeoutFn(()=>{i(),o(new Error("timeout")),n.close()},l);this.opts.autoUnref&&c.unref(),this.subs.push(()=>{this.clearTimeoutFn(c)})}return this.subs.push(i),this.subs.push(a),this}connect(t){return this.open(t)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const t=this.engine;this.subs.push(vi(t,"ping",this.onping.bind(this)),vi(t,"data",this.ondata.bind(this)),vi(t,"error",this.onerror.bind(this)),vi(t,"close",this.onclose.bind(this)),vi(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){try{this.decoder.add(t)}catch(n){this.onclose("parse error",n)}}ondecoded(t){Cb(()=>{this.emitReserved("packet",t)},this.setTimeoutFn)}onerror(t){this.emitReserved("error",t)}socket(t,n){let s=this.nsps[t];return s?this._autoConnect&&!s.active&&s.connect():(s=new h9(this,t,n),this.nsps[t]=s),s}_destroy(t){const n=Object.keys(this.nsps);for(const s of n)if(this.nsps[s].active)return;this._close()}_packet(t){const n=this.encoder.encode(t);for(let s=0;s<n.length;s++)this.engine.write(n[s],t.options)}cleanup(){this.subs.forEach(t=>t()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(t,n){var s;this.cleanup(),(s=this.engine)===null||s===void 0||s.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t,n),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const n=this.backoff.duration();this._reconnecting=!0;const s=this.setTimeoutFn(()=>{t.skipReconnect||(this.emitReserved("reconnect_attempt",t.backoff.attempts),!t.skipReconnect&&t.open(i=>{i?(t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",i)):t.onreconnect()}))},n);this.opts.autoUnref&&s.unref(),this.subs.push(()=>{this.clearTimeoutFn(s)})}}onreconnect(){const t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}}const Jd={};function y0(e,t){typeof e=="object"&&(t=e,e=void 0),t=t||{};const n=ope(e,t.path||"/socket.io"),s=n.source,i=n.id,o=n.path,a=Jd[i]&&o in Jd[i].nsps,l=t.forceNew||t["force new connection"]||t.multiplex===!1||a;let c;return l?c=new IC(s,t):(Jd[i]||(Jd[i]=new IC(s,t)),c=Jd[i]),n.query&&!t.query&&(t.query=n.queryKey),c.socket(n.path,t)}Object.assign(y0,{Manager:IC,Socket:h9,io:y0,connect:y0});const xpe=()=>{At("useSocketIO");const e=dn(),t=ae(SM),n=ae(rd),s=ae(J4),i=u.useMemo(()=>{const a=window.location.protocol==="https:"?"wss":"ws";return t?t.replace(/^https?:\/\//i,""):`${a}://${window.location.host}`},[t]),o=u.useMemo(()=>{const a={timeout:6e4,path:t?"/ws/socket.io":`${window.location.pathname}ws/socket.io`,autoConnect:!1,forceNew:!0};return n&&(a.auth={token:n},a.transports=["websocket","polling"]),{...a,...s}},[n,s,t]);u.useEffect(()=>{const a=y0(i,o);jM.set(a),kfe({socket:a,store:e,setIsConnected:Yn.set}),a.connect(),eI.get()&&(window.$socketOptions=J4,console.log("Socket initialized",a));const l=e.subscribe(()=>{const c=IX(e.getState()).data;(!c||c.queue.in_progress===0)&&Bo.set(null)});return()=>{eI.get()&&(window.$socketOptions=void 0,console.log("Socket teardown",a)),l(),a.disconnect()}},[o,i,e])},f9=u.memo(({config:e,studioInitAction:t})=>{const n=I(Y7),s=ile("system"),i=G();return Sle(),xpe(),TX(),Gle(),vy(),ole(),u.useEffect(()=>{ot.changeLanguage(n)},[n]),u.useEffect(()=>{tS(e)&&(s.info({config:e},"Received config"),i(AX(e)))},[i,e,s]),u.useEffect(()=>{i(EX())},[i]),MX(t),ofe(),rle(),lle(),PX(),Wle(),null});f9.displayName="GlobalHookIsolator";const vpe={isModalOpen:!1,updatingStylePresetId:null,prefilledFormData:null},Wa=Oe(vpe);function p9(e,t,n){var s=this,i=u.useRef(null),o=u.useRef(0),a=u.useRef(null),l=u.useRef([]),c=u.useRef(),d=u.useRef(),h=u.useRef(e),f=u.useRef(!0);h.current=e;var p=typeof window<"u",g=!t&&t!==0&&p;if(typeof e!="function")throw new TypeError("Expected a function");t=+t||0;var m=!!(n=n||{}).leading,y=!("trailing"in n)||!!n.trailing,b="maxWait"in n,C="debounceOnServer"in n&&!!n.debounceOnServer,x=b?Math.max(+n.maxWait||0,t):null;u.useEffect(function(){return f.current=!0,function(){f.current=!1}},[]);var v=u.useMemo(function(){var w=function(M){var R=l.current,F=c.current;return l.current=c.current=null,o.current=M,d.current=h.current.apply(F,R)},S=function(M,R){g&&cancelAnimationFrame(a.current),a.current=g?requestAnimationFrame(M):setTimeout(M,R)},j=function(M){if(!f.current)return!1;var R=M-i.current;return!i.current||R>=t||R<0||b&&M-o.current>=x},P=function(M){return a.current=null,y&&l.current?w(M):(l.current=c.current=null,d.current)},E=function M(){var R=Date.now();if(j(R))return P(R);if(f.current){var F=t-(R-i.current),_=b?Math.min(F,x-(R-o.current)):F;S(M,_)}},D=function(){if(p||C){var M=Date.now(),R=j(M);if(l.current=[].slice.call(arguments),c.current=s,i.current=M,R){if(!a.current&&f.current)return o.current=i.current,S(E,t),m?w(i.current):d.current;if(b)return S(E,t),w(i.current)}return a.current||S(E,t),d.current}};return D.cancel=function(){a.current&&(g?cancelAnimationFrame(a.current):clearTimeout(a.current)),o.current=0,l.current=i.current=c.current=a.current=null},D.isPending=function(){return!!a.current},D.flush=function(){return a.current?P(Date.now()):d.current},D},[m,b,t,x,y,g,p,C]);return v}function Cpe(e,t){return e===t}function wpe(e,t){return t}function vc(e,t,n){var s=Cpe,i=u.useReducer(wpe,e),o=i[0],a=i[1],l=p9(u.useCallback(function(d){return a(d)},[a]),t,n),c=u.useRef(e);return s(c.current,e)||(l(e),c.current=e),s(o,e)&&l.cancel(),[o,l]}const g9=e=>{const t=I(LX),[n]=vc(e,t),{data:s,isLoading:i}=DX(n??Xn);return{metadata:s,isLoading:i}},ok=e=>{const t=G(),{t:n}=A(),s=I(Ep),i=I(Fn),o=I(An),{metadata:a}=g9(e.image_name),[l,c]=u.useState(!1),[d,h]=u.useState(!1),[f,p]=u.useState(!1),g=ae(Mp);u.useEffect(()=>{(async()=>{if(a){c(!0);try{await pt.seed.parse(a),h(!0)}catch{h(!1)}(await Promise.allSettled([pt.positivePrompt.parse(a).catch(()=>{}),pt.negativePrompt.parse(a).catch(()=>{}),pt.sdxlPositiveStylePrompt.parse(a).catch(()=>{}),pt.sdxlNegativeStylePrompt.parse(a).catch(()=>{})])).some(R=>R.status==="fulfilled")?p(!0):p(!1)}else c(!1),h(!1),p(!1)})()},[a]);const m=u.useCallback(()=>{s&&(t(R0(null)),ge({status:"info",title:n("stylePresets.promptTemplateCleared")}))},[t,s,n]),y=u.useCallback(()=>{a&&(tI(a,o==="canvas",i?["width","height"]:[]),m())},[a,o,i,m]),b=u.useCallback(()=>{a&&(tI(a,o==="canvas",["seed"]),m())},[o,a,m]),C=u.useCallback(()=>{a&&pt.seed.parse(a).then(D=>{var M,R;(R=(M=pt.seed).recall)==null||R.call(M,D,!0)}).catch(()=>{})},[a]),x=u.useCallback(()=>{a&&(RX(a),m())},[a,m]),v=u.useCallback(async()=>{if(!a)return;let D,M;try{D=await pt.positivePrompt.parse(a)}catch{D=""}try{M=await pt.negativePrompt.parse(a)}catch{M=""}Wa.set({prefilledFormData:{name:"",positivePrompt:D,negativePrompt:M,imageUrl:e.image_url,type:"user"},updatingStylePresetId:null,isModalOpen:!0})},[a,e]),w=Xa(),S=u.useCallback(()=>{!e.has_workflow||!g||w({type:"image",data:e.image_name})},[g,e.has_workflow,e.image_name,w]),j=u.useCallback(()=>{i||OX(e)},[e,i]),P=u.useCallback(()=>{t(kM({imageDTO:e}))},[t,e]),E=u.useCallback(()=>{t(Pp([e]))},[t,e]);return{hasMetadata:l,hasSeed:d,hasPrompts:f,recallAll:y,remix:b,recallSeed:C,recallPrompts:x,createAsPreset:v,loadWorkflow:S,hasWorkflow:e.has_workflow,recallSize:j,upscale:P,delete:E}},m9=u.memo(()=>{At("GlobalImageHotkeys");const e=I(Lp);return e?r.jsx(y9,{imageDTO:e}):null});m9.displayName="GlobalImageHotkeys";const y9=u.memo(({imageDTO:e})=>{const t=Ms("gallery"),n=Ms("viewer"),s=ok(e),i=I(Fn),o=Bt("upscaling");return Re({id:"loadWorkflow",category:"viewer",callback:s.loadWorkflow,options:{enabled:t||n},dependencies:[s.loadWorkflow,t,n]}),Re({id:"recallAll",category:"viewer",callback:s.recallAll,options:{enabled:!i&&(t||n)},dependencies:[s.recallAll,i,t,n]}),Re({id:"recallSeed",category:"viewer",callback:s.recallSeed,options:{enabled:t||n},dependencies:[s.recallSeed,t,n]}),Re({id:"recallPrompts",category:"viewer",callback:s.recallPrompts,options:{enabled:t||n},dependencies:[s.recallPrompts,t,n]}),Re({id:"remix",category:"viewer",callback:s.remix,options:{enabled:t||n},dependencies:[s.remix,t,n]}),Re({id:"useSize",category:"viewer",callback:s.recallSize,options:{enabled:!i&&(t||n)},dependencies:[s.recallSize,i,t,n]}),Re({id:"runPostprocessing",category:"viewer",callback:s.upscale,options:{enabled:o&&n},dependencies:[o,e,n]}),null});y9.displayName="GlobalImageHotkeysInternal";const Spe=hn(_M,e=>e.imagesToChange),jpe=fe(_M,e=>e.isModalOpen),kpe=()=>{At("ChangeBoardModal");const e=G(),[t,n]=u.useState(),{data:s,isFetching:i}=ic({include_archived:!0}),o=I(jpe),a=I(Spe),[l]=NX(),[c]=FX(),{t:d}=A(),h=u.useMemo(()=>[{label:d("boards.uncategorized"),value:"none"}].concat((s??[]).map(y=>({label:y.board_name,value:y.board_id}))),[s,d]),f=u.useMemo(()=>h.find(y=>y.value===t),[h,t]),p=u.useCallback(()=>{e(nI()),e(lS(!1))},[e]),g=u.useCallback(()=>{!a.length||!t||(t==="none"?c({imageDTOs:a}):l({imageDTOs:a,board_id:t}),n(null),e(nI()))},[l,e,a,c,t]),m=u.useCallback(y=>{y&&n(y.value)},[]);return r.jsx(ai,{isOpen:o,onClose:p,title:d("boards.changeBoard"),acceptCallback:g,acceptButtonText:d("boards.move"),cancelButtonText:d("boards.cancel"),useInert:!1,children:r.jsxs(T,{flexDir:"column",gap:4,children:[r.jsxs(q,{children:[d("boards.movingImagesToBoard",{count:a.length}),":"]}),r.jsx(K,{isDisabled:i,children:r.jsx(Ne,{placeholder:d(i?"boards.loading":"boards.selectBoard"),onChange:m,value:f,options:h})})]})})},_pe=u.memo(kpe);fe(rS,cc,(e,t)=>{const{data:n}=e;let s=null;if(n){const o=Ya.selectAll(n).filter(iS).sort(l=>l.type==="controlnet"?-1:1);s=o.filter(l=>t?l.base===t:!0)[0]??o[0]??null}const i=(s==null?void 0:s.type)==="t2i_adapter"?gt(VX):gt(uc);return s&&(i.model=Ei.parse(s)),i});const Jo=fe(rS,cc,(e,t)=>{const{data:n}=e;let s=null;if(n){const o=Ya.selectAll(n).filter(sS);s=o.filter(l=>t?l.base===t:!0)[0]??o[0]??null}const i=gt(BX);return s&&(i.model=Ei.parse(s),s.base==="flux"&&(i.clipVisionModel="ViT-L")),i}),ak=()=>{const e=G();return u.useCallback(()=>{const n={controlAdapter:gt(uc)};e(Dp({isSelected:!0,overrides:n}))},[e])},lk=()=>{const e=G();return u.useCallback(()=>{e(id({isSelected:!0}))},[e])},ck=()=>{const e=G();return u.useCallback(()=>{e(Cy({isSelected:!0}))},[e])},uk=()=>{const e=G();return u.useCallback(()=>{e(Va({isSelected:!0}))},[e])},b9=()=>{const e=G(),t=I(Jo);return u.useCallback(()=>{const s={referenceImages:[{id:Te("regional_guidance_reference_image"),ipAdapter:gt(t)}]};e(Va({isSelected:!0,overrides:s}))},[t,e])},dk=()=>{const e=G(),t=I(Jo);return u.useCallback(()=>{const s={ipAdapter:gt(t)};e(wy({isSelected:!0,overrides:s}))},[t,e])},x9=e=>{const t=G(),n=I(Jo);return u.useCallback(()=>{t($X({entityIdentifier:e,overrides:{ipAdapter:gt(n)}}))},[n,t,e])},v9=e=>{const t=G();return u.useCallback(()=>{t(T2({entityIdentifier:e,prompt:""}))},[t,e])},C9=e=>{const t=G();return u.useCallback(()=>{t(A2({entityIdentifier:e,prompt:""}))},[t,e])},w9=e=>hn(tt,t=>{const n=Qa(t,e);return{canAddPositivePrompt:(n==null?void 0:n.positivePrompt)===null,canAddNegativePrompt:(n==null?void 0:n.negativePrompt)===null}});class zt{constructor(){k(this,"initialize");k(this,"getLoggingContext",()=>({...this.parent.getLoggingContext(),path:this.path.join(" > ")}));k(this,"destroy",()=>{this.log("Destroying module")});k(this,"repr",()=>({id:this.id,type:this.type,path:this.path}))}}var b0={exports:{}},eh={},nv={},sv={},d6;function St(){return d6||(d6=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e._registerNode=e.Konva=e.glob=void 0;const t=Math.PI/180;function n(){return typeof window<"u"&&({}.toString.call(window)==="[object Window]"||{}.toString.call(window)==="[object global]")}e.glob=typeof sI<"u"?sI:typeof window<"u"?window:typeof WorkerGlobalScope<"u"?self:{},e.Konva={_global:e.glob,version:"9.3.15",isBrowser:n(),isUnminified:/param/.test((function(i){}).toString()),dblClickWindow:400,getAngle(i){return e.Konva.angleDeg?i*t:i},enableTrace:!1,pointerEventsEnabled:!0,autoDrawEnabled:!0,hitOnDragEnabled:!1,capturePointerEventsEnabled:!1,_mouseListenClick:!1,_touchListenClick:!1,_pointerListenClick:!1,_mouseInDblClickWindow:!1,_touchInDblClickWindow:!1,_pointerInDblClickWindow:!1,_mouseDblClickPointerId:null,_touchDblClickPointerId:null,_pointerDblClickPointerId:null,_fixTextRendering:!1,pixelRatio:typeof window<"u"&&window.devicePixelRatio||1,dragDistance:3,angleDeg:!0,showWarnings:!0,dragButtons:[0,1],isDragging(){return e.Konva.DD.isDragging},isTransforming(){var i;return(i=e.Konva.Transformer)===null||i===void 0?void 0:i.isTransforming()},isDragReady(){return!!e.Konva.DD.node},releaseCanvasOnDestroy:!0,document:e.glob.document,_injectGlobal(i){e.glob.Konva=i}};const s=i=>{e.Konva[i.prototype.getClassName()]=i};e._registerNode=s,e.Konva._injectGlobal(e.Konva)}(sv)),sv}var rv={},h6;function En(){return h6||(h6=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Util=e.Transform=void 0;const t=St();class n{constructor(w=[1,0,0,1,0,0]){this.dirty=!1,this.m=w&&w.slice()||[1,0,0,1,0,0]}reset(){this.m[0]=1,this.m[1]=0,this.m[2]=0,this.m[3]=1,this.m[4]=0,this.m[5]=0}copy(){return new n(this.m)}copyInto(w){w.m[0]=this.m[0],w.m[1]=this.m[1],w.m[2]=this.m[2],w.m[3]=this.m[3],w.m[4]=this.m[4],w.m[5]=this.m[5]}point(w){var S=this.m;return{x:S[0]*w.x+S[2]*w.y+S[4],y:S[1]*w.x+S[3]*w.y+S[5]}}translate(w,S){return this.m[4]+=this.m[0]*w+this.m[2]*S,this.m[5]+=this.m[1]*w+this.m[3]*S,this}scale(w,S){return this.m[0]*=w,this.m[1]*=w,this.m[2]*=S,this.m[3]*=S,this}rotate(w){var S=Math.cos(w),j=Math.sin(w),P=this.m[0]*S+this.m[2]*j,E=this.m[1]*S+this.m[3]*j,D=this.m[0]*-j+this.m[2]*S,M=this.m[1]*-j+this.m[3]*S;return this.m[0]=P,this.m[1]=E,this.m[2]=D,this.m[3]=M,this}getTranslation(){return{x:this.m[4],y:this.m[5]}}skew(w,S){var j=this.m[0]+this.m[2]*S,P=this.m[1]+this.m[3]*S,E=this.m[2]+this.m[0]*w,D=this.m[3]+this.m[1]*w;return this.m[0]=j,this.m[1]=P,this.m[2]=E,this.m[3]=D,this}multiply(w){var S=this.m[0]*w.m[0]+this.m[2]*w.m[1],j=this.m[1]*w.m[0]+this.m[3]*w.m[1],P=this.m[0]*w.m[2]+this.m[2]*w.m[3],E=this.m[1]*w.m[2]+this.m[3]*w.m[3],D=this.m[0]*w.m[4]+this.m[2]*w.m[5]+this.m[4],M=this.m[1]*w.m[4]+this.m[3]*w.m[5]+this.m[5];return this.m[0]=S,this.m[1]=j,this.m[2]=P,this.m[3]=E,this.m[4]=D,this.m[5]=M,this}invert(){var w=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),S=this.m[3]*w,j=-this.m[1]*w,P=-this.m[2]*w,E=this.m[0]*w,D=w*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),M=w*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=S,this.m[1]=j,this.m[2]=P,this.m[3]=E,this.m[4]=D,this.m[5]=M,this}getMatrix(){return this.m}decompose(){var w=this.m[0],S=this.m[1],j=this.m[2],P=this.m[3],E=this.m[4],D=this.m[5],M=w*P-S*j;let R={x:E,y:D,rotation:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(w!=0||S!=0){var F=Math.sqrt(w*w+S*S);R.rotation=S>0?Math.acos(w/F):-Math.acos(w/F),R.scaleX=F,R.scaleY=M/F,R.skewX=(w*j+S*P)/M,R.skewY=0}else if(j!=0||P!=0){var _=Math.sqrt(j*j+P*P);R.rotation=Math.PI/2-(P>0?Math.acos(-j/_):-Math.acos(j/_)),R.scaleX=M/_,R.scaleY=_,R.skewX=0,R.skewY=(w*j+S*P)/M}return R.rotation=e.Util._getRotation(R.rotation),R}}e.Transform=n;var s="[object Array]",i="[object Number]",o="[object String]",a="[object Boolean]",l=Math.PI/180,c=180/Math.PI,d="#",h="",f="0",p="Konva warning: ",g="Konva error: ",m="rgb(",y={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],transparent:[255,255,255,0],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]},b=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/,C=[];const x=typeof requestAnimationFrame<"u"&&requestAnimationFrame||function(v){setTimeout(v,60)};e.Util={_isElement(v){return!!(v&&v.nodeType==1)},_isFunction(v){return!!(v&&v.constructor&&v.call&&v.apply)},_isPlainObject(v){return!!v&&v.constructor===Object},_isArray(v){return Object.prototype.toString.call(v)===s},_isNumber(v){return Object.prototype.toString.call(v)===i&&!isNaN(v)&&isFinite(v)},_isString(v){return Object.prototype.toString.call(v)===o},_isBoolean(v){return Object.prototype.toString.call(v)===a},isObject(v){return v instanceof Object},isValidSelector(v){if(typeof v!="string")return!1;var w=v[0];return w==="#"||w==="."||w===w.toUpperCase()},_sign(v){return v===0||v>0?1:-1},requestAnimFrame(v){C.push(v),C.length===1&&x(function(){const w=C;C=[],w.forEach(function(S){S()})})},createCanvasElement(){var v=document.createElement("canvas");try{v.style=v.style||{}}catch{}return v},createImageElement(){return document.createElement("img")},_isInDocument(v){for(;v=v.parentNode;)if(v==document)return!0;return!1},_urlToImage(v,w){var S=e.Util.createImageElement();S.onload=function(){w(S)},S.src=v},_rgbToHex(v,w,S){return((1<<24)+(v<<16)+(w<<8)+S).toString(16).slice(1)},_hexToRgb(v){v=v.replace(d,h);var w=parseInt(v,16);return{r:w>>16&255,g:w>>8&255,b:w&255}},getRandomColor(){for(var v=(Math.random()*16777215<<0).toString(16);v.length<6;)v=f+v;return d+v},getRGB(v){var w;return v in y?(w=y[v],{r:w[0],g:w[1],b:w[2]}):v[0]===d?this._hexToRgb(v.substring(1)):v.substr(0,4)===m?(w=b.exec(v.replace(/ /g,"")),{r:parseInt(w[1],10),g:parseInt(w[2],10),b:parseInt(w[3],10)}):{r:0,g:0,b:0}},colorToRGBA(v){return v=v||"black",e.Util._namedColorToRBA(v)||e.Util._hex3ColorToRGBA(v)||e.Util._hex4ColorToRGBA(v)||e.Util._hex6ColorToRGBA(v)||e.Util._hex8ColorToRGBA(v)||e.Util._rgbColorToRGBA(v)||e.Util._rgbaColorToRGBA(v)||e.Util._hslColorToRGBA(v)},_namedColorToRBA(v){var w=y[v.toLowerCase()];return w?{r:w[0],g:w[1],b:w[2],a:1}:null},_rgbColorToRGBA(v){if(v.indexOf("rgb(")===0){v=v.match(/rgb\(([^)]+)\)/)[1];var w=v.split(/ *, */).map(Number);return{r:w[0],g:w[1],b:w[2],a:1}}},_rgbaColorToRGBA(v){if(v.indexOf("rgba(")===0){v=v.match(/rgba\(([^)]+)\)/)[1];var w=v.split(/ *, */).map((S,j)=>S.slice(-1)==="%"?j===3?parseInt(S)/100:parseInt(S)/100*255:Number(S));return{r:w[0],g:w[1],b:w[2],a:w[3]}}},_hex8ColorToRGBA(v){if(v[0]==="#"&&v.length===9)return{r:parseInt(v.slice(1,3),16),g:parseInt(v.slice(3,5),16),b:parseInt(v.slice(5,7),16),a:parseInt(v.slice(7,9),16)/255}},_hex6ColorToRGBA(v){if(v[0]==="#"&&v.length===7)return{r:parseInt(v.slice(1,3),16),g:parseInt(v.slice(3,5),16),b:parseInt(v.slice(5,7),16),a:1}},_hex4ColorToRGBA(v){if(v[0]==="#"&&v.length===5)return{r:parseInt(v[1]+v[1],16),g:parseInt(v[2]+v[2],16),b:parseInt(v[3]+v[3],16),a:parseInt(v[4]+v[4],16)/255}},_hex3ColorToRGBA(v){if(v[0]==="#"&&v.length===4)return{r:parseInt(v[1]+v[1],16),g:parseInt(v[2]+v[2],16),b:parseInt(v[3]+v[3],16),a:1}},_hslColorToRGBA(v){if(/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.test(v)){const[w,...S]=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(v),j=Number(S[0])/360,P=Number(S[1])/100,E=Number(S[2])/100;let D,M,R;if(P===0)return R=E*255,{r:Math.round(R),g:Math.round(R),b:Math.round(R),a:1};E<.5?D=E*(1+P):D=E+P-E*P;const F=2*E-D,_=[0,0,0];for(let L=0;L<3;L++)M=j+1/3*-(L-1),M<0&&M++,M>1&&M--,6*M<1?R=F+(D-F)*6*M:2*M<1?R=D:3*M<2?R=F+(D-F)*(2/3-M)*6:R=F,_[L]=R*255;return{r:Math.round(_[0]),g:Math.round(_[1]),b:Math.round(_[2]),a:1}}},haveIntersection(v,w){return!(w.x>v.x+v.width||w.x+w.width<v.x||w.y>v.y+v.height||w.y+w.height<v.y)},cloneObject(v){var w={};for(var S in v)this._isPlainObject(v[S])?w[S]=this.cloneObject(v[S]):this._isArray(v[S])?w[S]=this.cloneArray(v[S]):w[S]=v[S];return w},cloneArray(v){return v.slice(0)},degToRad(v){return v*l},radToDeg(v){return v*c},_degToRad(v){return e.Util.warn("Util._degToRad is removed. Please use public Util.degToRad instead."),e.Util.degToRad(v)},_radToDeg(v){return e.Util.warn("Util._radToDeg is removed. Please use public Util.radToDeg instead."),e.Util.radToDeg(v)},_getRotation(v){return t.Konva.angleDeg?e.Util.radToDeg(v):v},_capitalize(v){return v.charAt(0).toUpperCase()+v.slice(1)},throw(v){throw new Error(g+v)},error(v){console.error(g+v)},warn(v){t.Konva.showWarnings&&console.warn(p+v)},each(v,w){for(var S in v)w(S,v[S])},_inRange(v,w,S){return w<=v&&v<S},_getProjectionToSegment(v,w,S,j,P,E){var D,M,R,F=(v-S)*(v-S)+(w-j)*(w-j);if(F==0)D=v,M=w,R=(P-S)*(P-S)+(E-j)*(E-j);else{var _=((P-v)*(S-v)+(E-w)*(j-w))/F;_<0?(D=v,M=w,R=(v-P)*(v-P)+(w-E)*(w-E)):_>1?(D=S,M=j,R=(S-P)*(S-P)+(j-E)*(j-E)):(D=v+_*(S-v),M=w+_*(j-w),R=(D-P)*(D-P)+(M-E)*(M-E))}return[D,M,R]},_getProjectionToLine(v,w,S){var j=e.Util.cloneObject(v),P=Number.MAX_VALUE;return w.forEach(function(E,D){if(!(!S&&D===w.length-1)){var M=w[(D+1)%w.length],R=e.Util._getProjectionToSegment(E.x,E.y,M.x,M.y,v.x,v.y),F=R[0],_=R[1],L=R[2];L<P&&(j.x=F,j.y=_,P=L)}}),j},_prepareArrayForTween(v,w,S){var j,P=[],E=[];if(v.length>w.length){var D=w;w=v,v=D}for(j=0;j<v.length;j+=2)P.push({x:v[j],y:v[j+1]});for(j=0;j<w.length;j+=2)E.push({x:w[j],y:w[j+1]});var M=[];return E.forEach(function(R){var F=e.Util._getProjectionToLine(R,P,S);M.push(F.x),M.push(F.y)}),M},_prepareToStringify(v){var w;v.visitedByCircularReferenceRemoval=!0;for(var S in v)if(v.hasOwnProperty(S)&&v[S]&&typeof v[S]=="object"){if(w=Object.getOwnPropertyDescriptor(v,S),v[S].visitedByCircularReferenceRemoval||e.Util._isElement(v[S]))if(w.configurable)delete v[S];else return null;else if(e.Util._prepareToStringify(v[S])===null)if(w.configurable)delete v[S];else return null}return delete v.visitedByCircularReferenceRemoval,v},_assign(v,w){for(var S in w)v[S]=w[S];return v},_getFirstPointerId(v){return v.touches?v.changedTouches[0].identifier:v.pointerId||999},releaseCanvas(...v){t.Konva.releaseCanvasOnDestroy&&v.forEach(w=>{w.width=0,w.height=0})},drawRoundedRectPath(v,w,S,j){let P=0,E=0,D=0,M=0;typeof j=="number"?P=E=D=M=Math.min(j,w/2,S/2):(P=Math.min(j[0]||0,w/2,S/2),E=Math.min(j[1]||0,w/2,S/2),M=Math.min(j[2]||0,w/2,S/2),D=Math.min(j[3]||0,w/2,S/2)),v.moveTo(P,0),v.lineTo(w-E,0),v.arc(w-E,E,E,Math.PI*3/2,0,!1),v.lineTo(w,S-M),v.arc(w-M,S-M,M,0,Math.PI/2,!1),v.lineTo(D,S),v.arc(D,S-D,D,Math.PI/2,Math.PI,!1),v.lineTo(0,P),v.arc(P,P,P,Math.PI,Math.PI*3/2,!1)}}}(rv)),rv}var th={},iv={},on={},f6;function _t(){if(f6)return on;f6=1,Object.defineProperty(on,"__esModule",{value:!0}),on.getComponentValidator=on.getBooleanValidator=on.getNumberArrayValidator=on.getFunctionValidator=on.getStringOrGradientValidator=on.getStringValidator=on.getNumberOrAutoValidator=on.getNumberOrArrayOfNumbersValidator=on.getNumberValidator=on.alphaComponent=on.RGBComponent=void 0;const e=St(),t=En();function n(m){return t.Util._isString(m)?'"'+m+'"':Object.prototype.toString.call(m)==="[object Number]"||t.Util._isBoolean(m)?m:Object.prototype.toString.call(m)}function s(m){return m>255?255:m<0?0:Math.round(m)}on.RGBComponent=s;function i(m){return m>1?1:m<1e-4?1e-4:m}on.alphaComponent=i;function o(){if(e.Konva.isUnminified)return function(m,y){return t.Util._isNumber(m)||t.Util.warn(n(m)+' is a not valid value for "'+y+'" attribute. The value should be a number.'),m}}on.getNumberValidator=o;function a(m){if(e.Konva.isUnminified)return function(y,b){let C=t.Util._isNumber(y),x=t.Util._isArray(y)&&y.length==m;return!C&&!x&&t.Util.warn(n(y)+' is a not valid value for "'+b+'" attribute. The value should be a number or Array<number>('+m+")"),y}}on.getNumberOrArrayOfNumbersValidator=a;function l(){if(e.Konva.isUnminified)return function(m,y){var b=t.Util._isNumber(m),C=m==="auto";return b||C||t.Util.warn(n(m)+' is a not valid value for "'+y+'" attribute. The value should be a number or "auto".'),m}}on.getNumberOrAutoValidator=l;function c(){if(e.Konva.isUnminified)return function(m,y){return t.Util._isString(m)||t.Util.warn(n(m)+' is a not valid value for "'+y+'" attribute. The value should be a string.'),m}}on.getStringValidator=c;function d(){if(e.Konva.isUnminified)return function(m,y){const b=t.Util._isString(m),C=Object.prototype.toString.call(m)==="[object CanvasGradient]"||m&&m.addColorStop;return b||C||t.Util.warn(n(m)+' is a not valid value for "'+y+'" attribute. The value should be a string or a native gradient.'),m}}on.getStringOrGradientValidator=d;function h(){if(e.Konva.isUnminified)return function(m,y){return t.Util._isFunction(m)||t.Util.warn(n(m)+' is a not valid value for "'+y+'" attribute. The value should be a function.'),m}}on.getFunctionValidator=h;function f(){if(e.Konva.isUnminified)return function(m,y){const b=Int8Array?Object.getPrototypeOf(Int8Array):null;return b&&m instanceof b||(t.Util._isArray(m)?m.forEach(function(C){t.Util._isNumber(C)||t.Util.warn('"'+y+'" attribute has non numeric element '+C+". Make sure that all elements are numbers.")}):t.Util.warn(n(m)+' is a not valid value for "'+y+'" attribute. The value should be a array of numbers.')),m}}on.getNumberArrayValidator=f;function p(){if(e.Konva.isUnminified)return function(m,y){var b=m===!0||m===!1;return b||t.Util.warn(n(m)+' is a not valid value for "'+y+'" attribute. The value should be a boolean.'),m}}on.getBooleanValidator=p;function g(m){if(e.Konva.isUnminified)return function(y,b){return y==null||t.Util.isObject(y)||t.Util.warn(n(y)+' is a not valid value for "'+b+'" attribute. The value should be an object with properties '+m),y}}return on.getComponentValidator=g,on}var p6;function jt(){return p6||(p6=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Factory=void 0;const t=En(),n=_t();var s="get",i="set";e.Factory={addGetterSetter(o,a,l,c,d){e.Factory.addGetter(o,a,l),e.Factory.addSetter(o,a,c,d),e.Factory.addOverloadedGetterSetter(o,a)},addGetter(o,a,l){var c=s+t.Util._capitalize(a);o.prototype[c]=o.prototype[c]||function(){var d=this.attrs[a];return d===void 0?l:d}},addSetter(o,a,l,c){var d=i+t.Util._capitalize(a);o.prototype[d]||e.Factory.overWriteSetter(o,a,l,c)},overWriteSetter(o,a,l,c){var d=i+t.Util._capitalize(a);o.prototype[d]=function(h){return l&&h!==void 0&&h!==null&&(h=l.call(this,h,a)),this._setAttr(a,h),c&&c.call(this),this}},addComponentsGetterSetter(o,a,l,c,d){var h=l.length,f=t.Util._capitalize,p=s+f(a),g=i+f(a),m,y;o.prototype[p]=function(){var C={};for(m=0;m<h;m++)y=l[m],C[y]=this.getAttr(a+f(y));return C};var b=(0,n.getComponentValidator)(l);o.prototype[g]=function(C){var x=this.attrs[a],v;c&&(C=c.call(this,C)),b&&b.call(this,C,a);for(v in C)C.hasOwnProperty(v)&&this._setAttr(a+f(v),C[v]);return C||l.forEach(w=>{this._setAttr(a+f(w),void 0)}),this._fireChangeEvent(a,x,C),d&&d.call(this),this},e.Factory.addOverloadedGetterSetter(o,a)},addOverloadedGetterSetter(o,a){var l=t.Util._capitalize(a),c=i+l,d=s+l;o.prototype[a]=function(){return arguments.length?(this[c](arguments[0]),this):this[d]()}},addDeprecatedGetterSetter(o,a,l,c){t.Util.error("Adding deprecated "+a);var d=s+t.Util._capitalize(a),h=a+" property is deprecated and will be removed soon. Look at Konva change log for more information.";o.prototype[d]=function(){t.Util.error(h);var f=this.attrs[a];return f===void 0?l:f},e.Factory.addSetter(o,a,c,function(){t.Util.error(h)}),e.Factory.addOverloadedGetterSetter(o,a)},backCompat(o,a){t.Util.each(a,function(l,c){var d=o.prototype[c],h=s+t.Util._capitalize(l),f=i+t.Util._capitalize(l);function p(){d.apply(this,arguments),t.Util.error('"'+l+'" method is deprecated and will be removed soon. Use ""'+c+'" instead.')}o.prototype[l]=p,o.prototype[h]=p,o.prototype[f]=p})},afterSetFilter(){this._filterUpToDate=!1}}}(iv)),iv}var To={},Ao={},g6;function S9(){if(g6)return Ao;g6=1,Object.defineProperty(Ao,"__esModule",{value:!0}),Ao.HitContext=Ao.SceneContext=Ao.Context=void 0;const e=En(),t=St();function n(C){var x=[],v=C.length,w=e.Util,S,j;for(S=0;S<v;S++)j=C[S],w._isNumber(j)?j=Math.round(j*1e3)/1e3:w._isString(j)||(j=j+""),x.push(j);return x}var s=",",i="(",o=")",a="([",l="])",c=";",d="()",h="=",f=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","ellipse","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","roundRect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"],p=["fillStyle","strokeStyle","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","letterSpacing","lineCap","lineDashOffset","lineJoin","lineWidth","miterLimit","direction","font","textAlign","textBaseline","globalAlpha","globalCompositeOperation","imageSmoothingEnabled"];const g=100;let m=class{constructor(x){this.canvas=x,t.Konva.enableTrace&&(this.traceArr=[],this._enableTrace())}fillShape(x){x.fillEnabled()&&this._fill(x)}_fill(x){}strokeShape(x){x.hasStroke()&&this._stroke(x)}_stroke(x){}fillStrokeShape(x){x.attrs.fillAfterStrokeEnabled?(this.strokeShape(x),this.fillShape(x)):(this.fillShape(x),this.strokeShape(x))}getTrace(x,v){var w=this.traceArr,S=w.length,j="",P,E,D,M;for(P=0;P<S;P++)E=w[P],D=E.method,D?(M=E.args,j+=D,x?j+=d:e.Util._isArray(M[0])?j+=a+M.join(s)+l:(v&&(M=M.map(R=>typeof R=="number"?Math.floor(R):R)),j+=i+M.join(s)+o)):(j+=E.property,x||(j+=h+E.val)),j+=c;return j}clearTrace(){this.traceArr=[]}_trace(x){var v=this.traceArr,w;v.push(x),w=v.length,w>=g&&v.shift()}reset(){var x=this.getCanvas().getPixelRatio();this.setTransform(1*x,0,0,1*x,0,0)}getCanvas(){return this.canvas}clear(x){var v=this.getCanvas();x?this.clearRect(x.x||0,x.y||0,x.width||0,x.height||0):this.clearRect(0,0,v.getWidth()/v.pixelRatio,v.getHeight()/v.pixelRatio)}_applyLineCap(x){const v=x.attrs.lineCap;v&&this.setAttr("lineCap",v)}_applyOpacity(x){var v=x.getAbsoluteOpacity();v!==1&&this.setAttr("globalAlpha",v)}_applyLineJoin(x){const v=x.attrs.lineJoin;v&&this.setAttr("lineJoin",v)}setAttr(x,v){this._context[x]=v}arc(x,v,w,S,j,P){this._context.arc(x,v,w,S,j,P)}arcTo(x,v,w,S,j){this._context.arcTo(x,v,w,S,j)}beginPath(){this._context.beginPath()}bezierCurveTo(x,v,w,S,j,P){this._context.bezierCurveTo(x,v,w,S,j,P)}clearRect(x,v,w,S){this._context.clearRect(x,v,w,S)}clip(...x){this._context.clip.apply(this._context,x)}closePath(){this._context.closePath()}createImageData(x,v){var w=arguments;if(w.length===2)return this._context.createImageData(x,v);if(w.length===1)return this._context.createImageData(x)}createLinearGradient(x,v,w,S){return this._context.createLinearGradient(x,v,w,S)}createPattern(x,v){return this._context.createPattern(x,v)}createRadialGradient(x,v,w,S,j,P){return this._context.createRadialGradient(x,v,w,S,j,P)}drawImage(x,v,w,S,j,P,E,D,M){var R=arguments,F=this._context;R.length===3?F.drawImage(x,v,w):R.length===5?F.drawImage(x,v,w,S,j):R.length===9&&F.drawImage(x,v,w,S,j,P,E,D,M)}ellipse(x,v,w,S,j,P,E,D){this._context.ellipse(x,v,w,S,j,P,E,D)}isPointInPath(x,v,w,S){return w?this._context.isPointInPath(w,x,v,S):this._context.isPointInPath(x,v,S)}fill(...x){this._context.fill.apply(this._context,x)}fillRect(x,v,w,S){this._context.fillRect(x,v,w,S)}strokeRect(x,v,w,S){this._context.strokeRect(x,v,w,S)}fillText(x,v,w,S){S?this._context.fillText(x,v,w,S):this._context.fillText(x,v,w)}measureText(x){return this._context.measureText(x)}getImageData(x,v,w,S){return this._context.getImageData(x,v,w,S)}lineTo(x,v){this._context.lineTo(x,v)}moveTo(x,v){this._context.moveTo(x,v)}rect(x,v,w,S){this._context.rect(x,v,w,S)}roundRect(x,v,w,S,j){this._context.roundRect(x,v,w,S,j)}putImageData(x,v,w){this._context.putImageData(x,v,w)}quadraticCurveTo(x,v,w,S){this._context.quadraticCurveTo(x,v,w,S)}restore(){this._context.restore()}rotate(x){this._context.rotate(x)}save(){this._context.save()}scale(x,v){this._context.scale(x,v)}setLineDash(x){this._context.setLineDash?this._context.setLineDash(x):"mozDash"in this._context?this._context.mozDash=x:"webkitLineDash"in this._context&&(this._context.webkitLineDash=x)}getLineDash(){return this._context.getLineDash()}setTransform(x,v,w,S,j,P){this._context.setTransform(x,v,w,S,j,P)}stroke(x){x?this._context.stroke(x):this._context.stroke()}strokeText(x,v,w,S){this._context.strokeText(x,v,w,S)}transform(x,v,w,S,j,P){this._context.transform(x,v,w,S,j,P)}translate(x,v){this._context.translate(x,v)}_enableTrace(){var x=this,v=f.length,w=this.setAttr,S,j,P=function(E){var D=x[E],M;x[E]=function(){return j=n(Array.prototype.slice.call(arguments,0)),M=D.apply(x,arguments),x._trace({method:E,args:j}),M}};for(S=0;S<v;S++)P(f[S]);x.setAttr=function(){w.apply(x,arguments);var E=arguments[0],D=arguments[1];(E==="shadowOffsetX"||E==="shadowOffsetY"||E==="shadowBlur")&&(D=D/this.canvas.getPixelRatio()),x._trace({property:E,val:D})}}_applyGlobalCompositeOperation(x){const v=x.attrs.globalCompositeOperation;var w=!v||v==="source-over";w||this.setAttr("globalCompositeOperation",v)}};Ao.Context=m,p.forEach(function(C){Object.defineProperty(m.prototype,C,{get(){return this._context[C]},set(x){this._context[C]=x}})});class y extends m{constructor(x,{willReadFrequently:v=!1}={}){super(x),this._context=x._canvas.getContext("2d",{willReadFrequently:v})}_fillColor(x){var v=x.fill();this.setAttr("fillStyle",v),x._fillFunc(this)}_fillPattern(x){this.setAttr("fillStyle",x._getFillPattern()),x._fillFunc(this)}_fillLinearGradient(x){var v=x._getLinearGradient();v&&(this.setAttr("fillStyle",v),x._fillFunc(this))}_fillRadialGradient(x){const v=x._getRadialGradient();v&&(this.setAttr("fillStyle",v),x._fillFunc(this))}_fill(x){const v=x.fill(),w=x.getFillPriority();if(v&&w==="color"){this._fillColor(x);return}const S=x.getFillPatternImage();if(S&&w==="pattern"){this._fillPattern(x);return}const j=x.getFillLinearGradientColorStops();if(j&&w==="linear-gradient"){this._fillLinearGradient(x);return}const P=x.getFillRadialGradientColorStops();if(P&&w==="radial-gradient"){this._fillRadialGradient(x);return}v?this._fillColor(x):S?this._fillPattern(x):j?this._fillLinearGradient(x):P&&this._fillRadialGradient(x)}_strokeLinearGradient(x){const v=x.getStrokeLinearGradientStartPoint(),w=x.getStrokeLinearGradientEndPoint(),S=x.getStrokeLinearGradientColorStops(),j=this.createLinearGradient(v.x,v.y,w.x,w.y);if(S){for(var P=0;P<S.length;P+=2)j.addColorStop(S[P],S[P+1]);this.setAttr("strokeStyle",j)}}_stroke(x){var v=x.dash(),w=x.getStrokeScaleEnabled();if(x.hasStroke()){if(!w){this.save();var S=this.getCanvas().getPixelRatio();this.setTransform(S,0,0,S,0,0)}this._applyLineCap(x),v&&x.dashEnabled()&&(this.setLineDash(v),this.setAttr("lineDashOffset",x.dashOffset())),this.setAttr("lineWidth",x.strokeWidth()),x.getShadowForStrokeEnabled()||this.setAttr("shadowColor","rgba(0,0,0,0)");var j=x.getStrokeLinearGradientColorStops();j?this._strokeLinearGradient(x):this.setAttr("strokeStyle",x.stroke()),x._strokeFunc(this),w||this.restore()}}_applyShadow(x){var v,w,S,j=(v=x.getShadowRGBA())!==null&&v!==void 0?v:"black",P=(w=x.getShadowBlur())!==null&&w!==void 0?w:5,E=(S=x.getShadowOffset())!==null&&S!==void 0?S:{x:0,y:0},D=x.getAbsoluteScale(),M=this.canvas.getPixelRatio(),R=D.x*M,F=D.y*M;this.setAttr("shadowColor",j),this.setAttr("shadowBlur",P*Math.min(Math.abs(R),Math.abs(F))),this.setAttr("shadowOffsetX",E.x*R),this.setAttr("shadowOffsetY",E.y*F)}}Ao.SceneContext=y;class b extends m{constructor(x){super(x),this._context=x._canvas.getContext("2d",{willReadFrequently:!0})}_fill(x){this.save(),this.setAttr("fillStyle",x.colorKey),x._fillFuncHit(this),this.restore()}strokeShape(x){x.hasHitStroke()&&this._stroke(x)}_stroke(x){if(x.hasHitStroke()){const j=x.getStrokeScaleEnabled();if(!j){this.save();var v=this.getCanvas().getPixelRatio();this.setTransform(v,0,0,v,0,0)}this._applyLineCap(x);var w=x.hitStrokeWidth(),S=w==="auto"?x.strokeWidth():w;this.setAttr("lineWidth",S),this.setAttr("strokeStyle",x.colorKey),x._strokeFuncHit(this),j||this.restore()}}}return Ao.HitContext=b,Ao}var m6;function Sb(){if(m6)return To;m6=1,Object.defineProperty(To,"__esModule",{value:!0}),To.HitCanvas=To.SceneCanvas=To.Canvas=void 0;const e=En(),t=S9(),n=St(),s=jt(),i=_t();var o;function a(){if(o)return o;var h=e.Util.createCanvasElement(),f=h.getContext("2d");return o=function(){var p=n.Konva._global.devicePixelRatio||1,g=f.webkitBackingStorePixelRatio||f.mozBackingStorePixelRatio||f.msBackingStorePixelRatio||f.oBackingStorePixelRatio||f.backingStorePixelRatio||1;return p/g}(),e.Util.releaseCanvas(h),o}let l=class{constructor(f){this.pixelRatio=1,this.width=0,this.height=0,this.isCache=!1;var p=f||{},g=p.pixelRatio||n.Konva.pixelRatio||a();this.pixelRatio=g,this._canvas=e.Util.createCanvasElement(),this._canvas.style.padding="0",this._canvas.style.margin="0",this._canvas.style.border="0",this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0"}getContext(){return this.context}getPixelRatio(){return this.pixelRatio}setPixelRatio(f){var p=this.pixelRatio;this.pixelRatio=f,this.setSize(this.getWidth()/p,this.getHeight()/p)}setWidth(f){this.width=this._canvas.width=f*this.pixelRatio,this._canvas.style.width=f+"px";var p=this.pixelRatio,g=this.getContext()._context;g.scale(p,p)}setHeight(f){this.height=this._canvas.height=f*this.pixelRatio,this._canvas.style.height=f+"px";var p=this.pixelRatio,g=this.getContext()._context;g.scale(p,p)}getWidth(){return this.width}getHeight(){return this.height}setSize(f,p){this.setWidth(f||0),this.setHeight(p||0)}toDataURL(f,p){try{return this._canvas.toDataURL(f,p)}catch{try{return this._canvas.toDataURL()}catch(m){return e.Util.error("Unable to get data URL. "+m.message+" For more info read https://konvajs.org/docs/posts/Tainted_Canvas.html."),""}}}};To.Canvas=l,s.Factory.addGetterSetter(l,"pixelRatio",void 0,(0,i.getNumberValidator)());class c extends l{constructor(f={width:0,height:0,willReadFrequently:!1}){super(f),this.context=new t.SceneContext(this,{willReadFrequently:f.willReadFrequently}),this.setSize(f.width,f.height)}}To.SceneCanvas=c;class d extends l{constructor(f={width:0,height:0}){super(f),this.hitCanvas=!0,this.context=new t.HitContext(this),this.setSize(f.width,f.height)}}return To.HitCanvas=d,To}var ov={},y6;function hk(){return y6||(y6=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.DD=void 0;const t=St(),n=En();e.DD={get isDragging(){var s=!1;return e.DD._dragElements.forEach(i=>{i.dragStatus==="dragging"&&(s=!0)}),s},justDragged:!1,get node(){var s;return e.DD._dragElements.forEach(i=>{s=i.node}),s},_dragElements:new Map,_drag(s){const i=[];e.DD._dragElements.forEach((o,a)=>{const{node:l}=o,c=l.getStage();c.setPointersPositions(s),o.pointerId===void 0&&(o.pointerId=n.Util._getFirstPointerId(s));const d=c._changedPointerPositions.find(p=>p.id===o.pointerId);if(d){if(o.dragStatus!=="dragging"){var h=l.dragDistance(),f=Math.max(Math.abs(d.x-o.startPointerPos.x),Math.abs(d.y-o.startPointerPos.y));if(f<h||(l.startDrag({evt:s}),!l.isDragging()))return}l._setDragPosition(s,o),i.push(l)}}),i.forEach(o=>{o.fire("dragmove",{type:"dragmove",target:o,evt:s},!0)})},_endDragBefore(s){const i=[];e.DD._dragElements.forEach(o=>{const{node:a}=o,l=a.getStage();if(s&&l.setPointersPositions(s),!l._changedPointerPositions.find(h=>h.id===o.pointerId))return;(o.dragStatus==="dragging"||o.dragStatus==="stopped")&&(e.DD.justDragged=!0,t.Konva._mouseListenClick=!1,t.Konva._touchListenClick=!1,t.Konva._pointerListenClick=!1,o.dragStatus="stopped");const d=o.node.getLayer()||o.node instanceof t.Konva.Stage&&o.node;d&&i.indexOf(d)===-1&&i.push(d)}),i.forEach(o=>{o.draw()})},_endDragAfter(s){e.DD._dragElements.forEach((i,o)=>{i.dragStatus==="stopped"&&i.node.fire("dragend",{type:"dragend",target:i.node,evt:s},!0),i.dragStatus!=="dragging"&&e.DD._dragElements.delete(o)})}},t.Konva.isBrowser&&(window.addEventListener("mouseup",e.DD._endDragBefore,!0),window.addEventListener("touchend",e.DD._endDragBefore,!0),window.addEventListener("mousemove",e.DD._drag),window.addEventListener("touchmove",e.DD._drag),window.addEventListener("mouseup",e.DD._endDragAfter,!1),window.addEventListener("touchend",e.DD._endDragAfter,!1))}(ov)),ov}var b6;function Ln(){if(b6)return th;b6=1,Object.defineProperty(th,"__esModule",{value:!0}),th.Node=void 0;const e=En(),t=jt(),n=Sb(),s=St(),i=hk(),o=_t();var a="absoluteOpacity",l="allEventListeners",c="absoluteTransform",d="absoluteScale",h="canvas",f="Change",p="children",g="konva",m="listening",y="mouseenter",b="mouseleave",C="set",x="Shape",v=" ",w="stage",S="transform",j="Stage",P="visible",E=["xChange.konva","yChange.konva","scaleXChange.konva","scaleYChange.konva","skewXChange.konva","skewYChange.konva","rotationChange.konva","offsetXChange.konva","offsetYChange.konva","transformsEnabledChange.konva"].join(v);let D=1;class M{constructor(_){this._id=D++,this.eventListeners={},this.attrs={},this.index=0,this._allEventListeners=null,this.parent=null,this._cache=new Map,this._attachedDepsListeners=new Map,this._lastPos=null,this._batchingTransformChange=!1,this._needClearTransformCache=!1,this._filterUpToDate=!1,this._isUnderCache=!1,this._dragEventId=null,this._shouldFireChangeEvents=!1,this.setAttrs(_),this._shouldFireChangeEvents=!0}hasChildren(){return!1}_clearCache(_){(_===S||_===c)&&this._cache.get(_)?this._cache.get(_).dirty=!0:_?this._cache.delete(_):this._cache.clear()}_getCache(_,L){var O=this._cache.get(_),B=_===S||_===c,z=O===void 0||B&&O.dirty===!0;return z&&(O=L.call(this),this._cache.set(_,O)),O}_calculate(_,L,O){if(!this._attachedDepsListeners.get(_)){const B=L.map(z=>z+"Change.konva").join(v);this.on(B,()=>{this._clearCache(_)}),this._attachedDepsListeners.set(_,!0)}return this._getCache(_,O)}_getCanvasCache(){return this._cache.get(h)}_clearSelfAndDescendantCache(_){this._clearCache(_),_===c&&this.fire("absoluteTransformChange")}clearCache(){if(this._cache.has(h)){const{scene:_,filter:L,hit:O}=this._cache.get(h);e.Util.releaseCanvas(_,L,O),this._cache.delete(h)}return this._clearSelfAndDescendantCache(),this._requestDraw(),this}cache(_){var L=_||{},O={};(L.x===void 0||L.y===void 0||L.width===void 0||L.height===void 0)&&(O=this.getClientRect({skipTransform:!0,relativeTo:this.getParent()||void 0}));var B=Math.ceil(L.width||O.width),z=Math.ceil(L.height||O.height),ee=L.pixelRatio,ne=L.x===void 0?Math.floor(O.x):L.x,re=L.y===void 0?Math.floor(O.y):L.y,te=L.offset||0,H=L.drawBorder||!1,V=L.hitCanvasPixelRatio||1;if(!B||!z){e.Util.error("Can not cache the node. Width or height of the node equals 0. Caching is skipped.");return}const X=Math.abs(Math.round(O.x)-ne)>.5?1:0,W=Math.abs(Math.round(O.y)-re)>.5?1:0;B+=te*2+X,z+=te*2+W,ne-=te,re-=te;var Y=new n.SceneCanvas({pixelRatio:ee,width:B,height:z}),$=new n.SceneCanvas({pixelRatio:ee,width:0,height:0,willReadFrequently:!0}),N=new n.HitCanvas({pixelRatio:V,width:B,height:z}),U=Y.getContext(),ie=N.getContext();return N.isCache=!0,Y.isCache=!0,this._cache.delete(h),this._filterUpToDate=!1,L.imageSmoothingEnabled===!1&&(Y.getContext()._context.imageSmoothingEnabled=!1,$.getContext()._context.imageSmoothingEnabled=!1),U.save(),ie.save(),U.translate(-ne,-re),ie.translate(-ne,-re),this._isUnderCache=!0,this._clearSelfAndDescendantCache(a),this._clearSelfAndDescendantCache(d),this.drawScene(Y,this),this.drawHit(N,this),this._isUnderCache=!1,U.restore(),ie.restore(),H&&(U.save(),U.beginPath(),U.rect(0,0,B,z),U.closePath(),U.setAttr("strokeStyle","red"),U.setAttr("lineWidth",5),U.stroke(),U.restore()),this._cache.set(h,{scene:Y,filter:$,hit:N,x:ne,y:re}),this._requestDraw(),this}isCached(){return this._cache.has(h)}getClientRect(_){throw new Error('abstract "getClientRect" method call')}_transformedRect(_,L){var O=[{x:_.x,y:_.y},{x:_.x+_.width,y:_.y},{x:_.x+_.width,y:_.y+_.height},{x:_.x,y:_.y+_.height}],B=1/0,z=1/0,ee=-1/0,ne=-1/0,re=this.getAbsoluteTransform(L);return O.forEach(function(te){var H=re.point(te);B===void 0&&(B=ee=H.x,z=ne=H.y),B=Math.min(B,H.x),z=Math.min(z,H.y),ee=Math.max(ee,H.x),ne=Math.max(ne,H.y)}),{x:B,y:z,width:ee-B,height:ne-z}}_drawCachedSceneCanvas(_){_.save(),_._applyOpacity(this),_._applyGlobalCompositeOperation(this);const L=this._getCanvasCache();_.translate(L.x,L.y);var O=this._getCachedSceneCanvas(),B=O.pixelRatio;_.drawImage(O._canvas,0,0,O.width/B,O.height/B),_.restore()}_drawCachedHitCanvas(_){var L=this._getCanvasCache(),O=L.hit;_.save(),_.translate(L.x,L.y),_.drawImage(O._canvas,0,0,O.width/O.pixelRatio,O.height/O.pixelRatio),_.restore()}_getCachedSceneCanvas(){var _=this.filters(),L=this._getCanvasCache(),O=L.scene,B=L.filter,z=B.getContext(),ee,ne,re,te;if(_){if(!this._filterUpToDate){var H=O.pixelRatio;B.setSize(O.width/O.pixelRatio,O.height/O.pixelRatio);try{for(ee=_.length,z.clear(),z.drawImage(O._canvas,0,0,O.getWidth()/H,O.getHeight()/H),ne=z.getImageData(0,0,B.getWidth(),B.getHeight()),re=0;re<ee;re++){if(te=_[re],typeof te!="function"){e.Util.error("Filter should be type of function, but got "+typeof te+" instead. Please check correct filters");continue}te.call(this,ne),z.putImageData(ne,0,0)}}catch(V){e.Util.error("Unable to apply filter. "+V.message+" This post my help you https://konvajs.org/docs/posts/Tainted_Canvas.html.")}this._filterUpToDate=!0}return B}return O}on(_,L){if(this._cache&&this._cache.delete(l),arguments.length===3)return this._delegate.apply(this,arguments);var O=_.split(v),B=O.length,z,ee,ne,re,te;for(z=0;z<B;z++)ee=O[z],ne=ee.split("."),re=ne[0],te=ne[1]||"",this.eventListeners[re]||(this.eventListeners[re]=[]),this.eventListeners[re].push({name:te,handler:L});return this}off(_,L){var O=(_||"").split(v),B=O.length,z,ee,ne,re,te,H;if(this._cache&&this._cache.delete(l),!_)for(ee in this.eventListeners)this._off(ee);for(z=0;z<B;z++)if(ne=O[z],re=ne.split("."),te=re[0],H=re[1],te)this.eventListeners[te]&&this._off(te,H,L);else for(ee in this.eventListeners)this._off(ee,H,L);return this}dispatchEvent(_){var L={target:this,type:_.type,evt:_};return this.fire(_.type,L),this}addEventListener(_,L){return this.on(_,function(O){L.call(this,O.evt)}),this}removeEventListener(_){return this.off(_),this}_delegate(_,L,O){var B=this;this.on(_,function(z){for(var ee=z.target.findAncestors(L,!0,B),ne=0;ne<ee.length;ne++)z=e.Util.cloneObject(z),z.currentTarget=ee[ne],O.call(ee[ne],z)})}remove(){return this.isDragging()&&this.stopDrag(),i.DD._dragElements.delete(this._id),this._remove(),this}_clearCaches(){this._clearSelfAndDescendantCache(c),this._clearSelfAndDescendantCache(a),this._clearSelfAndDescendantCache(d),this._clearSelfAndDescendantCache(w),this._clearSelfAndDescendantCache(P),this._clearSelfAndDescendantCache(m)}_remove(){this._clearCaches();var _=this.getParent();_&&_.children&&(_.children.splice(this.index,1),_._setChildrenIndices(),this.parent=null)}destroy(){return this.remove(),this.clearCache(),this}getAttr(_){var L="get"+e.Util._capitalize(_);return e.Util._isFunction(this[L])?this[L]():this.attrs[_]}getAncestors(){for(var _=this.getParent(),L=[];_;)L.push(_),_=_.getParent();return L}getAttrs(){return this.attrs||{}}setAttrs(_){return this._batchTransformChanges(()=>{var L,O;if(!_)return this;for(L in _)L!==p&&(O=C+e.Util._capitalize(L),e.Util._isFunction(this[O])?this[O](_[L]):this._setAttr(L,_[L]))}),this}isListening(){return this._getCache(m,this._isListening)}_isListening(_){if(!this.listening())return!1;const O=this.getParent();return O&&O!==_&&this!==_?O._isListening(_):!0}isVisible(){return this._getCache(P,this._isVisible)}_isVisible(_){if(!this.visible())return!1;const O=this.getParent();return O&&O!==_&&this!==_?O._isVisible(_):!0}shouldDrawHit(_,L=!1){if(_)return this._isVisible(_)&&this._isListening(_);var O=this.getLayer(),B=!1;i.DD._dragElements.forEach(ee=>{ee.dragStatus==="dragging"&&(ee.node.nodeType==="Stage"||ee.node.getLayer()===O)&&(B=!0)});var z=!L&&!s.Konva.hitOnDragEnabled&&(B||s.Konva.isTransforming());return this.isListening()&&this.isVisible()&&!z}show(){return this.visible(!0),this}hide(){return this.visible(!1),this}getZIndex(){return this.index||0}getAbsoluteZIndex(){var _=this.getDepth(),L=this,O=0,B,z,ee,ne;function re(H){for(B=[],z=H.length,ee=0;ee<z;ee++)ne=H[ee],O++,ne.nodeType!==x&&(B=B.concat(ne.getChildren().slice())),ne._id===L._id&&(ee=z);B.length>0&&B[0].getDepth()<=_&&re(B)}const te=this.getStage();return L.nodeType!==j&&te&&re(te.getChildren()),O}getDepth(){for(var _=0,L=this.parent;L;)_++,L=L.parent;return _}_batchTransformChanges(_){this._batchingTransformChange=!0,_(),this._batchingTransformChange=!1,this._needClearTransformCache&&(this._clearCache(S),this._clearSelfAndDescendantCache(c)),this._needClearTransformCache=!1}setPosition(_){return this._batchTransformChanges(()=>{this.x(_.x),this.y(_.y)}),this}getPosition(){return{x:this.x(),y:this.y()}}getRelativePointerPosition(){const _=this.getStage();if(!_)return null;var L=_.getPointerPosition();if(!L)return null;var O=this.getAbsoluteTransform().copy();return O.invert(),O.point(L)}getAbsolutePosition(_){let L=!1,O=this.parent;for(;O;){if(O.isCached()){L=!0;break}O=O.parent}L&&!_&&(_=!0);var B=this.getAbsoluteTransform(_).getMatrix(),z=new e.Transform,ee=this.offset();return z.m=B.slice(),z.translate(ee.x,ee.y),z.getTranslation()}setAbsolutePosition(_){const{x:L,y:O,...B}=this._clearTransform();this.attrs.x=L,this.attrs.y=O,this._clearCache(S);var z=this._getAbsoluteTransform().copy();return z.invert(),z.translate(_.x,_.y),_={x:this.attrs.x+z.getTranslation().x,y:this.attrs.y+z.getTranslation().y},this._setTransform(B),this.setPosition({x:_.x,y:_.y}),this._clearCache(S),this._clearSelfAndDescendantCache(c),this}_setTransform(_){var L;for(L in _)this.attrs[L]=_[L]}_clearTransform(){var _={x:this.x(),y:this.y(),rotation:this.rotation(),scaleX:this.scaleX(),scaleY:this.scaleY(),offsetX:this.offsetX(),offsetY:this.offsetY(),skewX:this.skewX(),skewY:this.skewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,_}move(_){var L=_.x,O=_.y,B=this.x(),z=this.y();return L!==void 0&&(B+=L),O!==void 0&&(z+=O),this.setPosition({x:B,y:z}),this}_eachAncestorReverse(_,L){var O=[],B=this.getParent(),z,ee;if(!(L&&L._id===this._id)){for(O.unshift(this);B&&(!L||B._id!==L._id);)O.unshift(B),B=B.parent;for(z=O.length,ee=0;ee<z;ee++)_(O[ee])}}rotate(_){return this.rotation(this.rotation()+_),this}moveToTop(){if(!this.parent)return e.Util.warn("Node has no parent. moveToTop function is ignored."),!1;var _=this.index,L=this.parent.getChildren().length;return _<L-1?(this.parent.children.splice(_,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0):!1}moveUp(){if(!this.parent)return e.Util.warn("Node has no parent. moveUp function is ignored."),!1;var _=this.index,L=this.parent.getChildren().length;return _<L-1?(this.parent.children.splice(_,1),this.parent.children.splice(_+1,0,this),this.parent._setChildrenIndices(),!0):!1}moveDown(){if(!this.parent)return e.Util.warn("Node has no parent. moveDown function is ignored."),!1;var _=this.index;return _>0?(this.parent.children.splice(_,1),this.parent.children.splice(_-1,0,this),this.parent._setChildrenIndices(),!0):!1}moveToBottom(){if(!this.parent)return e.Util.warn("Node has no parent. moveToBottom function is ignored."),!1;var _=this.index;return _>0?(this.parent.children.splice(_,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0):!1}setZIndex(_){if(!this.parent)return e.Util.warn("Node has no parent. zIndex parameter is ignored."),this;(_<0||_>=this.parent.children.length)&&e.Util.warn("Unexpected value "+_+" for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to "+(this.parent.children.length-1)+".");var L=this.index;return this.parent.children.splice(L,1),this.parent.children.splice(_,0,this),this.parent._setChildrenIndices(),this}getAbsoluteOpacity(){return this._getCache(a,this._getAbsoluteOpacity)}_getAbsoluteOpacity(){var _=this.opacity(),L=this.getParent();return L&&!L._isUnderCache&&(_*=L.getAbsoluteOpacity()),_}moveTo(_){return this.getParent()!==_&&(this._remove(),_.add(this)),this}toObject(){var _=this.getAttrs(),L,O,B,z,ee;const ne={attrs:{},className:this.getClassName()};for(L in _)O=_[L],ee=e.Util.isObject(O)&&!e.Util._isPlainObject(O)&&!e.Util._isArray(O),!ee&&(B=typeof this[L]=="function"&&this[L],delete _[L],z=B?B.call(this):null,_[L]=O,z!==O&&(ne.attrs[L]=O));return e.Util._prepareToStringify(ne)}toJSON(){return JSON.stringify(this.toObject())}getParent(){return this.parent}findAncestors(_,L,O){var B=[];L&&this._isMatch(_)&&B.push(this);for(var z=this.parent;z;){if(z===O)return B;z._isMatch(_)&&B.push(z),z=z.parent}return B}isAncestorOf(_){return!1}findAncestor(_,L,O){return this.findAncestors(_,L,O)[0]}_isMatch(_){if(!_)return!1;if(typeof _=="function")return _(this);var L=_.replace(/ /g,"").split(","),O=L.length,B,z;for(B=0;B<O;B++)if(z=L[B],e.Util.isValidSelector(z)||(e.Util.warn('Selector "'+z+'" is invalid. Allowed selectors examples are "#foo", ".bar" or "Group".'),e.Util.warn('If you have a custom shape with such className, please change it to start with upper letter like "Triangle".'),e.Util.warn("Konva is awesome, right?")),z.charAt(0)==="#"){if(this.id()===z.slice(1))return!0}else if(z.charAt(0)==="."){if(this.hasName(z.slice(1)))return!0}else if(this.className===z||this.nodeType===z)return!0;return!1}getLayer(){var _=this.getParent();return _?_.getLayer():null}getStage(){return this._getCache(w,this._getStage)}_getStage(){var _=this.getParent();return _?_.getStage():null}fire(_,L={},O){return L.target=L.target||this,O?this._fireAndBubble(_,L):this._fire(_,L),this}getAbsoluteTransform(_){return _?this._getAbsoluteTransform(_):this._getCache(c,this._getAbsoluteTransform)}_getAbsoluteTransform(_){var L;if(_)return L=new e.Transform,this._eachAncestorReverse(function(B){var z=B.transformsEnabled();z==="all"?L.multiply(B.getTransform()):z==="position"&&L.translate(B.x()-B.offsetX(),B.y()-B.offsetY())},_),L;L=this._cache.get(c)||new e.Transform,this.parent?this.parent.getAbsoluteTransform().copyInto(L):L.reset();var O=this.transformsEnabled();if(O==="all")L.multiply(this.getTransform());else if(O==="position"){const B=this.attrs.x||0,z=this.attrs.y||0,ee=this.attrs.offsetX||0,ne=this.attrs.offsetY||0;L.translate(B-ee,z-ne)}return L.dirty=!1,L}getAbsoluteScale(_){for(var L=this;L;)L._isUnderCache&&(_=L),L=L.getParent();const B=this.getAbsoluteTransform(_).decompose();return{x:B.scaleX,y:B.scaleY}}getAbsoluteRotation(){return this.getAbsoluteTransform().decompose().rotation}getTransform(){return this._getCache(S,this._getTransform)}_getTransform(){var _,L,O=this._cache.get(S)||new e.Transform;O.reset();var B=this.x(),z=this.y(),ee=s.Konva.getAngle(this.rotation()),ne=(_=this.attrs.scaleX)!==null&&_!==void 0?_:1,re=(L=this.attrs.scaleY)!==null&&L!==void 0?L:1,te=this.attrs.skewX||0,H=this.attrs.skewY||0,V=this.attrs.offsetX||0,X=this.attrs.offsetY||0;return(B!==0||z!==0)&&O.translate(B,z),ee!==0&&O.rotate(ee),(te!==0||H!==0)&&O.skew(te,H),(ne!==1||re!==1)&&O.scale(ne,re),(V!==0||X!==0)&&O.translate(-1*V,-1*X),O.dirty=!1,O}clone(_){var L=e.Util.cloneObject(this.attrs),O,B,z,ee,ne;for(O in _)L[O]=_[O];var re=new this.constructor(L);for(O in this.eventListeners)for(B=this.eventListeners[O],z=B.length,ee=0;ee<z;ee++)ne=B[ee],ne.name.indexOf(g)<0&&(re.eventListeners[O]||(re.eventListeners[O]=[]),re.eventListeners[O].push(ne));return re}_toKonvaCanvas(_){_=_||{};var L=this.getClientRect(),O=this.getStage(),B=_.x!==void 0?_.x:Math.floor(L.x),z=_.y!==void 0?_.y:Math.floor(L.y),ee=_.pixelRatio||1,ne=new n.SceneCanvas({width:_.width||Math.ceil(L.width)||(O?O.width():0),height:_.height||Math.ceil(L.height)||(O?O.height():0),pixelRatio:ee}),re=ne.getContext();const te=new n.SceneCanvas({width:ne.width/ne.pixelRatio+Math.abs(B),height:ne.height/ne.pixelRatio+Math.abs(z),pixelRatio:ne.pixelRatio});return _.imageSmoothingEnabled===!1&&(re._context.imageSmoothingEnabled=!1),re.save(),(B||z)&&re.translate(-1*B,-1*z),this.drawScene(ne,void 0,te),re.restore(),ne}toCanvas(_){return this._toKonvaCanvas(_)._canvas}toDataURL(_){_=_||{};var L=_.mimeType||null,O=_.quality||null,B=this._toKonvaCanvas(_).toDataURL(L,O);return _.callback&&_.callback(B),B}toImage(_){return new Promise((L,O)=>{try{const B=_==null?void 0:_.callback;B&&delete _.callback,e.Util._urlToImage(this.toDataURL(_),function(z){L(z),B==null||B(z)})}catch(B){O(B)}})}toBlob(_){return new Promise((L,O)=>{try{const B=_==null?void 0:_.callback;B&&delete _.callback,this.toCanvas(_).toBlob(z=>{L(z),B==null||B(z)},_==null?void 0:_.mimeType,_==null?void 0:_.quality)}catch(B){O(B)}})}setSize(_){return this.width(_.width),this.height(_.height),this}getSize(){return{width:this.width(),height:this.height()}}getClassName(){return this.className||this.nodeType}getType(){return this.nodeType}getDragDistance(){return this.attrs.dragDistance!==void 0?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():s.Konva.dragDistance}_off(_,L,O){var B=this.eventListeners[_],z,ee,ne;for(z=0;z<B.length;z++)if(ee=B[z].name,ne=B[z].handler,(ee!=="konva"||L==="konva")&&(!L||ee===L)&&(!O||O===ne)){if(B.splice(z,1),B.length===0){delete this.eventListeners[_];break}z--}}_fireChangeEvent(_,L,O){this._fire(_+f,{oldVal:L,newVal:O})}addName(_){if(!this.hasName(_)){var L=this.name(),O=L?L+" "+_:_;this.name(O)}return this}hasName(_){if(!_)return!1;const L=this.name();if(!L)return!1;var O=(L||"").split(/\s/g);return O.indexOf(_)!==-1}removeName(_){var L=(this.name()||"").split(/\s/g),O=L.indexOf(_);return O!==-1&&(L.splice(O,1),this.name(L.join(" "))),this}setAttr(_,L){var O=this[C+e.Util._capitalize(_)];return e.Util._isFunction(O)?O.call(this,L):this._setAttr(_,L),this}_requestDraw(){if(s.Konva.autoDrawEnabled){const _=this.getLayer()||this.getStage();_==null||_.batchDraw()}}_setAttr(_,L){var O=this.attrs[_];O===L&&!e.Util.isObject(L)||(L==null?delete this.attrs[_]:this.attrs[_]=L,this._shouldFireChangeEvents&&this._fireChangeEvent(_,O,L),this._requestDraw())}_setComponentAttr(_,L,O){var B;O!==void 0&&(B=this.attrs[_],B||(this.attrs[_]=this.getAttr(_)),this.attrs[_][L]=O,this._fireChangeEvent(_,B,O))}_fireAndBubble(_,L,O){L&&this.nodeType===x&&(L.target=this);var B=(_===y||_===b)&&(O&&(this===O||this.isAncestorOf&&this.isAncestorOf(O))||this.nodeType==="Stage"&&!O);if(!B){this._fire(_,L);var z=(_===y||_===b)&&O&&O.isAncestorOf&&O.isAncestorOf(this)&&!O.isAncestorOf(this.parent);(L&&!L.cancelBubble||!L)&&this.parent&&this.parent.isListening()&&!z&&(O&&O.parent?this._fireAndBubble.call(this.parent,_,L,O):this._fireAndBubble.call(this.parent,_,L))}}_getProtoListeners(_){var L,O,B;const z=(L=this._cache.get(l))!==null&&L!==void 0?L:{};let ee=z==null?void 0:z[_];if(ee===void 0){ee=[];let ne=Object.getPrototypeOf(this);for(;ne;){const re=(B=(O=ne.eventListeners)===null||O===void 0?void 0:O[_])!==null&&B!==void 0?B:[];ee.push(...re),ne=Object.getPrototypeOf(ne)}z[_]=ee,this._cache.set(l,z)}return ee}_fire(_,L){L=L||{},L.currentTarget=this,L.type=_;const O=this._getProtoListeners(_);if(O)for(var B=0;B<O.length;B++)O[B].handler.call(this,L);const z=this.eventListeners[_];if(z)for(var B=0;B<z.length;B++)z[B].handler.call(this,L)}draw(){return this.drawScene(),this.drawHit(),this}_createDragElement(_){var L=_?_.pointerId:void 0,O=this.getStage(),B=this.getAbsolutePosition();if(O){var z=O._getPointerById(L)||O._changedPointerPositions[0]||B;i.DD._dragElements.set(this._id,{node:this,startPointerPos:z,offset:{x:z.x-B.x,y:z.y-B.y},dragStatus:"ready",pointerId:L})}}startDrag(_,L=!0){i.DD._dragElements.has(this._id)||this._createDragElement(_);const O=i.DD._dragElements.get(this._id);O.dragStatus="dragging",this.fire("dragstart",{type:"dragstart",target:this,evt:_&&_.evt},L)}_setDragPosition(_,L){const O=this.getStage()._getPointerById(L.pointerId);if(O){var B={x:O.x-L.offset.x,y:O.y-L.offset.y},z=this.dragBoundFunc();if(z!==void 0){const ee=z.call(this,B,_);ee?B=ee:e.Util.warn("dragBoundFunc did not return any value. That is unexpected behavior. You must return new absolute position from dragBoundFunc.")}(!this._lastPos||this._lastPos.x!==B.x||this._lastPos.y!==B.y)&&(this.setAbsolutePosition(B),this._requestDraw()),this._lastPos=B}}stopDrag(_){const L=i.DD._dragElements.get(this._id);L&&(L.dragStatus="stopped"),i.DD._endDragBefore(_),i.DD._endDragAfter(_)}setDraggable(_){this._setAttr("draggable",_),this._dragChange()}isDragging(){const _=i.DD._dragElements.get(this._id);return _?_.dragStatus==="dragging":!1}_listenDrag(){this._dragCleanup(),this.on("mousedown.konva touchstart.konva",function(_){var L=_.evt.button!==void 0,O=!L||s.Konva.dragButtons.indexOf(_.evt.button)>=0;if(O&&!this.isDragging()){var B=!1;i.DD._dragElements.forEach(z=>{this.isAncestorOf(z.node)&&(B=!0)}),B||this._createDragElement(_)}})}_dragChange(){if(this.attrs.draggable)this._listenDrag();else{this._dragCleanup();var _=this.getStage();if(!_)return;const L=i.DD._dragElements.get(this._id),O=L&&L.dragStatus==="dragging",B=L&&L.dragStatus==="ready";O?this.stopDrag():B&&i.DD._dragElements.delete(this._id)}}_dragCleanup(){this.off("mousedown.konva"),this.off("touchstart.konva")}isClientRectOnScreen(_={x:0,y:0}){const L=this.getStage();if(!L)return!1;const O={x:-_.x,y:-_.y,width:L.width()+2*_.x,height:L.height()+2*_.y};return e.Util.haveIntersection(O,this.getClientRect())}static create(_,L){return e.Util._isString(_)&&(_=JSON.parse(_)),this._createNode(_,L)}static _createNode(_,L){var O=M.prototype.getClassName.call(_),B=_.children,z,ee,ne;L&&(_.attrs.container=L),s.Konva[O]||(e.Util.warn('Can not find a node with class name "'+O+'". Fallback to "Shape".'),O="Shape");const re=s.Konva[O];if(z=new re(_.attrs),B)for(ee=B.length,ne=0;ne<ee;ne++)z.add(M._createNode(B[ne]));return z}}th.Node=M,M.prototype.nodeType="Node",M.prototype._attrsAffectingSize=[],M.prototype.eventListeners={},M.prototype.on.call(M.prototype,E,function(){if(this._batchingTransformChange){this._needClearTransformCache=!0;return}this._clearCache(S),this._clearSelfAndDescendantCache(c)}),M.prototype.on.call(M.prototype,"visibleChange.konva",function(){this._clearSelfAndDescendantCache(P)}),M.prototype.on.call(M.prototype,"listeningChange.konva",function(){this._clearSelfAndDescendantCache(m)}),M.prototype.on.call(M.prototype,"opacityChange.konva",function(){this._clearSelfAndDescendantCache(a)});const R=t.Factory.addGetterSetter;return R(M,"zIndex"),R(M,"absolutePosition"),R(M,"position"),R(M,"x",0,(0,o.getNumberValidator)()),R(M,"y",0,(0,o.getNumberValidator)()),R(M,"globalCompositeOperation","source-over",(0,o.getStringValidator)()),R(M,"opacity",1,(0,o.getNumberValidator)()),R(M,"name","",(0,o.getStringValidator)()),R(M,"id","",(0,o.getStringValidator)()),R(M,"rotation",0,(0,o.getNumberValidator)()),t.Factory.addComponentsGetterSetter(M,"scale",["x","y"]),R(M,"scaleX",1,(0,o.getNumberValidator)()),R(M,"scaleY",1,(0,o.getNumberValidator)()),t.Factory.addComponentsGetterSetter(M,"skew",["x","y"]),R(M,"skewX",0,(0,o.getNumberValidator)()),R(M,"skewY",0,(0,o.getNumberValidator)()),t.Factory.addComponentsGetterSetter(M,"offset",["x","y"]),R(M,"offsetX",0,(0,o.getNumberValidator)()),R(M,"offsetY",0,(0,o.getNumberValidator)()),R(M,"dragDistance",null,(0,o.getNumberValidator)()),R(M,"width",0,(0,o.getNumberValidator)()),R(M,"height",0,(0,o.getNumberValidator)()),R(M,"listening",!0,(0,o.getBooleanValidator)()),R(M,"preventDefault",!0,(0,o.getBooleanValidator)()),R(M,"filters",null,function(F){return this._filterUpToDate=!1,F}),R(M,"visible",!0,(0,o.getBooleanValidator)()),R(M,"transformsEnabled","all",(0,o.getStringValidator)()),R(M,"size"),R(M,"dragBoundFunc"),R(M,"draggable",!1,(0,o.getBooleanValidator)()),t.Factory.backCompat(M,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"}),th}var nh={},x6;function jb(){if(x6)return nh;x6=1,Object.defineProperty(nh,"__esModule",{value:!0}),nh.Container=void 0;const e=jt(),t=Ln(),n=_t();let s=class extends t.Node{constructor(){super(...arguments),this.children=[]}getChildren(o){if(!o)return this.children||[];const a=this.children||[];var l=[];return a.forEach(function(c){o(c)&&l.push(c)}),l}hasChildren(){return this.getChildren().length>0}removeChildren(){return this.getChildren().forEach(o=>{o.parent=null,o.index=0,o.remove()}),this.children=[],this._requestDraw(),this}destroyChildren(){return this.getChildren().forEach(o=>{o.parent=null,o.index=0,o.destroy()}),this.children=[],this._requestDraw(),this}add(...o){if(o.length===0)return this;if(o.length>1){for(var a=0;a<o.length;a++)this.add(o[a]);return this}const l=o[0];return l.getParent()?(l.moveTo(this),this):(this._validateAdd(l),l.index=this.getChildren().length,l.parent=this,l._clearCaches(),this.getChildren().push(l),this._fire("add",{child:l}),this._requestDraw(),this)}destroy(){return this.hasChildren()&&this.destroyChildren(),super.destroy(),this}find(o){return this._generalFind(o,!1)}findOne(o){var a=this._generalFind(o,!0);return a.length>0?a[0]:void 0}_generalFind(o,a){var l=[];return this._descendants(c=>{const d=c._isMatch(o);return d&&l.push(c),!!(d&&a)}),l}_descendants(o){let a=!1;const l=this.getChildren();for(const c of l){if(a=o(c),a)return!0;if(c.hasChildren()&&(a=c._descendants(o),a))return!0}return!1}toObject(){var o=t.Node.prototype.toObject.call(this);return o.children=[],this.getChildren().forEach(a=>{o.children.push(a.toObject())}),o}isAncestorOf(o){for(var a=o.getParent();a;){if(a._id===this._id)return!0;a=a.getParent()}return!1}clone(o){var a=t.Node.prototype.clone.call(this,o);return this.getChildren().forEach(function(l){a.add(l.clone())}),a}getAllIntersections(o){var a=[];return this.find("Shape").forEach(l=>{l.isVisible()&&l.intersects(o)&&a.push(l)}),a}_clearSelfAndDescendantCache(o){var a;super._clearSelfAndDescendantCache(o),!this.isCached()&&((a=this.children)===null||a===void 0||a.forEach(function(l){l._clearSelfAndDescendantCache(o)}))}_setChildrenIndices(){var o;(o=this.children)===null||o===void 0||o.forEach(function(a,l){a.index=l}),this._requestDraw()}drawScene(o,a,l){var c=this.getLayer(),d=o||c&&c.getCanvas(),h=d&&d.getContext(),f=this._getCanvasCache(),p=f&&f.scene,g=d&&d.isCache;if(!this.isVisible()&&!g)return this;if(p){h.save();var m=this.getAbsoluteTransform(a).getMatrix();h.transform(m[0],m[1],m[2],m[3],m[4],m[5]),this._drawCachedSceneCanvas(h),h.restore()}else this._drawChildren("drawScene",d,a,l);return this}drawHit(o,a){if(!this.shouldDrawHit(a))return this;var l=this.getLayer(),c=o||l&&l.hitCanvas,d=c&&c.getContext(),h=this._getCanvasCache(),f=h&&h.hit;if(f){d.save();var p=this.getAbsoluteTransform(a).getMatrix();d.transform(p[0],p[1],p[2],p[3],p[4],p[5]),this._drawCachedHitCanvas(d),d.restore()}else this._drawChildren("drawHit",c,a);return this}_drawChildren(o,a,l,c){var d,h=a&&a.getContext(),f=this.clipWidth(),p=this.clipHeight(),g=this.clipFunc(),m=typeof f=="number"&&typeof p=="number"||g;const y=l===this;if(m){h.save();var b=this.getAbsoluteTransform(l),C=b.getMatrix();h.transform(C[0],C[1],C[2],C[3],C[4],C[5]),h.beginPath();let S;if(g)S=g.call(this,h,this);else{var x=this.clipX(),v=this.clipY();h.rect(x||0,v||0,f,p)}h.clip.apply(h,S),C=b.copy().invert().getMatrix(),h.transform(C[0],C[1],C[2],C[3],C[4],C[5])}var w=!y&&this.globalCompositeOperation()!=="source-over"&&o==="drawScene";w&&(h.save(),h._applyGlobalCompositeOperation(this)),(d=this.children)===null||d===void 0||d.forEach(function(S){S[o](a,l,c)}),w&&h.restore(),m&&h.restore()}getClientRect(o={}){var a,l=o.skipTransform,c=o.relativeTo,d,h,f,p,g={x:1/0,y:1/0,width:0,height:0},m=this;(a=this.children)===null||a===void 0||a.forEach(function(v){if(v.visible()){var w=v.getClientRect({relativeTo:m,skipShadow:o.skipShadow,skipStroke:o.skipStroke});w.width===0&&w.height===0||(d===void 0?(d=w.x,h=w.y,f=w.x+w.width,p=w.y+w.height):(d=Math.min(d,w.x),h=Math.min(h,w.y),f=Math.max(f,w.x+w.width),p=Math.max(p,w.y+w.height)))}});for(var y=this.find("Shape"),b=!1,C=0;C<y.length;C++){var x=y[C];if(x._isVisible(this)){b=!0;break}}return b&&d!==void 0?g={x:d,y:h,width:f-d,height:p-h}:g={x:0,y:0,width:0,height:0},l?g:this._transformedRect(g,c)}};return nh.Container=s,e.Factory.addComponentsGetterSetter(s,"clip",["x","y","width","height"]),e.Factory.addGetterSetter(s,"clipX",void 0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(s,"clipY",void 0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(s,"clipWidth",void 0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(s,"clipHeight",void 0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(s,"clipFunc"),nh}var av={},dr={},v6;function j9(){if(v6)return dr;v6=1,Object.defineProperty(dr,"__esModule",{value:!0}),dr.releaseCapture=dr.setPointerCapture=dr.hasPointerCapture=dr.createEvent=dr.getCapturedShape=void 0;const e=St(),t=new Map,n=e.Konva._global.PointerEvent!==void 0;function s(c){return t.get(c)}dr.getCapturedShape=s;function i(c){return{evt:c,pointerId:c.pointerId}}dr.createEvent=i;function o(c,d){return t.get(c)===d}dr.hasPointerCapture=o;function a(c,d){l(c),d.getStage()&&(t.set(c,d),n&&d._fire("gotpointercapture",i(new PointerEvent("gotpointercapture"))))}dr.setPointerCapture=a;function l(c,d){const h=t.get(c);if(!h)return;const f=h.getStage();f&&f.content,t.delete(c),n&&h._fire("lostpointercapture",i(new PointerEvent("lostpointercapture")))}return dr.releaseCapture=l,dr}var C6;function Ipe(){return C6||(C6=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Stage=e.stages=void 0;const t=En(),n=jt(),s=jb(),i=St(),o=Sb(),a=hk(),l=St(),c=j9();var d="Stage",h="string",f="px",p="mouseout",g="mouseleave",m="mouseover",y="mouseenter",b="mousemove",C="mousedown",x="mouseup",v="pointermove",w="pointerdown",S="pointerup",j="pointercancel",P="lostpointercapture",E="pointerout",D="pointerleave",M="pointerover",R="pointerenter",F="contextmenu",_="touchstart",L="touchend",O="touchmove",B="touchcancel",z="wheel",ee=5,ne=[[y,"_pointerenter"],[C,"_pointerdown"],[b,"_pointermove"],[x,"_pointerup"],[g,"_pointerleave"],[_,"_pointerdown"],[O,"_pointermove"],[L,"_pointerup"],[B,"_pointercancel"],[m,"_pointerover"],[z,"_wheel"],[F,"_contextmenu"],[w,"_pointerdown"],[v,"_pointermove"],[S,"_pointerup"],[j,"_pointercancel"],[P,"_lostpointercapture"]];const re={mouse:{[E]:p,[D]:g,[M]:m,[R]:y,[v]:b,[w]:C,[S]:x,[j]:"mousecancel",pointerclick:"click",pointerdblclick:"dblclick"},touch:{[E]:"touchout",[D]:"touchleave",[M]:"touchover",[R]:"touchenter",[v]:O,[w]:_,[S]:L,[j]:B,pointerclick:"tap",pointerdblclick:"dbltap"},pointer:{[E]:E,[D]:D,[M]:M,[R]:R,[v]:v,[w]:w,[S]:S,[j]:j,pointerclick:"pointerclick",pointerdblclick:"pointerdblclick"}},te=Y=>Y.indexOf("pointer")>=0?"pointer":Y.indexOf("touch")>=0?"touch":"mouse",H=Y=>{const $=te(Y);if($==="pointer")return i.Konva.pointerEventsEnabled&&re.pointer;if($==="touch")return re.touch;if($==="mouse")return re.mouse};function V(Y={}){return(Y.clipFunc||Y.clipWidth||Y.clipHeight)&&t.Util.warn("Stage does not support clipping. Please use clip for Layers or Groups."),Y}const X="Pointer position is missing and not registered by the stage. Looks like it is outside of the stage container. You can set it manually from event: stage.setPointersPositions(event);";e.stages=[];class W extends s.Container{constructor($){super(V($)),this._pointerPositions=[],this._changedPointerPositions=[],this._buildDOM(),this._bindContentEvents(),e.stages.push(this),this.on("widthChange.konva heightChange.konva",this._resizeDOM),this.on("visibleChange.konva",this._checkVisibility),this.on("clipWidthChange.konva clipHeightChange.konva clipFuncChange.konva",()=>{V(this.attrs)}),this._checkVisibility()}_validateAdd($){const N=$.getType()==="Layer",U=$.getType()==="FastLayer";N||U||t.Util.throw("You may only add layers to the stage.")}_checkVisibility(){if(!this.content)return;const $=this.visible()?"":"none";this.content.style.display=$}setContainer($){if(typeof $===h){if($.charAt(0)==="."){var N=$.slice(1);$=document.getElementsByClassName(N)[0]}else{var U;$.charAt(0)!=="#"?U=$:U=$.slice(1),$=document.getElementById(U)}if(!$)throw"Can not find container in document with id "+U}return this._setAttr("container",$),this.content&&(this.content.parentElement&&this.content.parentElement.removeChild(this.content),$.appendChild(this.content)),this}shouldDrawHit(){return!0}clear(){var $=this.children,N=$.length,U;for(U=0;U<N;U++)$[U].clear();return this}clone($){return $||($={}),$.container=typeof document<"u"&&document.createElement("div"),s.Container.prototype.clone.call(this,$)}destroy(){super.destroy();var $=this.content;$&&t.Util._isInDocument($)&&this.container().removeChild($);var N=e.stages.indexOf(this);return N>-1&&e.stages.splice(N,1),t.Util.releaseCanvas(this.bufferCanvas._canvas,this.bufferHitCanvas._canvas),this}getPointerPosition(){const $=this._pointerPositions[0]||this._changedPointerPositions[0];return $?{x:$.x,y:$.y}:(t.Util.warn(X),null)}_getPointerById($){return this._pointerPositions.find(N=>N.id===$)}getPointersPositions(){return this._pointerPositions}getStage(){return this}getContent(){return this.content}_toKonvaCanvas($){$=$||{},$.x=$.x||0,$.y=$.y||0,$.width=$.width||this.width(),$.height=$.height||this.height();var N=new o.SceneCanvas({width:$.width,height:$.height,pixelRatio:$.pixelRatio||1}),U=N.getContext()._context,ie=this.children;return($.x||$.y)&&U.translate(-1*$.x,-1*$.y),ie.forEach(function(ue){if(ue.isVisible()){var xe=ue._toKonvaCanvas($);U.drawImage(xe._canvas,$.x,$.y,xe.getWidth()/xe.getPixelRatio(),xe.getHeight()/xe.getPixelRatio())}}),N}getIntersection($){if(!$)return null;var N=this.children,U=N.length,ie=U-1,ue;for(ue=ie;ue>=0;ue--){const xe=N[ue].getIntersection($);if(xe)return xe}return null}_resizeDOM(){var $=this.width(),N=this.height();this.content&&(this.content.style.width=$+f,this.content.style.height=N+f),this.bufferCanvas.setSize($,N),this.bufferHitCanvas.setSize($,N),this.children.forEach(U=>{U.setSize({width:$,height:N}),U.draw()})}add($,...N){if(arguments.length>1){for(var U=0;U<arguments.length;U++)this.add(arguments[U]);return this}super.add($);var ie=this.children.length;return ie>ee&&t.Util.warn("The stage has "+ie+" layers. Recommended maximum number of layers is 3-5. Adding more layers into the stage may drop the performance. Rethink your tree structure, you can use Konva.Group."),$.setSize({width:this.width(),height:this.height()}),$.draw(),i.Konva.isBrowser&&this.content.appendChild($.canvas._canvas),this}getParent(){return null}getLayer(){return null}hasPointerCapture($){return c.hasPointerCapture($,this)}setPointerCapture($){c.setPointerCapture($,this)}releaseCapture($){c.releaseCapture($,this)}getLayers(){return this.children}_bindContentEvents(){i.Konva.isBrowser&&ne.forEach(([$,N])=>{this.content.addEventListener($,U=>{this[N](U)},{passive:!1})})}_pointerenter($){this.setPointersPositions($);const N=H($.type);N&&this._fire(N.pointerenter,{evt:$,target:this,currentTarget:this})}_pointerover($){this.setPointersPositions($);const N=H($.type);N&&this._fire(N.pointerover,{evt:$,target:this,currentTarget:this})}_getTargetShape($){let N=this[$+"targetShape"];return N&&!N.getStage()&&(N=null),N}_pointerleave($){const N=H($.type),U=te($.type);if(N){this.setPointersPositions($);var ie=this._getTargetShape(U),ue=!(i.Konva.isDragging()||i.Konva.isTransforming())||i.Konva.hitOnDragEnabled;ie&&ue?(ie._fireAndBubble(N.pointerout,{evt:$}),ie._fireAndBubble(N.pointerleave,{evt:$}),this._fire(N.pointerleave,{evt:$,target:this,currentTarget:this}),this[U+"targetShape"]=null):ue&&(this._fire(N.pointerleave,{evt:$,target:this,currentTarget:this}),this._fire(N.pointerout,{evt:$,target:this,currentTarget:this})),this.pointerPos=null,this._pointerPositions=[]}}_pointerdown($){const N=H($.type),U=te($.type);if(N){this.setPointersPositions($);var ie=!1;this._changedPointerPositions.forEach(ue=>{var xe=this.getIntersection(ue);if(a.DD.justDragged=!1,i.Konva["_"+U+"ListenClick"]=!0,!xe||!xe.isListening()){this[U+"ClickStartShape"]=void 0;return}i.Konva.capturePointerEventsEnabled&&xe.setPointerCapture(ue.id),this[U+"ClickStartShape"]=xe,xe._fireAndBubble(N.pointerdown,{evt:$,pointerId:ue.id}),ie=!0;const Me=$.type.indexOf("touch")>=0;xe.preventDefault()&&$.cancelable&&Me&&$.preventDefault()}),ie||this._fire(N.pointerdown,{evt:$,target:this,currentTarget:this,pointerId:this._pointerPositions[0].id})}}_pointermove($){const N=H($.type),U=te($.type);if(!N)return;i.Konva.isDragging()&&a.DD.node.preventDefault()&&$.cancelable&&$.preventDefault(),this.setPointersPositions($);var ie=!(i.Konva.isDragging()||i.Konva.isTransforming())||i.Konva.hitOnDragEnabled;if(!ie)return;var ue={};let xe=!1;var Me=this._getTargetShape(U);this._changedPointerPositions.forEach(je=>{const Fe=c.getCapturedShape(je.id)||this.getIntersection(je),nt=je.id,$e={evt:$,pointerId:nt};var Z=Me!==Fe;if(Z&&Me&&(Me._fireAndBubble(N.pointerout,{...$e},Fe),Me._fireAndBubble(N.pointerleave,{...$e},Fe)),Fe){if(ue[Fe._id])return;ue[Fe._id]=!0}Fe&&Fe.isListening()?(xe=!0,Z&&(Fe._fireAndBubble(N.pointerover,{...$e},Me),Fe._fireAndBubble(N.pointerenter,{...$e},Me),this[U+"targetShape"]=Fe),Fe._fireAndBubble(N.pointermove,{...$e})):Me&&(this._fire(N.pointerover,{evt:$,target:this,currentTarget:this,pointerId:nt}),this[U+"targetShape"]=null)}),xe||this._fire(N.pointermove,{evt:$,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id})}_pointerup($){const N=H($.type),U=te($.type);if(!N)return;this.setPointersPositions($);const ie=this[U+"ClickStartShape"],ue=this[U+"ClickEndShape"];var xe={};let Me=!1;this._changedPointerPositions.forEach(je=>{const Fe=c.getCapturedShape(je.id)||this.getIntersection(je);if(Fe){if(Fe.releaseCapture(je.id),xe[Fe._id])return;xe[Fe._id]=!0}const nt=je.id,$e={evt:$,pointerId:nt};let Z=!1;i.Konva["_"+U+"InDblClickWindow"]?(Z=!0,clearTimeout(this[U+"DblTimeout"])):a.DD.justDragged||(i.Konva["_"+U+"InDblClickWindow"]=!0,clearTimeout(this[U+"DblTimeout"])),this[U+"DblTimeout"]=setTimeout(function(){i.Konva["_"+U+"InDblClickWindow"]=!1},i.Konva.dblClickWindow),Fe&&Fe.isListening()?(Me=!0,this[U+"ClickEndShape"]=Fe,Fe._fireAndBubble(N.pointerup,{...$e}),i.Konva["_"+U+"ListenClick"]&&ie&&ie===Fe&&(Fe._fireAndBubble(N.pointerclick,{...$e}),Z&&ue&&ue===Fe&&Fe._fireAndBubble(N.pointerdblclick,{...$e}))):(this[U+"ClickEndShape"]=null,i.Konva["_"+U+"ListenClick"]&&this._fire(N.pointerclick,{evt:$,target:this,currentTarget:this,pointerId:nt}),Z&&this._fire(N.pointerdblclick,{evt:$,target:this,currentTarget:this,pointerId:nt}))}),Me||this._fire(N.pointerup,{evt:$,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),i.Konva["_"+U+"ListenClick"]=!1,$.cancelable&&U!=="touch"&&$.preventDefault()}_contextmenu($){this.setPointersPositions($);var N=this.getIntersection(this.getPointerPosition());N&&N.isListening()?N._fireAndBubble(F,{evt:$}):this._fire(F,{evt:$,target:this,currentTarget:this})}_wheel($){this.setPointersPositions($);var N=this.getIntersection(this.getPointerPosition());N&&N.isListening()?N._fireAndBubble(z,{evt:$}):this._fire(z,{evt:$,target:this,currentTarget:this})}_pointercancel($){this.setPointersPositions($);const N=c.getCapturedShape($.pointerId)||this.getIntersection(this.getPointerPosition());N&&N._fireAndBubble(S,c.createEvent($)),c.releaseCapture($.pointerId)}_lostpointercapture($){c.releaseCapture($.pointerId)}setPointersPositions($){var N=this._getContentPosition(),U=null,ie=null;$=$||window.event,$.touches!==void 0?(this._pointerPositions=[],this._changedPointerPositions=[],Array.prototype.forEach.call($.touches,ue=>{this._pointerPositions.push({id:ue.identifier,x:(ue.clientX-N.left)/N.scaleX,y:(ue.clientY-N.top)/N.scaleY})}),Array.prototype.forEach.call($.changedTouches||$.touches,ue=>{this._changedPointerPositions.push({id:ue.identifier,x:(ue.clientX-N.left)/N.scaleX,y:(ue.clientY-N.top)/N.scaleY})})):(U=($.clientX-N.left)/N.scaleX,ie=($.clientY-N.top)/N.scaleY,this.pointerPos={x:U,y:ie},this._pointerPositions=[{x:U,y:ie,id:t.Util._getFirstPointerId($)}],this._changedPointerPositions=[{x:U,y:ie,id:t.Util._getFirstPointerId($)}])}_setPointerPosition($){t.Util.warn('Method _setPointerPosition is deprecated. Use "stage.setPointersPositions(event)" instead.'),this.setPointersPositions($)}_getContentPosition(){if(!this.content||!this.content.getBoundingClientRect)return{top:0,left:0,scaleX:1,scaleY:1};var $=this.content.getBoundingClientRect();return{top:$.top,left:$.left,scaleX:$.width/this.content.clientWidth||1,scaleY:$.height/this.content.clientHeight||1}}_buildDOM(){if(this.bufferCanvas=new o.SceneCanvas({width:this.width(),height:this.height()}),this.bufferHitCanvas=new o.HitCanvas({pixelRatio:1,width:this.width(),height:this.height()}),!!i.Konva.isBrowser){var $=this.container();if(!$)throw"Stage has no container. A container is required.";$.innerHTML="",this.content=document.createElement("div"),this.content.style.position="relative",this.content.style.userSelect="none",this.content.className="konvajs-content",this.content.setAttribute("role","presentation"),$.appendChild(this.content),this._resizeDOM()}}cache(){return t.Util.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes."),this}clearCache(){return this}batchDraw(){return this.getChildren().forEach(function($){$.batchDraw()}),this}}e.Stage=W,W.prototype.nodeType=d,(0,l._registerNode)(W),n.Factory.addGetterSetter(W,"container"),i.Konva.isBrowser&&document.addEventListener("visibilitychange",()=>{e.stages.forEach(Y=>{Y.batchDraw()})})}(av)),av}var sh={},lv={},w6;function as(){return w6||(w6=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Shape=e.shapes=void 0;const t=St(),n=En(),s=jt(),i=Ln(),o=_t(),a=St(),l=j9();var c="hasShadow",d="shadowRGBA",h="patternImage",f="linearGradient",p="radialGradient";let g;function m(){return g||(g=n.Util.createCanvasElement().getContext("2d"),g)}e.shapes={};function y(D){const M=this.attrs.fillRule;M?D.fill(M):D.fill()}function b(D){D.stroke()}function C(D){const M=this.attrs.fillRule;M?D.fill(M):D.fill()}function x(D){D.stroke()}function v(){this._clearCache(c)}function w(){this._clearCache(d)}function S(){this._clearCache(h)}function j(){this._clearCache(f)}function P(){this._clearCache(p)}class E extends i.Node{constructor(M){super(M);let R;for(;R=n.Util.getRandomColor(),!(R&&!(R in e.shapes)););this.colorKey=R,e.shapes[R]=this}getContext(){return n.Util.warn("shape.getContext() method is deprecated. Please do not use it."),this.getLayer().getContext()}getCanvas(){return n.Util.warn("shape.getCanvas() method is deprecated. Please do not use it."),this.getLayer().getCanvas()}getSceneFunc(){return this.attrs.sceneFunc||this._sceneFunc}getHitFunc(){return this.attrs.hitFunc||this._hitFunc}hasShadow(){return this._getCache(c,this._hasShadow)}_hasShadow(){return this.shadowEnabled()&&this.shadowOpacity()!==0&&!!(this.shadowColor()||this.shadowBlur()||this.shadowOffsetX()||this.shadowOffsetY())}_getFillPattern(){return this._getCache(h,this.__getFillPattern)}__getFillPattern(){if(this.fillPatternImage()){var M=m();const R=M.createPattern(this.fillPatternImage(),this.fillPatternRepeat()||"repeat");if(R&&R.setTransform){const F=new n.Transform;F.translate(this.fillPatternX(),this.fillPatternY()),F.rotate(t.Konva.getAngle(this.fillPatternRotation())),F.scale(this.fillPatternScaleX(),this.fillPatternScaleY()),F.translate(-1*this.fillPatternOffsetX(),-1*this.fillPatternOffsetY());const _=F.getMatrix(),L=typeof DOMMatrix>"u"?{a:_[0],b:_[1],c:_[2],d:_[3],e:_[4],f:_[5]}:new DOMMatrix(_);R.setTransform(L)}return R}}_getLinearGradient(){return this._getCache(f,this.__getLinearGradient)}__getLinearGradient(){var M=this.fillLinearGradientColorStops();if(M){for(var R=m(),F=this.fillLinearGradientStartPoint(),_=this.fillLinearGradientEndPoint(),L=R.createLinearGradient(F.x,F.y,_.x,_.y),O=0;O<M.length;O+=2)L.addColorStop(M[O],M[O+1]);return L}}_getRadialGradient(){return this._getCache(p,this.__getRadialGradient)}__getRadialGradient(){var M=this.fillRadialGradientColorStops();if(M){for(var R=m(),F=this.fillRadialGradientStartPoint(),_=this.fillRadialGradientEndPoint(),L=R.createRadialGradient(F.x,F.y,this.fillRadialGradientStartRadius(),_.x,_.y,this.fillRadialGradientEndRadius()),O=0;O<M.length;O+=2)L.addColorStop(M[O],M[O+1]);return L}}getShadowRGBA(){return this._getCache(d,this._getShadowRGBA)}_getShadowRGBA(){if(this.hasShadow()){var M=n.Util.colorToRGBA(this.shadowColor());if(M)return"rgba("+M.r+","+M.g+","+M.b+","+M.a*(this.shadowOpacity()||1)+")"}}hasFill(){return this._calculate("hasFill",["fillEnabled","fill","fillPatternImage","fillLinearGradientColorStops","fillRadialGradientColorStops"],()=>this.fillEnabled()&&!!(this.fill()||this.fillPatternImage()||this.fillLinearGradientColorStops()||this.fillRadialGradientColorStops()))}hasStroke(){return this._calculate("hasStroke",["strokeEnabled","strokeWidth","stroke","strokeLinearGradientColorStops"],()=>this.strokeEnabled()&&this.strokeWidth()&&!!(this.stroke()||this.strokeLinearGradientColorStops()))}hasHitStroke(){const M=this.hitStrokeWidth();return M==="auto"?this.hasStroke():this.strokeEnabled()&&!!M}intersects(M){var R=this.getStage();if(!R)return!1;const F=R.bufferHitCanvas;return F.getContext().clear(),this.drawHit(F,void 0,!0),F.context.getImageData(Math.round(M.x),Math.round(M.y),1,1).data[3]>0}destroy(){return i.Node.prototype.destroy.call(this),delete e.shapes[this.colorKey],delete this.colorKey,this}_useBufferCanvas(M){var R;if(!((R=this.attrs.perfectDrawEnabled)!==null&&R!==void 0?R:!0))return!1;const _=M||this.hasFill(),L=this.hasStroke(),O=this.getAbsoluteOpacity()!==1;if(_&&L&&O)return!0;const B=this.hasShadow(),z=this.shadowForStrokeEnabled();return!!(_&&L&&B&&z)}setStrokeHitEnabled(M){n.Util.warn("strokeHitEnabled property is deprecated. Please use hitStrokeWidth instead."),M?this.hitStrokeWidth("auto"):this.hitStrokeWidth(0)}getStrokeHitEnabled(){return this.hitStrokeWidth()!==0}getSelfRect(){var M=this.size();return{x:this._centroid?-M.width/2:0,y:this._centroid?-M.height/2:0,width:M.width,height:M.height}}getClientRect(M={}){let R=!1,F=this.getParent();for(;F;){if(F.isCached()){R=!0;break}F=F.getParent()}const _=M.skipTransform,L=M.relativeTo||R&&this.getStage()||void 0,O=this.getSelfRect(),z=!M.skipStroke&&this.hasStroke()&&this.strokeWidth()||0,ee=O.width+z,ne=O.height+z,re=!M.skipShadow&&this.hasShadow(),te=re?this.shadowOffsetX():0,H=re?this.shadowOffsetY():0,V=ee+Math.abs(te),X=ne+Math.abs(H),W=re&&this.shadowBlur()||0,Y=V+W*2,$=X+W*2,N={width:Y,height:$,x:-(z/2+W)+Math.min(te,0)+O.x,y:-(z/2+W)+Math.min(H,0)+O.y};return _?N:this._transformedRect(N,L)}drawScene(M,R,F){var _=this.getLayer(),L=M||_.getCanvas(),O=L.getContext(),B=this._getCanvasCache(),z=this.getSceneFunc(),ee=this.hasShadow(),ne,re,te=L.isCache,H=R===this;if(!this.isVisible()&&!H)return this;if(B){O.save();var V=this.getAbsoluteTransform(R).getMatrix();return O.transform(V[0],V[1],V[2],V[3],V[4],V[5]),this._drawCachedSceneCanvas(O),O.restore(),this}if(!z)return this;if(O.save(),this._useBufferCanvas()&&!te){ne=this.getStage();const Y=F||ne.bufferCanvas;re=Y.getContext(),re.clear(),re.save(),re._applyLineJoin(this);var X=this.getAbsoluteTransform(R).getMatrix();re.transform(X[0],X[1],X[2],X[3],X[4],X[5]),z.call(this,re,this),re.restore();var W=Y.pixelRatio;ee&&O._applyShadow(this),O._applyOpacity(this),O._applyGlobalCompositeOperation(this),O.drawImage(Y._canvas,0,0,Y.width/W,Y.height/W)}else{if(O._applyLineJoin(this),!H){var X=this.getAbsoluteTransform(R).getMatrix();O.transform(X[0],X[1],X[2],X[3],X[4],X[5]),O._applyOpacity(this),O._applyGlobalCompositeOperation(this)}ee&&O._applyShadow(this),z.call(this,O,this)}return O.restore(),this}drawHit(M,R,F=!1){if(!this.shouldDrawHit(R,F))return this;var _=this.getLayer(),L=M||_.hitCanvas,O=L&&L.getContext(),B=this.hitFunc()||this.sceneFunc(),z=this._getCanvasCache(),ee=z&&z.hit;if(this.colorKey||n.Util.warn("Looks like your canvas has a destroyed shape in it. Do not reuse shape after you destroyed it. If you want to reuse shape you should call remove() instead of destroy()"),ee){O.save();var ne=this.getAbsoluteTransform(R).getMatrix();return O.transform(ne[0],ne[1],ne[2],ne[3],ne[4],ne[5]),this._drawCachedHitCanvas(O),O.restore(),this}if(!B)return this;if(O.save(),O._applyLineJoin(this),!(this===R)){var te=this.getAbsoluteTransform(R).getMatrix();O.transform(te[0],te[1],te[2],te[3],te[4],te[5])}return B.call(this,O,this),O.restore(),this}drawHitFromCache(M=0){var R=this._getCanvasCache(),F=this._getCachedSceneCanvas(),_=R.hit,L=_.getContext(),O=_.getWidth(),B=_.getHeight(),z,ee,ne,re,te,H;L.clear(),L.drawImage(F._canvas,0,0,O,B);try{for(z=L.getImageData(0,0,O,B),ee=z.data,ne=ee.length,re=n.Util._hexToRgb(this.colorKey),te=0;te<ne;te+=4)H=ee[te+3],H>M?(ee[te]=re.r,ee[te+1]=re.g,ee[te+2]=re.b,ee[te+3]=255):ee[te+3]=0;L.putImageData(z,0,0)}catch(V){n.Util.error("Unable to draw hit graph from cached scene canvas. "+V.message)}return this}hasPointerCapture(M){return l.hasPointerCapture(M,this)}setPointerCapture(M){l.setPointerCapture(M,this)}releaseCapture(M){l.releaseCapture(M,this)}}e.Shape=E,E.prototype._fillFunc=y,E.prototype._strokeFunc=b,E.prototype._fillFuncHit=C,E.prototype._strokeFuncHit=x,E.prototype._centroid=!1,E.prototype.nodeType="Shape",(0,a._registerNode)(E),E.prototype.eventListeners={},E.prototype.on.call(E.prototype,"shadowColorChange.konva shadowBlurChange.konva shadowOffsetChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",v),E.prototype.on.call(E.prototype,"shadowColorChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",w),E.prototype.on.call(E.prototype,"fillPriorityChange.konva fillPatternImageChange.konva fillPatternRepeatChange.konva fillPatternScaleXChange.konva fillPatternScaleYChange.konva fillPatternOffsetXChange.konva fillPatternOffsetYChange.konva fillPatternXChange.konva fillPatternYChange.konva fillPatternRotationChange.konva",S),E.prototype.on.call(E.prototype,"fillPriorityChange.konva fillLinearGradientColorStopsChange.konva fillLinearGradientStartPointXChange.konva fillLinearGradientStartPointYChange.konva fillLinearGradientEndPointXChange.konva fillLinearGradientEndPointYChange.konva",j),E.prototype.on.call(E.prototype,"fillPriorityChange.konva fillRadialGradientColorStopsChange.konva fillRadialGradientStartPointXChange.konva fillRadialGradientStartPointYChange.konva fillRadialGradientEndPointXChange.konva fillRadialGradientEndPointYChange.konva fillRadialGradientStartRadiusChange.konva fillRadialGradientEndRadiusChange.konva",P),s.Factory.addGetterSetter(E,"stroke",void 0,(0,o.getStringOrGradientValidator)()),s.Factory.addGetterSetter(E,"strokeWidth",2,(0,o.getNumberValidator)()),s.Factory.addGetterSetter(E,"fillAfterStrokeEnabled",!1),s.Factory.addGetterSetter(E,"hitStrokeWidth","auto",(0,o.getNumberOrAutoValidator)()),s.Factory.addGetterSetter(E,"strokeHitEnabled",!0,(0,o.getBooleanValidator)()),s.Factory.addGetterSetter(E,"perfectDrawEnabled",!0,(0,o.getBooleanValidator)()),s.Factory.addGetterSetter(E,"shadowForStrokeEnabled",!0,(0,o.getBooleanValidator)()),s.Factory.addGetterSetter(E,"lineJoin"),s.Factory.addGetterSetter(E,"lineCap"),s.Factory.addGetterSetter(E,"sceneFunc"),s.Factory.addGetterSetter(E,"hitFunc"),s.Factory.addGetterSetter(E,"dash"),s.Factory.addGetterSetter(E,"dashOffset",0,(0,o.getNumberValidator)()),s.Factory.addGetterSetter(E,"shadowColor",void 0,(0,o.getStringValidator)()),s.Factory.addGetterSetter(E,"shadowBlur",0,(0,o.getNumberValidator)()),s.Factory.addGetterSetter(E,"shadowOpacity",1,(0,o.getNumberValidator)()),s.Factory.addComponentsGetterSetter(E,"shadowOffset",["x","y"]),s.Factory.addGetterSetter(E,"shadowOffsetX",0,(0,o.getNumberValidator)()),s.Factory.addGetterSetter(E,"shadowOffsetY",0,(0,o.getNumberValidator)()),s.Factory.addGetterSetter(E,"fillPatternImage"),s.Factory.addGetterSetter(E,"fill",void 0,(0,o.getStringOrGradientValidator)()),s.Factory.addGetterSetter(E,"fillPatternX",0,(0,o.getNumberValidator)()),s.Factory.addGetterSetter(E,"fillPatternY",0,(0,o.getNumberValidator)()),s.Factory.addGetterSetter(E,"fillLinearGradientColorStops"),s.Factory.addGetterSetter(E,"strokeLinearGradientColorStops"),s.Factory.addGetterSetter(E,"fillRadialGradientStartRadius",0),s.Factory.addGetterSetter(E,"fillRadialGradientEndRadius",0),s.Factory.addGetterSetter(E,"fillRadialGradientColorStops"),s.Factory.addGetterSetter(E,"fillPatternRepeat","repeat"),s.Factory.addGetterSetter(E,"fillEnabled",!0),s.Factory.addGetterSetter(E,"strokeEnabled",!0),s.Factory.addGetterSetter(E,"shadowEnabled",!0),s.Factory.addGetterSetter(E,"dashEnabled",!0),s.Factory.addGetterSetter(E,"strokeScaleEnabled",!0),s.Factory.addGetterSetter(E,"fillPriority","color"),s.Factory.addComponentsGetterSetter(E,"fillPatternOffset",["x","y"]),s.Factory.addGetterSetter(E,"fillPatternOffsetX",0,(0,o.getNumberValidator)()),s.Factory.addGetterSetter(E,"fillPatternOffsetY",0,(0,o.getNumberValidator)()),s.Factory.addComponentsGetterSetter(E,"fillPatternScale",["x","y"]),s.Factory.addGetterSetter(E,"fillPatternScaleX",1,(0,o.getNumberValidator)()),s.Factory.addGetterSetter(E,"fillPatternScaleY",1,(0,o.getNumberValidator)()),s.Factory.addComponentsGetterSetter(E,"fillLinearGradientStartPoint",["x","y"]),s.Factory.addComponentsGetterSetter(E,"strokeLinearGradientStartPoint",["x","y"]),s.Factory.addGetterSetter(E,"fillLinearGradientStartPointX",0),s.Factory.addGetterSetter(E,"strokeLinearGradientStartPointX",0),s.Factory.addGetterSetter(E,"fillLinearGradientStartPointY",0),s.Factory.addGetterSetter(E,"strokeLinearGradientStartPointY",0),s.Factory.addComponentsGetterSetter(E,"fillLinearGradientEndPoint",["x","y"]),s.Factory.addComponentsGetterSetter(E,"strokeLinearGradientEndPoint",["x","y"]),s.Factory.addGetterSetter(E,"fillLinearGradientEndPointX",0),s.Factory.addGetterSetter(E,"strokeLinearGradientEndPointX",0),s.Factory.addGetterSetter(E,"fillLinearGradientEndPointY",0),s.Factory.addGetterSetter(E,"strokeLinearGradientEndPointY",0),s.Factory.addComponentsGetterSetter(E,"fillRadialGradientStartPoint",["x","y"]),s.Factory.addGetterSetter(E,"fillRadialGradientStartPointX",0),s.Factory.addGetterSetter(E,"fillRadialGradientStartPointY",0),s.Factory.addComponentsGetterSetter(E,"fillRadialGradientEndPoint",["x","y"]),s.Factory.addGetterSetter(E,"fillRadialGradientEndPointX",0),s.Factory.addGetterSetter(E,"fillRadialGradientEndPointY",0),s.Factory.addGetterSetter(E,"fillPatternRotation",0),s.Factory.addGetterSetter(E,"fillRule",void 0,(0,o.getStringValidator)()),s.Factory.backCompat(E,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"})}(lv)),lv}var S6;function k9(){if(S6)return sh;S6=1,Object.defineProperty(sh,"__esModule",{value:!0}),sh.Layer=void 0;const e=En(),t=jb(),n=Ln(),s=jt(),i=Sb(),o=_t(),a=as(),l=St();var c="#",d="beforeDraw",h="draw",f=[{x:0,y:0},{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],p=f.length;let g=class extends t.Container{constructor(y){super(y),this.canvas=new i.SceneCanvas,this.hitCanvas=new i.HitCanvas({pixelRatio:1}),this._waitingForDraw=!1,this.on("visibleChange.konva",this._checkVisibility),this._checkVisibility(),this.on("imageSmoothingEnabledChange.konva",this._setSmoothEnabled),this._setSmoothEnabled()}createPNGStream(){return this.canvas._canvas.createPNGStream()}getCanvas(){return this.canvas}getNativeCanvasElement(){return this.canvas._canvas}getHitCanvas(){return this.hitCanvas}getContext(){return this.getCanvas().getContext()}clear(y){return this.getContext().clear(y),this.getHitCanvas().getContext().clear(y),this}setZIndex(y){super.setZIndex(y);var b=this.getStage();return b&&b.content&&(b.content.removeChild(this.getNativeCanvasElement()),y<b.children.length-1?b.content.insertBefore(this.getNativeCanvasElement(),b.children[y+1].getCanvas()._canvas):b.content.appendChild(this.getNativeCanvasElement())),this}moveToTop(){n.Node.prototype.moveToTop.call(this);var y=this.getStage();return y&&y.content&&(y.content.removeChild(this.getNativeCanvasElement()),y.content.appendChild(this.getNativeCanvasElement())),!0}moveUp(){var y=n.Node.prototype.moveUp.call(this);if(!y)return!1;var b=this.getStage();return!b||!b.content?!1:(b.content.removeChild(this.getNativeCanvasElement()),this.index<b.children.length-1?b.content.insertBefore(this.getNativeCanvasElement(),b.children[this.index+1].getCanvas()._canvas):b.content.appendChild(this.getNativeCanvasElement()),!0)}moveDown(){if(n.Node.prototype.moveDown.call(this)){var y=this.getStage();if(y){var b=y.children;y.content&&(y.content.removeChild(this.getNativeCanvasElement()),y.content.insertBefore(this.getNativeCanvasElement(),b[this.index+1].getCanvas()._canvas))}return!0}return!1}moveToBottom(){if(n.Node.prototype.moveToBottom.call(this)){var y=this.getStage();if(y){var b=y.children;y.content&&(y.content.removeChild(this.getNativeCanvasElement()),y.content.insertBefore(this.getNativeCanvasElement(),b[1].getCanvas()._canvas))}return!0}return!1}getLayer(){return this}remove(){var y=this.getNativeCanvasElement();return n.Node.prototype.remove.call(this),y&&y.parentNode&&e.Util._isInDocument(y)&&y.parentNode.removeChild(y),this}getStage(){return this.parent}setSize({width:y,height:b}){return this.canvas.setSize(y,b),this.hitCanvas.setSize(y,b),this._setSmoothEnabled(),this}_validateAdd(y){var b=y.getType();b!=="Group"&&b!=="Shape"&&e.Util.throw("You may only add groups and shapes to a layer.")}_toKonvaCanvas(y){return y=y||{},y.width=y.width||this.getWidth(),y.height=y.height||this.getHeight(),y.x=y.x!==void 0?y.x:this.x(),y.y=y.y!==void 0?y.y:this.y(),n.Node.prototype._toKonvaCanvas.call(this,y)}_checkVisibility(){this.visible()?this.canvas._canvas.style.display="block":this.canvas._canvas.style.display="none"}_setSmoothEnabled(){this.getContext()._context.imageSmoothingEnabled=this.imageSmoothingEnabled()}getWidth(){if(this.parent)return this.parent.width()}setWidth(){e.Util.warn('Can not change width of layer. Use "stage.width(value)" function instead.')}getHeight(){if(this.parent)return this.parent.height()}setHeight(){e.Util.warn('Can not change height of layer. Use "stage.height(value)" function instead.')}batchDraw(){return this._waitingForDraw||(this._waitingForDraw=!0,e.Util.requestAnimFrame(()=>{this.draw(),this._waitingForDraw=!1})),this}getIntersection(y){if(!this.isListening()||!this.isVisible())return null;for(var b=1,C=!1;;){for(let x=0;x<p;x++){const v=f[x],w=this._getIntersection({x:y.x+v.x*b,y:y.y+v.y*b}),S=w.shape;if(S)return S;if(C=!!w.antialiased,!w.antialiased)break}if(C)b+=1;else return null}}_getIntersection(y){const b=this.hitCanvas.pixelRatio,C=this.hitCanvas.context.getImageData(Math.round(y.x*b),Math.round(y.y*b),1,1).data,x=C[3];if(x===255){const v=e.Util._rgbToHex(C[0],C[1],C[2]),w=a.shapes[c+v];return w?{shape:w}:{antialiased:!0}}else if(x>0)return{antialiased:!0};return{}}drawScene(y,b){var C=this.getLayer(),x=y||C&&C.getCanvas();return this._fire(d,{node:this}),this.clearBeforeDraw()&&x.getContext().clear(),t.Container.prototype.drawScene.call(this,x,b),this._fire(h,{node:this}),this}drawHit(y,b){var C=this.getLayer(),x=y||C&&C.hitCanvas;return C&&C.clearBeforeDraw()&&C.getHitCanvas().getContext().clear(),t.Container.prototype.drawHit.call(this,x,b),this}enableHitGraph(){return this.hitGraphEnabled(!0),this}disableHitGraph(){return this.hitGraphEnabled(!1),this}setHitGraphEnabled(y){e.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening(y)}getHitGraphEnabled(y){return e.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening()}toggleHitCanvas(){if(!(!this.parent||!this.parent.content)){var y=this.parent,b=!!this.hitCanvas._canvas.parentNode;b?y.content.removeChild(this.hitCanvas._canvas):y.content.appendChild(this.hitCanvas._canvas)}}destroy(){return e.Util.releaseCanvas(this.getNativeCanvasElement(),this.getHitCanvas()._canvas),super.destroy()}};return sh.Layer=g,g.prototype.nodeType="Layer",(0,l._registerNode)(g),s.Factory.addGetterSetter(g,"imageSmoothingEnabled",!0),s.Factory.addGetterSetter(g,"clearBeforeDraw",!0),s.Factory.addGetterSetter(g,"hitGraphEnabled",!0,(0,o.getBooleanValidator)()),sh}var rh={},j6;function Tpe(){if(j6)return rh;j6=1,Object.defineProperty(rh,"__esModule",{value:!0}),rh.FastLayer=void 0;const e=En(),t=k9(),n=St();let s=class extends t.Layer{constructor(o){super(o),this.listening(!1),e.Util.warn('Konva.Fast layer is deprecated. Please use "new Konva.Layer({ listening: false })" instead.')}};return rh.FastLayer=s,s.prototype.nodeType="FastLayer",(0,n._registerNode)(s),rh}var ih={},k6;function fk(){if(k6)return ih;k6=1,Object.defineProperty(ih,"__esModule",{value:!0}),ih.Group=void 0;const e=En(),t=jb(),n=St();let s=class extends t.Container{_validateAdd(o){var a=o.getType();a!=="Group"&&a!=="Shape"&&e.Util.throw("You may only add groups and shapes to groups.")}};return ih.Group=s,s.prototype.nodeType="Group",(0,n._registerNode)(s),ih}var oh={},_6;function pk(){if(_6)return oh;_6=1,Object.defineProperty(oh,"__esModule",{value:!0}),oh.Animation=void 0;const e=St(),t=En(),n=function(){return e.glob.performance&&e.glob.performance.now?function(){return e.glob.performance.now()}:function(){return new Date().getTime()}}();let s=class Yc{constructor(o,a){this.id=Yc.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:n(),frameRate:0},this.func=o,this.setLayers(a)}setLayers(o){let a=[];return o&&(a=Array.isArray(o)?o:[o]),this.layers=a,this}getLayers(){return this.layers}addLayer(o){const a=this.layers,l=a.length;for(let c=0;c<l;c++)if(a[c]._id===o._id)return!1;return this.layers.push(o),!0}isRunning(){const a=Yc.animations,l=a.length;for(let c=0;c<l;c++)if(a[c].id===this.id)return!0;return!1}start(){return this.stop(),this.frame.timeDiff=0,this.frame.lastTime=n(),Yc._addAnimation(this),this}stop(){return Yc._removeAnimation(this),this}_updateFrameObject(o){this.frame.timeDiff=o-this.frame.lastTime,this.frame.lastTime=o,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}static _addAnimation(o){this.animations.push(o),this._handleAnimation()}static _removeAnimation(o){const a=o.id,l=this.animations,c=l.length;for(let d=0;d<c;d++)if(l[d].id===a){this.animations.splice(d,1);break}}static _runFrames(){const o={},a=this.animations;for(let l=0;l<a.length;l++){const c=a[l],d=c.layers,h=c.func;c._updateFrameObject(n());const f=d.length;let p;if(h?p=h.call(c,c.frame)!==!1:p=!0,!!p)for(let g=0;g<f;g++){const m=d[g];m._id!==void 0&&(o[m._id]=m)}}for(let l in o)o.hasOwnProperty(l)&&o[l].batchDraw()}static _animationLoop(){const o=Yc;o.animations.length?(o._runFrames(),t.Util.requestAnimFrame(o._animationLoop)):o.animRunning=!1}static _handleAnimation(){this.animRunning||(this.animRunning=!0,t.Util.requestAnimFrame(this._animationLoop))}};return oh.Animation=s,s.animations=[],s.animIdCounter=0,s.animRunning=!1,oh}var cv={},I6;function Ape(){return I6||(I6=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Easings=e.Tween=void 0;const t=En(),n=pk(),s=Ln(),i=St();var o={node:1,duration:1,easing:1,onFinish:1,yoyo:1},a=1,l=2,c=3,d=0,h=["fill","stroke","shadowColor"];class f{constructor(m,y,b,C,x,v,w){this.prop=m,this.propFunc=y,this.begin=C,this._pos=C,this.duration=v,this._change=0,this.prevPos=0,this.yoyo=w,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=b,this._change=x-this.begin,this.pause()}fire(m){var y=this[m];y&&y()}setTime(m){m>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():m<0?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=m,this.update())}getTime(){return this._time}setPosition(m){this.prevPos=this._pos,this.propFunc(m),this._pos=m}getPosition(m){return m===void 0&&(m=this._time),this.func(m,this.begin,this._change,this.duration)}play(){this.state=l,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")}reverse(){this.state=c,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")}seek(m){this.pause(),this._time=m,this.update(),this.fire("onSeek")}reset(){this.pause(),this._time=0,this.update(),this.fire("onReset")}finish(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")}update(){this.setPosition(this.getPosition(this._time)),this.fire("onUpdate")}onEnterFrame(){var m=this.getTimer()-this._startTime;this.state===l?this.setTime(m):this.state===c&&this.setTime(this.duration-m)}pause(){this.state=a,this.fire("onPause")}getTimer(){return new Date().getTime()}}class p{constructor(m){var y=this,b=m.node,C=b._id,x,v=m.easing||e.Easings.Linear,w=!!m.yoyo,S;typeof m.duration>"u"?x=.3:m.duration===0?x=.001:x=m.duration,this.node=b,this._id=d++;var j=b.getLayer()||(b instanceof i.Konva.Stage?b.getLayers():null);j||t.Util.error("Tween constructor have `node` that is not in a layer. Please add node into layer first."),this.anim=new n.Animation(function(){y.tween.onEnterFrame()},j),this.tween=new f(S,function(P){y._tweenFunc(P)},v,0,1,x*1e3,w),this._addListeners(),p.attrs[C]||(p.attrs[C]={}),p.attrs[C][this._id]||(p.attrs[C][this._id]={}),p.tweens[C]||(p.tweens[C]={});for(S in m)o[S]===void 0&&this._addAttr(S,m[S]);this.reset(),this.onFinish=m.onFinish,this.onReset=m.onReset,this.onUpdate=m.onUpdate}_addAttr(m,y){var b=this.node,C=b._id,x,v,w,S,j,P,E,D;if(w=p.tweens[C][m],w&&delete p.attrs[C][w][m],x=b.getAttr(m),t.Util._isArray(y))if(v=[],j=Math.max(y.length,x.length),m==="points"&&y.length!==x.length&&(y.length>x.length?(E=x,x=t.Util._prepareArrayForTween(x,y,b.closed())):(P=y,y=t.Util._prepareArrayForTween(y,x,b.closed()))),m.indexOf("fill")===0)for(S=0;S<j;S++)if(S%2===0)v.push(y[S]-x[S]);else{var M=t.Util.colorToRGBA(x[S]);D=t.Util.colorToRGBA(y[S]),x[S]=M,v.push({r:D.r-M.r,g:D.g-M.g,b:D.b-M.b,a:D.a-M.a})}else for(S=0;S<j;S++)v.push(y[S]-x[S]);else h.indexOf(m)!==-1?(x=t.Util.colorToRGBA(x),D=t.Util.colorToRGBA(y),v={r:D.r-x.r,g:D.g-x.g,b:D.b-x.b,a:D.a-x.a}):v=y-x;p.attrs[C][this._id][m]={start:x,diff:v,end:y,trueEnd:P,trueStart:E},p.tweens[C][m]=this._id}_tweenFunc(m){var y=this.node,b=p.attrs[y._id][this._id],C,x,v,w,S,j,P,E;for(C in b){if(x=b[C],v=x.start,w=x.diff,E=x.end,t.Util._isArray(v))if(S=[],P=Math.max(v.length,E.length),C.indexOf("fill")===0)for(j=0;j<P;j++)j%2===0?S.push((v[j]||0)+w[j]*m):S.push("rgba("+Math.round(v[j].r+w[j].r*m)+","+Math.round(v[j].g+w[j].g*m)+","+Math.round(v[j].b+w[j].b*m)+","+(v[j].a+w[j].a*m)+")");else for(j=0;j<P;j++)S.push((v[j]||0)+w[j]*m);else h.indexOf(C)!==-1?S="rgba("+Math.round(v.r+w.r*m)+","+Math.round(v.g+w.g*m)+","+Math.round(v.b+w.b*m)+","+(v.a+w.a*m)+")":S=v+w*m;y.setAttr(C,S)}}_addListeners(){this.tween.onPlay=()=>{this.anim.start()},this.tween.onReverse=()=>{this.anim.start()},this.tween.onPause=()=>{this.anim.stop()},this.tween.onFinish=()=>{var m=this.node,y=p.attrs[m._id][this._id];y.points&&y.points.trueEnd&&m.setAttr("points",y.points.trueEnd),this.onFinish&&this.onFinish.call(this)},this.tween.onReset=()=>{var m=this.node,y=p.attrs[m._id][this._id];y.points&&y.points.trueStart&&m.points(y.points.trueStart),this.onReset&&this.onReset()},this.tween.onUpdate=()=>{this.onUpdate&&this.onUpdate.call(this)}}play(){return this.tween.play(),this}reverse(){return this.tween.reverse(),this}reset(){return this.tween.reset(),this}seek(m){return this.tween.seek(m*1e3),this}pause(){return this.tween.pause(),this}finish(){return this.tween.finish(),this}destroy(){var m=this.node._id,y=this._id,b=p.tweens[m],C;this.pause();for(C in b)delete p.tweens[m][C];delete p.attrs[m][y]}}e.Tween=p,p.attrs={},p.tweens={},s.Node.prototype.to=function(g){var m=g.onFinish;g.node=this,g.onFinish=function(){this.destroy(),m&&m()};var y=new p(g);y.play()},e.Easings={BackEaseIn(g,m,y,b){var C=1.70158;return y*(g/=b)*g*((C+1)*g-C)+m},BackEaseOut(g,m,y,b){var C=1.70158;return y*((g=g/b-1)*g*((C+1)*g+C)+1)+m},BackEaseInOut(g,m,y,b){var C=1.70158;return(g/=b/2)<1?y/2*(g*g*(((C*=1.525)+1)*g-C))+m:y/2*((g-=2)*g*(((C*=1.525)+1)*g+C)+2)+m},ElasticEaseIn(g,m,y,b,C,x){var v=0;return g===0?m:(g/=b)===1?m+y:(x||(x=b*.3),!C||C<Math.abs(y)?(C=y,v=x/4):v=x/(2*Math.PI)*Math.asin(y/C),-(C*Math.pow(2,10*(g-=1))*Math.sin((g*b-v)*(2*Math.PI)/x))+m)},ElasticEaseOut(g,m,y,b,C,x){var v=0;return g===0?m:(g/=b)===1?m+y:(x||(x=b*.3),!C||C<Math.abs(y)?(C=y,v=x/4):v=x/(2*Math.PI)*Math.asin(y/C),C*Math.pow(2,-10*g)*Math.sin((g*b-v)*(2*Math.PI)/x)+y+m)},ElasticEaseInOut(g,m,y,b,C,x){var v=0;return g===0?m:(g/=b/2)===2?m+y:(x||(x=b*(.3*1.5)),!C||C<Math.abs(y)?(C=y,v=x/4):v=x/(2*Math.PI)*Math.asin(y/C),g<1?-.5*(C*Math.pow(2,10*(g-=1))*Math.sin((g*b-v)*(2*Math.PI)/x))+m:C*Math.pow(2,-10*(g-=1))*Math.sin((g*b-v)*(2*Math.PI)/x)*.5+y+m)},BounceEaseOut(g,m,y,b){return(g/=b)<1/2.75?y*(7.5625*g*g)+m:g<2/2.75?y*(7.5625*(g-=1.5/2.75)*g+.75)+m:g<2.5/2.75?y*(7.5625*(g-=2.25/2.75)*g+.9375)+m:y*(7.5625*(g-=2.625/2.75)*g+.984375)+m},BounceEaseIn(g,m,y,b){return y-e.Easings.BounceEaseOut(b-g,0,y,b)+m},BounceEaseInOut(g,m,y,b){return g<b/2?e.Easings.BounceEaseIn(g*2,0,y,b)*.5+m:e.Easings.BounceEaseOut(g*2-b,0,y,b)*.5+y*.5+m},EaseIn(g,m,y,b){return y*(g/=b)*g+m},EaseOut(g,m,y,b){return-y*(g/=b)*(g-2)+m},EaseInOut(g,m,y,b){return(g/=b/2)<1?y/2*g*g+m:-y/2*(--g*(g-2)-1)+m},StrongEaseIn(g,m,y,b){return y*(g/=b)*g*g*g*g+m},StrongEaseOut(g,m,y,b){return y*((g=g/b-1)*g*g*g*g+1)+m},StrongEaseInOut(g,m,y,b){return(g/=b/2)<1?y/2*g*g*g*g*g+m:y/2*((g-=2)*g*g*g*g+2)+m},Linear(g,m,y,b){return y*g/b+m}}}(cv)),cv}var T6;function Epe(){return T6||(T6=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Konva=void 0;const t=St(),n=En(),s=Ln(),i=jb(),o=Ipe(),a=k9(),l=Tpe(),c=fk(),d=hk(),h=as(),f=pk(),p=Ape(),g=S9(),m=Sb();e.Konva=n.Util._assign(t.Konva,{Util:n.Util,Transform:n.Transform,Node:s.Node,Container:i.Container,Stage:o.Stage,stages:o.stages,Layer:a.Layer,FastLayer:l.FastLayer,Group:c.Group,DD:d.DD,Shape:h.Shape,shapes:h.shapes,Animation:f.Animation,Tween:p.Tween,Easings:p.Easings,Context:g.Context,Canvas:m.Canvas}),e.default=e.Konva}(nv)),nv}var ah={},A6;function Mpe(){if(A6)return ah;A6=1,Object.defineProperty(ah,"__esModule",{value:!0}),ah.Arc=void 0;const e=jt(),t=as(),n=St(),s=_t(),i=St();let o=class extends t.Shape{_sceneFunc(l){var c=n.Konva.getAngle(this.angle()),d=this.clockwise();l.beginPath(),l.arc(0,0,this.outerRadius(),0,c,d),l.arc(0,0,this.innerRadius(),c,0,!d),l.closePath(),l.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(l){this.outerRadius(l/2)}setHeight(l){this.outerRadius(l/2)}getSelfRect(){const l=this.innerRadius(),c=this.outerRadius(),d=this.clockwise(),h=n.Konva.getAngle(d?360-this.angle():this.angle()),f=Math.cos(Math.min(h,Math.PI)),p=1,g=Math.sin(Math.min(Math.max(Math.PI,h),3*Math.PI/2)),m=Math.sin(Math.min(h,Math.PI/2)),y=f*(f>0?l:c),b=p*c,C=g*(g>0?l:c),x=m*(m>0?c:l);return{x:y,y:d?-1*x:C,width:b-y,height:x-C}}};return ah.Arc=o,o.prototype._centroid=!0,o.prototype.className="Arc",o.prototype._attrsAffectingSize=["innerRadius","outerRadius"],(0,i._registerNode)(o),e.Factory.addGetterSetter(o,"innerRadius",0,(0,s.getNumberValidator)()),e.Factory.addGetterSetter(o,"outerRadius",0,(0,s.getNumberValidator)()),e.Factory.addGetterSetter(o,"angle",0,(0,s.getNumberValidator)()),e.Factory.addGetterSetter(o,"clockwise",!1,(0,s.getBooleanValidator)()),ah}var lh={},ch={},E6;function _9(){if(E6)return ch;E6=1,Object.defineProperty(ch,"__esModule",{value:!0}),ch.Line=void 0;const e=jt(),t=as(),n=_t(),s=St();function i(l,c,d,h,f,p,g){var m=Math.sqrt(Math.pow(d-l,2)+Math.pow(h-c,2)),y=Math.sqrt(Math.pow(f-d,2)+Math.pow(p-h,2)),b=g*m/(m+y),C=g*y/(m+y),x=d-b*(f-l),v=h-b*(p-c),w=d+C*(f-l),S=h+C*(p-c);return[x,v,w,S]}function o(l,c){var d=l.length,h=[],f,p;for(f=2;f<d-2;f+=2)p=i(l[f-2],l[f-1],l[f],l[f+1],l[f+2],l[f+3],c),!isNaN(p[0])&&(h.push(p[0]),h.push(p[1]),h.push(l[f]),h.push(l[f+1]),h.push(p[2]),h.push(p[3]));return h}let a=class extends t.Shape{constructor(c){super(c),this.on("pointsChange.konva tensionChange.konva closedChange.konva bezierChange.konva",function(){this._clearCache("tensionPoints")})}_sceneFunc(c){var d=this.points(),h=d.length,f=this.tension(),p=this.closed(),g=this.bezier(),m,y,b;if(h){if(c.beginPath(),c.moveTo(d[0],d[1]),f!==0&&h>4){for(m=this.getTensionPoints(),y=m.length,b=p?0:4,p||c.quadraticCurveTo(m[0],m[1],m[2],m[3]);b<y-2;)c.bezierCurveTo(m[b++],m[b++],m[b++],m[b++],m[b++],m[b++]);p||c.quadraticCurveTo(m[y-2],m[y-1],d[h-2],d[h-1])}else if(g)for(b=2;b<h;)c.bezierCurveTo(d[b++],d[b++],d[b++],d[b++],d[b++],d[b++]);else for(b=2;b<h;b+=2)c.lineTo(d[b],d[b+1]);p?(c.closePath(),c.fillStrokeShape(this)):c.strokeShape(this)}}getTensionPoints(){return this._getCache("tensionPoints",this._getTensionPoints)}_getTensionPoints(){return this.closed()?this._getTensionPointsClosed():o(this.points(),this.tension())}_getTensionPointsClosed(){var c=this.points(),d=c.length,h=this.tension(),f=i(c[d-2],c[d-1],c[0],c[1],c[2],c[3],h),p=i(c[d-4],c[d-3],c[d-2],c[d-1],c[0],c[1],h),g=o(c,h),m=[f[2],f[3]].concat(g).concat([p[0],p[1],c[d-2],c[d-1],p[2],p[3],f[0],f[1],c[0],c[1]]);return m}getWidth(){return this.getSelfRect().width}getHeight(){return this.getSelfRect().height}getSelfRect(){var c=this.points();if(c.length<4)return{x:c[0]||0,y:c[1]||0,width:0,height:0};this.tension()!==0?c=[c[0],c[1],...this._getTensionPoints(),c[c.length-2],c[c.length-1]]:c=this.points();for(var d=c[0],h=c[0],f=c[1],p=c[1],g,m,y=0;y<c.length/2;y++)g=c[y*2],m=c[y*2+1],d=Math.min(d,g),h=Math.max(h,g),f=Math.min(f,m),p=Math.max(p,m);return{x:d,y:f,width:h-d,height:p-f}}};return ch.Line=a,a.prototype.className="Line",a.prototype._attrsAffectingSize=["points","bezier","tension"],(0,s._registerNode)(a),e.Factory.addGetterSetter(a,"closed",!1),e.Factory.addGetterSetter(a,"bezier",!1),e.Factory.addGetterSetter(a,"tension",0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(a,"points",[],(0,n.getNumberArrayValidator)()),ch}var uh={},uv={},M6;function Ppe(){return M6||(M6=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.t2length=e.getQuadraticArcLength=e.getCubicArcLength=e.binomialCoefficients=e.cValues=e.tValues=void 0,e.tValues=[[],[],[-.5773502691896257,.5773502691896257],[0,-.7745966692414834,.7745966692414834],[-.33998104358485626,.33998104358485626,-.8611363115940526,.8611363115940526],[0,-.5384693101056831,.5384693101056831,-.906179845938664,.906179845938664],[.6612093864662645,-.6612093864662645,-.2386191860831969,.2386191860831969,-.932469514203152,.932469514203152],[0,.4058451513773972,-.4058451513773972,-.7415311855993945,.7415311855993945,-.9491079123427585,.9491079123427585],[-.1834346424956498,.1834346424956498,-.525532409916329,.525532409916329,-.7966664774136267,.7966664774136267,-.9602898564975363,.9602898564975363],[0,-.8360311073266358,.8360311073266358,-.9681602395076261,.9681602395076261,-.3242534234038089,.3242534234038089,-.6133714327005904,.6133714327005904],[-.14887433898163122,.14887433898163122,-.4333953941292472,.4333953941292472,-.6794095682990244,.6794095682990244,-.8650633666889845,.8650633666889845,-.9739065285171717,.9739065285171717],[0,-.26954315595234496,.26954315595234496,-.5190961292068118,.5190961292068118,-.7301520055740494,.7301520055740494,-.8870625997680953,.8870625997680953,-.978228658146057,.978228658146057],[-.1252334085114689,.1252334085114689,-.3678314989981802,.3678314989981802,-.5873179542866175,.5873179542866175,-.7699026741943047,.7699026741943047,-.9041172563704749,.9041172563704749,-.9815606342467192,.9815606342467192],[0,-.2304583159551348,.2304583159551348,-.44849275103644687,.44849275103644687,-.6423493394403402,.6423493394403402,-.8015780907333099,.8015780907333099,-.9175983992229779,.9175983992229779,-.9841830547185881,.9841830547185881],[-.10805494870734367,.10805494870734367,-.31911236892788974,.31911236892788974,-.5152486363581541,.5152486363581541,-.6872929048116855,.6872929048116855,-.827201315069765,.827201315069765,-.9284348836635735,.9284348836635735,-.9862838086968123,.9862838086968123],[0,-.20119409399743451,.20119409399743451,-.3941513470775634,.3941513470775634,-.5709721726085388,.5709721726085388,-.7244177313601701,.7244177313601701,-.8482065834104272,.8482065834104272,-.937273392400706,.937273392400706,-.9879925180204854,.9879925180204854],[-.09501250983763744,.09501250983763744,-.2816035507792589,.2816035507792589,-.45801677765722737,.45801677765722737,-.6178762444026438,.6178762444026438,-.755404408355003,.755404408355003,-.8656312023878318,.8656312023878318,-.9445750230732326,.9445750230732326,-.9894009349916499,.9894009349916499],[0,-.17848418149584785,.17848418149584785,-.3512317634538763,.3512317634538763,-.5126905370864769,.5126905370864769,-.6576711592166907,.6576711592166907,-.7815140038968014,.7815140038968014,-.8802391537269859,.8802391537269859,-.9506755217687678,.9506755217687678,-.9905754753144174,.9905754753144174],[-.0847750130417353,.0847750130417353,-.2518862256915055,.2518862256915055,-.41175116146284263,.41175116146284263,-.5597708310739475,.5597708310739475,-.6916870430603532,.6916870430603532,-.8037049589725231,.8037049589725231,-.8926024664975557,.8926024664975557,-.9558239495713977,.9558239495713977,-.9915651684209309,.9915651684209309],[0,-.16035864564022537,.16035864564022537,-.31656409996362983,.31656409996362983,-.46457074137596094,.46457074137596094,-.600545304661681,.600545304661681,-.7209661773352294,.7209661773352294,-.8227146565371428,.8227146565371428,-.9031559036148179,.9031559036148179,-.96020815213483,.96020815213483,-.9924068438435844,.9924068438435844],[-.07652652113349734,.07652652113349734,-.22778585114164507,.22778585114164507,-.37370608871541955,.37370608871541955,-.5108670019508271,.5108670019508271,-.636053680726515,.636053680726515,-.7463319064601508,.7463319064601508,-.8391169718222188,.8391169718222188,-.912234428251326,.912234428251326,-.9639719272779138,.9639719272779138,-.9931285991850949,.9931285991850949],[0,-.1455618541608951,.1455618541608951,-.2880213168024011,.2880213168024011,-.4243421202074388,.4243421202074388,-.5516188358872198,.5516188358872198,-.6671388041974123,.6671388041974123,-.7684399634756779,.7684399634756779,-.8533633645833173,.8533633645833173,-.9200993341504008,.9200993341504008,-.9672268385663063,.9672268385663063,-.9937521706203895,.9937521706203895],[-.06973927331972223,.06973927331972223,-.20786042668822127,.20786042668822127,-.34193582089208424,.34193582089208424,-.469355837986757,.469355837986757,-.5876404035069116,.5876404035069116,-.6944872631866827,.6944872631866827,-.7878168059792081,.7878168059792081,-.8658125777203002,.8658125777203002,-.926956772187174,.926956772187174,-.9700604978354287,.9700604978354287,-.9942945854823992,.9942945854823992],[0,-.1332568242984661,.1332568242984661,-.26413568097034495,.26413568097034495,-.3903010380302908,.3903010380302908,-.5095014778460075,.5095014778460075,-.6196098757636461,.6196098757636461,-.7186613631319502,.7186613631319502,-.8048884016188399,.8048884016188399,-.8767523582704416,.8767523582704416,-.9329710868260161,.9329710868260161,-.9725424712181152,.9725424712181152,-.9947693349975522,.9947693349975522],[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213]],e.cValues=[[],[],[1,1],[.8888888888888888,.5555555555555556,.5555555555555556],[.6521451548625461,.6521451548625461,.34785484513745385,.34785484513745385],[.5688888888888889,.47862867049936647,.47862867049936647,.23692688505618908,.23692688505618908],[.3607615730481386,.3607615730481386,.46791393457269104,.46791393457269104,.17132449237917036,.17132449237917036],[.4179591836734694,.3818300505051189,.3818300505051189,.27970539148927664,.27970539148927664,.1294849661688697,.1294849661688697],[.362683783378362,.362683783378362,.31370664587788727,.31370664587788727,.22238103445337448,.22238103445337448,.10122853629037626,.10122853629037626],[.3302393550012598,.1806481606948574,.1806481606948574,.08127438836157441,.08127438836157441,.31234707704000286,.31234707704000286,.26061069640293544,.26061069640293544],[.29552422471475287,.29552422471475287,.26926671930999635,.26926671930999635,.21908636251598204,.21908636251598204,.1494513491505806,.1494513491505806,.06667134430868814,.06667134430868814],[.2729250867779006,.26280454451024665,.26280454451024665,.23319376459199048,.23319376459199048,.18629021092773426,.18629021092773426,.1255803694649046,.1255803694649046,.05566856711617366,.05566856711617366],[.24914704581340277,.24914704581340277,.2334925365383548,.2334925365383548,.20316742672306592,.20316742672306592,.16007832854334622,.16007832854334622,.10693932599531843,.10693932599531843,.04717533638651183,.04717533638651183],[.2325515532308739,.22628318026289723,.22628318026289723,.2078160475368885,.2078160475368885,.17814598076194574,.17814598076194574,.13887351021978725,.13887351021978725,.09212149983772845,.09212149983772845,.04048400476531588,.04048400476531588],[.2152638534631578,.2152638534631578,.2051984637212956,.2051984637212956,.18553839747793782,.18553839747793782,.15720316715819355,.15720316715819355,.12151857068790319,.12151857068790319,.08015808715976021,.08015808715976021,.03511946033175186,.03511946033175186],[.2025782419255613,.19843148532711158,.19843148532711158,.1861610000155622,.1861610000155622,.16626920581699392,.16626920581699392,.13957067792615432,.13957067792615432,.10715922046717194,.10715922046717194,.07036604748810812,.07036604748810812,.03075324199611727,.03075324199611727],[.1894506104550685,.1894506104550685,.18260341504492358,.18260341504492358,.16915651939500254,.16915651939500254,.14959598881657674,.14959598881657674,.12462897125553388,.12462897125553388,.09515851168249279,.09515851168249279,.062253523938647894,.062253523938647894,.027152459411754096,.027152459411754096],[.17944647035620653,.17656270536699264,.17656270536699264,.16800410215645004,.16800410215645004,.15404576107681028,.15404576107681028,.13513636846852548,.13513636846852548,.11188384719340397,.11188384719340397,.08503614831717918,.08503614831717918,.0554595293739872,.0554595293739872,.02414830286854793,.02414830286854793],[.1691423829631436,.1691423829631436,.16427648374583273,.16427648374583273,.15468467512626524,.15468467512626524,.14064291467065065,.14064291467065065,.12255520671147846,.12255520671147846,.10094204410628717,.10094204410628717,.07642573025488905,.07642573025488905,.0497145488949698,.0497145488949698,.02161601352648331,.02161601352648331],[.1610544498487837,.15896884339395434,.15896884339395434,.15276604206585967,.15276604206585967,.1426067021736066,.1426067021736066,.12875396253933621,.12875396253933621,.11156664554733399,.11156664554733399,.09149002162245,.09149002162245,.06904454273764123,.06904454273764123,.0448142267656996,.0448142267656996,.019461788229726478,.019461788229726478],[.15275338713072584,.15275338713072584,.14917298647260374,.14917298647260374,.14209610931838204,.14209610931838204,.13168863844917664,.13168863844917664,.11819453196151841,.11819453196151841,.10193011981724044,.10193011981724044,.08327674157670475,.08327674157670475,.06267204833410907,.06267204833410907,.04060142980038694,.04060142980038694,.017614007139152118,.017614007139152118],[.14608113364969041,.14452440398997005,.14452440398997005,.13988739479107315,.13988739479107315,.13226893863333747,.13226893863333747,.12183141605372853,.12183141605372853,.10879729916714838,.10879729916714838,.09344442345603386,.09344442345603386,.0761001136283793,.0761001136283793,.057134425426857205,.057134425426857205,.036953789770852494,.036953789770852494,.016017228257774335,.016017228257774335],[.13925187285563198,.13925187285563198,.13654149834601517,.13654149834601517,.13117350478706238,.13117350478706238,.12325237681051242,.12325237681051242,.11293229608053922,.11293229608053922,.10041414444288096,.10041414444288096,.08594160621706773,.08594160621706773,.06979646842452049,.06979646842452049,.052293335152683286,.052293335152683286,.03377490158481415,.03377490158481415,.0146279952982722,.0146279952982722],[.13365457218610619,.1324620394046966,.1324620394046966,.12890572218808216,.12890572218808216,.12304908430672953,.12304908430672953,.11499664022241136,.11499664022241136,.10489209146454141,.10489209146454141,.09291576606003515,.09291576606003515,.07928141177671895,.07928141177671895,.06423242140852585,.06423242140852585,.04803767173108467,.04803767173108467,.030988005856979445,.030988005856979445,.013411859487141771,.013411859487141771],[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872]],e.binomialCoefficients=[[1],[1,1],[1,2,1],[1,3,3,1]];const t=(a,l,c)=>{let d,h,f;d=c/2,h=0;for(let g=0;g<20;g++)f=d*e.tValues[20][g]+d,h+=e.cValues[20][g]*s(a,l,f);return d*h};e.getCubicArcLength=t;const n=(a,l,c)=>{c===void 0&&(c=1);const d=a[0]-2*a[1]+a[2],h=l[0]-2*l[1]+l[2],f=2*a[1]-2*a[0],p=2*l[1]-2*l[0],g=4*(d*d+h*h),m=4*(d*f+h*p),y=f*f+p*p;if(g===0)return c*Math.sqrt(Math.pow(a[2]-a[0],2)+Math.pow(l[2]-l[0],2));const b=m/(2*g),C=y/g,x=c+b,v=C-b*b,w=x*x+v>0?Math.sqrt(x*x+v):0,S=b*b+v>0?Math.sqrt(b*b+v):0,j=b+Math.sqrt(b*b+v)!==0?v*Math.log(Math.abs((x+w)/(b+S))):0;return Math.sqrt(g)/2*(x*w-b*S+j)};e.getQuadraticArcLength=n;function s(a,l,c){const d=i(1,c,a),h=i(1,c,l),f=d*d+h*h;return Math.sqrt(f)}const i=(a,l,c)=>{const d=c.length-1;let h,f;if(d===0)return 0;if(a===0){f=0;for(let p=0;p<=d;p++)f+=e.binomialCoefficients[d][p]*Math.pow(1-l,d-p)*Math.pow(l,p)*c[p];return f}else{h=new Array(d);for(let p=0;p<d;p++)h[p]=d*(c[p+1]-c[p]);return i(a-1,l,h)}},o=(a,l,c)=>{let d=1,h=a/l,f=(a-c(h))/l,p=0;for(;d>.001;){const g=c(h+f),m=Math.abs(a-g)/l;if(m<d)d=m,h+=f;else{const y=c(h-f),b=Math.abs(a-y)/l;b<d?(d=b,h-=f):f/=2}if(p++,p>500)break}return h};e.t2length=o}(uv)),uv}var P6;function gk(){if(P6)return uh;P6=1,Object.defineProperty(uh,"__esModule",{value:!0}),uh.Path=void 0;const e=jt(),t=as(),n=St(),s=Ppe();let i=class Ks extends t.Shape{constructor(a){super(a),this.dataArray=[],this.pathLength=0,this._readDataAttribute(),this.on("dataChange.konva",function(){this._readDataAttribute()})}_readDataAttribute(){this.dataArray=Ks.parsePathData(this.data()),this.pathLength=Ks.getPathLength(this.dataArray)}_sceneFunc(a){var l=this.dataArray;a.beginPath();for(var c=!1,d=0;d<l.length;d++){var h=l[d].command,f=l[d].points;switch(h){case"L":a.lineTo(f[0],f[1]);break;case"M":a.moveTo(f[0],f[1]);break;case"C":a.bezierCurveTo(f[0],f[1],f[2],f[3],f[4],f[5]);break;case"Q":a.quadraticCurveTo(f[0],f[1],f[2],f[3]);break;case"A":var p=f[0],g=f[1],m=f[2],y=f[3],b=f[4],C=f[5],x=f[6],v=f[7],w=m>y?m:y,S=m>y?1:m/y,j=m>y?y/m:1;a.translate(p,g),a.rotate(x),a.scale(S,j),a.arc(0,0,w,b,b+C,1-v),a.scale(1/S,1/j),a.rotate(-x),a.translate(-p,-g);break;case"z":c=!0,a.closePath();break}}!c&&!this.hasFill()?a.strokeShape(this):a.fillStrokeShape(this)}getSelfRect(){var a=[];this.dataArray.forEach(function(m){if(m.command==="A"){var y=m.points[4],b=m.points[5],C=m.points[4]+b,x=Math.PI/180;if(Math.abs(y-C)<x&&(x=Math.abs(y-C)),b<0)for(let v=y-x;v>C;v-=x){const w=Ks.getPointOnEllipticalArc(m.points[0],m.points[1],m.points[2],m.points[3],v,0);a.push(w.x,w.y)}else for(let v=y+x;v<C;v+=x){const w=Ks.getPointOnEllipticalArc(m.points[0],m.points[1],m.points[2],m.points[3],v,0);a.push(w.x,w.y)}}else if(m.command==="C")for(let v=0;v<=1;v+=.01){const w=Ks.getPointOnCubicBezier(v,m.start.x,m.start.y,m.points[0],m.points[1],m.points[2],m.points[3],m.points[4],m.points[5]);a.push(w.x,w.y)}else a=a.concat(m.points)});for(var l=a[0],c=a[0],d=a[1],h=a[1],f,p,g=0;g<a.length/2;g++)f=a[g*2],p=a[g*2+1],isNaN(f)||(l=Math.min(l,f),c=Math.max(c,f)),isNaN(p)||(d=Math.min(d,p),h=Math.max(h,p));return{x:l,y:d,width:c-l,height:h-d}}getLength(){return this.pathLength}getPointAtLength(a){return Ks.getPointAtLengthOfDataArray(a,this.dataArray)}static getLineLength(a,l,c,d){return Math.sqrt((c-a)*(c-a)+(d-l)*(d-l))}static getPathLength(a){let l=0;for(var c=0;c<a.length;++c)l+=a[c].pathLength;return l}static getPointAtLengthOfDataArray(a,l){var c,d=0,h=l.length;if(!h)return null;for(;d<h&&a>l[d].pathLength;)a-=l[d].pathLength,++d;if(d===h)return c=l[d-1].points.slice(-2),{x:c[0],y:c[1]};if(a<.01)return c=l[d].points.slice(0,2),{x:c[0],y:c[1]};var f=l[d],p=f.points;switch(f.command){case"L":return Ks.getPointOnLine(a,f.start.x,f.start.y,p[0],p[1]);case"C":return Ks.getPointOnCubicBezier((0,s.t2length)(a,Ks.getPathLength(l),w=>(0,s.getCubicArcLength)([f.start.x,p[0],p[2],p[4]],[f.start.y,p[1],p[3],p[5]],w)),f.start.x,f.start.y,p[0],p[1],p[2],p[3],p[4],p[5]);case"Q":return Ks.getPointOnQuadraticBezier((0,s.t2length)(a,Ks.getPathLength(l),w=>(0,s.getQuadraticArcLength)([f.start.x,p[0],p[2]],[f.start.y,p[1],p[3]],w)),f.start.x,f.start.y,p[0],p[1],p[2],p[3]);case"A":var g=p[0],m=p[1],y=p[2],b=p[3],C=p[4],x=p[5],v=p[6];return C+=x*a/f.pathLength,Ks.getPointOnEllipticalArc(g,m,y,b,C,v)}return null}static getPointOnLine(a,l,c,d,h,f,p){f=f??l,p=p??c;const g=this.getLineLength(l,c,d,h);if(g<1e-10)return{x:l,y:c};if(d===l)return{x:f,y:p+(h>c?a:-a)};const m=(h-c)/(d-l),y=Math.sqrt(a*a/(1+m*m))*(d<l?-1:1),b=m*y;if(Math.abs(p-c-m*(f-l))<1e-10)return{x:f+y,y:p+b};const C=((f-l)*(d-l)+(p-c)*(h-c))/(g*g),x=l+C*(d-l),v=c+C*(h-c),w=this.getLineLength(f,p,x,v),S=Math.sqrt(a*a-w*w),j=Math.sqrt(S*S/(1+m*m))*(d<l?-1:1),P=m*j;return{x:x+j,y:v+P}}static getPointOnCubicBezier(a,l,c,d,h,f,p,g,m){function y(S){return S*S*S}function b(S){return 3*S*S*(1-S)}function C(S){return 3*S*(1-S)*(1-S)}function x(S){return(1-S)*(1-S)*(1-S)}var v=g*y(a)+f*b(a)+d*C(a)+l*x(a),w=m*y(a)+p*b(a)+h*C(a)+c*x(a);return{x:v,y:w}}static getPointOnQuadraticBezier(a,l,c,d,h,f,p){function g(x){return x*x}function m(x){return 2*x*(1-x)}function y(x){return(1-x)*(1-x)}var b=f*g(a)+d*m(a)+l*y(a),C=p*g(a)+h*m(a)+c*y(a);return{x:b,y:C}}static getPointOnEllipticalArc(a,l,c,d,h,f){var p=Math.cos(f),g=Math.sin(f),m={x:c*Math.cos(h),y:d*Math.sin(h)};return{x:a+(m.x*p-m.y*g),y:l+(m.x*g+m.y*p)}}static parsePathData(a){if(!a)return[];var l=a,c=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];l=l.replace(new RegExp(" ","g"),",");for(var d=0;d<c.length;d++)l=l.replace(new RegExp(c[d],"g"),"|"+c[d]);var h=l.split("|"),f=[],p=[],g=0,m=0,y=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi,b;for(d=1;d<h.length;d++){var C=h[d],x=C.charAt(0);for(C=C.slice(1),p.length=0;b=y.exec(C);)p.push(b[0]);for(var v=[],w=0,S=p.length;w<S;w++){if(p[w]==="00"){v.push(0,0);continue}var j=parseFloat(p[w]);isNaN(j)?v.push(0):v.push(j)}for(;v.length>0&&!isNaN(v[0]);){var P="",E=[],D=g,M=m,R,F,_,L,O,B,z,ee,ne,re;switch(x){case"l":g+=v.shift(),m+=v.shift(),P="L",E.push(g,m);break;case"L":g=v.shift(),m=v.shift(),E.push(g,m);break;case"m":var te=v.shift(),H=v.shift();if(g+=te,m+=H,P="M",f.length>2&&f[f.length-1].command==="z"){for(var V=f.length-2;V>=0;V--)if(f[V].command==="M"){g=f[V].points[0]+te,m=f[V].points[1]+H;break}}E.push(g,m),x="l";break;case"M":g=v.shift(),m=v.shift(),P="M",E.push(g,m),x="L";break;case"h":g+=v.shift(),P="L",E.push(g,m);break;case"H":g=v.shift(),P="L",E.push(g,m);break;case"v":m+=v.shift(),P="L",E.push(g,m);break;case"V":m=v.shift(),P="L",E.push(g,m);break;case"C":E.push(v.shift(),v.shift(),v.shift(),v.shift()),g=v.shift(),m=v.shift(),E.push(g,m);break;case"c":E.push(g+v.shift(),m+v.shift(),g+v.shift(),m+v.shift()),g+=v.shift(),m+=v.shift(),P="C",E.push(g,m);break;case"S":F=g,_=m,R=f[f.length-1],R.command==="C"&&(F=g+(g-R.points[2]),_=m+(m-R.points[3])),E.push(F,_,v.shift(),v.shift()),g=v.shift(),m=v.shift(),P="C",E.push(g,m);break;case"s":F=g,_=m,R=f[f.length-1],R.command==="C"&&(F=g+(g-R.points[2]),_=m+(m-R.points[3])),E.push(F,_,g+v.shift(),m+v.shift()),g+=v.shift(),m+=v.shift(),P="C",E.push(g,m);break;case"Q":E.push(v.shift(),v.shift()),g=v.shift(),m=v.shift(),E.push(g,m);break;case"q":E.push(g+v.shift(),m+v.shift()),g+=v.shift(),m+=v.shift(),P="Q",E.push(g,m);break;case"T":F=g,_=m,R=f[f.length-1],R.command==="Q"&&(F=g+(g-R.points[0]),_=m+(m-R.points[1])),g=v.shift(),m=v.shift(),P="Q",E.push(F,_,g,m);break;case"t":F=g,_=m,R=f[f.length-1],R.command==="Q"&&(F=g+(g-R.points[0]),_=m+(m-R.points[1])),g+=v.shift(),m+=v.shift(),P="Q",E.push(F,_,g,m);break;case"A":L=v.shift(),O=v.shift(),B=v.shift(),z=v.shift(),ee=v.shift(),ne=g,re=m,g=v.shift(),m=v.shift(),P="A",E=this.convertEndpointToCenterParameterization(ne,re,g,m,z,ee,L,O,B);break;case"a":L=v.shift(),O=v.shift(),B=v.shift(),z=v.shift(),ee=v.shift(),ne=g,re=m,g+=v.shift(),m+=v.shift(),P="A",E=this.convertEndpointToCenterParameterization(ne,re,g,m,z,ee,L,O,B);break}f.push({command:P||x,points:E,start:{x:D,y:M},pathLength:this.calcLength(D,M,P||x,E)})}(x==="z"||x==="Z")&&f.push({command:"z",points:[],start:void 0,pathLength:0})}return f}static calcLength(a,l,c,d){var h,f,p,g,m=Ks;switch(c){case"L":return m.getLineLength(a,l,d[0],d[1]);case"C":return(0,s.getCubicArcLength)([a,d[0],d[2],d[4]],[l,d[1],d[3],d[5]],1);case"Q":return(0,s.getQuadraticArcLength)([a,d[0],d[2]],[l,d[1],d[3]],1);case"A":h=0;var y=d[4],b=d[5],C=d[4]+b,x=Math.PI/180;if(Math.abs(y-C)<x&&(x=Math.abs(y-C)),f=m.getPointOnEllipticalArc(d[0],d[1],d[2],d[3],y,0),b<0)for(g=y-x;g>C;g-=x)p=m.getPointOnEllipticalArc(d[0],d[1],d[2],d[3],g,0),h+=m.getLineLength(f.x,f.y,p.x,p.y),f=p;else for(g=y+x;g<C;g+=x)p=m.getPointOnEllipticalArc(d[0],d[1],d[2],d[3],g,0),h+=m.getLineLength(f.x,f.y,p.x,p.y),f=p;return p=m.getPointOnEllipticalArc(d[0],d[1],d[2],d[3],C,0),h+=m.getLineLength(f.x,f.y,p.x,p.y),h}return 0}static convertEndpointToCenterParameterization(a,l,c,d,h,f,p,g,m){var y=m*(Math.PI/180),b=Math.cos(y)*(a-c)/2+Math.sin(y)*(l-d)/2,C=-1*Math.sin(y)*(a-c)/2+Math.cos(y)*(l-d)/2,x=b*b/(p*p)+C*C/(g*g);x>1&&(p*=Math.sqrt(x),g*=Math.sqrt(x));var v=Math.sqrt((p*p*(g*g)-p*p*(C*C)-g*g*(b*b))/(p*p*(C*C)+g*g*(b*b)));h===f&&(v*=-1),isNaN(v)&&(v=0);var w=v*p*C/g,S=v*-g*b/p,j=(a+c)/2+Math.cos(y)*w-Math.sin(y)*S,P=(l+d)/2+Math.sin(y)*w+Math.cos(y)*S,E=function(O){return Math.sqrt(O[0]*O[0]+O[1]*O[1])},D=function(O,B){return(O[0]*B[0]+O[1]*B[1])/(E(O)*E(B))},M=function(O,B){return(O[0]*B[1]<O[1]*B[0]?-1:1)*Math.acos(D(O,B))},R=M([1,0],[(b-w)/p,(C-S)/g]),F=[(b-w)/p,(C-S)/g],_=[(-1*b-w)/p,(-1*C-S)/g],L=M(F,_);return D(F,_)<=-1&&(L=Math.PI),D(F,_)>=1&&(L=0),f===0&&L>0&&(L=L-2*Math.PI),f===1&&L<0&&(L=L+2*Math.PI),[j,P,p,g,R,L,y,f]}};return uh.Path=i,i.prototype.className="Path",i.prototype._attrsAffectingSize=["data"],(0,n._registerNode)(i),e.Factory.addGetterSetter(i,"data"),uh}var L6;function Lpe(){if(L6)return lh;L6=1,Object.defineProperty(lh,"__esModule",{value:!0}),lh.Arrow=void 0;const e=jt(),t=_9(),n=_t(),s=St(),i=gk();let o=class extends t.Line{_sceneFunc(l){super._sceneFunc(l);var c=Math.PI*2,d=this.points(),h=d,f=this.tension()!==0&&d.length>4;f&&(h=this.getTensionPoints());var p=this.pointerLength(),g=d.length,m,y;if(f){const x=[h[h.length-4],h[h.length-3],h[h.length-2],h[h.length-1],d[g-2],d[g-1]],v=i.Path.calcLength(h[h.length-4],h[h.length-3],"C",x),w=i.Path.getPointOnQuadraticBezier(Math.min(1,1-p/v),x[0],x[1],x[2],x[3],x[4],x[5]);m=d[g-2]-w.x,y=d[g-1]-w.y}else m=d[g-2]-d[g-4],y=d[g-1]-d[g-3];var b=(Math.atan2(y,m)+c)%c,C=this.pointerWidth();this.pointerAtEnding()&&(l.save(),l.beginPath(),l.translate(d[g-2],d[g-1]),l.rotate(b),l.moveTo(0,0),l.lineTo(-p,C/2),l.lineTo(-p,-C/2),l.closePath(),l.restore(),this.__fillStroke(l)),this.pointerAtBeginning()&&(l.save(),l.beginPath(),l.translate(d[0],d[1]),f?(m=(h[0]+h[2])/2-d[0],y=(h[1]+h[3])/2-d[1]):(m=d[2]-d[0],y=d[3]-d[1]),l.rotate((Math.atan2(-y,-m)+c)%c),l.moveTo(0,0),l.lineTo(-p,C/2),l.lineTo(-p,-C/2),l.closePath(),l.restore(),this.__fillStroke(l))}__fillStroke(l){var c=this.dashEnabled();c&&(this.attrs.dashEnabled=!1,l.setLineDash([])),l.fillStrokeShape(this),c&&(this.attrs.dashEnabled=!0)}getSelfRect(){const l=super.getSelfRect(),c=this.pointerWidth()/2;return{x:l.x-c,y:l.y-c,width:l.width+c*2,height:l.height+c*2}}};return lh.Arrow=o,o.prototype.className="Arrow",(0,s._registerNode)(o),e.Factory.addGetterSetter(o,"pointerLength",10,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(o,"pointerWidth",10,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(o,"pointerAtBeginning",!1),e.Factory.addGetterSetter(o,"pointerAtEnding",!0),lh}var dh={},D6;function Dpe(){if(D6)return dh;D6=1,Object.defineProperty(dh,"__esModule",{value:!0}),dh.Circle=void 0;const e=jt(),t=as(),n=_t(),s=St();let i=class extends t.Shape{_sceneFunc(a){a.beginPath(),a.arc(0,0,this.attrs.radius||0,0,Math.PI*2,!1),a.closePath(),a.fillStrokeShape(this)}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(a){this.radius()!==a/2&&this.radius(a/2)}setHeight(a){this.radius()!==a/2&&this.radius(a/2)}};return dh.Circle=i,i.prototype._centroid=!0,i.prototype.className="Circle",i.prototype._attrsAffectingSize=["radius"],(0,s._registerNode)(i),e.Factory.addGetterSetter(i,"radius",0,(0,n.getNumberValidator)()),dh}var hh={},R6;function Rpe(){if(R6)return hh;R6=1,Object.defineProperty(hh,"__esModule",{value:!0}),hh.Ellipse=void 0;const e=jt(),t=as(),n=_t(),s=St();let i=class extends t.Shape{_sceneFunc(a){var l=this.radiusX(),c=this.radiusY();a.beginPath(),a.save(),l!==c&&a.scale(1,c/l),a.arc(0,0,l,0,Math.PI*2,!1),a.restore(),a.closePath(),a.fillStrokeShape(this)}getWidth(){return this.radiusX()*2}getHeight(){return this.radiusY()*2}setWidth(a){this.radiusX(a/2)}setHeight(a){this.radiusY(a/2)}};return hh.Ellipse=i,i.prototype.className="Ellipse",i.prototype._centroid=!0,i.prototype._attrsAffectingSize=["radiusX","radiusY"],(0,s._registerNode)(i),e.Factory.addComponentsGetterSetter(i,"radius",["x","y"]),e.Factory.addGetterSetter(i,"radiusX",0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(i,"radiusY",0,(0,n.getNumberValidator)()),hh}var fh={},O6;function Ope(){if(O6)return fh;O6=1,Object.defineProperty(fh,"__esModule",{value:!0}),fh.Image=void 0;const e=En(),t=jt(),n=as(),s=St(),i=_t();class o extends n.Shape{constructor(l){super(l),this.on("imageChange.konva",()=>{this._setImageLoad()}),this._setImageLoad()}_setImageLoad(){const l=this.image();l&&l.complete||l&&l.readyState===4||l&&l.addEventListener&&l.addEventListener("load",()=>{this._requestDraw()})}_useBufferCanvas(){const l=!!this.cornerRadius(),c=this.hasShadow();return l&&c?!0:super._useBufferCanvas(!0)}_sceneFunc(l){const c=this.getWidth(),d=this.getHeight(),h=this.cornerRadius(),f=this.attrs.image;let p;if(f){const g=this.attrs.cropWidth,m=this.attrs.cropHeight;g&&m?p=[f,this.cropX(),this.cropY(),g,m,0,0,c,d]:p=[f,0,0,c,d]}(this.hasFill()||this.hasStroke()||h)&&(l.beginPath(),h?e.Util.drawRoundedRectPath(l,c,d,h):l.rect(0,0,c,d),l.closePath(),l.fillStrokeShape(this)),f&&(h&&l.clip(),l.drawImage.apply(l,p))}_hitFunc(l){var c=this.width(),d=this.height(),h=this.cornerRadius();l.beginPath(),h?e.Util.drawRoundedRectPath(l,c,d,h):l.rect(0,0,c,d),l.closePath(),l.fillStrokeShape(this)}getWidth(){var l,c;return(l=this.attrs.width)!==null&&l!==void 0?l:(c=this.image())===null||c===void 0?void 0:c.width}getHeight(){var l,c;return(l=this.attrs.height)!==null&&l!==void 0?l:(c=this.image())===null||c===void 0?void 0:c.height}static fromURL(l,c,d=null){var h=e.Util.createImageElement();h.onload=function(){var f=new o({image:h});c(f)},h.onerror=d,h.crossOrigin="Anonymous",h.src=l}}return fh.Image=o,o.prototype.className="Image",(0,s._registerNode)(o),t.Factory.addGetterSetter(o,"cornerRadius",0,(0,i.getNumberOrArrayOfNumbersValidator)(4)),t.Factory.addGetterSetter(o,"image"),t.Factory.addComponentsGetterSetter(o,"crop",["x","y","width","height"]),t.Factory.addGetterSetter(o,"cropX",0,(0,i.getNumberValidator)()),t.Factory.addGetterSetter(o,"cropY",0,(0,i.getNumberValidator)()),t.Factory.addGetterSetter(o,"cropWidth",0,(0,i.getNumberValidator)()),t.Factory.addGetterSetter(o,"cropHeight",0,(0,i.getNumberValidator)()),fh}var gl={},N6;function Npe(){if(N6)return gl;N6=1,Object.defineProperty(gl,"__esModule",{value:!0}),gl.Tag=gl.Label=void 0;const e=jt(),t=as(),n=fk(),s=_t(),i=St();var o=["fontFamily","fontSize","fontStyle","padding","lineHeight","text","width","height","pointerDirection","pointerWidth","pointerHeight"],a="Change.konva",l="none",c="up",d="right",h="down",f="left",p=o.length;class g extends n.Group{constructor(b){super(b),this.on("add.konva",function(C){this._addListeners(C.child),this._sync()})}getText(){return this.find("Text")[0]}getTag(){return this.find("Tag")[0]}_addListeners(b){var C=this,x,v=function(){C._sync()};for(x=0;x<p;x++)b.on(o[x]+a,v)}getWidth(){return this.getText().width()}getHeight(){return this.getText().height()}_sync(){var b=this.getText(),C=this.getTag(),x,v,w,S,j,P,E;if(b&&C){switch(x=b.width(),v=b.height(),w=C.pointerDirection(),S=C.pointerWidth(),E=C.pointerHeight(),j=0,P=0,w){case c:j=x/2,P=-1*E;break;case d:j=x+S,P=v/2;break;case h:j=x/2,P=v+E;break;case f:j=-1*S,P=v/2;break}C.setAttrs({x:-1*j,y:-1*P,width:x,height:v}),b.setAttrs({x:-1*j,y:-1*P})}}}gl.Label=g,g.prototype.className="Label",(0,i._registerNode)(g);class m extends t.Shape{_sceneFunc(b){var C=this.width(),x=this.height(),v=this.pointerDirection(),w=this.pointerWidth(),S=this.pointerHeight(),j=this.cornerRadius();let P=0,E=0,D=0,M=0;typeof j=="number"?P=E=D=M=Math.min(j,C/2,x/2):(P=Math.min(j[0]||0,C/2,x/2),E=Math.min(j[1]||0,C/2,x/2),M=Math.min(j[2]||0,C/2,x/2),D=Math.min(j[3]||0,C/2,x/2)),b.beginPath(),b.moveTo(P,0),v===c&&(b.lineTo((C-w)/2,0),b.lineTo(C/2,-1*S),b.lineTo((C+w)/2,0)),b.lineTo(C-E,0),b.arc(C-E,E,E,Math.PI*3/2,0,!1),v===d&&(b.lineTo(C,(x-S)/2),b.lineTo(C+w,x/2),b.lineTo(C,(x+S)/2)),b.lineTo(C,x-M),b.arc(C-M,x-M,M,0,Math.PI/2,!1),v===h&&(b.lineTo((C+w)/2,x),b.lineTo(C/2,x+S),b.lineTo((C-w)/2,x)),b.lineTo(D,x),b.arc(D,x-D,D,Math.PI/2,Math.PI,!1),v===f&&(b.lineTo(0,(x+S)/2),b.lineTo(-1*w,x/2),b.lineTo(0,(x-S)/2)),b.lineTo(0,P),b.arc(P,P,P,Math.PI,Math.PI*3/2,!1),b.closePath(),b.fillStrokeShape(this)}getSelfRect(){var b=0,C=0,x=this.pointerWidth(),v=this.pointerHeight(),w=this.pointerDirection(),S=this.width(),j=this.height();return w===c?(C-=v,j+=v):w===h?j+=v:w===f?(b-=x*1.5,S+=x):w===d&&(S+=x*1.5),{x:b,y:C,width:S,height:j}}}return gl.Tag=m,m.prototype.className="Tag",(0,i._registerNode)(m),e.Factory.addGetterSetter(m,"pointerDirection",l),e.Factory.addGetterSetter(m,"pointerWidth",0,(0,s.getNumberValidator)()),e.Factory.addGetterSetter(m,"pointerHeight",0,(0,s.getNumberValidator)()),e.Factory.addGetterSetter(m,"cornerRadius",0,(0,s.getNumberOrArrayOfNumbersValidator)(4)),gl}var ph={},F6;function I9(){if(F6)return ph;F6=1,Object.defineProperty(ph,"__esModule",{value:!0}),ph.Rect=void 0;const e=jt(),t=as(),n=St(),s=En(),i=_t();let o=class extends t.Shape{_sceneFunc(l){var c=this.cornerRadius(),d=this.width(),h=this.height();l.beginPath(),c?s.Util.drawRoundedRectPath(l,d,h,c):l.rect(0,0,d,h),l.closePath(),l.fillStrokeShape(this)}};return ph.Rect=o,o.prototype.className="Rect",(0,n._registerNode)(o),e.Factory.addGetterSetter(o,"cornerRadius",0,(0,i.getNumberOrArrayOfNumbersValidator)(4)),ph}var gh={},B6;function Fpe(){if(B6)return gh;B6=1,Object.defineProperty(gh,"__esModule",{value:!0}),gh.RegularPolygon=void 0;const e=jt(),t=as(),n=_t(),s=St();let i=class extends t.Shape{_sceneFunc(a){const l=this._getPoints();a.beginPath(),a.moveTo(l[0].x,l[0].y);for(var c=1;c<l.length;c++)a.lineTo(l[c].x,l[c].y);a.closePath(),a.fillStrokeShape(this)}_getPoints(){const a=this.attrs.sides,l=this.attrs.radius||0,c=[];for(var d=0;d<a;d++)c.push({x:l*Math.sin(d*2*Math.PI/a),y:-1*l*Math.cos(d*2*Math.PI/a)});return c}getSelfRect(){const a=this._getPoints();var l=a[0].x,c=a[0].y,d=a[0].x,h=a[0].y;return a.forEach(f=>{l=Math.min(l,f.x),c=Math.max(c,f.x),d=Math.min(d,f.y),h=Math.max(h,f.y)}),{x:l,y:d,width:c-l,height:h-d}}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(a){this.radius(a/2)}setHeight(a){this.radius(a/2)}};return gh.RegularPolygon=i,i.prototype.className="RegularPolygon",i.prototype._centroid=!0,i.prototype._attrsAffectingSize=["radius"],(0,s._registerNode)(i),e.Factory.addGetterSetter(i,"radius",0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(i,"sides",0,(0,n.getNumberValidator)()),gh}var mh={},$6;function Bpe(){if($6)return mh;$6=1,Object.defineProperty(mh,"__esModule",{value:!0}),mh.Ring=void 0;const e=jt(),t=as(),n=_t(),s=St();var i=Math.PI*2;let o=class extends t.Shape{_sceneFunc(l){l.beginPath(),l.arc(0,0,this.innerRadius(),0,i,!1),l.moveTo(this.outerRadius(),0),l.arc(0,0,this.outerRadius(),i,0,!0),l.closePath(),l.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(l){this.outerRadius(l/2)}setHeight(l){this.outerRadius(l/2)}};return mh.Ring=o,o.prototype.className="Ring",o.prototype._centroid=!0,o.prototype._attrsAffectingSize=["innerRadius","outerRadius"],(0,s._registerNode)(o),e.Factory.addGetterSetter(o,"innerRadius",0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(o,"outerRadius",0,(0,n.getNumberValidator)()),mh}var yh={},V6;function $pe(){if(V6)return yh;V6=1,Object.defineProperty(yh,"__esModule",{value:!0}),yh.Sprite=void 0;const e=jt(),t=as(),n=pk(),s=_t(),i=St();let o=class extends t.Shape{constructor(l){super(l),this._updated=!0,this.anim=new n.Animation(()=>{var c=this._updated;return this._updated=!1,c}),this.on("animationChange.konva",function(){this.frameIndex(0)}),this.on("frameIndexChange.konva",function(){this._updated=!0}),this.on("frameRateChange.konva",function(){this.anim.isRunning()&&(clearInterval(this.interval),this._setInterval())})}_sceneFunc(l){var c=this.animation(),d=this.frameIndex(),h=d*4,f=this.animations()[c],p=this.frameOffsets(),g=f[h+0],m=f[h+1],y=f[h+2],b=f[h+3],C=this.image();if((this.hasFill()||this.hasStroke())&&(l.beginPath(),l.rect(0,0,y,b),l.closePath(),l.fillStrokeShape(this)),C)if(p){var x=p[c],v=d*2;l.drawImage(C,g,m,y,b,x[v+0],x[v+1],y,b)}else l.drawImage(C,g,m,y,b,0,0,y,b)}_hitFunc(l){var c=this.animation(),d=this.frameIndex(),h=d*4,f=this.animations()[c],p=this.frameOffsets(),g=f[h+2],m=f[h+3];if(l.beginPath(),p){var y=p[c],b=d*2;l.rect(y[b+0],y[b+1],g,m)}else l.rect(0,0,g,m);l.closePath(),l.fillShape(this)}_useBufferCanvas(){return super._useBufferCanvas(!0)}_setInterval(){var l=this;this.interval=setInterval(function(){l._updateIndex()},1e3/this.frameRate())}start(){if(!this.isRunning()){var l=this.getLayer();this.anim.setLayers(l),this._setInterval(),this.anim.start()}}stop(){this.anim.stop(),clearInterval(this.interval)}isRunning(){return this.anim.isRunning()}_updateIndex(){var l=this.frameIndex(),c=this.animation(),d=this.animations(),h=d[c],f=h.length/4;l<f-1?this.frameIndex(l+1):this.frameIndex(0)}};return yh.Sprite=o,o.prototype.className="Sprite",(0,i._registerNode)(o),e.Factory.addGetterSetter(o,"animation"),e.Factory.addGetterSetter(o,"animations"),e.Factory.addGetterSetter(o,"frameOffsets"),e.Factory.addGetterSetter(o,"image"),e.Factory.addGetterSetter(o,"frameIndex",0,(0,s.getNumberValidator)()),e.Factory.addGetterSetter(o,"frameRate",17,(0,s.getNumberValidator)()),e.Factory.backCompat(o,{index:"frameIndex",getIndex:"getFrameIndex",setIndex:"setFrameIndex"}),yh}var bh={},z6;function Vpe(){if(z6)return bh;z6=1,Object.defineProperty(bh,"__esModule",{value:!0}),bh.Star=void 0;const e=jt(),t=as(),n=_t(),s=St();let i=class extends t.Shape{_sceneFunc(a){var l=this.innerRadius(),c=this.outerRadius(),d=this.numPoints();a.beginPath(),a.moveTo(0,0-c);for(var h=1;h<d*2;h++){var f=h%2===0?c:l,p=f*Math.sin(h*Math.PI/d),g=-1*f*Math.cos(h*Math.PI/d);a.lineTo(p,g)}a.closePath(),a.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(a){this.outerRadius(a/2)}setHeight(a){this.outerRadius(a/2)}};return bh.Star=i,i.prototype.className="Star",i.prototype._centroid=!0,i.prototype._attrsAffectingSize=["innerRadius","outerRadius"],(0,s._registerNode)(i),e.Factory.addGetterSetter(i,"numPoints",5,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(i,"innerRadius",0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(i,"outerRadius",0,(0,n.getNumberValidator)()),bh}var ml={},G6;function T9(){if(G6)return ml;G6=1,Object.defineProperty(ml,"__esModule",{value:!0}),ml.Text=ml.stringToArray=void 0;const e=En(),t=jt(),n=as(),s=St(),i=_t(),o=St();function a(H){return[...H].reduce((V,X,W,Y)=>(new RegExp("\\p{Emoji_Modifier_Base}\\p{Emoji_Modifier}?(?:\\u200D\\p{Emoji_Presentation})+","u").test(X)?V.push(X):new RegExp("\\p{Regional_Indicator}{2}","u").test(X+(Y[W+1]||""))?V.push(X+Y[W+1]):W>0&&new RegExp("\\p{Mn}|\\p{Me}|\\p{Mc}","u").test(X)?V[V.length-1]+=X:V.push(X),V),[])}ml.stringToArray=a;var l="auto",c="center",d="inherit",h="justify",f="Change.konva",p="2d",g="-",m="left",y="text",b="Text",C="top",x="bottom",v="middle",w="normal",S="px ",j=" ",P="right",E="rtl",D="word",M="char",R="none",F="",_=["direction","fontFamily","fontSize","fontStyle","fontVariant","padding","align","verticalAlign","lineHeight","text","width","height","wrap","ellipsis","letterSpacing"],L=_.length;function O(H){return H.split(",").map(V=>{V=V.trim();const X=V.indexOf(" ")>=0,W=V.indexOf('"')>=0||V.indexOf("'")>=0;return X&&!W&&(V=`"${V}"`),V}).join(", ")}var B;function z(){return B||(B=e.Util.createCanvasElement().getContext(p),B)}function ee(H){H.fillText(this._partialText,this._partialTextX,this._partialTextY)}function ne(H){H.setAttr("miterLimit",2),H.strokeText(this._partialText,this._partialTextX,this._partialTextY)}function re(H){return H=H||{},!H.fillLinearGradientColorStops&&!H.fillRadialGradientColorStops&&!H.fillPatternImage&&(H.fill=H.fill||"black"),H}class te extends n.Shape{constructor(V){super(re(V)),this._partialTextX=0,this._partialTextY=0;for(var X=0;X<L;X++)this.on(_[X]+f,this._setTextData);this._setTextData()}_sceneFunc(V){var X=this.textArr,W=X.length;if(this.text()){var Y=this.padding(),$=this.fontSize(),N=this.lineHeight()*$,U=this.verticalAlign(),ie=this.direction(),ue=0,xe=this.align(),Me=this.getWidth(),je=this.letterSpacing(),Fe=this.fill(),nt=this.textDecoration(),$e=nt.indexOf("underline")!==-1,Z=nt.indexOf("line-through")!==-1,se;ie=ie===d?V.direction:ie;var le=N/2,ve=v;if(s.Konva._fixTextRendering){var ye=this.measureSize("M");ve="alphabetic",le=(ye.fontBoundingBoxAscent-ye.fontBoundingBoxDescent)/2+N/2}var me=0,ce=0;for(ie===E&&V.setAttr("direction",ie),V.setAttr("font",this._getContextFont()),V.setAttr("textBaseline",ve),V.setAttr("textAlign",m),U===v?ue=(this.getHeight()-W*N-Y*2)/2:U===x&&(ue=this.getHeight()-W*N-Y*2),V.translate(Y,ue+Y),se=0;se<W;se++){var me=0,ce=0,Ce=X[se],He=Ce.text,Xe=Ce.width,mt=Ce.lastInParagraph,rn,pn,bn;if(V.save(),xe===P?me+=Me-Xe-Y*2:xe===c&&(me+=(Me-Xe-Y*2)/2),$e){V.save(),V.beginPath();let bs=s.Konva._fixTextRendering?Math.round($/4):Math.round($/2);const qs=me,ui=le+ce+bs;V.moveTo(qs,ui),rn=He.split(" ").length-1,pn=rn===0,bn=xe===h&&!mt?Me-Y*2:Xe,V.lineTo(qs+Math.round(bn),ui),V.lineWidth=$/15;const Pc=this._getLinearGradient();V.strokeStyle=Pc||Fe,V.stroke(),V.restore()}if(Z){V.save(),V.beginPath();let bs=s.Konva._fixTextRendering?-Math.round($/4):0;V.moveTo(me,le+ce+bs),rn=He.split(" ").length-1,pn=rn===0,bn=xe===h&&mt&&!pn?Me-Y*2:Xe,V.lineTo(me+Math.round(bn),le+ce+bs),V.lineWidth=$/15;const qs=this._getLinearGradient();V.strokeStyle=qs||Fe,V.stroke(),V.restore()}if(ie!==E&&(je!==0||xe===h)){rn=He.split(" ").length-1;for(var ls=a(He),Os=0;Os<ls.length;Os++){var xn=ls[Os];xn===" "&&!mt&&xe===h&&(me+=(Me-Y*2-Xe)/rn),this._partialTextX=me,this._partialTextY=le+ce,this._partialText=xn,V.fillStrokeShape(this),me+=this.measureSize(xn).width+je}}else je!==0&&V.setAttr("letterSpacing",`${je}px`),this._partialTextX=me,this._partialTextY=le+ce,this._partialText=He,V.fillStrokeShape(this);V.restore(),W>1&&(le+=N)}}}_hitFunc(V){var X=this.getWidth(),W=this.getHeight();V.beginPath(),V.rect(0,0,X,W),V.closePath(),V.fillStrokeShape(this)}setText(V){var X=e.Util._isString(V)?V:V==null?"":V+"";return this._setAttr(y,X),this}getWidth(){var V=this.attrs.width===l||this.attrs.width===void 0;return V?this.getTextWidth()+this.padding()*2:this.attrs.width}getHeight(){var V=this.attrs.height===l||this.attrs.height===void 0;return V?this.fontSize()*this.textArr.length*this.lineHeight()+this.padding()*2:this.attrs.height}getTextWidth(){return this.textWidth}getTextHeight(){return e.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}measureSize(V){var X,W,Y,$,N,U,ie,ue,xe,Me,je,Fe=z(),nt=this.fontSize(),$e;Fe.save(),Fe.font=this._getContextFont(),$e=Fe.measureText(V),Fe.restore();const Z=nt/100;return{actualBoundingBoxAscent:(X=$e.actualBoundingBoxAscent)!==null&&X!==void 0?X:71.58203125*Z,actualBoundingBoxDescent:(W=$e.actualBoundingBoxDescent)!==null&&W!==void 0?W:0,actualBoundingBoxLeft:(Y=$e.actualBoundingBoxLeft)!==null&&Y!==void 0?Y:-7.421875*Z,actualBoundingBoxRight:($=$e.actualBoundingBoxRight)!==null&&$!==void 0?$:75.732421875*Z,alphabeticBaseline:(N=$e.alphabeticBaseline)!==null&&N!==void 0?N:0,emHeightAscent:(U=$e.emHeightAscent)!==null&&U!==void 0?U:100*Z,emHeightDescent:(ie=$e.emHeightDescent)!==null&&ie!==void 0?ie:-20*Z,fontBoundingBoxAscent:(ue=$e.fontBoundingBoxAscent)!==null&&ue!==void 0?ue:91*Z,fontBoundingBoxDescent:(xe=$e.fontBoundingBoxDescent)!==null&&xe!==void 0?xe:21*Z,hangingBaseline:(Me=$e.hangingBaseline)!==null&&Me!==void 0?Me:72.80000305175781*Z,ideographicBaseline:(je=$e.ideographicBaseline)!==null&&je!==void 0?je:-21*Z,width:$e.width,height:nt}}_getContextFont(){return this.fontStyle()+j+this.fontVariant()+j+(this.fontSize()+S)+O(this.fontFamily())}_addTextLine(V){this.align()===h&&(V=V.trim());var W=this._getTextWidth(V);return this.textArr.push({text:V,width:W,lastInParagraph:!1})}_getTextWidth(V){var X=this.letterSpacing(),W=V.length;return z().measureText(V).width+(W?X*(W-1):0)}_setTextData(){var V=this.text().split(`
`),X=+this.fontSize(),W=0,Y=this.lineHeight()*X,$=this.attrs.width,N=this.attrs.height,U=$!==l&&$!==void 0,ie=N!==l&&N!==void 0,ue=this.padding(),xe=$-ue*2,Me=N-ue*2,je=0,Fe=this.wrap(),nt=Fe!==R,$e=Fe!==M&&nt,Z=this.ellipsis();this.textArr=[],z().font=this._getContextFont();for(var se=Z?this._getTextWidth(F):0,le=0,ve=V.length;le<ve;++le){var ye=V[le],me=this._getTextWidth(ye);if(U&&me>xe)for(;ye.length>0;){for(var ce=0,Ce=ye.length,He="",Xe=0;ce<Ce;){var mt=ce+Ce>>>1,rn=ye.slice(0,mt+1),pn=this._getTextWidth(rn)+se;pn<=xe?(ce=mt+1,He=rn,Xe=pn):Ce=mt}if(He){if($e){var bn,ls=ye[He.length],Os=ls===j||ls===g;Os&&Xe<=xe?bn=He.length:bn=Math.max(He.lastIndexOf(j),He.lastIndexOf(g))+1,bn>0&&(ce=bn,He=He.slice(0,ce),Xe=this._getTextWidth(He))}He=He.trimRight(),this._addTextLine(He),W=Math.max(W,Xe),je+=Y;var xn=this._shouldHandleEllipsis(je);if(xn){this._tryToAddEllipsisToLastLine();break}if(ye=ye.slice(ce),ye=ye.trimLeft(),ye.length>0&&(me=this._getTextWidth(ye),me<=xe)){this._addTextLine(ye),je+=Y,W=Math.max(W,me);break}}else break}else this._addTextLine(ye),je+=Y,W=Math.max(W,me),this._shouldHandleEllipsis(je)&&le<ve-1&&this._tryToAddEllipsisToLastLine();if(this.textArr[this.textArr.length-1]&&(this.textArr[this.textArr.length-1].lastInParagraph=!0),ie&&je+Y>Me)break}this.textHeight=X,this.textWidth=W}_shouldHandleEllipsis(V){var X=+this.fontSize(),W=this.lineHeight()*X,Y=this.attrs.height,$=Y!==l&&Y!==void 0,N=this.padding(),U=Y-N*2,ie=this.wrap(),ue=ie!==R;return!ue||$&&V+W>U}_tryToAddEllipsisToLastLine(){var V=this.attrs.width,X=V!==l&&V!==void 0,W=this.padding(),Y=V-W*2,$=this.ellipsis(),N=this.textArr[this.textArr.length-1];if(!(!N||!$)){if(X){var U=this._getTextWidth(N.text+F)<Y;U||(N.text=N.text.slice(0,N.text.length-3))}this.textArr.splice(this.textArr.length-1,1),this._addTextLine(N.text+F)}}getStrokeScaleEnabled(){return!0}_useBufferCanvas(){const V=this.textDecoration().indexOf("underline")!==-1||this.textDecoration().indexOf("line-through")!==-1,X=this.hasShadow();return V&&X?!0:super._useBufferCanvas()}}return ml.Text=te,te.prototype._fillFunc=ee,te.prototype._strokeFunc=ne,te.prototype.className=b,te.prototype._attrsAffectingSize=["text","fontSize","padding","wrap","lineHeight","letterSpacing"],(0,o._registerNode)(te),t.Factory.overWriteSetter(te,"width",(0,i.getNumberOrAutoValidator)()),t.Factory.overWriteSetter(te,"height",(0,i.getNumberOrAutoValidator)()),t.Factory.addGetterSetter(te,"direction",d),t.Factory.addGetterSetter(te,"fontFamily","Arial"),t.Factory.addGetterSetter(te,"fontSize",12,(0,i.getNumberValidator)()),t.Factory.addGetterSetter(te,"fontStyle",w),t.Factory.addGetterSetter(te,"fontVariant",w),t.Factory.addGetterSetter(te,"padding",0,(0,i.getNumberValidator)()),t.Factory.addGetterSetter(te,"align",m),t.Factory.addGetterSetter(te,"verticalAlign",C),t.Factory.addGetterSetter(te,"lineHeight",1,(0,i.getNumberValidator)()),t.Factory.addGetterSetter(te,"wrap",D),t.Factory.addGetterSetter(te,"ellipsis",!1,(0,i.getBooleanValidator)()),t.Factory.addGetterSetter(te,"letterSpacing",0,(0,i.getNumberValidator)()),t.Factory.addGetterSetter(te,"text","",(0,i.getStringValidator)()),t.Factory.addGetterSetter(te,"textDecoration",""),ml}var xh={},H6;function zpe(){if(H6)return xh;H6=1,Object.defineProperty(xh,"__esModule",{value:!0}),xh.TextPath=void 0;const e=En(),t=jt(),n=as(),s=gk(),i=T9(),o=_t(),a=St();var l="",c="normal";function d(p){p.fillText(this.partialText,0,0)}function h(p){p.strokeText(this.partialText,0,0)}let f=class extends n.Shape{constructor(g){super(g),this.dummyCanvas=e.Util.createCanvasElement(),this.dataArray=[],this._readDataAttribute(),this.on("dataChange.konva",function(){this._readDataAttribute(),this._setTextData()}),this.on("textChange.konva alignChange.konva letterSpacingChange.konva kerningFuncChange.konva fontSizeChange.konva fontFamilyChange.konva",this._setTextData),this._setTextData()}_getTextPathLength(){return s.Path.getPathLength(this.dataArray)}_getPointAtLength(g){if(!this.attrs.data)return null;const m=this.pathLength;return g-1>m?null:s.Path.getPointAtLengthOfDataArray(g,this.dataArray)}_readDataAttribute(){this.dataArray=s.Path.parsePathData(this.attrs.data),this.pathLength=this._getTextPathLength()}_sceneFunc(g){g.setAttr("font",this._getContextFont()),g.setAttr("textBaseline",this.textBaseline()),g.setAttr("textAlign","left"),g.save();var m=this.textDecoration(),y=this.fill(),b=this.fontSize(),C=this.glyphInfo;m==="underline"&&g.beginPath();for(var x=0;x<C.length;x++){g.save();var v=C[x].p0;g.translate(v.x,v.y),g.rotate(C[x].rotation),this.partialText=C[x].text,g.fillStrokeShape(this),m==="underline"&&(x===0&&g.moveTo(0,b/2+1),g.lineTo(b,b/2+1)),g.restore()}m==="underline"&&(g.strokeStyle=y,g.lineWidth=b/20,g.stroke()),g.restore()}_hitFunc(g){g.beginPath();var m=this.glyphInfo;if(m.length>=1){var y=m[0].p0;g.moveTo(y.x,y.y)}for(var b=0;b<m.length;b++){var C=m[b].p1;g.lineTo(C.x,C.y)}g.setAttr("lineWidth",this.fontSize()),g.setAttr("strokeStyle",this.colorKey),g.stroke()}getTextWidth(){return this.textWidth}getTextHeight(){return e.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}setText(g){return i.Text.prototype.setText.call(this,g)}_getContextFont(){return i.Text.prototype._getContextFont.call(this)}_getTextSize(g){var m=this.dummyCanvas,y=m.getContext("2d");y.save(),y.font=this._getContextFont();var b=y.measureText(g);return y.restore(),{width:b.width,height:parseInt(`${this.fontSize()}`,10)}}_setTextData(){const{width:g,height:m}=this._getTextSize(this.attrs.text);if(this.textWidth=g,this.textHeight=m,this.glyphInfo=[],!this.attrs.data)return null;const y=this.letterSpacing(),b=this.align(),C=this.kerningFunc(),x=Math.max(this.textWidth+((this.attrs.text||"").length-1)*y,0);let v=0;b==="center"&&(v=Math.max(0,this.pathLength/2-x/2)),b==="right"&&(v=Math.max(0,this.pathLength-x));const w=(0,i.stringToArray)(this.text());let S=v;for(var j=0;j<w.length;j++){const P=this._getPointAtLength(S);if(!P)return;let E=this._getTextSize(w[j]).width+y;if(w[j]===" "&&b==="justify"){const L=this.text().split(" ").length-1;E+=(this.pathLength-x)/L}const D=this._getPointAtLength(S+E);if(!D)return;const M=s.Path.getLineLength(P.x,P.y,D.x,D.y);let R=0;if(C)try{R=C(w[j-1],w[j])*this.fontSize()}catch{R=0}P.x+=R,D.x+=R,this.textWidth+=R;const F=s.Path.getPointOnLine(R+M/2,P.x,P.y,D.x,D.y),_=Math.atan2(D.y-P.y,D.x-P.x);this.glyphInfo.push({transposeX:F.x,transposeY:F.y,text:w[j],rotation:_,p0:P,p1:D}),S+=E}}getSelfRect(){if(!this.glyphInfo.length)return{x:0,y:0,width:0,height:0};var g=[];this.glyphInfo.forEach(function(j){g.push(j.p0.x),g.push(j.p0.y),g.push(j.p1.x),g.push(j.p1.y)});for(var m=g[0]||0,y=g[0]||0,b=g[1]||0,C=g[1]||0,x,v,w=0;w<g.length/2;w++)x=g[w*2],v=g[w*2+1],m=Math.min(m,x),y=Math.max(y,x),b=Math.min(b,v),C=Math.max(C,v);var S=this.fontSize();return{x:m-S/2,y:b-S/2,width:y-m+S,height:C-b+S}}destroy(){return e.Util.releaseCanvas(this.dummyCanvas),super.destroy()}};return xh.TextPath=f,f.prototype._fillFunc=d,f.prototype._strokeFunc=h,f.prototype._fillFuncHit=d,f.prototype._strokeFuncHit=h,f.prototype.className="TextPath",f.prototype._attrsAffectingSize=["text","fontSize","data"],(0,a._registerNode)(f),t.Factory.addGetterSetter(f,"data"),t.Factory.addGetterSetter(f,"fontFamily","Arial"),t.Factory.addGetterSetter(f,"fontSize",12,(0,o.getNumberValidator)()),t.Factory.addGetterSetter(f,"fontStyle",c),t.Factory.addGetterSetter(f,"align","left"),t.Factory.addGetterSetter(f,"letterSpacing",0,(0,o.getNumberValidator)()),t.Factory.addGetterSetter(f,"textBaseline","middle"),t.Factory.addGetterSetter(f,"fontVariant",c),t.Factory.addGetterSetter(f,"text",l),t.Factory.addGetterSetter(f,"textDecoration",null),t.Factory.addGetterSetter(f,"kerningFunc",null),xh}var vh={},W6;function Gpe(){if(W6)return vh;W6=1,Object.defineProperty(vh,"__esModule",{value:!0}),vh.Transformer=void 0;const e=En(),t=jt(),n=Ln(),s=as(),i=I9(),o=fk(),a=St(),l=_t(),c=St();var d="tr-konva",h=["resizeEnabledChange","rotateAnchorOffsetChange","rotateEnabledChange","enabledAnchorsChange","anchorSizeChange","borderEnabledChange","borderStrokeChange","borderStrokeWidthChange","borderDashChange","anchorStrokeChange","anchorStrokeWidthChange","anchorFillChange","anchorCornerRadiusChange","ignoreStrokeChange","anchorStyleFuncChange"].map(E=>E+`.${d}`).join(" "),f="nodesRect",p=["widthChange","heightChange","scaleXChange","scaleYChange","skewXChange","skewYChange","rotationChange","offsetXChange","offsetYChange","transformsEnabledChange","strokeWidthChange"],g={"top-left":-45,"top-center":0,"top-right":45,"middle-right":-90,"middle-left":90,"bottom-left":-135,"bottom-center":180,"bottom-right":135};const m="ontouchstart"in a.Konva._global;function y(E,D,M){if(E==="rotater")return M;D+=e.Util.degToRad(g[E]||0);var R=(e.Util.radToDeg(D)%360+360)%360;return e.Util._inRange(R,315+22.5,360)||e.Util._inRange(R,0,22.5)?"ns-resize":e.Util._inRange(R,45-22.5,45+22.5)?"nesw-resize":e.Util._inRange(R,90-22.5,90+22.5)?"ew-resize":e.Util._inRange(R,135-22.5,135+22.5)?"nwse-resize":e.Util._inRange(R,180-22.5,180+22.5)?"ns-resize":e.Util._inRange(R,225-22.5,225+22.5)?"nesw-resize":e.Util._inRange(R,270-22.5,270+22.5)?"ew-resize":e.Util._inRange(R,315-22.5,315+22.5)?"nwse-resize":(e.Util.error("Transformer has unknown angle for cursor detection: "+R),"pointer")}var b=["top-left","top-center","top-right","middle-right","middle-left","bottom-left","bottom-center","bottom-right"];function C(E){return{x:E.x+E.width/2*Math.cos(E.rotation)+E.height/2*Math.sin(-E.rotation),y:E.y+E.height/2*Math.cos(E.rotation)+E.width/2*Math.sin(E.rotation)}}function x(E,D,M){const R=M.x+(E.x-M.x)*Math.cos(D)-(E.y-M.y)*Math.sin(D),F=M.y+(E.x-M.x)*Math.sin(D)+(E.y-M.y)*Math.cos(D);return{...E,rotation:E.rotation+D,x:R,y:F}}function v(E,D){const M=C(E);return x(E,D,M)}function w(E,D,M){let R=D;for(let F=0;F<E.length;F++){const _=a.Konva.getAngle(E[F]),L=Math.abs(_-D)%(Math.PI*2);Math.min(L,Math.PI*2-L)<M&&(R=_)}return R}let S=0,j=class extends o.Group{constructor(D){super(D),this._movingAnchorName=null,this._transforming=!1,this._createElements(),this._handleMouseMove=this._handleMouseMove.bind(this),this._handleMouseUp=this._handleMouseUp.bind(this),this.update=this.update.bind(this),this.on(h,this.update),this.getNode()&&this.update()}attachTo(D){return this.setNode(D),this}setNode(D){return e.Util.warn("tr.setNode(shape), tr.node(shape) and tr.attachTo(shape) methods are deprecated. Please use tr.nodes(nodesArray) instead."),this.setNodes([D])}getNode(){return this._nodes&&this._nodes[0]}_getEventNamespace(){return d+this._id}setNodes(D=[]){this._nodes&&this._nodes.length&&this.detach();const M=D.filter(F=>F.isAncestorOf(this)?(e.Util.error("Konva.Transformer cannot be an a child of the node you are trying to attach"),!1):!0);this._nodes=D=M,D.length===1&&this.useSingleNodeRotation()?this.rotation(D[0].getAbsoluteRotation()):this.rotation(0),this._nodes.forEach(F=>{const _=()=>{this.nodes().length===1&&this.useSingleNodeRotation()&&this.rotation(this.nodes()[0].getAbsoluteRotation()),this._resetTransformCache(),!this._transforming&&!this.isDragging()&&this.update()},L=F._attrsAffectingSize.map(O=>O+"Change."+this._getEventNamespace()).join(" ");F.on(L,_),F.on(p.map(O=>O+`.${this._getEventNamespace()}`).join(" "),_),F.on(`absoluteTransformChange.${this._getEventNamespace()}`,_),this._proxyDrag(F)}),this._resetTransformCache();var R=!!this.findOne(".top-left");return R&&this.update(),this}_proxyDrag(D){let M;D.on(`dragstart.${this._getEventNamespace()}`,R=>{M=D.getAbsolutePosition(),!this.isDragging()&&D!==this.findOne(".back")&&this.startDrag(R,!1)}),D.on(`dragmove.${this._getEventNamespace()}`,R=>{if(!M)return;const F=D.getAbsolutePosition(),_=F.x-M.x,L=F.y-M.y;this.nodes().forEach(O=>{if(O===D||O.isDragging())return;const B=O.getAbsolutePosition();O.setAbsolutePosition({x:B.x+_,y:B.y+L}),O.startDrag(R)}),M=null})}getNodes(){return this._nodes||[]}getActiveAnchor(){return this._movingAnchorName}detach(){this._nodes&&this._nodes.forEach(D=>{D.off("."+this._getEventNamespace())}),this._nodes=[],this._resetTransformCache()}_resetTransformCache(){this._clearCache(f),this._clearCache("transform"),this._clearSelfAndDescendantCache("absoluteTransform")}_getNodeRect(){return this._getCache(f,this.__getNodeRect)}__getNodeShape(D,M=this.rotation(),R){var F=D.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),_=D.getAbsoluteScale(R),L=D.getAbsolutePosition(R),O=F.x*_.x-D.offsetX()*_.x,B=F.y*_.y-D.offsetY()*_.y;const z=(a.Konva.getAngle(D.getAbsoluteRotation())+Math.PI*2)%(Math.PI*2),ee={x:L.x+O*Math.cos(z)+B*Math.sin(-z),y:L.y+B*Math.cos(z)+O*Math.sin(z),width:F.width*_.x,height:F.height*_.y,rotation:z};return x(ee,-a.Konva.getAngle(M),{x:0,y:0})}__getNodeRect(){var D=this.getNode();if(!D)return{x:-1e8,y:-1e8,width:0,height:0,rotation:0};const M=[];this.nodes().map(z=>{const ee=z.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()});var ne=[{x:ee.x,y:ee.y},{x:ee.x+ee.width,y:ee.y},{x:ee.x+ee.width,y:ee.y+ee.height},{x:ee.x,y:ee.y+ee.height}],re=z.getAbsoluteTransform();ne.forEach(function(te){var H=re.point(te);M.push(H)})});const R=new e.Transform;R.rotate(-a.Konva.getAngle(this.rotation()));var F=1/0,_=1/0,L=-1/0,O=-1/0;M.forEach(function(z){var ee=R.point(z);F===void 0&&(F=L=ee.x,_=O=ee.y),F=Math.min(F,ee.x),_=Math.min(_,ee.y),L=Math.max(L,ee.x),O=Math.max(O,ee.y)}),R.invert();const B=R.point({x:F,y:_});return{x:B.x,y:B.y,width:L-F,height:O-_,rotation:a.Konva.getAngle(this.rotation())}}getX(){return this._getNodeRect().x}getY(){return this._getNodeRect().y}getWidth(){return this._getNodeRect().width}getHeight(){return this._getNodeRect().height}_createElements(){this._createBack(),b.forEach(D=>{this._createAnchor(D)}),this._createAnchor("rotater")}_createAnchor(D){var M=new i.Rect({stroke:"rgb(0, 161, 255)",fill:"white",strokeWidth:1,name:D+" _anchor",dragDistance:0,draggable:!0,hitStrokeWidth:m?10:"auto"}),R=this;M.on("mousedown touchstart",function(F){R._handleMouseDown(F)}),M.on("dragstart",F=>{M.stopDrag(),F.cancelBubble=!0}),M.on("dragend",F=>{F.cancelBubble=!0}),M.on("mouseenter",()=>{var F=a.Konva.getAngle(this.rotation()),_=this.rotateAnchorCursor(),L=y(D,F,_);M.getStage().content&&(M.getStage().content.style.cursor=L),this._cursorChange=!0}),M.on("mouseout",()=>{M.getStage().content&&(M.getStage().content.style.cursor=""),this._cursorChange=!1}),this.add(M)}_createBack(){var D=new s.Shape({name:"back",width:0,height:0,draggable:!0,sceneFunc(M,R){var F=R.getParent(),_=F.padding();M.beginPath(),M.rect(-_,-_,R.width()+_*2,R.height()+_*2),M.moveTo(R.width()/2,-_),F.rotateEnabled()&&F.rotateLineVisible()&&M.lineTo(R.width()/2,-F.rotateAnchorOffset()*e.Util._sign(R.height())-_),M.fillStrokeShape(R)},hitFunc:(M,R)=>{if(this.shouldOverdrawWholeArea()){var F=this.padding();M.beginPath(),M.rect(-F,-F,R.width()+F*2,R.height()+F*2),M.fillStrokeShape(R)}}});this.add(D),this._proxyDrag(D),D.on("dragstart",M=>{M.cancelBubble=!0}),D.on("dragmove",M=>{M.cancelBubble=!0}),D.on("dragend",M=>{M.cancelBubble=!0}),this.on("dragmove",M=>{this.update()})}_handleMouseDown(D){if(!this._transforming){this._movingAnchorName=D.target.name().split(" ")[0];var M=this._getNodeRect(),R=M.width,F=M.height,_=Math.sqrt(Math.pow(R,2)+Math.pow(F,2));this.sin=Math.abs(F/_),this.cos=Math.abs(R/_),typeof window<"u"&&(window.addEventListener("mousemove",this._handleMouseMove),window.addEventListener("touchmove",this._handleMouseMove),window.addEventListener("mouseup",this._handleMouseUp,!0),window.addEventListener("touchend",this._handleMouseUp,!0)),this._transforming=!0;var L=D.target.getAbsolutePosition(),O=D.target.getStage().getPointerPosition();this._anchorDragOffset={x:O.x-L.x,y:O.y-L.y},S++,this._fire("transformstart",{evt:D.evt,target:this.getNode()}),this._nodes.forEach(B=>{B._fire("transformstart",{evt:D.evt,target:B})})}}_handleMouseMove(D){var M,R,F,_=this.findOne("."+this._movingAnchorName),L=_.getStage();L.setPointersPositions(D);const O=L.getPointerPosition();let B={x:O.x-this._anchorDragOffset.x,y:O.y-this._anchorDragOffset.y};const z=_.getAbsolutePosition();this.anchorDragBoundFunc()&&(B=this.anchorDragBoundFunc()(z,B,D)),_.setAbsolutePosition(B);const ee=_.getAbsolutePosition();if(!(z.x===ee.x&&z.y===ee.y)){if(this._movingAnchorName==="rotater"){var ne=this._getNodeRect();M=_.x()-ne.width/2,R=-_.y()+ne.height/2;let $e=Math.atan2(-R,M)+Math.PI/2;ne.height<0&&($e-=Math.PI);var re=a.Konva.getAngle(this.rotation());const Z=re+$e,se=a.Konva.getAngle(this.rotationSnapTolerance()),ve=w(this.rotationSnaps(),Z,se)-ne.rotation,ye=v(ne,ve);this._fitNodesInto(ye,D);return}var te=this.shiftBehavior(),H;te==="inverted"?H=this.keepRatio()&&!D.shiftKey:te==="none"?H=this.keepRatio():H=this.keepRatio()||D.shiftKey;var $=this.centeredScaling()||D.altKey;if(this._movingAnchorName==="top-left"){if(H){var V=$?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-right").x(),y:this.findOne(".bottom-right").y()};F=Math.sqrt(Math.pow(V.x-_.x(),2)+Math.pow(V.y-_.y(),2));var X=this.findOne(".top-left").x()>V.x?-1:1,W=this.findOne(".top-left").y()>V.y?-1:1;M=F*this.cos*X,R=F*this.sin*W,this.findOne(".top-left").x(V.x-M),this.findOne(".top-left").y(V.y-R)}}else if(this._movingAnchorName==="top-center")this.findOne(".top-left").y(_.y());else if(this._movingAnchorName==="top-right"){if(H){var V=$?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-left").x(),y:this.findOne(".bottom-left").y()};F=Math.sqrt(Math.pow(_.x()-V.x,2)+Math.pow(V.y-_.y(),2));var X=this.findOne(".top-right").x()<V.x?-1:1,W=this.findOne(".top-right").y()>V.y?-1:1;M=F*this.cos*X,R=F*this.sin*W,this.findOne(".top-right").x(V.x+M),this.findOne(".top-right").y(V.y-R)}var Y=_.position();this.findOne(".top-left").y(Y.y),this.findOne(".bottom-right").x(Y.x)}else if(this._movingAnchorName==="middle-left")this.findOne(".top-left").x(_.x());else if(this._movingAnchorName==="middle-right")this.findOne(".bottom-right").x(_.x());else if(this._movingAnchorName==="bottom-left"){if(H){var V=$?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-right").x(),y:this.findOne(".top-right").y()};F=Math.sqrt(Math.pow(V.x-_.x(),2)+Math.pow(_.y()-V.y,2));var X=V.x<_.x()?-1:1,W=_.y()<V.y?-1:1;M=F*this.cos*X,R=F*this.sin*W,_.x(V.x-M),_.y(V.y+R)}Y=_.position(),this.findOne(".top-left").x(Y.x),this.findOne(".bottom-right").y(Y.y)}else if(this._movingAnchorName==="bottom-center")this.findOne(".bottom-right").y(_.y());else if(this._movingAnchorName==="bottom-right"){if(H){var V=$?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-left").x(),y:this.findOne(".top-left").y()};F=Math.sqrt(Math.pow(_.x()-V.x,2)+Math.pow(_.y()-V.y,2));var X=this.findOne(".bottom-right").x()<V.x?-1:1,W=this.findOne(".bottom-right").y()<V.y?-1:1;M=F*this.cos*X,R=F*this.sin*W,this.findOne(".bottom-right").x(V.x+M),this.findOne(".bottom-right").y(V.y+R)}}else console.error(new Error("Wrong position argument of selection resizer: "+this._movingAnchorName));var $=this.centeredScaling()||D.altKey;if($){var N=this.findOne(".top-left"),U=this.findOne(".bottom-right"),ie=N.x(),ue=N.y(),xe=this.getWidth()-U.x(),Me=this.getHeight()-U.y();U.move({x:-ie,y:-ue}),N.move({x:xe,y:Me})}var je=this.findOne(".top-left").getAbsolutePosition();M=je.x,R=je.y;var Fe=this.findOne(".bottom-right").x()-this.findOne(".top-left").x(),nt=this.findOne(".bottom-right").y()-this.findOne(".top-left").y();this._fitNodesInto({x:M,y:R,width:Fe,height:nt,rotation:a.Konva.getAngle(this.rotation())},D)}}_handleMouseUp(D){this._removeEvents(D)}getAbsoluteTransform(){return this.getTransform()}_removeEvents(D){var M;if(this._transforming){this._transforming=!1,typeof window<"u"&&(window.removeEventListener("mousemove",this._handleMouseMove),window.removeEventListener("touchmove",this._handleMouseMove),window.removeEventListener("mouseup",this._handleMouseUp,!0),window.removeEventListener("touchend",this._handleMouseUp,!0));var R=this.getNode();S--,this._fire("transformend",{evt:D,target:R}),(M=this.getLayer())===null||M===void 0||M.batchDraw(),R&&this._nodes.forEach(F=>{var _;F._fire("transformend",{evt:D,target:F}),(_=F.getLayer())===null||_===void 0||_.batchDraw()}),this._movingAnchorName=null}}_fitNodesInto(D,M){var R=this._getNodeRect();const F=1;if(e.Util._inRange(D.width,-this.padding()*2-F,F)){this.update();return}if(e.Util._inRange(D.height,-this.padding()*2-F,F)){this.update();return}var _=new e.Transform;if(_.rotate(a.Konva.getAngle(this.rotation())),this._movingAnchorName&&D.width<0&&this._movingAnchorName.indexOf("left")>=0){const re=_.point({x:-this.padding()*2,y:0});D.x+=re.x,D.y+=re.y,D.width+=this.padding()*2,this._movingAnchorName=this._movingAnchorName.replace("left","right"),this._anchorDragOffset.x-=re.x,this._anchorDragOffset.y-=re.y}else if(this._movingAnchorName&&D.width<0&&this._movingAnchorName.indexOf("right")>=0){const re=_.point({x:this.padding()*2,y:0});this._movingAnchorName=this._movingAnchorName.replace("right","left"),this._anchorDragOffset.x-=re.x,this._anchorDragOffset.y-=re.y,D.width+=this.padding()*2}if(this._movingAnchorName&&D.height<0&&this._movingAnchorName.indexOf("top")>=0){const re=_.point({x:0,y:-this.padding()*2});D.x+=re.x,D.y+=re.y,this._movingAnchorName=this._movingAnchorName.replace("top","bottom"),this._anchorDragOffset.x-=re.x,this._anchorDragOffset.y-=re.y,D.height+=this.padding()*2}else if(this._movingAnchorName&&D.height<0&&this._movingAnchorName.indexOf("bottom")>=0){const re=_.point({x:0,y:this.padding()*2});this._movingAnchorName=this._movingAnchorName.replace("bottom","top"),this._anchorDragOffset.x-=re.x,this._anchorDragOffset.y-=re.y,D.height+=this.padding()*2}if(this.boundBoxFunc()){const re=this.boundBoxFunc()(R,D);re?D=re:e.Util.warn("boundBoxFunc returned falsy. You should return new bound rect from it!")}const L=1e7,O=new e.Transform;O.translate(R.x,R.y),O.rotate(R.rotation),O.scale(R.width/L,R.height/L);const B=new e.Transform,z=D.width/L,ee=D.height/L;this.flipEnabled()===!1?(B.translate(D.x,D.y),B.rotate(D.rotation),B.translate(D.width<0?D.width:0,D.height<0?D.height:0),B.scale(Math.abs(z),Math.abs(ee))):(B.translate(D.x,D.y),B.rotate(D.rotation),B.scale(z,ee));const ne=B.multiply(O.invert());this._nodes.forEach(re=>{var te;const H=re.getParent().getAbsoluteTransform(),V=re.getTransform().copy();V.translate(re.offsetX(),re.offsetY());const X=new e.Transform;X.multiply(H.copy().invert()).multiply(ne).multiply(H).multiply(V);const W=X.decompose();re.setAttrs(W),(te=re.getLayer())===null||te===void 0||te.batchDraw()}),this.rotation(e.Util._getRotation(D.rotation)),this._nodes.forEach(re=>{this._fire("transform",{evt:M,target:re}),re._fire("transform",{evt:M,target:re})}),this._resetTransformCache(),this.update(),this.getLayer().batchDraw()}forceUpdate(){this._resetTransformCache(),this.update()}_batchChangeChild(D,M){this.findOne(D).setAttrs(M)}update(){var D,M=this._getNodeRect();this.rotation(e.Util._getRotation(M.rotation));var R=M.width,F=M.height,_=this.enabledAnchors(),L=this.resizeEnabled(),O=this.padding(),B=this.anchorSize();const z=this.find("._anchor");z.forEach(ne=>{ne.setAttrs({width:B,height:B,offsetX:B/2,offsetY:B/2,stroke:this.anchorStroke(),strokeWidth:this.anchorStrokeWidth(),fill:this.anchorFill(),cornerRadius:this.anchorCornerRadius()})}),this._batchChangeChild(".top-left",{x:0,y:0,offsetX:B/2+O,offsetY:B/2+O,visible:L&&_.indexOf("top-left")>=0}),this._batchChangeChild(".top-center",{x:R/2,y:0,offsetY:B/2+O,visible:L&&_.indexOf("top-center")>=0}),this._batchChangeChild(".top-right",{x:R,y:0,offsetX:B/2-O,offsetY:B/2+O,visible:L&&_.indexOf("top-right")>=0}),this._batchChangeChild(".middle-left",{x:0,y:F/2,offsetX:B/2+O,visible:L&&_.indexOf("middle-left")>=0}),this._batchChangeChild(".middle-right",{x:R,y:F/2,offsetX:B/2-O,visible:L&&_.indexOf("middle-right")>=0}),this._batchChangeChild(".bottom-left",{x:0,y:F,offsetX:B/2+O,offsetY:B/2-O,visible:L&&_.indexOf("bottom-left")>=0}),this._batchChangeChild(".bottom-center",{x:R/2,y:F,offsetY:B/2-O,visible:L&&_.indexOf("bottom-center")>=0}),this._batchChangeChild(".bottom-right",{x:R,y:F,offsetX:B/2-O,offsetY:B/2-O,visible:L&&_.indexOf("bottom-right")>=0}),this._batchChangeChild(".rotater",{x:R/2,y:-this.rotateAnchorOffset()*e.Util._sign(F)-O,visible:this.rotateEnabled()}),this._batchChangeChild(".back",{width:R,height:F,visible:this.borderEnabled(),stroke:this.borderStroke(),strokeWidth:this.borderStrokeWidth(),dash:this.borderDash(),x:0,y:0});const ee=this.anchorStyleFunc();ee&&z.forEach(ne=>{ee(ne)}),(D=this.getLayer())===null||D===void 0||D.batchDraw()}isTransforming(){return this._transforming}stopTransform(){if(this._transforming){this._removeEvents();var D=this.findOne("."+this._movingAnchorName);D&&D.stopDrag()}}destroy(){return this.getStage()&&this._cursorChange&&this.getStage().content&&(this.getStage().content.style.cursor=""),o.Group.prototype.destroy.call(this),this.detach(),this._removeEvents(),this}toObject(){return n.Node.prototype.toObject.call(this)}clone(D){var M=n.Node.prototype.clone.call(this,D);return M}getClientRect(){return this.nodes().length>0?super.getClientRect():{x:0,y:0,width:0,height:0}}};vh.Transformer=j,j.isTransforming=()=>S>0;function P(E){return E instanceof Array||e.Util.warn("enabledAnchors value should be an array"),E instanceof Array&&E.forEach(function(D){b.indexOf(D)===-1&&e.Util.warn("Unknown anchor name: "+D+". Available names are: "+b.join(", "))}),E||[]}return j.prototype.className="Transformer",(0,c._registerNode)(j),t.Factory.addGetterSetter(j,"enabledAnchors",b,P),t.Factory.addGetterSetter(j,"flipEnabled",!0,(0,l.getBooleanValidator)()),t.Factory.addGetterSetter(j,"resizeEnabled",!0),t.Factory.addGetterSetter(j,"anchorSize",10,(0,l.getNumberValidator)()),t.Factory.addGetterSetter(j,"rotateEnabled",!0),t.Factory.addGetterSetter(j,"rotateLineVisible",!0),t.Factory.addGetterSetter(j,"rotationSnaps",[]),t.Factory.addGetterSetter(j,"rotateAnchorOffset",50,(0,l.getNumberValidator)()),t.Factory.addGetterSetter(j,"rotateAnchorCursor","crosshair"),t.Factory.addGetterSetter(j,"rotationSnapTolerance",5,(0,l.getNumberValidator)()),t.Factory.addGetterSetter(j,"borderEnabled",!0),t.Factory.addGetterSetter(j,"anchorStroke","rgb(0, 161, 255)"),t.Factory.addGetterSetter(j,"anchorStrokeWidth",1,(0,l.getNumberValidator)()),t.Factory.addGetterSetter(j,"anchorFill","white"),t.Factory.addGetterSetter(j,"anchorCornerRadius",0,(0,l.getNumberValidator)()),t.Factory.addGetterSetter(j,"borderStroke","rgb(0, 161, 255)"),t.Factory.addGetterSetter(j,"borderStrokeWidth",1,(0,l.getNumberValidator)()),t.Factory.addGetterSetter(j,"borderDash"),t.Factory.addGetterSetter(j,"keepRatio",!0),t.Factory.addGetterSetter(j,"shiftBehavior","default"),t.Factory.addGetterSetter(j,"centeredScaling",!1),t.Factory.addGetterSetter(j,"ignoreStroke",!1),t.Factory.addGetterSetter(j,"padding",0,(0,l.getNumberValidator)()),t.Factory.addGetterSetter(j,"node"),t.Factory.addGetterSetter(j,"nodes"),t.Factory.addGetterSetter(j,"boundBoxFunc"),t.Factory.addGetterSetter(j,"anchorDragBoundFunc"),t.Factory.addGetterSetter(j,"anchorStyleFunc"),t.Factory.addGetterSetter(j,"shouldOverdrawWholeArea",!1),t.Factory.addGetterSetter(j,"useSingleNodeRotation",!0),t.Factory.backCompat(j,{lineEnabled:"borderEnabled",rotateHandlerOffset:"rotateAnchorOffset",enabledHandlers:"enabledAnchors"}),vh}var Ch={},U6;function Hpe(){if(U6)return Ch;U6=1,Object.defineProperty(Ch,"__esModule",{value:!0}),Ch.Wedge=void 0;const e=jt(),t=as(),n=St(),s=_t(),i=St();let o=class extends t.Shape{_sceneFunc(l){l.beginPath(),l.arc(0,0,this.radius(),0,n.Konva.getAngle(this.angle()),this.clockwise()),l.lineTo(0,0),l.closePath(),l.fillStrokeShape(this)}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(l){this.radius(l/2)}setHeight(l){this.radius(l/2)}};return Ch.Wedge=o,o.prototype.className="Wedge",o.prototype._centroid=!0,o.prototype._attrsAffectingSize=["radius"],(0,i._registerNode)(o),e.Factory.addGetterSetter(o,"radius",0,(0,s.getNumberValidator)()),e.Factory.addGetterSetter(o,"angle",0,(0,s.getNumberValidator)()),e.Factory.addGetterSetter(o,"clockwise",!1),e.Factory.backCompat(o,{angleDeg:"angle",getAngleDeg:"getAngle",setAngleDeg:"setAngle"}),Ch}var wh={},q6;function Wpe(){if(q6)return wh;q6=1,Object.defineProperty(wh,"__esModule",{value:!0}),wh.Blur=void 0;const e=jt(),t=Ln(),n=_t();function s(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}var i=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],o=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function a(c,d){var h=c.data,f=c.width,p=c.height,g,m,y,b,C,x,v,w,S,j,P,E,D,M,R,F,_,L,O,B,z,ee,ne,re,te=d+d+1,H=f-1,V=p-1,X=d+1,W=X*(X+1)/2,Y=new s,$=null,N=Y,U=null,ie=null,ue=i[d],xe=o[d];for(y=1;y<te;y++)N=N.next=new s,y===X&&($=N);for(N.next=Y,v=x=0,m=0;m<p;m++){for(F=_=L=O=w=S=j=P=0,E=X*(B=h[x]),D=X*(z=h[x+1]),M=X*(ee=h[x+2]),R=X*(ne=h[x+3]),w+=W*B,S+=W*z,j+=W*ee,P+=W*ne,N=Y,y=0;y<X;y++)N.r=B,N.g=z,N.b=ee,N.a=ne,N=N.next;for(y=1;y<X;y++)b=x+((H<y?H:y)<<2),w+=(N.r=B=h[b])*(re=X-y),S+=(N.g=z=h[b+1])*re,j+=(N.b=ee=h[b+2])*re,P+=(N.a=ne=h[b+3])*re,F+=B,_+=z,L+=ee,O+=ne,N=N.next;for(U=Y,ie=$,g=0;g<f;g++)h[x+3]=ne=P*ue>>xe,ne!==0?(ne=255/ne,h[x]=(w*ue>>xe)*ne,h[x+1]=(S*ue>>xe)*ne,h[x+2]=(j*ue>>xe)*ne):h[x]=h[x+1]=h[x+2]=0,w-=E,S-=D,j-=M,P-=R,E-=U.r,D-=U.g,M-=U.b,R-=U.a,b=v+((b=g+d+1)<H?b:H)<<2,F+=U.r=h[b],_+=U.g=h[b+1],L+=U.b=h[b+2],O+=U.a=h[b+3],w+=F,S+=_,j+=L,P+=O,U=U.next,E+=B=ie.r,D+=z=ie.g,M+=ee=ie.b,R+=ne=ie.a,F-=B,_-=z,L-=ee,O-=ne,ie=ie.next,x+=4;v+=f}for(g=0;g<f;g++){for(_=L=O=F=S=j=P=w=0,x=g<<2,E=X*(B=h[x]),D=X*(z=h[x+1]),M=X*(ee=h[x+2]),R=X*(ne=h[x+3]),w+=W*B,S+=W*z,j+=W*ee,P+=W*ne,N=Y,y=0;y<X;y++)N.r=B,N.g=z,N.b=ee,N.a=ne,N=N.next;for(C=f,y=1;y<=d;y++)x=C+g<<2,w+=(N.r=B=h[x])*(re=X-y),S+=(N.g=z=h[x+1])*re,j+=(N.b=ee=h[x+2])*re,P+=(N.a=ne=h[x+3])*re,F+=B,_+=z,L+=ee,O+=ne,N=N.next,y<V&&(C+=f);for(x=g,U=Y,ie=$,m=0;m<p;m++)b=x<<2,h[b+3]=ne=P*ue>>xe,ne>0?(ne=255/ne,h[b]=(w*ue>>xe)*ne,h[b+1]=(S*ue>>xe)*ne,h[b+2]=(j*ue>>xe)*ne):h[b]=h[b+1]=h[b+2]=0,w-=E,S-=D,j-=M,P-=R,E-=U.r,D-=U.g,M-=U.b,R-=U.a,b=g+((b=m+X)<V?b:V)*f<<2,w+=F+=U.r=h[b],S+=_+=U.g=h[b+1],j+=L+=U.b=h[b+2],P+=O+=U.a=h[b+3],U=U.next,E+=B=ie.r,D+=z=ie.g,M+=ee=ie.b,R+=ne=ie.a,F-=B,_-=z,L-=ee,O-=ne,ie=ie.next,x+=f}}const l=function(d){var h=Math.round(this.blurRadius());h>0&&a(d,h)};return wh.Blur=l,e.Factory.addGetterSetter(t.Node,"blurRadius",0,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),wh}var Sh={},K6;function Upe(){if(K6)return Sh;K6=1,Object.defineProperty(Sh,"__esModule",{value:!0}),Sh.Brighten=void 0;const e=jt(),t=Ln(),n=_t(),s=function(i){var o=this.brightness()*255,a=i.data,l=a.length,c;for(c=0;c<l;c+=4)a[c]+=o,a[c+1]+=o,a[c+2]+=o};return Sh.Brighten=s,e.Factory.addGetterSetter(t.Node,"brightness",0,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),Sh}var jh={},Z6;function qpe(){if(Z6)return jh;Z6=1,Object.defineProperty(jh,"__esModule",{value:!0}),jh.Contrast=void 0;const e=jt(),t=Ln(),n=_t(),s=function(i){var o=Math.pow((this.contrast()+100)/100,2),a=i.data,l=a.length,c=150,d=150,h=150,f;for(f=0;f<l;f+=4)c=a[f],d=a[f+1],h=a[f+2],c/=255,c-=.5,c*=o,c+=.5,c*=255,d/=255,d-=.5,d*=o,d+=.5,d*=255,h/=255,h-=.5,h*=o,h+=.5,h*=255,c=c<0?0:c>255?255:c,d=d<0?0:d>255?255:d,h=h<0?0:h>255?255:h,a[f]=c,a[f+1]=d,a[f+2]=h};return jh.Contrast=s,e.Factory.addGetterSetter(t.Node,"contrast",0,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),jh}var kh={},Y6;function Kpe(){if(Y6)return kh;Y6=1,Object.defineProperty(kh,"__esModule",{value:!0}),kh.Emboss=void 0;const e=jt(),t=Ln(),n=En(),s=_t(),i=function(o){var a=this.embossStrength()*10,l=this.embossWhiteLevel()*255,c=this.embossDirection(),d=this.embossBlend(),h=0,f=0,p=o.data,g=o.width,m=o.height,y=g*4,b=m;switch(c){case"top-left":h=-1,f=-1;break;case"top":h=-1,f=0;break;case"top-right":h=-1,f=1;break;case"right":h=0,f=1;break;case"bottom-right":h=1,f=1;break;case"bottom":h=1,f=0;break;case"bottom-left":h=1,f=-1;break;case"left":h=0,f=-1;break;default:n.Util.error("Unknown emboss direction: "+c)}do{var C=(b-1)*y,x=h;b+x<1&&(x=0),b+x>m&&(x=0);var v=(b-1+x)*g*4,w=g;do{var S=C+(w-1)*4,j=f;w+j<1&&(j=0),w+j>g&&(j=0);var P=v+(w-1+j)*4,E=p[S]-p[P],D=p[S+1]-p[P+1],M=p[S+2]-p[P+2],R=E,F=R>0?R:-R,_=D>0?D:-D,L=M>0?M:-M;if(_>F&&(R=D),L>F&&(R=M),R*=a,d){var O=p[S]+R,B=p[S+1]+R,z=p[S+2]+R;p[S]=O>255?255:O<0?0:O,p[S+1]=B>255?255:B<0?0:B,p[S+2]=z>255?255:z<0?0:z}else{var ee=l-R;ee<0?ee=0:ee>255&&(ee=255),p[S]=p[S+1]=p[S+2]=ee}}while(--w)}while(--b)};return kh.Emboss=i,e.Factory.addGetterSetter(t.Node,"embossStrength",.5,(0,s.getNumberValidator)(),e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"embossWhiteLevel",.5,(0,s.getNumberValidator)(),e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"embossDirection","top-left",null,e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"embossBlend",!1,null,e.Factory.afterSetFilter),kh}var _h={},X6;function Zpe(){if(X6)return _h;X6=1,Object.defineProperty(_h,"__esModule",{value:!0}),_h.Enhance=void 0;const e=jt(),t=Ln(),n=_t();function s(o,a,l,c,d){var h=l-a,f=d-c,p;return h===0?c+f/2:f===0?c:(p=(o-a)/h,p=f*p+c,p)}const i=function(o){var a=o.data,l=a.length,c=a[0],d=c,h,f=a[1],p=f,g,m=a[2],y=m,b,C,x=this.enhance();if(x!==0){for(C=0;C<l;C+=4)h=a[C+0],h<c?c=h:h>d&&(d=h),g=a[C+1],g<f?f=g:g>p&&(p=g),b=a[C+2],b<m?m=b:b>y&&(y=b);d===c&&(d=255,c=0),p===f&&(p=255,f=0),y===m&&(y=255,m=0);var v,w,S,j,P,E,D,M,R;for(x>0?(w=d+x*(255-d),S=c-x*(c-0),P=p+x*(255-p),E=f-x*(f-0),M=y+x*(255-y),R=m-x*(m-0)):(v=(d+c)*.5,w=d+x*(d-v),S=c+x*(c-v),j=(p+f)*.5,P=p+x*(p-j),E=f+x*(f-j),D=(y+m)*.5,M=y+x*(y-D),R=m+x*(m-D)),C=0;C<l;C+=4)a[C+0]=s(a[C+0],c,d,S,w),a[C+1]=s(a[C+1],f,p,E,P),a[C+2]=s(a[C+2],m,y,R,M)}};return _h.Enhance=i,e.Factory.addGetterSetter(t.Node,"enhance",0,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),_h}var Ih={},Q6;function Ype(){if(Q6)return Ih;Q6=1,Object.defineProperty(Ih,"__esModule",{value:!0}),Ih.Grayscale=void 0;const e=function(t){var n=t.data,s=n.length,i,o;for(i=0;i<s;i+=4)o=.34*n[i]+.5*n[i+1]+.16*n[i+2],n[i]=o,n[i+1]=o,n[i+2]=o};return Ih.Grayscale=e,Ih}var Th={},J6;function Xpe(){if(J6)return Th;J6=1,Object.defineProperty(Th,"__esModule",{value:!0}),Th.HSL=void 0;const e=jt(),t=Ln(),n=_t();e.Factory.addGetterSetter(t.Node,"hue",0,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"saturation",0,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"luminance",0,(0,n.getNumberValidator)(),e.Factory.afterSetFilter);const s=function(i){var o=i.data,a=o.length,l=1,c=Math.pow(2,this.saturation()),d=Math.abs(this.hue()+360)%360,h=this.luminance()*127,f,p=l*c*Math.cos(d*Math.PI/180),g=l*c*Math.sin(d*Math.PI/180),m=.299*l+.701*p+.167*g,y=.587*l-.587*p+.33*g,b=.114*l-.114*p-.497*g,C=.299*l-.299*p-.328*g,x=.587*l+.413*p+.035*g,v=.114*l-.114*p+.293*g,w=.299*l-.3*p+1.25*g,S=.587*l-.586*p-1.05*g,j=.114*l+.886*p-.2*g,P,E,D,M;for(f=0;f<a;f+=4)P=o[f+0],E=o[f+1],D=o[f+2],M=o[f+3],o[f+0]=m*P+y*E+b*D+h,o[f+1]=C*P+x*E+v*D+h,o[f+2]=w*P+S*E+j*D+h,o[f+3]=M};return Th.HSL=s,Th}var Ah={},eT;function Qpe(){if(eT)return Ah;eT=1,Object.defineProperty(Ah,"__esModule",{value:!0}),Ah.HSV=void 0;const e=jt(),t=Ln(),n=_t(),s=function(i){var o=i.data,a=o.length,l=Math.pow(2,this.value()),c=Math.pow(2,this.saturation()),d=Math.abs(this.hue()+360)%360,h,f=l*c*Math.cos(d*Math.PI/180),p=l*c*Math.sin(d*Math.PI/180),g=.299*l+.701*f+.167*p,m=.587*l-.587*f+.33*p,y=.114*l-.114*f-.497*p,b=.299*l-.299*f-.328*p,C=.587*l+.413*f+.035*p,x=.114*l-.114*f+.293*p,v=.299*l-.3*f+1.25*p,w=.587*l-.586*f-1.05*p,S=.114*l+.886*f-.2*p,j,P,E,D;for(h=0;h<a;h+=4)j=o[h+0],P=o[h+1],E=o[h+2],D=o[h+3],o[h+0]=g*j+m*P+y*E,o[h+1]=b*j+C*P+x*E,o[h+2]=v*j+w*P+S*E,o[h+3]=D};return Ah.HSV=s,e.Factory.addGetterSetter(t.Node,"hue",0,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"saturation",0,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"value",0,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),Ah}var Eh={},tT;function Jpe(){if(tT)return Eh;tT=1,Object.defineProperty(Eh,"__esModule",{value:!0}),Eh.Invert=void 0;const e=function(t){var n=t.data,s=n.length,i;for(i=0;i<s;i+=4)n[i]=255-n[i],n[i+1]=255-n[i+1],n[i+2]=255-n[i+2]};return Eh.Invert=e,Eh}var Mh={},nT;function ege(){if(nT)return Mh;nT=1,Object.defineProperty(Mh,"__esModule",{value:!0}),Mh.Kaleidoscope=void 0;const e=jt(),t=Ln(),n=En(),s=_t();var i=function(l,c,d){var h=l.data,f=c.data,p=l.width,g=l.height,m=d.polarCenterX||p/2,y=d.polarCenterY||g/2,b,C,x,v=0,w=0,S=0,j=0,P,E=Math.sqrt(m*m+y*y);C=p-m,x=g-y,P=Math.sqrt(C*C+x*x),E=P>E?P:E;var D=g,M=p,R,F,_=360/M*Math.PI/180,L,O;for(F=0;F<M;F+=1)for(L=Math.sin(F*_),O=Math.cos(F*_),R=0;R<D;R+=1)C=Math.floor(m+E*R/D*O),x=Math.floor(y+E*R/D*L),b=(x*p+C)*4,v=h[b+0],w=h[b+1],S=h[b+2],j=h[b+3],b=(F+R*p)*4,f[b+0]=v,f[b+1]=w,f[b+2]=S,f[b+3]=j},o=function(l,c,d){var h=l.data,f=c.data,p=l.width,g=l.height,m=d.polarCenterX||p/2,y=d.polarCenterY||g/2,b,C,x,v,w,S=0,j=0,P=0,E=0,D,M=Math.sqrt(m*m+y*y);C=p-m,x=g-y,D=Math.sqrt(C*C+x*x),M=D>M?D:M;var R=g,F=p,_,L,O=0,B,z;for(C=0;C<p;C+=1)for(x=0;x<g;x+=1)v=C-m,w=x-y,_=Math.sqrt(v*v+w*w)*R/M,L=(Math.atan2(w,v)*180/Math.PI+360+O)%360,L=L*F/360,B=Math.floor(L),z=Math.floor(_),b=(z*p+B)*4,S=h[b+0],j=h[b+1],P=h[b+2],E=h[b+3],b=(x*p+C)*4,f[b+0]=S,f[b+1]=j,f[b+2]=P,f[b+3]=E};const a=function(l){var c=l.width,d=l.height,h,f,p,g,m,y,b,C,x,v,w=Math.round(this.kaleidoscopePower()),S=Math.round(this.kaleidoscopeAngle()),j=Math.floor(c*(S%360)/360);if(!(w<1)){var P=n.Util.createCanvasElement();P.width=c,P.height=d;var E=P.getContext("2d").getImageData(0,0,c,d);n.Util.releaseCanvas(P),i(l,E,{polarCenterX:c/2,polarCenterY:d/2});for(var D=c/Math.pow(2,w);D<=8;)D=D*2,w-=1;D=Math.ceil(D);var M=D,R=0,F=M,_=1;for(j+D>c&&(R=M,F=0,_=-1),f=0;f<d;f+=1)for(h=R;h!==F;h+=_)p=Math.round(h+j)%c,x=(c*f+p)*4,m=E.data[x+0],y=E.data[x+1],b=E.data[x+2],C=E.data[x+3],v=(c*f+h)*4,E.data[v+0]=m,E.data[v+1]=y,E.data[v+2]=b,E.data[v+3]=C;for(f=0;f<d;f+=1)for(M=Math.floor(D),g=0;g<w;g+=1){for(h=0;h<M+1;h+=1)x=(c*f+h)*4,m=E.data[x+0],y=E.data[x+1],b=E.data[x+2],C=E.data[x+3],v=(c*f+M*2-h-1)*4,E.data[v+0]=m,E.data[v+1]=y,E.data[v+2]=b,E.data[v+3]=C;M*=2}o(E,l,{})}};return Mh.Kaleidoscope=a,e.Factory.addGetterSetter(t.Node,"kaleidoscopePower",2,(0,s.getNumberValidator)(),e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"kaleidoscopeAngle",0,(0,s.getNumberValidator)(),e.Factory.afterSetFilter),Mh}var Ph={},sT;function tge(){if(sT)return Ph;sT=1,Object.defineProperty(Ph,"__esModule",{value:!0}),Ph.Mask=void 0;const e=jt(),t=Ln(),n=_t();function s(p,g,m){var y=(m*p.width+g)*4,b=[];return b.push(p.data[y++],p.data[y++],p.data[y++],p.data[y++]),b}function i(p,g){return Math.sqrt(Math.pow(p[0]-g[0],2)+Math.pow(p[1]-g[1],2)+Math.pow(p[2]-g[2],2))}function o(p){for(var g=[0,0,0],m=0;m<p.length;m++)g[0]+=p[m][0],g[1]+=p[m][1],g[2]+=p[m][2];return g[0]/=p.length,g[1]/=p.length,g[2]/=p.length,g}function a(p,g){var m=s(p,0,0),y=s(p,p.width-1,0),b=s(p,0,p.height-1),C=s(p,p.width-1,p.height-1),x=g||10;if(i(m,y)<x&&i(y,C)<x&&i(C,b)<x&&i(b,m)<x){for(var v=o([y,m,C,b]),w=[],S=0;S<p.width*p.height;S++){var j=i(v,[p.data[S*4],p.data[S*4+1],p.data[S*4+2]]);w[S]=j<x?0:255}return w}}function l(p,g){for(var m=0;m<p.width*p.height;m++)p.data[4*m+3]=g[m]}function c(p,g,m){for(var y=[1,1,1,1,0,1,1,1,1],b=Math.round(Math.sqrt(y.length)),C=Math.floor(b/2),x=[],v=0;v<m;v++)for(var w=0;w<g;w++){for(var S=v*g+w,j=0,P=0;P<b;P++)for(var E=0;E<b;E++){var D=v+P-C,M=w+E-C;if(D>=0&&D<m&&M>=0&&M<g){var R=D*g+M,F=y[P*b+E];j+=p[R]*F}}x[S]=j===255*8?255:0}return x}function d(p,g,m){for(var y=[1,1,1,1,1,1,1,1,1],b=Math.round(Math.sqrt(y.length)),C=Math.floor(b/2),x=[],v=0;v<m;v++)for(var w=0;w<g;w++){for(var S=v*g+w,j=0,P=0;P<b;P++)for(var E=0;E<b;E++){var D=v+P-C,M=w+E-C;if(D>=0&&D<m&&M>=0&&M<g){var R=D*g+M,F=y[P*b+E];j+=p[R]*F}}x[S]=j>=255*4?255:0}return x}function h(p,g,m){for(var y=[.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111],b=Math.round(Math.sqrt(y.length)),C=Math.floor(b/2),x=[],v=0;v<m;v++)for(var w=0;w<g;w++){for(var S=v*g+w,j=0,P=0;P<b;P++)for(var E=0;E<b;E++){var D=v+P-C,M=w+E-C;if(D>=0&&D<m&&M>=0&&M<g){var R=D*g+M,F=y[P*b+E];j+=p[R]*F}}x[S]=j}return x}const f=function(p){var g=this.threshold(),m=a(p,g);return m&&(m=c(m,p.width,p.height),m=d(m,p.width,p.height),m=h(m,p.width,p.height),l(p,m)),p};return Ph.Mask=f,e.Factory.addGetterSetter(t.Node,"threshold",0,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),Ph}var Lh={},rT;function nge(){if(rT)return Lh;rT=1,Object.defineProperty(Lh,"__esModule",{value:!0}),Lh.Noise=void 0;const e=jt(),t=Ln(),n=_t(),s=function(i){var o=this.noise()*255,a=i.data,l=a.length,c=o/2,d;for(d=0;d<l;d+=4)a[d+0]+=c-2*c*Math.random(),a[d+1]+=c-2*c*Math.random(),a[d+2]+=c-2*c*Math.random()};return Lh.Noise=s,e.Factory.addGetterSetter(t.Node,"noise",.2,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),Lh}var Dh={},iT;function sge(){if(iT)return Dh;iT=1,Object.defineProperty(Dh,"__esModule",{value:!0}),Dh.Pixelate=void 0;const e=jt(),t=En(),n=Ln(),s=_t(),i=function(o){var a=Math.ceil(this.pixelSize()),l=o.width,c=o.height,d,h,f,p,g,m,y,b=Math.ceil(l/a),C=Math.ceil(c/a),x,v,w,S,j,P,E,D=o.data;if(a<=0){t.Util.error("pixelSize value can not be <= 0");return}for(j=0;j<b;j+=1)for(P=0;P<C;P+=1){for(p=0,g=0,m=0,y=0,x=j*a,v=x+a,w=P*a,S=w+a,E=0,d=x;d<v;d+=1)if(!(d>=l))for(h=w;h<S;h+=1)h>=c||(f=(l*h+d)*4,p+=D[f+0],g+=D[f+1],m+=D[f+2],y+=D[f+3],E+=1);for(p=p/E,g=g/E,m=m/E,y=y/E,d=x;d<v;d+=1)if(!(d>=l))for(h=w;h<S;h+=1)h>=c||(f=(l*h+d)*4,D[f+0]=p,D[f+1]=g,D[f+2]=m,D[f+3]=y)}};return Dh.Pixelate=i,e.Factory.addGetterSetter(n.Node,"pixelSize",8,(0,s.getNumberValidator)(),e.Factory.afterSetFilter),Dh}var Rh={},oT;function rge(){if(oT)return Rh;oT=1,Object.defineProperty(Rh,"__esModule",{value:!0}),Rh.Posterize=void 0;const e=jt(),t=Ln(),n=_t(),s=function(i){var o=Math.round(this.levels()*254)+1,a=i.data,l=a.length,c=255/o,d;for(d=0;d<l;d+=1)a[d]=Math.floor(a[d]/c)*c};return Rh.Posterize=s,e.Factory.addGetterSetter(t.Node,"levels",.5,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),Rh}var Oh={},aT;function ige(){if(aT)return Oh;aT=1,Object.defineProperty(Oh,"__esModule",{value:!0}),Oh.RGB=void 0;const e=jt(),t=Ln(),n=_t(),s=function(i){var o=i.data,a=o.length,l=this.red(),c=this.green(),d=this.blue(),h,f;for(h=0;h<a;h+=4)f=(.34*o[h]+.5*o[h+1]+.16*o[h+2])/255,o[h]=f*l,o[h+1]=f*c,o[h+2]=f*d,o[h+3]=o[h+3]};return Oh.RGB=s,e.Factory.addGetterSetter(t.Node,"red",0,function(i){return this._filterUpToDate=!1,i>255?255:i<0?0:Math.round(i)}),e.Factory.addGetterSetter(t.Node,"green",0,function(i){return this._filterUpToDate=!1,i>255?255:i<0?0:Math.round(i)}),e.Factory.addGetterSetter(t.Node,"blue",0,n.RGBComponent,e.Factory.afterSetFilter),Oh}var Nh={},lT;function oge(){if(lT)return Nh;lT=1,Object.defineProperty(Nh,"__esModule",{value:!0}),Nh.RGBA=void 0;const e=jt(),t=Ln(),n=_t(),s=function(i){var o=i.data,a=o.length,l=this.red(),c=this.green(),d=this.blue(),h=this.alpha(),f,p;for(f=0;f<a;f+=4)p=1-h,o[f]=l*h+o[f]*p,o[f+1]=c*h+o[f+1]*p,o[f+2]=d*h+o[f+2]*p};return Nh.RGBA=s,e.Factory.addGetterSetter(t.Node,"red",0,function(i){return this._filterUpToDate=!1,i>255?255:i<0?0:Math.round(i)}),e.Factory.addGetterSetter(t.Node,"green",0,function(i){return this._filterUpToDate=!1,i>255?255:i<0?0:Math.round(i)}),e.Factory.addGetterSetter(t.Node,"blue",0,n.RGBComponent,e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"alpha",1,function(i){return this._filterUpToDate=!1,i>1?1:i<0?0:i}),Nh}var Fh={},cT;function age(){if(cT)return Fh;cT=1,Object.defineProperty(Fh,"__esModule",{value:!0}),Fh.Sepia=void 0;const e=function(t){var n=t.data,s=n.length,i,o,a,l;for(i=0;i<s;i+=4)o=n[i+0],a=n[i+1],l=n[i+2],n[i+0]=Math.min(255,o*.393+a*.769+l*.189),n[i+1]=Math.min(255,o*.349+a*.686+l*.168),n[i+2]=Math.min(255,o*.272+a*.534+l*.131)};return Fh.Sepia=e,Fh}var Bh={},uT;function lge(){if(uT)return Bh;uT=1,Object.defineProperty(Bh,"__esModule",{value:!0}),Bh.Solarize=void 0;const e=function(t){var n=t.data,s=t.width,i=t.height,o=s*4,a=i;do{var l=(a-1)*o,c=s;do{var d=l+(c-1)*4,h=n[d],f=n[d+1],p=n[d+2];h>127&&(h=255-h),f>127&&(f=255-f),p>127&&(p=255-p),n[d]=h,n[d+1]=f,n[d+2]=p}while(--c)}while(--a)};return Bh.Solarize=e,Bh}var $h={},dT;function cge(){if(dT)return $h;dT=1,Object.defineProperty($h,"__esModule",{value:!0}),$h.Threshold=void 0;const e=jt(),t=Ln(),n=_t(),s=function(i){var o=this.threshold()*255,a=i.data,l=a.length,c;for(c=0;c<l;c+=1)a[c]=a[c]<o?0:255};return $h.Threshold=s,e.Factory.addGetterSetter(t.Node,"threshold",.5,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),$h}var hT;function uge(){if(hT)return eh;hT=1,Object.defineProperty(eh,"__esModule",{value:!0}),eh.Konva=void 0;const e=Epe(),t=Mpe(),n=Lpe(),s=Dpe(),i=Rpe(),o=Ope(),a=Npe(),l=_9(),c=gk(),d=I9(),h=Fpe(),f=Bpe(),p=$pe(),g=Vpe(),m=T9(),y=zpe(),b=Gpe(),C=Hpe(),x=Wpe(),v=Upe(),w=qpe(),S=Kpe(),j=Zpe(),P=Ype(),E=Xpe(),D=Qpe(),M=Jpe(),R=ege(),F=tge(),_=nge(),L=sge(),O=rge(),B=ige(),z=oge(),ee=age(),ne=lge(),re=cge();return eh.Konva=e.Konva.Util._assign(e.Konva,{Arc:t.Arc,Arrow:n.Arrow,Circle:s.Circle,Ellipse:i.Ellipse,Image:o.Image,Label:a.Label,Tag:a.Tag,Line:l.Line,Path:c.Path,Rect:d.Rect,RegularPolygon:h.RegularPolygon,Ring:f.Ring,Sprite:p.Sprite,Star:g.Star,Text:m.Text,TextPath:y.TextPath,Transformer:b.Transformer,Wedge:C.Wedge,Filters:{Blur:x.Blur,Brighten:v.Brighten,Contrast:w.Contrast,Emboss:S.Emboss,Enhance:j.Enhance,Grayscale:P.Grayscale,HSL:E.HSL,HSV:D.HSV,Invert:M.Invert,Kaleidoscope:R.Kaleidoscope,Mask:F.Mask,Noise:_.Noise,Pixelate:L.Pixelate,Posterize:O.Posterize,RGB:B.RGB,RGBA:z.RGBA,Sepia:ee.Sepia,Solarize:ne.Solarize,Threshold:re.Threshold}}),eh}var dge=b0.exports,fT;function hge(){if(fT)return b0.exports;fT=1,Object.defineProperty(dge,"__esModule",{value:!0});const e=uge();return b0.exports=e.Konva,b0.exports}var fge=hge();const Be=Qu(fge);var dv,pT;function pge(){if(pT)return dv;pT=1;var e=function(n){var s=null,i,o=function(c){return function(){s=null,n.apply(c,i)}},a=function(){for(var c=arguments.length,d=new Array(c),h=0;h<c;h++)d[h]=arguments[h];i=d,s===null&&(s=requestAnimationFrame(o(this)))};return a.cancel=function(){cancelAnimationFrame(s),s=null},a};return dv=e,dv}var gge=pge();const A9=Qu(gge),Oo=class Oo extends zt{constructor(n,s,i){super();k(this,"type");k(this,"id");k(this,"path");k(this,"manager");k(this,"parent");k(this,"log");k(this,"entityIdentifier");k(this,"selectIsTypeHidden");k(this,"selectIsSelected");k(this,"konva");k(this,"state");k(this,"subscriptions",new Set);k(this,"$isLocked",Oe(!1));k(this,"$isDisabled",Oe(!1));k(this,"$isEntityTypeHidden",Oe(!1));k(this,"$isEmpty",Oe(!0));k(this,"$canvasCache",Oe(null));k(this,"$isOnScreen",Oe(!0));k(this,"$intersectsBbox",Oe(!1));k(this,"selectState",fe(tt,n=>Qa(n,this.entityIdentifier)));k(this,"selectPosition",fe(this.selectState,n=>n==null?void 0:n.position));k(this,"syncIsOnscreen",()=>{const n=this.manager.stage.getScaledStageRect(),s=this.checkIntersection(n),i=this.$isOnScreen.get();this.$isOnScreen.set(s),i!==s&&this.log.trace(`Moved ${s?"on-screen":"off-screen"}`),this.syncVisibility()});k(this,"syncIntersectsBbox",()=>{const n=this.manager.stateApi.getBbox().rect,s=this.checkIntersection(n),i=this.$intersectsBbox.get();this.$intersectsBbox.set(s),i!==s&&this.log.trace(`Moved ${s?"into bbox":"out of bbox"}`)});k(this,"checkIntersection",n=>{const s=this.transformer.$pixelRect.get(),i=this.manager.stateApi.runSelector(this.selectPosition);if(!i)return!1;const o={x:s.x+i.x,y:s.y+i.y,width:s.width,height:s.height},a=HX(n,o);return a.width>0&&a.height>0});k(this,"initialize",async()=>{this.log.debug("Initializing module"),this.subscriptions.add(this.transformer.$pixelRect.listen(this.syncIsOnscreen)),this.subscriptions.add(this.transformer.$pixelRect.listen(this.syncIntersectsBbox)),await this.sync(this.manager.stateApi.runSelector(this.selectState),void 0),this.transformer.initialize(),await this.renderer.initialize(),this.syncZIndices(),this.syncVisibility(),Oo.runInitCallbacks(this)});k(this,"syncZIndices",()=>{this.log.trace("Updating z-indices");let n=0;this.renderer.konva.objectGroup.zIndex(n++),this.bufferRenderer.konva.group.zIndex(n++),this.renderer.konva.compositing&&this.renderer.konva.compositing.group.zIndex(n++),this.transformer.konva.outlineRect.zIndex(n++),this.transformer.konva.proxyRect.zIndex(n++),this.transformer.konva.transformer.zIndex(n++)});k(this,"syncIsEnabled",()=>{this.log.trace("Updating visibility"),this.$isDisabled.set(!this.state.isEnabled),this.syncVisibility(),this.transformer.syncInteractionState()});k(this,"syncObjects",async()=>{this.$isEmpty.set(this.state.objects.length===0),await this.renderer.render()&&(this.transformer.requestRectCalculation(),this.transformer.syncInteractionState())});k(this,"syncPosition",()=>{this.transformer.updatePosition()});k(this,"syncOpacity",()=>{this.renderer.updateOpacity()});k(this,"syncVisibility",A9(()=>{if(this.manager.stateApi.runSelector(this.selectIsTypeHidden)){this.setVisibility(!1);return}if(this.manager.stateApi.runSelector(E2)){const n=this.manager.stateApi.runSelector(Fn),s=IM(this.entityIdentifier);if(n&&!s){this.setVisibility(!1);return}}if(this.manager.stateApi.runSelector(O0)){const n=this.manager.stateApi.$filteringAdapter.get();if(n&&n!==this){this.setVisibility(!1);return}const s=this.manager.stateApi.$transformingAdapter.get();if(s&&s!==this&&!s.transformer.$silentTransform.get()){this.setVisibility(!1);return}const i=this.manager.stateApi.$segmentingAdapter.get();if(i&&i!==this){this.setVisibility(!1);return}}if(this.$isDisabled.get()){this.setVisibility(!1);return}if(!this.$isOnScreen.get()&&!this.manager.stateApi.getIsSelected(this.entityIdentifier.id)){this.setVisibility(!1);return}this.setVisibility(!0)}));k(this,"setVisibility",n=>{this.konva.layer.visible()!==n&&(this.log.trace(n?"Showing":"Hiding"),this.konva.layer.visible(n),n&&(this.renderer.updateCompositingRectSize(),this.renderer.updateCompositingRectPosition(),this.renderer.updateCompositingRectFill()),this.renderer.syncKonvaCache())});k(this,"syncIsLocked",()=>{this.$isLocked.set(this.state.isLocked),this.transformer.syncInteractionState()});k(this,"hash",n=>{const s={state:this.getHashableState(),extra:n};return Wf(s)});k(this,"cropToBbox",async()=>{const{rect:n}=this.manager.stateApi.getBbox(),s=await fs(()=>this.renderer.rasterize({rect:n,replaceObjects:!0,attrs:{opacity:1,filters:[]}}));if(s.isErr())throw ge({status:"error",title:"Failed to crop to bbox"}),s.error;return s.value});k(this,"destroy",()=>{var n;this.log.debug("Destroying module"),this.subscriptions.forEach(s=>s()),this.subscriptions.clear(),this.renderer.destroy(),this.transformer.$isTransforming.get()&&this.transformer.stopTransform(),this.transformer.destroy(),this.filterer&&(this.filterer.$isFiltering.get()&&this.filterer.cancel(),(n=this.filterer)==null||n.destroy()),this.segmentAnything&&(this.segmentAnything.$isSegmenting.get()&&this.segmentAnything.cancel(),this.segmentAnything.destroy()),this.konva.layer.destroy(),this.manager.deleteAdapter(this.entityIdentifier)});k(this,"repr",()=>{var n,s;return{id:this.id,type:this.type,path:this.path,entityIdentifier:this.entityIdentifier,state:gt(this.state),transformer:this.transformer.repr(),renderer:this.renderer.repr(),bufferRenderer:this.bufferRenderer.repr(),segmentAnything:((n=this.segmentAnything)==null?void 0:n.repr())??null,filterer:((s=this.filterer)==null?void 0:s.repr())??null,hasCache:this.$canvasCache.get()!==null,isLocked:this.$isLocked.get(),isDisabled:this.$isDisabled.get(),isEntityTypeHidden:this.$isEntityTypeHidden.get(),isEmpty:this.$isEmpty.get(),isOnScreen:this.$isOnScreen.get(),intersectsBbox:this.$intersectsBbox.get(),konva:ds(this.konva.layer)}});this.type=i,this.id=n.id,this.entityIdentifier=n,this.manager=s,this.parent=s,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.konva={layer:new Be.Layer({name:`${this.type}:layer`,listening:!1,imageSmoothingEnabled:!1})},this.manager.stage.addLayer(this.konva.layer);const o=this.manager.stateApi.runSelector(this.selectState);we(o!==void 0,"Missing entity state on creation"),this.state=o,this.selectIsTypeHidden=zX(this.entityIdentifier.type),this.selectIsSelected=GX(this.entityIdentifier),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(this.selectIsTypeHidden,this.syncVisibility)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(O0,this.syncVisibility)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(E2,this.syncVisibility)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(Fn,this.syncVisibility)),this.subscriptions.add(this.manager.stateApi.$filteringAdapter.listen(this.syncVisibility)),this.subscriptions.add(this.manager.stateApi.$transformingAdapter.listen(this.syncVisibility)),this.subscriptions.add(this.manager.stateApi.$segmentingAdapter.listen(this.syncVisibility)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(this.selectIsSelected,this.syncVisibility)),this.subscriptions.add(this.$isDisabled.subscribe(this.manager.tool.render)),this.subscriptions.add(this.$isLocked.subscribe(this.manager.tool.render)),this.subscriptions.add(this.$isEntityTypeHidden.subscribe(this.manager.tool.render)),this.subscriptions.add(this.manager.stage.$stageAttrs.listen(this.syncIsOnscreen)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(this.selectPosition,this.syncIsOnscreen)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(Rp,this.syncIntersectsBbox)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(this.selectPosition,this.syncIntersectsBbox))}};k(Oo,"initCallbacks",new Set),k(Oo,"registerInitCallback",n=>{const s=async i=>{const o=await n(i);return o&&Oo.initCallbacks.delete(s),o};Oo.initCallbacks.add(s)}),k(Oo,"runInitCallbacks",n=>{for(const s of Oo.initCallbacks)s(n)});let Kl=Oo;const E9=e=>{const{imageDTO:t,entityIdentifier:n,dispatch:s}=e;s(cS({entityIdentifier:n,imageDTO:t}))},M9=e=>{const{imageDTO:t,entityIdentifier:n,referenceImageId:s,dispatch:i}=e;i(uS({entityIdentifier:n,referenceImageId:s,imageDTO:t}))},mge=e=>{const{imageDTO:t,dispatch:n}=e;n(N0(t))},yge=e=>{const{imageDTO:t,fieldIdentifier:n,dispatch:s}=e;s(M2({...n,value:t}))},bge=e=>{const{imageDTO:t,dispatch:n}=e;n(Op(t))},Yr=e=>{const{type:t,imageDTO:n,dispatch:s,getState:i,overrides:o}=e,a=i(),l=Mi(n),{x:c,y:d}=Rp(a),h={objects:[l],position:{x:c,y:d},...o};switch(t){case"raster_layer":{s(id({overrides:h,isSelected:!0}));break}case"control_layer":{s(Dp({overrides:{...h,controlAdapter:gt(uc)},isSelected:!0}));break}case"inpaint_mask":{s(Cy({overrides:h,isSelected:!0}));break}case"regional_guidance":{s(Va({overrides:h,isSelected:!0}));break}case"reference_image":{const f=gt(Jo(i()));f.image=Wl(n),s(wy({overrides:{ipAdapter:f},isSelected:!0}));break}case"regional_guidance_with_reference_image":{const f=gt(Jo(i()));f.image=Wl(n);const p=[{id:Te("regional_guidance_reference_image"),ipAdapter:f}];s(Va({overrides:{referenceImages:p},isSelected:!0}));break}}},ym=e=>{const{type:t,imageDTO:n,withResize:s,dispatch:i,getState:o}=e,a=o(),l=WX(a),c=n.width/n.height,d=TM(l),{width:h,height:f}=UX(c,d**2,l),p=Mi(n),{x:g,y:m}=Rp(a),y=b=>{Kl.registerInitCallback(async C=>C.id!==b?!1:(await C.transformer.startTransform({silent:!0}),C.transformer.fitToBboxFill(),await C.transformer.applyTransform(),!0))};switch(t){case"raster_layer":{const b={id:Te("raster_layer"),objects:[p],position:{x:g,y:m}};s&&y(b.id),i(Lc()),i(of({x:0,y:0,width:h,height:f})),i(id({overrides:b,isSelected:!0}));break}case"control_layer":{const b={id:Te("control_layer"),objects:[p],position:{x:g,y:m},controlAdapter:gt(uc)};s&&y(b.id),i(Lc()),i(of({x:0,y:0,width:h,height:f})),i(Dp({overrides:b,isSelected:!0}));break}case"inpaint_mask":{const b={id:Te("inpaint_mask"),objects:[p],position:{x:g,y:m}};s&&y(b.id),i(Lc()),i(of({x:0,y:0,width:h,height:f})),i(Cy({overrides:b,isSelected:!0}));break}case"regional_guidance":{const b={id:Te("regional_guidance"),objects:[p],position:{x:g,y:m}};s&&y(b.id),i(Lc()),i(of({x:0,y:0,width:h,height:f})),i(Va({overrides:b,isSelected:!0}));break}case"reference_image":{const b=gt(Jo(o()));b.image=Wl(n),i(Lc()),i(wy({overrides:{ipAdapter:b},isSelected:!0}));break}case"regional_guidance_with_reference_image":{const b=gt(Jo(o()));b.image=Wl(n);const C=[{id:Te("regional_guidance_reference_image"),ipAdapter:b}];i(Lc()),i(Va({overrides:{referenceImages:C},isSelected:!0}));break}default:we(!1)}},mk=e=>{const{imageDTO:t,entityIdentifier:n,dispatch:s,getState:i}=e,o=Mi(t),{x:a,y:l}=Rp(i());s(dS({entityIdentifier:n,imageObject:o,position:{x:a,y:l},replaceObjects:!0,isSelected:!0}))},gT=e=>{const{imageDTOs:t,boardId:n,dispatch:s}=e;s(aS.endpoints.addImagesToBoard.initiate({imageDTOs:t,board_id:n},{track:!1})),s(Sy([]))},mT=e=>{const{imageDTOs:t,dispatch:n}=e;n(aS.endpoints.removeImagesFromBoard.initiate({imageDTOs:t},{track:!1})),n(Sy([]))},yk=Oe(null),xge=e=>yk.set(e),hv=()=>yk.set(null),P9=u.memo(()=>{At("CanvasPasteModal");const{dispatch:e,getState:t}=dn(),{t:n}=A(),s=ae(yk),i=Lt(),o=I(Hs),[a,{isLoading:l}]=AM({fixedCacheKey:"canvasPasteModal"}),c=u.useCallback(g=>{const{x:m,y}=i.stateApi.getBbox().rect;if(g==="bbox")return{x:m,y};const b=i.compositor.getVisibleAdaptersOfType("raster_layer");if(b.length===0)return{x:m,y};{const{x:C,y:x}=i.compositor.getRectOfAdapters(b);return{x:C,y:x}}},[i.compositor,i.stateApi]),d=u.useCallback(async(g,m)=>{try{const b=await a({file:g,is_intermediate:m!=="assets",image_category:"user",board_id:o==="none"?void 0:o}).unwrap();m!=="assets"&&Yr({type:"raster_layer",imageDTO:b,dispatch:e,getState:t,overrides:{position:c(m)}})}catch{ge({title:n("toast.pasteFailed"),status:"error"})}finally{hv(),ge({title:n("toast.pasteSuccess",{destination:n(m==="assets"?"controlLayers.pasteToAssets":m==="bbox"?"controlLayers.pasteToBbox":"controlLayers.pasteToCanvas")}),status:"success"})}},[o,e,c,t,n,a]),h=u.useCallback(()=>{s&&d(s,"assets")},[d,s]),f=u.useCallback(()=>{s&&d(s,"canvas")},[d,s]),p=u.useCallback(()=>{s&&d(s,"bbox")},[d,s]);return r.jsxs(Dr,{isOpen:s!==null,onClose:hv,useInert:!1,isCentered:!0,size:"2xl",children:[r.jsx(ar,{}),r.jsxs(Rr,{children:[r.jsx(lr,{children:n("controlLayers.pasteTo")}),r.jsx(Pi,{}),r.jsx(Ws,{display:"flex",justifyContent:"center",children:r.jsxs(T,{flexDir:"column",gap:4,w:"min-content",children:[r.jsx(de,{size:"lg",onClick:f,isDisabled:l,leftIcon:r.jsx(Gu,{}),children:n("controlLayers.pasteToCanvasDesc")}),r.jsx(de,{size:"lg",onClick:p,isDisabled:l,leftIcon:r.jsx(rl,{}),children:n("controlLayers.pasteToBboxDesc")}),r.jsx(de,{size:"lg",onClick:h,isDisabled:l,variant:"ghost",children:n("controlLayers.pasteToAssetsDesc")})]})}),r.jsx(xo,{children:r.jsx(de,{onClick:hv,variant:"ghost",isLoading:l,children:n("common.cancel")})})]})]})});P9.displayName="CanvasPasteModal";const[L9]=dc(!1),[D9]=dc(!1),R9=()=>{const e=G(),t=Nt(),n=I(Np),s=L9(),i=u.useCallback(()=>{e(qX()),t.open(),e(jr("gallery"))},[e,t]),o=u.useCallback(()=>{if(n){s.setTrue();return}i()},[i,s,n]);return{newGallerySessionImmediate:i,newGallerySessionWithDialog:o}},O9=()=>{const e=G(),t=Nt(),n=I(Np),s=D9(),i=u.useCallback(()=>{e(KX()),t.close(),e(jr("layers"))},[e,t]),o=u.useCallback(()=>{if(n){s.setTrue();return}i()},[i,s,n]);return{newCanvasSessionImmediate:i,newCanvasSessionWithDialog:o}},N9=u.memo(()=>{At("NewGallerySessionDialog");const{t:e}=A(),t=G(),n=L9(),{newGallerySessionImmediate:s}=R9(),i=I(Np),o=u.useCallback(()=>{t(hS())},[t]);return r.jsx(ai,{isOpen:n.isTrue,onClose:n.setFalse,title:e("controlLayers.newGallerySession"),acceptCallback:s,acceptButtonText:e("common.ok"),useInert:!1,children:r.jsxs(T,{direction:"column",gap:3,children:[r.jsx(q,{children:e("controlLayers.newGallerySessionDesc")}),r.jsx(q,{children:e("common.areYouSure")}),r.jsxs(K,{children:[r.jsx(J,{children:e("common.dontAskMeAgain")}),r.jsx(Sn,{isChecked:!i,onChange:o})]})]})})});N9.displayName="NewGallerySessionDialog";const F9=u.memo(()=>{At("NewCanvasSessionDialog");const{t:e}=A(),t=G(),n=D9(),{newCanvasSessionImmediate:s}=O9(),i=I(Np),o=u.useCallback(()=>{t(hS())},[t]);return r.jsx(ai,{isOpen:n.isTrue,onClose:n.setFalse,title:e("controlLayers.newCanvasSession"),acceptCallback:s,acceptButtonText:e("common.ok"),useInert:!1,children:r.jsxs(T,{direction:"column",gap:3,children:[r.jsx(q,{children:e("controlLayers.newCanvasSessionDesc")}),r.jsx(q,{children:e("common.areYouSure")}),r.jsxs(K,{children:[r.jsx(J,{children:e("common.dontAskMeAgain")}),r.jsx(Sn,{isChecked:!i,onChange:o})]})]})})});F9.displayName="NewCanvasSessionDialog";const vge=e=>{const{t}=A(),{imageUsage:n,topMessage:s=t("gallery.currentlyInUse"),bottomMessage:i=t("gallery.featuresWillReset")}=e;return!n||!Ss(n)?null:r.jsxs(r.Fragment,{children:[r.jsx(q,{children:s}),r.jsxs(or,{paddingInlineStart:6,fontSize:"sm",children:[n.isControlLayerImage&&r.jsx(Rt,{children:t("controlLayers.controlLayer")}),n.isReferenceImage&&r.jsx(Rt,{children:t("controlLayers.referenceImage")}),n.isInpaintMaskImage&&r.jsx(Rt,{children:t("controlLayers.inpaintMask")}),n.isRasterLayerImage&&r.jsx(Rt,{children:t("controlLayers.rasterLayer")}),n.isRegionalGuidanceImage&&r.jsx(Rt,{children:t("controlLayers.regionalGuidance")}),n.isUpscaleImage&&r.jsx(Rt,{children:t("ui.tabs.upscalingTab")}),n.isNodesImage&&r.jsx(Rt,{children:t("ui.tabs.workflowsTab")})]}),r.jsx(q,{children:i})]})},B9=u.memo(vge),Cge=hn([MM,Qe,tt,XX,_p],(e,t,n,s,i)=>{const{imagesToDelete:o}=e,a=(o??[]).map(({image_name:c})=>PM(t,n,i,c)),l={isUpscaleImage:Ss(a,c=>c.isUpscaleImage),isRasterLayerImage:Ss(a,c=>c.isRasterLayerImage),isInpaintMaskImage:Ss(a,c=>c.isInpaintMaskImage),isRegionalGuidanceImage:Ss(a,c=>c.isRegionalGuidanceImage),isNodesImage:Ss(a,c=>c.isNodesImage),isControlLayerImage:Ss(a,c=>c.isControlLayerImage),isReferenceImage:Ss(a,c=>c.isReferenceImage)};return{imagesToDelete:o,imagesUsage:s,imageUsageSummary:l}}),wge=fe(yy,e=>e.shouldConfirmOnDelete),Sge=fe(MM,e=>e.isModalOpen),jge=()=>{At("DeleteImageModal");const e=G(),{t}=A(),n=I(wge),s=I(Sge),{imagesToDelete:i,imagesUsage:o,imageUsageSummary:a}=I(Cge),l=u.useCallback(h=>e(EM(!h.target.checked)),[e]),c=u.useCallback(()=>{e(rI()),e(ZX(!1))},[e]),d=u.useCallback(()=>{!i.length||!o.length||(e(rI()),e(YX({imageDTOs:i,imagesUsage:o})))},[e,i,o]);return r.jsx(ai,{title:t("gallery.deleteImage",{count:i.length}),isOpen:s,onClose:c,cancelButtonText:t("common.cancel"),acceptButtonText:t("common.delete"),acceptCallback:d,useInert:!1,children:r.jsxs(T,{direction:"column",gap:3,children:[r.jsx(B9,{imageUsage:a}),r.jsx(wt,{}),r.jsx(q,{children:t("gallery.deleteImagePermanent")}),r.jsx(q,{children:t("common.areYouSure")}),r.jsxs(K,{children:[r.jsx(J,{children:t("common.dontAskMeAgain")}),r.jsx(et,{isChecked:!n,onChange:l})]})]})})},kge=u.memo(jge);function yT(e){var t=e.source;return t.types.includes("Files")}function _ge(e){var t=e.source;return t.items.filter(function(n){return n.kind==="file"}).map(function(n){return n.getAsFile()}).filter(function(n){return n!=null})}function bT(e){e.defaultPrevented||(e.dataTransfer&&(e.dataTransfer.dropEffect="move"),e.preventDefault())}var TC=null;function Ige(){df(),TC=po.bindAll(window,[{type:"dragover",listener:bT},{type:"dragenter",listener:bT},{type:"drop",listener:function(t){t.preventDefault(),df()}},{type:"dragend",listener:df}].concat(Zy(yj({onDragEnd:df}))),{capture:!1})}function df(){var e;(e=TC)===null||e===void 0||e(),TC=null}function Tge(){var e;if(((e=window.event)===null||e===void 0?void 0:e.type)==="drop"){var t;(t=window.event)===null||t===void 0||t.preventDefault()}df()}var xT={start:Ige,stop:Tge};const Age=e=>typeof e=="object"&&e!==null&&"fullUrl"in e&&"thumbnailUrl"in e,$9=()=>{const e=G(),t=I(Hs),n=ae(rd),[s]=QX();return u.useCallback(async(o,a)=>{const l=new Image,c=URL.createObjectURL(o);l.src=c;let d=0,h=0,f;await new Promise(C=>{l.onload=()=>{d=l.naturalWidth,h=l.naturalHeight;let x=d,v=h;d>h&&d>256?(x=256,v=Math.round(h*256/d)):h>256&&(v=256,x=Math.round(d*256/h));const w=document.createElement("canvas");w.width=x,w.height=v;const S=w.getContext("2d");S==null||S.drawImage(l,0,0,x,v),w.toBlob(j=>{j&&(f=j,URL.revokeObjectURL(c),l.src="",l.remove(),w.width=0,w.height=0,C())},"image/webp",.8)},l.onerror=()=>{URL.revokeObjectURL(c),l.remove(),C()}});const{presigned_url:p,image_dto:g}=await s({width:d,height:h,board_id:t==="none"?void 0:t}).unwrap(),m=await fetch(p,{method:"GET",...n&&{headers:{Authorization:`Bearer ${n}`}}}).then(C=>C.json());if(!Age(m))throw new Error("Invalid response");const y=m.fullUrl,b=m.thumbnailUrl;return await fetch(y,{method:"PUT",body:o}),await fetch(b,{method:"PUT",body:f}),e(JX({imageDTO:g,silent:!1,isFirstUploadOfBatch:a===0})),g},[t,n,s,e])},Ege={position:"absolute",top:0,right:0,bottom:0,left:0,color:"base.300",borderColor:"base.300",transitionProperty:"common",transitionDuration:"0.1s",".dnd-drop-overlay-backdrop":{position:"absolute",top:0,right:0,bottom:0,left:0,bg:"base.900",opacity:.7,borderRadius:"base",alignItems:"center",justifyContent:"center",transitionProperty:"inherit",transitionDuration:"inherit"},".dnd-drop-overlay-content":{position:"absolute",top:.5,right:.5,bottom:.5,left:.5,opacity:1,borderWidth:1.5,borderRadius:"base",borderStyle:"dashed",alignItems:"center",justifyContent:"center",borderColor:"inherit",transitionProperty:"inherit",transitionDuration:"inherit"},".dnd-drop-overlay-label":{fontSize:"lg",fontWeight:"semibold",textAlign:"center",color:"inherit",transitionProperty:"inherit",transitionDuration:"inherit"},'&[data-dnd-state="over"]':{color:"invokeYellow.300",borderColor:"invokeYellow.300"}},tp=u.memo(e=>{const{dndState:t,label:n,withBackdrop:s=!0}=e;return t==="idle"?null:r.jsxs(T,{className:"dnd-drop-overlay","data-dnd-state":t,sx:Ege,children:[s&&r.jsx(T,{className:"dnd-drop-overlay-backdrop"}),r.jsxs(T,{className:"dnd-drop-overlay-content",children:[zf(n)&&r.jsx(q,{className:"dnd-drop-overlay-label",children:n}),!qe(n)&&!zf(n)&&n]})]})});tp.displayName="DndDropOverlay";const pg=e=>{const{boardName:t}=ic({include_archived:!0},{selectFromResult:({data:n})=>{const s=n==null?void 0:n.find(o=>o.board_id===e);return{boardName:(s==null?void 0:s.board_name)||Pe("boards.uncategorized")}}});return t},Mge=["image/png","image/jpg","image/jpeg","image/webp"],Pge=[".png",".jpg",".jpeg",".webp"],Lge=Ge.custom().refine(e=>Mge.includes(e.type),e=>({message:`File type ${e.type} is not supported`})).refine(e=>Pge.some(t=>e.name.endsWith(t)),e=>({message:`File extension .${e.name.split(".").at(-1)} is not supported`})),Dge={position:"absolute",top:2,right:2,bottom:2,left:2,'&[data-dnd-state="idle"]':{pointerEvents:"none"}},V9=u.memo(()=>{const{t:e}=A(),t=u.useRef(null),[n,s]=u.useState("idle"),i=I(An),o=ae(fS),a=I(LM),l=$9(),c=u.useCallback(async h=>{const{getState:f}=Fp();if(!Ge.array(Lge).safeParse(h).success){const b=e("toast.uploadFailedInvalidUploadDesc");ge({id:"UPLOAD_FAILED",title:e("toast.uploadFailed"),description:b,status:"error"});return}const g=ng.get(),[m]=h;if(g==="canvas"&&!o&&i==="canvas"&&h.length===1&&m){xge(m);return}const y=Hs(f());if(a)for(const[b,C]of h.entries())await l(C,b);else{const b=h.map((C,x)=>({file:C,image_category:"user",is_intermediate:!1,board_id:y==="none"?void 0:y,isFirstUploadOfBatch:x===0}));DM(b)}},[i,o,e,a,l]),d=u.useCallback(h=>{var p;if(!((p=h.clipboardData)!=null&&p.files))return;const f=Array.from(h.clipboardData.files);c(f)},[c]);return u.useEffect(()=>{const h=t.current;if(h)return qn(iC({element:h,canDrop:yT,onDrop:({source:f})=>{const p=_ge({source:f});c(p)},onDragEnter:()=>{s("over")},onDragLeave:()=>{s("idle")}}),Sf({canMonitor:yT,onDragStart:()=>{s("potential"),xT.start()},onDrop:()=>{s("idle"),xT.stop()}}))},[c]),u.useEffect(()=>(window.addEventListener("paste",d),()=>{window.removeEventListener("paste",d)}),[d]),r.jsx(Se,{ref:t,"data-dnd-state":n,sx:Dge,children:r.jsx(tp,{dndState:n,label:r.jsx(z9,{})})})});V9.displayName="FullscreenDropzone";const z9=u.memo(()=>{const{t:e}=A(),t=I(Hs),n=pg(t);return r.jsxs(T,{flexDir:"column",gap:4,color:"base.100",alignItems:"center",children:[r.jsx(Ft,{size:"lg",children:e("gallery.dropToUpload")}),r.jsx(Ft,{size:"md",children:e("toast.imagesWillBeAddedTo",{boardName:n})})]})});z9.displayName="DropLabel";const fv=Oe(!1),G9=()=>{const e=ae(fv),t=u.useCallback(()=>{fv.set(!0)},[]),n=u.useCallback(()=>{fv.set(!1)},[]);return{isOpen:e,onOpen:t,onClose:n}},Rge=""+new URL("commercial-license-bg-C_dHp7on.png",import.meta.url).href,Oge=""+new URL("denoising-strength-4mznP2tj.png",import.meta.url).href,Nge={paramNegativeConditioning:{placement:"right"},clipSkip:{href:"https://support.invoke.ai/support/solutions/articles/151000178161-advanced-settings"},inpainting:{href:"https://support.invoke.ai/support/solutions/articles/151000096702-inpainting-outpainting-and-bounding-box"},rasterLayer:{href:"https://support.invoke.ai/support/solutions/articles/151000094998-raster-layers-and-initial-images"},regionalGuidance:{href:"https://support.invoke.ai/support/solutions/articles/151000165024-regional-guidance-layers"},regionalGuidanceAndReferenceImage:{href:"https://support.invoke.ai/support/solutions/articles/151000165024-regional-guidance-layers"},globalReferenceImage:{href:"https://support.invoke.ai/support/solutions/articles/151000159340-global-and-regional-reference-images-ip-adapters-"},regionalReferenceImage:{href:"https://support.invoke.ai/support/solutions/articles/151000159340-global-and-regional-reference-images-ip-adapters-"},controlNet:{href:"https://support.invoke.ai/support/solutions/articles/151000105880"},controlNetBeginEnd:{href:"https://support.invoke.ai/support/solutions/articles/151000178148"},controlNetWeight:{href:"https://support.invoke.ai/support/solutions/articles/151000178148"},lora:{href:"https://support.invoke.ai/support/solutions/articles/151000159072"},loraWeight:{href:"https://support.invoke.ai/support/solutions/articles/151000159072-concepts-low-rank-adaptations-loras-"},compositingMaskBlur:{href:"https://support.invoke.ai/support/solutions/articles/151000158838-compositing-settings"},compositingBlurMethod:{href:"https://support.invoke.ai/support/solutions/articles/151000158838-compositing-settings"},compositingCoherenceMode:{href:"https://support.invoke.ai/support/solutions/articles/151000158838-compositing-settings"},infillMethod:{href:"https://support.invoke.ai/support/solutions/articles/151000158838-compositing-settings"},scaleBeforeProcessing:{href:"https://support.invoke.ai/support/solutions/articles/151000179777-scale-before-processing"},paramCFGScale:{href:"https://www.youtube.com/watch?v=1OeHEJrsTpI"},paramCFGRescaleMultiplier:{href:"https://support.invoke.ai/support/solutions/articles/151000178161-advanced-settings"},paramDenoisingStrength:{href:"https://support.invoke.ai/support/solutions/articles/151000094998-image-to-image",image:Oge},paramHrf:{href:"https://support.invoke.ai/support/solutions/articles/151000096700-how-can-i-get-larger-images-what-does-upscaling-do-"},paramIterations:{href:"https://support.invoke.ai/support/solutions/articles/151000159073"},paramPositiveConditioning:{href:"https://support.invoke.ai/support/solutions/articles/151000096606-tips-on-crafting-prompts",placement:"right"},paramScheduler:{placement:"right",href:"https://www.youtube.com/watch?v=1OeHEJrsTpI"},paramSeed:{href:"https://support.invoke.ai/support/solutions/articles/151000096684-what-is-a-seed-how-do-i-use-it-to-recreate-the-same-image-"},paramModel:{placement:"right",href:"https://support.invoke.ai/support/solutions/articles/151000096601-what-is-a-model-which-should-i-use-"},paramRatio:{gutter:16},controlNetControlMode:{placement:"right",href:"https://support.invoke.ai/support/solutions/articles/151000178148"},controlNetProcessor:{placement:"right",href:"https://support.invoke.ai/support/solutions/articles/151000105880-using-controlnet"},controlNetResizeMode:{placement:"right",href:"https://support.invoke.ai/support/solutions/articles/151000178148"},paramVAE:{placement:"right",href:"https://support.invoke.ai/support/solutions/articles/151000178161-advanced-settings"},paramVAEPrecision:{placement:"right",href:"https://support.invoke.ai/support/solutions/articles/151000178161-advanced-settings"},paramUpscaleMethod:{href:"https://support.invoke.ai/support/solutions/articles/151000096700-how-can-i-get-larger-images-what-does-upscaling-do-"},refinerModel:{href:"https://support.invoke.ai/support/solutions/articles/151000178333-using-the-refiner"},refinerNegativeAestheticScore:{href:"https://support.invoke.ai/support/solutions/articles/151000178333-using-the-refiner"},refinerPositiveAestheticScore:{href:"https://support.invoke.ai/support/solutions/articles/151000178333-using-the-refiner"},refinerScheduler:{href:"https://support.invoke.ai/support/solutions/articles/151000178333-using-the-refiner"},refinerStart:{href:"https://support.invoke.ai/support/solutions/articles/151000178333-using-the-refiner"},refinerSteps:{href:"https://support.invoke.ai/support/solutions/articles/151000178333-using-the-refiner"},refinerCfgScale:{href:"https://support.invoke.ai/support/solutions/articles/151000178333-using-the-refiner"},seamlessTilingXAxis:{href:"https://support.invoke.ai/support/solutions/articles/151000178161-advanced-settings"},seamlessTilingYAxis:{href:"https://support.invoke.ai/support/solutions/articles/151000178161-advanced-settings"},fluxDevLicense:{href:"https://www.invoke.com/get-a-commercial-license-for-flux",image:Rge}},Fge=1e3,Bge=[{name:"preventOverflow",options:{padding:10}}],$ge=fe(yy,e=>e.shouldEnableInformationalPopovers),ze=u.memo(({feature:e,children:t,inPortal:n=!0,hideDisable:s=!1,...i})=>{const o=I($ge),a=u.useMemo(()=>Nge[e],[e]),l=u.useMemo(()=>hM(Yo(a,["image","href","buttonLabel"]),i),[a,i]);return!s&&!o?t:r.jsxs(rs,{isLazy:!0,closeOnBlur:!1,trigger:"hover",variant:"informational",openDelay:Fge,modifiers:Bge,placement:"top",...l,children:[r.jsx(gs,{children:t}),n?r.jsx(hc,{children:r.jsx(vT,{data:a,feature:e,hideDisable:s})}):r.jsx(vT,{data:a,feature:e,hideDisable:s})]})});ze.displayName="InformationalPopover";const vT=({data:e,feature:t,hideDisable:n})=>{const{t:s}=A(),i=G(),o=u.useMemo(()=>s(`popovers.${t}.heading`),[t,s]),a=u.useMemo(()=>s(`popovers.${t}.paragraphs`,{returnObjects:!0})??[],[t,s]),l=u.useCallback(()=>{e!=null&&e.href&&window.open(e.href)},[e==null?void 0:e.href]),c=u.useCallback(()=>{i(RM(!1)),ge({title:s("settings.informationalPopoversDisabled"),description:s("settings.informationalPopoversDisabledDesc"),status:"info"})},[i,s]);return r.jsxs(is,{maxW:300,children:[r.jsx(OM,{top:2}),r.jsx(ms,{children:r.jsxs(T,{gap:2,flexDirection:"column",alignItems:"flex-start",children:[o&&r.jsxs(r.Fragment,{children:[r.jsx(Ft,{size:"sm",children:o}),r.jsx(wt,{})]}),(e==null?void 0:e.image)&&r.jsxs(r.Fragment,{children:[r.jsx(Wt,{objectFit:"contain",backgroundColor:"white",src:e.image,alt:"Optional Image"}),r.jsx(wt,{})]}),a.map(d=>r.jsx(q,{children:d},d)),r.jsx(wt,{}),r.jsxs(T,{alignItems:"center",justifyContent:"space-between",w:"full",children:[!n&&r.jsx(de,{onClick:c,variant:"link",size:"sm",children:s("common.dontShowMeThese")}),r.jsx(it,{}),(e==null?void 0:e.href)&&r.jsx(de,{onClick:l,leftIcon:r.jsx(ib,{}),variant:"link",size:"sm",children:s("common.learnMore")??o})]})]})})]})},Vge=()=>{const e=I(dM),t=I(eQ),n=I(tQ),s=G(),{t:i}=A(),o=u.useCallback(a=>{s(nQ(a))},[s]);return r.jsxs(K,{isDisabled:!n,children:[r.jsx(ze,{feature:"dynamicPromptsMaxPrompts",inPortal:!1,children:r.jsx(J,{children:i("dynamicPrompts.maxPrompts")})}),r.jsx(Ze,{min:t.sliderMin,max:t.sliderMax,value:e,defaultValue:t.initial,onChange:o,marks:!0}),r.jsx(Ie,{min:t.numberInputMin,max:t.numberInputMax,value:e,defaultValue:t.initial,onChange:o})]})},zge=u.memo(Vge),Gge={"&::marker":{color:"base.500"}},Hge=()=>{const{t:e}=A(),t=I(sQ),n=I(NM),s=I(jy),i=I(rQ),o=u.useMemo(()=>{let a=`${e("dynamicPrompts.promptsPreview")} (${i.length})`;return t&&(a+=` - ${t}`),a},[t,i.length,e]);return n?r.jsx(T,{w:"full",h:"full",layerStyle:"second",alignItems:"center",justifyContent:"center",p:8,children:r.jsx(Pt,{icon:r7,label:"Problem generating prompts"})}):r.jsxs(K,{orientation:"vertical",w:"full",h:"full",isInvalid:!!(t||n),children:[r.jsx(ze,{feature:"dynamicPrompts",inPortal:!1,children:r.jsx(J,{children:o})}),r.jsxs(T,{w:"full",h:"full",pos:"relative",layerStyle:"first",p:4,borderRadius:"base",children:[r.jsx(os,{children:r.jsx(iQ,{stylePosition:"inside",ms:0,children:i.map((a,l)=>r.jsx(Rt,{fontSize:"sm",sx:Gge,children:r.jsx(q,{as:"span",children:a})},`${a}.${l}`))})}),s&&r.jsx(T,{pos:"absolute",w:"full",h:"full",top:0,insetInlineStart:0,layerStyle:"second",opacity:.7,alignItems:"center",justifyContent:"center",children:r.jsx(Lr,{})})]})]})},Wge=u.memo(Hge),Uge=()=>{const e=G(),{t}=A(),n=I(oQ),s=u.useMemo(()=>[{value:"PER_ITERATION",label:t("dynamicPrompts.seedBehaviour.perIterationLabel"),description:t("dynamicPrompts.seedBehaviour.perIterationDesc")},{value:"PER_PROMPT",label:t("dynamicPrompts.seedBehaviour.perPromptLabel"),description:t("dynamicPrompts.seedBehaviour.perPromptDesc")}],[t]),i=u.useCallback(a=>{aQ(a==null?void 0:a.value)&&e(lQ(a.value))},[e]),o=u.useMemo(()=>s.find(a=>a.value===n),[s,n]);return r.jsxs(K,{children:[r.jsx(ze,{feature:"dynamicPromptsSeedBehaviour",inPortal:!1,children:r.jsx(J,{children:t("dynamicPrompts.seedBehaviour.label")})}),r.jsx(Ne,{value:o,options:s,onChange:i})]})},qge=u.memo(Uge),H9=u.memo(()=>{At("DynamicPromptsModal");const{t:e}=A(),{isOpen:t,onClose:n}=G9();return r.jsxs(Dr,{isOpen:t,onClose:n,isCentered:!0,useInert:!1,children:[r.jsx(ar,{}),r.jsxs(Rr,{w:"80vw",h:"80vh",maxW:"unset",maxH:"unset",children:[r.jsx(lr,{children:e("dynamicPrompts.dynamicPrompts")}),r.jsx(Pi,{}),r.jsxs(Ws,{as:T,flexDir:"column",gap:4,w:"full",h:"full",pb:4,children:[r.jsxs(T,{gap:4,children:[r.jsx(qge,{}),r.jsx(zge,{})]}),r.jsx(Wge,{})]})]})]})});H9.displayName="DynamicPromptsModal";const hf=Oe(null),Kge=()=>{At("DeleteBoardModal");const e=ae(hf),{t}=A(),{currentData:n,isFetching:s}=cQ(e!=null&&e.board_id?{board_id:e==null?void 0:e.board_id,categories:void 0,is_intermediate:void 0}:Xn),i=u.useMemo(()=>hn([Qe,tt,_p],(y,b,C)=>{const x=(n??[]).map(w=>PM(y,b,C,w));return{isUpscaleImage:Ss(x,w=>w.isUpscaleImage),isRasterLayerImage:Ss(x,w=>w.isRasterLayerImage),isInpaintMaskImage:Ss(x,w=>w.isInpaintMaskImage),isRegionalGuidanceImage:Ss(x,w=>w.isRegionalGuidanceImage),isNodesImage:Ss(x,w=>w.isNodesImage),isControlLayerImage:Ss(x,w=>w.isControlLayerImage),isReferenceImage:Ss(x,w=>w.isReferenceImage)}}),[n]),[o,{isLoading:a}]=uQ(),[l,{isLoading:c}]=dQ(),d=I(i),h=u.useCallback(()=>{e&&(o(e.board_id),hf.set(null))},[e,o]),f=u.useCallback(()=>{e&&(l(e.board_id),hf.set(null))},[e,l]),p=u.useCallback(()=>{hf.set(null)},[]),g=u.useRef(null),m=u.useMemo(()=>c||a||s,[c,a,s]);return e?r.jsx(FM,{isOpen:!!e,onClose:p,leastDestructiveRef:g,isCentered:!0,children:r.jsx(ar,{children:r.jsxs(pS,{children:[r.jsxs(lr,{fontSize:"lg",fontWeight:"bold",children:[t("common.delete")," ",e.board_name]}),r.jsx(Ws,{children:r.jsxs(T,{direction:"column",gap:3,children:[s?r.jsx(oS,{children:r.jsx(T,{w:"full",h:32})}):r.jsx(B9,{imageUsage:d,topMessage:t("boards.topMessage"),bottomMessage:t("boards.bottomMessage")}),r.jsx(q,{children:e.is_private?t("boards.deletedPrivateBoardsCannotbeRestored"):t("boards.deletedBoardsCannotbeRestored")}),r.jsx(q,{children:t("gallery.deleteImagePermanent")})]})}),r.jsx(xo,{children:r.jsxs(T,{w:"full",gap:2,justifyContent:"end",children:[r.jsx(de,{ref:g,onClick:p,children:t("boards.cancel")}),r.jsx(de,{colorScheme:"warning",isLoading:m,onClick:h,children:t("boards.deleteBoardOnly")}),r.jsx(de,{colorScheme:"error",isLoading:m,onClick:f,children:t("boards.deleteBoardAndImages")})]})})]})})}):null},Zge=u.memo(Kge),Yge=()=>{const{t:e}=A(),t=G(),n=I(y=>y.gallery.selection),s=ae(gS),i=Bt("bulkDownload"),[o]=mS(),[a]=yS(),[l]=bS(),c=u.useCallback(()=>{t(BM(n)),t(lS(!0))},[t,n]),d=u.useCallback(()=>{t(Pp(n))},[t,n]),h=u.useCallback(()=>{o({imageDTOs:n})},[o,n]),f=u.useCallback(()=>{a({imageDTOs:n})},[a,n]),p=u.useCallback(()=>{l({image_names:n.map(y=>y.image_name)})},[n,l]),g=u.useMemo(()=>n.every(y=>y.starred),[n]),m=u.useMemo(()=>n.every(y=>!y.starred),[n]);return r.jsxs(r.Fragment,{children:[g&&r.jsx(pe,{icon:s?s.on.icon:r.jsx($j,{}),onClickCapture:f,children:s?s.off.text:"Unstar All"}),(m||!g&&!m)&&r.jsx(pe,{icon:s?s.on.icon:r.jsx(db,{}),onClickCapture:h,children:s?s.on.text:"Star All"}),i&&r.jsx(pe,{icon:r.jsx(md,{}),onClickCapture:p,children:e("gallery.downloadSelection")}),r.jsx(pe,{icon:r.jsx(UR,{}),onClickCapture:c,children:e("boards.changeBoard")}),r.jsx(Es,{}),r.jsx(pe,{color:"error.300",icon:r.jsx(ri,{}),onClickCapture:d,children:e("gallery.deleteSelection")})]})},Xge=u.memo(Yge),Jr=({tooltip:e,icon:t,...n})=>r.jsx(Ee,{label:e,placement:"top",gutter:12,children:r.jsx(pe,{display:"flex",alignItems:"center",justifyContent:"center",w:"min-content",aspectRatio:"1",borderRadius:"base",...n,children:t})}),Sd=({children:e})=>r.jsx(T,{gap:2,justifyContent:"space-between",children:e}),W9=u.createContext(null),Qge=W9.Provider,Fr=()=>{const e=u.useContext(W9);return we(e!==null,"useImageDTOContext must be used within ImageDTOContextProvider"),e},U9=u.memo(()=>{const{t:e}=A(),t=G(),n=Fr(),s=u.useCallback(()=>{t(BM([n])),t(lS(!0))},[t,n]);return r.jsx(pe,{icon:r.jsx(UR,{}),onClickCapture:s,children:e("boards.changeBoard")})});U9.displayName="ImageMenuItemChangeBoard";const kb=e=>new Promise((t,n)=>{const s=new Image;s.onload=()=>{if(s.width===0||s.height===0){n(new Error("Image has no dimensions. The URL may be invalid or the object may not exist."));return}const i=document.createElement("canvas");i.width=s.width,i.height=s.height;const o=i.getContext("2d");if(!o){n(new Error("Failed to get canvas context"));return}o.drawImage(s,0,0),i.toBlob(a=>{a?t(a):n(new Error("Failed to convert image to blob"))},"image/png")},s.onerror=()=>{n(new Error("Image failed to load. The URL may be invalid or the object may not exist."))},s.crossOrigin=rd.get()?"use-credentials":"anonymous",s.src=e}),Jge=()=>{const{t:e}=A(),t=il(),n=G();return u.useCallback(async i=>{try{const o=await kb(i);if(!o)throw new Error("Unable to create Blob");t.writeImage(o,()=>{ge({id:"IMAGE_COPIED",title:e("toast.imageCopied"),status:"success"}),n(hQ())})}catch(o){ge({id:"PROBLEM_COPYING_IMAGE",title:e("toast.problemCopyingImage"),description:String(o),status:"error"})}},[t,e,n])},q9=u.memo(()=>{const{t:e}=A(),t=Fr(),n=Jge(),s=u.useCallback(()=>{n(t.image_url)},[n,t.image_url]);return r.jsx(Jr,{icon:r.jsx(un,{}),"aria-label":e("parameters.copyImage"),tooltip:e("parameters.copyImage"),onClickCapture:s})});q9.displayName="ImageMenuItemCopy";const K9=u.memo(()=>{const{t:e}=A(),t=G(),n=Fr(),s=u.useCallback(()=>{t(Pp([n]))},[t,n]);return r.jsx(Jr,{icon:r.jsx(ri,{}),onClickCapture:s,"aria-label":e("gallery.deleteImage",{count:1}),tooltip:e("gallery.deleteImage",{count:1}),isDestructive:!0})});K9.displayName="ImageMenuItemDelete";const eme=()=>{const{t:e}=A(),t=G(),n=ae(rd);return{downloadImage:u.useCallback(async(i,o)=>{try{const a=n?{headers:{Authorization:`Bearer ${n}`}}:{},l=await fetch(i,a).then(h=>h.blob());if(!l)throw new Error("Unable to create Blob");const c=window.URL.createObjectURL(l),d=document.createElement("a");d.style.display="none",d.href=c,d.download=o,document.body.appendChild(d),d.click(),window.URL.revokeObjectURL(c),t(fQ())}catch(a){ge({id:"PROBLEM_DOWNLOADING_IMAGE",title:e("toast.problemDownloadingImage"),description:String(a),status:"error"})}},[e,t,n])}},Z9=u.memo(()=>{const{t:e}=A(),t=Fr(),{downloadImage:n}=eme(),s=u.useCallback(()=>{n(t.image_url,t.image_name)},[n,t.image_name,t.image_url]);return r.jsx(Jr,{icon:r.jsx(md,{}),"aria-label":e("parameters.downloadImage"),tooltip:e("parameters.downloadImage"),onClick:s})});Z9.displayName="ImageMenuItemDownload";const Y9=u.memo(()=>{const{t:e}=A(),t=Fr(),n=Xa(),s=ae(Mp),i=u.useCallback(()=>{n({type:"image",data:t.image_name})},[n,t.image_name]);return r.jsx(pe,{icon:r.jsx(lb,{}),onClickCapture:i,isDisabled:!t.has_workflow||!s,children:e("nodes.loadWorkflow")})});Y9.displayName="ImageMenuItemLoadWorkflow";const tme=[0,8],rr=()=>{const e=pQ(!1),t=u.useRef(null),n=p9(e.close,300),s=u.useCallback(()=>{n.cancel(),e.open()},[n,e]),i=u.useCallback(()=>{if(e.isOpen){e.close();return}else n.cancel(),e.toggle()},[n,e]),o=u.useCallback(l=>{if(l.currentTarget.contains(l.relatedTarget)){n.cancel();return}e.close()},[n,e]),a=u.useCallback(l=>{l.pointerType==="pen"||l.pointerType==="touch"||e.close()},[e]);return u.useEffect(()=>{if(!t.current)return;const c=new AbortController;return window.addEventListener("click",d=>{var h;(h=t.current)!=null&&h.contains(d.target)||e.close()},{signal:c.signal}),()=>{c.abort()}},[e]),{parentMenuItemProps:{onClick:i,onPointerEnter:s,onPointerLeave:a,closeOnSelect:!1},menuProps:{isOpen:e.isOpen,onClose:e.close,placement:"right",offset:tme,closeOnBlur:!1},menuButtonProps:{as:Se,width:"full",height:"full"},menuListProps:{ref:t,onPointerEnter:s,onPointerLeave:n,onBlur:o}}},ir=({label:e})=>r.jsxs(T,{w:"full",h:"full",flexDir:"row",justifyContent:"space-between",alignItems:"center",children:[r.jsx(q,{children:e}),r.jsx(lt,{as:ab})]}),X9=u.memo(()=>{const{t:e}=A(),t=Fr(),n=rr(),{recallAll:s,remix:i,recallSeed:o,recallPrompts:a,hasMetadata:l,hasSeed:c,hasPrompts:d,createAsPreset:h}=ok(t);return r.jsx(pe,{...n.parentMenuItemProps,icon:r.jsx(NR,{}),children:r.jsxs(en,{...n.menuProps,children:[r.jsx(tn,{...n.menuButtonProps,children:r.jsx(ir,{label:e("parameters.recallMetadata")})}),r.jsxs(Tt,{...n.menuListProps,children:[r.jsx(pe,{icon:r.jsx(e1,{}),onClick:i,isDisabled:!l,children:e("parameters.remixImage")}),r.jsx(pe,{icon:r.jsx(t7,{}),onClick:a,isDisabled:!d,children:e("parameters.usePrompt")}),r.jsx(pe,{icon:r.jsx(JR,{}),onClick:o,isDisabled:!c,children:e("parameters.useSeed")}),r.jsx(pe,{icon:r.jsx(BR,{}),onClick:s,isDisabled:!l,children:e("parameters.useAll")}),r.jsx(pe,{icon:r.jsx(Bj,{}),onClick:h,isDisabled:!d,children:e("stylePresets.useForTemplate")})]})]})})});X9.displayName="ImageMenuItemMetadataRecallActions";const ut=()=>{const e=Lt();return ae(e.$isBusy)},Q9=()=>{const e=sM();return ae((e==null?void 0:e.$isBusy)??mle)},J9=u.memo(()=>{const{t:e}=A(),t=rr(),n=dn(),s=Fr(),i=Nt(),o=Q9(),a=u.useCallback(()=>{const{dispatch:h,getState:f}=n;ym({imageDTO:s,withResize:!1,type:"raster_layer",dispatch:h,getState:f}),h(Qt("canvas")),i.close(),ge({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[s,i,n,e]),l=u.useCallback(()=>{const{dispatch:h,getState:f}=n;ym({imageDTO:s,withResize:!1,type:"control_layer",dispatch:h,getState:f}),h(Qt("canvas")),i.close(),ge({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[s,i,n,e]),c=u.useCallback(()=>{const{dispatch:h,getState:f}=n;ym({imageDTO:s,withResize:!0,type:"raster_layer",dispatch:h,getState:f}),h(Qt("canvas")),i.close(),ge({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[s,i,n,e]),d=u.useCallback(()=>{const{dispatch:h,getState:f}=n;ym({imageDTO:s,withResize:!0,type:"control_layer",dispatch:h,getState:f}),h(Qt("canvas")),i.close(),ge({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[s,i,n,e]);return r.jsx(pe,{...t.parentMenuItemProps,icon:r.jsx(Vt,{}),children:r.jsxs(en,{...t.menuProps,children:[r.jsx(tn,{...t.menuButtonProps,children:r.jsx(ir,{label:e("controlLayers.newCanvasFromImage")})}),r.jsxs(Tt,{...t.menuListProps,children:[r.jsx(pe,{icon:r.jsx(fm,{}),onClickCapture:a,isDisabled:o,children:e("controlLayers.asRasterLayer")}),r.jsx(pe,{icon:r.jsx(fm,{}),onClickCapture:c,isDisabled:o,children:e("controlLayers.asRasterLayerResize")}),r.jsx(pe,{icon:r.jsx(fm,{}),onClickCapture:l,isDisabled:o,children:e("controlLayers.asControlLayer")}),r.jsx(pe,{icon:r.jsx(fm,{}),onClickCapture:d,isDisabled:o,children:e("controlLayers.asControlLayerResize")})]})]})})});J9.displayName="ImageMenuItemNewCanvasFromImageSubMenu";const nme=vo(ghe),js=()=>r.jsx(nme,{transform:"rotate(90deg)"}),eO=u.memo(()=>{const{t:e}=A(),t=rr(),n=dn(),s=Fr(),i=Nt(),o=Q9(),a=u.useCallback(()=>{const{dispatch:p,getState:g}=n;Yr({imageDTO:s,type:"raster_layer",dispatch:p,getState:g}),p(Dc()),p(Qt("canvas")),i.close(),ge({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[s,i,n,e]),l=u.useCallback(()=>{const{dispatch:p,getState:g}=n;Yr({imageDTO:s,type:"control_layer",dispatch:p,getState:g}),p(Dc()),p(Qt("canvas")),i.close(),ge({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[s,i,n,e]),c=u.useCallback(()=>{const{dispatch:p,getState:g}=n;Yr({imageDTO:s,type:"inpaint_mask",dispatch:p,getState:g}),p(Dc()),p(Qt("canvas")),i.close(),ge({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[s,i,n,e]),d=u.useCallback(()=>{const{dispatch:p,getState:g}=n;Yr({imageDTO:s,type:"regional_guidance",dispatch:p,getState:g}),p(Dc()),p(Qt("canvas")),i.close(),ge({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[s,i,n,e]),h=u.useCallback(()=>{const{dispatch:p,getState:g}=n;Yr({imageDTO:s,type:"reference_image",dispatch:p,getState:g}),p(Dc()),p(Qt("canvas")),i.close(),ge({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[s,i,n,e]),f=u.useCallback(()=>{const{dispatch:p,getState:g}=n;Yr({imageDTO:s,type:"regional_guidance_with_reference_image",dispatch:p,getState:g}),p(Dc()),p(Qt("canvas")),i.close(),ge({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[s,i,n,e]);return r.jsx(pe,{...t.parentMenuItemProps,icon:r.jsx(Vt,{}),children:r.jsxs(en,{...t.menuProps,children:[r.jsx(tn,{...t.menuButtonProps,children:r.jsx(ir,{label:e("controlLayers.newLayerFromImage")})}),r.jsxs(Tt,{...t.menuListProps,children:[r.jsx(pe,{icon:r.jsx(js,{}),onClickCapture:c,isDisabled:o,children:e("controlLayers.inpaintMask")}),r.jsx(pe,{icon:r.jsx(js,{}),onClickCapture:d,isDisabled:o,children:e("controlLayers.regionalGuidance")}),r.jsx(pe,{icon:r.jsx(js,{}),onClickCapture:l,isDisabled:o,children:e("controlLayers.controlLayer")}),r.jsx(pe,{icon:r.jsx(js,{}),onClickCapture:a,isDisabled:o,children:e("controlLayers.rasterLayer")}),r.jsx(pe,{icon:r.jsx(js,{}),onClickCapture:f,isDisabled:o,children:e("controlLayers.referenceImageRegional")}),r.jsx(pe,{icon:r.jsx(js,{}),onClickCapture:h,isDisabled:o,children:e("controlLayers.referenceImageGlobal")})]})]})})});eO.displayName="ImageMenuItemNewLayerFromImageSubMenu";const tO=u.memo(()=>{const{t:e}=A(),t=Fr(),n=G(),s=u.useCallback(()=>{window.open(t.image_url,"_blank"),n(gQ())},[t.image_url,n]);return r.jsx(Jr,{onClickCapture:s,"aria-label":e("common.openInNewTab"),tooltip:e("common.openInNewTab"),icon:r.jsx(ib,{})})});tO.displayName="ImageMenuItemOpenInNewTab";const nO=u.memo(()=>{const{t:e}=A(),t=Fr(),n=Nt(),s=u.useCallback(()=>{n.openImageInViewer(t)},[t,n]);return r.jsx(Jr,{icon:r.jsx(ob,{}),onClickCapture:s,"aria-label":e("common.openInViewer"),tooltip:e("common.openInViewer")})});nO.displayName="ImageMenuItemOpenInViewer";const sO=u.memo(()=>{const{t:e}=A(),t=G(),n=Fr(),s=u.useMemo(()=>fe(Tr,a=>{var l;return((l=a.imageToCompare)==null?void 0:l.image_name)!==n.image_name}),[n.image_name]),i=I(s),o=u.useCallback(()=>{t(Op(n))},[t,n]);return r.jsx(Jr,{icon:r.jsx(KR,{}),isDisabled:!i,onClick:o,"aria-label":e("gallery.selectForCompare"),tooltip:e("gallery.selectForCompare")})});sO.displayName="ImageMenuItemSelectForCompare";const rO=u.memo(()=>{const{t:e}=A(),t=G(),n=Fr(),s=u.useCallback(()=>{t(N0(n)),t(Qt("upscaling")),ge({id:"SENT_TO_CANVAS",title:e("toast.sentToUpscale"),status:"success"})},[t,n,e]);return r.jsx(pe,{icon:r.jsx(n7,{}),onClickCapture:s,id:"send-to-upscale",children:e("parameters.sendToUpscale")})});rO.displayName="ImageMenuItemSendToUpscale";const iO=u.memo(()=>{const{t:e}=A(),t=Fr(),n=ae(gS),[s]=mS(),[i]=yS(),o=u.useCallback(()=>{t&&s({imageDTOs:[t]})},[s,t]),a=u.useCallback(()=>{t&&i({imageDTOs:[t]})},[i,t]);return t.starred?r.jsx(pe,{icon:n?n.off.icon:r.jsx(db,{}),onClickCapture:a,children:n?n.off.text:e("gallery.unstarImage")}):r.jsx(pe,{icon:n?n.on.icon:r.jsx($j,{}),onClickCapture:o,children:n?n.on.text:e("gallery.starImage")})});iO.displayName="ImageMenuItemStarUnstar";const sme=({imageDTO:e})=>r.jsxs(Qge,{value:e,children:[r.jsxs(Sd,{children:[r.jsx(tO,{}),r.jsx(q9,{}),r.jsx(Z9,{}),r.jsx(nO,{}),r.jsx(sO,{}),r.jsx(K9,{})]}),r.jsx(Es,{}),r.jsx(Y9,{}),r.jsx(X9,{}),r.jsx(Es,{}),r.jsx(rO,{}),r.jsx(J9,{}),r.jsx(eO,{}),r.jsx(Es,{}),r.jsx(U9,{}),r.jsx(iO,{})]}),oO=u.memo(sme),rme=500,ime=10,ku=mQ({isOpen:!1,imageDTO:null,position:{x:-1,y:-1}}),_f=()=>{ku.setKey("isOpen",!1)},AC=new Map,ome=e=>{const t=Array.from(AC.entries()).find(n=>n[0].contains(e));return t==null?void 0:t[1]},aO=(e,t)=>{u.useEffect(()=>{if(!t||!e)return;const n=t;return AC.set(n,e),()=>{AC.delete(n)}},[e,t])},lO=u.memo(()=>{At("ImageContextMenu");const e=ae(ku);return Bp(_f),r.jsxs(hc,{children:[r.jsxs(en,{isOpen:e.isOpen,gutter:0,placement:"auto-end",onClose:_f,children:[r.jsx(tn,{"aria-hidden":!0,w:1,h:1,position:"absolute",left:e.position.x,top:e.position.y,cursor:"default",bg:"transparent",_hover:ame,pointerEvents:"none"}),r.jsx(uO,{})]}),r.jsx(cO,{})]})});lO.displayName="ImageContextMenu";const ame={bg:"transparent"},cO=u.memo(()=>{const e=u.useRef({x:-1,y:-1}),t=u.useRef(0),n=u.useRef(0),s=u.useCallback(c=>{if(c.shiftKey){_f();return}const d=ome(c.target);if(!d){_f();return}window.clearTimeout(n.current),c.preventDefault(),e.current.x!==c.pageX||e.current.y!==c.pageY?(ku.get().isOpen&&_f(),n.current=window.setTimeout(()=>{ku.set({isOpen:!0,position:{x:c.pageX,y:c.pageY},imageDTO:d})},100)):ku.set({isOpen:!0,position:{x:c.pageX,y:c.pageY},imageDTO:d}),e.current={x:c.pageX,y:c.pageY}},[]),i=u.useCallback(c=>{c.pointerType!=="mouse"&&(t.current=window.setTimeout(()=>{s(c)},rme),e.current={x:c.pageX,y:c.pageY})},[s]),o=u.useCallback(c=>{if(c.pointerType==="mouse"||t.current===null)return;const d=e.current;Math.hypot(c.pageX-d.x,c.pageY-d.y)>ime&&clearTimeout(t.current)},[]),a=u.useCallback(c=>{c.pointerType!=="mouse"&&t.current&&clearTimeout(t.current)},[]),l=u.useCallback(c=>{c.pointerType!=="mouse"&&t.current&&clearTimeout(t.current)},[]);return u.useEffect(()=>{const c=new AbortController;return window.addEventListener("contextmenu",s,{signal:c.signal}),window.addEventListener("pointerdown",i,{signal:c.signal}),window.addEventListener("pointerup",a,{signal:c.signal}),window.addEventListener("pointercancel",l,{signal:c.signal}),window.addEventListener("pointermove",o,{signal:c.signal}),()=>{c.abort()}},[s,l,i,o,a]),u.useEffect(()=>()=>{window.clearTimeout(n.current),window.clearTimeout(t.current)},[]),null});cO.displayName="ImageContextMenuEventLogical";const uO=u.memo(()=>{const e=I(xS),t=ae(ku);return t.imageDTO?e>1?r.jsx(Tt,{visibility:"visible",children:r.jsx(Xge,{})}):r.jsx(Tt,{visibility:"visible",children:r.jsx(oO,{imageDTO:t.imageDTO})}):null});uO.displayName="MenuContent";const a1=Oe(null),CT=()=>a1.set(null),lme=()=>u.useCallback(t=>{a1.set(t)},[]),cme=()=>{At("ShareWorkflowModal");const e=ae(a1),t=ae(vS),{t:n}=A(),s=il(),i=u.useMemo(()=>!e||!t?null:`${window.location.origin}${t}/studio?selectedWorkflowId=${e.workflow_id}`,[t,e]),o=u.useCallback(()=>{i&&(s.writeText(i,()=>{ge({status:"success",title:n("toast.linkCopied")})}),a1.set(null))},[i,s,n]);return r.jsxs(Dr,{isOpen:e!==null,onClose:CT,isCentered:!0,size:"lg",useInert:!1,children:[r.jsx(ar,{}),r.jsxs(Rr,{children:[r.jsx(lr,{children:r.jsxs(T,{flexDir:"column",gap:2,children:[r.jsx(Ft,{fontSize:"xl",children:n("workflows.copyShareLinkForWorkflow")}),r.jsx(q,{fontSize:"md",children:e==null?void 0:e.name})]})}),r.jsx(Pi,{}),r.jsx(Ws,{children:r.jsxs(T,{layerStyle:"third",p:4,borderRadius:"base",alignItems:"center",children:[r.jsx(q,{fontWeight:"semibold",children:i}),r.jsx(oe,{variant:"ghost","aria-label":n("common.copy"),tooltip:n("common.copy"),icon:r.jsx(un,{}),onClick:o})]})}),r.jsx(xo,{children:r.jsx(de,{onClick:CT,children:n("common.close")})})]})]})},[dO]=$M(!1),bk=()=>{const{t:e}=A(),t=G(),n=dO(),s=fc(),i=ky(),o=u.useCallback(()=>{t(VM()),t(za("edit")),i.close(),ge({id:"NEW_WORKFLOW_CREATED",title:e("workflows.newWorkflowCreated"),status:"success"}),n.close()},[n,t,e,i]),a=u.useCallback(()=>{if(!s){o();return}n.open()},[s,n,o]);return{createImmediate:o,createWithDialog:a}},hO=u.memo(()=>{At("NewWorkflowConfirmationAlertDialog");const{t:e}=A(),t=dO(),n=bk();return r.jsx(ai,{isOpen:t.isOpen,onClose:t.close,title:e("nodes.newWorkflow"),acceptCallback:n.createImmediate,useInert:!1,acceptButtonText:e("common.load"),children:r.jsxs(T,{flexDir:"column",gap:2,children:[r.jsx(q,{children:e("nodes.newWorkflowDesc")}),r.jsx(q,{variant:"subtext",children:e("nodes.newWorkflowDesc2")})]})})});hO.displayName="NewWorkflowConfirmationAlertDialog";const fO=u.memo(()=>{const e=bk(),{t}=A(),n=u.useCallback(s=>{s.stopPropagation(),e.createWithDialog()},[e]);return r.jsx(de,{onClick:n,variant:"ghost",leftIcon:r.jsx(ep,{}),justifyContent:"flex-start",children:t("nodes.newWorkflow")})});fO.displayName="NewWorkflowButton";var pv={exports:{}},gv,wT;function ume(){if(wT)return gv;wT=1;var e="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return gv=e,gv}var mv,ST;function dme(){if(ST)return mv;ST=1;var e=ume();function t(){}function n(){}return n.resetWarningCache=t,mv=function(){function s(a,l,c,d,h,f){if(f!==e){var p=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw p.name="Invariant Violation",p}}s.isRequired=s;function i(){return s}var o={array:s,bigint:s,bool:s,func:s,number:s,object:s,string:s,symbol:s,any:s,arrayOf:i,element:s,elementType:s,instanceOf:i,node:s,objectOf:i,oneOf:i,oneOfType:i,shape:i,exact:i,checkPropTypes:n,resetWarningCache:t};return o.PropTypes=o,o},mv}var jT;function hme(){return jT||(jT=1,pv.exports=dme()()),pv.exports}var fme=hme();const Yt=Qu(fme);var Yi=function(){return Yi=Object.assign||function(t){for(var n,s=1,i=arguments.length;s<i;s++){n=arguments[s];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},Yi.apply(this,arguments)};function pO(e,t){var n={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(n[s]=e[s]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,s=Object.getOwnPropertySymbols(e);i<s.length;i++)t.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(e,s[i])&&(n[s[i]]=e[s[i]]);return n}function jd(e,t,n,s){function i(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function l(h){try{d(s.next(h))}catch(f){a(f)}}function c(h){try{d(s.throw(h))}catch(f){a(f)}}function d(h){h.done?o(h.value):i(h.value).then(l,c)}d((s=s.apply(e,t||[])).next())})}function kd(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},s,i,o,a=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return a.next=l(0),a.throw=l(1),a.return=l(2),typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(d){return function(h){return c([d,h])}}function c(d){if(s)throw new TypeError("Generator is already executing.");for(;a&&(a=0,d[0]&&(n=0)),n;)try{if(s=1,i&&(o=d[0]&2?i.return:d[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,d[1])).done)return o;switch(i=0,o&&(d=[d[0]&2,o.value]),d[0]){case 0:case 1:o=d;break;case 4:return n.label++,{value:d[1],done:!1};case 5:n.label++,i=d[1],d=[0];continue;case 7:d=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(d[0]===6||d[0]===2)){n=0;continue}if(d[0]===3&&(!o||d[1]>o[0]&&d[1]<o[3])){n.label=d[1];break}if(d[0]===6&&n.label<o[1]){n.label=o[1],o=d;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(d);break}o[2]&&n.ops.pop(),n.trys.pop();continue}d=t.call(e,n)}catch(h){d=[6,h],i=0}finally{s=o=0}if(d[0]&5)throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}}function kT(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var s=n.call(e),i,o=[],a;try{for(;(t===void 0||t-- >0)&&!(i=s.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(n=s.return)&&n.call(s)}finally{if(a)throw a.error}}return o}function EC(e,t,n){if(n||arguments.length===2)for(var s=0,i=t.length,o;s<i;s++)(o||!(s in t))&&(o||(o=Array.prototype.slice.call(t,0,s)),o[s]=t[s]);return e.concat(o||Array.prototype.slice.call(t))}var pme=new Map([["aac","audio/aac"],["abw","application/x-abiword"],["arc","application/x-freearc"],["avif","image/avif"],["avi","video/x-msvideo"],["azw","application/vnd.amazon.ebook"],["bin","application/octet-stream"],["bmp","image/bmp"],["bz","application/x-bzip"],["bz2","application/x-bzip2"],["cda","application/x-cdf"],["csh","application/x-csh"],["css","text/css"],["csv","text/csv"],["doc","application/msword"],["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],["eot","application/vnd.ms-fontobject"],["epub","application/epub+zip"],["gz","application/gzip"],["gif","image/gif"],["heic","image/heic"],["heif","image/heif"],["htm","text/html"],["html","text/html"],["ico","image/vnd.microsoft.icon"],["ics","text/calendar"],["jar","application/java-archive"],["jpeg","image/jpeg"],["jpg","image/jpeg"],["js","text/javascript"],["json","application/json"],["jsonld","application/ld+json"],["mid","audio/midi"],["midi","audio/midi"],["mjs","text/javascript"],["mp3","audio/mpeg"],["mp4","video/mp4"],["mpeg","video/mpeg"],["mpkg","application/vnd.apple.installer+xml"],["odp","application/vnd.oasis.opendocument.presentation"],["ods","application/vnd.oasis.opendocument.spreadsheet"],["odt","application/vnd.oasis.opendocument.text"],["oga","audio/ogg"],["ogv","video/ogg"],["ogx","application/ogg"],["opus","audio/opus"],["otf","font/otf"],["png","image/png"],["pdf","application/pdf"],["php","application/x-httpd-php"],["ppt","application/vnd.ms-powerpoint"],["pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation"],["rar","application/vnd.rar"],["rtf","application/rtf"],["sh","application/x-sh"],["svg","image/svg+xml"],["swf","application/x-shockwave-flash"],["tar","application/x-tar"],["tif","image/tiff"],["tiff","image/tiff"],["ts","video/mp2t"],["ttf","font/ttf"],["txt","text/plain"],["vsd","application/vnd.visio"],["wav","audio/wav"],["weba","audio/webm"],["webm","video/webm"],["webp","image/webp"],["woff","font/woff"],["woff2","font/woff2"],["xhtml","application/xhtml+xml"],["xls","application/vnd.ms-excel"],["xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],["xml","application/xml"],["xul","application/vnd.mozilla.xul+xml"],["zip","application/zip"],["7z","application/x-7z-compressed"],["mkv","video/x-matroska"],["mov","video/quicktime"],["msg","application/vnd.ms-outlook"]]);function gg(e,t){var n=gme(e);if(typeof n.path!="string"){var s=e.webkitRelativePath;Object.defineProperty(n,"path",{value:typeof t=="string"?t:typeof s=="string"&&s.length>0?s:e.name,writable:!1,configurable:!1,enumerable:!0})}return n}function gme(e){var t=e.name,n=t&&t.lastIndexOf(".")!==-1;if(n&&!e.type){var s=t.split(".").pop().toLowerCase(),i=pme.get(s);i&&Object.defineProperty(e,"type",{value:i,writable:!1,configurable:!1,enumerable:!0})}return e}var mme=[".DS_Store","Thumbs.db"];function yme(e){return jd(this,void 0,void 0,function(){return kd(this,function(t){return l1(e)&&bme(e.dataTransfer)?[2,wme(e.dataTransfer,e.type)]:xme(e)?[2,vme(e)]:Array.isArray(e)&&e.every(function(n){return"getFile"in n&&typeof n.getFile=="function"})?[2,Cme(e)]:[2,[]]})})}function bme(e){return l1(e)}function xme(e){return l1(e)&&l1(e.target)}function l1(e){return typeof e=="object"&&e!==null}function vme(e){return MC(e.target.files).map(function(t){return gg(t)})}function Cme(e){return jd(this,void 0,void 0,function(){var t;return kd(this,function(n){switch(n.label){case 0:return[4,Promise.all(e.map(function(s){return s.getFile()}))];case 1:return t=n.sent(),[2,t.map(function(s){return gg(s)})]}})})}function wme(e,t){return jd(this,void 0,void 0,function(){var n,s;return kd(this,function(i){switch(i.label){case 0:return e.items?(n=MC(e.items).filter(function(o){return o.kind==="file"}),t!=="drop"?[2,n]:[4,Promise.all(n.map(Sme))]):[3,2];case 1:return s=i.sent(),[2,_T(gO(s))];case 2:return[2,_T(MC(e.files).map(function(o){return gg(o)}))]}})})}function _T(e){return e.filter(function(t){return mme.indexOf(t.name)===-1})}function MC(e){if(e===null)return[];for(var t=[],n=0;n<e.length;n++){var s=e[n];t.push(s)}return t}function Sme(e){if(typeof e.webkitGetAsEntry!="function")return IT(e);var t=e.webkitGetAsEntry();return t&&t.isDirectory?mO(t):IT(e)}function gO(e){return e.reduce(function(t,n){return EC(EC([],kT(t),!1),kT(Array.isArray(n)?gO(n):[n]),!1)},[])}function IT(e){var t=e.getAsFile();if(!t)return Promise.reject("".concat(e," is not a File"));var n=gg(t);return Promise.resolve(n)}function jme(e){return jd(this,void 0,void 0,function(){return kd(this,function(t){return[2,e.isDirectory?mO(e):kme(e)]})})}function mO(e){var t=e.createReader();return new Promise(function(n,s){var i=[];function o(){var a=this;t.readEntries(function(l){return jd(a,void 0,void 0,function(){var c,d,h;return kd(this,function(f){switch(f.label){case 0:if(l.length)return[3,5];f.label=1;case 1:return f.trys.push([1,3,,4]),[4,Promise.all(i)];case 2:return c=f.sent(),n(c),[3,4];case 3:return d=f.sent(),s(d),[3,4];case 4:return[3,6];case 5:h=Promise.all(l.map(jme)),i.push(h),o(),f.label=6;case 6:return[2]}})})},function(l){s(l)})}o()})}function kme(e){return jd(this,void 0,void 0,function(){return kd(this,function(t){return[2,new Promise(function(n,s){e.file(function(i){var o=gg(i,e.fullPath);n(o)},function(i){s(i)})})]})})}var bm={},TT;function _me(){return TT||(TT=1,bm.__esModule=!0,bm.default=function(e,t){if(e&&t){var n=Array.isArray(t)?t:t.split(","),s=e.name||"",i=(e.type||"").toLowerCase(),o=i.replace(/\/.*$/,"");return n.some(function(a){var l=a.trim().toLowerCase();return l.charAt(0)==="."?s.toLowerCase().endsWith(l):l.endsWith("/*")?o===l.replace(/\/.*$/,""):i===l})}return!0}),bm}var Ime=_me();const yv=Qu(Ime);function AT(e){return Eme(e)||Ame(e)||bO(e)||Tme()}function Tme(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ame(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Eme(e){if(Array.isArray(e))return PC(e)}function ET(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,s)}return n}function MT(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?ET(Object(n),!0).forEach(function(s){yO(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ET(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function yO(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function np(e,t){return Lme(e)||Pme(e,t)||bO(e,t)||Mme()}function Mme(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function bO(e,t){if(e){if(typeof e=="string")return PC(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return PC(e,t)}}function PC(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}function Pme(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var s=[],i=!0,o=!1,a,l;try{for(n=n.call(e);!(i=(a=n.next()).done)&&(s.push(a.value),!(t&&s.length===t));i=!0);}catch(c){o=!0,l=c}finally{try{!i&&n.return!=null&&n.return()}finally{if(o)throw l}}return s}}function Lme(e){if(Array.isArray(e))return e}var Dme=typeof yv=="function"?yv:yv.default,Rme="file-invalid-type",Ome="file-too-large",Nme="file-too-small",Fme="too-many-files",Bme=function(t){t=Array.isArray(t)&&t.length===1?t[0]:t;var n=Array.isArray(t)?"one of ".concat(t.join(", ")):t;return{code:Rme,message:"File type must be ".concat(n)}},PT=function(t){return{code:Ome,message:"File is larger than ".concat(t," ").concat(t===1?"byte":"bytes")}},LT=function(t){return{code:Nme,message:"File is smaller than ".concat(t," ").concat(t===1?"byte":"bytes")}},$me={code:Fme,message:"Too many files"};function xO(e,t){var n=e.type==="application/x-moz-file"||Dme(e,t);return[n,n?null:Bme(t)]}function vO(e,t,n){if(Sl(e.size))if(Sl(t)&&Sl(n)){if(e.size>n)return[!1,PT(n)];if(e.size<t)return[!1,LT(t)]}else{if(Sl(t)&&e.size<t)return[!1,LT(t)];if(Sl(n)&&e.size>n)return[!1,PT(n)]}return[!0,null]}function Sl(e){return e!=null}function Vme(e){var t=e.files,n=e.accept,s=e.minSize,i=e.maxSize,o=e.multiple,a=e.maxFiles,l=e.validator;return!o&&t.length>1||o&&a>=1&&t.length>a?!1:t.every(function(c){var d=xO(c,n),h=np(d,1),f=h[0],p=vO(c,s,i),g=np(p,1),m=g[0],y=l?l(c):null;return f&&m&&!y})}function c1(e){return typeof e.isPropagationStopped=="function"?e.isPropagationStopped():typeof e.cancelBubble<"u"?e.cancelBubble:!1}function xm(e){return e.dataTransfer?Array.prototype.some.call(e.dataTransfer.types,function(t){return t==="Files"||t==="application/x-moz-file"}):!!e.target&&!!e.target.files}function DT(e){e.preventDefault()}function zme(e){return e.indexOf("MSIE")!==-1||e.indexOf("Trident/")!==-1}function Gme(e){return e.indexOf("Edge/")!==-1}function Hme(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.navigator.userAgent;return zme(e)||Gme(e)}function $i(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(s){for(var i=arguments.length,o=new Array(i>1?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];return t.some(function(l){return!c1(s)&&l&&l.apply(void 0,[s].concat(o)),c1(s)})}}function Wme(){return"showOpenFilePicker"in window}function Ume(e){if(Sl(e)){var t=Object.entries(e).filter(function(n){var s=np(n,2),i=s[0],o=s[1],a=!0;return CO(i)||(console.warn('Skipped "'.concat(i,'" because it is not a valid MIME type. Check https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types/Common_types for a list of valid MIME types.')),a=!1),(!Array.isArray(o)||!o.every(wO))&&(console.warn('Skipped "'.concat(i,'" because an invalid file extension was provided.')),a=!1),a}).reduce(function(n,s){var i=np(s,2),o=i[0],a=i[1];return MT(MT({},n),{},yO({},o,a))},{});return[{description:"Files",accept:t}]}return e}function qme(e){if(Sl(e))return Object.entries(e).reduce(function(t,n){var s=np(n,2),i=s[0],o=s[1];return[].concat(AT(t),[i],AT(o))},[]).filter(function(t){return CO(t)||wO(t)}).join(",")}function Kme(e){return e instanceof DOMException&&(e.name==="AbortError"||e.code===e.ABORT_ERR)}function Zme(e){return e instanceof DOMException&&(e.name==="SecurityError"||e.code===e.SECURITY_ERR)}function CO(e){return e==="audio/*"||e==="video/*"||e==="image/*"||e==="text/*"||/\w+\/[-+.\w]+/g.test(e)}function wO(e){return/^.*\.[\w]+$/.test(e)}var Yme=["children"],Xme=["open"],Qme=["refKey","role","onKeyDown","onFocus","onBlur","onClick","onDragEnter","onDragOver","onDragLeave","onDrop"],Jme=["refKey","onChange","onClick"];function e0e(e){return s0e(e)||n0e(e)||SO(e)||t0e()}function t0e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function n0e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function s0e(e){if(Array.isArray(e))return LC(e)}function bv(e,t){return o0e(e)||i0e(e,t)||SO(e,t)||r0e()}function r0e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function SO(e,t){if(e){if(typeof e=="string")return LC(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return LC(e,t)}}function LC(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}function i0e(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var s=[],i=!0,o=!1,a,l;try{for(n=n.call(e);!(i=(a=n.next()).done)&&(s.push(a.value),!(t&&s.length===t));i=!0);}catch(c){o=!0,l=c}finally{try{!i&&n.return!=null&&n.return()}finally{if(o)throw l}}return s}}function o0e(e){if(Array.isArray(e))return e}function RT(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,s)}return n}function vn(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?RT(Object(n),!0).forEach(function(s){DC(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):RT(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function DC(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u1(e,t){if(e==null)return{};var n=a0e(e,t),s,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)s=o[i],!(t.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(e,s)&&(n[s]=e[s])}return n}function a0e(e,t){if(e==null)return{};var n={},s=Object.keys(e),i,o;for(o=0;o<s.length;o++)i=s[o],!(t.indexOf(i)>=0)&&(n[i]=e[i]);return n}var xk=u.forwardRef(function(e,t){var n=e.children,s=u1(e,Yme),i=sa(s),o=i.open,a=u1(i,Xme);return u.useImperativeHandle(t,function(){return{open:o}},[o]),be.createElement(u.Fragment,null,n(vn(vn({},a),{},{open:o})))});xk.displayName="Dropzone";var jO={disabled:!1,getFilesFromEvent:yme,maxSize:1/0,minSize:0,multiple:!0,maxFiles:0,preventDropOnDocument:!0,noClick:!1,noKeyboard:!1,noDrag:!1,noDragEventsBubbling:!1,validator:null,useFsAccessApi:!1,autoFocus:!1};xk.defaultProps=jO;xk.propTypes={children:Yt.func,accept:Yt.objectOf(Yt.arrayOf(Yt.string)),multiple:Yt.bool,preventDropOnDocument:Yt.bool,noClick:Yt.bool,noKeyboard:Yt.bool,noDrag:Yt.bool,noDragEventsBubbling:Yt.bool,minSize:Yt.number,maxSize:Yt.number,maxFiles:Yt.number,disabled:Yt.bool,getFilesFromEvent:Yt.func,onFileDialogCancel:Yt.func,onFileDialogOpen:Yt.func,useFsAccessApi:Yt.bool,autoFocus:Yt.bool,onDragEnter:Yt.func,onDragLeave:Yt.func,onDragOver:Yt.func,onDrop:Yt.func,onDropAccepted:Yt.func,onDropRejected:Yt.func,onError:Yt.func,validator:Yt.func};var RC={isFocused:!1,isFileDialogActive:!1,isDragActive:!1,isDragAccept:!1,isDragReject:!1,acceptedFiles:[],fileRejections:[]};function sa(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=vn(vn({},jO),e),n=t.accept,s=t.disabled,i=t.getFilesFromEvent,o=t.maxSize,a=t.minSize,l=t.multiple,c=t.maxFiles,d=t.onDragEnter,h=t.onDragLeave,f=t.onDragOver,p=t.onDrop,g=t.onDropAccepted,m=t.onDropRejected,y=t.onFileDialogCancel,b=t.onFileDialogOpen,C=t.useFsAccessApi,x=t.autoFocus,v=t.preventDropOnDocument,w=t.noClick,S=t.noKeyboard,j=t.noDrag,P=t.noDragEventsBubbling,E=t.onError,D=t.validator,M=u.useMemo(function(){return qme(n)},[n]),R=u.useMemo(function(){return Ume(n)},[n]),F=u.useMemo(function(){return typeof b=="function"?b:OT},[b]),_=u.useMemo(function(){return typeof y=="function"?y:OT},[y]),L=u.useRef(null),O=u.useRef(null),B=u.useReducer(l0e,RC),z=bv(B,2),ee=z[0],ne=z[1],re=ee.isFocused,te=ee.isFileDialogActive,H=u.useRef(typeof window<"u"&&window.isSecureContext&&C&&Wme()),V=function(){!H.current&&te&&setTimeout(function(){if(O.current){var Ce=O.current.files;Ce.length||(ne({type:"closeDialog"}),_())}},300)};u.useEffect(function(){return window.addEventListener("focus",V,!1),function(){window.removeEventListener("focus",V,!1)}},[O,te,_,H]);var X=u.useRef([]),W=function(Ce){L.current&&L.current.contains(Ce.target)||(Ce.preventDefault(),X.current=[])};u.useEffect(function(){return v&&(document.addEventListener("dragover",DT,!1),document.addEventListener("drop",W,!1)),function(){v&&(document.removeEventListener("dragover",DT),document.removeEventListener("drop",W))}},[L,v]),u.useEffect(function(){return!s&&x&&L.current&&L.current.focus(),function(){}},[L,x,s]);var Y=u.useCallback(function(ce){E?E(ce):console.error(ce)},[E]),$=u.useCallback(function(ce){ce.preventDefault(),ce.persist(),le(ce),X.current=[].concat(e0e(X.current),[ce.target]),xm(ce)&&Promise.resolve(i(ce)).then(function(Ce){if(!(c1(ce)&&!P)){var He=Ce.length,Xe=He>0&&Vme({files:Ce,accept:M,minSize:a,maxSize:o,multiple:l,maxFiles:c,validator:D}),mt=He>0&&!Xe;ne({isDragAccept:Xe,isDragReject:mt,isDragActive:!0,type:"setDraggedFiles"}),d&&d(ce)}}).catch(function(Ce){return Y(Ce)})},[i,d,Y,P,M,a,o,l,c,D]),N=u.useCallback(function(ce){ce.preventDefault(),ce.persist(),le(ce);var Ce=xm(ce);if(Ce&&ce.dataTransfer)try{ce.dataTransfer.dropEffect="copy"}catch{}return Ce&&f&&f(ce),!1},[f,P]),U=u.useCallback(function(ce){ce.preventDefault(),ce.persist(),le(ce);var Ce=X.current.filter(function(Xe){return L.current&&L.current.contains(Xe)}),He=Ce.indexOf(ce.target);He!==-1&&Ce.splice(He,1),X.current=Ce,!(Ce.length>0)&&(ne({type:"setDraggedFiles",isDragActive:!1,isDragAccept:!1,isDragReject:!1}),xm(ce)&&h&&h(ce))},[L,h,P]),ie=u.useCallback(function(ce,Ce){var He=[],Xe=[];ce.forEach(function(mt){var rn=xO(mt,M),pn=bv(rn,2),bn=pn[0],ls=pn[1],Os=vO(mt,a,o),xn=bv(Os,2),Bi=xn[0],la=xn[1],bs=D?D(mt):null;if(bn&&Bi&&!bs)He.push(mt);else{var qs=[ls,la];bs&&(qs=qs.concat(bs)),Xe.push({file:mt,errors:qs.filter(function(ui){return ui})})}}),(!l&&He.length>1||l&&c>=1&&He.length>c)&&(He.forEach(function(mt){Xe.push({file:mt,errors:[$me]})}),He.splice(0)),ne({acceptedFiles:He,fileRejections:Xe,type:"setFiles"}),p&&p(He,Xe,Ce),Xe.length>0&&m&&m(Xe,Ce),He.length>0&&g&&g(He,Ce)},[ne,l,M,a,o,c,p,g,m,D]),ue=u.useCallback(function(ce){ce.preventDefault(),ce.persist(),le(ce),X.current=[],xm(ce)&&Promise.resolve(i(ce)).then(function(Ce){c1(ce)&&!P||ie(Ce,ce)}).catch(function(Ce){return Y(Ce)}),ne({type:"reset"})},[i,ie,Y,P]),xe=u.useCallback(function(){if(H.current){ne({type:"openDialog"}),F();var ce={multiple:l,types:R};window.showOpenFilePicker(ce).then(function(Ce){return i(Ce)}).then(function(Ce){ie(Ce,null),ne({type:"closeDialog"})}).catch(function(Ce){Kme(Ce)?(_(Ce),ne({type:"closeDialog"})):Zme(Ce)?(H.current=!1,O.current?(O.current.value=null,O.current.click()):Y(new Error("Cannot open the file picker because the https://developer.mozilla.org/en-US/docs/Web/API/File_System_Access_API is not supported and no <input> was provided."))):Y(Ce)});return}O.current&&(ne({type:"openDialog"}),F(),O.current.value=null,O.current.click())},[ne,F,_,C,ie,Y,R,l]),Me=u.useCallback(function(ce){!L.current||!L.current.isEqualNode(ce.target)||(ce.key===" "||ce.key==="Enter"||ce.keyCode===32||ce.keyCode===13)&&(ce.preventDefault(),xe())},[L,xe]),je=u.useCallback(function(){ne({type:"focus"})},[]),Fe=u.useCallback(function(){ne({type:"blur"})},[]),nt=u.useCallback(function(){w||(Hme()?setTimeout(xe,0):xe())},[w,xe]),$e=function(Ce){return s?null:Ce},Z=function(Ce){return S?null:$e(Ce)},se=function(Ce){return j?null:$e(Ce)},le=function(Ce){P&&Ce.stopPropagation()},ve=u.useMemo(function(){return function(){var ce=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},Ce=ce.refKey,He=Ce===void 0?"ref":Ce,Xe=ce.role,mt=ce.onKeyDown,rn=ce.onFocus,pn=ce.onBlur,bn=ce.onClick,ls=ce.onDragEnter,Os=ce.onDragOver,xn=ce.onDragLeave,Bi=ce.onDrop,la=u1(ce,Qme);return vn(vn(DC({onKeyDown:Z($i(mt,Me)),onFocus:Z($i(rn,je)),onBlur:Z($i(pn,Fe)),onClick:$e($i(bn,nt)),onDragEnter:se($i(ls,$)),onDragOver:se($i(Os,N)),onDragLeave:se($i(xn,U)),onDrop:se($i(Bi,ue)),role:typeof Xe=="string"&&Xe!==""?Xe:"presentation"},He,L),!s&&!S?{tabIndex:0}:{}),la)}},[L,Me,je,Fe,nt,$,N,U,ue,S,j,s]),ye=u.useCallback(function(ce){ce.stopPropagation()},[]),me=u.useMemo(function(){return function(){var ce=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},Ce=ce.refKey,He=Ce===void 0?"ref":Ce,Xe=ce.onChange,mt=ce.onClick,rn=u1(ce,Jme),pn=DC({accept:M,multiple:l,type:"file",style:{display:"none"},onChange:$e($i(Xe,ue)),onClick:$e($i(mt,ye)),tabIndex:-1},He,O);return vn(vn({},pn),rn)}},[O,n,l,ue,s]);return vn(vn({},ee),{},{isFocused:re&&!s,getRootProps:ve,getInputProps:me,rootRef:L,inputRef:O,open:$e(xe)})}function l0e(e,t){switch(t.type){case"focus":return vn(vn({},e),{},{isFocused:!0});case"blur":return vn(vn({},e),{},{isFocused:!1});case"openDialog":return vn(vn({},RC),{},{isFileDialogActive:!0});case"closeDialog":return vn(vn({},e),{},{isFileDialogActive:!1});case"setDraggedFiles":return vn(vn({},e),{},{isDragActive:t.isDragActive,isDragAccept:t.isDragAccept,isDragReject:t.isDragReject});case"setFiles":return vn(vn({},e),{},{acceptedFiles:t.acceptedFiles,fileRejections:t.fileRejections});case"reset":return vn({},RC);default:return e}}function OT(){}const kO=u.memo(()=>{const{t:e}=A(),t=Xa(),n=u.useCallback(([o])=>{o&&t({type:"file",data:o})},[t]),{getInputProps:s,getRootProps:i}=sa({accept:{"application/json":[".json"]},onDropAccepted:n,noDrag:!0,multiple:!1});return r.jsxs(r.Fragment,{children:[r.jsx(de,{leftIcon:r.jsx(cg,{}),...i(),pointerEvents:"auto",variant:"ghost",justifyContent:"flex-start",children:e("workflows.uploadWorkflow")}),r.jsx("input",{...s()})]})});kO.displayName="UploadWorkflowButton";const c0e=()=>{const{t:e}=A(),t=ae(CS),n=I(pc),s=I(_y);return r.jsxs(T,{h:"full",minH:0,overflow:"hidden",flexDir:"column",w:64,gap:0,children:[r.jsxs(T,{flexDir:"column",w:"full",pb:2,gap:2,children:[r.jsx(ja,{view:"recent",children:e("workflows.recentlyOpened")}),r.jsx(ja,{view:"yours",children:e("workflows.yourWorkflows")}),t.includes("project")&&r.jsx(Ja,{in:n==="yours"||n==="shared"||n==="private",children:r.jsxs(T,{flexDir:"column",gap:2,pl:4,pt:2,children:[r.jsx(ja,{size:"sm",view:"private",children:e("workflows.private")}),r.jsxs(ja,{size:"sm",rightIcon:r.jsx(zj,{}),view:"shared",children:[e("workflows.shared"),r.jsx(it,{})]})]})}),s&&r.jsx(ja,{view:"published",children:e("workflows.published")})]}),r.jsxs(T,{h:"full",minH:0,overflow:"hidden",flexDir:"column",children:[r.jsx(_O,{}),r.jsx(IO,{})]}),r.jsx(it,{}),r.jsx(fO,{}),r.jsx(kO,{})]})},_O=u.memo(()=>{const{t:e}=A(),t=I(pc),n=G(),s=I(wS),i=u.useCallback(()=>{n(yQ())},[n]);return t==="defaults"&&s.length>0?r.jsxs(Zn,{children:[r.jsx(ja,{view:"defaults",w:"auto",children:e("workflows.browseWorkflows")}),r.jsx(Ee,{label:e("workflows.deselectAll"),children:r.jsx(oe,{onClick:i,size:"md","aria-label":e("workflows.deselectAll"),icon:r.jsx(ur,{size:12}),variant:"ghost",bg:"base.700",color:"base.50"})})]}):r.jsx(ja,{view:"defaults",children:e("workflows.browseWorkflows")})});_O.displayName="BrowseWorkflowsButton";const u0e=li({visibility:"visible"}).options,IO=u.memo(()=>{const e=ae(bQ),t=I(pc);return r.jsx(Ja,{in:t==="defaults",children:r.jsx(T,{flexDir:"column",gap:2,pl:4,py:2,overflow:"hidden",h:"100%",minH:0,children:r.jsx(ps,{style:jo,options:u0e,children:r.jsx(T,{flexDir:"column",gap:2,overflow:"auto",children:e.map(n=>r.jsx(TO,{tagCategory:n},n.categoryTKey))})})})})});IO.displayName="DefaultsViewCheckboxes";const d0e=e=>{const t=ae(zM),n=u.useMemo(()=>({tags:t.map(o=>o.label),categories:["default"]}),[t]),s=u.useMemo(()=>({selectFromResult:({data:o})=>({count:(o==null?void 0:o[e])??0})}),[e]),{count:i}=GM(n,s);return i},h0e=e=>{const t=ae(zM),n=u.useMemo(()=>({tags:t.map(o=>o.label),categories:["default"]}),[t]),s=u.useMemo(()=>({selectFromResult:({data:o})=>o?{count:e.tags.reduce((a,l)=>a+(o[l.label]??0),0)}:{count:0}}),[e]),{count:i}=GM(n,s);return i},ja=u.memo(({view:e,...t})=>{const n=Iy(),s=I(pc),i=u.useCallback(()=>{n(af(e))},[n,e]);return r.jsx(de,{variant:"ghost",justifyContent:"flex-start",size:"md",flexShrink:0,w:"full",onClick:i,...t,bg:s===e?"base.700":void 0,color:s===e?"base.50":void 0})});ja.displayName="NavButton";const TO=u.memo(({tagCategory:e})=>{const{t}=A();return h0e(e)===0?null:r.jsxs(T,{flexDir:"column",gap:2,children:[r.jsx(q,{fontWeight:"semibold",color:"base.300",flexShrink:0,children:t(e.categoryTKey)}),r.jsx(T,{flexDir:"column",gap:2,pl:4,children:e.tags.map(s=>r.jsx(AO,{tag:s},s.label))})]})});TO.displayName="TagCategory";const AO=u.memo(({tag:e,...t})=>{const n=G(),{t:s}=A(),o=I(wS).includes(e.label),a=d0e(e.label),l=u.useCallback(()=>{n(xQ(e.label))},[n,e]);return a===0?null:r.jsxs(T,{alignItems:"center",gap:2,children:[r.jsx(Sn,{isChecked:o,onChange:l,...t,flexShrink:0}),r.jsx(q,{children:`${e.label} (${a})`}),e.recommended&&r.jsx(Ee,{label:s("workflows.recommended"),children:r.jsx(Se,{as:"span",lineHeight:0,children:r.jsx(lt,{as:db,boxSize:4,fill:"invokeYellow.500"})})})]})});AO.displayName="TagCheckbox";const EO=u.memo(({searchInputRef:e})=>{const t=G(),n=I(HM),{t:s}=A(),i=u.useCallback(c=>{t(iI(c))},[t]),o=u.useCallback(()=>{t(iI(""))},[t]),a=u.useCallback(c=>{c.key==="Escape"&&o()},[o]),l=u.useCallback(c=>{i(c.target.value)},[i]);return u.useEffect(()=>{e.current&&e.current.focus()},[e]),r.jsx(T,{justifyContent:"flex-end",w:"300px",children:r.jsxs(ta,{children:[r.jsx(kt,{ref:e,placeholder:s("workflows.searchPlaceholder"),value:n,onKeyDown:a,onChange:l}),n&&n.length&&r.jsx(co,{h:"full",pe:2,children:r.jsx(oe,{onClick:o,size:"sm",variant:"link","aria-label":s("boards.clearSearch"),icon:r.jsx(Ot,{})})})]})})});EO.displayName="WorkflowSearch";const f0e=Ge.enum(["opened_at","created_at","updated_at","name"]),p0e=e=>f0e.safeParse(e).success,g0e=Ge.enum(["ASC","DESC"]),m0e=e=>g0e.safeParse(e).success,y0e=()=>{const{t:e}=A(),t=I(WM),n=I(UM),s=ae(vQ),i=u.useMemo(()=>({opened_at:e("workflows.opened"),created_at:e("workflows.created"),updated_at:e("workflows.updated"),name:e("workflows.name")}),[e]),o=u.useMemo(()=>({ASC:e("workflows.ascending"),DESC:e("workflows.descending")}),[e]),a=G(),l=u.useCallback(d=>{p0e(d.target.value)&&a(oI(d.target.value))},[a]),c=u.useCallback(d=>{m0e(d.target.value)&&a(aI(d.target.value))},[a]);return u.useEffect(()=>{s.includes("opened_at")||(a(oI("name")),a(aI("ASC")))},[s,a]),r.jsxs(T,{flexDir:"row",gap:6,children:[r.jsxs(K,{orientation:"horizontal",gap:0,w:"auto",children:[r.jsx(J,{children:e("common.orderBy")}),r.jsx(_i,{value:t??s[0],onChange:l,size:"sm",children:s.map(d=>r.jsx("option",{value:d,children:i[d]},d))})]}),r.jsxs(K,{orientation:"horizontal",gap:0,w:"auto",children:[r.jsx(J,{children:e("common.direction")}),r.jsxs(_i,{value:n,onChange:c,size:"sm",children:[r.jsx("option",{value:"ASC",children:o.ASC}),r.jsx("option",{value:"DESC",children:o.DESC})]})]})]})},b0e=()=>{const e=u.useRef(null),t=I(pc);return r.jsxs(T,{gap:8,justifyContent:"space-between",children:[r.jsx(EO,{searchInputRef:e}),t!=="recent"&&r.jsx(y0e,{})]})},MO=u.memo(()=>{const{t:e}=A();return r.jsx(Ee,{label:e("workflows.builder.publishedWorkflowsLocked"),closeOnScroll:!0,children:r.jsx(oe,{size:"sm",cursor:"not-allowed",variant:"link",alignSelf:"stretch","aria-label":e("workflows.builder.publishedWorkflowsLocked"),icon:r.jsx(Xde,{})})})});MO.displayName="LockedWorkflowIcon";const PO=u.memo(({workflow:e})=>{const t=lme(),{t:n}=A(),s=u.useCallback(i=>{i.stopPropagation(),t(e)},[t,e]);return r.jsx(Ee,{label:n("workflows.copyShareLink"),closeOnScroll:!0,children:r.jsx(oe,{size:"sm",variant:"link",alignSelf:"stretch","aria-label":n("workflows.copyShareLink"),onClick:s,icon:r.jsx(n7,{})})})});PO.displayName="ShareWorkflowButton";const vk=Oe(null),x0e=()=>vk.set(null),v0e=()=>u.useCallback(t=>{vk.set(t)},[]),C0e=()=>{At("DeleteWorkflowDialog");const{t:e}=A(),t=ae(vk),[n]=CQ(),s=u.useCallback(async()=>{if(t)try{await n(t).unwrap(),ge({id:"WORKFLOW_DELETED",title:e("toast.workflowDeleted")})}catch{ge({id:`AUTH_ERROR_TOAST_${va.endpoints.deleteWorkflow.name}`,title:e("toast.problemDeletingWorkflow"),status:"error"})}},[n,e,t]);return r.jsx(ai,{isOpen:t!==null,onClose:x0e,title:e("workflows.deleteWorkflow"),acceptCallback:s,acceptButtonText:e("common.delete"),cancelButtonText:e("common.cancel"),useInert:!1,children:r.jsx(q,{children:e("workflows.deleteWorkflow2")})})},w0e=({workflowId:e})=>{const{t}=A(),n=v0e(),s=u.useCallback(i=>{i.stopPropagation(),n(e)},[n,e]);return r.jsx(Ee,{label:t("workflows.delete"),closeOnScroll:!0,children:r.jsx(oe,{size:"sm",variant:"link",alignSelf:"stretch","aria-label":t("workflows.delete"),onClick:s,colorScheme:"error",icon:r.jsx(Vj,{})})})},S0e=()=>{const{t:e}=A(),t=G(),[n,s]=wQ(),i=u.useCallback(()=>{ge({status:"error",description:e("nodes.downloadWorkflowError")})},[e]);return{downloadWorkflow:u.useCallback(async a=>{try{const{data:l}=await n(a);if(!l){i();return}const{workflow:c}=l,d=new Blob([JSON.stringify(c,null,2)]),h=document.createElement("a");h.href=URL.createObjectURL(d),h.download=`${c.name||"My Workflow"}.json`,document.body.appendChild(h),h.click(),h.remove(),t(qM())}catch{i()}},[t,i,n]),isLoading:s.isLoading}},j0e=({workflowId:e})=>{const t=S0e(),n=u.useCallback(i=>{i.stopPropagation(),t.downloadWorkflow(e)},[t,e]),{t:s}=A();return r.jsx(Ee,{label:s("workflows.download"),closeOnScroll:!0,children:r.jsx(oe,{size:"sm",variant:"link",alignSelf:"stretch","aria-label":s("workflows.download"),onClick:n,icon:r.jsx(md,{}),isLoading:t.isLoading})})},k0e=({workflowId:e})=>{const t=G(),n=Xa(),{t:s}=A(),i=u.useCallback(o=>{o.stopPropagation(),n({type:"library",data:e,onSuccess:()=>{t(za("edit"))}})},[t,n,e]);return r.jsx(Ee,{label:s("workflows.edit"),closeOnScroll:!0,children:r.jsx(oe,{size:"sm",variant:"link",alignSelf:"stretch","aria-label":s("workflows.edit"),onClick:i,icon:r.jsx(cb,{})})})},_0e=({workflowId:e})=>{const t=G(),n=Xa(),{t:s}=A(),i=u.useCallback(o=>{o.stopPropagation(),n({type:"library",data:e,onSuccess:()=>{t(za("view"))}})},[t,n,e]);return r.jsx(Ee,{label:s("workflows.view"),closeOnScroll:!0,children:r.jsx(oe,{size:"sm",variant:"link",alignSelf:"stretch","aria-label":s("workflows.view"),onClick:i,icon:r.jsx(yd,{})})})},Ra="108px",LO="32px",DO="workflow-action-buttons",I0e={_hover:{bg:"base.700",[`& .${DO}`]:{display:"flex"}}},RO=u.memo(({workflow:e})=>{const{t}=A(),n=G(),s=I(py),i=Xa(),o=u.useMemo(()=>s===e.workflow_id,[s,e.workflow_id]),a=u.useCallback(()=>{i({type:"library",data:e.workflow_id,onSuccess:()=>{n(za("view"))}})},[n,i,e.workflow_id]);return r.jsxs(T,{position:"relative",role:"button",onClick:a,bg:"base.750",borderRadius:"base",w:"full",alignItems:"stretch",sx:I0e,gap:2,children:[r.jsx(T,{p:2,pr:0,children:r.jsx(Wt,{src:e.thumbnail_url??void 0,fallbackStrategy:"beforeLoadOrError",fallback:e.category==="default"?r.jsx(NO,{}):r.jsx(OO,{}),objectFit:"cover",objectPosition:"50% 50%",height:Ra,width:Ra,minHeight:Ra,minWidth:Ra,borderRadius:"base"})}),r.jsxs(T,{flexDir:"column",gap:1,justifyContent:"space-between",w:"full",children:[r.jsxs(T,{flexDir:"column",gap:1,alignItems:"flex-start",pt:2,pe:2,w:"full",children:[r.jsxs(T,{gap:2,alignItems:"flex-start",justifyContent:"space-between",w:"full",children:[r.jsx(q,{noOfLines:2,children:e.name}),r.jsxs(T,{gap:2,alignItems:"center",children:[o&&!e.is_published&&r.jsx(Kn,{color:"invokeBlue.400",borderColor:"invokeBlue.700",borderWidth:1,bg:"transparent",flexShrink:0,variant:"subtle",children:t("workflows.opened")}),e.is_published&&r.jsx(Kn,{color:"invokeGreen.400",borderColor:"invokeGreen.700",borderWidth:1,bg:"transparent",flexShrink:0,variant:"subtle",children:t("workflows.builder.published")}),e.category==="project"&&r.jsx(lt,{as:zj,color:"base.200"}),e.category==="default"&&r.jsx(Wt,{src:SS,alt:"invoke-logo",w:"14px",h:"14px",minW:"14px",minH:"14px",userSelect:"none",opacity:.5})]})]}),r.jsx(q,{variant:"subtext",fontSize:"xs",noOfLines:3,children:e.description})]}),r.jsxs(T,{className:DO,alignItems:"center",display:"none",h:8,children:[e.opened_at&&r.jsxs(q,{variant:"subtext",fontSize:"xs",noOfLines:1,justifySelf:"flex-end",pb:.5,children:[t("workflows.opened")," ",new Date(e.opened_at).toLocaleString()]}),r.jsx(it,{}),e.category==="default"&&!e.is_published&&r.jsx(_0e,{workflowId:e.workflow_id}),e.category!=="default"&&!e.is_published&&r.jsxs(r.Fragment,{children:[r.jsx(k0e,{workflowId:e.workflow_id}),r.jsx(j0e,{workflowId:e.workflow_id}),r.jsx(w0e,{workflowId:e.workflow_id})]}),e.category==="project"&&r.jsx(PO,{workflow:e}),e.is_published&&r.jsx(MO,{})]})]})]})});RO.displayName="WorkflowListItem";const OO=u.memo(()=>r.jsx(T,{height:Ra,minWidth:Ra,bg:"base.600",borderRadius:"base",alignItems:"center",justifyContent:"center",opacity:.3,children:r.jsx(lt,{as:Wj,boxSize:LO})}));OO.displayName="UserThumbnailFallback";const NO=u.memo(()=>r.jsx(T,{height:Ra,minWidth:Ra,bg:"base.600",borderRadius:"base",alignItems:"center",justifyContent:"center",opacity:.3,children:r.jsx(Wt,{src:SS,alt:"invoke-logo",userSelect:"none",boxSize:LO,p:1})}));NO.displayName="DefaultThumbnailFallback";const T0e=30,A0e=e=>{switch(e){case"defaults":return["default"];case"recent":return["user","project","default"];case"yours":return["user","project"];case"private":return["user"];case"shared":return["project"];case"published":return["user","project","default"];default:we(!1)}},E0e=e=>{if(e==="recent")return!0},M0e=()=>{const e=I(WM),t=I(UM),n=I(HM),s=I(wS),i=I(pc),[o]=vc(n,500);return u.useMemo(()=>({page:0,per_page:T0e,order_by:e??"opened_at",direction:t,categories:A0e(i),query:o,tags:i==="defaults"?s:[],has_been_opened:E0e(i),is_published:i==="published"?!0:void 0}),[e,t,i,o,s])},P0e={selectFromResult:({data:e,...t})=>({items:(e==null?void 0:e.pages.map(({items:n})=>n).flat())??Ls,...t})},FO=u.memo(()=>{const e=M0e(),{items:t,isFetching:n,isLoading:s,fetchNextPage:i,hasNextPage:o}=SQ(e,P0e);return s?r.jsx(T,{alignItems:"center",justifyContent:"center",w:"full",h:"full",children:r.jsx(Lr,{})}):t.length===0?r.jsx(BO,{}):r.jsx($O,{items:t,hasNextPage:o,fetchNextPage:i,isFetching:n})});FO.displayName="WorkflowList";const BO=u.memo(()=>{const{t:e}=A(),t=I(jQ);return r.jsx(Pt,{fontSize:"sm",py:4,label:e(t?"nodes.noMatchingWorkflows":"nodes.noWorkflows"),icon:null})});BO.displayName="NoItems";const $O=u.memo(({items:e,hasNextPage:t,isFetching:n,fetchNextPage:s})=>{const{t:i}=A(),o=u.useRef(null),a=u.useCallback(()=>{if(!t||n)return;const c=o.current;if(!c)return;const{scrollTop:d,scrollHeight:h,clientHeight:f}=c;Math.abs(h-(d+f))<=1&&s()},[t,n,s]),l=u.useCallback(()=>{!t||n||!o.current||s()},[t,n,s]);return r.jsxs(T,{flexDir:"column",gap:4,flex:1,minH:0,children:[r.jsx(Ar,{ref:o,templateColumns:"repeat(auto-fill, minmax(360px, 1fr))",gridAutoFlow:"dense",gap:4,overflow:"scroll",onScroll:a,children:e.map(c=>r.jsx(xt,{id:`grid-${c.workflow_id}`,children:r.jsx(RO,{workflow:c},c.workflow_id)},c.workflow_id))}),r.jsx(it,{}),t&&r.jsx(de,{onClick:l,isLoading:n,loadingText:i("common.loading"),variant:"ghost",w:"min-content",alignSelf:"center",children:i("workflows.loadMore")})]})});$O.displayName="WorkflowListContent";const VO=u.memo(()=>{const{t:e}=A(),t=ky(),n=L0e();return r.jsxs(Dr,{isOpen:t.isOpen,onClose:t.close,isCentered:!0,children:[r.jsx(ar,{}),r.jsxs(Rr,{w:"calc(100% - var(--invoke-sizes-40))",maxW:"calc(100% - var(--invoke-sizes-40))",h:"calc(100% - var(--invoke-sizes-40))",maxH:"calc(100% - var(--invoke-sizes-40))",children:[r.jsx(lr,{children:e("workflows.workflowLibrary")}),r.jsx(Pi,{}),r.jsxs(Ws,{pb:6,children:[n&&r.jsxs(T,{gap:4,h:"100%",children:[r.jsx(c0e,{}),r.jsx(wt,{orientation:"vertical"}),r.jsxs(T,{flexDir:"column",flex:1,gap:4,children:[r.jsx(b0e,{}),r.jsx(FO,{})]})]}),!n&&r.jsx(Pt,{label:e("workflows.loading"),icon:null})]})]})]})});VO.displayName="WorkflowLibraryModal";const L0e=()=>{const e=G(),t=I(pc),n=ae(CS),[s,i]=u.useState(!1),o=u.useMemo(()=>({categories:["user","project","default"],has_been_opened:!0}),[]),a=u.useMemo(()=>({categories:["user","project"]}),[]),l=u.useMemo(()=>({selectFromResult:({data:p,isLoading:g})=>p?{count:Object.values(p).reduce((m,y)=>m+y,0),isLoading:g}:{count:0,isLoading:!0}}),[]),{count:c,isLoading:d}=lI(o,l),{count:h,isLoading:f}=lI(a,l);return u.useEffect(()=>{s||d||f||(c===0&&t==="recent"?h>0?e(af("yours")):e(af("defaults")):h===0&&(t==="yours"||t==="shared"||t==="private")&&(c>0?e(af("recent")):e(af("defaults"))),i(!0))},[n,s,e,d,f,c,t,h]),s},D0e=()=>{const{t:e}=A(),{data:t}=oi(),n=ae(Yn),[s,{isLoading:i}]=kQ({fixedCacheKey:"cancelAllExceptCurrent"}),o=u.useCallback(async()=>{if(t!=null&&t.queue.pending)try{await s().unwrap(),ge({id:"QUEUE_CANCEL_SUCCEEDED",title:e("queue.cancelSucceeded"),status:"success"})}catch{ge({id:"QUEUE_CANCEL_FAILED",title:e("queue.cancelFailed"),status:"error"})}},[t==null?void 0:t.queue.pending,s,e]),a=u.useMemo(()=>!n||!(t!=null&&t.queue.pending),[n,t==null?void 0:t.queue.pending]);return{cancelAllExceptCurrentQueueItem:o,isLoading:i,queueStatus:t,isDisabled:a}},[R0e]=dc(!1),mg=()=>{const e=R0e(),{cancelAllExceptCurrentQueueItem:t,isLoading:n,isDisabled:s,queueStatus:i}=D0e();return{cancelAllExceptCurrentQueueItem:t,isOpen:e.isTrue,openDialog:e.setTrue,closeDialog:e.setFalse,isLoading:n,queueStatus:i,isDisabled:s}},zO=u.memo(()=>{At("CancelAllExceptCurrentQueueItemConfirmationAlertDialog");const{t:e}=A(),t=mg();return r.jsxs(ai,{isOpen:t.isOpen,onClose:t.closeDialog,title:e("queue.cancelAllExceptCurrentTooltip"),acceptCallback:t.cancelAllExceptCurrentQueueItem,acceptButtonText:e("queue.confirm"),useInert:!1,children:[r.jsx(q,{children:e("queue.cancelAllExceptCurrentQueueItemAlertDialog")}),r.jsx("br",{}),r.jsx(q,{children:e("queue.cancelAllExceptCurrentQueueItemAlertDialog2")})]})});zO.displayName="CancelAllExceptCurrentQueueItemConfirmationAlertDialog";const[O0e]=dc(!1),yg=()=>{const e=O0e(),{clearQueue:t,isLoading:n,isDisabled:s,queueStatus:i}=hD();return{clearQueue:t,isOpen:e.isTrue,openDialog:e.setTrue,closeDialog:e.setFalse,isLoading:n,queueStatus:i,isDisabled:s}},GO=u.memo(()=>{At("ClearQueueConfirmationsAlertDialog");const{t:e}=A(),t=yg();return r.jsxs(ai,{isOpen:t.isOpen,onClose:t.closeDialog,title:e("queue.clearTooltip"),acceptCallback:t.clearQueue,acceptButtonText:e("queue.clear"),useInert:!1,children:[r.jsx(q,{children:e("queue.clearQueueAlertDialog")}),r.jsx("br",{}),r.jsx(q,{children:e("queue.clearQueueAlertDialog2")})]})});GO.displayName="ClearQueueConfirmationsAlertDialog";const Ck=Oe(null),N0e=()=>Ck.set(null),F0e=()=>u.useCallback(t=>{Ck.set(t)},[]),HO=u.memo(()=>{At("DeleteStylePresetDialog");const{t:e}=A(),t=ae(Ck),[n]=_Q(),s=u.useCallback(async()=>{if(t)try{await n(t.id).unwrap(),ge({status:"success",title:e("stylePresets.templateDeleted")})}catch{ge({status:"error",title:e("stylePresets.unableToDeleteTemplate")})}},[t,n,e]);return r.jsx(ai,{isOpen:t!==null,onClose:N0e,title:e("stylePresets.deleteTemplate"),acceptCallback:s,acceptButtonText:e("common.delete"),cancelButtonText:e("common.cancel"),useInert:!1,children:r.jsx(q,{children:e("stylePresets.deleteTemplate2")})})});HO.displayName="DeleteStylePresetDialog";const B0e=e=>{const{field:t}=ys(e),{t:n}=A(),s=u.useCallback(l=>{const c=l[0];c&&t.onChange(c)},[t]),i=u.useCallback(()=>{t.onChange(null)},[t]),{getInputProps:o,getRootProps:a}=sa({accept:{"image/png":[".png"],"image/jpeg":[".jpg",".jpeg",".png"]},onDropAccepted:s,noDrag:!0,multiple:!1});return t.value?r.jsxs(Se,{position:"relative",flexShrink:0,children:[r.jsx(Wt,{src:URL.createObjectURL(t.value),objectFit:"cover",objectPosition:"50% 50%",w:65,h:65,minWidth:65,borderRadius:"base"}),r.jsx(oe,{position:"absolute",insetInlineEnd:0,insetBlockStart:0,onClick:i,"aria-label":n("stylePresets.deleteImage"),tooltip:n("stylePresets.deleteImage"),icon:r.jsx(ur,{}),size:"md",variant:"ghost"})]}):r.jsxs(r.Fragment,{children:[r.jsx(Ee,{label:n("stylePresets.uploadImage"),children:r.jsx(T,{as:de,w:65,h:65,opacity:.3,borderRadius:"base",alignItems:"center",justifyContent:"center",flexShrink:0,...a(),children:r.jsx(lt,{as:cg,w:8,h:8})})}),r.jsx("input",{...o()})]})},NT=e=>{const{field:t}=ys(e),n=u.useRef(null),{t:s}=A(),i=u.useCallback(c=>{t.onChange(c.target.value)},[t]),o=u.useMemo(()=>t.value,[t.value]),a=u.useCallback(()=>{var c;if(n.current){const d=n.current.selectionStart,h=o.slice(0,d),f=o.slice(d),p=h+Bl+f;t.onChange(p)}else t.onChange(o+Bl);(c=n.current)==null||c.focus()},[o,t,n]),l=u.useMemo(()=>o==null?void 0:o.includes(Bl),[o]);return r.jsxs(K,{orientation:"vertical",gap:3,children:[r.jsxs(T,{alignItems:"center",gap:2,children:[r.jsx(J,{children:e.label}),r.jsx(de,{onClick:a,size:"xs","aria-label":s("stylePresets.insertPlaceholder"),isDisabled:l,children:s("stylePresets.insertPlaceholder")})]}),r.jsx(ss,{size:"sm",ref:n,value:o,onChange:i})]})},FT=[{label:Pe("stylePresets.private"),value:"user"},{label:Pe("stylePresets.shared"),value:"project"}],$0e=e=>{var a;const{field:t}=ys(e),n=ae(Wa),{t:s}=A(),i=u.useCallback(l=>{l&&t.onChange(l.value)},[t]),o=u.useMemo(()=>FT.find(l=>l.value===t.value),[t.value]);return r.jsxs(K,{orientation:"vertical",maxW:48,isDisabled:((a=n.prefilledFormData)==null?void 0:a.type)==="project",children:[r.jsx(J,{children:s("stylePresets.type")}),r.jsx(Ne,{value:o,options:FT,onChange:i})]})},V0e=({updatingStylePresetId:e,formData:t})=>{const[n,{isLoading:s}]=IQ(),[i,{isLoading:o}]=TQ(),{t:a}=A(),l=I(KM),{handleSubmit:c,control:d,register:h,formState:f}=hg({defaultValues:t||{name:"",positivePrompt:"",negativePrompt:"",image:null,type:"user"},mode:"onChange"}),p=u.useCallback(async g=>{const m={data:{name:g.name,positive_prompt:g.positivePrompt,negative_prompt:g.negativePrompt,type:g.type},image:g.image};try{e?await i({id:e,...m}).unwrap():await n(m).unwrap()}catch{ge({status:"error",title:"Failed to save style preset"})}Wa.set({prefilledFormData:null,updatingStylePresetId:null,isModalOpen:!1})},[e,i,n]);return r.jsxs(T,{flexDir:"column",gap:4,children:[r.jsxs(T,{alignItems:"center",gap:4,children:[r.jsx(B0e,{control:d,name:"image"}),r.jsxs(K,{orientation:"vertical",children:[r.jsx(J,{children:a("stylePresets.name")}),r.jsx(kt,{size:"md",...h("name",{required:!0,minLength:1})})]})]}),r.jsx(NT,{label:a("stylePresets.positivePrompt"),control:d,name:"positivePrompt"}),r.jsx(NT,{label:a("stylePresets.negativePrompt"),control:d,name:"negativePrompt"}),r.jsxs(Se,{children:[r.jsx(q,{variant:"subtext",children:a("stylePresets.promptTemplatesDesc1")}),r.jsx(q,{variant:"subtext",children:r.jsx(Ut,{i18nKey:"stylePresets.promptTemplatesDesc2",components:{Pre:r.jsx(z0e,{})},values:{placeholder:Bl}})}),r.jsx(q,{variant:"subtext",children:a("stylePresets.promptTemplatesDesc3")})]}),r.jsxs(T,{justifyContent:"space-between",alignItems:"flex-end",gap:10,children:[l?r.jsx($0e,{control:d,name:"type"}):r.jsx(it,{}),r.jsx(de,{onClick:c(p),isDisabled:!f.isValid,isLoading:s||o,children:a("common.save")})]})]})},z0e=e=>r.jsx(q,{as:"span",fontFamily:"monospace",fontWeight:"semibold",children:e.children}),G0e=()=>{At("StylePresetModal");const[e,t]=u.useState(null),{t:n}=A(),s=ae(Wa),i=u.useMemo(()=>s.updatingStylePresetId?n("stylePresets.updatePromptTemplate"):n("stylePresets.createPromptTemplate"),[s.updatingStylePresetId,n]),o=u.useCallback(()=>{Wa.set({prefilledFormData:null,updatingStylePresetId:null,isModalOpen:!1})},[]);return u.useEffect(()=>{t(null)},[]),u.useEffect(()=>{(async l=>{if(!l)t(null);else{let c=null;if(l.imageUrl)try{const d=await kb(l.imageUrl);d&&(c=new File([d],"style_preset.png",{type:"image/png"}))}catch{}t({...l,image:c})}})(s.prefilledFormData)},[s.prefilledFormData]),r.jsxs(Dr,{isOpen:s.isModalOpen,onClose:o,isCentered:!0,size:"2xl",useInert:!1,children:[r.jsx(ar,{}),r.jsxs(Rr,{children:[r.jsx(lr,{children:i}),r.jsx(Pi,{}),r.jsx(Ws,{display:"flex",flexDir:"column",gap:4,children:!s.prefilledFormData||e?r.jsx(V0e,{updatingStylePresetId:s.updatingStylePresetId,formData:e}):r.jsx(Lr,{})}),r.jsx(xo,{p:2})]})]})},[WO]=dc(!1),H0e=()=>{At("RefreshAfterResetModal");const{t:e}=A(),[t,n]=u.useState(3),s=WO();return u.useEffect(()=>{if(!s.isTrue)return;const i=window.setInterval(()=>n(o=>o-1),1e3);return()=>{window.clearInterval(i)}},[s.isTrue]),u.useEffect(()=>{t<=0&&window.location.reload()},[t]),r.jsx(r.Fragment,{children:r.jsxs(Dr,{closeOnOverlayClick:!1,isOpen:s.isTrue,onClose:s.setFalse,isCentered:!0,closeOnEsc:!1,useInert:!1,children:[r.jsx(ar,{backdropFilter:"blur(40px)"}),r.jsxs(Rr,{children:[r.jsx(lr,{}),r.jsx(Ws,{children:r.jsx(T,{justifyContent:"center",children:r.jsx(q,{fontSize:"lg",children:r.jsxs(q,{children:[e("settings.resetComplete")," ",e("settings.reloadingIn")," ",t,"..."]})})})}),r.jsx(xo,{})]})]})})},W0e=u.memo(H0e),UO=[{tKey:"creatingYourFirstImage",link:"https://www.youtube.com/watch?v=jVi2XgSGrfY&list=PLvWK1Kc8iXGrQy8r9TYg6QdUuJ5MMx-ZO&index=1&t=29s&pp=iAQB",length:{minutes:6,seconds:0}},{tKey:"usingControlLayersAndReferenceGuides",link:"https://www.youtube.com/watch?v=crgw6bEgyrw&list=PLvWK1Kc8iXGrQy8r9TYg6QdUuJ5MMx-ZO&index=2&t=70s&pp=iAQB",length:{minutes:5,seconds:30}},{tKey:"understandingImageToImageAndDenoising",link:"https://www.youtube.com/watch?v=tvj8-0s6S2U&list=PLvWK1Kc8iXGrQy8r9TYg6QdUuJ5MMx-ZO&index=3&t=1s&pp=iAQB",length:{minutes:2,seconds:37}},{tKey:"exploringAIModelsAndConceptAdapters",link:"https://www.youtube.com/watch?v=iwBmBQMZ0UA&list=PLvWK1Kc8iXGrQy8r9TYg6QdUuJ5MMx-ZO&index=4&pp=iAQB",length:{minutes:8,seconds:52}},{tKey:"creatingAndComposingOnInvokesControlCanvas",link:"https://www.youtube.com/watch?v=O4LaFcYFxlA",length:{minutes:2,seconds:52}},{tKey:"upscaling",link:"https://www.youtube.com/watch?v=OCb19_P0nro&list=PLvWK1Kc8iXGrQy8r9TYg6QdUuJ5MMx-ZO&index=6&t=2s&pp=iAQB",length:{minutes:4,seconds:0}}],U0e=[{tKey:"howDoIGenerateAndSaveToTheGallery",link:"https://youtu.be/Tl-69JvwJ2s?si=dbjmBc1iDAUpE1k5&t=26",length:{minutes:0,seconds:49}},{tKey:"howDoIEditOnTheCanvas",link:"https://youtu.be/Tl-69JvwJ2s?si=U_bFl9HsvSuejbxp&t=76",length:{minutes:0,seconds:58}},{tKey:"howDoIDoImageToImageTransformation",link:"https://youtu.be/Tl-69JvwJ2s?si=fjhTeY-yZ3qsEzEM&t=138",length:{minutes:0,seconds:51}},{tKey:"howDoIUseControlNetsAndControlLayers",link:"https://youtu.be/Tl-69JvwJ2s?si=x5KcYvkHbvR9ifsX&t=192",length:{minutes:1,seconds:41}},{tKey:"howDoIUseGlobalIPAdaptersAndReferenceImages",link:"https://youtu.be/Tl-69JvwJ2s?si=O940rNHiHGKXknK2&t=297",length:{minutes:0,seconds:43}},{tKey:"howDoIUseInpaintMasks",link:"https://youtu.be/Tl-69JvwJ2s?si=3DZhmerkzUmvJJSn&t=345",length:{minutes:1,seconds:9}},{tKey:"howDoIOutpaint",link:"https://youtu.be/Tl-69JvwJ2s?si=IIwkGZLq1PfLf80Q&t=420",length:{minutes:0,seconds:48}}],q0e="https://www.youtube.com/playlist?list=PLvWK1Kc8iXGq_8tWZqnwDVaf9uhlDC09U",qO=u.memo(e=>r.jsx(T,{ps:2,pb:4,position:"sticky",zIndex:1,top:0,bg:"base.800",sx:e.sx,children:r.jsx(Ft,{size:"sm",children:e.title})}));qO.displayName="StickyScrollableHeading";const KO=u.memo(e=>r.jsx(T,{p:4,borderRadius:"base",bg:"base.750",flexDir:"column",gap:4,sx:e.sx,children:e.children}));KO.displayName="StickyScrollableContent";const Wi=u.memo(e=>r.jsxs(T,{flexDir:"column",children:[r.jsx(qO,{title:e.title,sx:e.headingSx}),r.jsx(KO,{sx:e.contentSx,children:e.children})]},e.title));Wi.displayName="StickyScrollable";const wk=Xw("system/videoModalLinkClicked"),K0e=Xw("system/videoModalOpened"),Z0e=({minutes:e,seconds:t})=>`${e}:${t.toString().padStart(2,"0")}`,ZO=u.memo(({video:e})=>{const{t}=A(),n=G(),{tKey:s,link:i,length:o}=e,a=u.useCallback(()=>{n(wk(t(`supportVideos.videos.${s}.title`)))},[n,t,s]);return r.jsxs(T,{flexDir:"column",gap:1,children:[r.jsxs(T,{alignItems:"center",gap:2,children:[r.jsx(q,{fontSize:"md",fontWeight:"semibold",children:t(`supportVideos.videos.${s}.title`)}),r.jsx(it,{}),r.jsx(q,{variant:"subtext",children:Z0e(o)}),r.jsx(sr,{fontSize:"sm",href:i,label:t("supportVideos.watch"),onClick:a})]}),r.jsx(q,{fontSize:"md",variant:"subtext",children:t(`supportVideos.videos.${s}.description`)})]})});ZO.displayName="VideoCard";const OC=u.memo(({category:e,videos:t})=>r.jsx(Wi,{title:e,children:t.map((n,s)=>r.jsxs(u.Fragment,{children:[r.jsx(ZO,{video:n}),s<UO.length-1&&r.jsx(wt,{})]},`${n.tKey}-${s}`))}));OC.displayName="VideoCardList";const NC="http://github.com/invoke-ai/InvokeAI",Sk="https://discord.gg/ZmtBAhwWhy",BT="https://www.invoke.com/",[YO]=$M(!1),Y0e=()=>{const e=G(),t=u.useCallback(()=>{e(wk("Studio session playlist"))},[e]);return r.jsx(sr,{fontWeight:"semibold",href:q0e,display:"inline-flex",label:"Studio Sessions playlist",onClick:t})},X0e=()=>{const e=G(),t=u.useCallback(()=>{e(wk("Discord"))},[e]);return r.jsx(sr,{fontWeight:"semibold",href:Sk,display:"inline-flex",label:"Discord",onClick:t})},$T={StudioSessionsPlaylistLink:r.jsx(Y0e,{}),DiscordLink:r.jsx(X0e,{})},XO=u.memo(()=>{const{t:e}=A(),t=YO();return r.jsxs(Dr,{isOpen:t.isOpen,onClose:t.close,size:"2xl",isCentered:!0,useInert:!1,children:[r.jsx(ar,{}),r.jsxs(Rr,{maxH:"80vh",h:"80vh",children:[r.jsx(lr,{bg:"none",children:e("supportVideos.supportVideos")}),r.jsx(Pi,{}),r.jsx(Ws,{children:r.jsx(os,{children:r.jsxs(T,{flexDir:"column",gap:4,children:[r.jsxs(T,{flexDir:"column",gap:2,pb:2,children:[r.jsx(q,{fontSize:"md",children:r.jsx(Ut,{i18nKey:"supportVideos.studioSessionsDesc1",components:$T})}),r.jsx(q,{fontSize:"md",children:r.jsx(Ut,{i18nKey:"supportVideos.studioSessionsDesc2",components:$T})})]}),r.jsx(OC,{category:e("supportVideos.gettingStarted"),videos:UO}),r.jsx(OC,{category:e("supportVideos.controlCanvas"),videos:U0e})]})})}),r.jsx(xo,{})]})]})});XO.displayName="VideosModal";const xv=Oe(!1),QO=()=>{const e=ae(xv),t=u.useCallback(()=>{xv.set(!0)},[]),n=u.useCallback(()=>{xv.set(!1)},[]);return{isOpen:e,onOpen:t,onClose:n}},Q0e=()=>{const{t:e}=A(),{isOpen:t,onClose:n}=QO(),s=Xa(),[i,o]=u.useState(""),[a,l]=u.useState(),[c,d]=u.useState(""),[h,f]=u.useState(!0),p=u.useCallback(C=>{o(C.target.value)},[]),g=u.useCallback(C=>{l(C.target.value)},[]),m=u.useCallback(C=>{f(C.target.checked)},[]),y=u.useCallback(()=>{const C=JSON.parse(i),x=AQ(C,h);l(x),d(JSON.stringify(x,null,2))},[i,h]),b=u.useCallback(async()=>{await s({type:"object",data:a}),n()},[s,a,n]);return r.jsxs(Dr,{isOpen:t,onClose:n,isCentered:!0,useInert:!1,children:[r.jsx(ar,{}),r.jsxs(Rr,{w:"80vw",h:"80vh",maxW:"unset",maxH:"unset",children:[r.jsx(lr,{children:e("workflows.loadFromGraph")}),r.jsx(Pi,{}),r.jsxs(Ws,{as:T,flexDir:"column",gap:4,w:"full",h:"full",pb:4,children:[r.jsxs(T,{gap:4,children:[r.jsx(de,{onClick:y,size:"sm",flexShrink:0,children:e("workflows.convertGraph")}),r.jsxs(K,{children:[r.jsx(J,{children:e("workflows.autoLayout")}),r.jsx(Sn,{isChecked:h,onChange:m})]}),r.jsx(it,{}),r.jsx(de,{onClick:b,size:"sm",flexShrink:0,children:e("workflows.loadWorkflow")})]}),r.jsxs(K,{orientation:"vertical",h:"50%",children:[r.jsx(J,{children:e("nodes.graph")}),r.jsx(ss,{h:"full",value:i,fontFamily:"monospace",whiteSpace:"pre-wrap",overflowWrap:"normal",onChange:p})]}),r.jsxs(K,{orientation:"vertical",h:"50%",children:[r.jsx(J,{children:e("nodes.workflow")}),r.jsx(ss,{h:"full",value:c,fontFamily:"monospace",whiteSpace:"pre-wrap",overflowWrap:"normal",onChange:g})]})]})]})]})},JO=()=>{const e=dn();return u.useCallback(()=>{const{nodes:n,form:s}=Qe(e.getState());return EQ(s,n)},[e])},J0e=e=>!e.id&&e.meta.category!=="default",e1e=()=>{const{t:e}=A(),t=G(),[n,{isLoading:s,isError:i}]=MQ(),[o]=PQ(),a=JO(),l=my(),c=u.useRef();return{createNewWorkflow:u.useCallback(async({workflow:h,onSuccess:f,onError:p})=>{c.current=l({title:e("workflows.savingWorkflow"),status:"loading",duration:null,isClosable:!1});try{const g=await n(h).unwrap(),{id:m,name:y,meta:{category:b}}=g.workflow;t(LQ(m)),t(ZM(y)),t(DQ(b)),t(RQ({category:b})),t(YM({formFieldInitialValues:a()})),o({workflow_id:m}),f&&f(),l.update(c.current,{title:e("workflows.workflowSaved"),status:"success",duration:1e3,isClosable:!0})}catch{p&&p(),l.isActive(`auth-error-toast-${va.endpoints.createWorkflow.name}`)?l.close(c.current):l.update(c.current,{title:e("workflows.problemSavingWorkflow"),status:"error",duration:1e3,isClosable:!0})}},[l,e,n,t,a,o]),isLoading:s,isError:i}},sp=Oe(null),t1e=Wn(sp,e=>e!==null),n1e=e=>e.id?e.name.length?`${e.name.trim()} (copy)`:"":e.name,eN=e=>{sp.set(gt(e))},s1e=()=>{const e=ae(t1e),t=ae(sp),n=u.useRef(null),s=u.useCallback(()=>{sp.set(null)},[]);return r.jsxs(FM,{isOpen:e,onClose:s,leastDestructiveRef:n,isCentered:!0,children:[!t&&r.jsx(nN,{}),t&&r.jsx(tN,{workflow:t,cancelRef:n})]})},tN=u.memo(({workflow:e,cancelRef:t})=>{const n=ae(CS),[s,i]=u.useState(()=>e?n1e(e):""),[o,a]=u.useState(()=>n.includes("project")),{createNewWorkflow:l}=e1e(),c=u.useRef(null),d=u.useCallback(g=>{i(g.target.value)},[]),h=u.useCallback(g=>{a(g.target.checked)},[a]),f=u.useCallback(()=>{sp.set(null)},[]),p=u.useCallback(async()=>{e.id=void 0,e.name=s,e.meta.category=o?"project":"user",e.is_published=!1,we(J0e(e)),await l({workflow:e,onSuccess:f,onError:f})},[e,s,o,l,f]);return r.jsxs(pS,{children:[r.jsx(lr,{fontSize:"lg",fontWeight:"bold",children:Pe("workflows.saveWorkflowAs")}),r.jsx(Ws,{children:r.jsxs(K,{alignItems:"flex-start",children:[r.jsx(J,{mt:"2",children:Pe("workflows.workflowName")}),r.jsxs(T,{flexDir:"column",width:"full",gap:"2",children:[r.jsx(kt,{ref:c,value:s,onChange:d,placeholder:Pe("workflows.workflowName")}),n.includes("project")&&r.jsx(Sn,{isChecked:o,onChange:h,children:r.jsx(J,{children:Pe("workflows.saveWorkflowToProject")})})]})]})}),r.jsxs(xo,{children:[r.jsx(de,{ref:t,onClick:f,children:Pe("common.cancel")}),r.jsx(de,{colorScheme:"invokeBlue",onClick:p,ml:3,isDisabled:!s||!s.length,children:Pe("common.saveAs")})]})]})});tN.displayName="Content";const nN=u.memo(()=>r.jsx(pS,{children:r.jsx(Pt,{icon:null,label:"No workflow to save"})}));nN.displayName="NoWorkflowToSaveContent";const sN=u.memo(()=>r.jsxs(r.Fragment,{children:[r.jsx(kge,{}),r.jsx(_pe,{}),r.jsx(H9,{}),r.jsx(G0e,{}),r.jsx(VO,{}),r.jsx(zO,{}),r.jsx(GO,{}),r.jsx(hO,{}),r.jsx(OQ,{}),r.jsx(HO,{}),r.jsx(C0e,{}),r.jsx(cme,{}),r.jsx(W0e,{}),r.jsx(Zge,{}),r.jsx(m9,{}),r.jsx(N9,{}),r.jsx(F9,{}),r.jsx(lO,{}),r.jsx(V9,{}),r.jsx(XO,{}),r.jsx(s1e,{}),r.jsx(Ki,{children:r.jsx(P9,{})}),r.jsx(Q0e,{})]}));sN.displayName="GlobalModalIsolator";const rN=()=>u.useCallback(()=>{NQ(),localStorage.clear()},[]),r1e={position:"relative",'&[data-highlighted="true"]::after':{borderColor:"blue.700"},"&::after":{content:'""',position:"absolute",inset:0,zIndex:1,borderRadius:"base",border:"2px solid",borderColor:"transparent",pointerEvents:"none",transition:"border-color 0.1s ease-in-out"}},_d=u.memo(({region:e,focusOnMount:t=!1,sx:n,children:s,...i})=>{const o=I(XM),a=u.useRef(null),l=u.useMemo(()=>({focusOnMount:t}),[t]);sg(e,a,l);const d=Ms(e)&&o;return r.jsx(Se,{ref:a,tabIndex:-1,sx:u.useMemo(()=>({...r1e,...n}),[n]),"data-highlighted":d,...i,children:s})});_d.displayName="FocusRegionWrapper";const iN=u.memo(()=>{const{t:e}=A();return I(QM)?r.jsxs(ac,{status:"warning",borderRadius:"base",fontSize:"sm",shadow:"md",w:"fit-content",children:[r.jsx(lc,{}),r.jsx($p,{children:e("controlLayers.settings.preserveMask.alert")})]}):null});iN.displayName="CanvasAlertsPreserveMask";const ra=u.memo(e=>{const t=u.useMemo(()=>FQ(e.entityIdentifier),[e.entityIdentifier]);return I(t)?e.children:null});ra.displayName="CanvasEntityStateGate";const Cc=u.createContext(null),Ye=e=>{const t=u.useContext(Cc);return we(t,"useEntityIdentifier must be used within a EntityIdentifierProvider"),e&&we(t.type===e,"useEntityIdentifier must be used with the correct type"),t},bg=u.createContext(null),oN=u.memo(({children:e})=>{const t=Lt(),n=Ye(),s=u.useSyncExternalStore(t.adapters.rasterLayers.subscribe,t.adapters.rasterLayers.getSnapshot),i=u.useMemo(()=>s.get(n.id)??null,[s,n.id]);return i?r.jsx(bg.Provider,{value:i,children:e}):null});oN.displayName="RasterLayerAdapterGate";const aN=u.memo(({children:e})=>{const t=Lt(),n=Ye(),s=u.useSyncExternalStore(t.adapters.controlLayers.subscribe,t.adapters.controlLayers.getSnapshot),i=u.useMemo(()=>s.get(n.id)??null,[s,n.id]);return i?r.jsx(bg.Provider,{value:i,children:e}):null});aN.displayName="ControlLayerAdapterGate";const lN=u.memo(({children:e})=>{const t=Lt(),n=Ye(),s=u.useSyncExternalStore(t.adapters.inpaintMasks.subscribe,t.adapters.inpaintMasks.getSnapshot),i=u.useMemo(()=>s.get(n.id)??null,[s,n.id]);return i?r.jsx(bg.Provider,{value:i,children:e}):null});lN.displayName="InpaintMaskAdapterGate";const cN=u.memo(({children:e})=>{const t=Lt(),n=Ye(),s=u.useSyncExternalStore(t.adapters.regionMasks.subscribe,t.adapters.regionMasks.getSnapshot),i=u.useMemo(()=>s.get(n.id)??null,[s,n.id]);return i?r.jsx(bg.Provider,{value:i,children:e}):null}),i1e=e=>{const t=u.useContext(bg);return we(t,"useEntityIdentifier must be used within a EntityIdentifierProvider"),we(t.entityIdentifier.type===e,"useEntityIdentifier must be used with the correct type"),t};cN.displayName="RegionalGuidanceAdapterGate";const ko=e=>{const t=Lt(),n=u.useSyncExternalStore(t.adapters.regionMasks.subscribe,t.adapters.regionMasks.getSnapshot),s=u.useSyncExternalStore(t.adapters.rasterLayers.subscribe,t.adapters.rasterLayers.getSnapshot),i=u.useSyncExternalStore(t.adapters.controlLayers.subscribe,t.adapters.controlLayers.getSnapshot),o=u.useSyncExternalStore(t.adapters.inpaintMasks.subscribe,t.adapters.inpaintMasks.getSnapshot);return u.useMemo(()=>e?e.type==="raster_layer"?s.get(e.id)??null:e.type==="control_layer"?i.get(e.id)??null:e.type==="inpaint_mask"?o.get(e.id)??null:e.type==="regional_guidance"?n.get(e.id)??null:null:null,[i,e,o,s,n])},o1e=e=>{const t=ko(e);return we(t,"useEntityAdapter must be used within a EntityAdapterContext"),t},a1e=e=>fe(tt,t=>{const n=Qa(t,e);return n?n.name:null}),uN=e=>{const t=u.useMemo(()=>a1e(e),[e]);return I(t)},dN=e=>{const{t}=A();return u.useMemo(()=>{switch(e){case"inpaint_mask":return t("controlLayers.inpaintMask");case"control_layer":return t("controlLayers.controlLayer");case"raster_layer":return t("controlLayers.rasterLayer");case"reference_image":return t("controlLayers.globalReferenceImage");case"regional_guidance":return t("controlLayers.regionalGuidance");default:we(!1,"Unexpected entity type")}},[e,t])},hN=e=>{const t=uN(e),n=dN(e.type);return u.useMemo(()=>t||n,[t,n])},jk=e=>{const t=u.useMemo(()=>fe(tt,s=>{switch(e){case"control_layer":return s.controlLayers.isHidden;case"raster_layer":return s.rasterLayers.isHidden;case"inpaint_mask":return s.inpaintMasks.isHidden;case"regional_guidance":return s.regionalGuidance.isHidden;case"reference_image":default:return!1}}),[e]);return I(t)},l1e=Oe(!1),c1e=e=>fe(tt,t=>Or(t,e,"CanvasAlertsSelectedEntityStatusContent").isEnabled),u1e=e=>fe(tt,t=>Or(t,e,"CanvasAlertsSelectedEntityStatusContent").isLocked),fN=u.memo(({entityIdentifier:e,adapter:t})=>{var g;const{t:n}=A(),s=hN(e),i=u.useMemo(()=>c1e(e),[e]),o=u.useMemo(()=>u1e(e),[e]),a=I(i),l=I(o),c=jk(e.type),d=ae(((g=t.filterer)==null?void 0:g.$isFiltering)??l1e),h=ae(t.transformer.$isTransforming),f=ae(t.$isEmpty),p=u.useMemo(()=>d?{status:"info",title:n("controlLayers.HUD.entityStatus.isFiltering",{title:s})}:h?{status:"info",title:n("controlLayers.HUD.entityStatus.isTransforming",{title:s})}:f?{status:"info",title:n("controlLayers.HUD.entityStatus.isEmpty",{title:s})}:c?{status:"warning",title:n("controlLayers.HUD.entityStatus.isHidden",{title:s})}:l?{status:"warning",title:n("controlLayers.HUD.entityStatus.isLocked",{title:s})}:a?null:{status:"warning",title:n("controlLayers.HUD.entityStatus.isDisabled",{title:s})},[d,h,f,c,l,a,s,n]);return p?r.jsxs(ac,{status:p.status,borderRadius:"base",fontSize:"sm",shadow:"md",w:"fit-content",children:[r.jsx(lc,{}),r.jsx($p,{children:p.title})]}):null});fN.displayName="CanvasAlertsSelectedEntityStatusContent";const pN=u.memo(()=>{const e=I(Tn),t=ko(e);return!e||!t?null:r.jsx(ra,{entityIdentifier:e,children:r.jsx(fN,{entityIdentifier:e,adapter:t})})});pN.displayName="CanvasAlertsSelectedEntityStatus";const kk=()=>{const{destination:e}=BQ(void 0,{selectFromResult:({data:t})=>({destination:t?t.destination:null})});return e};function d1e(e){if(typeof Proxy>"u")return e;const t=new Map,n=(...s)=>e(...s);return new Proxy(n,{get:(s,i)=>i==="create"?e:(t.has(i)||t.set(i,e(i)),t.get(i))})}function rp(e){return e!==null&&typeof e=="object"&&typeof e.start=="function"}const FC=e=>Array.isArray(e);function gN(e,t){if(!Array.isArray(t))return!1;const n=t.length;if(n!==e.length)return!1;for(let s=0;s<n;s++)if(t[s]!==e[s])return!1;return!0}function ip(e){return typeof e=="string"||Array.isArray(e)}function VT(e){const t=[{},{}];return e==null||e.values.forEach((n,s)=>{t[0][s]=n.get(),t[1][s]=n.getVelocity()}),t}function _k(e,t,n,s){if(typeof t=="function"){const[i,o]=VT(s);t=t(n!==void 0?n:e.custom,i,o)}if(typeof t=="string"&&(t=e.variants&&e.variants[t]),typeof t=="function"){const[i,o]=VT(s);t=t(n!==void 0?n:e.custom,i,o)}return t}function _b(e,t,n){const s=e.getProps();return _k(s,t,n!==void 0?n:s.custom,e)}const Ik=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],Tk=["initial",...Ik],xg=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],ol=new Set(xg),Wo=e=>e*1e3,Uo=e=>e/1e3,h1e={type:"spring",stiffness:500,damping:25,restSpeed:10},f1e=e=>({type:"spring",stiffness:550,damping:e===0?2*Math.sqrt(550):30,restSpeed:10}),p1e={type:"keyframes",duration:.8},g1e={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},m1e=(e,{keyframes:t})=>t.length>2?p1e:ol.has(e)?e.startsWith("scale")?f1e(t[1]):h1e:g1e;function Ak(e,t){return e[t]||e.default||e}const y1e={useManualTiming:!1},b1e=e=>e!==null;function Ib(e,{repeat:t,repeatType:n="loop"},s){const i=e.filter(b1e),o=t&&n!=="loop"&&t%2===1?0:i.length-1;return!o||s===void 0?i[o]:s}const Ps=e=>e;function x1e(e){let t=new Set,n=new Set,s=!1,i=!1;const o=new WeakSet;let a={delta:0,timestamp:0,isProcessing:!1};function l(d){o.has(d)&&(c.schedule(d),e()),d(a)}const c={schedule:(d,h=!1,f=!1)=>{const g=f&&s?t:n;return h&&o.add(d),g.has(d)||g.add(d),d},cancel:d=>{n.delete(d),o.delete(d)},process:d=>{if(a=d,s){i=!0;return}s=!0,[t,n]=[n,t],n.clear(),t.forEach(l),s=!1,i&&(i=!1,c.process(d))}};return c}const vm=["read","resolveKeyframes","update","preRender","render","postRender"],v1e=40;function mN(e,t){let n=!1,s=!0;const i={delta:0,timestamp:0,isProcessing:!1},o=()=>n=!0,a=vm.reduce((C,x)=>(C[x]=x1e(o),C),{}),{read:l,resolveKeyframes:c,update:d,preRender:h,render:f,postRender:p}=a,g=()=>{const C=performance.now();n=!1,i.delta=s?1e3/60:Math.max(Math.min(C-i.timestamp,v1e),1),i.timestamp=C,i.isProcessing=!0,l.process(i),c.process(i),d.process(i),h.process(i),f.process(i),p.process(i),i.isProcessing=!1,n&&t&&(s=!1,e(g))},m=()=>{n=!0,s=!0,i.isProcessing||e(g)};return{schedule:vm.reduce((C,x)=>{const v=a[x];return C[x]=(w,S=!1,j=!1)=>(n||m(),v.schedule(w,S,j)),C},{}),cancel:C=>{for(let x=0;x<vm.length;x++)a[vm[x]].cancel(C)},state:i,steps:a}}const{schedule:qt,cancel:Ua,state:us,steps:vv}=mN(typeof requestAnimationFrame<"u"?requestAnimationFrame:Ps,!0),yN=(e,t,n)=>(((1-3*n+3*t)*e+(3*n-6*t))*e+3*t)*e,C1e=1e-7,w1e=12;function S1e(e,t,n,s,i){let o,a,l=0;do a=t+(n-t)/2,o=yN(a,s,i)-e,o>0?n=a:t=a;while(Math.abs(o)>C1e&&++l<w1e);return a}function vg(e,t,n,s){if(e===t&&n===s)return Ps;const i=o=>S1e(o,0,1,e,n);return o=>o===0||o===1?o:yN(i(o),t,s)}const bN=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,xN=e=>t=>1-e(1-t),vN=vg(.33,1.53,.69,.99),Ek=xN(vN),CN=bN(Ek),wN=e=>(e*=2)<1?.5*Ek(e):.5*(2-Math.pow(2,-10*(e-1))),Mk=e=>1-Math.sin(Math.acos(e)),SN=xN(Mk),jN=bN(Mk),kN=e=>/^0[^.\s]+$/u.test(e);function j1e(e){return typeof e=="number"?e===0:e!==null?e==="none"||e==="0"||kN(e):!0}let _N=Ps;const IN=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e),TN=e=>t=>typeof t=="string"&&t.startsWith(e),AN=TN("--"),k1e=TN("var(--"),Pk=e=>k1e(e)?_1e.test(e.split("/*")[0].trim()):!1,_1e=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,I1e=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function T1e(e){const t=I1e.exec(e);if(!t)return[,];const[,n,s,i]=t;return[`--${n??s}`,i]}function EN(e,t,n=1){const[s,i]=T1e(e);if(!s)return;const o=window.getComputedStyle(t).getPropertyValue(s);if(o){const a=o.trim();return IN(a)?parseFloat(a):a}return Pk(i)?EN(i,t,n+1):i}const qa=(e,t,n)=>n>t?t:n<e?e:n,Id={test:e=>typeof e=="number",parse:parseFloat,transform:e=>e},op={...Id,transform:e=>qa(0,1,e)},Cm={...Id,default:1},Cg=e=>({test:t=>typeof t=="string"&&t.endsWith(e)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${e}`}),ha=Cg("deg"),io=Cg("%"),st=Cg("px"),A1e=Cg("vh"),E1e=Cg("vw"),zT={...io,parse:e=>io.parse(e)/100,transform:e=>io.transform(e*100)},M1e=new Set(["width","height","top","left","right","bottom","x","y","translateX","translateY"]),GT=e=>e===Id||e===st,HT=(e,t)=>parseFloat(e.split(", ")[t]),WT=(e,t)=>(n,{transform:s})=>{if(s==="none"||!s)return 0;const i=s.match(/^matrix3d\((.+)\)$/u);if(i)return HT(i[1],t);{const o=s.match(/^matrix\((.+)\)$/u);return o?HT(o[1],e):0}},P1e=new Set(["x","y","z"]),L1e=xg.filter(e=>!P1e.has(e));function D1e(e){const t=[];return L1e.forEach(n=>{const s=e.getValue(n);s!==void 0&&(t.push([n,s.get()]),s.set(n.startsWith("scale")?1:0))}),t}const Hu={width:({x:e},{paddingLeft:t="0",paddingRight:n="0"})=>e.max-e.min-parseFloat(t)-parseFloat(n),height:({y:e},{paddingTop:t="0",paddingBottom:n="0"})=>e.max-e.min-parseFloat(t)-parseFloat(n),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:WT(4,13),y:WT(5,14)};Hu.translateX=Hu.x;Hu.translateY=Hu.y;const MN=e=>t=>t.test(e),R1e={test:e=>e==="auto",parse:e=>e},PN=[Id,st,io,ha,E1e,A1e,R1e],UT=e=>PN.find(MN(e)),zl=new Set;let BC=!1,$C=!1;function LN(){if($C){const e=Array.from(zl).filter(s=>s.needsMeasurement),t=new Set(e.map(s=>s.element)),n=new Map;t.forEach(s=>{const i=D1e(s);i.length&&(n.set(s,i),s.render())}),e.forEach(s=>s.measureInitialState()),t.forEach(s=>{s.render();const i=n.get(s);i&&i.forEach(([o,a])=>{var l;(l=s.getValue(o))===null||l===void 0||l.set(a)})}),e.forEach(s=>s.measureEndState()),e.forEach(s=>{s.suspendedScrollY!==void 0&&window.scrollTo(0,s.suspendedScrollY)})}$C=!1,BC=!1,zl.forEach(e=>e.complete()),zl.clear()}function DN(){zl.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&($C=!0)})}function O1e(){DN(),LN()}class Lk{constructor(t,n,s,i,o,a=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...t],this.onComplete=n,this.name=s,this.motionValue=i,this.element=o,this.isAsync=a}scheduleResolve(){this.isScheduled=!0,this.isAsync?(zl.add(this),BC||(BC=!0,qt.read(DN),qt.resolveKeyframes(LN))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:t,name:n,element:s,motionValue:i}=this;for(let o=0;o<t.length;o++)if(t[o]===null)if(o===0){const a=i==null?void 0:i.get(),l=t[t.length-1];if(a!==void 0)t[0]=a;else if(s&&n){const c=s.readValue(n,l);c!=null&&(t[0]=c)}t[0]===void 0&&(t[0]=l),i&&a===void 0&&i.set(t[0])}else t[o]=t[o-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),zl.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,zl.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const If=e=>Math.round(e*1e5)/1e5,Dk=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function N1e(e){return e==null}const F1e=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,Rk=(e,t)=>n=>!!(typeof n=="string"&&F1e.test(n)&&n.startsWith(e)||t&&!N1e(n)&&Object.prototype.hasOwnProperty.call(n,t)),RN=(e,t,n)=>s=>{if(typeof s!="string")return s;const[i,o,a,l]=s.match(Dk);return{[e]:parseFloat(i),[t]:parseFloat(o),[n]:parseFloat(a),alpha:l!==void 0?parseFloat(l):1}},B1e=e=>qa(0,255,e),Cv={...Id,transform:e=>Math.round(B1e(e))},Pl={test:Rk("rgb","red"),parse:RN("red","green","blue"),transform:({red:e,green:t,blue:n,alpha:s=1})=>"rgba("+Cv.transform(e)+", "+Cv.transform(t)+", "+Cv.transform(n)+", "+If(op.transform(s))+")"};function $1e(e){let t="",n="",s="",i="";return e.length>5?(t=e.substring(1,3),n=e.substring(3,5),s=e.substring(5,7),i=e.substring(7,9)):(t=e.substring(1,2),n=e.substring(2,3),s=e.substring(3,4),i=e.substring(4,5),t+=t,n+=n,s+=s,i+=i),{red:parseInt(t,16),green:parseInt(n,16),blue:parseInt(s,16),alpha:i?parseInt(i,16)/255:1}}const VC={test:Rk("#"),parse:$1e,transform:Pl.transform},uu={test:Rk("hsl","hue"),parse:RN("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:n,alpha:s=1})=>"hsla("+Math.round(e)+", "+io.transform(If(t))+", "+io.transform(If(n))+", "+If(op.transform(s))+")"},ws={test:e=>Pl.test(e)||VC.test(e)||uu.test(e),parse:e=>Pl.test(e)?Pl.parse(e):uu.test(e)?uu.parse(e):VC.parse(e),transform:e=>typeof e=="string"?e:e.hasOwnProperty("red")?Pl.transform(e):uu.transform(e)},V1e=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function z1e(e){var t,n;return isNaN(e)&&typeof e=="string"&&(((t=e.match(Dk))===null||t===void 0?void 0:t.length)||0)+(((n=e.match(V1e))===null||n===void 0?void 0:n.length)||0)>0}const ON="number",NN="color",G1e="var",H1e="var(",qT="${}",W1e=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function ap(e){const t=e.toString(),n=[],s={color:[],number:[],var:[]},i=[];let o=0;const l=t.replace(W1e,c=>(ws.test(c)?(s.color.push(o),i.push(NN),n.push(ws.parse(c))):c.startsWith(H1e)?(s.var.push(o),i.push(G1e),n.push(c)):(s.number.push(o),i.push(ON),n.push(parseFloat(c))),++o,qT)).split(qT);return{values:n,split:l,indexes:s,types:i}}function FN(e){return ap(e).values}function BN(e){const{split:t,types:n}=ap(e),s=t.length;return i=>{let o="";for(let a=0;a<s;a++)if(o+=t[a],i[a]!==void 0){const l=n[a];l===ON?o+=If(i[a]):l===NN?o+=ws.transform(i[a]):o+=i[a]}return o}}const U1e=e=>typeof e=="number"?0:e;function q1e(e){const t=FN(e);return BN(e)(t.map(U1e))}const Ka={test:z1e,parse:FN,createTransformer:BN,getAnimatableNone:q1e},K1e=new Set(["brightness","contrast","saturate","opacity"]);function Z1e(e){const[t,n]=e.slice(0,-1).split("(");if(t==="drop-shadow")return e;const[s]=n.match(Dk)||[];if(!s)return e;const i=n.replace(s,"");let o=K1e.has(t)?1:0;return s!==n&&(o*=100),t+"("+o+i+")"}const Y1e=/\b([a-z-]*)\(.*?\)/gu,zC={...Ka,getAnimatableNone:e=>{const t=e.match(Y1e);return t?t.map(Z1e).join(" "):e}},X1e={borderWidth:st,borderTopWidth:st,borderRightWidth:st,borderBottomWidth:st,borderLeftWidth:st,borderRadius:st,radius:st,borderTopLeftRadius:st,borderTopRightRadius:st,borderBottomRightRadius:st,borderBottomLeftRadius:st,width:st,maxWidth:st,height:st,maxHeight:st,top:st,right:st,bottom:st,left:st,padding:st,paddingTop:st,paddingRight:st,paddingBottom:st,paddingLeft:st,margin:st,marginTop:st,marginRight:st,marginBottom:st,marginLeft:st,backgroundPositionX:st,backgroundPositionY:st},Q1e={rotate:ha,rotateX:ha,rotateY:ha,rotateZ:ha,scale:Cm,scaleX:Cm,scaleY:Cm,scaleZ:Cm,skew:ha,skewX:ha,skewY:ha,distance:st,translateX:st,translateY:st,translateZ:st,x:st,y:st,z:st,perspective:st,transformPerspective:st,opacity:op,originX:zT,originY:zT,originZ:st},KT={...Id,transform:Math.round},Ok={...X1e,...Q1e,zIndex:KT,size:st,fillOpacity:op,strokeOpacity:op,numOctaves:KT},J1e={...Ok,color:ws,backgroundColor:ws,outlineColor:ws,fill:ws,stroke:ws,borderColor:ws,borderTopColor:ws,borderRightColor:ws,borderBottomColor:ws,borderLeftColor:ws,filter:zC,WebkitFilter:zC},Nk=e=>J1e[e];function $N(e,t){let n=Nk(e);return n!==zC&&(n=Ka),n.getAnimatableNone?n.getAnimatableNone(t):void 0}const eye=new Set(["auto","none","0"]);function tye(e,t,n){let s=0,i;for(;s<e.length&&!i;){const o=e[s];typeof o=="string"&&!eye.has(o)&&ap(o).values.length&&(i=e[s]),s++}if(i&&n)for(const o of t)e[o]=$N(n,i)}class VN extends Lk{constructor(t,n,s,i,o){super(t,n,s,i,o,!0)}readKeyframes(){const{unresolvedKeyframes:t,element:n,name:s}=this;if(!n||!n.current)return;super.readKeyframes();for(let c=0;c<t.length;c++){let d=t[c];if(typeof d=="string"&&(d=d.trim(),Pk(d))){const h=EN(d,n.current);h!==void 0&&(t[c]=h),c===t.length-1&&(this.finalKeyframe=d)}}if(this.resolveNoneKeyframes(),!M1e.has(s)||t.length!==2)return;const[i,o]=t,a=UT(i),l=UT(o);if(a!==l)if(GT(a)&&GT(l))for(let c=0;c<t.length;c++){const d=t[c];typeof d=="string"&&(t[c]=parseFloat(d))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:t,name:n}=this,s=[];for(let i=0;i<t.length;i++)j1e(t[i])&&s.push(i);s.length&&tye(t,s,n)}measureInitialState(){const{element:t,unresolvedKeyframes:n,name:s}=this;if(!t||!t.current)return;s==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Hu[s](t.measureViewportBox(),window.getComputedStyle(t.current)),n[0]=this.measuredOrigin;const i=n[n.length-1];i!==void 0&&t.getValue(s,i).jump(i,!1)}measureEndState(){var t;const{element:n,name:s,unresolvedKeyframes:i}=this;if(!n||!n.current)return;const o=n.getValue(s);o&&o.jump(this.measuredOrigin,!1);const a=i.length-1,l=i[a];i[a]=Hu[s](n.measureViewportBox(),window.getComputedStyle(n.current)),l!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=l),!((t=this.removedTransforms)===null||t===void 0)&&t.length&&this.removedTransforms.forEach(([c,d])=>{n.getValue(c).set(d)}),this.resolveNoneKeyframes()}}function Fk(e){return typeof e=="function"}let x0;function nye(){x0=void 0}const oo={now:()=>(x0===void 0&&oo.set(us.isProcessing||y1e.useManualTiming?us.timestamp:performance.now()),x0),set:e=>{x0=e,queueMicrotask(nye)}},ZT=(e,t)=>t==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&(Ka.test(e)||e==="0")&&!e.startsWith("url("));function sye(e){const t=e[0];if(e.length===1)return!0;for(let n=0;n<e.length;n++)if(e[n]!==t)return!0}function rye(e,t,n,s){const i=e[0];if(i===null)return!1;if(t==="display"||t==="visibility")return!0;const o=e[e.length-1],a=ZT(i,t),l=ZT(o,t);return!a||!l?!1:sye(e)||(n==="spring"||Fk(n))&&s}const iye=40;class zN{constructor({autoplay:t=!0,delay:n=0,type:s="keyframes",repeat:i=0,repeatDelay:o=0,repeatType:a="loop",...l}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=oo.now(),this.options={autoplay:t,delay:n,type:s,repeat:i,repeatDelay:o,repeatType:a,...l},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>iye?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&O1e(),this._resolved}onKeyframesResolved(t,n){this.resolvedAt=oo.now(),this.hasAttemptedResolve=!0;const{name:s,type:i,velocity:o,delay:a,onComplete:l,onUpdate:c,isGenerator:d}=this.options;if(!d&&!rye(t,s,i,o))if(a)this.options.duration=0;else{c==null||c(Ib(t,this.options,n)),l==null||l(),this.resolveFinishedPromise();return}const h=this.initPlayback(t,n);h!==!1&&(this._resolved={keyframes:t,finalKeyframe:n,...h},this.onPostResolved())}onPostResolved(){}then(t,n){return this.currentFinishedPromise.then(t,n)}updateFinishedPromise(){this.currentFinishedPromise=new Promise(t=>{this.resolveFinishedPromise=t})}}function GN(e,t){return t?e*(1e3/t):0}const oye=5;function HN(e,t,n){const s=Math.max(t-oye,0);return GN(n-e(s),t-s)}const YT=.001,aye=.01,lye=10,cye=.05,uye=1;function dye({duration:e=800,bounce:t=.25,velocity:n=0,mass:s=1}){let i,o,a=1-t;a=qa(cye,uye,a),e=qa(aye,lye,Uo(e)),a<1?(i=d=>{const h=d*a,f=h*e,p=h-n,g=GC(d,a),m=Math.exp(-f);return YT-p/g*m},o=d=>{const f=d*a*e,p=f*n+n,g=Math.pow(a,2)*Math.pow(d,2)*e,m=Math.exp(-f),y=GC(Math.pow(d,2),a);return(-i(d)+YT>0?-1:1)*((p-g)*m)/y}):(i=d=>{const h=Math.exp(-d*e),f=(d-n)*e+1;return-.001+h*f},o=d=>{const h=Math.exp(-d*e),f=(n-d)*(e*e);return h*f});const l=5/e,c=fye(i,o,l);if(e=Wo(e),isNaN(c))return{stiffness:100,damping:10,duration:e};{const d=Math.pow(c,2)*s;return{stiffness:d,damping:a*2*Math.sqrt(s*d),duration:e}}}const hye=12;function fye(e,t,n){let s=n;for(let i=1;i<hye;i++)s=s-e(s)/t(s);return s}function GC(e,t){return e*Math.sqrt(1-t*t)}const pye=["duration","bounce"],gye=["stiffness","damping","mass"];function XT(e,t){return t.some(n=>e[n]!==void 0)}function mye(e){let t={velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1,...e};if(!XT(e,gye)&&XT(e,pye)){const n=dye(e);t={...t,...n,mass:1},t.isResolvedFromDuration=!0}return t}function WN({keyframes:e,restDelta:t,restSpeed:n,...s}){const i=e[0],o=e[e.length-1],a={done:!1,value:i},{stiffness:l,damping:c,mass:d,duration:h,velocity:f,isResolvedFromDuration:p}=mye({...s,velocity:-Uo(s.velocity||0)}),g=f||0,m=c/(2*Math.sqrt(l*d)),y=o-i,b=Uo(Math.sqrt(l/d)),C=Math.abs(y)<5;n||(n=C?.01:2),t||(t=C?.005:.5);let x;if(m<1){const v=GC(b,m);x=w=>{const S=Math.exp(-m*b*w);return o-S*((g+m*b*y)/v*Math.sin(v*w)+y*Math.cos(v*w))}}else if(m===1)x=v=>o-Math.exp(-b*v)*(y+(g+b*y)*v);else{const v=b*Math.sqrt(m*m-1);x=w=>{const S=Math.exp(-m*b*w),j=Math.min(v*w,300);return o-S*((g+m*b*y)*Math.sinh(j)+v*y*Math.cosh(j))/v}}return{calculatedDuration:p&&h||null,next:v=>{const w=x(v);if(p)a.done=v>=h;else{let S=0;m<1&&(S=v===0?Wo(g):HN(x,v,w));const j=Math.abs(S)<=n,P=Math.abs(o-w)<=t;a.done=j&&P}return a.value=a.done?o:w,a}}}function QT({keyframes:e,velocity:t=0,power:n=.8,timeConstant:s=325,bounceDamping:i=10,bounceStiffness:o=500,modifyTarget:a,min:l,max:c,restDelta:d=.5,restSpeed:h}){const f=e[0],p={done:!1,value:f},g=E=>l!==void 0&&E<l||c!==void 0&&E>c,m=E=>l===void 0?c:c===void 0||Math.abs(l-E)<Math.abs(c-E)?l:c;let y=n*t;const b=f+y,C=a===void 0?b:a(b);C!==b&&(y=C-f);const x=E=>-y*Math.exp(-E/s),v=E=>C+x(E),w=E=>{const D=x(E),M=v(E);p.done=Math.abs(D)<=d,p.value=p.done?C:M};let S,j;const P=E=>{g(p.value)&&(S=E,j=WN({keyframes:[p.value,m(p.value)],velocity:HN(v,E,p.value),damping:i,stiffness:o,restDelta:d,restSpeed:h}))};return P(0),{calculatedDuration:null,next:E=>{let D=!1;return!j&&S===void 0&&(D=!0,w(E),P(E)),S!==void 0&&E>=S?j.next(E-S):(!D&&w(E),p)}}}const yye=vg(.42,0,1,1),bye=vg(0,0,.58,1),UN=vg(.42,0,.58,1),xye=e=>Array.isArray(e)&&typeof e[0]!="number",vye={linear:Ps,easeIn:yye,easeInOut:UN,easeOut:bye,circIn:Mk,circInOut:jN,circOut:SN,backIn:Ek,backInOut:CN,backOut:vN,anticipate:wN},JT=e=>{if(Array.isArray(e)){_N(e.length===4);const[t,n,s,i]=e;return vg(t,n,s,i)}else if(typeof e=="string")return vye[e];return e},Cye=(e,t)=>n=>t(e(n)),qo=(...e)=>e.reduce(Cye),Wu=(e,t,n)=>{const s=t-e;return s===0?1:(n-e)/s},wn=(e,t,n)=>e+(t-e)*n;function wv(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<1/2?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function wye({hue:e,saturation:t,lightness:n,alpha:s}){e/=360,t/=100,n/=100;let i=0,o=0,a=0;if(!t)i=o=a=n;else{const l=n<.5?n*(1+t):n+t-n*t,c=2*n-l;i=wv(c,l,e+1/3),o=wv(c,l,e),a=wv(c,l,e-1/3)}return{red:Math.round(i*255),green:Math.round(o*255),blue:Math.round(a*255),alpha:s}}function d1(e,t){return n=>n>0?t:e}const Sv=(e,t,n)=>{const s=e*e,i=n*(t*t-s)+s;return i<0?0:Math.sqrt(i)},Sye=[VC,Pl,uu],jye=e=>Sye.find(t=>t.test(e));function eA(e){const t=jye(e);if(!t)return!1;let n=t.parse(e);return t===uu&&(n=wye(n)),n}const tA=(e,t)=>{const n=eA(e),s=eA(t);if(!n||!s)return d1(e,t);const i={...n};return o=>(i.red=Sv(n.red,s.red,o),i.green=Sv(n.green,s.green,o),i.blue=Sv(n.blue,s.blue,o),i.alpha=wn(n.alpha,s.alpha,o),Pl.transform(i))},HC=new Set(["none","hidden"]);function kye(e,t){return HC.has(e)?n=>n<=0?e:t:n=>n>=1?t:e}function _ye(e,t){return n=>wn(e,t,n)}function Bk(e){return typeof e=="number"?_ye:typeof e=="string"?Pk(e)?d1:ws.test(e)?tA:Aye:Array.isArray(e)?qN:typeof e=="object"?ws.test(e)?tA:Iye:d1}function qN(e,t){const n=[...e],s=n.length,i=e.map((o,a)=>Bk(o)(o,t[a]));return o=>{for(let a=0;a<s;a++)n[a]=i[a](o);return n}}function Iye(e,t){const n={...e,...t},s={};for(const i in n)e[i]!==void 0&&t[i]!==void 0&&(s[i]=Bk(e[i])(e[i],t[i]));return i=>{for(const o in s)n[o]=s[o](i);return n}}function Tye(e,t){var n;const s=[],i={color:0,var:0,number:0};for(let o=0;o<t.values.length;o++){const a=t.types[o],l=e.indexes[a][i[a]],c=(n=e.values[l])!==null&&n!==void 0?n:0;s[o]=c,i[a]++}return s}const Aye=(e,t)=>{const n=Ka.createTransformer(t),s=ap(e),i=ap(t);return s.indexes.var.length===i.indexes.var.length&&s.indexes.color.length===i.indexes.color.length&&s.indexes.number.length>=i.indexes.number.length?HC.has(e)&&!i.values.length||HC.has(t)&&!s.values.length?kye(e,t):qo(qN(Tye(s,i),i.values),n):d1(e,t)};function KN(e,t,n){return typeof e=="number"&&typeof t=="number"&&typeof n=="number"?wn(e,t,n):Bk(e)(e,t)}function Eye(e,t,n){const s=[],i=n||KN,o=e.length-1;for(let a=0;a<o;a++){let l=i(e[a],e[a+1]);if(t){const c=Array.isArray(t)?t[a]||Ps:t;l=qo(c,l)}s.push(l)}return s}function Mye(e,t,{clamp:n=!0,ease:s,mixer:i}={}){const o=e.length;if(_N(o===t.length),o===1)return()=>t[0];if(o===2&&e[0]===e[1])return()=>t[1];e[0]>e[o-1]&&(e=[...e].reverse(),t=[...t].reverse());const a=Eye(t,s,i),l=a.length,c=d=>{let h=0;if(l>1)for(;h<e.length-2&&!(d<e[h+1]);h++);const f=Wu(e[h],e[h+1],d);return a[h](f)};return n?d=>c(qa(e[0],e[o-1],d)):c}function Pye(e,t){const n=e[e.length-1];for(let s=1;s<=t;s++){const i=Wu(0,t,s);e.push(wn(n,1,i))}}function Lye(e){const t=[0];return Pye(t,e.length-1),t}function Dye(e,t){return e.map(n=>n*t)}function Rye(e,t){return e.map(()=>t||UN).splice(0,e.length-1)}function h1({duration:e=300,keyframes:t,times:n,ease:s="easeInOut"}){const i=xye(s)?s.map(JT):JT(s),o={done:!1,value:t[0]},a=Dye(n&&n.length===t.length?n:Lye(t),e),l=Mye(a,t,{ease:Array.isArray(i)?i:Rye(t,i)});return{calculatedDuration:e,next:c=>(o.value=l(c),o.done=c>=e,o)}}const nA=2e4;function Oye(e){let t=0;const n=50;let s=e.next(t);for(;!s.done&&t<nA;)t+=n,s=e.next(t);return t>=nA?1/0:t}const Nye=e=>{const t=({timestamp:n})=>e(n);return{start:()=>qt.update(t,!0),stop:()=>Ua(t),now:()=>us.isProcessing?us.timestamp:oo.now()}},Fye={decay:QT,inertia:QT,tween:h1,keyframes:h1,spring:WN},Bye=e=>e/100;class $k extends zN{constructor(t){super(t),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:c}=this.options;c&&c()};const{name:n,motionValue:s,element:i,keyframes:o}=this.options,a=(i==null?void 0:i.KeyframeResolver)||Lk,l=(c,d)=>this.onKeyframesResolved(c,d);this.resolver=new a(o,l,n,s,i),this.resolver.scheduleResolve()}initPlayback(t){const{type:n="keyframes",repeat:s=0,repeatDelay:i=0,repeatType:o,velocity:a=0}=this.options,l=Fk(n)?n:Fye[n]||h1;let c,d;l!==h1&&typeof t[0]!="number"&&(c=qo(Bye,KN(t[0],t[1])),t=[0,100]);const h=l({...this.options,keyframes:t});o==="mirror"&&(d=l({...this.options,keyframes:[...t].reverse(),velocity:-a})),h.calculatedDuration===null&&(h.calculatedDuration=Oye(h));const{calculatedDuration:f}=h,p=f+i,g=p*(s+1)-i;return{generator:h,mirroredGenerator:d,mapPercentToKeyframes:c,calculatedDuration:f,resolvedDuration:p,totalDuration:g}}onPostResolved(){const{autoplay:t=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!t?this.pause():this.state=this.pendingPlayState}tick(t,n=!1){const{resolved:s}=this;if(!s){const{keyframes:E}=this.options;return{done:!0,value:E[E.length-1]}}const{finalKeyframe:i,generator:o,mirroredGenerator:a,mapPercentToKeyframes:l,keyframes:c,calculatedDuration:d,totalDuration:h,resolvedDuration:f}=s;if(this.startTime===null)return o.next(0);const{delay:p,repeat:g,repeatType:m,repeatDelay:y,onUpdate:b}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,t):this.speed<0&&(this.startTime=Math.min(t-h/this.speed,this.startTime)),n?this.currentTime=t:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(t-this.startTime)*this.speed;const C=this.currentTime-p*(this.speed>=0?1:-1),x=this.speed>=0?C<0:C>h;this.currentTime=Math.max(C,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=h);let v=this.currentTime,w=o;if(g){const E=Math.min(this.currentTime,h)/f;let D=Math.floor(E),M=E%1;!M&&E>=1&&(M=1),M===1&&D--,D=Math.min(D,g+1),!!(D%2)&&(m==="reverse"?(M=1-M,y&&(M-=y/f)):m==="mirror"&&(w=a)),v=qa(0,1,M)*f}const S=x?{done:!1,value:c[0]}:w.next(v);l&&(S.value=l(S.value));let{done:j}=S;!x&&d!==null&&(j=this.speed>=0?this.currentTime>=h:this.currentTime<=0);const P=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&j);return P&&i!==void 0&&(S.value=Ib(c,this.options,i)),b&&b(S.value),P&&this.finish(),S}get duration(){const{resolved:t}=this;return t?Uo(t.calculatedDuration):0}get time(){return Uo(this.currentTime)}set time(t){t=Wo(t),this.currentTime=t,this.holdTime!==null||this.speed===0?this.holdTime=t:this.driver&&(this.startTime=this.driver.now()-t/this.speed)}get speed(){return this.playbackSpeed}set speed(t){const n=this.playbackSpeed!==t;this.playbackSpeed=t,n&&(this.time=Uo(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:t=Nye,onPlay:n,startTime:s}=this.options;this.driver||(this.driver=t(o=>this.tick(o))),n&&n();const i=this.driver.now();this.holdTime!==null?this.startTime=i-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=i):this.startTime=s??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var t;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(t=this.currentTime)!==null&&t!==void 0?t:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:t}=this.options;t&&t()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(t){return this.startTime=0,this.tick(t,!0)}}const ZN=new Set(["opacity","clipPath","filter","transform"]),YN=e=>Array.isArray(e)&&typeof e[0]=="number",$ye=10,Vye=(e,t)=>{let n="";const s=Math.max(Math.round(t/$ye),2);for(let i=0;i<s;i++)n+=e(Wu(0,s-1,i))+", ";return`linear(${n.substring(0,n.length-2)})`};function Vk(e){let t;return()=>(t===void 0&&(t=e()),t)}const zye={linearEasing:void 0};function Gye(e,t){const n=Vk(e);return()=>{var s;return(s=zye[t])!==null&&s!==void 0?s:n()}}const f1=Gye(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing");function XN(e){return!!(typeof e=="function"&&f1()||!e||typeof e=="string"&&(e in WC||f1())||YN(e)||Array.isArray(e)&&e.every(XN))}const ff=([e,t,n,s])=>`cubic-bezier(${e}, ${t}, ${n}, ${s})`,WC={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:ff([0,.65,.55,1]),circOut:ff([.55,0,1,.45]),backIn:ff([.31,.01,.66,-.59]),backOut:ff([.33,1.53,.69,.99])};function QN(e,t){if(e)return typeof e=="function"&&f1()?Vye(e,t):YN(e)?ff(e):Array.isArray(e)?e.map(n=>QN(n,t)||WC.easeOut):WC[e]}function Hye(e,t,n,{delay:s=0,duration:i=300,repeat:o=0,repeatType:a="loop",ease:l,times:c}={}){const d={[t]:n};c&&(d.offset=c);const h=QN(l,i);return Array.isArray(h)&&(d.easing=h),e.animate(d,{delay:s,duration:i,easing:Array.isArray(h)?"linear":h,fill:"both",iterations:o+1,direction:a==="reverse"?"alternate":"normal"})}function sA(e,t){e.timeline=t,e.onfinish=null}const Wye=Vk(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),p1=10,Uye=2e4;function qye(e){return Fk(e.type)||e.type==="spring"||!XN(e.ease)}function Kye(e,t){const n=new $k({...t,keyframes:e,repeat:0,delay:0,isGenerator:!0});let s={done:!1,value:e[0]};const i=[];let o=0;for(;!s.done&&o<Uye;)s=n.sample(o),i.push(s.value),o+=p1;return{times:void 0,keyframes:i,duration:o-p1,ease:"linear"}}const JN={anticipate:wN,backInOut:CN,circInOut:jN};function Zye(e){return e in JN}class rA extends zN{constructor(t){super(t);const{name:n,motionValue:s,element:i,keyframes:o}=this.options;this.resolver=new VN(o,(a,l)=>this.onKeyframesResolved(a,l),n,s,i),this.resolver.scheduleResolve()}initPlayback(t,n){var s;let{duration:i=300,times:o,ease:a,type:l,motionValue:c,name:d,startTime:h}=this.options;if(!(!((s=c.owner)===null||s===void 0)&&s.current))return!1;if(typeof a=="string"&&f1()&&Zye(a)&&(a=JN[a]),qye(this.options)){const{onComplete:p,onUpdate:g,motionValue:m,element:y,...b}=this.options,C=Kye(t,b);t=C.keyframes,t.length===1&&(t[1]=t[0]),i=C.duration,o=C.times,a=C.ease,l="keyframes"}const f=Hye(c.owner.current,d,t,{...this.options,duration:i,times:o,ease:a});return f.startTime=h??this.calcStartTime(),this.pendingTimeline?(sA(f,this.pendingTimeline),this.pendingTimeline=void 0):f.onfinish=()=>{const{onComplete:p}=this.options;c.set(Ib(t,this.options,n)),p&&p(),this.cancel(),this.resolveFinishedPromise()},{animation:f,duration:i,times:o,type:l,ease:a,keyframes:t}}get duration(){const{resolved:t}=this;if(!t)return 0;const{duration:n}=t;return Uo(n)}get time(){const{resolved:t}=this;if(!t)return 0;const{animation:n}=t;return Uo(n.currentTime||0)}set time(t){const{resolved:n}=this;if(!n)return;const{animation:s}=n;s.currentTime=Wo(t)}get speed(){const{resolved:t}=this;if(!t)return 1;const{animation:n}=t;return n.playbackRate}set speed(t){const{resolved:n}=this;if(!n)return;const{animation:s}=n;s.playbackRate=t}get state(){const{resolved:t}=this;if(!t)return"idle";const{animation:n}=t;return n.playState}get startTime(){const{resolved:t}=this;if(!t)return null;const{animation:n}=t;return n.startTime}attachTimeline(t){if(!this._resolved)this.pendingTimeline=t;else{const{resolved:n}=this;if(!n)return Ps;const{animation:s}=n;sA(s,t)}return Ps}play(){if(this.isStopped)return;const{resolved:t}=this;if(!t)return;const{animation:n}=t;n.playState==="finished"&&this.updateFinishedPromise(),n.play()}pause(){const{resolved:t}=this;if(!t)return;const{animation:n}=t;n.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:t}=this;if(!t)return;const{animation:n,keyframes:s,duration:i,type:o,ease:a,times:l}=t;if(n.playState==="idle"||n.playState==="finished")return;if(this.time){const{motionValue:d,onUpdate:h,onComplete:f,element:p,...g}=this.options,m=new $k({...g,keyframes:s,duration:i,type:o,ease:a,times:l,isGenerator:!0}),y=Wo(this.time);d.setWithVelocity(m.sample(y-p1).value,m.sample(y).value,p1)}const{onStop:c}=this.options;c&&c(),this.cancel()}complete(){const{resolved:t}=this;t&&t.animation.finish()}cancel(){const{resolved:t}=this;t&&t.animation.cancel()}static supports(t){const{motionValue:n,name:s,repeatDelay:i,repeatType:o,damping:a,type:l}=t;return Wye()&&s&&ZN.has(s)&&n&&n.owner&&n.owner.current instanceof HTMLElement&&!n.owner.getProps().onUpdate&&!i&&o!=="mirror"&&a!==0&&l!=="inertia"}}const Yye=Vk(()=>window.ScrollTimeline!==void 0);class Xye{constructor(t){this.stop=()=>this.runAll("stop"),this.animations=t.filter(Boolean)}then(t,n){return Promise.all(this.animations).then(t).catch(n)}getAll(t){return this.animations[0][t]}setAll(t,n){for(let s=0;s<this.animations.length;s++)this.animations[s][t]=n}attachTimeline(t,n){const s=this.animations.map(i=>Yye()&&i.attachTimeline?i.attachTimeline(t):n(i));return()=>{s.forEach((i,o)=>{i&&i(),this.animations[o].stop()})}}get time(){return this.getAll("time")}set time(t){this.setAll("time",t)}get speed(){return this.getAll("speed")}set speed(t){this.setAll("speed",t)}get startTime(){return this.getAll("startTime")}get duration(){let t=0;for(let n=0;n<this.animations.length;n++)t=Math.max(t,this.animations[n].duration);return t}runAll(t){this.animations.forEach(n=>n[t]())}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}function Qye({when:e,delay:t,delayChildren:n,staggerChildren:s,staggerDirection:i,repeat:o,repeatType:a,repeatDelay:l,from:c,elapsed:d,...h}){return!!Object.keys(h).length}const zk=(e,t,n,s={},i,o)=>a=>{const l=Ak(s,e)||{},c=l.delay||s.delay||0;let{elapsed:d=0}=s;d=d-Wo(c);let h={keyframes:Array.isArray(n)?n:[null,n],ease:"easeOut",velocity:t.getVelocity(),...l,delay:-d,onUpdate:p=>{t.set(p),l.onUpdate&&l.onUpdate(p)},onComplete:()=>{a(),l.onComplete&&l.onComplete()},name:e,motionValue:t,element:o?void 0:i};Qye(l)||(h={...h,...m1e(e,h)}),h.duration&&(h.duration=Wo(h.duration)),h.repeatDelay&&(h.repeatDelay=Wo(h.repeatDelay)),h.from!==void 0&&(h.keyframes[0]=h.from);let f=!1;if((h.type===!1||h.duration===0&&!h.repeatDelay)&&(h.duration=0,h.delay===0&&(f=!0)),f&&!o&&t.get()!==void 0){const p=Ib(h.keyframes,l);if(p!==void 0)return qt.update(()=>{h.onUpdate(p),h.onComplete()}),new Xye([])}return!o&&rA.supports(h)?new rA(h):new $k(h)},Jye=e=>!!(e&&typeof e=="object"&&e.mix&&e.toValue),ebe=e=>FC(e)?e[e.length-1]||0:e;function Gk(e,t){e.indexOf(t)===-1&&e.push(t)}function Hk(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}class Wk{constructor(){this.subscriptions=[]}add(t){return Gk(this.subscriptions,t),()=>Hk(this.subscriptions,t)}notify(t,n,s){const i=this.subscriptions.length;if(i)if(i===1)this.subscriptions[0](t,n,s);else for(let o=0;o<i;o++){const a=this.subscriptions[o];a&&a(t,n,s)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const iA=30,tbe=e=>!isNaN(parseFloat(e));class nbe{constructor(t,n={}){this.version="11.10.0",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(s,i=!0)=>{const o=oo.now();this.updatedAt!==o&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(s),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),i&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(t),this.owner=n.owner}setCurrent(t){this.current=t,this.updatedAt=oo.now(),this.canTrackVelocity===null&&t!==void 0&&(this.canTrackVelocity=tbe(this.current))}setPrevFrameValue(t=this.current){this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt}onChange(t){return this.on("change",t)}on(t,n){this.events[t]||(this.events[t]=new Wk);const s=this.events[t].add(n);return t==="change"?()=>{s(),qt.read(()=>{this.events.change.getSize()||this.stop()})}:s}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,n){this.passiveEffect=t,this.stopPassiveEffect=n}set(t,n=!0){!n||!this.passiveEffect?this.updateAndNotify(t,n):this.passiveEffect(t,this.updateAndNotify)}setWithVelocity(t,n,s){this.set(n),this.prev=void 0,this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt-s}jump(t,n=!0){this.updateAndNotify(t),this.prev=t,this.prevUpdatedAt=this.prevFrameValue=void 0,n&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const t=oo.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||t-this.updatedAt>iA)return 0;const n=Math.min(this.updatedAt-this.prevUpdatedAt,iA);return GN(parseFloat(this.current)-parseFloat(this.prevFrameValue),n)}start(t){return this.stop(),new Promise(n=>{this.hasAnimated=!0,this.animation=t(n),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function lp(e,t){return new nbe(e,t)}function sbe(e,t,n){e.hasValue(t)?e.getValue(t).set(n):e.addValue(t,lp(n))}function rbe(e,t){const n=_b(e,t);let{transitionEnd:s={},transition:i={},...o}=n||{};o={...o,...s};for(const a in o){const l=ebe(o[a]);sbe(e,a,l)}}const Tb=e=>e.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),ibe="framerAppearId",eF="data-"+Tb(ibe);function tF(e){return e.props[eF]}const _s=e=>!!(e&&e.getVelocity);function obe(e){return!!(_s(e)&&e.add)}function nF(e){if(ol.has(e))return"transform";if(ZN.has(e))return Tb(e)}function UC(e,t){var n;if(!e.applyWillChange)return;const s=e.getValue("willChange");if(obe(s))return s.add(t);!(!((n=e.props.style)===null||n===void 0)&&n.willChange)&&nF(t)&&e.setStaticValue("willChange","transform")}function abe({protectedKeys:e,needsAnimating:t},n){const s=e.hasOwnProperty(n)&&t[n]!==!0;return t[n]=!1,s}function sF(e,t,{delay:n=0,transitionOverride:s,type:i}={}){var o;let{transition:a=e.getDefaultTransition(),transitionEnd:l,...c}=t;s&&(a=s);const d=[],h=i&&e.animationState&&e.animationState.getState()[i];for(const f in c){const p=e.getValue(f,(o=e.latestValues[f])!==null&&o!==void 0?o:null),g=c[f];if(g===void 0||h&&abe(h,f))continue;const m={delay:n,...Ak(a||{},f)};let y=!1;if(window.MotionHandoffAnimation){const C=tF(e);if(C){const x=window.MotionHandoffAnimation(C,f,qt);x!==null&&(m.startTime=x,y=!0)}}UC(e,f),p.start(zk(f,p,g,e.shouldReduceMotion&&ol.has(f)?{type:!1}:m,e,y));const b=p.animation;b&&d.push(b)}return l&&Promise.all(d).then(()=>{qt.update(()=>{l&&rbe(e,l)})}),d}function qC(e,t,n={}){var s;const i=_b(e,t,n.type==="exit"?(s=e.presenceContext)===null||s===void 0?void 0:s.custom:void 0);let{transition:o=e.getDefaultTransition()||{}}=i||{};n.transitionOverride&&(o=n.transitionOverride);const a=i?()=>Promise.all(sF(e,i,n)):()=>Promise.resolve(),l=e.variantChildren&&e.variantChildren.size?(d=0)=>{const{delayChildren:h=0,staggerChildren:f,staggerDirection:p}=o;return lbe(e,t,h+d,f,p,n)}:()=>Promise.resolve(),{when:c}=o;if(c){const[d,h]=c==="beforeChildren"?[a,l]:[l,a];return d().then(()=>h())}else return Promise.all([a(),l(n.delay)])}function lbe(e,t,n=0,s=0,i=1,o){const a=[],l=(e.variantChildren.size-1)*s,c=i===1?(d=0)=>d*s:(d=0)=>l-d*s;return Array.from(e.variantChildren).sort(cbe).forEach((d,h)=>{d.notify("AnimationStart",t),a.push(qC(d,t,{...o,delay:n+c(h)}).then(()=>d.notify("AnimationComplete",t)))}),Promise.all(a)}function cbe(e,t){return e.sortNodePosition(t)}function ube(e,t,n={}){e.notify("AnimationStart",t);let s;if(Array.isArray(t)){const i=t.map(o=>qC(e,o,n));s=Promise.all(i)}else if(typeof t=="string")s=qC(e,t,n);else{const i=typeof t=="function"?_b(e,t,n.custom):t;s=Promise.all(sF(e,i,n))}return s.then(()=>{e.notify("AnimationComplete",t)})}const dbe=Tk.length;function rF(e){if(!e)return;if(!e.isControllingVariants){const n=e.parent?rF(e.parent)||{}:{};return e.props.initial!==void 0&&(n.initial=e.props.initial),n}const t={};for(let n=0;n<dbe;n++){const s=Tk[n],i=e.props[s];(ip(i)||i===!1)&&(t[s]=i)}return t}const hbe=[...Ik].reverse(),fbe=Ik.length;function pbe(e){return t=>Promise.all(t.map(({animation:n,options:s})=>ube(e,n,s)))}function gbe(e){let t=pbe(e),n=oA(),s=!0;const i=c=>(d,h)=>{var f;const p=_b(e,h,c==="exit"?(f=e.presenceContext)===null||f===void 0?void 0:f.custom:void 0);if(p){const{transition:g,transitionEnd:m,...y}=p;d={...d,...y,...m}}return d};function o(c){t=c(e)}function a(c){const{props:d}=e,h=rF(e.parent)||{},f=[],p=new Set;let g={},m=1/0;for(let b=0;b<fbe;b++){const C=hbe[b],x=n[C],v=d[C]!==void 0?d[C]:h[C],w=ip(v),S=C===c?x.isActive:null;S===!1&&(m=b);let j=v===h[C]&&v!==d[C]&&w;if(j&&s&&e.manuallyAnimateOnMount&&(j=!1),x.protectedKeys={...g},!x.isActive&&S===null||!v&&!x.prevProp||rp(v)||typeof v=="boolean")continue;const P=mbe(x.prevProp,v);let E=P||C===c&&x.isActive&&!j&&w||b>m&&w,D=!1;const M=Array.isArray(v)?v:[v];let R=M.reduce(i(C),{});S===!1&&(R={});const{prevResolvedValues:F={}}=x,_={...F,...R},L=z=>{E=!0,p.has(z)&&(D=!0,p.delete(z)),x.needsAnimating[z]=!0;const ee=e.getValue(z);ee&&(ee.liveStyle=!1)};for(const z in _){const ee=R[z],ne=F[z];if(g.hasOwnProperty(z))continue;let re=!1;FC(ee)&&FC(ne)?re=!gN(ee,ne):re=ee!==ne,re?ee!=null?L(z):p.add(z):ee!==void 0&&p.has(z)?L(z):x.protectedKeys[z]=!0}x.prevProp=v,x.prevResolvedValues=R,x.isActive&&(g={...g,...R}),s&&e.blockInitialAnimation&&(E=!1),E&&(!(j&&P)||D)&&f.push(...M.map(z=>({animation:z,options:{type:C}})))}if(p.size){const b={};p.forEach(C=>{const x=e.getBaseTarget(C),v=e.getValue(C);v&&(v.liveStyle=!0),b[C]=x??null}),f.push({animation:b})}let y=!!f.length;return s&&(d.initial===!1||d.initial===d.animate)&&!e.manuallyAnimateOnMount&&(y=!1),s=!1,y?t(f):Promise.resolve()}function l(c,d){var h;if(n[c].isActive===d)return Promise.resolve();(h=e.variantChildren)===null||h===void 0||h.forEach(p=>{var g;return(g=p.animationState)===null||g===void 0?void 0:g.setActive(c,d)}),n[c].isActive=d;const f=a(c);for(const p in n)n[p].protectedKeys={};return f}return{animateChanges:a,setActive:l,setAnimateFunction:o,getState:()=>n,reset:()=>{n=oA(),s=!0}}}function mbe(e,t){return typeof t=="string"?t!==e:Array.isArray(t)?!gN(t,e):!1}function yl(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function oA(){return{animate:yl(!0),whileInView:yl(),whileHover:yl(),whileTap:yl(),whileDrag:yl(),whileFocus:yl(),exit:yl()}}class al{constructor(t){this.isMounted=!1,this.node=t}update(){}}class ybe extends al{constructor(t){super(t),t.animationState||(t.animationState=gbe(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();rp(t)&&(this.unmountControls=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:n}=this.node.prevProps||{};t!==n&&this.updateAnimationControlsSubscription()}unmount(){var t;this.node.animationState.reset(),(t=this.unmountControls)===null||t===void 0||t.call(this)}}let bbe=0;class xbe extends al{constructor(){super(...arguments),this.id=bbe++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:n}=this.node.presenceContext,{isPresent:s}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===s)return;const i=this.node.animationState.setActive("exit",!t);n&&!t&&i.then(()=>n(this.id))}mount(){const{register:t}=this.node.presenceContext||{};t&&(this.unmount=t(this.id))}unmount(){}}const vbe={animation:{Feature:ybe},exit:{Feature:xbe}},iF=e=>e.pointerType==="mouse"?typeof e.button!="number"||e.button<=0:e.isPrimary!==!1;function Ab(e,t="page"){return{point:{x:e[`${t}X`],y:e[`${t}Y`]}}}const Cbe=e=>t=>iF(t)&&e(t,Ab(t));function Go(e,t,n,s={passive:!0}){return e.addEventListener(t,n,s),()=>e.removeEventListener(t,n)}function Ko(e,t,n,s){return Go(e,t,Cbe(n),s)}const aA=(e,t)=>Math.abs(e-t);function wbe(e,t){const n=aA(e.x,t.x),s=aA(e.y,t.y);return Math.sqrt(n**2+s**2)}class oF{constructor(t,n,{transformPagePoint:s,contextWindow:i,dragSnapToOrigin:o=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const f=kv(this.lastMoveEventInfo,this.history),p=this.startEvent!==null,g=wbe(f.offset,{x:0,y:0})>=3;if(!p&&!g)return;const{point:m}=f,{timestamp:y}=us;this.history.push({...m,timestamp:y});const{onStart:b,onMove:C}=this.handlers;p||(b&&b(this.lastMoveEvent,f),this.startEvent=this.lastMoveEvent),C&&C(this.lastMoveEvent,f)},this.handlePointerMove=(f,p)=>{this.lastMoveEvent=f,this.lastMoveEventInfo=jv(p,this.transformPagePoint),qt.update(this.updatePoint,!0)},this.handlePointerUp=(f,p)=>{this.end();const{onEnd:g,onSessionEnd:m,resumeAnimation:y}=this.handlers;if(this.dragSnapToOrigin&&y&&y(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const b=kv(f.type==="pointercancel"?this.lastMoveEventInfo:jv(p,this.transformPagePoint),this.history);this.startEvent&&g&&g(f,b),m&&m(f,b)},!iF(t))return;this.dragSnapToOrigin=o,this.handlers=n,this.transformPagePoint=s,this.contextWindow=i||window;const a=Ab(t),l=jv(a,this.transformPagePoint),{point:c}=l,{timestamp:d}=us;this.history=[{...c,timestamp:d}];const{onSessionStart:h}=n;h&&h(t,kv(l,this.history)),this.removeListeners=qo(Ko(this.contextWindow,"pointermove",this.handlePointerMove),Ko(this.contextWindow,"pointerup",this.handlePointerUp),Ko(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),Ua(this.updatePoint)}}function jv(e,t){return t?{point:t(e.point)}:e}function lA(e,t){return{x:e.x-t.x,y:e.y-t.y}}function kv({point:e},t){return{point:e,delta:lA(e,aF(t)),offset:lA(e,Sbe(t)),velocity:jbe(t,.1)}}function Sbe(e){return e[0]}function aF(e){return e[e.length-1]}function jbe(e,t){if(e.length<2)return{x:0,y:0};let n=e.length-1,s=null;const i=aF(e);for(;n>=0&&(s=e[n],!(i.timestamp-s.timestamp>Wo(t)));)n--;if(!s)return{x:0,y:0};const o=Uo(i.timestamp-s.timestamp);if(o===0)return{x:0,y:0};const a={x:(i.x-s.x)/o,y:(i.y-s.y)/o};return a.x===1/0&&(a.x=0),a.y===1/0&&(a.y=0),a}function lF(e){let t=null;return()=>{const n=()=>{t=null};return t===null?(t=e,n):!1}}const cA=lF("dragHorizontal"),uA=lF("dragVertical");function cF(e){let t=!1;if(e==="y")t=uA();else if(e==="x")t=cA();else{const n=cA(),s=uA();n&&s?t=()=>{n(),s()}:(n&&n(),s&&s())}return t}function uF(){const e=cF(!0);return e?(e(),!1):!0}function du(e){return e&&typeof e=="object"&&Object.prototype.hasOwnProperty.call(e,"current")}const dF=1e-4,kbe=1-dF,_be=1+dF,hF=.01,Ibe=0-hF,Tbe=0+hF;function Mr(e){return e.max-e.min}function Abe(e,t,n){return Math.abs(e-t)<=n}function dA(e,t,n,s=.5){e.origin=s,e.originPoint=wn(t.min,t.max,e.origin),e.scale=Mr(n)/Mr(t),e.translate=wn(n.min,n.max,e.origin)-e.originPoint,(e.scale>=kbe&&e.scale<=_be||isNaN(e.scale))&&(e.scale=1),(e.translate>=Ibe&&e.translate<=Tbe||isNaN(e.translate))&&(e.translate=0)}function Tf(e,t,n,s){dA(e.x,t.x,n.x,s?s.originX:void 0),dA(e.y,t.y,n.y,s?s.originY:void 0)}function hA(e,t,n){e.min=n.min+t.min,e.max=e.min+Mr(t)}function Ebe(e,t,n){hA(e.x,t.x,n.x),hA(e.y,t.y,n.y)}function fA(e,t,n){e.min=t.min-n.min,e.max=e.min+Mr(t)}function Af(e,t,n){fA(e.x,t.x,n.x),fA(e.y,t.y,n.y)}function Mbe(e,{min:t,max:n},s){return t!==void 0&&e<t?e=s?wn(t,e,s.min):Math.max(e,t):n!==void 0&&e>n&&(e=s?wn(n,e,s.max):Math.min(e,n)),e}function pA(e,t,n){return{min:t!==void 0?e.min+t:void 0,max:n!==void 0?e.max+n-(e.max-e.min):void 0}}function Pbe(e,{top:t,left:n,bottom:s,right:i}){return{x:pA(e.x,n,i),y:pA(e.y,t,s)}}function gA(e,t){let n=t.min-e.min,s=t.max-e.max;return t.max-t.min<e.max-e.min&&([n,s]=[s,n]),{min:n,max:s}}function Lbe(e,t){return{x:gA(e.x,t.x),y:gA(e.y,t.y)}}function Dbe(e,t){let n=.5;const s=Mr(e),i=Mr(t);return i>s?n=Wu(t.min,t.max-s,e.min):s>i&&(n=Wu(e.min,e.max-i,t.min)),qa(0,1,n)}function Rbe(e,t){const n={};return t.min!==void 0&&(n.min=t.min-e.min),t.max!==void 0&&(n.max=t.max-e.min),n}const KC=.35;function Obe(e=KC){return e===!1?e=0:e===!0&&(e=KC),{x:mA(e,"left","right"),y:mA(e,"top","bottom")}}function mA(e,t,n){return{min:yA(e,t),max:yA(e,n)}}function yA(e,t){return typeof e=="number"?e:e[t]||0}const bA=()=>({translate:0,scale:1,origin:0,originPoint:0}),hu=()=>({x:bA(),y:bA()}),xA=()=>({min:0,max:0}),Mn=()=>({x:xA(),y:xA()});function Wr(e){return[e("x"),e("y")]}function fF({top:e,left:t,right:n,bottom:s}){return{x:{min:t,max:n},y:{min:e,max:s}}}function Nbe({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}function Fbe(e,t){if(!t)return e;const n=t({x:e.left,y:e.top}),s=t({x:e.right,y:e.bottom});return{top:n.y,left:n.x,bottom:s.y,right:s.x}}function _v(e){return e===void 0||e===1}function ZC({scale:e,scaleX:t,scaleY:n}){return!_v(e)||!_v(t)||!_v(n)}function vl(e){return ZC(e)||pF(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function pF(e){return vA(e.x)||vA(e.y)}function vA(e){return e&&e!=="0%"}function g1(e,t,n){const s=e-n,i=t*s;return n+i}function CA(e,t,n,s,i){return i!==void 0&&(e=g1(e,i,s)),g1(e,n,s)+t}function YC(e,t=0,n=1,s,i){e.min=CA(e.min,t,n,s,i),e.max=CA(e.max,t,n,s,i)}function gF(e,{x:t,y:n}){YC(e.x,t.translate,t.scale,t.originPoint),YC(e.y,n.translate,n.scale,n.originPoint)}const wA=.999999999999,SA=1.0000000000001;function Bbe(e,t,n,s=!1){const i=n.length;if(!i)return;t.x=t.y=1;let o,a;for(let l=0;l<i;l++){o=n[l],a=o.projectionDelta;const{visualElement:c}=o.options;c&&c.props.style&&c.props.style.display==="contents"||(s&&o.options.layoutScroll&&o.scroll&&o!==o.root&&pu(e,{x:-o.scroll.offset.x,y:-o.scroll.offset.y}),a&&(t.x*=a.x.scale,t.y*=a.y.scale,gF(e,a)),s&&vl(o.latestValues)&&pu(e,o.latestValues))}t.x<SA&&t.x>wA&&(t.x=1),t.y<SA&&t.y>wA&&(t.y=1)}function fu(e,t){e.min=e.min+t,e.max=e.max+t}function jA(e,t,n,s,i=.5){const o=wn(e.min,e.max,i);YC(e,t,n,o,s)}function pu(e,t){jA(e.x,t.x,t.scaleX,t.scale,t.originX),jA(e.y,t.y,t.scaleY,t.scale,t.originY)}function mF(e,t){return fF(Fbe(e.getBoundingClientRect(),t))}function $be(e,t,n){const s=mF(e,n),{scroll:i}=t;return i&&(fu(s.x,i.offset.x),fu(s.y,i.offset.y)),s}const yF=({current:e})=>e?e.ownerDocument.defaultView:null,Vbe=new WeakMap;class zbe{constructor(t){this.openGlobalLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Mn(),this.visualElement=t}start(t,{snapToCursor:n=!1}={}){const{presenceContext:s}=this.visualElement;if(s&&s.isPresent===!1)return;const i=h=>{const{dragSnapToOrigin:f}=this.getProps();f?this.pauseAnimation():this.stopAnimation(),n&&this.snapToCursor(Ab(h,"page").point)},o=(h,f)=>{const{drag:p,dragPropagation:g,onDragStart:m}=this.getProps();if(p&&!g&&(this.openGlobalLock&&this.openGlobalLock(),this.openGlobalLock=cF(p),!this.openGlobalLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Wr(b=>{let C=this.getAxisMotionValue(b).get()||0;if(io.test(C)){const{projection:x}=this.visualElement;if(x&&x.layout){const v=x.layout.layoutBox[b];v&&(C=Mr(v)*(parseFloat(C)/100))}}this.originPoint[b]=C}),m&&qt.postRender(()=>m(h,f)),UC(this.visualElement,"transform");const{animationState:y}=this.visualElement;y&&y.setActive("whileDrag",!0)},a=(h,f)=>{const{dragPropagation:p,dragDirectionLock:g,onDirectionLock:m,onDrag:y}=this.getProps();if(!p&&!this.openGlobalLock)return;const{offset:b}=f;if(g&&this.currentDirection===null){this.currentDirection=Gbe(b),this.currentDirection!==null&&m&&m(this.currentDirection);return}this.updateAxis("x",f.point,b),this.updateAxis("y",f.point,b),this.visualElement.render(),y&&y(h,f)},l=(h,f)=>this.stop(h,f),c=()=>Wr(h=>{var f;return this.getAnimationState(h)==="paused"&&((f=this.getAxisMotionValue(h).animation)===null||f===void 0?void 0:f.play())}),{dragSnapToOrigin:d}=this.getProps();this.panSession=new oF(t,{onSessionStart:i,onStart:o,onMove:a,onSessionEnd:l,resumeAnimation:c},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:d,contextWindow:yF(this.visualElement)})}stop(t,n){const s=this.isDragging;if(this.cancel(),!s)return;const{velocity:i}=n;this.startAnimation(i);const{onDragEnd:o}=this.getProps();o&&qt.postRender(()=>o(t,n))}cancel(){this.isDragging=!1;const{projection:t,animationState:n}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:s}=this.getProps();!s&&this.openGlobalLock&&(this.openGlobalLock(),this.openGlobalLock=null),n&&n.setActive("whileDrag",!1)}updateAxis(t,n,s){const{drag:i}=this.getProps();if(!s||!wm(t,i,this.currentDirection))return;const o=this.getAxisMotionValue(t);let a=this.originPoint[t]+s[t];this.constraints&&this.constraints[t]&&(a=Mbe(a,this.constraints[t],this.elastic[t])),o.set(a)}resolveConstraints(){var t;const{dragConstraints:n,dragElastic:s}=this.getProps(),i=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(t=this.visualElement.projection)===null||t===void 0?void 0:t.layout,o=this.constraints;n&&du(n)?this.constraints||(this.constraints=this.resolveRefConstraints()):n&&i?this.constraints=Pbe(i.layoutBox,n):this.constraints=!1,this.elastic=Obe(s),o!==this.constraints&&i&&this.constraints&&!this.hasMutatedConstraints&&Wr(a=>{this.constraints!==!1&&this.getAxisMotionValue(a)&&(this.constraints[a]=Rbe(i.layoutBox[a],this.constraints[a]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:n}=this.getProps();if(!t||!du(t))return!1;const s=t.current,{projection:i}=this.visualElement;if(!i||!i.layout)return!1;const o=$be(s,i.root,this.visualElement.getTransformPagePoint());let a=Lbe(i.layout.layoutBox,o);if(n){const l=n(Nbe(a));this.hasMutatedConstraints=!!l,l&&(a=fF(l))}return a}startAnimation(t){const{drag:n,dragMomentum:s,dragElastic:i,dragTransition:o,dragSnapToOrigin:a,onDragTransitionEnd:l}=this.getProps(),c=this.constraints||{},d=Wr(h=>{if(!wm(h,n,this.currentDirection))return;let f=c&&c[h]||{};a&&(f={min:0,max:0});const p=i?200:1e6,g=i?40:1e7,m={type:"inertia",velocity:s?t[h]:0,bounceStiffness:p,bounceDamping:g,timeConstant:750,restDelta:1,restSpeed:10,...o,...f};return this.startAxisValueAnimation(h,m)});return Promise.all(d).then(l)}startAxisValueAnimation(t,n){const s=this.getAxisMotionValue(t);return UC(this.visualElement,t),s.start(zk(t,s,0,n,this.visualElement,!1))}stopAnimation(){Wr(t=>this.getAxisMotionValue(t).stop())}pauseAnimation(){Wr(t=>{var n;return(n=this.getAxisMotionValue(t).animation)===null||n===void 0?void 0:n.pause()})}getAnimationState(t){var n;return(n=this.getAxisMotionValue(t).animation)===null||n===void 0?void 0:n.state}getAxisMotionValue(t){const n=`_drag${t.toUpperCase()}`,s=this.visualElement.getProps(),i=s[n];return i||this.visualElement.getValue(t,(s.initial?s.initial[t]:void 0)||0)}snapToCursor(t){Wr(n=>{const{drag:s}=this.getProps();if(!wm(n,s,this.currentDirection))return;const{projection:i}=this.visualElement,o=this.getAxisMotionValue(n);if(i&&i.layout){const{min:a,max:l}=i.layout.layoutBox[n];o.set(t[n]-wn(a,l,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:n}=this.getProps(),{projection:s}=this.visualElement;if(!du(n)||!s||!this.constraints)return;this.stopAnimation();const i={x:0,y:0};Wr(a=>{const l=this.getAxisMotionValue(a);if(l&&this.constraints!==!1){const c=l.get();i[a]=Dbe({min:c,max:c},this.constraints[a])}});const{transformTemplate:o}=this.visualElement.getProps();this.visualElement.current.style.transform=o?o({},""):"none",s.root&&s.root.updateScroll(),s.updateLayout(),this.resolveConstraints(),Wr(a=>{if(!wm(a,t,null))return;const l=this.getAxisMotionValue(a),{min:c,max:d}=this.constraints[a];l.set(wn(c,d,i[a]))})}addListeners(){if(!this.visualElement.current)return;Vbe.set(this.visualElement,this);const t=this.visualElement.current,n=Ko(t,"pointerdown",c=>{const{drag:d,dragListener:h=!0}=this.getProps();d&&h&&this.start(c)}),s=()=>{const{dragConstraints:c}=this.getProps();du(c)&&c.current&&(this.constraints=this.resolveRefConstraints())},{projection:i}=this.visualElement,o=i.addEventListener("measure",s);i&&!i.layout&&(i.root&&i.root.updateScroll(),i.updateLayout()),qt.read(s);const a=Go(window,"resize",()=>this.scalePositionWithinConstraints()),l=i.addEventListener("didUpdate",({delta:c,hasLayoutChanged:d})=>{this.isDragging&&d&&(Wr(h=>{const f=this.getAxisMotionValue(h);f&&(this.originPoint[h]+=c[h].translate,f.set(f.get()+c[h].translate))}),this.visualElement.render())});return()=>{a(),n(),o(),l&&l()}}getProps(){const t=this.visualElement.getProps(),{drag:n=!1,dragDirectionLock:s=!1,dragPropagation:i=!1,dragConstraints:o=!1,dragElastic:a=KC,dragMomentum:l=!0}=t;return{...t,drag:n,dragDirectionLock:s,dragPropagation:i,dragConstraints:o,dragElastic:a,dragMomentum:l}}}function wm(e,t,n){return(t===!0||t===e)&&(n===null||n===e)}function Gbe(e,t=10){let n=null;return Math.abs(e.y)>t?n="y":Math.abs(e.x)>t&&(n="x"),n}class Hbe extends al{constructor(t){super(t),this.removeGroupControls=Ps,this.removeListeners=Ps,this.controls=new zbe(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Ps}unmount(){this.removeGroupControls(),this.removeListeners()}}const kA=e=>(t,n)=>{e&&qt.postRender(()=>e(t,n))};class Wbe extends al{constructor(){super(...arguments),this.removePointerDownListener=Ps}onPointerDown(t){this.session=new oF(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:yF(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:n,onPan:s,onPanEnd:i}=this.node.getProps();return{onSessionStart:kA(t),onStart:kA(n),onMove:s,onEnd:(o,a)=>{delete this.session,i&&qt.postRender(()=>i(o,a))}}}mount(){this.removePointerDownListener=Ko(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const Eb=u.createContext(null);function Ube(){const e=u.useContext(Eb);if(e===null)return[!0,null];const{isPresent:t,onExitComplete:n,register:s}=e,i=u.useId();u.useEffect(()=>s(i),[]);const o=u.useCallback(()=>n&&n(i),[i,n]);return!t&&n?[!1,o]:[!0]}const Uk=u.createContext({}),bF=u.createContext({}),v0={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function _A(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const Vh={correct:(e,t)=>{if(!t.target)return e;if(typeof e=="string")if(st.test(e))e=parseFloat(e);else return e;const n=_A(e,t.target.x),s=_A(e,t.target.y);return`${n}% ${s}%`}},qbe={correct:(e,{treeScale:t,projectionDelta:n})=>{const s=e,i=Ka.parse(e);if(i.length>5)return s;const o=Ka.createTransformer(e),a=typeof i[0]!="number"?1:0,l=n.x.scale*t.x,c=n.y.scale*t.y;i[0+a]/=l,i[1+a]/=c;const d=wn(l,c,.5);return typeof i[2+a]=="number"&&(i[2+a]/=d),typeof i[3+a]=="number"&&(i[3+a]/=d),o(i)}},m1={};function Kbe(e){Object.assign(m1,e)}const{schedule:qk}=mN(queueMicrotask,!1);class Zbe extends u.Component{componentDidMount(){const{visualElement:t,layoutGroup:n,switchLayoutGroup:s,layoutId:i}=this.props,{projection:o}=t;Kbe(Ybe),o&&(n.group&&n.group.add(o),s&&s.register&&i&&s.register(o),o.root.didUpdate(),o.addEventListener("animationComplete",()=>{this.safeToRemove()}),o.setOptions({...o.options,onExitComplete:()=>this.safeToRemove()})),v0.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:n,visualElement:s,drag:i,isPresent:o}=this.props,a=s.projection;return a&&(a.isPresent=o,i||t.layoutDependency!==n||n===void 0?a.willUpdate():this.safeToRemove(),t.isPresent!==o&&(o?a.promote():a.relegate()||qt.postRender(()=>{const l=a.getStack();(!l||!l.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),qk.postRender(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:n,switchLayoutGroup:s}=this.props,{projection:i}=t;i&&(i.scheduleCheckAfterUnmount(),n&&n.group&&n.group.remove(i),s&&s.deregister&&s.deregister(i))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function xF(e){const[t,n]=Ube(),s=u.useContext(Uk);return r.jsx(Zbe,{...e,layoutGroup:s,switchLayoutGroup:u.useContext(bF),isPresent:t,safeToRemove:n})}const Ybe={borderRadius:{...Vh,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Vh,borderTopRightRadius:Vh,borderBottomLeftRadius:Vh,borderBottomRightRadius:Vh,boxShadow:qbe},vF=["TopLeft","TopRight","BottomLeft","BottomRight"],Xbe=vF.length,IA=e=>typeof e=="string"?parseFloat(e):e,TA=e=>typeof e=="number"||st.test(e);function Qbe(e,t,n,s,i,o){i?(e.opacity=wn(0,n.opacity!==void 0?n.opacity:1,Jbe(s)),e.opacityExit=wn(t.opacity!==void 0?t.opacity:1,0,exe(s))):o&&(e.opacity=wn(t.opacity!==void 0?t.opacity:1,n.opacity!==void 0?n.opacity:1,s));for(let a=0;a<Xbe;a++){const l=`border${vF[a]}Radius`;let c=AA(t,l),d=AA(n,l);if(c===void 0&&d===void 0)continue;c||(c=0),d||(d=0),c===0||d===0||TA(c)===TA(d)?(e[l]=Math.max(wn(IA(c),IA(d),s),0),(io.test(d)||io.test(c))&&(e[l]+="%")):e[l]=d}(t.rotate||n.rotate)&&(e.rotate=wn(t.rotate||0,n.rotate||0,s))}function AA(e,t){return e[t]!==void 0?e[t]:e.borderRadius}const Jbe=CF(0,.5,SN),exe=CF(.5,.95,Ps);function CF(e,t,n){return s=>s<e?0:s>t?1:n(Wu(e,t,s))}function EA(e,t){e.min=t.min,e.max=t.max}function zr(e,t){EA(e.x,t.x),EA(e.y,t.y)}function MA(e,t){e.translate=t.translate,e.scale=t.scale,e.originPoint=t.originPoint,e.origin=t.origin}function PA(e,t,n,s,i){return e-=t,e=g1(e,1/n,s),i!==void 0&&(e=g1(e,1/i,s)),e}function txe(e,t=0,n=1,s=.5,i,o=e,a=e){if(io.test(t)&&(t=parseFloat(t),t=wn(a.min,a.max,t/100)-a.min),typeof t!="number")return;let l=wn(o.min,o.max,s);e===o&&(l-=t),e.min=PA(e.min,t,n,l,i),e.max=PA(e.max,t,n,l,i)}function LA(e,t,[n,s,i],o,a){txe(e,t[n],t[s],t[i],t.scale,o,a)}const nxe=["x","scaleX","originX"],sxe=["y","scaleY","originY"];function DA(e,t,n,s){LA(e.x,t,nxe,n?n.x:void 0,s?s.x:void 0),LA(e.y,t,sxe,n?n.y:void 0,s?s.y:void 0)}function RA(e){return e.translate===0&&e.scale===1}function wF(e){return RA(e.x)&&RA(e.y)}function OA(e,t){return e.min===t.min&&e.max===t.max}function rxe(e,t){return OA(e.x,t.x)&&OA(e.y,t.y)}function NA(e,t){return Math.round(e.min)===Math.round(t.min)&&Math.round(e.max)===Math.round(t.max)}function SF(e,t){return NA(e.x,t.x)&&NA(e.y,t.y)}function FA(e){return Mr(e.x)/Mr(e.y)}function BA(e,t){return e.translate===t.translate&&e.scale===t.scale&&e.originPoint===t.originPoint}class ixe{constructor(){this.members=[]}add(t){Gk(this.members,t),t.scheduleRender()}remove(t){if(Hk(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const n=this.members[this.members.length-1];n&&this.promote(n)}}relegate(t){const n=this.members.findIndex(i=>t===i);if(n===0)return!1;let s;for(let i=n;i>=0;i--){const o=this.members[i];if(o.isPresent!==!1){s=o;break}}return s?(this.promote(s),!0):!1}promote(t,n){const s=this.lead;if(t!==s&&(this.prevLead=s,this.lead=t,t.show(),s)){s.instance&&s.scheduleRender(),t.scheduleRender(),t.resumeFrom=s,n&&(t.resumeFrom.preserveOpacity=!0),s.snapshot&&(t.snapshot=s.snapshot,t.snapshot.latestValues=s.animationValues||s.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0);const{crossfade:i}=t.options;i===!1&&s.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:n,resumingFrom:s}=t;n.onExitComplete&&n.onExitComplete(),s&&s.options.onExitComplete&&s.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function oxe(e,t,n){let s="";const i=e.x.translate/t.x,o=e.y.translate/t.y,a=(n==null?void 0:n.z)||0;if((i||o||a)&&(s=`translate3d(${i}px, ${o}px, ${a}px) `),(t.x!==1||t.y!==1)&&(s+=`scale(${1/t.x}, ${1/t.y}) `),n){const{transformPerspective:d,rotate:h,rotateX:f,rotateY:p,skewX:g,skewY:m}=n;d&&(s=`perspective(${d}px) ${s}`),h&&(s+=`rotate(${h}deg) `),f&&(s+=`rotateX(${f}deg) `),p&&(s+=`rotateY(${p}deg) `),g&&(s+=`skewX(${g}deg) `),m&&(s+=`skewY(${m}deg) `)}const l=e.x.scale*t.x,c=e.y.scale*t.y;return(l!==1||c!==1)&&(s+=`scale(${l}, ${c})`),s||"none"}const axe=(e,t)=>e.depth-t.depth;class lxe{constructor(){this.children=[],this.isDirty=!1}add(t){Gk(this.children,t),this.isDirty=!0}remove(t){Hk(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(axe),this.isDirty=!1,this.children.forEach(t)}}function C0(e){const t=_s(e)?e.get():e;return Jye(t)?t.toValue():t}function cxe(e,t){const n=oo.now(),s=({timestamp:i})=>{const o=i-n;o>=t&&(Ua(s),e(o-t))};return qt.read(s,!0),()=>Ua(s)}function uxe(e){return e instanceof SVGElement&&e.tagName!=="svg"}function dxe(e,t,n){const s=_s(e)?e:lp(e);return s.start(zk("",s,t,n)),s.animation}const Cl={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},pf=typeof window<"u"&&window.MotionDebug!==void 0,Iv=["","X","Y","Z"],hxe={visibility:"hidden"},$A=1e3;let fxe=0;function Tv(e,t,n,s){const{latestValues:i}=t;i[e]&&(n[e]=i[e],t.setStaticValue(e,0),s&&(s[e]=0))}function jF(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:t}=e.options;if(!t)return;const n=tF(t);if(window.MotionHasOptimisedAnimation(n,"transform")){const{layout:i,layoutId:o}=e.options;window.MotionCancelOptimisedAnimation(n,"transform",qt,!(i||o))}const{parent:s}=e;s&&!s.hasCheckedOptimisedAppear&&jF(s)}function kF({attachResizeListener:e,defaultParent:t,measureScroll:n,checkIsScrollRoot:s,resetTransform:i}){return class{constructor(a={},l=t==null?void 0:t()){this.id=fxe++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,pf&&(Cl.totalNodes=Cl.resolvedTargetDeltas=Cl.recalculatedProjection=0),this.nodes.forEach(mxe),this.nodes.forEach(Cxe),this.nodes.forEach(wxe),this.nodes.forEach(yxe),pf&&window.MotionDebug.record(Cl)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=a,this.root=l?l.root||l:this,this.path=l?[...l.path,l]:[],this.parent=l,this.depth=l?l.depth+1:0;for(let c=0;c<this.path.length;c++)this.path[c].shouldResetTransform=!0;this.root===this&&(this.nodes=new lxe)}addEventListener(a,l){return this.eventHandlers.has(a)||this.eventHandlers.set(a,new Wk),this.eventHandlers.get(a).add(l)}notifyListeners(a,...l){const c=this.eventHandlers.get(a);c&&c.notify(...l)}hasListeners(a){return this.eventHandlers.has(a)}mount(a,l=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=uxe(a),this.instance=a;const{layoutId:c,layout:d,visualElement:h}=this.options;if(h&&!h.current&&h.mount(a),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),l&&(d||c)&&(this.isLayoutDirty=!0),e){let f;const p=()=>this.root.updateBlockedByResize=!1;e(a,()=>{this.root.updateBlockedByResize=!0,f&&f(),f=cxe(p,250),v0.hasAnimatedSinceResize&&(v0.hasAnimatedSinceResize=!1,this.nodes.forEach(zA))})}c&&this.root.registerSharedNode(c,this),this.options.animate!==!1&&h&&(c||d)&&this.addEventListener("didUpdate",({delta:f,hasLayoutChanged:p,hasRelativeTargetChanged:g,layout:m})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const y=this.options.transition||h.getDefaultTransition()||Ixe,{onLayoutAnimationStart:b,onLayoutAnimationComplete:C}=h.getProps(),x=!this.targetLayout||!SF(this.targetLayout,m)||g,v=!p&&g;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||v||p&&(x||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(f,v);const w={...Ak(y,"layout"),onPlay:b,onComplete:C};(h.shouldReduceMotion||this.options.layoutRoot)&&(w.delay=0,w.type=!1),this.startAnimation(w)}else p||zA(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=m})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const a=this.getStack();a&&a.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,Ua(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(Sxe),this.animationId++)}getTransformTemplate(){const{visualElement:a}=this.options;return a&&a.getProps().transformTemplate}willUpdate(a=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&jF(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let h=0;h<this.path.length;h++){const f=this.path[h];f.shouldResetTransform=!0,f.updateScroll("snapshot"),f.options.layoutRoot&&f.willUpdate(!1)}const{layoutId:l,layout:c}=this.options;if(l===void 0&&!c)return;const d=this.getTransformTemplate();this.prevTransformTemplateValue=d?d(this.latestValues,""):void 0,this.updateSnapshot(),a&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(VA);return}this.isUpdating||this.nodes.forEach(xxe),this.isUpdating=!1,this.nodes.forEach(vxe),this.nodes.forEach(pxe),this.nodes.forEach(gxe),this.clearAllSnapshots();const l=oo.now();us.delta=qa(0,1e3/60,l-us.timestamp),us.timestamp=l,us.isProcessing=!0,vv.update.process(us),vv.preRender.process(us),vv.render.process(us),us.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,qk.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(bxe),this.sharedNodes.forEach(jxe)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,qt.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){qt.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let c=0;c<this.path.length;c++)this.path[c].updateScroll();const a=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Mn(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:l}=this.options;l&&l.notify("LayoutMeasure",this.layout.layoutBox,a?a.layoutBox:void 0)}updateScroll(a="measure"){let l=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===a&&(l=!1),l){const c=s(this.instance);this.scroll={animationId:this.root.animationId,phase:a,isRoot:c,offset:n(this.instance),wasRoot:this.scroll?this.scroll.isRoot:c}}}resetTransform(){if(!i)return;const a=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,l=this.projectionDelta&&!wF(this.projectionDelta),c=this.getTransformTemplate(),d=c?c(this.latestValues,""):void 0,h=d!==this.prevTransformTemplateValue;a&&(l||vl(this.latestValues)||h)&&(i(this.instance,d),this.shouldResetTransform=!1,this.scheduleRender())}measure(a=!0){const l=this.measurePageBox();let c=this.removeElementScroll(l);return a&&(c=this.removeTransform(c)),Txe(c),{animationId:this.root.animationId,measuredBox:l,layoutBox:c,latestValues:{},source:this.id}}measurePageBox(){var a;const{visualElement:l}=this.options;if(!l)return Mn();const c=l.measureViewportBox();if(!(((a=this.scroll)===null||a===void 0?void 0:a.wasRoot)||this.path.some(Axe))){const{scroll:h}=this.root;h&&(fu(c.x,h.offset.x),fu(c.y,h.offset.y))}return c}removeElementScroll(a){var l;const c=Mn();if(zr(c,a),!((l=this.scroll)===null||l===void 0)&&l.wasRoot)return c;for(let d=0;d<this.path.length;d++){const h=this.path[d],{scroll:f,options:p}=h;h!==this.root&&f&&p.layoutScroll&&(f.wasRoot&&zr(c,a),fu(c.x,f.offset.x),fu(c.y,f.offset.y))}return c}applyTransform(a,l=!1){const c=Mn();zr(c,a);for(let d=0;d<this.path.length;d++){const h=this.path[d];!l&&h.options.layoutScroll&&h.scroll&&h!==h.root&&pu(c,{x:-h.scroll.offset.x,y:-h.scroll.offset.y}),vl(h.latestValues)&&pu(c,h.latestValues)}return vl(this.latestValues)&&pu(c,this.latestValues),c}removeTransform(a){const l=Mn();zr(l,a);for(let c=0;c<this.path.length;c++){const d=this.path[c];if(!d.instance||!vl(d.latestValues))continue;ZC(d.latestValues)&&d.updateSnapshot();const h=Mn(),f=d.measurePageBox();zr(h,f),DA(l,d.latestValues,d.snapshot?d.snapshot.layoutBox:void 0,h)}return vl(this.latestValues)&&DA(l,this.latestValues),l}setTargetDelta(a){this.targetDelta=a,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(a){this.options={...this.options,...a,crossfade:a.crossfade!==void 0?a.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==us.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(a=!1){var l;const c=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=c.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=c.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=c.isSharedProjectionDirty);const d=!!this.resumingFrom||this!==c;if(!(a||d&&this.isSharedProjectionDirty||this.isProjectionDirty||!((l=this.parent)===null||l===void 0)&&l.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:f,layoutId:p}=this.options;if(!(!this.layout||!(f||p))){if(this.resolvedRelativeTargetAt=us.timestamp,!this.targetDelta&&!this.relativeTarget){const g=this.getClosestProjectingParent();g&&g.layout&&this.animationProgress!==1?(this.relativeParent=g,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Mn(),this.relativeTargetOrigin=Mn(),Af(this.relativeTargetOrigin,this.layout.layoutBox,g.layout.layoutBox),zr(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=Mn(),this.targetWithTransforms=Mn()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),Ebe(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):zr(this.target,this.layout.layoutBox),gF(this.target,this.targetDelta)):zr(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const g=this.getClosestProjectingParent();g&&!!g.resumingFrom==!!this.resumingFrom&&!g.options.layoutScroll&&g.target&&this.animationProgress!==1?(this.relativeParent=g,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Mn(),this.relativeTargetOrigin=Mn(),Af(this.relativeTargetOrigin,this.target,g.target),zr(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}pf&&Cl.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||ZC(this.parent.latestValues)||pF(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var a;const l=this.getLead(),c=!!this.resumingFrom||this!==l;let d=!0;if((this.isProjectionDirty||!((a=this.parent)===null||a===void 0)&&a.isProjectionDirty)&&(d=!1),c&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(d=!1),this.resolvedRelativeTargetAt===us.timestamp&&(d=!1),d)return;const{layout:h,layoutId:f}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(h||f))return;zr(this.layoutCorrected,this.layout.layoutBox);const p=this.treeScale.x,g=this.treeScale.y;Bbe(this.layoutCorrected,this.treeScale,this.path,c),l.layout&&!l.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(l.target=l.layout.layoutBox,l.targetWithTransforms=Mn());const{target:m}=l;if(!m){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(MA(this.prevProjectionDelta.x,this.projectionDelta.x),MA(this.prevProjectionDelta.y,this.projectionDelta.y)),Tf(this.projectionDelta,this.layoutCorrected,m,this.latestValues),(this.treeScale.x!==p||this.treeScale.y!==g||!BA(this.projectionDelta.x,this.prevProjectionDelta.x)||!BA(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",m)),pf&&Cl.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(a=!0){var l;if((l=this.options.visualElement)===null||l===void 0||l.scheduleRender(),a){const c=this.getStack();c&&c.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=hu(),this.projectionDelta=hu(),this.projectionDeltaWithTransform=hu()}setAnimationOrigin(a,l=!1){const c=this.snapshot,d=c?c.latestValues:{},h={...this.latestValues},f=hu();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!l;const p=Mn(),g=c?c.source:void 0,m=this.layout?this.layout.source:void 0,y=g!==m,b=this.getStack(),C=!b||b.members.length<=1,x=!!(y&&!C&&this.options.crossfade===!0&&!this.path.some(_xe));this.animationProgress=0;let v;this.mixTargetDelta=w=>{const S=w/1e3;GA(f.x,a.x,S),GA(f.y,a.y,S),this.setTargetDelta(f),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Af(p,this.layout.layoutBox,this.relativeParent.layout.layoutBox),kxe(this.relativeTarget,this.relativeTargetOrigin,p,S),v&&rxe(this.relativeTarget,v)&&(this.isProjectionDirty=!1),v||(v=Mn()),zr(v,this.relativeTarget)),y&&(this.animationValues=h,Qbe(h,d,this.latestValues,S,x,C)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=S},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(a){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(Ua(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=qt.update(()=>{v0.hasAnimatedSinceResize=!0,this.currentAnimation=dxe(0,$A,{...a,onUpdate:l=>{this.mixTargetDelta(l),a.onUpdate&&a.onUpdate(l)},onComplete:()=>{a.onComplete&&a.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const a=this.getStack();a&&a.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta($A),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const a=this.getLead();let{targetWithTransforms:l,target:c,layout:d,latestValues:h}=a;if(!(!l||!c||!d)){if(this!==a&&this.layout&&d&&_F(this.options.animationType,this.layout.layoutBox,d.layoutBox)){c=this.target||Mn();const f=Mr(this.layout.layoutBox.x);c.x.min=a.target.x.min,c.x.max=c.x.min+f;const p=Mr(this.layout.layoutBox.y);c.y.min=a.target.y.min,c.y.max=c.y.min+p}zr(l,c),pu(l,h),Tf(this.projectionDeltaWithTransform,this.layoutCorrected,l,h)}}registerSharedNode(a,l){this.sharedNodes.has(a)||this.sharedNodes.set(a,new ixe),this.sharedNodes.get(a).add(l);const d=l.options.initialPromotionConfig;l.promote({transition:d?d.transition:void 0,preserveFollowOpacity:d&&d.shouldPreserveFollowOpacity?d.shouldPreserveFollowOpacity(l):void 0})}isLead(){const a=this.getStack();return a?a.lead===this:!0}getLead(){var a;const{layoutId:l}=this.options;return l?((a=this.getStack())===null||a===void 0?void 0:a.lead)||this:this}getPrevLead(){var a;const{layoutId:l}=this.options;return l?(a=this.getStack())===null||a===void 0?void 0:a.prevLead:void 0}getStack(){const{layoutId:a}=this.options;if(a)return this.root.sharedNodes.get(a)}promote({needsReset:a,transition:l,preserveFollowOpacity:c}={}){const d=this.getStack();d&&d.promote(this,c),a&&(this.projectionDelta=void 0,this.needsReset=!0),l&&this.setOptions({transition:l})}relegate(){const a=this.getStack();return a?a.relegate(this):!1}resetSkewAndRotation(){const{visualElement:a}=this.options;if(!a)return;let l=!1;const{latestValues:c}=a;if((c.z||c.rotate||c.rotateX||c.rotateY||c.rotateZ||c.skewX||c.skewY)&&(l=!0),!l)return;const d={};c.z&&Tv("z",a,d,this.animationValues);for(let h=0;h<Iv.length;h++)Tv(`rotate${Iv[h]}`,a,d,this.animationValues),Tv(`skew${Iv[h]}`,a,d,this.animationValues);a.render();for(const h in d)a.setStaticValue(h,d[h]),this.animationValues&&(this.animationValues[h]=d[h]);a.scheduleRender()}getProjectionStyles(a){var l,c;if(!this.instance||this.isSVG)return;if(!this.isVisible)return hxe;const d={visibility:""},h=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,d.opacity="",d.pointerEvents=C0(a==null?void 0:a.pointerEvents)||"",d.transform=h?h(this.latestValues,""):"none",d;const f=this.getLead();if(!this.projectionDelta||!this.layout||!f.target){const y={};return this.options.layoutId&&(y.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,y.pointerEvents=C0(a==null?void 0:a.pointerEvents)||""),this.hasProjected&&!vl(this.latestValues)&&(y.transform=h?h({},""):"none",this.hasProjected=!1),y}const p=f.animationValues||f.latestValues;this.applyTransformsToTarget(),d.transform=oxe(this.projectionDeltaWithTransform,this.treeScale,p),h&&(d.transform=h(p,d.transform));const{x:g,y:m}=this.projectionDelta;d.transformOrigin=`${g.origin*100}% ${m.origin*100}% 0`,f.animationValues?d.opacity=f===this?(c=(l=p.opacity)!==null&&l!==void 0?l:this.latestValues.opacity)!==null&&c!==void 0?c:1:this.preserveOpacity?this.latestValues.opacity:p.opacityExit:d.opacity=f===this?p.opacity!==void 0?p.opacity:"":p.opacityExit!==void 0?p.opacityExit:0;for(const y in m1){if(p[y]===void 0)continue;const{correct:b,applyTo:C}=m1[y],x=d.transform==="none"?p[y]:b(p[y],f);if(C){const v=C.length;for(let w=0;w<v;w++)d[C[w]]=x}else d[y]=x}return this.options.layoutId&&(d.pointerEvents=f===this?C0(a==null?void 0:a.pointerEvents)||"":"none"),d}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(a=>{var l;return(l=a.currentAnimation)===null||l===void 0?void 0:l.stop()}),this.root.nodes.forEach(VA),this.root.sharedNodes.clear()}}}function pxe(e){e.updateLayout()}function gxe(e){var t;const n=((t=e.resumeFrom)===null||t===void 0?void 0:t.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&n&&e.hasListeners("didUpdate")){const{layoutBox:s,measuredBox:i}=e.layout,{animationType:o}=e.options,a=n.source!==e.layout.source;o==="size"?Wr(f=>{const p=a?n.measuredBox[f]:n.layoutBox[f],g=Mr(p);p.min=s[f].min,p.max=p.min+g}):_F(o,n.layoutBox,s)&&Wr(f=>{const p=a?n.measuredBox[f]:n.layoutBox[f],g=Mr(s[f]);p.max=p.min+g,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[f].max=e.relativeTarget[f].min+g)});const l=hu();Tf(l,s,n.layoutBox);const c=hu();a?Tf(c,e.applyTransform(i,!0),n.measuredBox):Tf(c,s,n.layoutBox);const d=!wF(l);let h=!1;if(!e.resumeFrom){const f=e.getClosestProjectingParent();if(f&&!f.resumeFrom){const{snapshot:p,layout:g}=f;if(p&&g){const m=Mn();Af(m,n.layoutBox,p.layoutBox);const y=Mn();Af(y,s,g.layoutBox),SF(m,y)||(h=!0),f.options.layoutRoot&&(e.relativeTarget=y,e.relativeTargetOrigin=m,e.relativeParent=f)}}}e.notifyListeners("didUpdate",{layout:s,snapshot:n,delta:c,layoutDelta:l,hasLayoutChanged:d,hasRelativeTargetChanged:h})}else if(e.isLead()){const{onExitComplete:s}=e.options;s&&s()}e.options.transition=void 0}function mxe(e){pf&&Cl.totalNodes++,e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=!!(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function yxe(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function bxe(e){e.clearSnapshot()}function VA(e){e.clearMeasurements()}function xxe(e){e.isLayoutDirty=!1}function vxe(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function zA(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function Cxe(e){e.resolveTargetDelta()}function wxe(e){e.calcProjection()}function Sxe(e){e.resetSkewAndRotation()}function jxe(e){e.removeLeadSnapshot()}function GA(e,t,n){e.translate=wn(t.translate,0,n),e.scale=wn(t.scale,1,n),e.origin=t.origin,e.originPoint=t.originPoint}function HA(e,t,n,s){e.min=wn(t.min,n.min,s),e.max=wn(t.max,n.max,s)}function kxe(e,t,n,s){HA(e.x,t.x,n.x,s),HA(e.y,t.y,n.y,s)}function _xe(e){return e.animationValues&&e.animationValues.opacityExit!==void 0}const Ixe={duration:.45,ease:[.4,0,.1,1]},WA=e=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),UA=WA("applewebkit/")&&!WA("chrome/")?Math.round:Ps;function qA(e){e.min=UA(e.min),e.max=UA(e.max)}function Txe(e){qA(e.x),qA(e.y)}function _F(e,t,n){return e==="position"||e==="preserve-aspect"&&!Abe(FA(t),FA(n),.2)}function Axe(e){var t;return e!==e.root&&((t=e.scroll)===null||t===void 0?void 0:t.wasRoot)}const Exe=kF({attachResizeListener:(e,t)=>Go(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),Av={current:void 0},IF=kF({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!Av.current){const e=new Exe({});e.mount(window),e.setOptions({layoutScroll:!0}),Av.current=e}return Av.current},resetTransform:(e,t)=>{e.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:e=>window.getComputedStyle(e).position==="fixed"}),Mxe={pan:{Feature:Wbe},drag:{Feature:Hbe,ProjectionNode:IF,MeasureLayout:xF}};function KA(e,t){const n=t?"pointerenter":"pointerleave",s=t?"onHoverStart":"onHoverEnd",i=(o,a)=>{if(o.pointerType==="touch"||uF())return;const l=e.getProps();e.animationState&&l.whileHover&&e.animationState.setActive("whileHover",t);const c=l[s];c&&qt.postRender(()=>c(o,a))};return Ko(e.current,n,i,{passive:!e.getProps()[s]})}class Pxe extends al{mount(){this.unmount=qo(KA(this.node,!0),KA(this.node,!1))}unmount(){}}class Lxe extends al{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=qo(Go(this.node.current,"focus",()=>this.onFocus()),Go(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}const TF=(e,t)=>t?e===t?!0:TF(e,t.parentElement):!1;function Ev(e,t){if(!t)return;const n=new PointerEvent("pointer"+e);t(n,Ab(n))}class Dxe extends al{constructor(){super(...arguments),this.removeStartListeners=Ps,this.removeEndListeners=Ps,this.removeAccessibleListeners=Ps,this.startPointerPress=(t,n)=>{if(this.isPressing)return;this.removeEndListeners();const s=this.node.getProps(),o=Ko(window,"pointerup",(l,c)=>{if(!this.checkPressEnd())return;const{onTap:d,onTapCancel:h,globalTapTarget:f}=this.node.getProps(),p=!f&&!TF(this.node.current,l.target)?h:d;p&&qt.update(()=>p(l,c))},{passive:!(s.onTap||s.onPointerUp)}),a=Ko(window,"pointercancel",(l,c)=>this.cancelPress(l,c),{passive:!(s.onTapCancel||s.onPointerCancel)});this.removeEndListeners=qo(o,a),this.startPress(t,n)},this.startAccessiblePress=()=>{const t=o=>{if(o.key!=="Enter"||this.isPressing)return;const a=l=>{l.key!=="Enter"||!this.checkPressEnd()||Ev("up",(c,d)=>{const{onTap:h}=this.node.getProps();h&&qt.postRender(()=>h(c,d))})};this.removeEndListeners(),this.removeEndListeners=Go(this.node.current,"keyup",a),Ev("down",(l,c)=>{this.startPress(l,c)})},n=Go(this.node.current,"keydown",t),s=()=>{this.isPressing&&Ev("cancel",(o,a)=>this.cancelPress(o,a))},i=Go(this.node.current,"blur",s);this.removeAccessibleListeners=qo(n,i)}}startPress(t,n){this.isPressing=!0;const{onTapStart:s,whileTap:i}=this.node.getProps();i&&this.node.animationState&&this.node.animationState.setActive("whileTap",!0),s&&qt.postRender(()=>s(t,n))}checkPressEnd(){return this.removeEndListeners(),this.isPressing=!1,this.node.getProps().whileTap&&this.node.animationState&&this.node.animationState.setActive("whileTap",!1),!uF()}cancelPress(t,n){if(!this.checkPressEnd())return;const{onTapCancel:s}=this.node.getProps();s&&qt.postRender(()=>s(t,n))}mount(){const t=this.node.getProps(),n=Ko(t.globalTapTarget?window:this.node.current,"pointerdown",this.startPointerPress,{passive:!(t.onTapStart||t.onPointerStart)}),s=Go(this.node.current,"focus",this.startAccessiblePress);this.removeStartListeners=qo(n,s)}unmount(){this.removeStartListeners(),this.removeEndListeners(),this.removeAccessibleListeners()}}const XC=new WeakMap,Mv=new WeakMap,Rxe=e=>{const t=XC.get(e.target);t&&t(e)},Oxe=e=>{e.forEach(Rxe)};function Nxe({root:e,...t}){const n=e||document;Mv.has(n)||Mv.set(n,{});const s=Mv.get(n),i=JSON.stringify(t);return s[i]||(s[i]=new IntersectionObserver(Oxe,{root:e,...t})),s[i]}function Fxe(e,t,n){const s=Nxe(t);return XC.set(e,n),s.observe(e),()=>{XC.delete(e),s.unobserve(e)}}const Bxe={some:0,all:1};class $xe extends al{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:n,margin:s,amount:i="some",once:o}=t,a={root:n?n.current:void 0,rootMargin:s,threshold:typeof i=="number"?i:Bxe[i]},l=c=>{const{isIntersecting:d}=c;if(this.isInView===d||(this.isInView=d,o&&!d&&this.hasEnteredView))return;d&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",d);const{onViewportEnter:h,onViewportLeave:f}=this.node.getProps(),p=d?h:f;p&&p(c)};return Fxe(this.node.current,a,l)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:n}=this.node;["amount","margin","root"].some(Vxe(t,n))&&this.startObserver()}unmount(){}}function Vxe({viewport:e={}},{viewport:t={}}={}){return n=>e[n]!==t[n]}const zxe={inView:{Feature:$xe},tap:{Feature:Dxe},focus:{Feature:Lxe},hover:{Feature:Pxe}},Gxe={layout:{ProjectionNode:IF,MeasureLayout:xF}},Kk=u.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"}),Mb=u.createContext({}),Zk=typeof window<"u",AF=Zk?u.useLayoutEffect:u.useEffect,EF=u.createContext({strict:!1});let ZA=!1;function Hxe(e,t,n,s,i){var o;const{visualElement:a}=u.useContext(Mb),l=u.useContext(EF),c=u.useContext(Eb),d=u.useContext(Kk).reducedMotion,h=u.useRef();s=s||l.renderer,!h.current&&s&&(h.current=s(e,{visualState:t,parent:a,props:n,presenceContext:c,blockInitialAnimation:c?c.initial===!1:!1,reducedMotionConfig:d}));const f=h.current,p=u.useContext(bF);f&&!f.projection&&i&&(f.type==="html"||f.type==="svg")&&Uxe(h.current,n,i,p),u.useInsertionEffect(()=>{f&&f.update(n,c)});const g=n[eF],m=u.useRef(!!g&&!window.MotionHandoffIsComplete&&((o=window.MotionHasOptimisedAnimation)===null||o===void 0?void 0:o.call(window,g)));return AF(()=>{f&&(f.updateFeatures(),qk.render(f.render),m.current&&f.animationState&&f.animationState.animateChanges())}),u.useEffect(()=>{f&&(!m.current&&f.animationState&&f.animationState.animateChanges(),m.current=!1,ZA||(ZA=!0,queueMicrotask(Wxe)))}),f}function Wxe(){window.MotionHandoffIsComplete=!0}function Uxe(e,t,n,s){const{layoutId:i,layout:o,drag:a,dragConstraints:l,layoutScroll:c,layoutRoot:d}=t;e.projection=new n(e.latestValues,t["data-framer-portal-id"]?void 0:MF(e.parent)),e.projection.setOptions({layoutId:i,layout:o,alwaysMeasureLayout:!!a||l&&du(l),visualElement:e,animationType:typeof o=="string"?o:"both",initialPromotionConfig:s,layoutScroll:c,layoutRoot:d})}function MF(e){if(e)return e.options.allowProjection!==!1?e.projection:MF(e.parent)}function qxe(e,t,n){return u.useCallback(s=>{s&&e.mount&&e.mount(s),t&&(s?t.mount(s):t.unmount()),n&&(typeof n=="function"?n(s):du(n)&&(n.current=s))},[t])}function Pb(e){return rp(e.animate)||Tk.some(t=>ip(e[t]))}function PF(e){return!!(Pb(e)||e.variants)}function Kxe(e,t){if(Pb(e)){const{initial:n,animate:s}=e;return{initial:n===!1||ip(n)?n:void 0,animate:ip(s)?s:void 0}}return e.inherit!==!1?t:{}}function Zxe(e){const{initial:t,animate:n}=Kxe(e,u.useContext(Mb));return u.useMemo(()=>({initial:t,animate:n}),[YA(t),YA(n)])}function YA(e){return Array.isArray(e)?e.join(" "):e}const XA={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Uu={};for(const e in XA)Uu[e]={isEnabled:t=>XA[e].some(n=>!!t[n])};function Yxe(e){for(const t in e)Uu[t]={...Uu[t],...e[t]}}const Xxe=Symbol.for("motionComponentSymbol");function Qxe({preloadedFeatures:e,createVisualElement:t,useRender:n,useVisualState:s,Component:i}){e&&Yxe(e);function o(l,c){let d;const h={...u.useContext(Kk),...l,layoutId:Jxe(l)},{isStatic:f}=h,p=Zxe(l),g=s(l,f);if(!f&&Zk){eve();const m=tve(h);d=m.MeasureLayout,p.visualElement=Hxe(i,g,h,t,m.ProjectionNode)}return r.jsxs(Mb.Provider,{value:p,children:[d&&p.visualElement?r.jsx(d,{visualElement:p.visualElement,...h}):null,n(i,l,qxe(g,p.visualElement,c),g,f,p.visualElement)]})}const a=u.forwardRef(o);return a[Xxe]=i,a}function Jxe({layoutId:e}){const t=u.useContext(Uk).id;return t&&e!==void 0?t+"-"+e:e}function eve(e,t){u.useContext(EF).strict}function tve(e){const{drag:t,layout:n}=Uu;if(!t&&!n)return{};const s={...t,...n};return{MeasureLayout:t!=null&&t.isEnabled(e)||n!=null&&n.isEnabled(e)?s.MeasureLayout:void 0,ProjectionNode:s.ProjectionNode}}const nve=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function Yk(e){return typeof e!="string"||e.includes("-")?!1:!!(nve.indexOf(e)>-1||/[A-Z]/u.test(e))}function LF(e,{style:t,vars:n},s,i){Object.assign(e.style,t,i&&i.getProjectionStyles(s));for(const o in n)e.style.setProperty(o,n[o])}const DF=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function RF(e,t,n,s){LF(e,t,void 0,s);for(const i in t.attrs)e.setAttribute(DF.has(i)?i:Tb(i),t.attrs[i])}function OF(e,{layout:t,layoutId:n}){return ol.has(e)||e.startsWith("origin")||(t||n!==void 0)&&(!!m1[e]||e==="opacity")}function Xk(e,t,n){var s;const{style:i}=e,o={};for(const a in i)(_s(i[a])||t.style&&_s(t.style[a])||OF(a,e)||((s=n==null?void 0:n.getValue(a))===null||s===void 0?void 0:s.liveStyle)!==void 0)&&(o[a]=i[a]);return n&&i&&typeof i.willChange=="string"&&(n.applyWillChange=!1),o}function NF(e,t,n){const s=Xk(e,t,n);for(const i in e)if(_s(e[i])||_s(t[i])){const o=xg.indexOf(i)!==-1?"attr"+i.charAt(0).toUpperCase()+i.substring(1):i;s[o]=e[i]}return s}function Qk(e){const t=u.useRef(null);return t.current===null&&(t.current=e()),t.current}function sve({applyWillChange:e=!1,scrapeMotionValuesFromProps:t,createRenderState:n,onMount:s},i,o,a,l){const c={latestValues:rve(i,o,a,l?!1:e,t),renderState:n()};return s&&(c.mount=d=>s(i,d,c)),c}const FF=e=>(t,n)=>{const s=u.useContext(Mb),i=u.useContext(Eb),o=()=>sve(e,t,s,i,n);return n?o():Qk(o)};function QA(e,t,n){const s=Array.isArray(t)?t:[t];for(let i=0;i<s.length;i++){const o=_k(e,s[i]);if(o){const{transitionEnd:a,transition:l,...c}=o;n(c,a)}}}function rve(e,t,n,s,i){var o;const a={};let l=s&&((o=e.style)===null||o===void 0?void 0:o.willChange)===void 0;const c=i(e,{});for(const y in c)a[y]=C0(c[y]);let{initial:d,animate:h}=e;const f=Pb(e),p=PF(e);t&&p&&!f&&e.inherit!==!1&&(d===void 0&&(d=t.initial),h===void 0&&(h=t.animate));let g=n?n.initial===!1:!1;g=g||d===!1;const m=g?h:d;return m&&typeof m!="boolean"&&!rp(m)&&QA(e,m,(y,b)=>{for(const C in y){let x=y[C];if(Array.isArray(x)){const v=g?x.length-1:0;x=x[v]}x!==null&&(a[C]=x)}for(const C in b)a[C]=b[C]}),l&&h&&d!==!1&&!rp(h)&&QA(e,h,y=>{for(const b in y)if(nF(b)){a.willChange="transform";return}}),a}const Jk=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),BF=()=>({...Jk(),attrs:{}}),$F=(e,t)=>t&&typeof e=="number"?t.transform(e):e,ive={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},ove=xg.length;function ave(e,t,n){let s="",i=!0;for(let o=0;o<ove;o++){const a=xg[o],l=e[a];if(l===void 0)continue;let c=!0;if(typeof l=="number"?c=l===(a.startsWith("scale")?1:0):c=parseFloat(l)===0,!c||n){const d=$F(l,Ok[a]);if(!c){i=!1;const h=ive[a]||a;s+=`${h}(${d}) `}n&&(t[a]=d)}}return s=s.trim(),n?s=n(t,i?"":s):i&&(s="none"),s}function e_(e,t,n){const{style:s,vars:i,transformOrigin:o}=e;let a=!1,l=!1;for(const c in t){const d=t[c];if(ol.has(c)){a=!0;continue}else if(AN(c)){i[c]=d;continue}else{const h=$F(d,Ok[c]);c.startsWith("origin")?(l=!0,o[c]=h):s[c]=h}}if(t.transform||(a||n?s.transform=ave(t,e.transform,n):s.transform&&(s.transform="none")),l){const{originX:c="50%",originY:d="50%",originZ:h=0}=o;s.transformOrigin=`${c} ${d} ${h}`}}function JA(e,t,n){return typeof e=="string"?e:st.transform(t+n*e)}function lve(e,t,n){const s=JA(t,e.x,e.width),i=JA(n,e.y,e.height);return`${s} ${i}`}const cve={offset:"stroke-dashoffset",array:"stroke-dasharray"},uve={offset:"strokeDashoffset",array:"strokeDasharray"};function dve(e,t,n=1,s=0,i=!0){e.pathLength=1;const o=i?cve:uve;e[o.offset]=st.transform(-s);const a=st.transform(t),l=st.transform(n);e[o.array]=`${a} ${l}`}function t_(e,{attrX:t,attrY:n,attrScale:s,originX:i,originY:o,pathLength:a,pathSpacing:l=1,pathOffset:c=0,...d},h,f){if(e_(e,d,f),h){e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox);return}e.attrs=e.style,e.style={};const{attrs:p,style:g,dimensions:m}=e;p.transform&&(m&&(g.transform=p.transform),delete p.transform),m&&(i!==void 0||o!==void 0||g.transform)&&(g.transformOrigin=lve(m,i!==void 0?i:.5,o!==void 0?o:.5)),t!==void 0&&(p.x=t),n!==void 0&&(p.y=n),s!==void 0&&(p.scale=s),a!==void 0&&dve(p,a,l,c,!1)}const n_=e=>typeof e=="string"&&e.toLowerCase()==="svg",hve={useVisualState:FF({scrapeMotionValuesFromProps:NF,createRenderState:BF,onMount:(e,t,{renderState:n,latestValues:s})=>{qt.read(()=>{try{n.dimensions=typeof t.getBBox=="function"?t.getBBox():t.getBoundingClientRect()}catch{n.dimensions={x:0,y:0,width:0,height:0}}}),qt.render(()=>{t_(n,s,n_(t.tagName),e.transformTemplate),RF(t,n)})}})},fve={useVisualState:FF({applyWillChange:!0,scrapeMotionValuesFromProps:Xk,createRenderState:Jk})};function VF(e,t,n){for(const s in t)!_s(t[s])&&!OF(s,n)&&(e[s]=t[s])}function pve({transformTemplate:e},t){return u.useMemo(()=>{const n=Jk();return e_(n,t,e),Object.assign({},n.vars,n.style)},[t])}function gve(e,t){const n=e.style||{},s={};return VF(s,n,e),Object.assign(s,pve(e,t)),s}function mve(e,t){const n={},s=gve(e,t);return e.drag&&e.dragListener!==!1&&(n.draggable=!1,s.userSelect=s.WebkitUserSelect=s.WebkitTouchCallout="none",s.touchAction=e.drag===!0?"none":`pan-${e.drag==="x"?"y":"x"}`),e.tabIndex===void 0&&(e.onTap||e.onTapStart||e.whileTap)&&(n.tabIndex=0),n.style=s,n}const yve=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function y1(e){return e.startsWith("while")||e.startsWith("drag")&&e!=="draggable"||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||yve.has(e)}let zF=e=>!y1(e);function bve(e){e&&(zF=t=>t.startsWith("on")?!y1(t):e(t))}try{bve(require("@emotion/is-prop-valid").default)}catch{}function xve(e,t,n){const s={};for(const i in e)i==="values"&&typeof e.values=="object"||(zF(i)||n===!0&&y1(i)||!t&&!y1(i)||e.draggable&&i.startsWith("onDrag"))&&(s[i]=e[i]);return s}function vve(e,t,n,s){const i=u.useMemo(()=>{const o=BF();return t_(o,t,n_(s),e.transformTemplate),{...o.attrs,style:{...o.style}}},[t]);if(e.style){const o={};VF(o,e.style,e),i.style={...o,...i.style}}return i}function Cve(e=!1){return(n,s,i,{latestValues:o},a)=>{const c=(Yk(n)?vve:mve)(s,o,a,n),d=xve(s,typeof n=="string",e),h=n!==u.Fragment?{...d,...c,ref:i}:{},{children:f}=s,p=u.useMemo(()=>_s(f)?f.get():f,[f]);return u.createElement(n,{...h,children:p})}}function wve(e,t){return function(s,{forwardMotionProps:i}={forwardMotionProps:!1}){const a={...Yk(s)?hve:fve,preloadedFeatures:e,useRender:Cve(i),createVisualElement:t,Component:s};return Qxe(a)}}const QC={current:null},GF={current:!1};function Sve(){if(GF.current=!0,!!Zk)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>QC.current=e.matches;e.addListener(t),t()}else QC.current=!1}function jve(e,t,n){for(const s in t){const i=t[s],o=n[s];if(_s(i))e.addValue(s,i);else if(_s(o))e.addValue(s,lp(i,{owner:e}));else if(o!==i)if(e.hasValue(s)){const a=e.getValue(s);a.liveStyle===!0?a.jump(i):a.hasAnimated||a.set(i)}else{const a=e.getStaticValue(s);e.addValue(s,lp(a!==void 0?a:i,{owner:e}))}}for(const s in n)t[s]===void 0&&e.removeValue(s);return t}const eE=new WeakMap,kve=[...PN,ws,Ka],_ve=e=>kve.find(MN(e)),tE=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class Ive{scrapeMotionValuesFromProps(t,n,s){return{}}constructor({parent:t,props:n,presenceContext:s,reducedMotionConfig:i,blockInitialAnimation:o,visualState:a},l={}){this.applyWillChange=!1,this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=Lk,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const p=oo.now();this.renderScheduledAt<p&&(this.renderScheduledAt=p,qt.render(this.render,!1,!0))};const{latestValues:c,renderState:d}=a;this.latestValues=c,this.baseTarget={...c},this.initialValues=n.initial?{...c}:{},this.renderState=d,this.parent=t,this.props=n,this.presenceContext=s,this.depth=t?t.depth+1:0,this.reducedMotionConfig=i,this.options=l,this.blockInitialAnimation=!!o,this.isControllingVariants=Pb(n),this.isVariantNode=PF(n),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:h,...f}=this.scrapeMotionValuesFromProps(n,{},this);for(const p in f){const g=f[p];c[p]!==void 0&&_s(g)&&g.set(c[p],!1)}}mount(t){this.current=t,eE.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((n,s)=>this.bindToMotionValue(s,n)),GF.current||Sve(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:QC.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){eE.delete(this.current),this.projection&&this.projection.unmount(),Ua(this.notifyUpdate),Ua(this.render),this.valueSubscriptions.forEach(t=>t()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const t in this.events)this.events[t].clear();for(const t in this.features){const n=this.features[t];n&&(n.unmount(),n.isMounted=!1)}this.current=null}bindToMotionValue(t,n){this.valueSubscriptions.has(t)&&this.valueSubscriptions.get(t)();const s=ol.has(t),i=n.on("change",l=>{this.latestValues[t]=l,this.props.onUpdate&&qt.preRender(this.notifyUpdate),s&&this.projection&&(this.projection.isTransformDirty=!0)}),o=n.on("renderRequest",this.scheduleRender);let a;window.MotionCheckAppearSync&&(a=window.MotionCheckAppearSync(this,t,n)),this.valueSubscriptions.set(t,()=>{i(),o(),a&&a(),n.owner&&n.stop()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}updateFeatures(){let t="animation";for(t in Uu){const n=Uu[t];if(!n)continue;const{isEnabled:s,Feature:i}=n;if(!this.features[t]&&i&&s(this.props)&&(this.features[t]=new i(this)),this.features[t]){const o=this.features[t];o.isMounted?o.update():(o.mount(),o.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Mn()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,n){this.latestValues[t]=n}update(t,n){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=n;for(let s=0;s<tE.length;s++){const i=tE[s];this.propEventSubscriptions[i]&&(this.propEventSubscriptions[i](),delete this.propEventSubscriptions[i]);const o="on"+i,a=t[o];a&&(this.propEventSubscriptions[i]=this.on(i,a))}this.prevMotionValues=jve(this,this.scrapeMotionValuesFromProps(t,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(t){const n=this.getClosestVariantNode();if(n)return n.variantChildren&&n.variantChildren.add(t),()=>n.variantChildren.delete(t)}addValue(t,n){const s=this.values.get(t);n!==s&&(s&&this.removeValue(t),this.bindToMotionValue(t,n),this.values.set(t,n),this.latestValues[t]=n.get())}removeValue(t){this.values.delete(t);const n=this.valueSubscriptions.get(t);n&&(n(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,n){if(this.props.values&&this.props.values[t])return this.props.values[t];let s=this.values.get(t);return s===void 0&&n!==void 0&&(s=lp(n===null?void 0:n,{owner:this}),this.addValue(t,s)),s}readValue(t,n){var s;let i=this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:(s=this.getBaseTargetFromProps(this.props,t))!==null&&s!==void 0?s:this.readValueFromInstance(this.current,t,this.options);return i!=null&&(typeof i=="string"&&(IN(i)||kN(i))?i=parseFloat(i):!_ve(i)&&Ka.test(n)&&(i=$N(t,n)),this.setBaseTarget(t,_s(i)?i.get():i)),_s(i)?i.get():i}setBaseTarget(t,n){this.baseTarget[t]=n}getBaseTarget(t){var n;const{initial:s}=this.props;let i;if(typeof s=="string"||typeof s=="object"){const a=_k(this.props,s,(n=this.presenceContext)===null||n===void 0?void 0:n.custom);a&&(i=a[t])}if(s&&i!==void 0)return i;const o=this.getBaseTargetFromProps(this.props,t);return o!==void 0&&!_s(o)?o:this.initialValues[t]!==void 0&&i===void 0?void 0:this.baseTarget[t]}on(t,n){return this.events[t]||(this.events[t]=new Wk),this.events[t].add(n)}notify(t,...n){this.events[t]&&this.events[t].notify(...n)}}class HF extends Ive{constructor(){super(...arguments),this.KeyframeResolver=VN}sortInstanceNodePosition(t,n){return t.compareDocumentPosition(n)&2?1:-1}getBaseTargetFromProps(t,n){return t.style?t.style[n]:void 0}removeValueFromRenderState(t,{vars:n,style:s}){delete n[t],delete s[t]}}function Tve(e){return window.getComputedStyle(e)}class Ave extends HF{constructor(){super(...arguments),this.type="html",this.applyWillChange=!0,this.renderInstance=LF}readValueFromInstance(t,n){if(ol.has(n)){const s=Nk(n);return s&&s.default||0}else{const s=Tve(t),i=(AN(n)?s.getPropertyValue(n):s[n])||0;return typeof i=="string"?i.trim():i}}measureInstanceViewportBox(t,{transformPagePoint:n}){return mF(t,n)}build(t,n,s){e_(t,n,s.transformTemplate)}scrapeMotionValuesFromProps(t,n,s){return Xk(t,n,s)}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;_s(t)&&(this.childSubscription=t.on("change",n=>{this.current&&(this.current.textContent=`${n}`)}))}}class Eve extends HF{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Mn}getBaseTargetFromProps(t,n){return t[n]}readValueFromInstance(t,n){if(ol.has(n)){const s=Nk(n);return s&&s.default||0}return n=DF.has(n)?n:Tb(n),t.getAttribute(n)}scrapeMotionValuesFromProps(t,n,s){return NF(t,n,s)}build(t,n,s){t_(t,n,this.isSVGTag,s.transformTemplate)}renderInstance(t,n,s,i){RF(t,n,s,i)}mount(t){this.isSVGTag=n_(t.tagName),super.mount(t)}}const Mve=(e,t)=>Yk(e)?new Eve(t):new Ave(t,{allowProjection:e!==u.Fragment}),Pve=wve({...vbe,...zxe,...Mxe,...Gxe},Mve),s_=d1e(Pve);class Lve extends u.Component{getSnapshotBeforeUpdate(t){const n=this.props.childRef.current;if(n&&t.isPresent&&!this.props.isPresent){const s=this.props.sizeRef.current;s.height=n.offsetHeight||0,s.width=n.offsetWidth||0,s.top=n.offsetTop,s.left=n.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function Dve({children:e,isPresent:t}){const n=u.useId(),s=u.useRef(null),i=u.useRef({width:0,height:0,top:0,left:0}),{nonce:o}=u.useContext(Kk);return u.useInsertionEffect(()=>{const{width:a,height:l,top:c,left:d}=i.current;if(t||!s.current||!a||!l)return;s.current.dataset.motionPopId=n;const h=document.createElement("style");return o&&(h.nonce=o),document.head.appendChild(h),h.sheet&&h.sheet.insertRule(`
          [data-motion-pop-id="${n}"] {
            position: absolute !important;
            width: ${a}px !important;
            height: ${l}px !important;
            top: ${c}px !important;
            left: ${d}px !important;
          }
        `),()=>{document.head.removeChild(h)}},[t]),r.jsx(Lve,{isPresent:t,childRef:s,sizeRef:i,children:u.cloneElement(e,{ref:s})})}const Rve=({children:e,initial:t,isPresent:n,onExitComplete:s,custom:i,presenceAffectsLayout:o,mode:a})=>{const l=Qk(Ove),c=u.useId(),d=u.useMemo(()=>({id:c,initial:t,isPresent:n,custom:i,onExitComplete:h=>{l.set(h,!0);for(const f of l.values())if(!f)return;s&&s()},register:h=>(l.set(h,!1),()=>l.delete(h))}),o?[Math.random()]:[n]);return u.useMemo(()=>{l.forEach((h,f)=>l.set(f,!1))},[n]),u.useEffect(()=>{!n&&!l.size&&s&&s()},[n]),a==="popLayout"&&(e=r.jsx(Dve,{isPresent:n,children:e})),r.jsx(Eb.Provider,{value:d,children:e})};function Ove(){return new Map}const Sm=e=>e.key||"";function nE(e){const t=[];return u.Children.forEach(e,n=>{u.isValidElement(n)&&t.push(n)}),t}const WF=({children:e,exitBeforeEnter:t,custom:n,initial:s=!0,onExitComplete:i,presenceAffectsLayout:o=!0,mode:a="sync"})=>{const l=u.useMemo(()=>nE(e),[e]),c=l.map(Sm),d=u.useRef(!0),h=u.useRef(l),f=Qk(()=>new Map),[p,g]=u.useState(l),[m,y]=u.useState(l);AF(()=>{d.current=!1,h.current=l;for(let x=0;x<m.length;x++){const v=Sm(m[x]);c.includes(v)?f.delete(v):f.get(v)!==!0&&f.set(v,!1)}},[m,c.length,c.join("-")]);const b=[];if(l!==p){let x=[...l];for(let v=0;v<m.length;v++){const w=m[v],S=Sm(w);c.includes(S)||(x.splice(v,0,w),b.push(w))}a==="wait"&&b.length&&(x=b),y(nE(x)),g(l);return}const{forceRender:C}=u.useContext(Uk);return r.jsx(r.Fragment,{children:m.map(x=>{const v=Sm(x),w=l===m||c.includes(v),S=()=>{if(f.has(v))f.set(v,!0);else return;let j=!0;f.forEach(P=>{P||(j=!1)}),j&&(C==null||C(),y(h.current),i&&i())};return r.jsx(Rve,{isPresent:w,initial:!d.current||s?void 0:!1,custom:w?void 0:n,presenceAffectsLayout:o,mode:a,onExitComplete:w?void 0:S,children:x},v)})})},Nve=e=>{const t=Nt(),n=G(),s=u.useCallback(()=>{t.open(),n(jr("gallery"))},[t,n]);return r.jsx(de,{onClick:s,size:"sm",variant:"link",color:"base.50",children:e.children})},Fve=()=>{const{t:e}=A(),t=kk(),n=I(An),s=u.useMemo(()=>n!=="canvas"||!t?!1:t==="gallery",[t,n]);return r.jsx(UF,{title:e("controlLayers.sendingToGallery"),description:r.jsx(Ut,{i18nKey:"controlLayers.viewProgressInViewer",components:{Btn:r.jsx(Nve,{})}}),isVisible:s})},Bve=e=>{const t=G(),n=Nt(),s=u.useCallback(()=>{t(Qt("canvas")),t(jr("layers")),n.close()},[t,n]);return r.jsx(de,{onClick:s,size:"sm",variant:"link",color:"base.50",children:e.children})},$ve=()=>{const{t:e}=A(),t=kk(),n=I(Fn),s=I(An),i=u.useMemo(()=>s!=="canvas"&&t!=="canvas"?!1:n?!0:t?t==="canvas":!1,[t,n,s]);return r.jsx(UF,{title:e("controlLayers.sendingToCanvas"),description:r.jsx(Ut,{i18nKey:"controlLayers.viewProgressOnCanvas",components:{Btn:r.jsx(Bve,{})}}),isVisible:i})},UF=({title:e,description:t,isVisible:n})=>{const s=Ty(!1);return r.jsx(WF,{children:(n||s.isTrue)&&r.jsx(s_.div,{initial:{opacity:0},animate:{opacity:1,transition:{duration:.1,ease:"easeOut"}},exit:{opacity:0,transition:{duration:.1,delay:s.isTrue?.1:1,ease:"easeIn"}},onMouseEnter:s.setTrue,onMouseLeave:s.setFalse,children:r.jsxs(ac,{status:"warning",flexDir:"column",pointerEvents:"auto",borderRadius:"base",fontSize:"sm",shadow:"md",w:"fit-content",children:[r.jsxs(T,{w:"full",alignItems:"center",children:[r.jsx(lc,{}),r.jsx($p,{children:e})]}),r.jsx(Ta,{children:t})]})})})},qF=u.memo(()=>{const{t:e}=A(),t=ut(),n=Lt(),s=u.useCallback(async()=>{const i=n.getAllAdapters();for(const o of i)await o.cropToBbox()},[n]);return r.jsx(pe,{icon:r.jsx(zR,{}),isDisabled:t,onClick:s,children:e("controlLayers.canvasContextMenu.cropCanvasToBbox")})});qF.displayName="CanvasContextMenuItemsCropCanvasToBbox";const b1=$n("canvas"),Vve=()=>{const{t:e}=A(),t=il();return u.useCallback(async s=>{if(s)try{const i=s.getCanvas(),o=await Ay(i);t.writeImage(o,()=>{b1.trace("Layer copied to clipboard"),ge({status:"info",title:e("toast.layerCopiedToClipboard")})})}catch(i){b1.error({error:Un(i)},"Problem copying layer to clipboard"),ge({status:"error",title:e("toast.problemCopyingLayer")})}},[t,e])},sE=e=>{const{t}=A(),n=il(),s=Lt();return u.useCallback(async()=>{const o=e==="bbox"?s.stateApi.getBbox().rect:s.compositor.getVisibleRectOfType("raster_layer");if(o.width===0||o.height===0){ge({title:t("controlLayers.copyRegionError",{region:r0(e)}),description:t("controlLayers.regionIsEmpty"),status:"warning"});return}try{const a=s.compositor.getVisibleAdaptersOfType("raster_layer"),l=s.compositor.getCompositeCanvas(a,o),c=await Ay(l);n.writeImage(c,()=>{b1.trace("Region copied to clipboard"),ge({title:t("controlLayers.regionCopiedToClipboard",{region:r0(e)})})})}catch(a){b1.error({error:Un(a)},"Failed to save canvas to gallery"),ge({title:t("controlLayers.copyRegionError",{region:r0(e)}),status:"error"})}},[s.compositor,s.stateApi,n,e,t])},zve=$n("canvas"),ia=({region:e,saveToGallery:t,toastOk:n,toastError:s,onSave:i,withMetadata:o})=>{const{t:a}=A(),l=gc(),c=Lt();return u.useCallback(async()=>{const h=e==="bbox"?c.stateApi.getBbox().rect:c.compositor.getVisibleRectOfType("raster_layer");if(h.width===0||h.height===0){ge({title:s,description:a("controlLayers.regionIsEmpty"),status:"warning"});return}let f;const p=l.getState();if(o){f=$Q(p),f.positive_prompt=JM(p),f.negative_prompt=eP(p),f.seed=tP(p);const y=Jw(p);y&&(f.model=Qn.getModelMetadataField(y))}let g;t&&(g=Hs(p));const m=await fs(()=>{const y=c.compositor.getVisibleAdaptersOfType("raster_layer");return c.compositor.getCompositeImageDTO(y,h,{is_intermediate:!t,metadata:f,board_id:g,silent:!0},void 0,!0)});m.isOk()?(i&&i(m.value,h),ge({title:n})):(zve.error({error:Un(m.error)},"Failed to save canvas to gallery"),ge({title:s,status:"error"}))},[c.compositor,c.stateApi,i,e,t,l,a,s,n,o])},KF=()=>{const{t:e}=A(),t=u.useMemo(()=>({region:"canvas",saveToGallery:!0,toastOk:e("controlLayers.savedToGalleryOk"),toastError:e("controlLayers.savedToGalleryError"),withMetadata:!0}),[e]);return ia(t)},ZF=()=>{const{t:e}=A(),t=u.useMemo(()=>({region:"bbox",saveToGallery:!0,toastOk:e("controlLayers.savedToGalleryOk"),toastError:e("controlLayers.savedToGalleryError"),withMetadata:!0}),[e]);return ia(t)},Gve=()=>{const{t:e}=A(),t=G(),n=I(Jo),s=u.useMemo(()=>({region:"bbox",saveToGallery:!1,onSave:a=>{const c={referenceImages:[{id:Te("regional_guidance_reference_image"),ipAdapter:{...gt(n),image:Wl(a)}}]};t(Va({overrides:c,isSelected:!0}))},toastOk:e("controlLayers.newRegionalReferenceImageOk"),toastError:e("controlLayers.newRegionalReferenceImageError")}),[n,t,e]);return ia(s)},Hve=()=>{const{t:e}=A(),t=G(),n=I(Jo),s=u.useMemo(()=>({region:"bbox",saveToGallery:!1,onSave:a=>{const l={ipAdapter:{...gt(n),image:Wl(a)}};t(wy({overrides:l,isSelected:!0}))},toastOk:e("controlLayers.newGlobalReferenceImageOk"),toastError:e("controlLayers.newGlobalReferenceImageError")}),[n,t,e]);return ia(s)},Wve=()=>{const{t:e}=A(),t=G(),n=u.useMemo(()=>({region:"bbox",saveToGallery:!1,onSave:(o,a)=>{const l={objects:[Mi(o)],position:{x:a.x,y:a.y}};t(id({overrides:l,isSelected:!0}))},toastOk:e("controlLayers.newRasterLayerOk"),toastError:e("controlLayers.newRasterLayerError")}),[t,e]);return ia(n)},Uve=()=>{const{t:e}=A(),t=G(),n=u.useMemo(()=>({region:"bbox",saveToGallery:!1,onSave:(o,a)=>{const l={objects:[Mi(o)],controlAdapter:gt(uc),position:{x:a.x,y:a.y}};t(Dp({overrides:l,isSelected:!0}))},toastOk:e("controlLayers.newControlLayerOk"),toastError:e("controlLayers.newControlLayerError")}),[t,e]);return ia(n)},qve=e=>{const{t}=A(),n=G(),s=u.useMemo(()=>({region:"bbox",saveToGallery:!1,onSave:(a,l)=>{n(dS({entityIdentifier:e,position:{x:l.x,y:l.y},imageObject:Mi(a),replaceObjects:!0}))},toastOk:t("controlLayers.pullBboxIntoLayerOk"),toastError:t("controlLayers.pullBboxIntoLayerError")}),[n,e,t]);return ia(s)},r_=e=>{const{t}=A(),n=G(),s=u.useMemo(()=>({region:"bbox",saveToGallery:!1,onSave:(a,l)=>{n(cS({entityIdentifier:e,imageDTO:a}))},toastOk:t("controlLayers.pullBboxIntoReferenceImageOk"),toastError:t("controlLayers.pullBboxIntoReferenceImageError")}),[n,e,t]);return ia(s)},YF=(e,t)=>{const{t:n}=A(),s=G(),i=u.useMemo(()=>({region:"bbox",saveToGallery:!1,onSave:(l,c)=>{s(uS({entityIdentifier:e,referenceImageId:t,imageDTO:l}))},toastOk:n("controlLayers.pullBboxIntoReferenceImageOk"),toastError:n("controlLayers.pullBboxIntoReferenceImageError")}),[s,e,t,n]);return ia(i)},XF=u.memo(()=>{const{t:e}=A(),t=rr(),n=rr(),s=rr(),i=ut(),o=KF(),a=ZF(),l=Gve(),c=Hve(),d=Wve(),h=Uve(),f=sE("canvas"),p=sE("bbox");return r.jsx(r.Fragment,{children:r.jsxs(Sr,{title:e("controlLayers.canvasContextMenu.canvasGroup"),children:[r.jsx(qF,{}),r.jsx(pe,{...t.parentMenuItemProps,icon:r.jsx(so,{}),children:r.jsxs(en,{...t.menuProps,children:[r.jsx(tn,{...t.menuButtonProps,children:r.jsx(ir,{label:e("controlLayers.canvasContextMenu.saveToGalleryGroup")})}),r.jsxs(Tt,{...t.menuListProps,children:[r.jsx(pe,{icon:r.jsx(so,{}),isDisabled:i,onClick:o,children:e("controlLayers.canvasContextMenu.saveCanvasToGallery")}),r.jsx(pe,{icon:r.jsx(so,{}),isDisabled:i,onClick:a,children:e("controlLayers.canvasContextMenu.saveBboxToGallery")})]})]})}),r.jsx(pe,{...n.parentMenuItemProps,icon:r.jsx(js,{}),children:r.jsxs(en,{...n.menuProps,children:[r.jsx(tn,{...n.menuButtonProps,children:r.jsx(ir,{label:e("controlLayers.canvasContextMenu.bboxGroup")})}),r.jsxs(Tt,{...n.menuListProps,children:[r.jsx(pe,{icon:r.jsx(js,{}),isDisabled:i,onClick:c,children:e("controlLayers.canvasContextMenu.newGlobalReferenceImage")}),r.jsx(pe,{icon:r.jsx(js,{}),isDisabled:i,onClick:l,children:e("controlLayers.canvasContextMenu.newRegionalReferenceImage")}),r.jsx(pe,{icon:r.jsx(js,{}),isDisabled:i,onClick:h,children:e("controlLayers.canvasContextMenu.newControlLayer")}),r.jsx(pe,{icon:r.jsx(js,{}),isDisabled:i,onClick:d,children:e("controlLayers.canvasContextMenu.newRasterLayer")})]})]})}),r.jsx(pe,{...s.parentMenuItemProps,icon:r.jsx(un,{}),children:r.jsxs(en,{...s.menuProps,children:[r.jsx(tn,{...s.menuButtonProps,children:r.jsx(ir,{label:e("controlLayers.canvasContextMenu.copyToClipboard")})}),r.jsxs(Tt,{...s.menuListProps,children:[r.jsx(pe,{icon:r.jsx(un,{}),isDisabled:i,onClick:f,children:e("controlLayers.canvasContextMenu.copyCanvasToClipboard")}),r.jsx(pe,{icon:r.jsx(un,{}),isDisabled:i,onClick:p,children:e("controlLayers.canvasContextMenu.copyBboxToClipboard")})]})]})})]})})});XF.displayName="CanvasContextMenuGlobalMenuItems";const Kve=(e,{id:t,type:n})=>n==="raster_layer"?{index:e.rasterLayers.entities.findIndex(s=>s.id===t),count:e.rasterLayers.entities.length}:n==="control_layer"?{index:e.controlLayers.entities.findIndex(s=>s.id===t),count:e.controlLayers.entities.length}:n==="regional_guidance"?{index:e.regionalGuidance.entities.findIndex(s=>s.id===t),count:e.regionalGuidance.entities.length}:n==="inpaint_mask"?{index:e.inpaintMasks.entities.findIndex(s=>s.id===t),count:e.inpaintMasks.entities.length}:n==="reference_image"?{index:e.referenceImages.entities.findIndex(s=>s.id===t),count:e.referenceImages.entities.length}:{index:-1,count:0},Td=u.memo(()=>{const{t:e}=A(),t=G(),n=Ye(),s=ut(),i=u.useMemo(()=>hn(tt,h=>{const{index:f,count:p}=Kve(h,n);return{canMoveForwardOne:f<p-1,canMoveBackwardOne:f>0,canMoveToFront:f<p-1,canMoveToBack:f>0}}),[n]),o=I(i),a=u.useCallback(()=>{t(VQ({entityIdentifier:n}))},[t,n]),l=u.useCallback(()=>{t(zQ({entityIdentifier:n}))},[t,n]),c=u.useCallback(()=>{t(GQ({entityIdentifier:n}))},[t,n]),d=u.useCallback(()=>{t(HQ({entityIdentifier:n}))},[t,n]);return r.jsxs(r.Fragment,{children:[r.jsx(Jr,{"aria-label":e("controlLayers.moveToFront"),tooltip:e("controlLayers.moveToFront"),onClick:l,isDisabled:!o.canMoveToFront||s,icon:r.jsx(wde,{})}),r.jsx(Jr,{"aria-label":e("controlLayers.moveForward"),tooltip:e("controlLayers.moveForward"),onClick:a,isDisabled:!o.canMoveForwardOne||s,icon:r.jsx(FR,{})}),r.jsx(Jr,{"aria-label":e("controlLayers.moveBackward"),tooltip:e("controlLayers.moveBackward"),onClick:c,isDisabled:!o.canMoveBackwardOne||s,icon:r.jsx(bde,{})}),r.jsx(Jr,{"aria-label":e("controlLayers.moveToBack"),tooltip:e("controlLayers.moveToBack"),onClick:d,isDisabled:!o.canMoveToBack||s,icon:r.jsx(vde,{})})]})});Td.displayName="CanvasEntityMenuItemsArrange";const Ri=e=>{const t=u.useMemo(()=>fe(tt,s=>{if(!e)return!1;const i=Qa(s,e);return i?i.isLocked:!1}),[e]);return I(t)},wg=u.memo(()=>{const{t:e}=A(),t=Ye(),n=ko(t),s=ut(),i=Ri(t),o=u.useCallback(()=>{n&&n.cropToBbox()},[n]);return r.jsx(pe,{onClick:o,icon:r.jsx(zR,{}),isDisabled:s||i,children:e("controlLayers.cropLayerToBbox")})});wg.displayName="CanvasEntityMenuItemsCropToBbox";const Ad=u.memo(({asIcon:e=!1})=>{const{t}=A(),n=G(),s=Ye(),i=ut(),o=u.useCallback(()=>{n(jS({entityIdentifier:s}))},[n,s]);return e?r.jsx(Jr,{"aria-label":t("common.delete"),tooltip:t("common.delete"),onClick:o,icon:r.jsx(ri,{}),isDestructive:!0,isDisabled:i}):r.jsx(pe,{onClick:o,icon:r.jsx(ri,{}),isDestructive:!0,isDisabled:i,children:t("common.delete")})});Ad.displayName="CanvasEntityMenuItemsDelete";const Ed=u.memo(()=>{const{t:e}=A(),t=G(),n=Ye(),s=ut(),i=u.useCallback(()=>{t(nP({entityIdentifier:n}))},[t,n]);return r.jsx(Jr,{"aria-label":e("controlLayers.duplicate"),tooltip:e("controlLayers.duplicate"),onClick:i,icon:r.jsx(i7,{}),isDisabled:s})});Ed.displayName="CanvasEntityMenuItemsDuplicate";const Sg=e=>{const t=u.useMemo(()=>e?WQ(e):()=>!1,[e]);return!I(t)},Lb=e=>{const t=Lt(),n=ko(e),s=Nt(),i=ut(),o=Ri(e),a=Sg(e),l=u.useMemo(()=>!!(!e||!P2(e)||!n||i||o||a),[e,n,i,o,a]),c=u.useCallback(()=>{if(l||!e||!P2(e))return;const d=t.getAdapter(e);d&&(s.close(),d.filterer.start())},[l,e,t,s]);return{isDisabled:l,start:c}},i_=u.memo(()=>{const{t:e}=A(),t=Ye(),n=Lb(t);return r.jsx(pe,{onClick:n.start,icon:r.jsx(Hj,{}),isDisabled:n.isDisabled,children:e("controlLayers.filter.filter")})});i_.displayName="CanvasEntityMenuItemsFilter";const Zve=e=>{const t=u.useMemo(()=>hn(tt,s=>{const i=UQ(s,e);return i?tr(i):null}),[e]);return I(t)},jg=u.memo(()=>{const{t:e}=A(),t=Lt(),n=ut(),s=Ye(),i=Zve(s),o=u.useCallback(()=>{i!==null&&t.compositor.mergeByEntityIdentifiers([i,s],!0)},[t.compositor,s,i]);return r.jsx(pe,{onClick:o,icon:r.jsx(s7,{}),isDisabled:n||i===null,children:e("controlLayers.mergeDown")})});jg.displayName="CanvasEntityMenuItemsMergeDown";const Yve=$n("canvas"),QF=()=>{const{t:e}=A(),t=I(Hs);return u.useCallback(async s=>{if(s)try{const i=s.getCanvas(),o=await Ay(i),a=new File([o],`layer-${s.id}.png`,{type:"image/png"});Aa({file:a,image_category:"user",is_intermediate:!1,board_id:t==="none"?void 0:t})}catch(i){Yve.error({error:Un(i)},"Problem copying layer to clipboard"),ge({status:"error",title:e("toast.problemSavingLayer")})}},[t,e])},kg=u.memo(()=>{const{t:e}=A(),t=Ye(),n=ko(t),s=ut(),i=QF(),o=u.useCallback(()=>{i(n)},[i,n]);return r.jsx(pe,{onClick:o,icon:r.jsx(so,{}),isDisabled:s,children:e("controlLayers.saveLayerToAssets")})});kg.displayName="CanvasEntityMenuItemsSave";const JF=e=>{const t=Lt(),n=ko(e),s=Nt(),i=ut(),o=Ri(e),a=Sg(e),l=u.useMemo(()=>!!(!e||!L2(e)||!n||i||o||a),[e,n,i,o,a]),c=u.useCallback(()=>{if(l||!e||!L2(e))return;const d=t.getAdapter(e);d&&(s.close(),d.segmentAnything.start())},[l,e,t,s]);return{isDisabled:l,start:c}},o_=u.memo(()=>{const{t:e}=A(),t=Ye(),n=JF(t);return r.jsx(pe,{onClick:n.start,icon:r.jsx(c7,{}),isDisabled:n.isDisabled,children:e("controlLayers.selectObject.selectObject")})});o_.displayName="CanvasEntityMenuItemsSelectObject";const a_=e=>{const t=Lt(),n=ko(e),s=Nt(),i=ut(),o=Ri(e),a=Sg(e),l=u.useMemo(()=>!!(!e||!i0(e)||!n||i||o||a),[e,n,i,o,a]),c=u.useCallback(async()=>{if(l||!e||!i0(e))return;const h=t.getAdapter(e);h&&(s.close(),await h.transformer.startTransform())},[l,e,t,s]),d=u.useCallback(async()=>{if(l||!e||!i0(e))return;const h=t.getAdapter(e);h&&(s.close(),await h.transformer.startTransform({silent:!0}),h.transformer.fitToBboxContain(),await h.transformer.applyTransform())},[t,e,s,l]);return{isDisabled:l,start:c,fitToBbox:d}},_g=u.memo(()=>{const{t:e}=A(),t=Ye(),n=a_(t);return r.jsxs(r.Fragment,{children:[r.jsx(pe,{onClick:n.start,icon:r.jsx(ag,{}),isDisabled:n.isDisabled,children:e("controlLayers.transform.transform")}),r.jsx(pe,{onClick:n.fitToBbox,icon:r.jsx(rl,{}),isDisabled:n.isDisabled,children:e("controlLayers.transform.fitToBbox")})]})});_g.displayName="CanvasEntityMenuItemsTransform";const eB=u.memo(()=>{const{t:e}=A(),t=rr(),n=G(),s=Ye("control_layer"),i=ut(),o=Ri(s),a=u.useCallback(()=>{n(sP({entityIdentifier:s,replace:!0}))},[n,s]),l=u.useCallback(()=>{n(rP({entityIdentifier:s,replace:!0}))},[n,s]),c=u.useCallback(()=>{n(iP({entityIdentifier:s,replace:!0}))},[n,s]);return r.jsx(pe,{...t.parentMenuItemProps,icon:r.jsx(Qr,{}),isDisabled:o||i,children:r.jsxs(en,{...t.menuProps,children:[r.jsx(tn,{...t.menuButtonProps,children:r.jsx(ir,{label:e("controlLayers.convertControlLayerTo")})}),r.jsxs(Tt,{...t.menuListProps,children:[r.jsx(pe,{onClick:a,icon:r.jsx(Qr,{}),isDisabled:o||i,children:e("controlLayers.inpaintMask")}),r.jsx(pe,{onClick:l,icon:r.jsx(Qr,{}),isDisabled:o||i,children:e("controlLayers.regionalGuidance")}),r.jsx(pe,{onClick:c,icon:r.jsx(Qr,{}),isDisabled:o||i,children:e("controlLayers.rasterLayer")})]})]})})});eB.displayName="ControlLayerMenuItemsConvertToSubMenu";const Ig=u.memo(()=>{const{t:e}=A(),t=Ye(),n=ko(t),s=ut(),i=Sg(t),o=Vve(),a=u.useCallback(()=>{o(n)},[o,n]);return r.jsx(pe,{onClick:a,icon:r.jsx(un,{}),isDisabled:s||i,children:e("common.clipboard")})});Ig.displayName="CanvasEntityMenuItemsCopyToClipboard";const tB=u.memo(()=>{const{t:e}=A(),t=rr(),n=G(),s=Ye("control_layer"),i=ut(),o=u.useCallback(()=>{n(sP({entityIdentifier:s}))},[n,s]),a=u.useCallback(()=>{n(rP({entityIdentifier:s}))},[n,s]),l=u.useCallback(()=>{n(iP({entityIdentifier:s}))},[n,s]);return r.jsx(pe,{...t.parentMenuItemProps,icon:r.jsx(un,{}),isDisabled:i,children:r.jsxs(en,{...t.menuProps,children:[r.jsx(tn,{...t.menuButtonProps,children:r.jsx(ir,{label:e("controlLayers.copyControlLayerTo")})}),r.jsxs(Tt,{...t.menuListProps,children:[r.jsx(Ig,{}),r.jsx(pe,{onClick:o,icon:r.jsx(un,{}),isDisabled:i,children:e("controlLayers.newInpaintMask")}),r.jsx(pe,{onClick:a,icon:r.jsx(un,{}),isDisabled:i,children:e("controlLayers.newRegionalGuidance")}),r.jsx(pe,{onClick:l,icon:r.jsx(un,{}),isDisabled:i,children:e("controlLayers.newRasterLayer")})]})]})})});tB.displayName="ControlLayerMenuItemsCopyToSubMenu";const Xve=e=>fe(tt,t=>Or(t,e,"ControlLayerMenuItemsTransparencyEffect").withTransparencyEffect),nB=u.memo(()=>{const{t:e}=A(),t=G(),n=Ye("control_layer"),s=Ri(n),i=u.useMemo(()=>Xve(n),[n]),o=I(i),a=u.useCallback(()=>{t(qQ({entityIdentifier:n}))},[t,n]);return r.jsx(pe,{onClick:a,icon:r.jsx(Ode,{}),isDisabled:s,children:e(o?"controlLayers.disableTransparencyEffect":"controlLayers.enableTransparencyEffect")})});nB.displayName="ControlLayerMenuItemsTransparencyEffect";const l_=u.memo(()=>r.jsxs(r.Fragment,{children:[r.jsxs(Sd,{children:[r.jsx(Td,{}),r.jsx(Ed,{}),r.jsx(Ad,{asIcon:!0})]}),r.jsx(Es,{}),r.jsx(_g,{}),r.jsx(i_,{}),r.jsx(o_,{}),r.jsx(nB,{}),r.jsx(Es,{}),r.jsx(jg,{}),r.jsx(tB,{}),r.jsx(eB,{}),r.jsx(wg,{}),r.jsx(kg,{})]}));l_.displayName="ControlLayerMenuItems";const sB=u.memo(()=>{const{t:e}=A(),t=rr(),n=G(),s=Ye("inpaint_mask"),i=ut(),o=Ri(s),a=u.useCallback(()=>{n(oP({entityIdentifier:s,replace:!0}))},[n,s]);return r.jsx(pe,{...t.parentMenuItemProps,icon:r.jsx(Qr,{}),isDisabled:i||o,children:r.jsxs(en,{...t.menuProps,children:[r.jsx(tn,{...t.menuButtonProps,children:r.jsx(ir,{label:e("controlLayers.convertInpaintMaskTo")})}),r.jsx(Tt,{...t.menuListProps,children:r.jsx(pe,{onClick:a,icon:r.jsx(Qr,{}),isDisabled:i||o,children:e("controlLayers.regionalGuidance")})})]})})});sB.displayName="InpaintMaskMenuItemsConvertToSubMenu";const rB=u.memo(()=>{const{t:e}=A(),t=rr(),n=G(),s=Ye("inpaint_mask"),i=ut(),o=u.useCallback(()=>{n(oP({entityIdentifier:s}))},[n,s]);return r.jsx(pe,{...t.parentMenuItemProps,icon:r.jsx(un,{}),isDisabled:i,children:r.jsxs(en,{...t.menuProps,children:[r.jsx(tn,{...t.menuButtonProps,children:r.jsx(ir,{label:e("controlLayers.copyInpaintMaskTo")})}),r.jsxs(Tt,{...t.menuListProps,children:[r.jsx(Ig,{}),r.jsx(pe,{onClick:o,icon:r.jsx(un,{}),isDisabled:i,children:e("controlLayers.newRegionalGuidance")})]})]})})});rB.displayName="InpaintMaskMenuItemsCopyToSubMenu";const c_=u.memo(()=>r.jsxs(r.Fragment,{children:[r.jsxs(Sd,{children:[r.jsx(Td,{}),r.jsx(Ed,{}),r.jsx(Ad,{asIcon:!0})]}),r.jsx(Es,{}),r.jsx(_g,{}),r.jsx(Es,{}),r.jsx(jg,{}),r.jsx(rB,{}),r.jsx(sB,{}),r.jsx(wg,{}),r.jsx(kg,{})]}));c_.displayName="InpaintMaskMenuItems";const iB=u.memo(()=>{const{t:e}=A(),t=Ye("reference_image"),n=r_(t),s=ut();return r.jsx(pe,{onClick:n,icon:r.jsx(rl,{}),isDisabled:s,children:e("controlLayers.pullBboxIntoReferenceImage")})});iB.displayName="IPAdapterMenuItemPullBbox";const u_=u.memo(()=>r.jsxs(r.Fragment,{children:[r.jsxs(Sd,{children:[r.jsx(Td,{}),r.jsx(Ed,{}),r.jsx(Ad,{asIcon:!0})]}),r.jsx(Es,{}),r.jsx(iB,{})]}));u_.displayName="IPAdapterMenuItems";const oB=u.memo(()=>{const{t:e}=A(),t=rr(),n=G(),s=Ye("raster_layer"),i=ut(),o=Ri(s),a=u.useCallback(()=>{n(aP({entityIdentifier:s,replace:!0}))},[n,s]),l=u.useCallback(()=>{n(lP({entityIdentifier:s,replace:!0}))},[n,s]),c=u.useCallback(()=>{n(cP({entityIdentifier:s,replace:!0,overrides:{controlAdapter:gt(uc)}}))},[n,s]);return r.jsx(pe,{...t.parentMenuItemProps,icon:r.jsx(Qr,{}),isDisabled:i||o,children:r.jsxs(en,{...t.menuProps,children:[r.jsx(tn,{...t.menuButtonProps,children:r.jsx(ir,{label:e("controlLayers.convertRasterLayerTo")})}),r.jsxs(Tt,{...t.menuListProps,children:[r.jsx(pe,{onClick:a,icon:r.jsx(Qr,{}),isDisabled:i||o,children:e("controlLayers.inpaintMask")}),r.jsx(pe,{onClick:l,icon:r.jsx(Qr,{}),isDisabled:i||o,children:e("controlLayers.regionalGuidance")}),r.jsx(pe,{onClick:c,icon:r.jsx(Qr,{}),isDisabled:i||o,children:e("controlLayers.controlLayer")})]})]})})});oB.displayName="RasterLayerMenuItemsConvertToSubMenu";const aB=u.memo(()=>{const{t:e}=A(),t=rr(),n=G(),s=Ye("raster_layer"),i=ut(),o=u.useCallback(()=>{n(aP({entityIdentifier:s}))},[n,s]),a=u.useCallback(()=>{n(lP({entityIdentifier:s}))},[n,s]),l=u.useCallback(()=>{n(cP({entityIdentifier:s,overrides:{controlAdapter:gt(uc)}}))},[n,s]);return r.jsx(pe,{...t.parentMenuItemProps,icon:r.jsx(un,{}),isDisabled:i,children:r.jsxs(en,{...t.menuProps,children:[r.jsx(tn,{...t.menuButtonProps,children:r.jsx(ir,{label:e("controlLayers.copyRasterLayerTo")})}),r.jsxs(Tt,{...t.menuListProps,children:[r.jsx(Ig,{}),r.jsx(pe,{onClick:o,icon:r.jsx(un,{}),isDisabled:i,children:e("controlLayers.newInpaintMask")}),r.jsx(pe,{onClick:a,icon:r.jsx(un,{}),isDisabled:i,children:e("controlLayers.newRegionalGuidance")}),r.jsx(pe,{onClick:l,icon:r.jsx(un,{}),isDisabled:i,children:e("controlLayers.newControlLayer")})]})]})})});aB.displayName="RasterLayerMenuItemsCopyToSubMenu";const d_=u.memo(()=>r.jsxs(r.Fragment,{children:[r.jsxs(Sd,{children:[r.jsx(Td,{}),r.jsx(Ed,{}),r.jsx(Ad,{asIcon:!0})]}),r.jsx(Es,{}),r.jsx(_g,{}),r.jsx(i_,{}),r.jsx(o_,{}),r.jsx(Es,{}),r.jsx(jg,{}),r.jsx(aB,{}),r.jsx(oB,{}),r.jsx(wg,{}),r.jsx(kg,{})]}));d_.displayName="RasterLayerMenuItems";const lB=u.memo(()=>{const e=Ye("regional_guidance"),{t}=A(),n=ut(),s=x9(e),i=v9(e),o=C9(e),a=u.useMemo(()=>w9(e),[e]),l=I(a);return r.jsxs(r.Fragment,{children:[r.jsx(pe,{onClick:i,isDisabled:!l.canAddPositivePrompt||n,children:t("controlLayers.addPositivePrompt")}),r.jsx(pe,{onClick:o,isDisabled:!l.canAddNegativePrompt||n,children:t("controlLayers.addNegativePrompt")}),r.jsx(pe,{onClick:s,isDisabled:n,children:t("controlLayers.addReferenceImage")})]})});lB.displayName="RegionalGuidanceMenuItemsExtra";const cB=u.memo(()=>{const e=Ye("regional_guidance"),{t}=A(),n=G(),s=u.useMemo(()=>fe(tt,a=>Or(a,e,"RegionalGuidanceMenuItemsAutoNegative").autoNegative),[e]),i=I(s),o=u.useCallback(()=>{n(KQ({entityIdentifier:e}))},[n,e]);return r.jsx(pe,{icon:r.jsx(rhe,{}),onClick:o,children:t(i?"controlLayers.disableAutoNegative":"controlLayers.enableAutoNegative")})});cB.displayName="RegionalGuidanceMenuItemsAutoNegative";const uB=u.memo(()=>{const{t:e}=A(),t=rr(),n=G(),s=Ye("regional_guidance"),i=ut(),o=Ri(s),a=u.useCallback(()=>{n(uP({entityIdentifier:s,replace:!0}))},[n,s]);return r.jsx(pe,{...t.parentMenuItemProps,icon:r.jsx(Qr,{}),isDisabled:o||i,children:r.jsxs(en,{...t.menuProps,children:[r.jsx(tn,{...t.menuButtonProps,children:r.jsx(ir,{label:e("controlLayers.convertRegionalGuidanceTo")})}),r.jsx(Tt,{...t.menuListProps,children:r.jsx(pe,{onClick:a,icon:r.jsx(Qr,{}),isDisabled:o||i,children:e("controlLayers.inpaintMask")})})]})})});uB.displayName="RegionalGuidanceMenuItemsConvertToSubMenu";const dB=u.memo(()=>{const{t:e}=A(),t=rr(),n=G(),s=Ye("regional_guidance"),i=ut(),o=u.useCallback(()=>{n(uP({entityIdentifier:s}))},[n,s]);return r.jsx(pe,{...t.parentMenuItemProps,icon:r.jsx(un,{}),isDisabled:i,children:r.jsxs(en,{...t.menuProps,children:[r.jsx(tn,{...t.menuButtonProps,children:r.jsx(ir,{label:e("controlLayers.copyRegionalGuidanceTo")})}),r.jsxs(Tt,{...t.menuListProps,children:[r.jsx(Ig,{}),r.jsx(pe,{onClick:o,icon:r.jsx(un,{}),isDisabled:i,children:e("controlLayers.newInpaintMask")})]})]})})});dB.displayName="RegionalGuidanceMenuItemsCopyToSubMenu";const h_=u.memo(()=>r.jsxs(r.Fragment,{children:[r.jsxs(Sd,{children:[r.jsx(Td,{}),r.jsx(Ed,{}),r.jsx(Ad,{asIcon:!0})]}),r.jsx(Es,{}),r.jsx(lB,{}),r.jsx(Es,{}),r.jsx(_g,{}),r.jsx(cB,{}),r.jsx(Es,{}),r.jsx(jg,{}),r.jsx(dB,{}),r.jsx(uB,{}),r.jsx(wg,{}),r.jsx(kg,{})]}));h_.displayName="RegionalGuidanceMenuItems";const hB=(e,t=!1)=>{const{t:n}=A();return u.useMemo(()=>{switch(e){case"control_layer":return n(t?"controlLayers.controlLayer_withCount_other":"controlLayers.controlLayer");case"raster_layer":return n(t?"controlLayers.rasterLayer_withCount_other":"controlLayers.rasterLayer");case"inpaint_mask":return n(t?"controlLayers.inpaintMask_withCount_other":"controlLayers.inpaintMask");case"regional_guidance":return n(t?"controlLayers.regionalGuidance_withCount_other":"controlLayers.regionalGuidance");case"reference_image":return n(t?"controlLayers.globalReferenceImage_withCount_other":"controlLayers.globalReferenceImage");default:return""}},[e,t,n])},fB=u.memo(()=>{const e=Ye();if(e.type==="raster_layer")return r.jsx(d_,{});if(e.type==="control_layer")return r.jsx(l_,{});if(e.type==="inpaint_mask")return r.jsx(c_,{});if(e.type==="regional_guidance")return r.jsx(h_,{});if(e.type==="reference_image")return r.jsx(u_,{});we(!1)});fB.displayName="CanvasContextMenuSelectedEntityMenuItemsContent";const pB=u.memo(e=>{const t=Ye(),n=hB(t.type);return r.jsx(Sr,{title:n,children:e.children})});pB.displayName="CanvasContextMenuSelectedEntityMenuGroup";const gB=u.memo(()=>{const e=I(Tn);return e?r.jsx(Cc.Provider,{value:e,children:r.jsx(ra,{entityIdentifier:e,children:r.jsx(pB,{children:r.jsx(fB,{})})})}):null});gB.displayName="CanvasContextMenuSelectedEntityMenuItems";const JC="drop-shadow(0px 0px 4px rgb(0, 0, 0)) drop-shadow(0px 0px 4px rgba(0, 0, 0, 0.3))",mB=(e,t)=>{if(e.width===0||e.height===0)return{width:t.width,height:t.height};if(t.width<=e.width&&t.height<=e.height)return{width:t.width,height:t.height};const n=e.width/e.height,s=t.width/t.height;let i,o;return s>n?(i=e.width,o=i/s):(o=e.height,i=o*s),{width:i,height:o}},yB=(e,t,n,s)=>{const i=e==="fill"?t.width:t.width*s.width/n.width,o=e==="fill"?t.height:t.height*s.height/n.height;return{width:i,height:o}},bB=hn(Tr,e=>{const t=e.selection.slice(-1)[0]??null,n=e.imageToCompare;return{firstImage:t,secondImage:n}}),Qve=$n("dnd"),Br=e=>{const t=Symbol(e);return{type:e,key:t}},$r=e=>n=>!!n[e],Vr=(e,t)=>(s,i)=>({[e]:!0,id:i??Te(t),type:t,payload:s}),jm=Br("single-image"),In={...jm,typeGuard:$r(jm.key),getData:Vr(jm.key,jm.type)},km=Br("multiple-image"),ni={...km,typeGuard:$r(km.key),getData:Vr(km.key,km.type)},_m=Br("single-canvas-entity"),_u={..._m,typeGuard:$r(_m.key),getData:Vr(_m.key,_m.type)},Im=Br("set-global-reference-image"),cp={...Im,typeGuard:$r(Im.key),getData:Vr(Im.key,Im.type),isValid:({sourceData:e})=>!!In.typeGuard(e),handler:({sourceData:e,targetData:t,dispatch:n})=>{const{imageDTO:s}=e.payload,{entityIdentifier:i}=t.payload;E9({entityIdentifier:i,imageDTO:s,dispatch:n})}},Tm=Br("set-regional-guidance-reference-image"),up={...Tm,typeGuard:$r(Tm.key),getData:Vr(Tm.key,Tm.type),isValid:({sourceData:e})=>!!In.typeGuard(e),handler:({sourceData:e,targetData:t,dispatch:n})=>{const{imageDTO:s}=e.payload,{entityIdentifier:i,referenceImageId:o}=t.payload;M9({imageDTO:s,entityIdentifier:i,referenceImageId:o,dispatch:n})}},Am=Br("set-upscale-initial-image"),ew={...Am,typeGuard:$r(Am.key),getData:Vr(Am.key,Am.type),isValid:({sourceData:e})=>!!In.typeGuard(e),handler:({sourceData:e,dispatch:t})=>{const{imageDTO:n}=e.payload;mge({imageDTO:n,dispatch:t})}},Em=Br("set-node-image-field-image"),tw={...Em,typeGuard:$r(Em.key),getData:Vr(Em.key,Em.type),isValid:({sourceData:e})=>!!In.typeGuard(e),handler:({sourceData:e,targetData:t,dispatch:n})=>{const{imageDTO:s}=e.payload,{fieldIdentifier:i}=t.payload;yge({fieldIdentifier:i,imageDTO:s,dispatch:n})}},Mm=Br("add-images-to-image-collection-node-field"),nw={...Mm,typeGuard:$r(Mm.key),getData:Vr(Mm.key,Mm.type),isValid:({sourceData:e})=>!!(In.typeGuard(e)||ni.typeGuard(e)),handler:({sourceData:e,targetData:t,dispatch:n,getState:s})=>{if(!In.typeGuard(e)&&!ni.typeGuard(e))return;const{fieldIdentifier:i}=t.payload,o=Ey(Qe(s()),i.nodeId,i.fieldName);if(!gy(o)){Qve.warn({fieldIdentifier:i},"Attempted to add images to a non-image field collection");return}const a=o.value?[...o.value]:[];In.typeGuard(e)?a.push({image_name:e.payload.imageDTO.image_name}):a.push(...e.payload.imageDTOs.map(({image_name:l})=>({image_name:l}))),n(D2({...i,value:a}))}},Pm=Br("set-comparison-image"),sw={...Pm,typeGuard:$r(Pm.key),getData:Vr(Pm.key,Pm.type),isValid:({sourceData:e,getState:t})=>{if(!In.typeGuard(e))return!1;const{firstImage:n,secondImage:s}=bB(t());return!(e.payload.imageDTO.image_name===(n==null?void 0:n.image_name)||e.payload.imageDTO.image_name===(s==null?void 0:s.image_name))},handler:({sourceData:e,dispatch:t})=>{const{imageDTO:n}=e.payload;bge({imageDTO:n,dispatch:t})}},Lm=Br("new-canvas-entity-from-image"),Ho={...Lm,typeGuard:$r(Lm.key),getData:Vr(Lm.key,Lm.type),isValid:({sourceData:e})=>!!In.typeGuard(e),handler:({sourceData:e,targetData:t,dispatch:n,getState:s})=>{const{type:i}=t.payload,{imageDTO:o}=e.payload;Yr({type:i,imageDTO:o,dispatch:n,getState:s})}},Dm=Br("replace-canvas-entity-objects-with-image"),dp={...Dm,typeGuard:$r(Dm.key),getData:Vr(Dm.key,Dm.type),isValid:({sourceData:e})=>!!In.typeGuard(e),handler:({sourceData:e,targetData:t,dispatch:n,getState:s})=>{const{imageDTO:i}=e.payload,{entityIdentifier:o}=t.payload;mk({imageDTO:i,entityIdentifier:o,dispatch:n,getState:s})}},Rm=Br("add-to-board"),x1={...Rm,typeGuard:$r(Rm.key),getData:Vr(Rm.key,Rm.type),isValid:({sourceData:e,targetData:t})=>{if(In.typeGuard(e)){const n=e.payload.imageDTO.board_id??"none",s=t.payload.boardId;return n!==s}if(ni.typeGuard(e)){const n=e.payload.boardId,s=t.payload.boardId;return n!==s}return!1},handler:({sourceData:e,targetData:t,dispatch:n})=>{if(In.typeGuard(e)){const{imageDTO:s}=e.payload,{boardId:i}=t.payload;gT({imageDTOs:[s],boardId:i,dispatch:n})}if(ni.typeGuard(e)){const{imageDTOs:s}=e.payload,{boardId:i}=t.payload;gT({imageDTOs:s,boardId:i,dispatch:n})}}},Om=Br("remove-from-board"),v1={...Om,typeGuard:$r(Om.key),getData:Vr(Om.key,Om.type),isValid:({sourceData:e})=>In.typeGuard(e)?(e.payload.imageDTO.board_id??"none")!=="none":ni.typeGuard(e)?e.payload.boardId!=="none":!1,handler:({sourceData:e,dispatch:t})=>{if(In.typeGuard(e)){const{imageDTO:n}=e.payload;mT({imageDTOs:[n],dispatch:t})}if(ni.typeGuard(e)){const{imageDTOs:n}=e.payload;mT({imageDTOs:n,dispatch:t})}}},Jve=[cp,up,ew,tw,sw,Ho,dp,x1,v1,x1,v1,nw],e2e={position:"absolute",top:0,right:0,bottom:0,left:0,w:"full",h:"full",pointerEvents:"auto",'&[data-dnd-state="idle"]':{pointerEvents:"none"}},Is=u.memo(e=>{const{dndTarget:t,dndTargetData:n,label:s,isDisabled:i}=e,[o,a]=u.useState("idle"),l=u.useRef(null),c=G();return u.useEffect(()=>{const d=l.current;if(!d||i)return;const{dispatch:h,getState:f}=Fp();return qn(Bu({element:d,canDrop:({source:p})=>{const g={sourceData:p.data,targetData:n,dispatch:h,getState:f};return t.isValid(g)},onDragEnter:()=>{a("over")},onDragLeave:()=>{a("potential")},getData:()=>n}),to({canMonitor:({source:p})=>{const g={sourceData:p.data,targetData:n,dispatch:h,getState:f};return t.isValid(g)},onDragStart:()=>{a("potential")},onDrop:()=>{a("idle")}}))},[c,i,t,n]),r.jsx(Se,{ref:l,sx:e2e,"data-dnd-state":o,children:r.jsx(tp,{dndState:o,label:s})})});Is.displayName="DndDropTarget";const t2e=Ho.getData({type:"raster_layer"}),n2e=Ho.getData({type:"control_layer"}),s2e=Ho.getData({type:"regional_guidance_with_reference_image"}),r2e=Ho.getData({type:"reference_image"}),xB=u.memo(()=>{const{t:e}=A(),t=Nt(),n=ut();return t.isOpen?null:r.jsx(r.Fragment,{children:r.jsxs(Ar,{gridTemplateRows:"1fr 1fr",gridTemplateColumns:"1fr 1fr",position:"absolute",top:0,right:0,bottom:0,left:0,pointerEvents:"none",children:[r.jsx(xt,{position:"relative",children:r.jsx(Is,{dndTarget:Ho,dndTargetData:t2e,label:e("controlLayers.canvasContextMenu.newRasterLayer"),isDisabled:n})}),r.jsx(xt,{position:"relative",children:r.jsx(Is,{dndTarget:Ho,dndTargetData:n2e,label:e("controlLayers.canvasContextMenu.newControlLayer"),isDisabled:n})}),r.jsx(xt,{position:"relative",children:r.jsx(Is,{dndTarget:Ho,dndTargetData:s2e,label:e("controlLayers.canvasContextMenu.newRegionalReferenceImage"),isDisabled:n})}),r.jsx(xt,{position:"relative",children:r.jsx(Is,{dndTarget:Ho,dndTargetData:r2e,label:e("controlLayers.canvasContextMenu.newGlobalReferenceImage"),isDisabled:n})})]})})});xB.displayName="CanvasDropArea";const f_=u.memo(()=>{const{t:e}=A(),t=G(),n=I(Vp),s=u.useCallback(()=>{t(ZQ())},[t]);return r.jsxs(K,{w:"min-content",children:[r.jsx(J,{m:0,children:e("controlLayers.filter.autoProcess")}),r.jsx(et,{size:"sm",isChecked:n,onChange:s})]})});f_.displayName="CanvasAutoProcessSwitch";const Db=u.memo(()=>{const{t:e}=A(),t=G(),n=I(O0),s=u.useCallback(()=>{t(dP())},[t]);return r.jsx(Ee,{label:e("controlLayers.settings.isolatedLayerPreviewDesc"),children:r.jsxs(K,{w:"min-content",children:[r.jsx(J,{m:0,children:e("controlLayers.settings.isolatedPreview")}),r.jsx(et,{size:"sm",isChecked:n,onChange:s})]})})});Db.displayName="CanvasOperationIsolatedLayerPreviewSwitch";const vB=Ge.enum(["Red (RGBA)","Green (RGBA)","Blue (RGBA)","Alpha (RGBA)","Cyan (CMYK)","Magenta (CMYK)","Yellow (CMYK)","Black (CMYK)","Hue (HSV)","Saturation (HSV)","Value (HSV)","Luminosity (LAB)","A (LAB)","B (LAB)","Y (YCbCr)","Cb (YCbCr)","Cr (YCbCr)"]),i2e=e=>vB.safeParse(e).success,o2e=Ge.object({type:Ge.literal("adjust_image"),channel:vB,value:Ge.number(),scale_values:Ge.boolean().optional()}),a2e=Ge.object({type:Ge.literal("canny_edge_detection"),low_threshold:Ge.number().int().gte(0).lte(255),high_threshold:Ge.number().int().gte(0).lte(255)}),l2e=Ge.object({type:Ge.literal("color_map"),tile_size:Ge.number().int().gte(1)}),c2e=Ge.object({type:Ge.literal("content_shuffle"),scale_factor:Ge.number().int().gte(1)}),CB=Ge.enum(["large","base","small","small_v2"]),u2e=e=>CB.safeParse(e).success,d2e=Ge.object({type:Ge.literal("depth_anything_depth_estimation"),model_size:CB}),h2e=Ge.object({type:Ge.literal("hed_edge_detection"),scribble:Ge.boolean()}),f2e=Ge.object({type:Ge.literal("lineart_anime_edge_detection")}),p2e=Ge.object({type:Ge.literal("lineart_edge_detection"),coarse:Ge.boolean()}),g2e=Ge.object({type:Ge.literal("mediapipe_face_detection"),max_faces:Ge.number().int().gte(1),min_confidence:Ge.number().gte(0).lte(1)}),m2e=Ge.object({type:Ge.literal("mlsd_detection"),score_threshold:Ge.number().gte(0),distance_threshold:Ge.number().gte(0)}),y2e=Ge.object({type:Ge.literal("normal_map")}),b2e=Ge.object({type:Ge.literal("pidi_edge_detection"),quantize_edges:Ge.boolean(),scribble:Ge.boolean()}),x2e=Ge.object({type:Ge.literal("dw_openpose_detection"),draw_body:Ge.boolean(),draw_face:Ge.boolean(),draw_hands:Ge.boolean()}),v2e=Ge.object({type:Ge.literal("spandrel_filter"),model:Ei.nullable(),autoScale:Ge.boolean(),scale:Ge.number().gte(1).lte(16)}),wB=Ge.enum(["gaussian","box"]),C2e=e=>wB.safeParse(e).success,w2e=Ge.object({type:Ge.literal("img_blur"),blur_type:wB,radius:Ge.number().gte(0)}),SB=Ge.enum(["gaussian","salt_and_pepper"]),S2e=e=>SB.safeParse(e).success,j2e=Ge.object({type:Ge.literal("img_noise"),noise_type:SB,amount:Ge.number().gte(0).lte(1),noise_color:Ge.boolean(),size:Ge.number().int().gte(1)});Ge.discriminatedUnion("type",[o2e,a2e,l2e,c2e,d2e,h2e,f2e,p2e,g2e,m2e,y2e,b2e,x2e,v2e,w2e,j2e]);const k2e=Ge.enum(["adjust_image","canny_edge_detection","color_map","content_shuffle","depth_anything_depth_estimation","hed_edge_detection","lineart_anime_edge_detection","lineart_edge_detection","mediapipe_face_detection","mlsd_detection","normal_map","pidi_edge_detection","dw_openpose_detection","spandrel_filter","img_blur","img_noise"]),jB=e=>k2e.safeParse(e).success,Nn={adjust_image:{type:"adjust_image",buildDefaults:()=>({type:"adjust_image",channel:"Luminosity (LAB)",value:1,scale_values:!1}),buildGraph:({image_name:e},{channel:t,value:n,scale_values:s})=>{const i=new Qn(Te("adjust_image_filter"));let o;return s?o=i.addNode({id:Te("img_channel_multiply"),type:"img_channel_multiply",image:{image_name:e},channel:t,scale:n,invert_channel:!1}):(n=Math.min(n,2),o=i.addNode({id:Te("img_channel_offset"),type:"img_channel_offset",image:{image_name:e},channel:t,offset:Math.round(255*(n-1))})),{graph:i,outputNodeId:o.id}}},canny_edge_detection:{type:"canny_edge_detection",buildDefaults:()=>({type:"canny_edge_detection",low_threshold:100,high_threshold:200}),buildGraph:({image_name:e},{low_threshold:t,high_threshold:n})=>{const s=new Qn(Te("canny_edge_detection_filter")),i=s.addNode({id:Te("canny_edge_detection"),type:"canny_edge_detection",image:{image_name:e},low_threshold:t,high_threshold:n});return{graph:s,outputNodeId:i.id}}},color_map:{type:"color_map",buildDefaults:()=>({type:"color_map",tile_size:64}),buildGraph:({image_name:e},{tile_size:t})=>{const n=new Qn(Te("color_map_filter")),s=n.addNode({id:Te("color_map"),type:"color_map",image:{image_name:e},tile_size:t});return{graph:n,outputNodeId:s.id}}},content_shuffle:{type:"content_shuffle",buildDefaults:()=>({type:"content_shuffle",scale_factor:256}),buildGraph:({image_name:e},{scale_factor:t})=>{const n=new Qn(Te("content_shuffle_filter")),s=n.addNode({id:Te("content_shuffle"),type:"content_shuffle",image:{image_name:e},scale_factor:t});return{graph:n,outputNodeId:s.id}}},depth_anything_depth_estimation:{type:"depth_anything_depth_estimation",buildDefaults:()=>({type:"depth_anything_depth_estimation",model_size:"small_v2"}),buildGraph:({image_name:e},{model_size:t})=>{const n=new Qn(Te("depth_anything_depth_estimation_filter")),s=n.addNode({id:Te("depth_anything_depth_estimation"),type:"depth_anything_depth_estimation",image:{image_name:e},model_size:t});return{graph:n,outputNodeId:s.id}}},hed_edge_detection:{type:"hed_edge_detection",buildDefaults:()=>({type:"hed_edge_detection",scribble:!1}),buildGraph:({image_name:e},{scribble:t})=>{const n=new Qn(Te("hed_edge_detection_filter")),s=n.addNode({id:Te("hed_edge_detection"),type:"hed_edge_detection",image:{image_name:e},scribble:t});return{graph:n,outputNodeId:s.id}}},lineart_anime_edge_detection:{type:"lineart_anime_edge_detection",buildDefaults:()=>({type:"lineart_anime_edge_detection"}),buildGraph:({image_name:e})=>{const t=new Qn(Te("lineart_anime_edge_detection_filter")),n=t.addNode({id:Te("lineart_anime_edge_detection"),type:"lineart_anime_edge_detection",image:{image_name:e}});return{graph:t,outputNodeId:n.id}}},lineart_edge_detection:{type:"lineart_edge_detection",buildDefaults:()=>({type:"lineart_edge_detection",coarse:!1}),buildGraph:({image_name:e},{coarse:t})=>{const n=new Qn(Te("lineart_edge_detection_filter")),s=n.addNode({id:Te("lineart_edge_detection"),type:"lineart_edge_detection",image:{image_name:e},coarse:t});return{graph:n,outputNodeId:s.id}}},mediapipe_face_detection:{type:"mediapipe_face_detection",buildDefaults:()=>({type:"mediapipe_face_detection",max_faces:1,min_confidence:.5}),buildGraph:({image_name:e},{max_faces:t,min_confidence:n})=>{const s=new Qn(Te("mediapipe_face_detection_filter")),i=s.addNode({id:Te("mediapipe_face_detection"),type:"mediapipe_face_detection",image:{image_name:e},max_faces:t,min_confidence:n});return{graph:s,outputNodeId:i.id}}},mlsd_detection:{type:"mlsd_detection",buildDefaults:()=>({type:"mlsd_detection",score_threshold:.1,distance_threshold:20}),buildGraph:({image_name:e},{score_threshold:t,distance_threshold:n})=>{const s=new Qn(Te("mlsd_detection_filter")),i=s.addNode({id:Te("mlsd_detection"),type:"mlsd_detection",image:{image_name:e},score_threshold:t,distance_threshold:n});return{graph:s,outputNodeId:i.id}}},normal_map:{type:"normal_map",buildDefaults:()=>({type:"normal_map"}),buildGraph:({image_name:e})=>{const t=new Qn(Te("normal_map_filter")),n=t.addNode({id:Te("normal_map"),type:"normal_map",image:{image_name:e}});return{graph:t,outputNodeId:n.id}}},pidi_edge_detection:{type:"pidi_edge_detection",buildDefaults:()=>({type:"pidi_edge_detection",quantize_edges:!1,scribble:!1}),buildGraph:({image_name:e},{quantize_edges:t,scribble:n})=>{const s=new Qn(Te("pidi_edge_detection_filter")),i=s.addNode({id:Te("pidi_edge_detection"),type:"pidi_edge_detection",image:{image_name:e},quantize_edges:t,scribble:n});return{graph:s,outputNodeId:i.id}}},dw_openpose_detection:{type:"dw_openpose_detection",buildDefaults:()=>({type:"dw_openpose_detection",draw_body:!0,draw_face:!0,draw_hands:!0}),buildGraph:({image_name:e},{draw_body:t,draw_face:n,draw_hands:s})=>{const i=new Qn(Te("dw_openpose_detection_filter")),o=i.addNode({id:Te("dw_openpose_detection"),type:"dw_openpose_detection",image:{image_name:e},draw_body:t,draw_face:n,draw_hands:s});return{graph:i,outputNodeId:o.id}}},spandrel_filter:{type:"spandrel_filter",buildDefaults:()=>({type:"spandrel_filter",model:null,autoScale:!0,scale:1}),buildGraph:({image_name:e},{model:t,scale:n,autoScale:s})=>{we(t!==null);const i=new Qn(Te("spandrel_filter")),o=i.addNode(s?{id:Te("spandrel_image_to_image_autoscale"),type:"spandrel_image_to_image_autoscale",image_to_image_model:t,image:{image_name:e},scale:n}:{id:Te("spandrel_image_to_image"),type:"spandrel_image_to_image",image_to_image_model:t,image:{image_name:e}});return{graph:i,outputNodeId:o.id}},validateConfig:e=>!!e.model},img_blur:{type:"img_blur",buildDefaults:()=>({type:"img_blur",blur_type:"gaussian",radius:8}),buildGraph:({image_name:e},{blur_type:t,radius:n})=>{const s=new Qn(Te("img_blur")),i=s.addNode({id:Te("img_blur"),type:"img_blur",image:{image_name:e},blur_type:t,radius:n});return{graph:s,outputNodeId:i.id}}},img_noise:{type:"img_noise",buildDefaults:()=>({type:"img_noise",noise_type:"gaussian",amount:.3,noise_color:!0,size:1}),buildGraph:({image_name:e},{noise_type:t,amount:n,noise_color:s,size:i})=>{const o=new Qn(Te("img_noise")),a=o.addNode({id:Te("img_noise"),type:"img_noise",image:{image_name:e},noise_type:t,amount:n,noise_color:s,size:i}),l=o.addNode({id:Te("rand_int"),use_cache:!1,type:"rand_int",low:0,high:2147483647});return o.addEdge(l,"value",a,"seed"),{graph:o,outputNodeId:a.id}}}},_2e={canny_image_processor:"canny_edge_detection",mlsd_image_processor:"mlsd_detection",depth_anything_image_processor:"depth_anything_depth_estimation",normalbae_image_processor:"normal_map",pidi_image_processor:"pidi_edge_detection",lineart_image_processor:"lineart_edge_detection",lineart_anime_image_processor:"lineart_anime_edge_detection",hed_image_processor:"hed_edge_detection",content_shuffle_image_processor:"content_shuffle",dw_openpose_image_processor:"dw_openpose_detection",mediapipe_face_processor:"mediapipe_face_detection",zoe_depth_image_processor:"depth_anything_depth_estimation",color_map_image_processor:"color_map"},kB=e=>{var s;if(!e)return null;const t=(s=e==null?void 0:e.default_settings)==null?void 0:s.preprocessor;if(!t)return null;if(jB(t))return Nn[t];const n=_2e[t];return n?Nn[n]:null},Pv=Nn.adjust_image.buildDefaults(),_B=u.memo(({onChange:e,config:t})=>{const{t:n}=A(),s=u.useCallback(c=>{i2e(c==null?void 0:c.value)&&e({...t,channel:c.value})},[t,e]),i=u.useCallback(c=>{e({...t,value:c})},[t,e]),o=u.useCallback(c=>{e({...t,scale_values:c.target.checked})},[t,e]),a=u.useMemo(()=>[{label:n("controlLayers.filter.adjust_image.red"),value:"Red (RGBA)"},{label:n("controlLayers.filter.adjust_image.green"),value:"Green (RGBA)"},{label:n("controlLayers.filter.adjust_image.blue"),value:"Blue (RGBA)"},{label:n("controlLayers.filter.adjust_image.alpha"),value:"Alpha (RGBA)"},{label:n("controlLayers.filter.adjust_image.cyan"),value:"Cyan (CMYK)"},{label:n("controlLayers.filter.adjust_image.magenta"),value:"Magenta (CMYK)"},{label:n("controlLayers.filter.adjust_image.yellow"),value:"Yellow (CMYK)"},{label:n("controlLayers.filter.adjust_image.black"),value:"Black (CMYK)"},{label:n("controlLayers.filter.adjust_image.hue"),value:"Hue (HSV)"},{label:n("controlLayers.filter.adjust_image.saturation"),value:"Saturation (HSV)"},{label:n("controlLayers.filter.adjust_image.value"),value:"Value (HSV)"},{label:n("controlLayers.filter.adjust_image.luminosity"),value:"Luminosity (LAB)"},{label:n("controlLayers.filter.adjust_image.a"),value:"A (LAB)"},{label:n("controlLayers.filter.adjust_image.b"),value:"B (LAB)"},{label:n("controlLayers.filter.adjust_image.y"),value:"Y (YCbCr)"},{label:n("controlLayers.filter.adjust_image.cb"),value:"Cb (YCbCr)"},{label:n("controlLayers.filter.adjust_image.cr"),value:"Cr (YCbCr)"}],[n]),l=u.useMemo(()=>a.filter(c=>c.value===t.channel)[0],[a,t.channel]);return r.jsxs(r.Fragment,{children:[r.jsxs(K,{children:[r.jsx(J,{m:0,children:n("controlLayers.filter.adjust_image.channel")}),r.jsx(Ne,{value:l,options:a,onChange:s,isSearchable:!1})]}),r.jsxs(K,{children:[r.jsx(J,{m:0,children:n("controlLayers.filter.adjust_image.value_setting")}),r.jsx(Ze,{value:t.value,defaultValue:Pv.value,onChange:i,min:0,max:2,step:.0025,marks:!0}),r.jsx(Ie,{value:t.value,defaultValue:Pv.value,onChange:i,min:0,max:255,step:.0025})]}),r.jsxs(K,{w:"max-content",children:[r.jsx(J,{m:0,children:n("controlLayers.filter.adjust_image.scale_values")}),r.jsx(et,{defaultChecked:Pv.scale_values,isChecked:t.scale_values,onChange:o})]})]})});_B.displayName="FilterAdjustImage";const rE=Nn.img_blur.buildDefaults(),IB=u.memo(({onChange:e,config:t})=>{const{t:n}=A(),s=u.useCallback(l=>{C2e(l==null?void 0:l.value)&&e({...t,blur_type:l.value})},[t,e]),i=u.useCallback(l=>{e({...t,radius:l})},[t,e]),o=u.useMemo(()=>[{label:n("controlLayers.filter.img_blur.gaussian_type"),value:"gaussian"},{label:n("controlLayers.filter.img_blur.box_type"),value:"box"}],[n]),a=u.useMemo(()=>o.filter(l=>l.value===t.blur_type)[0],[o,t.blur_type]);return r.jsxs(r.Fragment,{children:[r.jsxs(K,{children:[r.jsx(J,{m:0,children:n("controlLayers.filter.img_blur.blur_type")}),r.jsx(Ne,{value:a,options:o,onChange:s,isSearchable:!1})]}),r.jsxs(K,{children:[r.jsx(J,{m:0,children:n("controlLayers.filter.img_blur.blur_radius")}),r.jsx(Ze,{value:t.radius,defaultValue:rE.radius,onChange:i,min:1,max:64,step:.1,marks:!0}),r.jsx(Ie,{value:t.radius,defaultValue:rE.radius,onChange:i,min:1,max:4096,step:.1})]})]})});IB.displayName="FilterBlur";const Nm=Nn.canny_edge_detection.buildDefaults(),TB=({onChange:e,config:t})=>{const{t:n}=A(),s=u.useCallback(o=>{e({...t,low_threshold:o})},[e,t]),i=u.useCallback(o=>{e({...t,high_threshold:o})},[e,t]);return r.jsxs(r.Fragment,{children:[r.jsxs(K,{children:[r.jsx(J,{m:0,children:n("controlLayers.filter.canny_edge_detection.low_threshold")}),r.jsx(Ze,{value:t.low_threshold,onChange:s,defaultValue:Nm.low_threshold,min:0,max:255}),r.jsx(Ie,{value:t.low_threshold,onChange:s,defaultValue:Nm.low_threshold,min:0,max:255})]}),r.jsxs(K,{children:[r.jsx(J,{m:0,children:n("controlLayers.filter.canny_edge_detection.high_threshold")}),r.jsx(Ze,{value:t.high_threshold,onChange:i,defaultValue:Nm.high_threshold,min:0,max:255}),r.jsx(Ie,{value:t.high_threshold,onChange:i,defaultValue:Nm.high_threshold,min:0,max:255})]})]})};TB.displayName="FilterCannyEdgeDetection";const iE=Nn.color_map.buildDefaults(),AB=u.memo(({onChange:e,config:t})=>{const{t:n}=A(),s=u.useCallback(i=>{e({...t,tile_size:i})},[t,e]);return r.jsx(r.Fragment,{children:r.jsxs(K,{children:[r.jsx(J,{m:0,children:n("controlLayers.filter.color_map.tile_size")}),r.jsx(Ze,{value:t.tile_size,defaultValue:iE.tile_size,onChange:s,min:1,max:256,step:1,marks:!0}),r.jsx(Ie,{value:t.tile_size,defaultValue:iE.tile_size,onChange:s,min:1,max:4096,step:1})]})})});AB.displayName="FilterColorMap";const oE=Nn.content_shuffle.buildDefaults(),EB=u.memo(({onChange:e,config:t})=>{const{t:n}=A(),s=u.useCallback(i=>{e({...t,scale_factor:i})},[t,e]);return r.jsx(r.Fragment,{children:r.jsxs(K,{children:[r.jsx(J,{m:0,children:n("controlLayers.filter.content_shuffle.scale_factor")}),r.jsx(Ze,{value:t.scale_factor,defaultValue:oE.scale_factor,onChange:s,min:0,max:4096,marks:!0}),r.jsx(Ie,{value:t.scale_factor,defaultValue:oE.scale_factor,onChange:s,min:0,max:4096})]})})});EB.displayName="FilterContentShuffle";const MB=u.memo(({onChange:e,config:t})=>{const{t:n}=A(),s=u.useCallback(a=>{u2e(a==null?void 0:a.value)&&e({...t,model_size:a.value})},[t,e]),i=u.useMemo(()=>[{label:n("controlLayers.filter.depth_anything_depth_estimation.model_size_small_v2"),value:"small_v2"},{label:n("controlLayers.filter.depth_anything_depth_estimation.model_size_small"),value:"small"},{label:n("controlLayers.filter.depth_anything_depth_estimation.model_size_base"),value:"base"},{label:n("controlLayers.filter.depth_anything_depth_estimation.model_size_large"),value:"large"}],[n]),o=u.useMemo(()=>i.filter(a=>a.value===t.model_size)[0],[i,t.model_size]);return r.jsx(r.Fragment,{children:r.jsxs(K,{children:[r.jsx(J,{m:0,children:n("controlLayers.filter.depth_anything_depth_estimation.model_size")}),r.jsx(Ne,{value:o,options:i,onChange:s,isSearchable:!1})]})})});MB.displayName="FilterDepthAnythingDepthEstimation";const Lv=Nn.dw_openpose_detection.buildDefaults(),PB=u.memo(({onChange:e,config:t})=>{const{t:n}=A(),s=u.useCallback(a=>{e({...t,draw_body:a.target.checked})},[t,e]),i=u.useCallback(a=>{e({...t,draw_face:a.target.checked})},[t,e]),o=u.useCallback(a=>{e({...t,draw_hands:a.target.checked})},[t,e]);return r.jsx(r.Fragment,{children:r.jsxs(T,{sx:{flexDir:"row",gap:6},children:[r.jsxs(K,{w:"max-content",children:[r.jsx(J,{m:0,children:n("controlLayers.filter.dw_openpose_detection.draw_body")}),r.jsx(et,{defaultChecked:Lv.draw_body,isChecked:t.draw_body,onChange:s})]}),r.jsxs(K,{w:"max-content",children:[r.jsx(J,{m:0,children:n("controlLayers.filter.dw_openpose_detection.draw_face")}),r.jsx(et,{defaultChecked:Lv.draw_face,isChecked:t.draw_face,onChange:i})]}),r.jsxs(K,{w:"max-content",children:[r.jsx(J,{m:0,children:n("controlLayers.filter.dw_openpose_detection.draw_hands")}),r.jsx(et,{defaultChecked:Lv.draw_hands,isChecked:t.draw_hands,onChange:o})]})]})})});PB.displayName="FilterDWOpenposeDetection";const LB=u.memo(({onChange:e,config:t})=>{const{t:n}=A(),s=u.useCallback(i=>{e({...t,scribble:i.target.checked})},[t,e]);return r.jsx(r.Fragment,{children:r.jsxs(K,{children:[r.jsx(J,{m:0,children:n("controlLayers.filter.hed_edge_detection.scribble")}),r.jsx(et,{isChecked:t.scribble,onChange:s})]})})});LB.displayName="FilterHEDEdgeDetection";const DB=u.memo(({onChange:e,config:t})=>{const{t:n}=A(),s=u.useCallback(i=>{e({...t,coarse:i.target.checked})},[t,e]);return r.jsx(r.Fragment,{children:r.jsxs(K,{children:[r.jsx(J,{m:0,children:n("controlLayers.filter.lineart_edge_detection.coarse")}),r.jsx(et,{isChecked:t.coarse,onChange:s})]})})});DB.displayName="FilterLineartEdgeDetection";const Fm=Nn.mediapipe_face_detection.buildDefaults(),RB=u.memo(({onChange:e,config:t})=>{const{t:n}=A(),s=u.useCallback(o=>{e({...t,max_faces:o})},[t,e]),i=u.useCallback(o=>{e({...t,min_confidence:o})},[t,e]);return r.jsxs(r.Fragment,{children:[r.jsxs(K,{children:[r.jsx(J,{m:0,children:n("controlLayers.filter.mediapipe_face_detection.max_faces")}),r.jsx(Ze,{value:t.max_faces,onChange:s,defaultValue:Fm.max_faces,min:1,max:20,marks:!0}),r.jsx(Ie,{value:t.max_faces,onChange:s,defaultValue:Fm.max_faces,min:1,max:20})]}),r.jsxs(K,{children:[r.jsx(J,{m:0,children:n("controlLayers.filter.mediapipe_face_detection.min_confidence")}),r.jsx(Ze,{value:t.min_confidence,onChange:i,defaultValue:Fm.min_confidence,min:0,max:1,step:.01,marks:!0}),r.jsx(Ie,{value:t.min_confidence,onChange:i,defaultValue:Fm.min_confidence,min:0,max:1,step:.01})]})]})});RB.displayName="FilterMediaPipeFaceDetection";const Bm=Nn.mlsd_detection.buildDefaults(),OB=u.memo(({onChange:e,config:t})=>{const{t:n}=A(),s=u.useCallback(o=>{e({...t,distance_threshold:o})},[t,e]),i=u.useCallback(o=>{e({...t,score_threshold:o})},[t,e]);return r.jsxs(r.Fragment,{children:[r.jsxs(K,{children:[r.jsxs(J,{m:0,children:[n("controlLayers.filter.mlsd_detection.score_threshold")," "]}),r.jsx(Ze,{value:t.score_threshold,onChange:i,defaultValue:Bm.score_threshold,min:0,max:1,step:.01,marks:!0}),r.jsx(Ie,{value:t.score_threshold,onChange:i,defaultValue:Bm.score_threshold,min:0,max:1,step:.01})]}),r.jsxs(K,{children:[r.jsxs(J,{m:0,children:[n("controlLayers.filter.mlsd_detection.distance_threshold")," "]}),r.jsx(Ze,{value:t.distance_threshold,onChange:s,defaultValue:Bm.distance_threshold,min:0,max:100,step:1,marks:!0}),r.jsx(Ie,{value:t.distance_threshold,onChange:s,defaultValue:Bm.distance_threshold,min:0,max:1e3,step:1})]})]})});OB.displayName="FilterMLSDDetection";const zh=Nn.img_noise.buildDefaults(),NB=u.memo(({onChange:e,config:t})=>{const{t:n}=A(),s=u.useCallback(d=>{S2e(d==null?void 0:d.value)&&e({...t,noise_type:d.value})},[t,e]),i=u.useCallback(d=>{e({...t,amount:d})},[t,e]),o=u.useCallback(d=>{e({...t,noise_color:d.target.checked})},[t,e]),a=u.useCallback(d=>{e({...t,size:d})},[t,e]),l=u.useMemo(()=>[{label:n("controlLayers.filter.img_noise.gaussian_type"),value:"gaussian"},{label:n("controlLayers.filter.img_noise.salt_and_pepper_type"),value:"salt_and_pepper"}],[n]),c=u.useMemo(()=>l.filter(d=>d.value===t.noise_type)[0],[l,t.noise_type]);return r.jsxs(r.Fragment,{children:[r.jsxs(K,{children:[r.jsx(J,{m:0,children:n("controlLayers.filter.img_noise.noise_type")}),r.jsx(Ne,{value:c,options:l,onChange:s,isSearchable:!1})]}),r.jsxs(K,{children:[r.jsx(J,{m:0,children:n("controlLayers.filter.img_noise.noise_amount")}),r.jsx(Ze,{value:t.amount,defaultValue:zh.amount,onChange:i,min:0,max:1,step:.01,marks:!0}),r.jsx(Ie,{value:t.amount,defaultValue:zh.amount,onChange:i,min:0,max:1,step:.01})]}),r.jsxs(K,{children:[r.jsx(J,{m:0,children:n("controlLayers.filter.img_noise.size")}),r.jsx(Ze,{value:t.size,defaultValue:zh.size,onChange:a,min:1,max:16,step:1,marks:!0}),r.jsx(Ie,{value:t.size,defaultValue:zh.size,onChange:a,min:1,max:256,step:1})]}),r.jsxs(K,{w:"max-content",children:[r.jsx(J,{m:0,children:n("controlLayers.filter.img_noise.noise_color")}),r.jsx(et,{defaultChecked:zh.noise_color,isChecked:t.noise_color,onChange:o})]})]})});NB.displayName="Filternoise";const FB=({onChange:e,config:t})=>{const{t:n}=A(),s=u.useCallback(o=>{e({...t,scribble:o.target.checked})},[t,e]),i=u.useCallback(o=>{e({...t,quantize_edges:o.target.checked})},[t,e]);return r.jsxs(r.Fragment,{children:[r.jsxs(K,{children:[r.jsx(J,{m:0,children:n("controlLayers.filter.pidi_edge_detection.scribble")}),r.jsx(et,{isChecked:t.scribble,onChange:s})]}),r.jsxs(K,{children:[r.jsx(J,{m:0,children:n("controlLayers.filter.pidi_edge_detection.quantize_edges")}),r.jsx(et,{isChecked:t.quantize_edges,onChange:i})]})]})};FB.displayName="FilterPiDiNetEdgeDetection";const ll=e=>{const{t}=A(),{modelConfigs:n,selectedModel:s,getIsDisabled:i,onChange:o,isLoading:a,optionsFilter:l=()=>!0}=e,c=I(My),d=u.useMemo(()=>n.filter(l).map(m=>({label:m.name,value:m.key,description:c&&m.description||void 0,isDisabled:i?i(m):!1})),[l,i,n,c]),h=u.useMemo(()=>d.find(m=>s?m.value===s.key:!1),[d,s]),f=u.useCallback(m=>{if(!m){o(null);return}const y=n.find(b=>b.key===m.value);if(!y){o(null);return}o(y)},[n,o]),p=u.useMemo(()=>a?t("common.loading"):d.length===0?t("models.noModelsAvailable"):t("models.selectModel"),[a,d,t]),g=u.useCallback(()=>t("models.noMatchingModels"),[t]);return{options:d,value:h,onChange:f,placeholder:p,noOptionsMessage:g}},aE=Nn.spandrel_filter.buildDefaults(),BB=({onChange:e,config:t})=>{const{t:n}=A(),[s,{isLoading:i}]=fg(),o=u.useMemo(()=>{var m;if(!(!s.length||!t.model))return(m=s.find(y=>{var b;return y.key===((b=t.model)==null?void 0:b.key)}))==null?void 0:m.description},[s,t.model]),a=u.useCallback(m=>{e({...t,model:m})},[t,e]),{options:l,value:c,onChange:d,placeholder:h,noOptionsMessage:f}=ll({modelConfigs:s,onChange:a,selectedModel:t.model,isLoading:i}),p=u.useCallback(m=>{e({...t,scale:m})},[e,t]),g=u.useCallback(m=>{e({...t,autoScale:m.target.checked})},[e,t]);return u.useEffect(()=>{const m=l[0];!t.model&&m&&d(m)},[t.model,d,l]),r.jsxs(r.Fragment,{children:[r.jsxs(K,{w:"full",orientation:"vertical",children:[r.jsxs(T,{w:"full",alignItems:"center",children:[r.jsx(J,{m:0,flexGrow:1,children:n("controlLayers.filter.spandrel_filter.autoScale")}),r.jsx(et,{size:"sm",isChecked:t.autoScale,onChange:g})]}),r.jsx(Js,{children:n("controlLayers.filter.spandrel_filter.autoScaleDesc")})]}),r.jsxs(K,{isDisabled:!t.autoScale,children:[r.jsx(J,{m:0,children:n("controlLayers.filter.spandrel_filter.scale")}),r.jsx(Ze,{value:t.scale,onChange:p,defaultValue:aE.scale,min:1,max:16}),r.jsx(Ie,{value:t.scale,onChange:p,defaultValue:aE.scale,min:1,max:16})]}),r.jsxs(K,{children:[r.jsx(J,{m:0,children:n("controlLayers.filter.spandrel_filter.model")}),r.jsx(Ee,{label:o,children:r.jsx(Se,{w:"full",children:r.jsx(Ne,{value:c,placeholder:h,options:l,onChange:d,noOptionsMessage:f,isDisabled:l.length===0})})})]})]})};BB.displayName="FilterSpandrel";const $B=u.memo(({filterConfig:e,onChange:t})=>{const{t:n}=A();return e.type==="adjust_image"?r.jsx(_B,{config:e,onChange:t}):e.type==="canny_edge_detection"?r.jsx(TB,{config:e,onChange:t}):e.type==="color_map"?r.jsx(AB,{config:e,onChange:t}):e.type==="content_shuffle"?r.jsx(EB,{config:e,onChange:t}):e.type==="depth_anything_depth_estimation"?r.jsx(MB,{config:e,onChange:t}):e.type==="dw_openpose_detection"?r.jsx(PB,{config:e,onChange:t}):e.type==="hed_edge_detection"?r.jsx(LB,{config:e,onChange:t}):e.type==="lineart_edge_detection"?r.jsx(DB,{config:e,onChange:t}):e.type==="mediapipe_face_detection"?r.jsx(RB,{config:e,onChange:t}):e.type==="mlsd_detection"?r.jsx(OB,{config:e,onChange:t}):e.type==="pidi_edge_detection"?r.jsx(FB,{config:e,onChange:t}):e.type==="img_blur"?r.jsx(IB,{config:e,onChange:t}):e.type==="img_noise"?r.jsx(NB,{config:e,onChange:t}):e.type==="spandrel_filter"?r.jsx(BB,{config:e,onChange:t}):r.jsx(Pt,{py:4,label:`${n(`controlLayers.filter.${e.type}.label`)} has no settings`,icon:null})});$B.displayName="Filter";const I2e=fe(Pr,e=>e.sd.disabledControlNetProcessors),VB=u.memo(({filterType:e,onChange:t})=>{const{t:n}=A(),s=I(I2e),i=u.useMemo(()=>fo(Nn,(l,c)=>({value:c,label:n(`controlLayers.filter.${c}.label`)})).filter(l=>!Jae(s,l.value)),[s,n]),o=u.useCallback(l=>{l&&(we(jB(l.value)),t(l.value))},[t]),a=u.useMemo(()=>i.find(l=>l.value===e)??null,[i,e]);return r.jsx(T,{gap:2,children:r.jsxs(K,{children:[r.jsx(ze,{feature:"controlNetProcessor",children:r.jsx(J,{m:0,children:n("controlLayers.filter.filterType")})}),r.jsx(Ne,{value:a,options:i,onChange:o,isSearchable:!1,isClearable:!1})]})})});VB.displayName="FilterTypeSelect";const zB=u.memo(({adapter:e})=>{const{t}=A(),n=ae(e.filterer.$filterConfig),s=ae(e.filterer.$isProcessing),i=ae(e.filterer.$hasImageState),o=I(Vp),a=u.useCallback(g=>{e.filterer.$filterConfig.set(g)},[e.filterer.$filterConfig]),l=u.useCallback(g=>{e.filterer.$filterConfig.set(Nn[g].buildDefaults())},[e.filterer.$filterConfig]),c=u.useMemo(()=>{var g,m;return((m=(g=Nn[n.type]).validateConfig)==null?void 0:m.call(g,n))??!0},[n]),d=u.useCallback(()=>{e.filterer.saveAs("inpaint_mask")},[e.filterer]),h=u.useCallback(()=>{e.filterer.saveAs("regional_guidance")},[e.filterer]),f=u.useCallback(()=>{e.filterer.saveAs("raster_layer")},[e.filterer]),p=u.useCallback(()=>{e.filterer.saveAs("control_layer")},[e.filterer]);return r.jsxs(r.Fragment,{children:[r.jsxs(T,{w:"full",gap:4,children:[r.jsx(Ft,{size:"md",color:"base.300",userSelect:"none",children:t("controlLayers.filter.filter")}),r.jsx(it,{}),r.jsx(f_,{}),r.jsx(Db,{})]}),r.jsx(VB,{filterType:n.type,onChange:l}),r.jsx($B,{filterConfig:n,onChange:a}),r.jsxs(Zn,{isAttached:!1,size:"sm",w:"full",children:[r.jsxs(de,{variant:"ghost",onClick:e.filterer.processImmediate,loadingText:t("controlLayers.filter.process"),isDisabled:s||!c||o&&i,children:[t("controlLayers.filter.process"),s&&r.jsx(Lr,{ms:3,boxSize:5,color:"base.600"})]}),r.jsx(it,{}),r.jsx(de,{onClick:e.filterer.reset,isDisabled:s,loadingText:t("controlLayers.filter.reset"),variant:"ghost",children:t("controlLayers.filter.reset")}),r.jsx(de,{onClick:e.filterer.apply,loadingText:t("controlLayers.filter.apply"),variant:"ghost",isDisabled:s||!c||!i,children:t("controlLayers.filter.apply")}),r.jsxs(en,{children:[r.jsx(tn,{as:de,loadingText:t("controlLayers.selectObject.saveAs"),variant:"ghost",isDisabled:s||!c||!i,rightIcon:r.jsx(Di,{}),children:t("controlLayers.selectObject.saveAs")}),r.jsxs(Tt,{children:[r.jsx(pe,{isDisabled:s||!c||!i,onClick:d,children:t("controlLayers.newInpaintMask")}),r.jsx(pe,{isDisabled:s||!c||!i,onClick:h,children:t("controlLayers.newRegionalGuidance")}),r.jsx(pe,{isDisabled:s||!c||!i,onClick:p,children:t("controlLayers.newControlLayer")}),r.jsx(pe,{isDisabled:s||!c||!i,onClick:f,children:t("controlLayers.newRasterLayer")})]})]}),r.jsx(de,{variant:"ghost",onClick:e.filterer.cancel,loadingText:t("controlLayers.filter.cancel"),children:t("controlLayers.filter.cancel")})]})]})});zB.displayName="FilterContentAdvanced";const GB=u.memo(({adapter:e})=>{const{t}=A(),n=ae(e.filterer.$filterConfig),s=ae(e.filterer.$isProcessing),i=ae(e.filterer.$hasImageState),o=u.useMemo(()=>{var l,c;return((c=(l=Nn[n.type]).validateConfig)==null?void 0:c.call(l,n))??!0},[n]),a=u.useCallback(()=>{e.filterer.$simple.set(!1)},[e.filterer.$simple]);return r.jsxs(r.Fragment,{children:[r.jsxs(T,{w:"full",gap:4,children:[r.jsx(Ft,{size:"md",color:"base.300",userSelect:"none",children:t("controlLayers.filter.filter")}),r.jsx(it,{})]}),r.jsxs(T,{flexDir:"column",w:"full",gap:2,pb:2,children:[r.jsx(q,{color:"base.500",textAlign:"center",children:t("controlLayers.filter.processingLayerWith",{type:t(`controlLayers.filter.${n.type}.label`)})}),r.jsx(q,{color:"base.500",textAlign:"center",children:t("controlLayers.filter.forMoreControl")})]}),r.jsxs(Zn,{isAttached:!1,size:"sm",w:"full",children:[r.jsx(de,{variant:"ghost",onClick:a,children:t("controlLayers.filter.advanced")}),r.jsx(it,{}),r.jsx(de,{onClick:e.filterer.apply,loadingText:t("controlLayers.filter.apply"),variant:"ghost",isDisabled:s||!o||!i,children:t("controlLayers.filter.apply")}),r.jsx(de,{variant:"ghost",onClick:e.filterer.cancel,loadingText:t("controlLayers.filter.cancel"),children:t("controlLayers.filter.cancel")})]})]})});GB.displayName="FilterContentSimple";const HB=()=>{const e=Lt(),t=ae(e.stateApi.$filteringAdapter);return t?r.jsx(WB,{adapter:t}):null};HB.displayName="Filter";const WB=u.memo(({adapter:e})=>{const t=ae(e.filterer.$simple),n=Ms("canvas"),s=ae(e.filterer.$isProcessing),i=u.useRef(null);return sg("canvas",i,{focusOnMount:!0}),Re({id:"applyFilter",category:"canvas",callback:e.filterer.apply,options:{enabled:!s&&n,enableOnFormTags:!0},dependencies:[e.filterer,s,n]}),Re({id:"cancelFilter",category:"canvas",callback:e.filterer.cancel,options:{enabled:!s&&n,enableOnFormTags:!0},dependencies:[e.filterer,s,n]}),r.jsxs(T,{ref:i,bg:"base.800",borderRadius:"base",p:4,flexDir:"column",gap:4,w:420,h:"auto",shadow:"dark-lg",transitionProperty:"height",transitionDuration:"normal",children:[t&&r.jsx(GB,{adapter:e}),!t&&r.jsx(zB,{adapter:e})]})});WB.displayName="FilterContent";const p_=u.memo(({label:e,value:t,color:n})=>r.jsxs(r.Fragment,{children:[r.jsx(xt,{children:r.jsxs(q,{textAlign:"end",children:[e,": "]})}),r.jsx(xt,{fontWeight:"semibold",children:r.jsx(q,{textAlign:"end",color:n,children:t})})]}));p_.displayName="CanvasHUDItem";const T2e=fe(iu,e=>e.rect),UB=u.memo(()=>{const{t:e}=A(),t=I(T2e);return r.jsx(p_,{label:e("controlLayers.HUD.bbox"),value:`${t.width}${t.height} px`})});UB.displayName="CanvasHUDItemBbox";const qB=u.memo(()=>{const{t:e}=A(),t=I(hP),n=I(YQ);return t==="none"?null:r.jsx(p_,{label:e("controlLayers.HUD.scaledBbox"),value:`${n.width}${n.height} px`})});qB.displayName="CanvasHUDItemScaledBbox";const KB=u.memo(()=>r.jsxs(Ar,{bg:"base.900",borderBottomEndRadius:"base",p:2,gap:1,borderRadius:"base",templateColumns:"1fr 1fr",opacity:.6,minW:64,children:[r.jsx(UB,{}),r.jsx(qB,{})]}));KB.displayName="CanvasHUD";class gf extends Map{constructor(n){super(n);k(this,"subscriptions",new Set);k(this,"lastSnapshot",null);k(this,"set",(n,s)=>(super.set(n,s),this.notifySubscribers(),this));k(this,"delete",n=>{const s=super.delete(n);return this.notifySubscribers(),s});k(this,"clear",()=>{super.clear(),this.notifySubscribers()});k(this,"notifySubscribers",()=>{for(const n of this.subscriptions)n()});k(this,"subscribe",n=>(this.subscriptions.add(n),()=>{this.subscriptions.delete(n)}));k(this,"getSnapshot",()=>{const n=new Map(this);return(!this.lastSnapshot||!this.areSnapshotsEqual(this.lastSnapshot,n))&&(this.lastSnapshot=n),this.lastSnapshot});k(this,"areSnapshotsEqual",(n,s)=>{if(n.size!==s.size)return!1;for(const[i,o]of n)if(!Object.is(o,s.get(i)))return!1;return!0})}}const Bc=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,ZB=new Set,rw=typeof process=="object"&&process?process:{},YB=(e,t,n,s)=>{typeof rw.emitWarning=="function"?rw.emitWarning(e,t,n,s):console.error(`[${n}] ${t}: ${e}`)};let C1=globalThis.AbortController,lE=globalThis.AbortSignal;var I3;if(typeof C1>"u"){lE=class{constructor(){k(this,"onabort");k(this,"_onabort",[]);k(this,"reason");k(this,"aborted",!1)}addEventListener(s,i){this._onabort.push(i)}},C1=class{constructor(){k(this,"signal",new lE);t()}abort(s){var i,o;if(!this.signal.aborted){this.signal.reason=s,this.signal.aborted=!0;for(const a of this.signal._onabort)a(s);(o=(i=this.signal).onabort)==null||o.call(i,s)}}};let e=((I3=rw.env)==null?void 0:I3.LRU_CACHE_IGNORE_AC_WARNING)!=="1";const t=()=>{e&&(e=!1,YB("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",t))}}const A2e=e=>!ZB.has(e),fa=e=>e&&e===Math.floor(e)&&e>0&&isFinite(e),XB=e=>fa(e)?e<=Math.pow(2,8)?Uint8Array:e<=Math.pow(2,16)?Uint16Array:e<=Math.pow(2,32)?Uint32Array:e<=Number.MAX_SAFE_INTEGER?w0:null:null;class w0 extends Array{constructor(t){super(t),this.fill(0)}}var Du;const Il=class Il{constructor(t,n){k(this,"heap");k(this,"length");if(!Q(Il,Du))throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new n(t),this.length=0}static create(t){const n=XB(t);if(!n)return[];Je(Il,Du,!0);const s=new Il(t,n);return Je(Il,Du,!1),s}push(t){this.heap[this.length++]=t}pop(){return this.heap[--this.length]}};Du=new WeakMap,Mt(Il,Du,!1);let iw=Il;var T3,A3,hi,hr,fi,pi,Ru,Ou,zn,gi,Dn,ln,ht,Bs,fr,Cs,es,mi,ts,yi,bi,pr,xi,Ia,$s,De,ow,Nl,Fo,wp,gr,QB,Fl,Nu,Sp,pa,ga,aw,S0,j0,an,lw,mf,ma,cw;const H4=class H4{constructor(t){Mt(this,De);Mt(this,hi);Mt(this,hr);Mt(this,fi);Mt(this,pi);Mt(this,Ru);Mt(this,Ou);k(this,"ttl");k(this,"ttlResolution");k(this,"ttlAutopurge");k(this,"updateAgeOnGet");k(this,"updateAgeOnHas");k(this,"allowStale");k(this,"noDisposeOnSet");k(this,"noUpdateTTL");k(this,"maxEntrySize");k(this,"sizeCalculation");k(this,"noDeleteOnFetchRejection");k(this,"noDeleteOnStaleGet");k(this,"allowStaleOnFetchAbort");k(this,"allowStaleOnFetchRejection");k(this,"ignoreFetchAbort");Mt(this,zn);Mt(this,gi);Mt(this,Dn);Mt(this,ln);Mt(this,ht);Mt(this,Bs);Mt(this,fr);Mt(this,Cs);Mt(this,es);Mt(this,mi);Mt(this,ts);Mt(this,yi);Mt(this,bi);Mt(this,pr);Mt(this,xi);Mt(this,Ia);Mt(this,$s);Mt(this,Nl,()=>{});Mt(this,Fo,()=>{});Mt(this,wp,()=>{});Mt(this,gr,()=>!1);Mt(this,Fl,t=>{});Mt(this,Nu,(t,n,s)=>{});Mt(this,Sp,(t,n,s,i)=>{if(s||i)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0});k(this,T3,"LRUCache");const{max:n=0,ttl:s,ttlResolution:i=1,ttlAutopurge:o,updateAgeOnGet:a,updateAgeOnHas:l,allowStale:c,dispose:d,disposeAfter:h,noDisposeOnSet:f,noUpdateTTL:p,maxSize:g=0,maxEntrySize:m=0,sizeCalculation:y,fetchMethod:b,memoMethod:C,noDeleteOnFetchRejection:x,noDeleteOnStaleGet:v,allowStaleOnFetchRejection:w,allowStaleOnFetchAbort:S,ignoreFetchAbort:j}=t;if(n!==0&&!fa(n))throw new TypeError("max option must be a nonnegative integer");const P=n?XB(n):Array;if(!P)throw new Error("invalid max value: "+n);if(Je(this,hi,n),Je(this,hr,g),this.maxEntrySize=m||Q(this,hr),this.sizeCalculation=y,this.sizeCalculation){if(!Q(this,hr)&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(C!==void 0&&typeof C!="function")throw new TypeError("memoMethod must be a function if defined");if(Je(this,Ou,C),b!==void 0&&typeof b!="function")throw new TypeError("fetchMethod must be a function if specified");if(Je(this,Ru,b),Je(this,Ia,!!b),Je(this,Dn,new Map),Je(this,ln,new Array(n).fill(void 0)),Je(this,ht,new Array(n).fill(void 0)),Je(this,Bs,new P(n)),Je(this,fr,new P(n)),Je(this,Cs,0),Je(this,es,0),Je(this,mi,iw.create(n)),Je(this,zn,0),Je(this,gi,0),typeof d=="function"&&Je(this,fi,d),typeof h=="function"?(Je(this,pi,h),Je(this,ts,[])):(Je(this,pi,void 0),Je(this,ts,void 0)),Je(this,xi,!!Q(this,fi)),Je(this,$s,!!Q(this,pi)),this.noDisposeOnSet=!!f,this.noUpdateTTL=!!p,this.noDeleteOnFetchRejection=!!x,this.allowStaleOnFetchRejection=!!w,this.allowStaleOnFetchAbort=!!S,this.ignoreFetchAbort=!!j,this.maxEntrySize!==0){if(Q(this,hr)!==0&&!fa(Q(this,hr)))throw new TypeError("maxSize must be a positive integer if specified");if(!fa(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");We(this,De,QB).call(this)}if(this.allowStale=!!c,this.noDeleteOnStaleGet=!!v,this.updateAgeOnGet=!!a,this.updateAgeOnHas=!!l,this.ttlResolution=fa(i)||i===0?i:1,this.ttlAutopurge=!!o,this.ttl=s||0,this.ttl){if(!fa(this.ttl))throw new TypeError("ttl must be a positive integer if specified");We(this,De,ow).call(this)}if(Q(this,hi)===0&&this.ttl===0&&Q(this,hr)===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!Q(this,hi)&&!Q(this,hr)){const E="LRU_CACHE_UNBOUNDED";A2e(E)&&(ZB.add(E),YB("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",E,H4))}}static unsafeExposeInternals(t){return{starts:Q(t,bi),ttls:Q(t,pr),sizes:Q(t,yi),keyMap:Q(t,Dn),keyList:Q(t,ln),valList:Q(t,ht),next:Q(t,Bs),prev:Q(t,fr),get head(){return Q(t,Cs)},get tail(){return Q(t,es)},free:Q(t,mi),isBackgroundFetch:n=>{var s;return We(s=t,De,an).call(s,n)},backgroundFetch:(n,s,i,o)=>{var a;return We(a=t,De,j0).call(a,n,s,i,o)},moveToTail:n=>{var s;return We(s=t,De,mf).call(s,n)},indexes:n=>{var s;return We(s=t,De,pa).call(s,n)},rindexes:n=>{var s;return We(s=t,De,ga).call(s,n)},isStale:n=>{var s;return Q(s=t,gr).call(s,n)}}}get max(){return Q(this,hi)}get maxSize(){return Q(this,hr)}get calculatedSize(){return Q(this,gi)}get size(){return Q(this,zn)}get fetchMethod(){return Q(this,Ru)}get memoMethod(){return Q(this,Ou)}get dispose(){return Q(this,fi)}get disposeAfter(){return Q(this,pi)}getRemainingTTL(t){return Q(this,Dn).has(t)?1/0:0}*entries(){for(const t of We(this,De,pa).call(this))Q(this,ht)[t]!==void 0&&Q(this,ln)[t]!==void 0&&!We(this,De,an).call(this,Q(this,ht)[t])&&(yield[Q(this,ln)[t],Q(this,ht)[t]])}*rentries(){for(const t of We(this,De,ga).call(this))Q(this,ht)[t]!==void 0&&Q(this,ln)[t]!==void 0&&!We(this,De,an).call(this,Q(this,ht)[t])&&(yield[Q(this,ln)[t],Q(this,ht)[t]])}*keys(){for(const t of We(this,De,pa).call(this)){const n=Q(this,ln)[t];n!==void 0&&!We(this,De,an).call(this,Q(this,ht)[t])&&(yield n)}}*rkeys(){for(const t of We(this,De,ga).call(this)){const n=Q(this,ln)[t];n!==void 0&&!We(this,De,an).call(this,Q(this,ht)[t])&&(yield n)}}*values(){for(const t of We(this,De,pa).call(this))Q(this,ht)[t]!==void 0&&!We(this,De,an).call(this,Q(this,ht)[t])&&(yield Q(this,ht)[t])}*rvalues(){for(const t of We(this,De,ga).call(this))Q(this,ht)[t]!==void 0&&!We(this,De,an).call(this,Q(this,ht)[t])&&(yield Q(this,ht)[t])}[(A3=Symbol.iterator,T3=Symbol.toStringTag,A3)](){return this.entries()}find(t,n={}){for(const s of We(this,De,pa).call(this)){const i=Q(this,ht)[s],o=We(this,De,an).call(this,i)?i.__staleWhileFetching:i;if(o!==void 0&&t(o,Q(this,ln)[s],this))return this.get(Q(this,ln)[s],n)}}forEach(t,n=this){for(const s of We(this,De,pa).call(this)){const i=Q(this,ht)[s],o=We(this,De,an).call(this,i)?i.__staleWhileFetching:i;o!==void 0&&t.call(n,o,Q(this,ln)[s],this)}}rforEach(t,n=this){for(const s of We(this,De,ga).call(this)){const i=Q(this,ht)[s],o=We(this,De,an).call(this,i)?i.__staleWhileFetching:i;o!==void 0&&t.call(n,o,Q(this,ln)[s],this)}}purgeStale(){let t=!1;for(const n of We(this,De,ga).call(this,{allowStale:!0}))Q(this,gr).call(this,n)&&(We(this,De,ma).call(this,Q(this,ln)[n],"expire"),t=!0);return t}info(t){const n=Q(this,Dn).get(t);if(n===void 0)return;const s=Q(this,ht)[n],i=We(this,De,an).call(this,s)?s.__staleWhileFetching:s;if(i===void 0)return;const o={value:i};if(Q(this,pr)&&Q(this,bi)){const a=Q(this,pr)[n],l=Q(this,bi)[n];if(a&&l){const c=a-(Bc.now()-l);o.ttl=c,o.start=Date.now()}}return Q(this,yi)&&(o.size=Q(this,yi)[n]),o}dump(){const t=[];for(const n of We(this,De,pa).call(this,{allowStale:!0})){const s=Q(this,ln)[n],i=Q(this,ht)[n],o=We(this,De,an).call(this,i)?i.__staleWhileFetching:i;if(o===void 0||s===void 0)continue;const a={value:o};if(Q(this,pr)&&Q(this,bi)){a.ttl=Q(this,pr)[n];const l=Bc.now()-Q(this,bi)[n];a.start=Math.floor(Date.now()-l)}Q(this,yi)&&(a.size=Q(this,yi)[n]),t.unshift([s,a])}return t}load(t){this.clear();for(const[n,s]of t){if(s.start){const i=Date.now()-s.start;s.start=Bc.now()-i}this.set(n,s.value,s)}}set(t,n,s={}){var p,g,m,y,b;if(n===void 0)return this.delete(t),this;const{ttl:i=this.ttl,start:o,noDisposeOnSet:a=this.noDisposeOnSet,sizeCalculation:l=this.sizeCalculation,status:c}=s;let{noUpdateTTL:d=this.noUpdateTTL}=s;const h=Q(this,Sp).call(this,t,n,s.size||0,l);if(this.maxEntrySize&&h>this.maxEntrySize)return c&&(c.set="miss",c.maxEntrySizeExceeded=!0),We(this,De,ma).call(this,t,"set"),this;let f=Q(this,zn)===0?void 0:Q(this,Dn).get(t);if(f===void 0)f=Q(this,zn)===0?Q(this,es):Q(this,mi).length!==0?Q(this,mi).pop():Q(this,zn)===Q(this,hi)?We(this,De,S0).call(this,!1):Q(this,zn),Q(this,ln)[f]=t,Q(this,ht)[f]=n,Q(this,Dn).set(t,f),Q(this,Bs)[Q(this,es)]=f,Q(this,fr)[f]=Q(this,es),Je(this,es,f),rm(this,zn)._++,Q(this,Nu).call(this,f,h,c),c&&(c.set="add"),d=!1;else{We(this,De,mf).call(this,f);const C=Q(this,ht)[f];if(n!==C){if(Q(this,Ia)&&We(this,De,an).call(this,C)){C.__abortController.abort(new Error("replaced"));const{__staleWhileFetching:x}=C;x!==void 0&&!a&&(Q(this,xi)&&((p=Q(this,fi))==null||p.call(this,x,t,"set")),Q(this,$s)&&((g=Q(this,ts))==null||g.push([x,t,"set"])))}else a||(Q(this,xi)&&((m=Q(this,fi))==null||m.call(this,C,t,"set")),Q(this,$s)&&((y=Q(this,ts))==null||y.push([C,t,"set"])));if(Q(this,Fl).call(this,f),Q(this,Nu).call(this,f,h,c),Q(this,ht)[f]=n,c){c.set="replace";const x=C&&We(this,De,an).call(this,C)?C.__staleWhileFetching:C;x!==void 0&&(c.oldValue=x)}}else c&&(c.set="update")}if(i!==0&&!Q(this,pr)&&We(this,De,ow).call(this),Q(this,pr)&&(d||Q(this,wp).call(this,f,i,o),c&&Q(this,Fo).call(this,c,f)),!a&&Q(this,$s)&&Q(this,ts)){const C=Q(this,ts);let x;for(;x=C==null?void 0:C.shift();)(b=Q(this,pi))==null||b.call(this,...x)}return this}pop(){var t;try{for(;Q(this,zn);){const n=Q(this,ht)[Q(this,Cs)];if(We(this,De,S0).call(this,!0),We(this,De,an).call(this,n)){if(n.__staleWhileFetching)return n.__staleWhileFetching}else if(n!==void 0)return n}}finally{if(Q(this,$s)&&Q(this,ts)){const n=Q(this,ts);let s;for(;s=n==null?void 0:n.shift();)(t=Q(this,pi))==null||t.call(this,...s)}}}has(t,n={}){const{updateAgeOnHas:s=this.updateAgeOnHas,status:i}=n,o=Q(this,Dn).get(t);if(o!==void 0){const a=Q(this,ht)[o];if(We(this,De,an).call(this,a)&&a.__staleWhileFetching===void 0)return!1;if(Q(this,gr).call(this,o))i&&(i.has="stale",Q(this,Fo).call(this,i,o));else return s&&Q(this,Nl).call(this,o),i&&(i.has="hit",Q(this,Fo).call(this,i,o)),!0}else i&&(i.has="miss");return!1}peek(t,n={}){const{allowStale:s=this.allowStale}=n,i=Q(this,Dn).get(t);if(i===void 0||!s&&Q(this,gr).call(this,i))return;const o=Q(this,ht)[i];return We(this,De,an).call(this,o)?o.__staleWhileFetching:o}async fetch(t,n={}){const{allowStale:s=this.allowStale,updateAgeOnGet:i=this.updateAgeOnGet,noDeleteOnStaleGet:o=this.noDeleteOnStaleGet,ttl:a=this.ttl,noDisposeOnSet:l=this.noDisposeOnSet,size:c=0,sizeCalculation:d=this.sizeCalculation,noUpdateTTL:h=this.noUpdateTTL,noDeleteOnFetchRejection:f=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:p=this.allowStaleOnFetchRejection,ignoreFetchAbort:g=this.ignoreFetchAbort,allowStaleOnFetchAbort:m=this.allowStaleOnFetchAbort,context:y,forceRefresh:b=!1,status:C,signal:x}=n;if(!Q(this,Ia))return C&&(C.fetch="get"),this.get(t,{allowStale:s,updateAgeOnGet:i,noDeleteOnStaleGet:o,status:C});const v={allowStale:s,updateAgeOnGet:i,noDeleteOnStaleGet:o,ttl:a,noDisposeOnSet:l,size:c,sizeCalculation:d,noUpdateTTL:h,noDeleteOnFetchRejection:f,allowStaleOnFetchRejection:p,allowStaleOnFetchAbort:m,ignoreFetchAbort:g,status:C,signal:x};let w=Q(this,Dn).get(t);if(w===void 0){C&&(C.fetch="miss");const S=We(this,De,j0).call(this,t,w,v,y);return S.__returned=S}else{const S=Q(this,ht)[w];if(We(this,De,an).call(this,S)){const M=s&&S.__staleWhileFetching!==void 0;return C&&(C.fetch="inflight",M&&(C.returnedStale=!0)),M?S.__staleWhileFetching:S.__returned=S}const j=Q(this,gr).call(this,w);if(!b&&!j)return C&&(C.fetch="hit"),We(this,De,mf).call(this,w),i&&Q(this,Nl).call(this,w),C&&Q(this,Fo).call(this,C,w),S;const P=We(this,De,j0).call(this,t,w,v,y),D=P.__staleWhileFetching!==void 0&&s;return C&&(C.fetch=j?"stale":"refresh",D&&j&&(C.returnedStale=!0)),D?P.__staleWhileFetching:P.__returned=P}}async forceFetch(t,n={}){const s=await this.fetch(t,n);if(s===void 0)throw new Error("fetch() returned undefined");return s}memo(t,n={}){const s=Q(this,Ou);if(!s)throw new Error("no memoMethod provided to constructor");const{context:i,forceRefresh:o,...a}=n,l=this.get(t,a);if(!o&&l!==void 0)return l;const c=s(t,l,{options:a,context:i});return this.set(t,c,a),c}get(t,n={}){const{allowStale:s=this.allowStale,updateAgeOnGet:i=this.updateAgeOnGet,noDeleteOnStaleGet:o=this.noDeleteOnStaleGet,status:a}=n,l=Q(this,Dn).get(t);if(l!==void 0){const c=Q(this,ht)[l],d=We(this,De,an).call(this,c);return a&&Q(this,Fo).call(this,a,l),Q(this,gr).call(this,l)?(a&&(a.get="stale"),d?(a&&s&&c.__staleWhileFetching!==void 0&&(a.returnedStale=!0),s?c.__staleWhileFetching:void 0):(o||We(this,De,ma).call(this,t,"expire"),a&&s&&(a.returnedStale=!0),s?c:void 0)):(a&&(a.get="hit"),d?c.__staleWhileFetching:(We(this,De,mf).call(this,l),i&&Q(this,Nl).call(this,l),c))}else a&&(a.get="miss")}delete(t){return We(this,De,ma).call(this,t,"delete")}clear(){return We(this,De,cw).call(this,"delete")}};hi=new WeakMap,hr=new WeakMap,fi=new WeakMap,pi=new WeakMap,Ru=new WeakMap,Ou=new WeakMap,zn=new WeakMap,gi=new WeakMap,Dn=new WeakMap,ln=new WeakMap,ht=new WeakMap,Bs=new WeakMap,fr=new WeakMap,Cs=new WeakMap,es=new WeakMap,mi=new WeakMap,ts=new WeakMap,yi=new WeakMap,bi=new WeakMap,pr=new WeakMap,xi=new WeakMap,Ia=new WeakMap,$s=new WeakMap,De=new WeakSet,ow=function(){const t=new w0(Q(this,hi)),n=new w0(Q(this,hi));Je(this,pr,t),Je(this,bi,n),Je(this,wp,(o,a,l=Bc.now())=>{if(n[o]=a!==0?l:0,t[o]=a,a!==0&&this.ttlAutopurge){const c=setTimeout(()=>{Q(this,gr).call(this,o)&&We(this,De,ma).call(this,Q(this,ln)[o],"expire")},a+1);c.unref&&c.unref()}}),Je(this,Nl,o=>{n[o]=t[o]!==0?Bc.now():0}),Je(this,Fo,(o,a)=>{if(t[a]){const l=t[a],c=n[a];if(!l||!c)return;o.ttl=l,o.start=c,o.now=s||i();const d=o.now-c;o.remainingTTL=l-d}});let s=0;const i=()=>{const o=Bc.now();if(this.ttlResolution>0){s=o;const a=setTimeout(()=>s=0,this.ttlResolution);a.unref&&a.unref()}return o};this.getRemainingTTL=o=>{const a=Q(this,Dn).get(o);if(a===void 0)return 0;const l=t[a],c=n[a];if(!l||!c)return 1/0;const d=(s||i())-c;return l-d},Je(this,gr,o=>{const a=n[o],l=t[o];return!!l&&!!a&&(s||i())-a>l})},Nl=new WeakMap,Fo=new WeakMap,wp=new WeakMap,gr=new WeakMap,QB=function(){const t=new w0(Q(this,hi));Je(this,gi,0),Je(this,yi,t),Je(this,Fl,n=>{Je(this,gi,Q(this,gi)-t[n]),t[n]=0}),Je(this,Sp,(n,s,i,o)=>{if(We(this,De,an).call(this,s))return 0;if(!fa(i))if(o){if(typeof o!="function")throw new TypeError("sizeCalculation must be a function");if(i=o(s,n),!fa(i))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}else throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");return i}),Je(this,Nu,(n,s,i)=>{if(t[n]=s,Q(this,hr)){const o=Q(this,hr)-t[n];for(;Q(this,gi)>o;)We(this,De,S0).call(this,!0)}Je(this,gi,Q(this,gi)+t[n]),i&&(i.entrySize=s,i.totalCalculatedSize=Q(this,gi))})},Fl=new WeakMap,Nu=new WeakMap,Sp=new WeakMap,pa=function*({allowStale:t=this.allowStale}={}){if(Q(this,zn))for(let n=Q(this,es);!(!We(this,De,aw).call(this,n)||((t||!Q(this,gr).call(this,n))&&(yield n),n===Q(this,Cs)));)n=Q(this,fr)[n]},ga=function*({allowStale:t=this.allowStale}={}){if(Q(this,zn))for(let n=Q(this,Cs);!(!We(this,De,aw).call(this,n)||((t||!Q(this,gr).call(this,n))&&(yield n),n===Q(this,es)));)n=Q(this,Bs)[n]},aw=function(t){return t!==void 0&&Q(this,Dn).get(Q(this,ln)[t])===t},S0=function(t){var o,a;const n=Q(this,Cs),s=Q(this,ln)[n],i=Q(this,ht)[n];return Q(this,Ia)&&We(this,De,an).call(this,i)?i.__abortController.abort(new Error("evicted")):(Q(this,xi)||Q(this,$s))&&(Q(this,xi)&&((o=Q(this,fi))==null||o.call(this,i,s,"evict")),Q(this,$s)&&((a=Q(this,ts))==null||a.push([i,s,"evict"]))),Q(this,Fl).call(this,n),t&&(Q(this,ln)[n]=void 0,Q(this,ht)[n]=void 0,Q(this,mi).push(n)),Q(this,zn)===1?(Je(this,Cs,Je(this,es,0)),Q(this,mi).length=0):Je(this,Cs,Q(this,Bs)[n]),Q(this,Dn).delete(s),rm(this,zn)._--,n},j0=function(t,n,s,i){const o=n===void 0?void 0:Q(this,ht)[n];if(We(this,De,an).call(this,o))return o;const a=new C1,{signal:l}=s;l==null||l.addEventListener("abort",()=>a.abort(l.reason),{signal:a.signal});const c={signal:a.signal,options:s,context:i},d=(y,b=!1)=>{const{aborted:C}=a.signal,x=s.ignoreFetchAbort&&y!==void 0;if(s.status&&(C&&!b?(s.status.fetchAborted=!0,s.status.fetchError=a.signal.reason,x&&(s.status.fetchAbortIgnored=!0)):s.status.fetchResolved=!0),C&&!x&&!b)return f(a.signal.reason);const v=g;return Q(this,ht)[n]===g&&(y===void 0?v.__staleWhileFetching?Q(this,ht)[n]=v.__staleWhileFetching:We(this,De,ma).call(this,t,"fetch"):(s.status&&(s.status.fetchUpdated=!0),this.set(t,y,c.options))),y},h=y=>(s.status&&(s.status.fetchRejected=!0,s.status.fetchError=y),f(y)),f=y=>{const{aborted:b}=a.signal,C=b&&s.allowStaleOnFetchAbort,x=C||s.allowStaleOnFetchRejection,v=x||s.noDeleteOnFetchRejection,w=g;if(Q(this,ht)[n]===g&&(!v||w.__staleWhileFetching===void 0?We(this,De,ma).call(this,t,"fetch"):C||(Q(this,ht)[n]=w.__staleWhileFetching)),x)return s.status&&w.__staleWhileFetching!==void 0&&(s.status.returnedStale=!0),w.__staleWhileFetching;if(w.__returned===w)throw y},p=(y,b)=>{var x;const C=(x=Q(this,Ru))==null?void 0:x.call(this,t,o,c);C&&C instanceof Promise&&C.then(v=>y(v===void 0?void 0:v),b),a.signal.addEventListener("abort",()=>{(!s.ignoreFetchAbort||s.allowStaleOnFetchAbort)&&(y(void 0),s.allowStaleOnFetchAbort&&(y=v=>d(v,!0)))})};s.status&&(s.status.fetchDispatched=!0);const g=new Promise(p).then(d,h),m=Object.assign(g,{__abortController:a,__staleWhileFetching:o,__returned:void 0});return n===void 0?(this.set(t,m,{...c.options,status:void 0}),n=Q(this,Dn).get(t)):Q(this,ht)[n]=m,m},an=function(t){if(!Q(this,Ia))return!1;const n=t;return!!n&&n instanceof Promise&&n.hasOwnProperty("__staleWhileFetching")&&n.__abortController instanceof C1},lw=function(t,n){Q(this,fr)[n]=t,Q(this,Bs)[t]=n},mf=function(t){t!==Q(this,es)&&(t===Q(this,Cs)?Je(this,Cs,Q(this,Bs)[t]):We(this,De,lw).call(this,Q(this,fr)[t],Q(this,Bs)[t]),We(this,De,lw).call(this,Q(this,es),t),Je(this,es,t))},ma=function(t,n){var i,o,a,l;let s=!1;if(Q(this,zn)!==0){const c=Q(this,Dn).get(t);if(c!==void 0)if(s=!0,Q(this,zn)===1)We(this,De,cw).call(this,n);else{Q(this,Fl).call(this,c);const d=Q(this,ht)[c];if(We(this,De,an).call(this,d)?d.__abortController.abort(new Error("deleted")):(Q(this,xi)||Q(this,$s))&&(Q(this,xi)&&((i=Q(this,fi))==null||i.call(this,d,t,n)),Q(this,$s)&&((o=Q(this,ts))==null||o.push([d,t,n]))),Q(this,Dn).delete(t),Q(this,ln)[c]=void 0,Q(this,ht)[c]=void 0,c===Q(this,es))Je(this,es,Q(this,fr)[c]);else if(c===Q(this,Cs))Je(this,Cs,Q(this,Bs)[c]);else{const h=Q(this,fr)[c];Q(this,Bs)[h]=Q(this,Bs)[c];const f=Q(this,Bs)[c];Q(this,fr)[f]=Q(this,fr)[c]}rm(this,zn)._--,Q(this,mi).push(c)}}if(Q(this,$s)&&((a=Q(this,ts))!=null&&a.length)){const c=Q(this,ts);let d;for(;d=c==null?void 0:c.shift();)(l=Q(this,pi))==null||l.call(this,...d)}return s},cw=function(t){var n,s,i;for(const o of We(this,De,ga).call(this,{allowStale:!0})){const a=Q(this,ht)[o];if(We(this,De,an).call(this,a))a.__abortController.abort(new Error("deleted"));else{const l=Q(this,ln)[o];Q(this,xi)&&((n=Q(this,fi))==null||n.call(this,a,l,t)),Q(this,$s)&&((s=Q(this,ts))==null||s.push([a,l,t]))}}if(Q(this,Dn).clear(),Q(this,ht).fill(void 0),Q(this,ln).fill(void 0),Q(this,pr)&&Q(this,bi)&&(Q(this,pr).fill(0),Q(this,bi).fill(0)),Q(this,yi)&&Q(this,yi).fill(0),Je(this,Cs,0),Je(this,es,0),Q(this,mi).length=0,Je(this,gi,0),Je(this,zn,0),Q(this,$s)&&Q(this,ts)){const o=Q(this,ts);let a;for(;a=o==null?void 0:o.shift();)(i=Q(this,pi))==null||i.call(this,...a)}};let jl=H4;const E2e={imageNameCacheSize:1e3,imageDataCacheSize:32,transparencyCalculationCacheSize:1e3,canvasElementCacheSize:32,generationModeCacheSize:100};class w1 extends zt{constructor(n){super();k(this,"type","cache");k(this,"id");k(this,"path");k(this,"log");k(this,"parent");k(this,"manager");k(this,"config",E2e);k(this,"imageNameCache",new jl({max:this.config.imageNameCacheSize}));k(this,"canvasElementCache",new jl({max:this.config.canvasElementCacheSize}));k(this,"imageDataCache",new jl({max:this.config.imageDataCacheSize}));k(this,"transparencyCalculationCache",new jl({max:this.config.imageDataCacheSize}));k(this,"generationModeCache",new jl({max:this.config.generationModeCacheSize}));k(this,"clearAll",()=>{this.canvasElementCache.clear(),this.imageNameCache.clear(),this.generationModeCache.clear()});k(this,"destroy",()=>{this.log.debug("Destroying cache module"),this.clearAll()});this.id=Te("cache"),this.manager=n,this.parent=n,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating cache module")}}k(w1,"getWithFallback",async({cache:n,getValue:s,key:i,onHit:o,onMiss:a})=>{let l=n.get(i);return l===void 0?(a==null||a(),l=await s(),n.set(i,l)):o==null||o(l),l});class M2e extends zt{constructor(n){super();k(this,"type","compositor");k(this,"id");k(this,"path");k(this,"log");k(this,"parent");k(this,"manager");k(this,"$isCompositing",Oe(!1));k(this,"$isProcessing",Oe(!1));k(this,"$isUploading",Oe(!1));k(this,"$isBusy",Wn([this.$isCompositing,this.$isProcessing,this.$isUploading],(n,s,i)=>n||s||i));k(this,"getVisibleRectOfType",n=>{const s=[];for(const i of this.manager.getAllAdapters())i.state.isEnabled&&(n&&i.state.type!==n||i.renderer.hasObjects()&&s.push(i.transformer.getRelativeRect()));return cI(...s)});k(this,"getRectOfAdapters",n=>{const s=[];for(const i of n)i.renderer.hasObjects()&&s.push(i.transformer.getRelativeRect());return cI(...s)});k(this,"getVisibleAdaptersOfType",n=>{let s;switch(n){case"raster_layer":s=this.manager.stateApi.getRasterLayersState().entities;break;case"inpaint_mask":s=this.manager.stateApi.getInpaintMasksState().entities;break;case"control_layer":s=this.manager.stateApi.getControlLayersState().entities;break;case"regional_guidance":s=this.manager.stateApi.getRegionsState().entities;break;default:we(!1,`Unhandled entity type: ${n}`)}return s.map(o=>tr(o)).map(this.manager.getAdapter).filter(o=>!!o).filter(o=>!o.$isDisabled.get()&&o.renderer.hasObjects())});k(this,"getCompositeHash",(n,s)=>{const i=[];for(const a of n)i.push(a.getHashableState());return Wf({extra:s,adapterHashes:i})});k(this,"getCompositeCanvas",(n,s,i)=>{const o=n.map(h=>h.entityIdentifier),a=this.getCompositeHash(n,{rect:s}),l=this.manager.cache.canvasElementCache.get(a);if(l)return this.log.debug({entityIdentifiers:o,rect:s},"Using cached composite canvas"),l;this.log.debug({entityIdentifiers:o,rect:s},"Building composite canvas"),this.$isCompositing.set(!0);const c=document.createElement("canvas");c.width=s.width,c.height=s.height;const d=c.getContext("2d");we(d!==null,"Canvas 2D context is null"),d.imageSmoothingEnabled=!1,i!=null&&i.globalCompositeOperation&&(d.globalCompositeOperation=i.globalCompositeOperation);for(const h of n){this.log.debug({entityIdentifier:h.entityIdentifier},"Drawing entity to composite canvas");const f=h.getCanvas(s);d.drawImage(f,0,0)}return this.manager.cache.canvasElementCache.set(a,c),this.$isCompositing.set(!1),c});k(this,"getCompositeImageDTO",async(n,s,i,o,a)=>{we(s.width>0&&s.height>0,"Unable to rasterize empty rect");const l=this.getCompositeHash(n,{rect:s}),c=a?void 0:this.manager.cache.imageNameCache.get(l);let d=null;if(c){if(d=await xy(c),d)return this.log.debug({rect:s,imageName:c,imageDTO:d},"Using cached composite image"),d;this.log.warn({rect:s,imageName:c},"Cached image name not found, recompositing")}const h=kS(()=>this.getCompositeCanvas(n,s,o));if(h.isErr())throw this.log.error({error:Un(h.error)},"Failed to get composite canvas"),h.error;this.$isProcessing.set(!0);const f=await fs(()=>Ay(h.value));if(this.$isProcessing.set(!1),f.isErr())throw this.log.error({error:Un(f.error)},"Failed to convert composite canvas to blob"),f.error;const p=f.value;this.manager._isDebugging&&fP(p,"Composite"),this.$isUploading.set(!0);const g=await fs(()=>Aa({file:new File([p],"canvas-composite.png",{type:"image/png"}),image_category:"general",...i}));if(this.$isUploading.set(!1),g.isErr())throw g.error;return d=g.value,this.manager.cache.imageNameCache.set(l,d.image_name),d});k(this,"mergeByEntityIdentifiers",async(n,s)=>{var h;if(ge({id:"MERGE_LAYERS_TOAST",title:Pe("controlLayers.mergingLayers"),withCount:!1}),n.length<=1)return this.log.warn({entityIdentifiers:n},"Cannot merge less than 2 entities"),null;const i=(h=n[0])==null?void 0:h.type;we(i,"Cannot merge entities with no type (this should never happen)");const o=this.manager.getAdapters(n);we(o.length===n.length,"Failed to get all adapters for entity identifiers");const a=this.getRectOfAdapters(o),l={globalCompositeOperation:i==="control_layer"?"lighter":void 0},c=await fs(()=>this.getCompositeImageDTO(o,a,{is_intermediate:!0},l));if(c.isErr())return this.log.error({error:Un(c.error)},"Failed to merge selected entities"),ge({id:"MERGE_LAYERS_TOAST",title:Pe("controlLayers.mergeVisibleError"),status:"error",withCount:!1}),null;const d={isSelected:!0,overrides:{objects:[Mi(c.value)],position:{x:Math.floor(a.x),y:Math.floor(a.y)}},mergedEntitiesToDelete:s?n.map(XQ):[]};switch(i){case"raster_layer":this.manager.stateApi.addRasterLayer(d);break;case"inpaint_mask":this.manager.stateApi.addInpaintMask(d);break;case"regional_guidance":this.manager.stateApi.addRegionalGuidance(d);break;case"control_layer":this.manager.stateApi.addControlLayer(d);break;default:we(!1,"Unsupported type for merge")}return ge({id:"MERGE_LAYERS_TOAST",title:Pe("controlLayers.mergeVisibleOk"),status:"success",withCount:!1}),c.value});k(this,"mergeVisibleOfType",n=>{let s;switch(n){case"raster_layer":s=this.manager.stateApi.runSelector(_S);break;case"inpaint_mask":s=this.manager.stateApi.runSelector(mP);break;case"regional_guidance":s=this.manager.stateApi.runSelector(gP);break;case"control_layer":s=this.manager.stateApi.runSelector(pP);break;default:we(!1,"Unsupported type for merge")}const i=s.map(tr);return this.mergeByEntityIdentifiers(i,!1)});k(this,"getTransparency",(n,s,i)=>{const a={entityIdentifiers:n.map(l=>l.entityIdentifier),rect:s};return w1.getWithFallback({cache:this.manager.cache.transparencyCalculationCache,key:i,getValue:async()=>{const l=this.getCompositeCanvas(n,s),c=await w1.getWithFallback({cache:this.manager.cache.imageDataCache,key:i,getValue:()=>Promise.resolve(yP(l)),onHit:()=>this.log.trace(a,"Using cached image data"),onMiss:()=>this.log.trace(a,"Calculating image data")});return QQ(c)},onHit:()=>this.log.trace(a,"Using cached transparency"),onMiss:()=>this.log.trace(a,"Calculating transparency")})});k(this,"getGenerationMode",async()=>{const{rect:n}=this.manager.stateApi.getBbox(),s=this.manager.compositor.getVisibleAdaptersOfType("raster_layer"),i=this.getCompositeHash(s,{rect:n}),o=this.manager.compositor.getVisibleAdaptersOfType("inpaint_mask"),a=this.getCompositeHash(o,{rect:n}),l=Wf({rect:n,compositeInpaintMaskHash:a,compositeRasterLayerHash:i}),c=this.manager.cache.generationModeCache.get(l);if(c)return this.log.debug({rect:n,cachedGenerationMode:c},"Using cached generation mode"),c;this.log.debug({rect:n},"Calculating generation mode"),this.$isProcessing.set(!0);const d=await fs(async()=>{const h=await this.getTransparency(s,n,i),f=await this.getTransparency(o,n,a);let p;return h==="FULLY_TRANSPARENT"?p="txt2img":h==="PARTIALLY_TRANSPARENT"?p="outpaint":f==="FULLY_TRANSPARENT"?p="img2img":p="inpaint",this.manager.cache.generationModeCache.set(l,p),p});if(this.$isProcessing.set(!1),d.isErr())throw this.log.error({error:Un(d.error)},"Failed to calculate generation mode"),d.error;return d.value});k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,$isCompositing:this.$isCompositing.get(),$isProcessing:this.$isProcessing.get(),$isUploading:this.$isUploading.get(),$isBusy:this.$isBusy.get()}));this.id=Te("canvas_compositor"),this.parent=n,this.manager=n,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating compositor module")}}function P2e(e,t=!1){const n=(16777216+(e.r<<16)+(e.g<<8)+e.b).toString(16).slice(1),s=Math.round(e.a*255).toString(16).padStart(2,"0");return t?`#${n}${s}`:`#${n}`}function L2e(e,t){e=e.replace(/^#/,"");const n=parseInt(e.substring(0,2),16),s=parseInt(e.substring(2,4),16),i=parseInt(e.substring(4,6),16);return{r:n,g:s,b:i,a:t}}const Zo=e=>{const{r:t,g:n,b:s,a:i}=e;return`rgba(${t}, ${n}, ${s}, ${i})`},Zl=e=>{const{r:t,g:n,b:s}=e;return`rgba(${t}, ${n}, ${s})`};class Ef extends zt{constructor(n,s){super();k(this,"type","object_brush_line");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"state");k(this,"konva");k(this,"destroy",()=>{this.log.debug("Destroying module"),this.konva.group.destroy()});k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,parent:this.parent.id,state:gt(this.state)}));const{id:i,clip:o}=n;this.id=i,this.parent=s,this.manager=s.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug({state:n},"Creating module"),this.konva={group:new Be.Group({name:`${this.type}:group`,clip:o,listening:!1}),line:new Be.Line({name:`${this.type}:line`,listening:!1,shadowForStrokeEnabled:!1,tension:.3,lineCap:"round",lineJoin:"round",globalCompositeOperation:"source-over",perfectDrawEnabled:!1})},this.konva.group.add(this.konva.line),this.state=n}update(n,s=!1){if(s||this.state!==n){this.log.trace({state:n},"Updating brush line");const{points:i,color:o,strokeWidth:a}=n;return this.konva.line.setAttrs({points:i.length===2?[...i,...i]:i,stroke:Zo(o),strokeWidth:a}),this.state=n,!0}return!1}setVisibility(n){this.log.trace({isVisible:n},"Setting brush line visibility"),this.konva.group.visible(n)}}class S1 extends zt{constructor(n,s){super();k(this,"type","object_brush_line_with_pressure");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"state");k(this,"konva");k(this,"destroy",()=>{this.log.debug("Destroying module"),this.konva.group.destroy()});k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,parent:this.parent.id,state:gt(this.state)}));const{id:i,clip:o}=n;this.id=i,this.parent=s,this.manager=s.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug({state:n},"Creating module"),this.konva={group:new Be.Group({name:`${this.type}:group`,clip:o,listening:!1}),line:new Be.Path({name:`${this.type}:path`,listening:!1,shadowForStrokeEnabled:!1,globalCompositeOperation:"source-over",perfectDrawEnabled:!1})},this.konva.group.add(this.konva.line),this.state=n}update(n,s=!1){if(s||this.state!==n){this.log.trace({state:n},"Updating brush line with pressure");const{points:i,color:o,strokeWidth:a}=n;return this.konva.line.setAttrs({data:bP(i,{size:a/2,simulatePressure:!1,last:!0,thinning:1}),fill:Zo(o)}),this.state=n,!0}return!1}setVisibility(n){this.log.trace({isVisible:n},"Setting brush line visibility"),this.konva.group.visible(n)}}class Mf extends zt{constructor(n,s){super();k(this,"type","object_eraser_line");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"state");k(this,"konva");k(this,"destroy",()=>{this.log.debug("Destroying module"),this.konva.group.destroy()});k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,parent:this.parent.id,state:gt(this.state)}));this.id=n.id,this.parent=s,this.manager=s.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug({state:n},"Creating eraser line renderer module"),this.konva={group:new Be.Group({name:`${this.type}:group`,clip:n.clip,listening:!1}),line:new Be.Line({name:`${this.type}:line`,listening:!1,shadowForStrokeEnabled:!1,stroke:"red",tension:.3,lineCap:"round",lineJoin:"round",globalCompositeOperation:"destination-out",perfectDrawEnabled:!1})},this.konva.group.add(this.konva.line),this.state=n}update(n,s=!1){if(s||this.state!==n){this.log.trace({state:n},"Updating eraser line");const{points:i,strokeWidth:o}=n;return this.konva.line.setAttrs({points:i.length===2?[...i,...i]:i,strokeWidth:o}),this.state=n,!0}return!1}setVisibility(n){this.log.trace({isVisible:n},"Setting brush line visibility"),this.konva.group.visible(n)}}class j1 extends zt{constructor(n,s){super();k(this,"type","object_eraser_line_with_pressure");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"state");k(this,"konva");k(this,"destroy",()=>{this.log.debug("Destroying module"),this.konva.group.destroy()});k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,parent:this.parent.id,state:gt(this.state)}));const{id:i,clip:o}=n;this.id=i,this.parent=s,this.manager=s.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug({state:n},"Creating module"),this.konva={group:new Be.Group({name:`${this.type}:group`,clip:o,listening:!1}),line:new Be.Path({name:`${this.type}:path`,listening:!1,fill:"red",shadowForStrokeEnabled:!1,globalCompositeOperation:"destination-out",perfectDrawEnabled:!1})},this.konva.group.add(this.konva.line),this.state=n}update(n,s=!1){if(s||this.state!==n){this.log.trace({state:n},"Updating eraser line with pressure");const{points:i,strokeWidth:o}=n;return this.konva.line.setAttrs({data:bP(i,{size:o/2,simulatePressure:!1,last:!0,thinning:1})}),this.state=n,!0}return!1}setVisibility(n){this.log.trace({isVisible:n},"Setting eraser line visibility"),this.konva.group.visible(n)}}const D2e=new Error("request for lock canceled");var R2e=function(e,t,n,s){function i(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function l(h){try{d(s.next(h))}catch(f){a(f)}}function c(h){try{d(s.throw(h))}catch(f){a(f)}}function d(h){h.done?o(h.value):i(h.value).then(l,c)}d((s=s.apply(e,t||[])).next())})};class O2e{constructor(t,n=D2e){this._value=t,this._cancelError=n,this._queue=[],this._weightedWaiters=[]}acquire(t=1,n=0){if(t<=0)throw new Error(`invalid weight ${t}: must be positive`);return new Promise((s,i)=>{const o={resolve:s,reject:i,weight:t,priority:n},a=JB(this._queue,l=>n<=l.priority);a===-1&&t<=this._value?this._dispatchItem(o):this._queue.splice(a+1,0,o)})}runExclusive(t){return R2e(this,arguments,void 0,function*(n,s=1,i=0){const[o,a]=yield this.acquire(s,i);try{return yield n(o)}finally{a()}})}waitForUnlock(t=1,n=0){if(t<=0)throw new Error(`invalid weight ${t}: must be positive`);return this._couldLockImmediately(t,n)?Promise.resolve():new Promise(s=>{this._weightedWaiters[t-1]||(this._weightedWaiters[t-1]=[]),N2e(this._weightedWaiters[t-1],{resolve:s,priority:n})})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(t){this._value=t,this._dispatchQueue()}release(t=1){if(t<=0)throw new Error(`invalid weight ${t}: must be positive`);this._value+=t,this._dispatchQueue()}cancel(){this._queue.forEach(t=>t.reject(this._cancelError)),this._queue=[]}_dispatchQueue(){for(this._drainUnlockWaiters();this._queue.length>0&&this._queue[0].weight<=this._value;)this._dispatchItem(this._queue.shift()),this._drainUnlockWaiters()}_dispatchItem(t){const n=this._value;this._value-=t.weight,t.resolve([n,this._newReleaser(t.weight)])}_newReleaser(t){let n=!1;return()=>{n||(n=!0,this.release(t))}}_drainUnlockWaiters(){if(this._queue.length===0)for(let t=this._value;t>0;t--){const n=this._weightedWaiters[t-1];n&&(n.forEach(s=>s.resolve()),this._weightedWaiters[t-1]=[])}else{const t=this._queue[0].priority;for(let n=this._value;n>0;n--){const s=this._weightedWaiters[n-1];if(!s)continue;const i=s.findIndex(o=>o.priority<=t);(i===-1?s:s.splice(0,i)).forEach(o=>o.resolve())}}}_couldLockImmediately(t,n){return(this._queue.length===0||this._queue[0].priority<n)&&t<=this._value}}function N2e(e,t){const n=JB(e,s=>t.priority<=s.priority);e.splice(n+1,0,t)}function JB(e,t){for(let n=e.length-1;n>=0;n--)if(t(e[n]))return n;return-1}var F2e=function(e,t,n,s){function i(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function l(h){try{d(s.next(h))}catch(f){a(f)}}function c(h){try{d(s.throw(h))}catch(f){a(f)}}function d(h){h.done?o(h.value):i(h.value).then(l,c)}d((s=s.apply(e,t||[])).next())})};class g_{constructor(t){this._semaphore=new O2e(1,t)}acquire(){return F2e(this,arguments,void 0,function*(t=0){const[,n]=yield this._semaphore.acquire(1,t);return n})}runExclusive(t,n=0){return this._semaphore.runExclusive(()=>t(),1,n)}isLocked(){return this._semaphore.isLocked()}waitForUnlock(t=0){return this._semaphore.waitForUnlock(1,t)}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}}class $a extends zt{constructor(n,s){super();k(this,"type","object_image");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"state");k(this,"konva");k(this,"imageElement",null);k(this,"isLoading",!1);k(this,"isError",!1);k(this,"mutex",new g_);k(this,"updateImageSource",async n=>{this.log.trace({imageName:n},"Updating image source"),this.isLoading=!0,this.konva.group.visible(!0),this.konva.image||(this.konva.placeholder.group.visible(!1),this.konva.placeholder.text.text(Pe("common.loadingImage","Loading Image")));const s=await xy(n);if(s===null){this.onFailedToLoadImage(Pe("controlLayers.unableToFindImage","Unable to find image"));return}const i=await fs(()=>xP(s.image_url));if(i.isErr()){this.onFailedToLoadImage(Pe("controlLayers.unableToLoadImage","Unable to load image"));return}this.imageElement=i.value,await this.updateImageElement()});k(this,"onFailedToLoadImage",n=>{var s;this.log({image:this.state.image},n),(s=this.konva.image)==null||s.visible(!1),this.isLoading=!1,this.isError=!0,this.konva.placeholder.text.text(n),this.konva.placeholder.group.visible(!0)});k(this,"updateImageElement",async()=>{const n=await this.mutex.acquire();try{if(this.imageElement){const{width:s,height:i}=this.state.image;this.konva.image?(this.log.trace("Updating Konva image attrs"),this.konva.image.setAttrs({image:this.imageElement,width:s,height:i,visible:!0})):(this.log.trace("Creating new Konva image"),this.konva.image=new Be.Image({name:`${this.type}:image`,listening:!1,image:this.imageElement,width:s,height:i,perfectDrawEnabled:!1}),this.konva.group.add(this.konva.image)),this.konva.placeholder.rect.setAttrs({width:s,height:i}),this.konva.placeholder.text.setAttrs({width:s,height:i,fontSize:s/16}),this.isLoading=!1,this.isError=!1,this.konva.placeholder.group.visible(!1)}}finally{n()}});k(this,"update",async(n,s=!1)=>{var i;if(s||this.state!==n){this.log.trace({state:n},"Updating image");const{image:o}=n,{width:a,height:l,image_name:c}=o;return(s||this.state.image.image_name!==c&&!this.isLoading)&&await this.updateImageSource(c),(i=this.konva.image)==null||i.setAttrs({width:a,height:l}),this.state=n,!0}return!1});k(this,"destroy",()=>{this.log.debug("Destroying image renderer module"),this.konva.group.destroy()});k(this,"setVisibility",n=>{this.log.trace({isVisible:n},"Setting image visibility"),this.konva.group.visible(n)});k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,parent:this.parent.id,isLoading:this.isLoading,isError:this.isError,state:gt(this.state),konva:{group:ds(this.konva.group),image:this.konva.image?ds(this.konva.image):null}}));this.id=n.id,this.parent=s,this.manager=s.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug({state:n},"Creating module");const{width:i,height:o}=n.image;this.konva={group:new Be.Group({name:`${this.type}:group`,listening:!1}),placeholder:{group:new Be.Group({name:`${this.type}:placeholder_group`,listening:!1}),rect:new Be.Rect({name:`${this.type}:placeholder_rect`,fill:"hsl(220 12% 45% / 1)",width:i,height:o,listening:!1,perfectDrawEnabled:!1}),text:new Be.Text({name:`${this.type}:placeholder_text`,fill:"hsl(220 12% 10% / 1)",width:i,height:o,align:"center",verticalAlign:"middle",fontFamily:'"Inter Variable", sans-serif',fontSize:i/16,fontStyle:"600",text:Pe("common.loadingImage","Loading Image"),listening:!1,perfectDrawEnabled:!1})},image:null},this.konva.placeholder.group.add(this.konva.placeholder.rect),this.konva.placeholder.group.add(this.konva.placeholder.text),this.konva.group.add(this.konva.placeholder.group),this.state=n}}class k1 extends zt{constructor(n,s){super();k(this,"type","object_rect");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"state");k(this,"konva");k(this,"isFirstRender",!1);k(this,"destroy",()=>{this.log.debug("Destroying module"),this.konva.group.destroy()});k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,parent:this.parent.id,isFirstRender:this.isFirstRender,state:gt(this.state)}));this.id=n.id,this.parent=s,this.manager=s.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug({state:n},"Creating module"),this.konva={group:new Be.Group({name:`${this.type}:group`,listening:!1}),rect:new Be.Rect({name:`${this.type}:rect`,listening:!1,perfectDrawEnabled:!1})},this.konva.group.add(this.konva.rect),this.state=n}update(n,s=!1){if(s||this.state!==n){this.isFirstRender=!1,this.log.trace({state:n},"Updating rect");const{rect:i,color:o}=n;return this.konva.rect.setAttrs({x:i.x,y:i.y,width:i.width,height:i.height,fill:Zo(o)}),this.state=n,!0}return!1}setVisibility(n){this.log.trace({isVisible:n},"Setting rect visibility"),this.konva.group.visible(n)}}class Rb extends zt{constructor(n){super();k(this,"type","buffer_renderer");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"subscriptions",new Set);k(this,"state",null);k(this,"renderer",null);k(this,"konva");k(this,"renderBufferObject",async()=>{let n=!1;if(!this.state)return!1;let s=null;return this.renderer&&this.renderer.id!==this.state.id&&(s=this.renderer,this.renderer=null),this.state.type==="brush_line"?(we(this.renderer instanceof Ef||!this.renderer),this.renderer||(this.renderer=new Ef(this.state,this),this.konva.group.add(this.renderer.konva.group)),n=this.renderer.update(this.state,!0)):this.state.type==="brush_line_with_pressure"?(we(this.renderer instanceof S1||!this.renderer),this.renderer||(this.renderer=new S1(this.state,this),this.konva.group.add(this.renderer.konva.group)),n=this.renderer.update(this.state,!0)):this.state.type==="eraser_line"?(we(this.renderer instanceof Mf||!this.renderer),this.renderer||(this.renderer=new Mf(this.state,this),this.konva.group.add(this.renderer.konva.group)),n=this.renderer.update(this.state,!0)):this.state.type==="eraser_line_with_pressure"?(we(this.renderer instanceof j1||!this.renderer),this.renderer||(this.renderer=new j1(this.state,this),this.konva.group.add(this.renderer.konva.group)),n=this.renderer.update(this.state,!0)):this.state.type==="rect"?(we(this.renderer instanceof k1||!this.renderer),this.renderer||(this.renderer=new k1(this.state,this),this.konva.group.add(this.renderer.konva.group)),n=this.renderer.update(this.state,!0)):this.state.type==="image"&&(we(this.renderer instanceof $a||!this.renderer),this.renderer||(this.renderer=new $a(this.state,this),this.konva.group.add(this.renderer.konva.group)),n=await this.renderer.update(this.state,!0)),s&&s.destroy(),n});k(this,"hasBuffer",()=>this.state!==null||this.renderer!==null);k(this,"setBuffer",async(n,s=!1)=>(this.log.trace("Setting buffer"),this.state=n,s&&this.konva.group.offset({x:0,y:0}),await this.renderBufferObject()));k(this,"clearBuffer",()=>{var n;(this.state||this.renderer)&&(this.log.trace("Clearing buffer"),(n=this.renderer)==null||n.destroy(),this.renderer=null,this.state=null)});k(this,"commitBuffer",n=>{if({...n},!this.state||!this.renderer){this.log.trace("No buffer to commit");return}this.log.trace({buffer:this.renderer.repr()},"Committing buffer"),this.parent.renderer.adoptObjectRenderer(this.renderer);{const s=this.parent.entityIdentifier;switch(this.state.type){case"brush_line":case"brush_line_with_pressure":this.manager.stateApi.addBrushLine({entityIdentifier:s,brushLine:this.state});break;case"eraser_line":case"eraser_line_with_pressure":this.manager.stateApi.addEraserLine({entityIdentifier:s,eraserLine:this.state});break;case"rect":this.manager.stateApi.addRect({entityIdentifier:s,rect:this.state});break}}this.renderer=null,this.state=null});k(this,"destroy",()=>{this.log.debug("Destroying module"),this.subscriptions.forEach(n=>n()),this.subscriptions.clear(),this.renderer&&this.renderer.destroy()});k(this,"repr",()=>{var n;return{id:this.id,type:this.type,path:this.path,parent:this.parent.id,bufferState:gt(this.state),bufferRenderer:((n=this.renderer)==null?void 0:n.repr())??null}});this.id=Te(this.type),this.parent=n,this.manager=n.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.konva={group:new Be.Group({name:`${this.type}:buffer_group`,listening:!1})},this.parent.konva.layer.add(this.konva.group),this.subscriptions.add(this.manager.tool.$tool.listen(()=>{this.hasBuffer()&&!this.manager.$isBusy.get()&&this.commitBuffer()}))}}const B2e={PROCESS_DEBOUNCE_MS:1e3};class e$ extends zt{constructor(n){super();k(this,"type","canvas_filterer");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"config",B2e);k(this,"subscriptions",new Set);k(this,"abortController",null);k(this,"$isFiltering",Oe(!1));k(this,"$lastProcessedHash",Oe(""));k(this,"$isProcessing",Oe(!1));k(this,"$filterConfig",Oe(Nn.adjust_image.buildDefaults()));k(this,"$initialFilterConfig",Oe(null));k(this,"$imageState",Oe(null));k(this,"$hasImageState",Wn(this.$imageState,n=>n!==null));k(this,"$simple",Oe(!1));k(this,"imageModule",null);k(this,"konva");k(this,"KONVA_GROUP_NAME",`${this.type}:group`);k(this,"subscribe",()=>{this.subscriptions.add(this.$filterConfig.listen(()=>{this.manager.stateApi.getSettings().autoProcess&&this.$isFiltering.get()&&this.process()})),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(Vp,n=>{n&&this.$isFiltering.get()&&this.process()}))});k(this,"unsubscribe",()=>{this.subscriptions.forEach(n=>n()),this.subscriptions.clear()});k(this,"start",n=>{const s=this.manager.stateApi.$filteringAdapter.get();if(s){this.log.error(`Already filtering an entity: ${s.id}`);return}this.log.trace("Initializing filter"),this.resetEphemeralState(),this.$isFiltering.set(!0);const i=this.parent.transformer.$pixelRect.get(),o=R2(this.parent.state.position,i);if(this.konva.group.setAttrs(o),this.parent.konva.layer.add(this.konva.group),n)this.$filterConfig.set(n),this.$initialFilterConfig.set(n),this.$simple.set(!0);else{const a=this.createInitialFilterConfig();this.$filterConfig.set(a),this.$initialFilterConfig.set(a),this.$simple.set(!1)}this.subscribe(),this.manager.stateApi.$filteringAdapter.set(this.parent),this.manager.stateApi.getSettings().autoProcess&&this.processImmediate()});k(this,"createInitialFilterConfig",()=>{if(this.parent.type==="control_layer_adapter"&&this.parent.state.controlAdapter.model){const n=ife(this.parent.state.controlAdapter.model.key,iS),s=this.manager.stateApi.runSelector(n);return(kB(s)??Nn.canny_edge_detection).buildDefaults()}else return Nn.adjust_image.buildDefaults()});k(this,"processImmediate",async()=>{var b;if(!this.$isFiltering.get()){this.log.warn("Cannot process filter when not initialized");return}const n=this.$filterConfig.get(),s=Nn[n.type];if(!(((b=s.validateConfig)==null?void 0:b.call(s,n))??!0)){this.log.error({config:n},"Invalid filter config");return}const o=Wf({config:n});if(o===this.$lastProcessedHash.get()){this.log.trace("Already processed config");return}this.log.trace({config:n},"Processing filter");const a=this.parent.transformer.getRelativeRect(),l=await fs(()=>this.parent.renderer.rasterize({rect:a,attrs:{filters:[],opacity:1}}));if(l.isErr()){ge({status:"error",title:"Failed to process filter"}),this.log.error({error:Un(l.error)},"Error rasterizing entity"),this.$isProcessing.set(!1);return}this.$isProcessing.set(!0);const c=l.value,d=kS(()=>s.buildGraph(c,n));if(d.isErr()){this.log.error({error:Un(d.error)},"Error building filter graph"),this.$isProcessing.set(!1);return}const h=new AbortController;this.abortController=h;const{graph:f,outputNodeId:p}=d.value,g=await fs(()=>this.manager.stateApi.runGraphAndReturnImageOutput({graph:f,outputNodeId:p,prepend:!0,signal:h.signal}));if(g.isErr()){this.log.error({error:Un(g.error)},"Error filtering"),this.$isProcessing.set(!1),h.signal.aborted||h.abort(),this.abortController=null;return}this.log.trace({imageDTO:g.value},"Filtered");const m=Mi(g.value);this.$imageState.set(m);const y=this.imageModule;this.imageModule=new $a(m,this),await this.imageModule.update(m,!0),this.konva.group.add(this.imageModule.konva.group),this.parent.renderer.hideObjects(),y&&y.destroy(),this.$lastProcessedHash.set(o),this.$isProcessing.set(!1),h.signal.aborted||h.abort(),this.abortController=null});k(this,"process",ii(this.processImmediate,this.config.PROCESS_DEBOUNCE_MS));k(this,"apply",()=>{const n=this.$imageState.get();if(!n){this.log.warn("No image state to apply filter to");return}this.log.trace("Applying"),this.imageModule&&this.parent.renderer.adoptObjectRenderer(this.imageModule);const s=this.parent.transformer.getRelativeRect();this.manager.stateApi.rasterizeEntity({entityIdentifier:this.parent.entityIdentifier,imageObject:n,position:{x:Math.round(s.x),y:Math.round(s.y)},replaceObjects:!0}),this.teardown()});k(this,"saveAs",n=>{const s=this.$imageState.get();if(!s){this.log.warn("No image state to apply filter to");return}this.log.trace(`Saving as ${n}`);const i=this.parent.transformer.getRelativeRect(),o={overrides:{objects:[s],position:{x:Math.round(i.x),y:Math.round(i.y)}},isSelected:!0};switch(n){case"raster_layer":this.manager.stateApi.addRasterLayer(o);break;case"control_layer":this.manager.stateApi.addControlLayer(o);break;case"inpaint_mask":this.manager.stateApi.addInpaintMask(o);break;case"regional_guidance":this.manager.stateApi.addRegionalGuidance(o);break;default:we(!1)}});k(this,"resetEphemeralState",()=>{this.abortController&&!this.abortController.signal.aborted&&this.abortController.abort(),this.abortController=null,this.imageModule&&this.imageModule.konva.group.parent===this.konva.group&&(this.imageModule.destroy(),this.imageModule=null);const n=gt(this.$initialFilterConfig.get()??this.createInitialFilterConfig());this.$filterConfig.set(n),this.$imageState.set(null),this.$lastProcessedHash.set(""),this.$isProcessing.set(!1)});k(this,"teardown",()=>{this.unsubscribe(),this.parent.renderer.showObjects(),this.konva.group.remove(),this.resetEphemeralState(),this.$isFiltering.set(!1),this.manager.stateApi.$filteringAdapter.set(null)});k(this,"reset",()=>{this.log.trace("Resetting"),this.resetEphemeralState()});k(this,"cancel",()=>{this.log.trace("Canceling"),this.teardown()});k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,parent:this.parent.id,config:this.config,imageState:gt(this.$imageState.get()),$isFiltering:this.$isFiltering.get(),$lastProcessedHash:this.$lastProcessedHash.get(),$isProcessing:this.$isProcessing.get(),$filterConfig:this.$filterConfig.get(),konva:{group:ds(this.konva.group)}}));k(this,"destroy",()=>{this.log.debug("Destroying module"),this.abortController&&!this.abortController.signal.aborted&&this.abortController.abort(),this.abortController=null,this.unsubscribe(),this.konva.group.destroy()});this.id=Te(this.type),this.parent=n,this.manager=this.parent.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating filter module"),this.konva={group:new Be.Group({name:this.KONVA_GROUP_NAME})}}}const $2e=e=>{const t=e.data.length/4;for(let n=0;n<t;n++){const s=e.data[n*4+0],i=e.data[n*4+1],o=e.data[n*4+2],a=e.data[n*4+3],l=Math.min(s,i,o),c=Math.max(s,i,o);e.data[n*4+3]=Math.min(a,(l+c)/2)}},V2e=`<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg width="6px" height="6px" version="1.1"
    xmlns="http://www.w3.org/2000/svg"
    xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve"
    xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5;">
    <path d="M0,10L9,1" style="fill:none;stroke:black;stroke-width:1.2px;"/>
    <path d="M-1,5L8,-4" style="fill:none;stroke:black;stroke-width:1.2px;"/>
    <path d="M1,-2L13,10" style="fill:none;stroke:black;stroke-width:1.2px;"/>
    <path d="M-1,2L10,13" style="fill:none;stroke:black;stroke-width:1.2px;"/>
</svg>
`,z2e=`<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg width="6px" height="6px" version="1.1"
    xmlns="http://www.w3.org/2000/svg"
    xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve"
    xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5;">
    <path d="M0,10L9,1" style="fill:none;stroke:black;stroke-width:1.3px;"/>
    <path d="M-1,5L8,-4" style="fill:none;stroke:black;stroke-width:1.3px;"/>
</svg>
`,G2e=`<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg width="12px" height="12px" version="1.1"
    xmlns="http://www.w3.org/2000/svg"
    xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve"
    xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5;">
    <path d="M0.5,-1L0.5,12" style="fill:none;stroke:black;stroke-width:1px;"/>
    <path d="M4.5,-1L4.5,12" style="fill:none;stroke:black;stroke-width:1px;"/>
    <path d="M8.5,-1L8.5,12" style="fill:none;stroke:black;stroke-width:1px;"/>
    <path d="M-1,0.5L12,0.5" style="fill:none;stroke:black;stroke-width:1px;"/>
    <path d="M-1,4.5L12,4.5" style="fill:none;stroke:black;stroke-width:1px;"/>
    <path d="M-1,8.5L12,8.5" style="fill:none;stroke:black;stroke-width:1px;"/>
</svg>
`,H2e=`<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg width="9px" height="9px" version="1.1"
    xmlns="http://www.w3.org/2000/svg"
    xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve"
    xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5;">
    <path d="M10,0.5L-1,0.5" style="fill:none;stroke:black;stroke-width:1px;"/>
    <path d="M10,3.5L-1,3.5" style="fill:none;stroke:black;stroke-width:1px;"/>
    <path d="M10,6.5L-1,6.5" style="fill:none;stroke:black;stroke-width:1px;"/>
</svg>
`,W2e=`<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg width="9px" height="9px" version="1.1"
    xmlns="http://www.w3.org/2000/svg"
    xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve"
    xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5;">
    <path d="M0.5,-1L0.5,10" style="fill:none;stroke:black;stroke-width:1px;"/>
    <path d="M3.5,-1L3.5,10" style="fill:none;stroke:black;stroke-width:1px;"/>
    <path d="M6.5,-1L6.5,10" style="fill:none;stroke:black;stroke-width:1px;"/>
</svg>
`;function U2e(e,t){let n="data:image/svg+xml;utf8,";return e==="crosshatch"?n+=V2e:e==="diagonal"?n+=z2e:e==="horizontal"?n+=H2e:e==="vertical"?n+=W2e:e==="grid"&&(n+=G2e),n=n.replaceAll("stroke:black",`stroke:${Zl(t)}`),n}function q2e(e,...t){const n=new Image;return n.onload=()=>{e.fillPatternImage(n)},n.crossOrigin=rd.get()?"use-credentials":"anonymous",n.src=U2e(...t),n}class Ob extends zt{constructor(n){super();k(this,"type","object_renderer");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"subscriptions",new Set);k(this,"renderers",new gf);k(this,"konva");k(this,"initialize",async()=>{this.log.debug("Initializing module"),await this.render()});k(this,"render",async()=>{let n=!1;const s=this.parent.state.objects,i=s.map(o=>o.id);for(const o of this.renderers.values())i.includes(o.id)||(this.renderers.delete(o.id),o.destroy(),n=!0);for(const o of s)n=await this.renderObject(o)||n;return this.syncKonvaCache(n),n});k(this,"hideObjects",()=>{this.konva.objectGroup.hide()});k(this,"showObjects",()=>{this.konva.objectGroup.show()});k(this,"adoptObjectRenderer",n=>{this.renderers.set(n.id,n),n.konva.group.moveTo(this.konva.objectGroup)});k(this,"syncKonvaCache",(n=!1)=>{if(this.renderers.size===0){this.log.trace("Clearing object group cache"),this.konva.objectGroup.clearCache();return}const s=this.parent.konva.layer.visible(),i=this.konva.objectGroup.isCached();s&&(n||!i)&&(this.log.trace("Caching object group"),this.konva.objectGroup.clearCache(),this.konva.objectGroup.cache({pixelRatio:1,imageSmoothingEnabled:!1}))});k(this,"updateTransparencyEffect",()=>{if(this.parent.state.type==="control_layer"){const n=this.parent.state.withTransparencyEffect?[$2e]:[];this.konva.objectGroup.filters(n)}});k(this,"updateCompositingRectFill",Z2(n=>{if(!n&&!this.hasObjects()||!this.parent.konva.layer.visible()||!this.konva.compositing||this.parent.state.type!=="inpaint_mask"&&this.parent.state.type!=="regional_guidance")return;this.log.trace("Updating compositing rect fill");const s=this.parent.state.fill;s.style==="solid"?this.konva.compositing.rect.setAttrs({fill:Zl(s.color),fillPriority:"color"}):(this.konva.compositing.rect.setAttrs({fillPriority:"pattern"}),q2e(this.konva.compositing.rect,s.style,s.color))},100));k(this,"updateCompositingRectSize",n=>{if(!n&&!this.hasObjects()||!this.parent.konva.layer.visible()||!this.konva.compositing||this.parent.state.type!=="inpaint_mask"&&this.parent.state.type!=="regional_guidance")return;this.log.trace("Updating compositing rect size");const s=this.manager.stage.unscale(1);this.konva.compositing.rect.setAttrs({...this.manager.stage.getScaledStageRect(),fillPatternScaleX:s,fillPatternScaleY:s})});k(this,"updateCompositingRectPosition",n=>{!n&&!this.hasObjects()||this.parent.konva.layer.visible()&&(!this.konva.compositing||this.parent.state.type!=="inpaint_mask"&&this.parent.state.type!=="regional_guidance"||(this.log.trace("Updating compositing rect position"),this.konva.compositing.rect.setAttrs({...this.manager.stage.getScaledStageRect()})))});k(this,"updateOpacity",Z2(()=>{if(!this.parent.konva.layer.visible())return;this.log.trace("Updating opacity");const n=this.parent.state.opacity;this.konva.compositing?this.konva.compositing.group.opacity(n):this.konva.objectGroup.opacity(n),this.parent.bufferRenderer.konva.group.opacity(n)},100));k(this,"renderObject",async(n,s=!1)=>{let i=!1,o=this.renderers.get(n.id);const a=!o;return n.type==="brush_line"?(we(o instanceof Ef||!o),o||(o=new Ef(n,this),this.renderers.set(o.id,o),this.konva.objectGroup.add(o.konva.group)),i=o.update(n,s||a)):n.type==="brush_line_with_pressure"?(we(o instanceof S1||!o),o||(o=new S1(n,this),this.renderers.set(o.id,o),this.konva.objectGroup.add(o.konva.group)),i=o.update(n,s||a)):n.type==="eraser_line"?(we(o instanceof Mf||!o),o||(o=new Mf(n,this),this.renderers.set(o.id,o),this.konva.objectGroup.add(o.konva.group)),i=o.update(n,s||a)):n.type==="eraser_line_with_pressure"?(we(o instanceof j1||!o),o||(o=new j1(n,this),this.renderers.set(o.id,o),this.konva.objectGroup.add(o.konva.group)),i=o.update(n,s||a)):n.type==="rect"?(we(o instanceof k1||!o),o||(o=new k1(n,this),this.renderers.set(o.id,o),this.konva.objectGroup.add(o.konva.group)),i=o.update(n,s||a)):n.type==="image"&&(we(o instanceof $a||!o),o||(o=new $a(n,this),this.renderers.set(o.id,o),this.konva.objectGroup.add(o.konva.group)),i=await o.update(n,s||a)),i&&this.konva.objectGroup.isCached()&&this.konva.objectGroup.clearCache(),i});k(this,"needsPixelBbox",()=>{let n=!1;for(const s of this.renderers.values()){const i=s instanceof Mf,o=s instanceof $a,a=s instanceof Ef&&s.state.clip;if(i||a||o){n=!0;break}}return n});k(this,"hasObjects",()=>this.renderers.size>0||this.parent.bufferRenderer.hasBuffer());k(this,"rasterize",async n=>{const s=this.manager.stateApi.$rasterizingAdapter.get();s&&we(!1,`Already rasterizing an entity: ${s.id}`);const{rect:i,replaceObjects:o,attrs:a,bg:l,ignoreCache:c}={replaceObjects:!1,ignoreCache:!1,attrs:{},...n};let d=null;const h={rect:i,attrs:a,bg:l},f=this.parent.hash(h),p=this.manager.cache.imageNameCache.get(f);if(p&&!c&&(d=await xy(p),d))return this.log.trace({rect:i,cachedImageName:p,imageDTO:d},"Using cached rasterized image"),d;this.log.trace({rasterizeArgs:h},"Rasterizing entity"),this.manager.stateApi.$rasterizingAdapter.set(this.parent);try{const g=await this.getBlob(h);this.manager._isDebugging&&fP(g,"Rasterized entity"),d=await Aa({file:new File([g],`${this.id}_rasterized.png`,{type:"image/png"}),image_category:"other",is_intermediate:!0,silent:!0});const m=Mi(d);return o&&(await this.parent.bufferRenderer.setBuffer(m),this.parent.bufferRenderer.commitBuffer({pushToState:!1})),this.manager.stateApi.rasterizeEntity({entityIdentifier:this.parent.entityIdentifier,imageObject:m,position:{x:Math.round(i.x),y:Math.round(i.y)},replaceObjects:o}),this.manager.cache.imageNameCache.set(f,d.image_name),d}catch(g){throw this.log.error({rasterizeArgs:h,error:Un(g)},"Failed to rasterize entity"),g}finally{this.manager.stateApi.$rasterizingAdapter.set(null)}});k(this,"cloneObjectGroup",(n={})=>{const{attrs:s}=n,i=this.konva.objectGroup.clone();return s&&i.setAttrs(s),i.hasChildren()&&i.cache({pixelRatio:1,imageSmoothingEnabled:!1}),i});k(this,"getCanvas",(n={})=>{const{rect:s,attrs:i,bg:o}=n,a=this.cloneObjectGroup({attrs:i}),l=JQ({node:a,rect:s,bg:o});return a.destroy(),l});k(this,"getBlob",async(n={})=>{const{rect:s,attrs:i,bg:o}=n,a=this.cloneObjectGroup({attrs:i});return await eJ({node:a,rect:s,bg:o})});k(this,"getImageData",(n={})=>{const{rect:s,attrs:i,bg:o}=n,a=this.cloneObjectGroup({attrs:i}),l=tJ({node:a,rect:s,bg:o});return a.destroy(),l});k(this,"destroy",()=>{this.log.debug("Destroying module"),this.subscriptions.forEach(n=>n()),this.subscriptions.clear();for(const n of this.renderers.values())n.destroy();this.renderers.clear()});k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,parent:this.parent.id,renderers:Array.from(this.renderers.values()).map(n=>n.repr()),konva:{objectGroup:ds(this.konva.objectGroup)}}));if(this.id=Te(this.type),this.parent=n,this.manager=n.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.konva={objectGroup:new Be.Group({name:`${this.type}:object_group`,listening:!1}),compositing:null},this.parent.konva.layer.add(this.konva.objectGroup),this.parent.entityIdentifier.type==="inpaint_mask"||this.parent.entityIdentifier.type==="regional_guidance"){const s=new Be.Rect({name:`${this.type}:compositing_rect`,globalCompositeOperation:"source-in",listening:!1,strokeEnabled:!1,perfectDrawEnabled:!1});this.konva.compositing={group:new Be.Group({name:`${this.type}:compositing_group`,listening:!1}),rect:s,patternImage:new Image},this.konva.compositing.group.add(this.konva.compositing.rect),this.parent.konva.layer.add(this.konva.compositing.group)}this.subscriptions.add(this.manager.stage.$stageAttrs.listen((s,i)=>{this.konva.compositing&&((s.width!==i.width||s.height!==i.height||s.scale!==i.scale)&&this.updateCompositingRectSize(),(s.x!==i.x||s.y!==i.y)&&this.updateCompositingRectPosition())}))}}const K2e={RECT_CALC_DEBOUNCE_MS:300,ANCHOR_HIT_PADDING:10,OUTLINE_PADDING:0,OUTLINE_COLOR:"hsl(200 76% 50% / 1)",SCALE_ANCHOR_FILL_COLOR:"hsl(200 76% 50% / 1)",SCALE_ANCHOR_STROKE_COLOR:"hsl(200 76% 77% / 1)",SCALE_ANCHOR_CORNER_RADIUS_RATIO:.5,SCALE_ANCHOR_STROKE_WIDTH:2,SCALE_ANCHOR_SIZE:8,ROTATE_ANCHOR_FILL_COLOR:"hsl(200 76% 95% / 1)",ROTATE_ANCHOR_STROKE_COLOR:"hsl(200 76% 40% / 1)",ROTATE_ANCHOR_SIZE:12};class Nb extends zt{constructor(n){super();k(this,"type","entity_transformer");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"config",K2e);k(this,"$nodeRect",Oe(ca()));k(this,"$pixelRect",Oe(ca()));k(this,"$isPendingRectCalculation",Oe(!0));k(this,"subscriptions",new Set);k(this,"$isTransforming",Oe(!1));k(this,"$interactionMode",Oe("off"));k(this,"$isDragEnabled",Oe(!1));k(this,"$isTransformEnabled",Oe(!1));k(this,"$isProcessing",Oe(!1));k(this,"$silentTransform",Oe(!1));k(this,"transformMutex",new g_);k(this,"konva");k(this,"initialize",()=>{this.log.debug("Initializing module"),this.syncInteractionState()});k(this,"syncCursorStyle",()=>{this.parent.renderer.hasObjects()?this.manager.stage.setCursor("default"):this.manager.stage.setCursor("not-allowed")});k(this,"anchorStyleFunc",n=>{n.hasName("rotater")&&n.setAttrs({height:this.config.ROTATE_ANCHOR_SIZE,width:this.config.ROTATE_ANCHOR_SIZE,cornerRadius:this.config.ROTATE_ANCHOR_SIZE*this.config.SCALE_ANCHOR_CORNER_RADIUS_RATIO,fill:this.config.ROTATE_ANCHOR_FILL_COLOR,stroke:this.config.SCALE_ANCHOR_FILL_COLOR,offsetX:this.config.ROTATE_ANCHOR_SIZE/2,offsetY:this.config.ROTATE_ANCHOR_SIZE/2}),n.hitFunc(s=>{s.beginPath(),s.rect(-this.config.ANCHOR_HIT_PADDING,-this.config.ANCHOR_HIT_PADDING,n.width()+this.config.ANCHOR_HIT_PADDING*2,n.height()+this.config.ANCHOR_HIT_PADDING*2),s.closePath(),s.fillStrokeShape(n)})});k(this,"anchorDragBoundFunc",(n,s)=>{if(this.konva.transformer.getActiveAnchor()==="rotater")return s;const i=this.manager.stateApi.$shiftKey.get()?this.manager.stateApi.getGridSize():1,o=this.manager.stage.getScale(),a=this.manager.stage.getPosition(),l=qr(s.x/o,i),c=qr(s.y/o,i),d=a.x%(o*i),h=a.y%(o*i),f=l*o+d,p=c*o+h;return{x:f,y:p}});k(this,"boxBoundFunc",(n,s)=>this.konva.transformer.getActiveAnchor()!=="rotater"?s:this.manager.stateApi.$shiftKey.get()&&Math.abs(s.rotation%(Math.PI/4))>0?n:s);k(this,"snapProxyRectToPixelGrid",()=>{const n=this.konva.proxyRect.x(),s=this.konva.proxyRect.y(),i=Math.round(n),o=Math.round(s),a=this.konva.proxyRect.width(),l=this.konva.proxyRect.height(),c=this.konva.proxyRect.scaleX(),d=this.konva.proxyRect.scaleY(),h=Math.max(Math.abs(Math.round(a*c)),1),f=Math.max(Math.abs(Math.round(l*d)),1),p=h/a*Math.sign(c),g=f/l*Math.sign(d);this.konva.proxyRect.setAttrs({x:i,y:o,scaleX:p,scaleY:g}),this.syncObjectGroupWithProxyRect()});k(this,"fitToBboxFill",()=>{if(!this.$isTransformEnabled.get()){this.log.warn("Cannot fit to bbox contain when transform is disabled. Did you forget to call `await adapter.transformer.startTransform()`?");return}const{rect:n}=this.manager.stateApi.getBbox(),s=n.width/this.konva.proxyRect.width(),i=n.height/this.konva.proxyRect.height();this.konva.proxyRect.setAttrs({x:n.x,y:n.y,scaleX:s,scaleY:i,rotation:0}),this.syncObjectGroupWithProxyRect()});k(this,"fitToBboxContain",()=>{if(!this.$isTransformEnabled.get()){this.log.warn("Cannot fit to bbox contain when transform is disabled. Did you forget to call `await adapter.transformer.startTransform()`?");return}const{rect:n}=this.manager.stateApi.getBbox(),s=this.manager.stateApi.getGridSize(),i=this.konva.proxyRect.width(),o=this.konva.proxyRect.height(),a=n.width/i,l=n.height/o,c=Math.min(a,l),d=(n.width-i*c)/2,h=(n.height-o*c)/2;this.konva.proxyRect.setAttrs({x:uo(qr(n.x+d,s),n.x,n.x+n.width),y:uo(qr(n.y+h,s),n.y,n.y+n.height),scaleX:c,scaleY:c,rotation:0}),this.syncObjectGroupWithProxyRect()});k(this,"fitToBboxCover",()=>{if(!this.$isTransformEnabled.get()){this.log.warn("Cannot fit to bbox contain when transform is disabled. Did you forget to call `await adapter.transformer.startTransform()`?");return}const{rect:n}=this.manager.stateApi.getBbox(),s=this.manager.stateApi.getGridSize(),i=this.konva.proxyRect.width(),o=this.konva.proxyRect.height(),a=n.width/i,l=n.height/o,c=Math.max(a,l),d=(n.width-i*c)/2,h=(n.height-o*c)/2;this.konva.proxyRect.setAttrs({x:qr(n.x+d,s),y:qr(n.y+h,s),scaleX:c,scaleY:c,rotation:0}),this.syncObjectGroupWithProxyRect()});k(this,"onDragMove",()=>{const n=this.manager.stateApi.getGridSize();this.konva.proxyRect.x(qr(this.konva.proxyRect.x(),n)),this.konva.proxyRect.y(qr(this.konva.proxyRect.y(),n));const s=this.manager.stage.unscale(this.config.OUTLINE_PADDING);this.konva.outlineRect.setAttrs({x:this.konva.proxyRect.x()-s,y:this.konva.proxyRect.y()-s}),this.parent.renderer.konva.objectGroup.setAttrs({x:this.konva.proxyRect.x(),y:this.konva.proxyRect.y()})});k(this,"onDragEnd",()=>{if(this.$isTransforming.get())return;const n=this.$pixelRect.get(),s={x:this.konva.proxyRect.x()-n.x,y:this.konva.proxyRect.y()-n.y};this.log.trace({position:s},"Position changed"),this.manager.stateApi.setEntityPosition({entityIdentifier:this.parent.entityIdentifier,position:s})});k(this,"nudgeBy",n=>{const s=this.konva.proxyRect.position(),i=eo(s,n);this.konva.proxyRect.setAttrs(i),this.syncObjectGroupWithProxyRect(),this.manager.stateApi.moveEntityBy({entityIdentifier:this.parent.entityIdentifier,offset:n}),this.log.trace({offset:n},"Nudged")});k(this,"syncObjectGroupWithProxyRect",()=>{this.parent.renderer.konva.objectGroup.setAttrs({x:this.konva.proxyRect.x(),y:this.konva.proxyRect.y(),scaleX:this.konva.proxyRect.scaleX(),scaleY:this.konva.proxyRect.scaleY(),rotation:this.konva.proxyRect.rotation()})});k(this,"update",(n,s)=>{const i=this.manager.stage.unscale(1),o=this.manager.stage.unscale(this.config.OUTLINE_PADDING);this.konva.outlineRect.setAttrs({x:n.x+s.x-o,y:n.y+s.y-o,width:s.width+o*2,height:s.height+o*2,strokeWidth:i}),this.konva.proxyRect.setAttrs({x:n.x+s.x,y:n.y+s.y,width:s.width,height:s.height})});k(this,"syncInteractionState",()=>{var a,l;if(this.log.trace("Syncing interaction state"),this.manager.stagingArea.$isStaging.get()){this.parent.konva.layer.listening(!1),this._setInteractionMode("off");return}if((a=this.parent.segmentAnything)!=null&&a.$isSegmenting.get()){this.parent.konva.layer.listening(!0),this._setInteractionMode("off");return}if((l=this.parent.filterer)!=null&&l.$isFiltering.get()){this.parent.konva.layer.listening(!1),this._setInteractionMode("off");return}if(this.manager.stateApi.$isTransforming.get()&&!this.$isTransforming.get()){this.parent.konva.layer.listening(!1),this._setInteractionMode("off");return}const n=this.$pixelRect.get();if(this.$isPendingRectCalculation.get()||n.width===0||n.height===0){this.parent.konva.layer.listening(!1),this._setInteractionMode("off");return}const i=this.manager.tool.$tool.get();if(!this.manager.stateApi.getIsSelected(this.parent.id)){this.parent.konva.layer.listening(!1),this._setInteractionMode("off");return}if(this.parent.$isEmpty.get()){this.parent.konva.layer.listening(!1),this._setInteractionMode("off");return}if(this.parent.$isLocked.get()){this.parent.konva.layer.listening(!1),this._setInteractionMode("off");return}if(!this.$isTransforming.get()&&i==="move"){this.parent.konva.layer.listening(!0),this._setInteractionMode("drag");return}if(this.$isTransforming.get()){i==="view"?(this.parent.konva.layer.listening(!1),this._setInteractionMode("off")):(this.parent.konva.layer.listening(!0),this._setInteractionMode("all"));return}this.parent.konva.layer.listening(!1),this._setInteractionMode("off")});k(this,"syncScale",()=>{const n=this.manager.stage.unscale(1),s=this.manager.stage.unscale(this.config.OUTLINE_PADDING);this.konva.outlineRect.setAttrs({x:this.konva.proxyRect.x()-s,y:this.konva.proxyRect.y()-s,width:this.konva.proxyRect.width()*this.konva.proxyRect.scaleX()+s*2,height:this.konva.proxyRect.height()*this.konva.proxyRect.scaleY()+s*2,strokeWidth:n}),this.konva.transformer.forceUpdate()});k(this,"startTransform",async n=>{const s=this.manager.stateApi.$transformingAdapter.get();s&&we(!1,`Already transforming an entity: ${s.id}`),await this.transformMutex.acquire(),this.log.debug("Starting transform");const{silent:i}={silent:!1,...n};this.$silentTransform.set(i),this.$isTransforming.set(!0),this.manager.stateApi.$transformingAdapter.set(this.parent),this.syncInteractionState()});k(this,"applyTransform",async()=>{if(!this.$isTransforming.get()){this.log.warn("Cannot apply transform when not transforming. Did you forget to call `await adapter.transformer.startTransform()`?");return}this.log.debug("Applying transform"),this.$isProcessing.set(!0),this._setInteractionMode("off");const n=this.getRelativeRect(),s=await fs(()=>this.parent.renderer.rasterize({rect:nJ(n),replaceObjects:!0,ignoreCache:!0,attrs:{opacity:1,filters:[]}}));s.isErr()&&(ge({status:"error",title:"Failed to apply transform"}),this.log.error({error:Un(s.error)},"Failed to rasterize entity")),this.requestRectCalculation(),this.stopTransform()});k(this,"resetTransform",()=>{this.resetScale(),this.updatePosition(),this.updateBbox()});k(this,"stopTransform",()=>{this.log.debug("Stopping transform"),this.$isTransforming.set(!1),this.resetTransform(),this.syncInteractionState(),this.manager.stateApi.$transformingAdapter.set(null),this.$isProcessing.set(!1),this.transformMutex.release()});k(this,"resetScale",()=>{const n={scaleX:1,scaleY:1,rotation:0};this.parent.renderer.konva.objectGroup.setAttrs(n),this.parent.bufferRenderer.konva.group.setAttrs(n),this.konva.outlineRect.setAttrs(n),this.konva.proxyRect.setAttrs(n)});k(this,"updatePosition",n=>{this.log.trace("Updating position");const s=vP(n,"position",this.parent.state.position),i=this.$pixelRect.get(),o={x:s.x+i.x,y:s.y+i.y,offsetX:i.x,offsetY:i.y};this.parent.renderer.konva.objectGroup.setAttrs(o),this.parent.bufferRenderer.konva.group.setAttrs(o),this.update(s,i)});k(this,"_setInteractionMode",n=>{this.$interactionMode.set(n),n==="drag"?(this._enableDrag(),this._disableTransform(),this._showBboxOutline()):n==="all"?(this._enableDrag(),this._enableTransform(),this._hideBboxOutline()):n==="off"&&(this._disableDrag(),this._disableTransform(),this._hideBboxOutline())});k(this,"updateBbox",()=>{const n=this.$nodeRect.get(),s=this.$pixelRect.get();if(this.log.trace({nodeRect:n,pixelRect:s},"Updating bbox"),this.$isPendingRectCalculation.get()){this.syncInteractionState();return}if(s.width===0||s.height===0)this.parent.renderer.hasObjects()&&(this.manager.stateApi.resetEntity({entityIdentifier:this.parent.entityIdentifier}),this.syncInteractionState());else{this.syncInteractionState(),this.update(this.parent.state.position,s);const i={x:this.parent.state.position.x+s.x,y:this.parent.state.position.y+s.y,offsetX:s.x,offsetY:s.y};this.parent.renderer.konva.objectGroup.setAttrs(i),this.parent.bufferRenderer.konva.group.setAttrs(i)}});k(this,"calculateRect",ii(()=>{this.log.debug("Calculating bbox");const n=kS(()=>this.parent.getCanvas());if(n.isErr()){this.log.error({error:Un(n.error)},"Failed to get canvas, resetting bbox"),this.$nodeRect.set(ca()),this.$pixelRect.set(ca()),this.$isPendingRectCalculation.set(!1),this.transformMutex.release();return}const s=n.value;if(!this.parent.renderer.hasObjects()){this.log.trace("No objects, resetting bbox"),this.$nodeRect.set(ca()),this.$pixelRect.set(ca()),this.parent.$canvasCache.set(s),this.$isPendingRectCalculation.set(!1),this.updateBbox(),this.transformMutex.release();return}const i=this.parent.renderer.konva.objectGroup.getClientRect({skipTransform:!0});if(!this.parent.renderer.needsPixelBbox()){this.$nodeRect.set({...i}),this.$pixelRect.set({...i}),this.log.trace({nodeRect:this.$nodeRect.get(),pixelRect:this.$pixelRect.get()},"Got bbox from client rect"),this.parent.$canvasCache.set(s),this.$isPendingRectCalculation.set(!1),this.updateBbox(),this.transformMutex.release();return}const o=yP(s);this.manager.worker.requestBbox({buffer:o.data.buffer,width:o.width,height:o.height},a=>{if(a){const{minX:l,minY:c,maxX:d,maxY:h}=a;this.$nodeRect.set({...i}),this.$pixelRect.set({x:Math.round(i.x)+l,y:Math.round(i.y)+c,width:d-l,height:h-c})}else this.$nodeRect.set(ca()),this.$pixelRect.set(ca());this.log.trace({nodeRect:this.$nodeRect.get(),pixelRect:this.$pixelRect.get(),extents:a},"Got bbox from worker"),this.parent.$canvasCache.set(s),this.$isPendingRectCalculation.set(!1),this.updateBbox(),this.transformMutex.release()})},this.config.RECT_CALC_DEBOUNCE_MS));k(this,"requestRectCalculation",async()=>{await this.transformMutex.acquire(),this.$isPendingRectCalculation.set(!0),this.syncInteractionState(),this.calculateRect()});k(this,"getRelativeRect",()=>this.konva.proxyRect.getClientRect({relativeTo:this.parent.konva.layer}));k(this,"_enableTransform",()=>{this.$isTransformEnabled.set(!0),this.konva.transformer.visible(!0),this.konva.transformer.listening(!0),this.konva.transformer.nodes([this.konva.proxyRect])});k(this,"_disableTransform",()=>{this.$isTransformEnabled.set(!1),this.konva.transformer.visible(!1),this.konva.transformer.listening(!1),this.konva.transformer.nodes([])});k(this,"_enableDrag",()=>{this.$isDragEnabled.set(!0),this.konva.proxyRect.visible(!0),this.konva.proxyRect.listening(!0)});k(this,"_disableDrag",()=>{this.$isDragEnabled.set(!1),this.konva.proxyRect.visible(!1),this.konva.proxyRect.listening(!1)});k(this,"_showBboxOutline",()=>{this.konva.outlineRect.visible(!0)});k(this,"_hideBboxOutline",()=>{this.konva.outlineRect.visible(!1)});k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,config:this.config,$nodeRect:this.$nodeRect.get(),$pixelRect:this.$pixelRect.get(),$isPendingRectCalculation:this.$isPendingRectCalculation.get(),$isTransforming:this.$isTransforming.get(),$interactionMode:this.$interactionMode.get(),$isDragEnabled:this.$isDragEnabled.get(),$isTransformEnabled:this.$isTransformEnabled.get(),$isProcessing:this.$isProcessing.get(),konva:{transformer:ds(this.konva.transformer),proxyRect:ds(this.konva.proxyRect),outlineRect:ds(this.konva.outlineRect)}}));k(this,"destroy",()=>{this.log.debug("Destroying module"),this.subscriptions.forEach(n=>n()),this.subscriptions.clear(),this.konva.outlineRect.destroy(),this.konva.transformer.destroy(),this.konva.proxyRect.destroy()});this.id=Te(this.type),this.parent=n,this.manager=n.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.konva={outlineRect:new Be.Rect({listening:!1,draggable:!1,name:`${this.type}:outline_rect`,stroke:this.config.OUTLINE_COLOR,perfectDrawEnabled:!1,hitStrokeWidth:0}),transformer:new Be.Transformer({name:`${this.type}:transformer`,visible:!1,listening:!1,rotateEnabled:!0,flipEnabled:!0,keepRatio:!0,shiftBehavior:"inverted",padding:this.config.OUTLINE_PADDING,stroke:this.config.OUTLINE_COLOR,anchorFill:this.config.SCALE_ANCHOR_FILL_COLOR,anchorStroke:this.config.SCALE_ANCHOR_STROKE_COLOR,anchorStrokeWidth:this.config.SCALE_ANCHOR_STROKE_WIDTH,anchorSize:this.config.SCALE_ANCHOR_SIZE,anchorCornerRadius:this.config.SCALE_ANCHOR_SIZE*this.config.SCALE_ANCHOR_CORNER_RADIUS_RATIO,anchorStyleFunc:this.anchorStyleFunc,anchorDragBoundFunc:this.anchorDragBoundFunc,boundBoxFunc:this.boxBoundFunc}),proxyRect:new Be.Rect({name:`${this.type}:proxy_rect`,listening:!1,draggable:!0})},this.konva.transformer.on("transform",this.syncObjectGroupWithProxyRect),this.konva.transformer.on("transformend",this.snapProxyRectToPixelGrid),this.konva.transformer.on("pointerenter",()=>{this.manager.stage.setCursor("move")}),this.konva.transformer.on("pointerleave",()=>{this.manager.stage.setCursor("default")}),this.konva.proxyRect.on("dragmove",this.onDragMove),this.konva.proxyRect.on("dragend",this.onDragEnd),this.konva.proxyRect.on("pointerenter",()=>{this.manager.stage.setCursor("move")}),this.konva.proxyRect.on("pointerleave",()=>{this.manager.stage.setCursor("default")}),this.subscriptions.add(()=>{this.konva.transformer.off("transform transformend pointerenter pointerleave"),this.konva.proxyRect.off("dragmove dragend pointerenter pointerleave")}),this.subscriptions.add(this.manager.stage.$stageAttrs.listen((s,i)=>{s.scale!==i.scale&&this.syncScale()})),this.subscriptions.add(this.manager.stateApi.$shiftKey.listen(s=>{this.konva.transformer.rotationSnaps(s?[0,45,90,135,180,225,270,315]:[])})),this.subscriptions.add(this.manager.tool.$tool.listen(this.syncInteractionState)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(Tn,this.syncInteractionState)),this.subscriptions.add(this.manager.$isBusy.listen(this.syncInteractionState)),this.parent.konva.layer.add(this.konva.outlineRect),this.parent.konva.layer.add(this.konva.proxyRect),this.parent.konva.layer.add(this.konva.transformer)}}const Z2e={SAM_POINT_RADIUS:8,SAM_POINT_BORDER_WIDTH:2,SAM_POINT_BORDER_COLOR:{r:0,g:0,b:0,a:1},SAM_POINT_FOREGROUND_COLOR:{r:50,g:255,b:0,a:1},SAM_POINT_BACKGROUND_COLOR:{r:255,g:0,b:50,a:1},SAM_POINT_NEUTRAL_COLOR:{r:0,g:225,b:255,a:1},MASK_COLOR:{r:0,g:225,b:255,a:1},PROCESS_DEBOUNCE_MS:1e3},hy=class hy extends zt{constructor(n){super();k(this,"type","canvas_segment_anything");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"config",Z2e);k(this,"subscriptions",new Set);k(this,"abortController",null);k(this,"$isSegmenting",Oe(!1));k(this,"$lastProcessedHash",Oe(""));k(this,"$isProcessing",Oe(!1));k(this,"$pointType",Oe(1));k(this,"$pointTypeString",Wn(this.$pointType,n=>Tx[n]));k(this,"$isDraggingPoint",Oe(!1));k(this,"$imageState",Oe(null));k(this,"$hasImageState",Wn(this.$imageState,n=>n!==null));k(this,"$points",Oe([]));k(this,"$hasPoints",Wn(this.$points,n=>n.length>0));k(this,"$invert",Oe(!1));k(this,"imageModule",null);k(this,"konva");k(this,"KONVA_CIRCLE_NAME",`${this.type}:circle`);k(this,"KONVA_GROUP_NAME",`${this.type}:group`);k(this,"KONVA_POINT_GROUP_NAME",`${this.type}:point_group`);k(this,"KONVA_MASK_GROUP_NAME",`${this.type}:mask_group`);k(this,"KONVA_COMPOSITING_RECT_NAME",`${this.type}:compositing_rect`);k(this,"syncCursorStyle",()=>{this.$isProcessing.get()?this.manager.stage.setCursor("wait"):this.$isSegmenting.get()&&this.manager.stage.setCursor("crosshair")});k(this,"syncPointScales",()=>{const n=this.manager.stage.unscale(this.config.SAM_POINT_RADIUS),s=this.manager.stage.unscale(this.config.SAM_POINT_BORDER_WIDTH);for(const i of this.$points.get())i.konva.circle.radius(n),i.konva.circle.strokeWidth(s)});k(this,"getSAMPoints",()=>{const n=[];for(const{id:s,coord:i,label:o}of this.$points.get())n.push({id:s,x:i.x,y:i.y,label:o});return n});k(this,"onStagePointerUp",n=>{if(n.evt.button!==0||this.manager.stage.getIsDragging()||this.$isDraggingPoint.get()||this.$isProcessing.get())return;const s=this.manager.tool.$cursorPos.get();if(!s)return;const i=this.parent.transformer.$pixelRect.get(),o=R2(this.parent.state.position,i),a=eo(s.relative,o),l=this.createPoint(a,this.$pointType.get()),c=[...this.$points.get(),l];this.$points.set(c)});k(this,"subscribe",()=>{this.manager.stage.konva.stage.on("pointerup",this.onStagePointerUp),this.subscriptions.add(()=>{this.manager.stage.konva.stage.off("pointerup",this.onStagePointerUp)}),this.subscriptions.add(this.$isProcessing.listen(n=>{this.syncCursorStyle(),this.parent.konva.layer.listening(!n)})),this.subscriptions.add(this.manager.stage.$stageAttrs.listen((n,s)=>{n.scale!==s.scale&&this.syncPointScales()})),this.subscriptions.add(this.$points.listen(n=>{n.length!==0&&this.manager.stateApi.getSettings().autoProcess&&this.process()})),this.subscriptions.add(this.$invert.listen(()=>{this.$points.get().length!==0&&this.manager.stateApi.getSettings().autoProcess&&this.process()})),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(Vp,n=>{this.$points.get().length!==0&&n&&this.process()}))});k(this,"unsubscribe",()=>{this.subscriptions.forEach(n=>n()),this.subscriptions.clear()});k(this,"start",()=>{const n=this.manager.stateApi.$segmentingAdapter.get();if(n){this.log.error(`Already segmenting an entity: ${n.id}`);return}this.log.trace("Starting segment anything"),this.resetEphemeralState(),this.$isSegmenting.set(!0);const s=this.parent.transformer.$pixelRect.get(),i=R2(this.parent.state.position,s);this.konva.group.setAttrs(i),this.parent.konva.layer.add(this.konva.group),this.parent.konva.layer.listening(!0),this.subscribe(),this.manager.stateApi.$segmentingAdapter.set(this.parent),this.syncCursorStyle()});k(this,"processImmediate",async()=>{if(!this.$isSegmenting.get()){this.log.warn("Cannot process segmentation when not initialized");return}if(this.$isProcessing.get()){this.log.warn("Already processing");return}const n=this.getSAMPoints();if(n.length===0){this.log.trace("No points to segment");return}const s=this.$invert.get(),i=Wf({points:n,invert:s});if(i===this.$lastProcessedHash.get()){this.log.trace("Already processed points");return}this.$isProcessing.set(!0),this.log.trace({points:n},"Segmenting");const o=this.parent.transformer.getRelativeRect(),a=await fs(()=>this.parent.renderer.rasterize({rect:o,attrs:{filters:[],opacity:1}}));if(a.isErr()){ge({status:"error",title:"Failed to select object"}),this.log.error({error:Un(a.error)},"Error rasterizing entity"),this.$isProcessing.set(!1);return}const l=new AbortController;this.abortController=l;const{graph:c,outputNodeId:d}=hy.buildGraph(a.value,n,s),h=await fs(()=>this.manager.stateApi.runGraphAndReturnImageOutput({graph:c,outputNodeId:d,prepend:!0,signal:l.signal}));if(h.isErr()){this.log.error({error:Un(h.error)},"Error segmenting"),this.$isProcessing.set(!1),this.abortController.signal.aborted||this.abortController.abort(),this.abortController=null;return}this.log.trace({imageDTO:h.value},"Segmented");const f=Mi(h.value);this.$imageState.set(f),this.imageModule&&this.imageModule.destroy(),this.konva.maskTween&&(this.konva.maskTween.destroy(),this.konva.maskTween=null),this.imageModule=new $a(f,this),await this.imageModule.update(f,!0),this.konva.compositingRect.setAttrs({width:f.image.width,height:f.image.height,visible:!0}),this.konva.maskGroup.add(this.imageModule.konva.group),this.konva.compositingRect.moveToTop(),this.konva.maskGroup.cache(),this.konva.maskTween=new Be.Tween({node:this.konva.maskGroup,duration:1,opacity:.4,yoyo:!0,repeat:1/0,easing:Be.Easings.EaseOut}),this.konva.maskTween.play(),this.$lastProcessedHash.set(i),this.$isProcessing.set(!1),this.abortController.signal.aborted||this.abortController.abort(),this.abortController=null});k(this,"process",ii(this.processImmediate,this.config.PROCESS_DEBOUNCE_MS));k(this,"apply",()=>{const n=this.$imageState.get();if(!n){this.log.error("No image state to apply");return}this.log.trace("Applying");const s=this.parent.transformer.getRelativeRect();this.manager.stateApi.rasterizeEntity({entityIdentifier:this.parent.entityIdentifier,imageObject:n,position:{x:Math.round(s.x),y:Math.round(s.y)},replaceObjects:!0}),this.teardown()});k(this,"saveAs",n=>{const s=this.$imageState.get();if(!s){this.log.error("No image state to save as");return}this.log.trace(`Saving as ${n}`),this.imageModule&&this.parent.renderer.adoptObjectRenderer(this.imageModule);const i=this.parent.transformer.getRelativeRect(),o={overrides:{objects:[s],position:{x:Math.round(i.x),y:Math.round(i.y)}},isSelected:!0};switch(n){case"raster_layer":this.manager.stateApi.addRasterLayer(o);break;case"control_layer":this.manager.stateApi.addControlLayer(o);break;case"inpaint_mask":this.manager.stateApi.addInpaintMask(o);break;case"regional_guidance":this.manager.stateApi.addRegionalGuidance(o);break;default:we(!1)}});k(this,"reset",()=>{this.log.trace("Resetting"),this.resetEphemeralState()});k(this,"cancel",()=>{this.log.trace("Canceling"),this.teardown()});k(this,"teardown",()=>{this.unsubscribe(),this.konva.group.remove(),this.resetEphemeralState(),this.$isSegmenting.set(!1),this.manager.stateApi.$segmentingAdapter.set(null)});k(this,"resetEphemeralState",()=>{var n;(n=this.abortController)==null||n.abort(),this.abortController=null;for(const s of this.$points.get())s.konva.circle.destroy();this.imageModule&&this.imageModule.konva.group.parent===this.konva.group&&(this.imageModule.destroy(),this.imageModule=null),this.konva.maskTween&&(this.konva.maskTween.destroy(),this.konva.maskTween=null),this.$points.set([]),this.$imageState.set(null),this.$pointType.set(1),this.$invert.set(!1),this.$lastProcessedHash.set(""),this.$isProcessing.set(!1),this.konva.compositingRect.visible(!1),this.konva.maskGroup.clearCache()});k(this,"repr",()=>{var n;return{id:this.id,type:this.type,path:this.path,parent:this.parent.id,points:this.$points.get().map(({id:s,konva:i,label:o})=>({id:s,label:o,circle:ds(i.circle)})),imageState:gt(this.$imageState.get()),imageModule:((n=this.imageModule)==null?void 0:n.repr())??null,config:gt(this.config),$isSegmenting:this.$isSegmenting.get(),$lastProcessedHash:this.$lastProcessedHash.get(),$isProcessing:this.$isProcessing.get(),$pointType:this.$pointType.get(),$pointTypeString:this.$pointTypeString.get(),$isDraggingPoint:this.$isDraggingPoint.get(),konva:{group:ds(this.konva.group),compositingRect:ds(this.konva.compositingRect),maskGroup:ds(this.konva.maskGroup),pointGroup:ds(this.konva.pointGroup)}}});k(this,"destroy",()=>{this.log.debug("Destroying module"),this.abortController&&!this.abortController.signal.aborted&&this.abortController.abort(),this.abortController=null,this.unsubscribe(),this.konva.group.destroy()});this.id=Te(this.type),this.parent=n,this.manager=this.parent.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.konva={group:new Be.Group({name:this.KONVA_GROUP_NAME}),pointGroup:new Be.Group({name:this.KONVA_POINT_GROUP_NAME}),maskGroup:new Be.Group({name:this.KONVA_MASK_GROUP_NAME,opacity:.6}),compositingRect:new Be.Rect({name:this.KONVA_COMPOSITING_RECT_NAME,fill:Zo(this.config.MASK_COLOR),globalCompositeOperation:"source-atop",listening:!1,strokeEnabled:!1,perfectDrawEnabled:!1,visible:!1}),maskTween:null},this.konva.group.add(this.konva.maskGroup),this.konva.group.add(this.konva.pointGroup),this.konva.maskGroup.add(this.konva.compositingRect)}createPoint(n,s){const i=Te("sam_point"),o=uI(n),a=new Be.Circle({name:this.KONVA_CIRCLE_NAME,x:o.x,y:o.y,radius:this.manager.stage.unscale(this.config.SAM_POINT_RADIUS),fill:Zo(this.getSAMPointColor(s)),stroke:Zo(this.config.SAM_POINT_BORDER_COLOR),strokeWidth:this.manager.stage.unscale(this.config.SAM_POINT_BORDER_WIDTH),draggable:!0,perfectDrawEnabled:!0,opacity:.6,dragDistance:3});return a.on("pointerup",l=>{if(this.$isDraggingPoint.get()||l.evt.button!==0)return;l.cancelBubble=!0,a.destroy();const c=this.$points.get().filter(d=>d.id!==i);c.length===0?this.resetEphemeralState():this.$points.set(c)}),a.on("dragstart",()=>{this.$isDraggingPoint.set(!0)}),a.on("dragend",()=>{const l=uI(a.position());this.log.trace({...l,label:Tx[s]},"Moved SAM point"),this.$isDraggingPoint.set(!1);const c=this.$points.get().map(d=>d.id===i?{...d,coord:l}:d);this.$points.set(c)}),this.konva.pointGroup.add(a),this.log.trace({...o,label:Tx[s]},"Created SAM point"),{id:i,coord:o,label:s,konva:{circle:a}}}getSAMPointColor(n){return n===0?this.config.SAM_POINT_NEUTRAL_COLOR:n===1?this.config.SAM_POINT_FOREGROUND_COLOR:this.config.SAM_POINT_BACKGROUND_COLOR}};k(hy,"buildGraph",({image_name:n},s,i)=>{const o=new Qn(Te("canvas_segment_anything")),a=o.addNode({id:Te("segment_anything"),type:"segment_anything",model:"segment-anything-huge",image:{image_name:n},point_lists:[{points:s.map(({x:c,y:d,label:h})=>({x:c,y:d,label:h}))}],mask_filter:"largest"}),l=o.addNode({id:Te("apply_tensor_mask_to_image"),type:"apply_tensor_mask_to_image",image:{image_name:n},invert:i});return o.addEdge(a,"mask",l,"mask"),{graph:o,outputNodeId:l.id}});let _1=hy;class Y2e extends Kl{constructor(n,s){super(n,s,"control_layer_adapter");k(this,"renderer");k(this,"bufferRenderer");k(this,"transformer");k(this,"filterer");k(this,"segmentAnything");k(this,"sync",async(n,s)=>{if(!n){this.destroy();return}this.state=n,!(s&&s===this.state)&&((!s||this.state.isEnabled!==s.isEnabled)&&this.syncIsEnabled(),(!s||this.state.isLocked!==s.isLocked)&&this.syncIsLocked(),(!s||this.state.objects!==s.objects)&&await this.syncObjects(),(!s||this.state.position!==s.position)&&this.syncPosition(),(!s||this.state.opacity!==s.opacity)&&this.syncOpacity(),(!s||this.state.withTransparencyEffect!==s.withTransparencyEffect)&&this.renderer.updateTransparencyEffect())});k(this,"syncTransparencyEffect",()=>{this.renderer.updateTransparencyEffect()});k(this,"getCanvas",n=>{this.log.trace({rect:n},"Getting canvas");const s={opacity:this.state.opacity,filters:[]};return this.renderer.getCanvas({rect:n,attrs:s})});k(this,"getHashableState",()=>{const n=["name","controlAdapter","withTransparencyEffect","isLocked"];return Yo(this.state,n)});this.renderer=new Ob(this),this.bufferRenderer=new Rb(this),this.transformer=new Nb(this),this.filterer=new e$(this),this.segmentAnything=new _1(this),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(this.selectState,this.sync))}}class X2e extends Kl{constructor(n,s){super(n,s,"inpaint_mask_adapter");k(this,"renderer");k(this,"bufferRenderer");k(this,"transformer");k(this,"filterer");k(this,"segmentAnything");k(this,"sync",async(n,s)=>{if(!n){this.destroy();return}this.state=n,!(s&&s===this.state)&&((!s||this.state.isEnabled!==s.isEnabled)&&this.syncIsEnabled(),(!s||this.state.isLocked!==s.isLocked)&&this.syncIsLocked(),(!s||this.state.objects!==s.objects)&&await this.syncObjects(),(!s||this.state.position!==s.position)&&this.syncPosition(),(!s||this.state.opacity!==s.opacity)&&this.syncOpacity(),(!s||this.state.fill!==s.fill)&&this.renderer.updateCompositingRectFill(!0),(!s||this.state.objects!==s.objects)&&(this.renderer.updateCompositingRectSize(!0),this.renderer.updateCompositingRectPosition(!0)))});k(this,"getHashableState",()=>{const n=["fill","name","opacity","isLocked"];return Yo(this.state,n)});k(this,"getCanvas",n=>{const s={opacity:1,filters:[]};return this.renderer.getCanvas({rect:n,attrs:s})});this.renderer=new Ob(this),this.bufferRenderer=new Rb(this),this.transformer=new Nb(this),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(this.selectState,this.sync))}}class Q2e extends Kl{constructor(n,s){super(n,s,"raster_layer_adapter");k(this,"renderer");k(this,"bufferRenderer");k(this,"transformer");k(this,"filterer");k(this,"segmentAnything");k(this,"sync",async(n,s)=>{if(!n){this.destroy();return}this.state=n,!(s&&s===this.state)&&((!s||this.state.isEnabled!==s.isEnabled)&&this.syncIsEnabled(),(!s||this.state.isLocked!==s.isLocked)&&this.syncIsLocked(),(!s||this.state.objects!==s.objects)&&await this.syncObjects(),(!s||this.state.position!==s.position)&&this.syncPosition(),(!s||this.state.opacity!==s.opacity)&&this.syncOpacity())});k(this,"getCanvas",n=>{this.log.trace({rect:n},"Getting canvas");const s={opacity:this.state.opacity,filters:[]};return this.renderer.getCanvas({rect:n,attrs:s})});k(this,"getHashableState",()=>{const n=["name","isLocked"];return Yo(this.state,n)});this.renderer=new Ob(this),this.bufferRenderer=new Rb(this),this.transformer=new Nb(this),this.filterer=new e$(this),this.segmentAnything=new _1(this),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(this.selectState,this.sync))}}class J2e extends Kl{constructor(n,s){super(n,s,"regional_guidance_adapter");k(this,"renderer");k(this,"bufferRenderer");k(this,"transformer");k(this,"filterer");k(this,"segmentAnything");k(this,"sync",async(n,s)=>{if(!n){this.destroy();return}this.state=n,!(s&&s===this.state)&&((!s||this.state.isEnabled!==s.isEnabled)&&this.syncIsEnabled(),(!s||this.state.isLocked!==s.isLocked)&&this.syncIsLocked(),(!s||this.state.objects!==s.objects)&&await this.syncObjects(),(!s||this.state.position!==s.position)&&this.syncPosition(),(!s||this.state.opacity!==s.opacity)&&this.syncOpacity(),(!s||this.state.fill!==s.fill)&&this.renderer.updateCompositingRectFill(!0),(!s||this.state.objects!==s.objects)&&(this.renderer.updateCompositingRectSize(!0),this.renderer.updateCompositingRectPosition(!0)))});k(this,"getHashableState",()=>{const n=["fill","name","opacity","isLocked","autoNegative","positivePrompt","negativePrompt","referenceImages"];return Yo(this.state,n)});k(this,"getCanvas",n=>{const s={opacity:1,filters:[]};return this.renderer.getCanvas({rect:n,attrs:s})});this.renderer=new Ob(this),this.bufferRenderer=new Rb(this),this.transformer=new Nb(this),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(this.selectState,this.sync))}}class eCe extends zt{constructor(n){super();k(this,"type","entity_renderer");k(this,"id");k(this,"path");k(this,"log");k(this,"parent");k(this,"manager");k(this,"subscriptions",new Set);k(this,"initialize",()=>{this.log.debug("Initializing module"),this.createNewRasterLayers(this.manager.stateApi.runSelector(dI)),this.createNewControlLayers(this.manager.stateApi.runSelector(hI)),this.createNewRegionalGuidance(this.manager.stateApi.runSelector(pI)),this.createNewInpaintMasks(this.manager.stateApi.runSelector(fI)),this.arrangeEntities(this.manager.stateApi.runSelector(tt),null)});k(this,"createNewRasterLayers",n=>{for(const s of n)this.manager.adapters.rasterLayers.has(s.id)||this.manager.createAdapter(tr(s)).initialize()});k(this,"createNewControlLayers",n=>{for(const s of n)this.manager.adapters.controlLayers.has(s.id)||this.manager.createAdapter(tr(s)).initialize()});k(this,"createNewRegionalGuidance",n=>{for(const s of n)this.manager.adapters.regionMasks.has(s.id)||this.manager.createAdapter(tr(s)).initialize()});k(this,"createNewInpaintMasks",n=>{for(const s of n)this.manager.adapters.inpaintMasks.has(s.id)||this.manager.createAdapter(tr(s)).initialize()});k(this,"arrangeEntities",(n,s)=>{var i,o,a,l,c,d;if(!s||n.rasterLayers.entities!==s.rasterLayers.entities||n.controlLayers.entities!==s.controlLayers.entities||n.regionalGuidance.entities!==s.regionalGuidance.entities||n.inpaintMasks.entities!==s.inpaintMasks.entities||((i=n.selectedEntityIdentifier)==null?void 0:i.id)!==((o=s.selectedEntityIdentifier)==null?void 0:o.id)){this.log.trace("Arranging entities");let h=0;this.manager.background.konva.layer.zIndex(h++);for(const{id:f}of this.manager.stateApi.getRasterLayersState().entities)(a=this.manager.adapters.rasterLayers.get(f))==null||a.konva.layer.zIndex(h++);for(const{id:f}of this.manager.stateApi.getControlLayersState().entities)(l=this.manager.adapters.controlLayers.get(f))==null||l.konva.layer.zIndex(h++);for(const{id:f}of this.manager.stateApi.getRegionsState().entities)(c=this.manager.adapters.regionMasks.get(f))==null||c.konva.layer.zIndex(h++);for(const{id:f}of this.manager.stateApi.getInpaintMasksState().entities)(d=this.manager.adapters.inpaintMasks.get(f))==null||d.konva.layer.zIndex(h++);this.manager.konva.previewLayer.zIndex(h++)}});k(this,"destroy",()=>{this.log.trace("Destroying module"),this.subscriptions.forEach(n=>n()),this.subscriptions.clear()});this.id=Te("canvas_renderer"),this.parent=n,this.manager=n,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(dI,this.createNewRasterLayers)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(hI,this.createNewControlLayers)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(fI,this.createNewInpaintMasks)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(pI,this.createNewRegionalGuidance)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(tt,this.arrangeEntities))}}const tCe=e=>!!e.image;class nCe extends zt{constructor(n){super();k(this,"type","progress_image");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"konva");k(this,"$isLoading",Oe(!1));k(this,"$isError",Oe(!1));k(this,"imageElement",null);k(this,"subscriptions",new Set);k(this,"$lastProgressEvent",Oe(null));k(this,"$hasActiveGeneration",Oe(!1));k(this,"mutex",new g_);k(this,"setSocketEventListeners",()=>{const n=o=>{o.destination==="canvas"&&tCe(o)&&this.$hasActiveGeneration.get()&&this.$lastProgressEvent.set(o)},s=o=>{o.destination==="canvas"&&(o.status==="failed"||o.status==="canceled")&&(this.$lastProgressEvent.set(null),this.$hasActiveGeneration.set(!1))},i=()=>{this.$lastProgressEvent.set(null)};return this.manager.socket.on("invocation_progress",n),this.manager.socket.on("queue_item_status_changed",s),this.manager.socket.on("connect",i),this.manager.socket.on("connect_error",i),this.manager.socket.on("disconnect",i),()=>{this.manager.socket.off("invocation_progress",n),this.manager.socket.off("queue_item_status_changed",s),this.manager.socket.off("connect",i),this.manager.socket.off("connect_error",i),this.manager.socket.off("disconnect",i)}});k(this,"getNodes",()=>[this.konva.group]);k(this,"render",async()=>{var d;const n=await this.mutex.acquire(),s=this.$lastProgressEvent.get(),i=this.manager.stateApi.runSelector(O2);if(!s||!i){this.konva.group.visible(!1),(d=this.konva.image)==null||d.destroy(),this.konva.image=null,this.imageElement=null,this.$isLoading.set(!1),this.$isError.set(!1),n();return}this.$isLoading.set(!0);const{x:o,y:a,width:l,height:c}=this.manager.stateApi.getBbox().rect;try{this.imageElement=await xP(s.image.dataURL),this.konva.image?this.konva.image.setAttrs({image:this.imageElement,x:o,y:a,width:l,height:c}):(this.konva.image=new Be.Image({name:`${this.type}:image`,listening:!1,image:this.imageElement,x:o,y:a,width:l,height:c,perfectDrawEnabled:!1}),this.konva.group.add(this.konva.image)),this.konva.group.visible(this.manager.stagingArea.$shouldShowStagedImage.get())}catch{this.$isError.set(!0)}finally{this.$isLoading.set(!1),n()}});k(this,"destroy",()=>{this.log.debug("Destroying module"),this.subscriptions.forEach(n=>n()),this.subscriptions.clear(),this.konva.group.destroy()});k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,$lastProgressEvent:Ci(this.$lastProgressEvent.get()),$hasActiveGeneration:this.$hasActiveGeneration.get(),$isError:this.$isError.get(),$isLoading:this.$isLoading.get()}));this.id=Te(this.type),this.parent=n,this.manager=n,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating progress image module"),this.konva={group:new Be.Group({name:`${this.type}:group`,listening:!1}),image:null},this.subscriptions.add(this.manager.stagingArea.$shouldShowStagedImage.listen(this.render)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(O2,this.render)),this.subscriptions.add(this.setSocketEventListeners()),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(sJ,({data:s})=>{s&&(s.in_progress>0||s.pending>0)?this.$hasActiveGeneration.set(!0):this.$hasActiveGeneration.set(!1)})),this.subscriptions.add(this.$lastProgressEvent.listen(this.render))}}const sCe={MIN_SCALE:.1,MAX_SCALE:20,SCALE_FACTOR:.999,FIT_LAYERS_TO_STAGE_PADDING_PX:48};class rCe extends zt{constructor(n,s){super();k(this,"type","stage");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"container");k(this,"konva");k(this,"config",sCe);k(this,"$stageAttrs",Oe({x:0,y:0,width:0,height:0,scale:0}));k(this,"subscriptions",new Set);k(this,"resizeObserver",null);k(this,"setContainer",n=>{this.container=n,this.konva.stage.container(n),this.setResizeObserver()});k(this,"setResizeObserver",()=>{this.resizeObserver&&this.resizeObserver.disconnect(),this.resizeObserver=new ResizeObserver(this.fitStageToContainer),this.resizeObserver.observe(this.container)});k(this,"initialize",()=>{this.log.debug("Initializing module"),this.container.style.touchAction="none",this.container.style.userSelect="none",this.container.style.webkitUserSelect="none",this.konva.stage.container(this.container),this.setResizeObserver(),this.fitStageToContainer(),this.konva.stage.on("wheel",this.onStageMouseWheel),this.konva.stage.on("dragmove",this.onStageDragMove),this.konva.stage.on("dragend",this.onStageDragEnd),this.konva.stage.on("pointerdown",this.onStagePointerDown),this.subscriptions.add(()=>this.konva.stage.off("wheel",this.onStageMouseWheel)),this.subscriptions.add(()=>this.konva.stage.off("dragmove",this.onStageDragMove)),this.subscriptions.add(()=>this.konva.stage.off("dragend",this.onStageDragEnd)),this.subscriptions.add(this.manager.tool.$tool.listen(this.stopDragging))});k(this,"fitStageToContainer",()=>{this.log.trace("Fitting stage to container");const n=this.konva.stage.container().offsetWidth,s=this.konva.stage.container().offsetHeight;if(n===0||s===0)return;const i=this.konva.stage.width()===0||this.konva.stage.height()===0;this.konva.stage.width(n),this.konva.stage.height(s),this.syncStageAttrs(),i&&this.fitLayersToStage()});k(this,"fitBboxToStage",()=>{const{rect:n}=this.manager.stateApi.getBbox();this.log.trace({rect:n},"Fitting bbox to stage"),this.fitRect(n)});k(this,"fitLayersToStage",()=>{const n=this.manager.compositor.getVisibleRectOfType();n.width===0||n.height===0?this.fitBboxToStage():(this.log.trace({rect:n},"Fitting layers to stage"),this.fitRect(n))});k(this,"fitRect",n=>{const{width:s,height:i}=this.getSize();if(s===0||i===0)return;const o=s-this.config.FIT_LAYERS_TO_STAGE_PADDING_PX*2,a=i-this.config.FIT_LAYERS_TO_STAGE_PADDING_PX*2,l=this.constrainScale(Math.min(Math.min(o/n.width,a/n.height),1)),c=Math.floor(-n.x*l+this.config.FIT_LAYERS_TO_STAGE_PADDING_PX+(o-n.width*l)/2),d=Math.floor(-n.y*l+this.config.FIT_LAYERS_TO_STAGE_PADDING_PX+(a-n.height*l)/2);this.konva.stage.setAttrs({x:c,y:d,scaleX:l,scaleY:l}),this.syncStageAttrs({x:c,y:d,scale:l})});k(this,"getCenter",(n=!1)=>{const s=this.getScale(),{x:i,y:o}=this.getPosition(),{width:a,height:l}=this.getSize(),c={x:(a/2-i)/s,y:(l/2-o)/s};return n?this.konva.stage.getAbsoluteTransform().point(c):c});k(this,"constrainScale",n=>uo(Math.round(n*100)/100,this.config.MIN_SCALE,this.config.MAX_SCALE));k(this,"setScale",(n,s=this.getCenter(!0))=>{this.log.trace("Setting scale");const i=this.constrainScale(n),{x:o,y:a}=this.getPosition(),l=this.getScale(),c=(s.x-o)/l,d=(s.y-a)/l,h=Math.floor(s.x-c*i),f=Math.floor(s.y-d*i);this.konva.stage.setAttrs({x:h,y:f,scaleX:i,scaleY:i}),this.syncStageAttrs()});k(this,"onStageMouseWheel",n=>{if(n.evt.preventDefault(),n.evt.ctrlKey||n.evt.metaKey)return;const s=this.konva.stage.getPointerPosition();if(s){const i=n.evt.ctrlKey?-n.evt.deltaY:n.evt.deltaY,o=this.manager.stage.getScale()*this.config.SCALE_FACTOR**i;this.manager.stage.setScale(o,s)}});k(this,"onStagePointerDown",n=>{n.evt.button===1&&this.startDragging()});k(this,"startDragging",()=>{this.setIsDraggable(!0),this.getIsDragging()||this.konva.stage.startDrag(),this.manager.tool.render()});k(this,"stopDragging",()=>{this.setIsDraggable(this.manager.tool.$tool.get()==="view"),this.getIsDragging()&&this.konva.stage.stopDrag(),this.manager.tool.render()});k(this,"onStageDragMove",n=>{n.target===this.konva.stage&&this.syncStageAttrs()});k(this,"onStageDragEnd",n=>{n.target===this.konva.stage&&this.stopDragging()});k(this,"getScale",()=>this.konva.stage.scaleX());k(this,"getPosition",()=>this.konva.stage.position());k(this,"unscale",n=>n/this.getScale());k(this,"setCursor",n=>{this.container.style.cursor!==n&&(this.container.style.cursor=n)});k(this,"syncStageAttrs",n=>{this.$stageAttrs.set({x:this.konva.stage.x(),y:this.konva.stage.y(),width:this.konva.stage.width(),height:this.konva.stage.height(),scale:this.konva.stage.scaleX(),...n})});k(this,"setIsDraggable",n=>{this.konva.stage.draggable(n)});k(this,"getIsDragging",()=>this.konva.stage.isDragging());k(this,"addLayer",n=>{this.konva.stage.add(n)});k(this,"getScaledStageRect",(n=!0)=>{const{x:s,y:i}=this.getPosition(),{width:o,height:a}=this.getSize(),l=this.getScale();return{x:n?Math.floor(-s/l):-s/l,y:n?Math.floor(-i/l):-i/l,width:n?Math.ceil(o/l):o/l,height:n?Math.ceil(a/l):a/l}});k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,config:this.config,$stageAttrs:this.$stageAttrs.get(),konva:{stage:ds(this.konva.stage)}}));k(this,"destroy",()=>{this.log.debug("Destroying module"),this.subscriptions.forEach(n=>n()),this.subscriptions.clear(),this.resizeObserver&&this.resizeObserver.disconnect(),this.konva.stage.destroy()});this.id=Te("stage"),this.parent=s,this.manager=s,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.container=n,this.konva={stage:new Be.Stage({id:Te("konva_stage"),container:n})}}getSize(){return this.konva.stage.size()}}class iCe extends zt{constructor(n){super();k(this,"type","staging_area");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"subscriptions",new Set);k(this,"konva");k(this,"image");k(this,"selectedImage");k(this,"$shouldShowStagedImage",Oe(!0));k(this,"$isStaging",Oe(!1));k(this,"initialize",()=>{this.log.debug("Initializing module"),this.render(),this.$isStaging.set(this.manager.stateApi.runSelector(Fn))});k(this,"render",async()=>{var a,l;this.log.trace("Rendering staging area");const n=this.manager.stateApi.runSelector(N2),{x:s,y:i}=this.manager.stateApi.getBbox().rect,o=this.$shouldShowStagedImage.get();if(this.selectedImage=n.stagedImages[n.selectedStagedImageIndex]??null,this.konva.group.position({x:s,y:i}),this.selectedImage){const{imageDTO:c}=this.selectedImage,d=Wl(c),h=(a=this.manager.progressImage.$lastProgressEvent.get())==null?void 0:a.session_id,f=()=>{var g;const p=(g=this.manager.progressImage.$lastProgressEvent.get())==null?void 0:g.session_id;h===p&&this.manager.progressImage.$lastProgressEvent.set(null)};this.image?this.image.isLoading||(this.image.state.image.image_name!==d.image_name?(await this.image.update({...this.image.state,image:d},!0),f()):this.image.isError&&f()):(this.image=new $a({id:"staging-area-image",type:"image",image:d},this),await this.image.update(this.image.state,!0),this.konva.group.add(this.image.konva.group),f()),this.image.konva.group.visible(o)}else(l=this.image)==null||l.destroy(),this.image=null});k(this,"getNodes",()=>[this.konva.group]);k(this,"destroy",()=>{this.log.debug("Destroying module"),this.subscriptions.forEach(n=>n()),this.subscriptions.clear(),this.image&&this.image.destroy();for(const n of this.getNodes())n.destroy()});k(this,"repr",()=>{var n;return{id:this.id,type:this.type,path:this.path,selectedImage:this.selectedImage,$shouldShowStagedImage:this.$shouldShowStagedImage.get(),$isStaging:this.$isStaging.get(),image:((n=this.image)==null?void 0:n.repr())??null}});this.id=Te(this.type),this.parent=n,this.manager=n,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.konva={group:new Be.Group({name:`${this.type}:group`,listening:!1})},this.image=null,this.selectedImage=null,this.subscriptions.add(this.$shouldShowStagedImage.listen(this.render)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(N2,this.render)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(Fn,(s,i)=>{this.$isStaging.set(s),s&&!i&&this.$shouldShowStagedImage.set(!0)}))}}const oCe=["top-left","top-center","top-right","middle-right","middle-left","bottom-left","bottom-center","bottom-right"],aCe=["top-left","top-right","bottom-left","bottom-right"],lCe=[];class cCe extends zt{constructor(n){super();k(this,"type","bbox");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"subscriptions",new Set);k(this,"konva");k(this,"$aspectRatioBuffer",Oe(1));k(this,"syncCursorStyle",wP);k(this,"initialize",()=>{this.log.debug("Initializing module");const{width:n,height:s}=this.manager.stateApi.runSelector(iu).rect;this.$aspectRatioBuffer.set(n/s),this.render()});k(this,"render",()=>{const n=this.manager.tool.$tool.get(),{x:s,y:i,width:o,height:a}=this.manager.stateApi.runSelector(iu).rect;this.konva.group.listening(n==="bbox"&&!this.manager.$isBusy.get()),this.konva.proxyRect.setAttrs({x:s,y:i,width:o,height:a,scaleX:1,scaleY:1,listening:n==="bbox"}),this.syncOverlay(),this.konva.transformer.setAttrs({listening:n==="bbox",enabledAnchors:n==="bbox"?oCe:lCe})});k(this,"syncOverlay",()=>{const n=this.manager.stateApi.getSettings().bboxOverlay;if(this.konva.overlayGroup.visible(n),!n)return;const s=this.manager.stage.$stageAttrs.get();this.konva.overlayRect.setAttrs({x:-s.x/s.scale,y:-s.y/s.scale,width:s.width/s.scale,height:s.height/s.scale})});k(this,"onDragMove",()=>{const n=this.manager.stateApi.getGridSize(),s=this.manager.stateApi.getBbox(),i={...s.rect,x:qr(this.konva.proxyRect.x(),n),y:qr(this.konva.proxyRect.y(),n)};this.konva.proxyRect.setAttrs(i),(s.rect.x!==i.x||s.rect.y!==i.y)&&this.manager.stateApi.setGenerationBbox(i)});k(this,"onTransform",()=>{const n=this.konva.transformer.getActiveAnchor();if(!n)return;const s=this.manager.stateApi.$altKey.get(),i=this.manager.stateApi.$ctrlKey.get(),o=this.manager.stateApi.$metaKey.get(),a=this.manager.stateApi.$shiftKey.get();let l=i||o?this.manager.stateApi.getBboxGridSize():64;this.manager.stateApi.$altKey.get()&&(l=l*2);let c=this.konva.proxyRect.x(),d=this.konva.proxyRect.y(),h=im(this.konva.proxyRect.width()*this.konva.proxyRect.scaleX(),l),f=im(this.konva.proxyRect.height()*this.konva.proxyRect.scaleY(),l);if(a&&aCe.includes(n)&&!s){let g=Math.sqrt(h*f*this.$aspectRatioBuffer.get()),m=g/this.$aspectRatioBuffer.get();g=im(g,l),m=im(m,l),n==="top-left"&&(c=c-(g-h),d=d-(m-f)),n==="top-right"&&(d=d-(m-f)),n==="bottom-left"&&(c=c-(g-h)),h=g,f=m}const p={x:Math.round(c),y:Math.round(d),width:h,height:f};this.konva.proxyRect.setAttrs({...p,scaleX:1,scaleY:1}),this.manager.stateApi.setGenerationBbox(p),a||this.$aspectRatioBuffer.set(p.width/p.height)});k(this,"onTransformEnd",()=>{this.$aspectRatioBuffer.set(this.konva.proxyRect.width()/this.konva.proxyRect.height())});k(this,"anchorStyleFunc",n=>{(n.hasName("top-center")||n.hasName("bottom-center"))&&(n.height(8),n.offsetY(4),n.width(30),n.offsetX(15)),(n.hasName("middle-left")||n.hasName("middle-right"))&&(n.height(30),n.offsetY(15),n.width(8),n.offsetX(4))});k(this,"fitToLayers",()=>{const n=this.manager.compositor.getVisibleRectOfType();if(n.height===0||n.width===0)return;const s=this.manager.stateApi.getBboxGridSize(),i=rJ(n,s);this.manager.stateApi.setGenerationBbox(i)});k(this,"anchorDragBoundFunc",(n,s)=>{const i=this.konva.transformer.getStage();we(i,"Stage must exist");const a=(this.manager.stateApi.$ctrlKey.get()||this.manager.stateApi.$metaKey.get()?this.manager.stateApi.getBboxGridSize():64)*i.scaleX(),l=i.getAbsolutePosition(),c=l.x%a,d=l.y%a;return{x:qr(s.x,a)+c,y:qr(s.y,a)+d}});k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,aspectRatioBuffer:this.$aspectRatioBuffer.get(),konva:{group:ds(this.konva.group),proxyRect:ds(this.konva.proxyRect),transformer:ds(this.konva.transformer)}}));k(this,"destroy",()=>{this.log.trace("Destroying module"),this.subscriptions.forEach(n=>n()),this.subscriptions.clear(),this.konva.group.destroy()});this.id=Te(this.type),this.parent=n,this.manager=n.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating bbox module"),this.konva={group:new Be.Group({name:`${this.type}:group`,listening:!1}),proxyRect:new Be.Rect({name:`${this.type}:rect`,listening:!1,strokeEnabled:!0,draggable:!0,stroke:"rgb(42,42,42)",strokeWidth:1,strokeScaleEnabled:!1,perfectDrawEnabled:!1}),overlayGroup:new Be.Group({name:`${this.type}:overlayGroup`,listening:!1,clipFunc:s=>{const i=this.manager.stage.getScaledStageRect(),o=this.manager.stateApi.runSelector(iu).rect;s.beginPath(),s.moveTo(i.x,i.y),s.lineTo(i.x+i.width,i.y),s.lineTo(i.x+i.width,i.y+i.height),s.lineTo(i.x,i.y+i.height),s.closePath(),s.moveTo(o.x,o.y),s.lineTo(o.x,o.y+o.height),s.lineTo(o.x+o.width,o.y+o.height),s.lineTo(o.x+o.width,o.y),s.closePath()}}),overlayRect:new Be.Rect({name:`${this.type}:overlay`,listening:!1,strokeEnabled:!1,draggable:!1,fill:"hsl(220 12% 10% / 0.8)",perfectDrawEnabled:!1}),transformer:new Be.Transformer({listening:!1,name:`${this.type}:transformer`,borderDash:[5,5],borderStroke:"rgba(212,216,234,1)",borderEnabled:!0,borderStrokeWidth:1,rotateEnabled:!1,keepRatio:!1,ignoreStroke:!0,flipEnabled:!1,anchorFill:"rgba(212,216,234,1)",anchorStroke:"rgb(42,42,42)",anchorSize:12,anchorCornerRadius:3,shiftBehavior:"none",centeredScaling:!1,anchorStyleFunc:this.anchorStyleFunc,anchorDragBoundFunc:this.anchorDragBoundFunc})},this.konva.proxyRect.on("dragmove",this.onDragMove),this.konva.proxyRect.on("pointerenter",()=>{this.manager.stage.setCursor("move")}),this.konva.proxyRect.on("pointerleave",()=>{this.manager.stage.setCursor("default")}),this.konva.transformer.on("transform",this.onTransform),this.konva.transformer.on("transformend",this.onTransformEnd),this.subscriptions.add(()=>{this.konva.proxyRect.off("dragmove pointerenter pointerleave"),this.konva.transformer.off("transform transformend")}),this.konva.transformer.nodes([this.konva.proxyRect]),this.konva.overlayGroup.add(this.konva.overlayRect),this.konva.group.add(this.konva.overlayGroup),this.konva.group.add(this.konva.proxyRect),this.konva.group.add(this.konva.transformer),this.subscriptions.add(this.parent.$tool.listen(this.render)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(iu,this.render)),this.subscriptions.add(this.manager.stage.$stageAttrs.listen(this.syncOverlay)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(CP,this.render)),this.subscriptions.add(this.manager.$isBusy.listen(this.render))}}const uCe={BORDER_INNER_COLOR:"rgba(0,0,0,1)",BORDER_OUTER_COLOR:"rgba(255,255,255,0.8)",HIDE_FILL_TIMEOUT_MS:1500};class dCe extends zt{constructor(n){super();k(this,"type","brush_tool");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"config",uCe);k(this,"hideFillTimeoutId",null);k(this,"konva");k(this,"syncCursorStyle",()=>{this.manager.stage.setCursor("none")});k(this,"render",()=>{if(this.parent.$tool.get()!=="brush"){this.setVisibility(!1);return}if(!this.parent.getCanDraw()){this.setVisibility(!1);return}const n=this.parent.$cursorPos.get();if(!n){this.setVisibility(!1);return}const s=this.parent.$isPrimaryPointerDown.get(),i=this.parent.$lastPointerType.get();if(i!=="mouse"&&s){this.setVisibility(!1);return}this.setVisibility(!0),this.hideFillTimeoutId!==null&&(window.clearTimeout(this.hideFillTimeoutId),this.hideFillTimeoutId=null);const o=this.manager.stateApi.getSettings(),a=this.manager.stateApi.getBrushPreviewColor(),l=$o(n.relative,o.brushWidth),c=o.brushWidth/2;this.konva.fillCircle.setAttrs({x:l.x,y:l.y,radius:c,fill:Zo(a),visible:!s&&i==="mouse"});const d=this.manager.stage.unscale(1),h=this.manager.stage.unscale(2);this.konva.innerBorder.setAttrs({x:n.relative.x,y:n.relative.y,innerRadius:c,outerRadius:c+d}),this.konva.outerBorder.setAttrs({x:n.relative.x,y:n.relative.y,innerRadius:c+d,outerRadius:c+h}),this.hideFillTimeoutId=window.setTimeout(()=>{this.konva.fillCircle.visible(!1),this.hideFillTimeoutId=null},this.config.HIDE_FILL_TIMEOUT_MS)});k(this,"setVisibility",n=>{this.konva.group.visible(n)});k(this,"onStagePointerEnter",async n=>{const s=this.parent.$cursorPos.get(),i=this.parent.$isPrimaryPointerDown.get(),o=this.manager.stateApi.getSelectedEntityAdapter();if(!s||!i||!o)return;const a=this.manager.stateApi.getSettings(),l=eo(s.relative,o.state.position),c=$o(l,a.brushWidth);n.evt.pointerType==="pen"&&a.pressureSensitivity?await o.bufferRenderer.setBuffer({id:Te("brush_line_with_pressure"),type:"brush_line_with_pressure",points:[c.x,c.y,n.evt.pressure],strokeWidth:a.brushWidth,color:this.manager.stateApi.getCurrentColor(),clip:this.parent.getClip(o.state)}):await o.bufferRenderer.setBuffer({id:Te("brush_line"),type:"brush_line",points:[c.x,c.y],strokeWidth:a.brushWidth,color:this.manager.stateApi.getCurrentColor(),clip:this.parent.getClip(o.state)})});k(this,"onStagePointerDown",async n=>{const s=this.parent.$cursorPos.get(),i=this.parent.$isPrimaryPointerDown.get(),o=this.manager.stateApi.getSelectedEntityAdapter();if(!s||!o||!i)return;o.bufferRenderer.hasBuffer()&&o.bufferRenderer.commitBuffer();const a=this.manager.stateApi.getSettings(),l=eo(s.relative,o.state.position),c=$o(l,a.brushWidth);if(n.evt.pointerType==="pen"&&a.pressureSensitivity){const d=SP(o.state.objects,"brush_line_with_pressure");let h,f=!1;n.evt.shiftKey&&d?(f=!0,h=[d.x,d.y,d.pressure,c.x,c.y,n.evt.pressure]):h=[c.x,c.y,n.evt.pressure],await o.bufferRenderer.setBuffer({id:Te("brush_line_with_pressure"),type:"brush_line_with_pressure",points:h,strokeWidth:a.brushWidth,color:this.manager.stateApi.getCurrentColor(),clip:f&&!a.clipToBbox?null:this.parent.getClip(o.state)})}else{const d=jP(o.state.objects,"brush_line");let h,f=!1;n.evt.shiftKey&&d?(f=!0,h=[d.x,d.y,c.x,c.y]):h=[c.x,c.y],await o.bufferRenderer.setBuffer({id:Te("brush_line"),type:"brush_line",points:h,strokeWidth:a.brushWidth,color:this.manager.stateApi.getCurrentColor(),clip:f&&!a.clipToBbox?null:this.parent.getClip(o.state)})}});k(this,"onStagePointerUp",n=>{var i,o;const s=this.manager.stateApi.getSelectedEntityAdapter();s&&((((i=s.bufferRenderer.state)==null?void 0:i.type)==="brush_line"||((o=s.bufferRenderer.state)==null?void 0:o.type)==="brush_line_with_pressure")&&s.bufferRenderer.hasBuffer()?s.bufferRenderer.commitBuffer():s.bufferRenderer.clearBuffer())});k(this,"onStagePointerMove",async n=>{const s=this.parent.$cursorPos.get();if(!s||!this.parent.$isPrimaryPointerDown.get())return;const i=this.manager.stateApi.getSelectedEntityAdapter();if(!i)return;const o=i.bufferRenderer.state;if(!o||o.type!=="brush_line"&&o.type!=="brush_line_with_pressure")return;const a=this.manager.stateApi.getSettings(),l=kP(o.points),c=a.brushWidth*this.parent.config.BRUSH_SPACING_TARGET_SCALE;if(!l||!_P(s.relative,l,c))return;const d=eo(s.relative,i.state.position),h=$o(d,a.brushWidth);l.x===h.x&&l.y===h.y||(o.points.push(h.x,h.y),o.type==="brush_line_with_pressure"&&a.pressureSensitivity&&o.points.push(n.evt.pressure),await i.bufferRenderer.setBuffer(o))});k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,config:this.config}));k(this,"destroy",()=>{this.log.debug("Destroying module"),this.konva.group.destroy()});this.id=Te(this.type),this.parent=n,this.manager=this.parent.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.konva={group:new Be.Group({name:`${this.type}:brush_group`,listening:!1}),fillCircle:new Be.Circle({name:`${this.type}:brush_fill_circle`,listening:!1,strokeEnabled:!1,perfectDrawEnabled:!1}),innerBorder:new Be.Ring({name:`${this.type}:brush_inner_border_ring`,listening:!1,innerRadius:0,outerRadius:0,fill:this.config.BORDER_INNER_COLOR,strokeEnabled:!1,perfectDrawEnabled:!1}),outerBorder:new Be.Ring({name:`${this.type}:brush_outer_border_ring`,listening:!1,innerRadius:0,outerRadius:0,fill:this.config.BORDER_OUTER_COLOR,strokeEnabled:!1,perfectDrawEnabled:!1})},this.konva.group.add(this.konva.fillCircle,this.konva.innerBorder,this.konva.outerBorder)}}const hCe={RING_INNER_RADIUS:25,RING_OUTER_RADIUS:35,RING_BORDER_INNER_COLOR:"rgba(0,0,0,1)",RING_BORDER_OUTER_COLOR:"rgba(255,255,255,0.8)",CROSSHAIR_INNER_RADIUS:5,CROSSHAIR_LINE_THICKNESS:1.5,CROSSHAIR_LINE_BORDER_THICKNESS:.75,CROSSHAIR_LINE_LENGTH:10,CROSSHAIR_LINE_COLOR:"rgba(0,0,0,1)",CROSSHAIR_BORDER_COLOR:"rgba(255,255,255,0.8)",TEXT_COLOR:"rgba(255,255,255,1)",TEXT_BG_COLOR:"rgba(0,0,0,0.8)",TEXT_BG_HEIGHT:62,TEXT_BG_WIDTH:62,TEXT_BG_CORNER_RADIUS:7,TEXT_PADDING:8,TEXT_FONT_SIZE:12,TEXT_BG_X_OFFSET:7};class fCe extends zt{constructor(n){super();k(this,"type","color_picker_tool");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"config",hCe);k(this,"$colorUnderCursor",Oe(IP));k(this,"konva");k(this,"syncCursorStyle",()=>{this.manager.stage.setCursor("none")});k(this,"render",()=>{if(this.parent.$tool.get()!=="colorPicker"){this.setVisibility(!1);return}const n=this.parent.$cursorPos.get();if(!n){this.setVisibility(!1);return}this.setVisibility(!0);const{x:s,y:i}=n.relative,o=this.manager.stateApi.getSettings(),a=this.$colorUnderCursor.get(),l=this.manager.stage.unscale(this.config.RING_INNER_RADIUS),c=this.manager.stage.unscale(this.config.RING_OUTER_RADIUS),d=this.manager.stage.unscale(1),h=this.manager.stage.unscale(2);this.konva.ringCandidateColor.setAttrs({x:s,y:i,fill:Zl(a),innerRadius:l,outerRadius:c}),this.konva.ringCurrentColor.setAttrs({x:s,y:i,fill:Zl(o.color),innerRadius:l,outerRadius:c}),this.konva.ringInnerBorder.setAttrs({x:s,y:i,innerRadius:c,outerRadius:c+d}),this.konva.ringOuterBorder.setAttrs({x:s,y:i,innerRadius:c+d,outerRadius:c+h});const f=this.manager.stage.unscale(this.config.TEXT_BG_WIDTH),p=this.manager.stage.unscale(this.config.TEXT_BG_HEIGHT);this.konva.rgbaTextBackground.setAttrs({width:f,height:p,cornerRadius:this.manager.stage.unscale(this.config.TEXT_BG_CORNER_RADIUS)}),this.konva.rgbaText.setAttrs({padding:this.manager.stage.unscale(this.config.TEXT_PADDING),fontSize:this.manager.stage.unscale(this.config.TEXT_FONT_SIZE),text:`R: ${a.r}
G: ${a.g}
B: ${a.b}
A: ${a.a}`}),this.konva.rgbaTextGroup.setAttrs({x:s+this.manager.stage.unscale(this.config.RING_OUTER_RADIUS+this.config.TEXT_BG_X_OFFSET),y:i-p/2});const g=this.manager.stage.unscale(this.config.CROSSHAIR_LINE_LENGTH),m=this.manager.stage.unscale(this.config.CROSSHAIR_INNER_RADIUS),y=this.manager.stage.unscale(this.config.CROSSHAIR_LINE_THICKNESS),b=this.manager.stage.unscale(this.config.CROSSHAIR_LINE_THICKNESS+this.config.CROSSHAIR_LINE_BORDER_THICKNESS*2);this.konva.crosshairNorthOuter.setAttrs({strokeWidth:b,points:[s,i-g,s,i-m]}),this.konva.crosshairNorthInner.setAttrs({strokeWidth:y,points:[s,i-g,s,i-m]}),this.konva.crosshairEastOuter.setAttrs({strokeWidth:b,points:[s+m,i,s+g,i]}),this.konva.crosshairEastInner.setAttrs({strokeWidth:y,points:[s+m,i,s+g,i]}),this.konva.crosshairSouthOuter.setAttrs({strokeWidth:b,points:[s,i+m,s,i+g]}),this.konva.crosshairSouthInner.setAttrs({strokeWidth:y,points:[s,i+m,s,i+g]}),this.konva.crosshairWestOuter.setAttrs({strokeWidth:b,points:[s-m,i,s-g,i]}),this.konva.crosshairWestInner.setAttrs({strokeWidth:y,points:[s-m,i,s-g,i]})});k(this,"setVisibility",n=>{this.konva.group.visible(n)});k(this,"onStagePointerUp",n=>{const s=this.$colorUnderCursor.get();this.manager.stateApi.setColor({...s,a:s.a/255})});k(this,"onStagePointerMove",n=>{this.syncColorUnderCursor()});k(this,"syncColorUnderCursor",A9(()=>{const n=this.parent.$cursorPos.get();if(!n)return;this.manager.background.konva.layer.visible(!1);const s=iJ(this.manager.stage.konva.stage,n.absolute);this.manager.background.konva.layer.visible(!0),s&&this.$colorUnderCursor.set(s)}));k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,config:this.config,$colorUnderCursor:this.$colorUnderCursor.get()}));k(this,"destroy",()=>{this.log.debug("Destroying color picker tool preview module"),this.konva.group.destroy()});this.id=Te(this.type),this.parent=n,this.manager=this.parent.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.konva={group:new Be.Group({name:`${this.type}:color_picker_group`,listening:!1}),ringCandidateColor:new Be.Ring({listening:!1,name:`${this.type}:color_picker_candidate_color_ring`,innerRadius:0,outerRadius:0,strokeEnabled:!1,perfectDrawEnabled:!1}),ringCurrentColor:new Be.Arc({listening:!1,name:`${this.type}:color_picker_current_color_arc`,innerRadius:0,outerRadius:0,angle:180,strokeEnabled:!1,perfectDrawEnabled:!1}),ringInnerBorder:new Be.Ring({listening:!1,name:`${this.type}:color_picker_inner_border_ring`,innerRadius:0,outerRadius:0,fill:this.config.RING_BORDER_INNER_COLOR,strokeEnabled:!1,perfectDrawEnabled:!1}),ringOuterBorder:new Be.Ring({listening:!1,name:`${this.type}:color_picker_outer_border_ring`,innerRadius:0,outerRadius:0,fill:this.config.RING_BORDER_OUTER_COLOR,strokeEnabled:!1,perfectDrawEnabled:!1}),crosshairNorthInner:new Be.Line({listening:!1,name:`${this.type}:color_picker_crosshair_north1_line`,stroke:this.config.CROSSHAIR_LINE_COLOR,perfectDrawEnabled:!1}),crosshairNorthOuter:new Be.Line({listening:!1,name:`${this.type}:color_picker_crosshair_north2_line`,stroke:this.config.CROSSHAIR_BORDER_COLOR,perfectDrawEnabled:!1}),crosshairEastInner:new Be.Line({listening:!1,name:`${this.type}:color_picker_crosshair_east1_line`,stroke:this.config.CROSSHAIR_LINE_COLOR,perfectDrawEnabled:!1}),crosshairEastOuter:new Be.Line({listening:!1,name:`${this.type}:color_picker_crosshair_east2_line`,stroke:this.config.CROSSHAIR_BORDER_COLOR,perfectDrawEnabled:!1}),crosshairSouthInner:new Be.Line({listening:!1,name:`${this.type}:color_picker_crosshair_south1_line`,stroke:this.config.CROSSHAIR_LINE_COLOR,perfectDrawEnabled:!1}),crosshairSouthOuter:new Be.Line({listening:!1,name:`${this.type}:color_picker_crosshair_south2_line`,stroke:this.config.CROSSHAIR_BORDER_COLOR,perfectDrawEnabled:!1}),crosshairWestInner:new Be.Line({listening:!1,name:`${this.type}:color_picker_crosshair_west1_line`,stroke:this.config.CROSSHAIR_LINE_COLOR,perfectDrawEnabled:!1}),crosshairWestOuter:new Be.Line({listening:!1,name:`${this.type}:color_picker_crosshair_west2_line`,stroke:this.config.CROSSHAIR_BORDER_COLOR,perfectDrawEnabled:!1}),rgbaTextGroup:new Be.Group({listening:!1,name:`${this.type}:color_picker_text_group`}),rgbaText:new Be.Text({listening:!1,name:`${this.type}:color_picker_text`,fill:this.config.TEXT_COLOR,fontFamily:"monospace",align:"left",fontStyle:"bold",verticalAlign:"middle"}),rgbaTextBackground:new Be.Rect({listening:!1,name:`${this.type}:color_picker_text_background`,fill:this.config.TEXT_BG_COLOR})},this.konva.rgbaTextGroup.add(this.konva.rgbaTextBackground,this.konva.rgbaText),this.konva.group.add(this.konva.ringCandidateColor,this.konva.ringCurrentColor,this.konva.ringInnerBorder,this.konva.ringOuterBorder,this.konva.crosshairNorthOuter,this.konva.crosshairNorthInner,this.konva.crosshairEastOuter,this.konva.crosshairEastInner,this.konva.crosshairSouthOuter,this.konva.crosshairSouthInner,this.konva.crosshairWestOuter,this.konva.crosshairWestInner,this.konva.rgbaTextGroup)}}const pCe={BORDER_INNER_COLOR:"rgba(0,0,0,1)",BORDER_OUTER_COLOR:"rgba(255,255,255,0.8)"};class gCe extends zt{constructor(n){super();k(this,"type","eraser_tool");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"config",pCe);k(this,"konva");k(this,"syncCursorStyle",()=>{this.manager.stage.setCursor("none")});k(this,"render",()=>{if(this.parent.$tool.get()!=="eraser"){this.setVisibility(!1);return}if(!this.parent.getCanDraw()){this.setVisibility(!1);return}const n=this.parent.$cursorPos.get();if(!n){this.setVisibility(!1);return}const s=this.parent.$isPrimaryPointerDown.get();if(this.parent.$lastPointerType.get()!=="mouse"&&s){this.setVisibility(!1);return}this.setVisibility(!0);const o=this.manager.stateApi.getSettings(),a=$o(n.relative,o.eraserWidth),l=o.eraserWidth/2;this.konva.cutoutCircle.setAttrs({x:a.x,y:a.y,radius:l});const c=this.manager.stage.unscale(1),d=this.manager.stage.unscale(2);this.konva.innerBorder.setAttrs({x:n.relative.x,y:n.relative.y,innerRadius:l,outerRadius:l+c}),this.konva.outerBorder.setAttrs({x:n.relative.x,y:n.relative.y,innerRadius:l+c,outerRadius:l+d})});k(this,"setVisibility",n=>{this.konva.group.visible(n)});k(this,"onStagePointerEnter",async n=>{const s=this.parent.$cursorPos.get(),i=this.parent.$isPrimaryPointerDown.get(),o=this.manager.stateApi.getSelectedEntityAdapter();if(!s||!i||!o)return;const a=this.manager.stateApi.getSettings(),l=eo(s.relative,o.state.position),c=$o(l,a.brushWidth);n.evt.pointerType==="pen"&&a.pressureSensitivity?await o.bufferRenderer.setBuffer({id:Te("eraser_line_with_pressure"),type:"eraser_line_with_pressure",points:[c.x,c.y,n.evt.pressure],strokeWidth:a.eraserWidth,clip:this.parent.getClip(o.state)}):await o.bufferRenderer.setBuffer({id:Te("eraser_line"),type:"eraser_line",points:[c.x,c.y],strokeWidth:a.eraserWidth,clip:this.parent.getClip(o.state)})});k(this,"onStagePointerDown",async n=>{const s=this.parent.$cursorPos.get(),i=this.parent.$isPrimaryPointerDown.get(),o=this.manager.stateApi.getSelectedEntityAdapter();if(!s||!o||!i)return;const a=this.manager.stateApi.getSettings(),l=eo(s.relative,o.state.position);if(n.evt.pointerType==="pen"&&a.pressureSensitivity){const c=SP(o.state.objects,"eraser_line_with_pressure"),d=$o(l,a.eraserWidth);o.bufferRenderer.hasBuffer()&&o.bufferRenderer.commitBuffer();let h;n.evt.shiftKey&&c?h=[c.x,c.y,c.pressure,d.x,d.y,n.evt.pressure]:h=[d.x,d.y,n.evt.pressure],await o.bufferRenderer.setBuffer({id:Te("eraser_line_with_pressure"),type:"eraser_line_with_pressure",points:h,strokeWidth:a.eraserWidth,clip:this.parent.getClip(o.state)})}else{const c=jP(o.state.objects,"eraser_line"),d=$o(l,a.eraserWidth);o.bufferRenderer.hasBuffer()&&o.bufferRenderer.commitBuffer();let h;n.evt.shiftKey&&c?h=[c.x,c.y,d.x,d.y]:h=[d.x,d.y],await o.bufferRenderer.setBuffer({id:Te("eraser_line"),type:"eraser_line",points:h,strokeWidth:a.eraserWidth,clip:this.parent.getClip(o.state)})}});k(this,"onStagePointerUp",n=>{var i,o;const s=this.manager.stateApi.getSelectedEntityAdapter();s&&((((i=s.bufferRenderer.state)==null?void 0:i.type)==="eraser_line"||((o=s.bufferRenderer.state)==null?void 0:o.type)==="eraser_line_with_pressure")&&s.bufferRenderer.hasBuffer()?s.bufferRenderer.commitBuffer():s.bufferRenderer.clearBuffer())});k(this,"onStagePointerMove",async n=>{const s=this.parent.$cursorPos.get();if(!s||!this.parent.$isPrimaryPointerDown.get())return;const i=this.manager.stateApi.getSelectedEntityAdapter();if(!i)return;const o=i.bufferRenderer.state;if(!o||o.type!=="eraser_line"&&o.type!=="eraser_line_with_pressure")return;const a=this.manager.stateApi.getSettings(),l=kP(o.points),c=a.eraserWidth*this.parent.config.BRUSH_SPACING_TARGET_SCALE;if(!l||!_P(s.relative,l,c))return;const d=eo(s.relative,i.state.position),h=$o(d,a.eraserWidth);l.x===h.x&&l.y===h.y||(o.points.push(h.x,h.y),o.type==="eraser_line_with_pressure"&&a.pressureSensitivity&&o.points.push(n.evt.pressure),await i.bufferRenderer.setBuffer(o))});k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,config:this.config}));k(this,"destroy",()=>{this.log.debug("Destroying eraser tool preview module"),this.konva.group.destroy()});this.id=Te(this.type),this.parent=n,this.manager=this.parent.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.konva={group:new Be.Group({name:`${this.type}:eraser_group`,listening:!1}),cutoutCircle:new Be.Circle({name:`${this.type}:eraser_cutout_circle`,listening:!1,strokeEnabled:!1,fill:"white",globalCompositeOperation:"destination-out",perfectDrawEnabled:!1}),innerBorder:new Be.Ring({name:`${this.type}:eraser_inner_border_ring`,listening:!1,innerRadius:0,outerRadius:0,fill:this.config.BORDER_INNER_COLOR,strokeEnabled:!1,perfectDrawEnabled:!1}),outerBorder:new Be.Ring({listening:!1,name:`${this.type}:eraser_outer_border_ring`,innerRadius:0,outerRadius:0,fill:this.config.BORDER_OUTER_COLOR,strokeEnabled:!1,perfectDrawEnabled:!1})},this.konva.group.add(this.konva.cutoutCircle,this.konva.innerBorder,this.konva.outerBorder)}}const mCe={NUDGE_PX:1};class yCe extends zt{constructor(n){super();k(this,"type","move_tool");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"config",mCe);k(this,"nudgeOffsets");k(this,"syncCursorStyle",()=>{const n=this.manager.stateApi.getSelectedEntityAdapter();n?n.transformer.syncCursorStyle():this.manager.stage.setCursor("not-allowed")});k(this,"nudge",n=>{if(ng.get()!=="canvas")return;const s=this.manager.stateApi.getSelectedEntityAdapter();if(!s||s.$isDisabled.get()||s.$isEmpty.get()||s.$isLocked.get()||s.$isEntityTypeHidden.get())return;const i=this.manager.$isBusy.get(),o=this.parent.$tool.get()==="move",a=this.manager.stateApi.$transformingAdapter.get()===s;if(i){if(!a)return}else if(!o)return;const l=this.nudgeOffsets[n];s.transformer.nudgeBy(l)});this.id=Te(this.type),this.parent=n,this.manager=this.parent.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.nudgeOffsets={ArrowLeft:{x:-this.config.NUDGE_PX,y:0},ArrowRight:{x:this.config.NUDGE_PX,y:0},ArrowUp:{x:0,y:-this.config.NUDGE_PX},ArrowDown:{x:0,y:this.config.NUDGE_PX}}}isNudgeKey(n){return this.nudgeOffsets[n]!==void 0}}class bCe extends zt{constructor(n){super();k(this,"type","rect_tool");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"syncCursorStyle",()=>{this.manager.stage.setCursor("crosshair")});k(this,"onStagePointerDown",async n=>{const s=this.parent.$cursorPos.get(),i=this.parent.$isPrimaryPointerDown.get(),o=this.manager.stateApi.getSelectedEntityAdapter();if(!s||!i||!o)return;const a=eo(s.relative,o.state.position);await o.bufferRenderer.setBuffer({id:Te("rect"),type:"rect",rect:{x:Math.round(a.x),y:Math.round(a.y),width:0,height:0},color:this.manager.stateApi.getCurrentColor()})});k(this,"onStagePointerUp",n=>{var i;const s=this.manager.stateApi.getSelectedEntityAdapter();s&&(((i=s.bufferRenderer.state)==null?void 0:i.type)==="rect"&&s.bufferRenderer.hasBuffer()?s.bufferRenderer.commitBuffer():s.bufferRenderer.clearBuffer())});k(this,"onStagePointerMove",async n=>{const s=this.parent.$cursorPos.get();if(!s||!this.parent.$isPrimaryPointerDown.get())return;const i=this.manager.stateApi.getSelectedEntityAdapter();if(!i)return;const o=i.bufferRenderer.state;if(!o||o.type!=="rect")return;const a=eo(s.relative,i.state.position),l=oJ(a);o.rect.width=Math.round(l.x-o.rect.x),o.rect.height=Math.round(l.y-o.rect.y),await i.bufferRenderer.setBuffer(o)});this.id=Te(this.type),this.parent=n,this.manager=this.parent.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module")}}class xCe extends zt{constructor(n){super();k(this,"type","view_tool");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"syncCursorStyle",()=>{this.manager.stage.setCursor(this.manager.stage.getIsDragging()?"grabbing":"grab")});this.id=Te(this.type),this.parent=n,this.manager=this.parent.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module")}}Be.dragButtons=[0];const vCe="Escape",cE=" ",uE="Alt",CCe={BRUSH_SPACING_TARGET_SCALE:.1};class wCe extends zt{constructor(n){super();k(this,"type","tool");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"subscriptions",new Set);k(this,"config",CCe);k(this,"tools");k(this,"$tool",Oe("brush"));k(this,"$toolBuffer",Oe(null));k(this,"$isPrimaryPointerDown",Oe(!1));k(this,"$cursorPos",Oe(null));k(this,"$lastPointerType",Oe(null));k(this,"konva");k(this,"initialize",()=>{this.log.debug("Initializing module"),this.render(),this.syncCursorStyle()});k(this,"syncCursorStyle",()=>{const n=this.manager.stage,s=this.$tool.get(),i=this.manager.stateApi.$segmentingAdapter.get(),o=this.manager.stateApi.$transformingAdapter.get(),a=this.manager.stateApi.getSelectedEntityAdapter();this.manager.stage.getIsDragging()?this.tools.view.syncCursorStyle():s==="view"?this.tools.view.syncCursorStyle():i?i.segmentAnything.syncCursorStyle():o?o.transformer.syncCursorStyle():this.manager.stateApi.$isFiltering.get()||this.manager.stagingArea.$isStaging.get()?n.setCursor("not-allowed"):s==="bbox"?this.tools.bbox.syncCursorStyle():s==="colorPicker"?this.tools.colorPicker.syncCursorStyle():a&&F2(a.entityIdentifier.type)?a.$isDisabled.get()||a.$isEntityTypeHidden.get()||a.$isLocked.get()?n.setCursor("not-allowed"):s==="brush"?this.tools.brush.syncCursorStyle():s==="eraser"?this.tools.eraser.syncCursorStyle():s==="move"?this.tools.move.syncCursorStyle():s==="rect"&&this.tools.rect.syncCursorStyle():(this.manager.stateApi.getRenderedEntityCount(),n.setCursor("not-allowed"))});k(this,"render",()=>{this.syncCursorStyle(),this.tools.brush.render(),this.tools.eraser.render(),this.tools.colorPicker.render(),this.tools.bbox.render()});k(this,"syncCursorPositions",()=>{const n=this.konva.stage.getRelativePointerPosition(),s=this.konva.stage.getPointerPosition();!n||!s||this.$cursorPos.set({relative:n,absolute:s})});k(this,"getClip",n=>{if(this.manager.stateApi.getSettings().clipToBbox){const{x:i,y:o,width:a,height:l}=this.manager.stateApi.getBbox().rect;return{x:i-n.position.x,y:o-n.position.y,width:a,height:l}}else{const{x:i,y:o}=this.manager.stage.getPosition(),a=this.manager.stage.getScale(),{width:l,height:c}=this.manager.stage.getSize();return{x:-i/a-n.position.x,y:-o/a-n.position.y,width:l/a,height:c/a}}});k(this,"setEventListeners",()=>(this.konva.stage.on("pointerenter",this.onStagePointerEnter),this.konva.stage.on("pointerdown",this.onStagePointerDown),this.konva.stage.on("pointerup",this.onStagePointerUp),this.konva.stage.on("pointermove",this.onStagePointerMove),this.manager.stage.container.addEventListener("pointerleave",this.onStagePointerLeave),this.konva.stage.on("wheel",this.onStageMouseWheel),window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),window.addEventListener("pointerup",this.onWindowPointerUp),window.addEventListener("blur",this.onWindowBlur),()=>{this.konva.stage.off("pointerenter",this.onStagePointerEnter),this.konva.stage.off("pointerdown",this.onStagePointerDown),this.konva.stage.off("pointerup",this.onStagePointerUp),this.konva.stage.off("pointermove",this.onStagePointerMove),this.manager.stage.container.removeEventListener("pointerleave",this.onStagePointerLeave),this.konva.stage.off("wheel",this.onStageMouseWheel),window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp),window.removeEventListener("pointerup",this.onWindowPointerUp),window.removeEventListener("blur",this.onWindowBlur)}));k(this,"getCanDraw",()=>{if(this.manager.stateApi.getRenderedEntityCount()===0||this.manager.$isBusy.get()||this.manager.stage.getIsDragging())return!1;const n=this.manager.stateApi.getSelectedEntityAdapter();return!(!n||n.$isDisabled.get()||n.$isEntityTypeHidden.get()||n.$isLocked.get())});k(this,"onStagePointerEnter",async n=>{var s;try{if(this.$lastPointerType.set(n.evt.pointerType),!this.getCanDraw())return;this.syncCursorPositions();const i=this.$tool.get(),o=this.manager.stateApi.getSelectedEntityAdapter();if(((s=o==null?void 0:o.bufferRenderer.state)==null?void 0:s.type)!=="rect"&&(o!=null&&o.bufferRenderer.hasBuffer())){o.bufferRenderer.commitBuffer();return}i==="brush"?await this.tools.brush.onStagePointerEnter(n):i==="eraser"&&await this.tools.eraser.onStagePointerEnter(n)}finally{this.render()}});k(this,"onStagePointerDown",async n=>{if(n.target===this.konva.stage)try{if(this.$lastPointerType.set(n.evt.pointerType),!this.getCanDraw())return;this.$isPrimaryPointerDown.set(aJ(n)),this.syncCursorPositions();const s=this.$tool.get();s==="brush"?await this.tools.brush.onStagePointerDown(n):s==="eraser"?await this.tools.eraser.onStagePointerDown(n):s==="rect"&&await this.tools.rect.onStagePointerDown(n)}finally{this.render()}});k(this,"onStagePointerUp",n=>{if(n.target===this.konva.stage)try{this.$lastPointerType.set(n.evt.pointerType);const s=this.$tool.get();if(s==="colorPicker"&&this.tools.colorPicker.onStagePointerUp(n),!this.getCanDraw())return;s==="brush"?this.tools.brush.onStagePointerUp(n):s==="eraser"?this.tools.eraser.onStagePointerUp(n):s==="rect"&&this.tools.rect.onStagePointerUp(n)}finally{this.render()}});k(this,"onStagePointerMove",async n=>{var s;if(n.target===this.konva.stage)try{this.$lastPointerType.set(n.evt.pointerType),this.syncCursorPositions();const i=this.$tool.get();if(i==="colorPicker"&&this.tools.colorPicker.onStagePointerMove(n),!this.getCanDraw())return;i==="brush"?await this.tools.brush.onStagePointerMove(n):i==="eraser"?await this.tools.eraser.onStagePointerMove(n):i==="rect"?await this.tools.rect.onStagePointerMove(n):(s=this.manager.stateApi.getSelectedEntityAdapter())==null||s.bufferRenderer.clearBuffer()}finally{this.render()}});k(this,"onStagePointerLeave",n=>{var s;if(n.target===this.manager.stage.container)try{if(this.$lastPointerType.set(n.pointerType),this.$cursorPos.set(null),!this.getCanDraw())return;const i=this.manager.stateApi.getSelectedEntityAdapter();i&&((s=i.bufferRenderer.state)==null?void 0:s.type)!=="rect"&&i.bufferRenderer.hasBuffer()&&i.bufferRenderer.commitBuffer()}finally{this.render()}});k(this,"onStageMouseWheel",n=>{if(n.target!==this.konva.stage||!this.getCanDraw()||(n.evt.preventDefault(),!n.evt.ctrlKey&&!n.evt.metaKey))return;const s=this.manager.stateApi.getSettings(),i=this.$tool.get();let o=n.evt.deltaY;s.invertScrollForToolWidth&&(o=-o),i==="brush"?this.manager.stateApi.setBrushWidth(gI(s.brushWidth,o)):i==="eraser"&&this.manager.stateApi.setEraserWidth(gI(s.eraserWidth,o)),this.render()});k(this,"onWindowPointerUp",n=>{try{this.$isPrimaryPointerDown.set(!1);const s=this.manager.stateApi.getSelectedEntityAdapter();s&&s.bufferRenderer.hasBuffer()&&!this.manager.$isBusy.get()&&s.bufferRenderer.commitBuffer()}finally{this.render()}});k(this,"onWindowBlur",()=>{this.revertToolBuffer()});k(this,"onKeyDown",n=>{var s;if(!(n.target instanceof HTMLInputElement||n.target instanceof HTMLTextAreaElement)&&(this.tools.move.isNudgeKey(n.key)&&this.tools.move.nudge(n.key),!n.repeat)){if(n.key===vCe){n.preventDefault();const i=this.manager.stateApi.getSelectedEntityAdapter();i&&!((s=i.filterer)!=null&&s.$isFiltering.get())&&!i.transformer.$isTransforming.get()&&i.bufferRenderer.hasBuffer()&&i.bufferRenderer.clearBuffer();return}if(n.key===cE){n.preventDefault(),this.$toolBuffer.set(this.$tool.get()),this.$tool.set("view"),this.manager.stateApi.$spaceKey.set(!0),this.$cursorPos.set(null);return}n.key===uE&&(n.preventDefault(),this.$toolBuffer.set(this.$tool.get()),this.$tool.set("colorPicker"))}});k(this,"onKeyUp",n=>{if(!n.repeat&&!(n.target instanceof HTMLInputElement||n.target instanceof HTMLTextAreaElement)){if(n.key===cE){n.preventDefault(),this.revertToolBuffer(),this.manager.stateApi.$spaceKey.set(!1);return}if(n.key===uE){n.preventDefault(),this.revertToolBuffer();return}}});k(this,"revertToolBuffer",()=>{const n=this.$toolBuffer.get();n&&(this.$tool.set(n),this.$toolBuffer.set(null))});k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,config:this.config,$tool:this.$tool.get(),$toolBuffer:this.$toolBuffer.get(),$isPrimaryPointerDown:this.$isPrimaryPointerDown.get(),$cursorPos:this.$cursorPos.get(),$lastPointerType:this.$lastPointerType.get(),tools:{brush:this.tools.brush.repr(),eraser:this.tools.eraser.repr(),colorPicker:this.tools.colorPicker.repr(),rect:this.tools.rect.repr(),bbox:this.tools.bbox.repr(),view:this.tools.view.repr(),move:this.tools.move.repr()}}));k(this,"destroy",()=>{this.log.debug("Destroying module"),this.subscriptions.forEach(n=>n()),this.subscriptions.clear(),this.konva.group.destroy()});this.id=Te(this.type),this.parent=n,this.manager=n,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating tool module"),this.tools={brush:new dCe(this),eraser:new gCe(this),rect:new bCe(this),colorPicker:new fCe(this),bbox:new cCe(this),view:new xCe(this),move:new yCe(this)},this.konva={stage:this.manager.stage.konva.stage,group:new Be.Group({name:`${this.type}:group`,listening:!0})},this.konva.group.add(this.tools.brush.konva.group),this.konva.group.add(this.tools.eraser.konva.group),this.konva.group.add(this.tools.colorPicker.konva.group),this.konva.group.add(this.tools.bbox.konva.group),this.subscriptions.add(this.manager.stage.$stageAttrs.listen(this.render)),this.subscriptions.add(this.manager.$isBusy.listen(this.render)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(el,this.render)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(tt,this.render)),this.subscriptions.add(this.$tool.listen(()=>{this.manager.tool.$isPrimaryPointerDown.set(!1),this.render()}));const s=this.setEventListeners();this.subscriptions.add(s)}}class SCe extends zt{constructor(n){super();k(this,"type","worker");k(this,"id");k(this,"path");k(this,"log");k(this,"parent");k(this,"manager");k(this,"worker",new Worker(new URL(""+new URL("worker-Dywf1EVc.js",import.meta.url).href,import.meta.url),{type:"module",name:"worker"}));k(this,"tasks",new Map);k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,tasks:Array.from(this.tasks.keys())}));k(this,"destroy",()=>{this.log.trace("Destroying worker module"),this.worker.terminate(),this.tasks.clear()});this.id=Te(this.type),this.parent=n,this.manager=n,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.worker.onmessage=s=>{const{type:i,data:o}=s.data;if(i==="log")o.ctx?this.log[o.level](o.ctx,o.message):this.log[o.level](o.message);else if(i==="extents"){const a=this.tasks.get(o.id);if(!a)return;a.onComplete(o.extents),this.tasks.delete(o.id)}},this.worker.onerror=s=>{this.log.error({message:s.message},"Worker error")},this.worker.onmessageerror=()=>{this.log.error("Worker message error")}}requestBbox(n,s){const i=Te("bbox_calculation"),o={type:"get_bbox",data:{...n,id:i}};this.tasks.set(i,{task:o,onComplete:s}),this.worker.postMessage(o,[n.buffer])}}const Md="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAFwWlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS41LjAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIgogICAgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIgogICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICAgeG1sbnM6ZXhpZj0iaHR0cDovL25zLmFkb2JlLmNvbS9leGlmLzEuMC8iCiAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIKICAgIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIgogICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgeG1wOkNyZWF0ZURhdGU9IjIwMjQtMDktMTNUMjA6NTM6MTMrMTAwMCIKICAgeG1wOk1vZGlmeURhdGU9IjIwMjQtMDktMTNUMjE6MTg6NDArMTA6MDAiCiAgIHhtcDpNZXRhZGF0YURhdGU9IjIwMjQtMDktMTNUMjE6MTg6NDArMTA6MDAiCiAgIHBob3Rvc2hvcDpEYXRlQ3JlYXRlZD0iMjAyNC0wOS0xM1QyMDo1MzoxMysxMDAwIgogICBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIgogICBwaG90b3Nob3A6SUNDUHJvZmlsZT0iR2VuZXJpYyBSR0IgUHJvZmlsZSIKICAgZXhpZjpQaXhlbFhEaW1lbnNpb249IjIwIgogICBleGlmOlBpeGVsWURpbWVuc2lvbj0iMjAiCiAgIGV4aWY6Q29sb3JTcGFjZT0iNjU1MzUiCiAgIHRpZmY6SW1hZ2VXaWR0aD0iMjAiCiAgIHRpZmY6SW1hZ2VMZW5ndGg9IjIwIgogICB0aWZmOlJlc29sdXRpb25Vbml0PSIyIgogICB0aWZmOlhSZXNvbHV0aW9uPSI5Ni8xIgogICB0aWZmOllSZXNvbHV0aW9uPSI5Ni8xIj4KICAgPGRjOnRpdGxlPgogICAgPHJkZjpBbHQ+CiAgICAgPHJkZjpsaSB4bWw6bGFuZz0ieC1kZWZhdWx0Ij50cmFuc3BhcmVudF9iZ19kYXJrPC9yZGY6bGk+CiAgICA8L3JkZjpBbHQ+CiAgIDwvZGM6dGl0bGU+CiAgIDx4bXBNTTpIaXN0b3J5PgogICAgPHJkZjpTZXE+CiAgICAgPHJkZjpsaQogICAgICBzdEV2dDphY3Rpb249InByb2R1Y2VkIgogICAgICBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZmZpbml0eSBQaG90byAyIDIuNS41IgogICAgICBzdEV2dDp3aGVuPSIyMDI0LTA5LTEzVDIxOjE4OjQwKzEwOjAwIi8+CiAgICA8L3JkZjpTZXE+CiAgIDwveG1wTU06SGlzdG9yeT4KICA8L3JkZjpEZXNjcmlwdGlvbj4KIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+Cjw/eHBhY2tldCBlbmQ9InIiPz5YzHPhAAAETGlDQ1BHZW5lcmljIFJHQiBQcm9maWxlAABIic1VXWgcVRQ+m7m7CSSOUmNTU0kHtTaENExSqRtqo/uXZNu4WTbZtA0Fncze3Zlm9seZ2dSWYiEI/rwYFXxVq4IPBZ8K8T8FMSJKCyVKMIiCYOsfhUpfNKznzp3dnaRZ9dE73JnvnvPdc+8958y5AC3PGWreapIA8gXbTI2EpaPHpqXmVWiCu6EVOqFVUa1SKJkcA2xKqWTALe3m1+Bj3yt7ma1b9f/YWjPUUgF8Ldj7MpaaB2gKAvhfUEumDdD8KXKCJ+0Sw38hbjdxgwAtdzCc4/h+hmc4DjqcyVQEMduzqGpKBvFxxL0zHnnOg/kenNY+QgvU1FWJ+SJpFrO6Qat7bYcRoFDAboIOKkiQQkkYv0mUFCGLUgMo/O/aMsz/1Jd9vufo8J1HfB754u37fWysWjTDxku7+Vg+ew7gCYB3BM5bevjsFJO3uJPzRrnqr13Y26zZicP47cYYPpNRogxjTHznVSU24eLLc/pUwsV/lOxwCvEDGOsd5dl0CHEP4qGsOZzmdpo0rTxaxQuntckjiLchXpwtHmZztyP+ojCTGHftfK9aEYw/3AsgBDQaZ3HtQtxtFlPjfF1hOEOjMcS9iE/odnyS2xdeteYmYlU7p7VIgq8lfHxCOZRE3In4MjVGUq79n0t20l2XtBWMxBi3Qwao5ZzXkdva5Chfl0zbmJB8Lnk6qw/HXf7rmjmacvHnJcP5x3Bv5LpZTqU5338PLaRdm/4hxYyNuDgDUz4Fc60IM/hWMSvXPflY8uRjPWcpjqqcvRs4SUfPcd1Kzpl51c32SNfbUEapBr+iVPPwIjgqoyzXwA7fwTXXTpF0EJnsw36AjJGDJEgGQSKPkEfJEImidJAcqM31/ldsP9dqdp7EFanDm0LeRdTboOD7B2QUwdraFwud5W4unzcf19VLL15fPvPhjjp3hSwev9K2fGbDf27BbAOvjf+b7/0/+q/6V/C96l+rM/zf+tfwWd10uo1er9aYEOoMR5bHrjsay7Of5IYo1nGxocVitrDQyXXMA/TZxM0EzPfW+fI38m/yivyG/Jb8i/CKcEH4SHhPeF/4EiRhSbgofCJ8JrwrfOCJUePcqcXcOUf1FEyzlUcxP8WwuFO8T4yKu8Td4ljdntgh9ouj4h7U7KxFx7ue9+w6HHPqMPfW1mtxnifOvtswznqDfyiNLB1OOkzLybMCnNrEcWeSLtJP4puyOshyvWb7P90igVggGgiBFOgJDAb6A4cYrjIDe1A3iG+sWjZ9ymaFOFIsnTL1nGZLA7L8kBTCq5pK8YLa1ysphiE5KksyqUXNOZrpA3bP8xJ+I+Xc377tl+oy+zGAg7+zuleXTZcBzuP93vFgXdaNtfGu1/Am2a+WzTn3TvD5vgKwsvsG+KgtjPXqu0rlBtat5pcB1l+qVP48V6msv4n21/B2Mf4GjzuDirebG+gAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAAsSURBVDiNYxSTkGXADdg5OPDIMuGRIwhGNY8MzSz409DPHz9oZfOo5pGhGQABmwOMaHIlKQAAAABJRU5ErkJggg==",jCe={GRID_LINE_COLOR_COARSE:mI(27),GRID_LINE_COLOR_FINE:mI(18),CHECKERBOARD_PATTERN_DATAURL:Md},fy=class fy extends zt{constructor(n){super();k(this,"type","background");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"subscriptions",new Set);k(this,"config",jCe);k(this,"checkboardPattern",new Image);k(this,"konva");k(this,"initialize",()=>{this.log.debug("Initializing module"),this.checkboardPattern.onload=()=>{this.konva.patternRect.fillPatternImage(this.checkboardPattern),this.render()},this.checkboardPattern.src=rd.get()?"use-credentials":"anonymous",this.checkboardPattern.src=this.config.CHECKERBOARD_PATTERN_DATAURL,this.render()});k(this,"render",()=>{if(!this.manager.stateApi.runSelector(F0)){this.konva.linesGroup.visible(!1);const w=this.manager.stage.unscale(1);this.konva.patternRect.setAttrs({visible:!0,...this.manager.stage.getScaledStageRect(),fillPatternScaleX:w,fillPatternScaleY:w});return}this.konva.linesGroup.visible(!0),this.konva.patternRect.visible(!1);const s=this.manager.stage.getScale(),{x:i,y:o}=this.manager.stage.getPosition(),{width:a,height:l}=this.manager.stage.getSize(),c=fy.getGridSpacing(s),d={x1:0,y1:0,x2:a,y2:l},h={x:Math.ceil(i/s/c)*c,y:Math.ceil(o/s/c)*c},f={x1:-h.x,y1:-h.y,x2:a/s-h.x+c,y2:l/s-h.y+c},p={x1:Math.min(d.x1,f.x1),y1:Math.min(d.y1,f.y1),x2:Math.max(d.x2,f.x2),y2:Math.max(d.y2,f.y2)},g=p.x2-p.x1,m=p.y2-p.y1,y=Math.round(g/c)+1,b=Math.round(m/c)+1,C=1/s;let x=0,v=0;this.konva.linesGroup.destroyChildren(),this.konva.lines=[];for(let w=0;w<y;w++){x=p.x1+w*c;const S=new Be.Line({x,y:p.y1,points:[0,0,0,m],stroke:x%64?this.config.GRID_LINE_COLOR_FINE:this.config.GRID_LINE_COLOR_COARSE,strokeWidth:C,listening:!1,perfectDrawEnabled:!1});this.konva.lines.push(S),this.konva.linesGroup.add(S)}for(let w=0;w<b;w++){v=p.y1+w*c;const S=new Be.Line({x:p.x1,y:v,points:[0,0,g,0],stroke:v%64?this.config.GRID_LINE_COLOR_FINE:this.config.GRID_LINE_COLOR_COARSE,strokeWidth:C,listening:!1,perfectDrawEnabled:!1});this.konva.lines.push(S),this.konva.linesGroup.add(S)}});k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,config:this.config}));k(this,"destroy",()=>{this.log.trace("Destroying module"),this.subscriptions.forEach(n=>n()),this.subscriptions.clear(),this.konva.layer.destroy()});this.id=Te(this.type),this.manager=n,this.parent=n,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.konva={layer:new Be.Layer({name:`${this.type}:layer`,listening:!1,imageSmoothingEnabled:!1}),linesGroup:new Be.Group({name:`${this.type}:linesGroup`}),lines:[],patternRect:new Be.Rect({name:`${this.type}:patternRect`,perfectDrawEnabled:!1})},this.konva.layer.add(this.konva.patternRect),this.konva.layer.add(this.konva.linesGroup),this.subscriptions.add(this.manager.stage.$stageAttrs.listen(this.render)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(F0,this.render))}};k(fy,"getGridSpacing",n=>n>=2?8:n>=1&&n<2?16:n>=.5&&n<1?32:n>=.25&&n<.5?64:n>=.125&&n<.25?128:256);let uw=fy;class m_ extends Error{constructor(n,s,i){super(s);k(this,"type");k(this,"traceback");this.name="QueueError",this.type=n,this.traceback=i,Error.captureStackTrace&&Error.captureStackTrace(this,m_)}toString(){return`${this.name} [${this.type}]: ${this.message}
Traceback:
${this.traceback}`}}class kCe extends zt{constructor(n,s){super();k(this,"type","state_api");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"store");k(this,"runSelector",n=>n(this.store.getState()));k(this,"createStoreSubscription",(n,s)=>lJ(this.store,n,s));k(this,"addStoreListener",n=>this.store.dispatch(cJ(n)));k(this,"getCanvasState",()=>this.runSelector(tt));k(this,"resetEntity",n=>{this.store.dispatch(TP(n))});k(this,"setEntityPosition",n=>{this.store.dispatch(uJ(n))});k(this,"moveEntityBy",n=>{this.store.dispatch(dJ(n))});k(this,"addBrushLine",n=>{this.store.dispatch(hJ(n))});k(this,"addEraserLine",n=>{this.store.dispatch(fJ(n))});k(this,"addRect",n=>{this.store.dispatch(pJ(n))});k(this,"addRasterLayer",n=>{this.store.dispatch(id(n))});k(this,"addControlLayer",n=>{this.store.dispatch(Dp(n))});k(this,"addInpaintMask",n=>{this.store.dispatch(Cy(n))});k(this,"addRegionalGuidance",n=>{this.store.dispatch(Va(n))});k(this,"rasterizeEntity",n=>{this.store.dispatch(dS(n))});k(this,"setGenerationBbox",n=>{this.store.dispatch(of(n))});k(this,"setBrushWidth",n=>{this.store.dispatch(AP(n))});k(this,"setEraserWidth",n=>{this.store.dispatch(EP(n))});k(this,"setColor",n=>this.store.dispatch(B2(n)));k(this,"runGraphAndReturnImageOutput",n=>{const{graph:s,outputNodeId:i,destination:o,prepend:a,timeout:l,signal:c}=n;if(!s.hasNode(i))throw new Error(`Graph does not contain node with id: ${i}`);const d=Te(s.id),h={prepend:a,batch:{graph:s.getGraph(),origin:d,destination:o,runs:1}};let f=!1,p=null;const g=()=>{p!==null&&(window.clearTimeout(p),p=null)};let m=()=>{this.log.warn("cancelGraph called before cancelGraph is set")};return new Promise((b,C)=>{const x=async j=>{if(j.origin!==d||j.invocation_source_id!==i)return;g(),S();const{result:P}=j;if(P.type!=="image_output"){C(new Error(`Graph output node did not return an image output, got: ${P}`));return}const E=await fs(()=>vJ(P.image.image_name));if(E.isErr()){C(E.error);return}f=!0,b(E.value)},v=j=>{if(j.origin===d&&!(j.status==="pending"||j.status==="in_progress")){if(j.status==="completed"){this.log.warn("Queue item completed without output node completion event");return}if(g(),S(),j.status==="failed"){const{error_type:P,error_message:E,error_traceback:D}=j;C(P&&E&&D?new m_(P,E,D):new Error("Queue item failed, but no error details were provided"))}else C(new Error("Graph canceled"))}};this.store.dispatch(Tl.endpoints.enqueueBatch.initiate(h,{...kp,track:!1})).unwrap().then(j=>{const P=j.batch.batch_id;we(P,"Enqueue result is missing batch_id"),m=()=>{this.store.dispatch(Tl.endpoints.cancelByBatchIds.initiate({batch_ids:[P]},{track:!1}))}}).catch(j=>{C(j)}),this.manager.socket.on("invocation_complete",x),this.manager.socket.on("queue_item_status_changed",v);const S=()=>{this.manager.socket.off("invocation_complete",x),this.manager.socket.off("queue_item_status_changed",v)};l&&(p=window.setTimeout(()=>{f||(this.log.trace("Graph canceled by timeout"),S(),m(),C(new Error("Graph timed out")))},l)),c&&c.addEventListener("abort",()=>{f||(this.log.trace("Graph canceled by signal"),g(),S(),m(),C(new Error("Graph canceled")))})})});k(this,"getBbox",()=>this.runSelector(iu));k(this,"getSettings",()=>this.runSelector(el));k(this,"getGridSize",()=>this.getSettings().snapToGrid?this.$ctrlKey.get()||this.$metaKey.get()?8:64:1);k(this,"getRegionsState",()=>this.getCanvasState().regionalGuidance);k(this,"getRasterLayersState",()=>this.getCanvasState().rasterLayers);k(this,"getControlLayersState",()=>this.getCanvasState().controlLayers);k(this,"getInpaintMasksState",()=>this.getCanvasState().inpaintMasks);k(this,"getStagingArea",()=>this.runSelector(N2));k(this,"getBboxGridSize",()=>this.runSelector(zp));k(this,"getIsSelected",n=>{var s;return((s=this.getCanvasState().selectedEntityIdentifier)==null?void 0:s.id)===n});k(this,"getRenderedEntityCount",()=>{const n=gJ(this.getCanvasState());let s=0;for(const i of n)i.isEnabled&&s++;return s});k(this,"getSelectedEntityAdapter",()=>{const n=this.getCanvasState();return!n.selectedEntityIdentifier||!mJ(n.selectedEntityIdentifier)?null:this.manager.getAdapter(n.selectedEntityIdentifier)});k(this,"getCurrentColor",()=>{let n=this.getSettings().color;const s=this.getSelectedEntityAdapter();return s&&(s.state.type==="regional_guidance"||s.state.type==="inpaint_mask")&&(n=IP),n});k(this,"getBrushPreviewColor",()=>{const n=this.getSelectedEntityAdapter();return(n==null?void 0:n.state.type)==="regional_guidance"||(n==null?void 0:n.state.type)==="inpaint_mask"?{...n.state.fill.color,a:.5}:this.getSettings().color});k(this,"$filteringAdapter",Oe(null));k(this,"$isFiltering",Wn(this.$filteringAdapter,n=>!!n));k(this,"$transformingAdapter",Oe(null));k(this,"$isTransforming",Wn(this.$transformingAdapter,n=>!!n));k(this,"$rasterizingAdapter",Oe(null));k(this,"$isRasterizing",Wn(this.$rasterizingAdapter,n=>!!n));k(this,"$segmentingAdapter",Oe(null));k(this,"$isSegmenting",Wn(this.$segmentingAdapter,n=>!!n));k(this,"$spaceKey",Oe(!1));k(this,"$altKey",yJ);k(this,"$ctrlKey",bJ);k(this,"$metaKey",xJ);k(this,"$shiftKey",IS);k(this,"repr",()=>{var n,s,i,o;return{id:this.id,type:this.type,path:this.path,$filteringAdapter:((n=this.$filteringAdapter.get())==null?void 0:n.entityIdentifier)??null,$isFiltering:this.$isFiltering.get(),$transformingAdapter:((s=this.$transformingAdapter.get())==null?void 0:s.entityIdentifier)??null,$isTransforming:this.$isTransforming.get(),$rasterizingAdapter:((i=this.$rasterizingAdapter.get())==null?void 0:i.entityIdentifier)??null,$isRasterizing:this.$isRasterizing.get(),$segmentingAdapter:((o=this.$segmentingAdapter.get())==null?void 0:o.entityIdentifier)??null,$isSegmenting:this.$isSegmenting.get()}});this.id=Te(this.type),this.parent=s,this.manager=s,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating state api module"),this.store=n}}class _Ce extends zt{constructor(n,s,i){super();k(this,"type","manager");k(this,"id");k(this,"path");k(this,"manager");k(this,"parent");k(this,"log");k(this,"store");k(this,"socket");k(this,"adapters",{rasterLayers:new gf,controlLayers:new gf,regionMasks:new gf,inpaintMasks:new gf});k(this,"stateApi");k(this,"background");k(this,"stage");k(this,"worker");k(this,"cache");k(this,"entityRenderer");k(this,"compositor");k(this,"tool");k(this,"stagingArea");k(this,"progressImage");k(this,"konva");k(this,"_isDebugging",!1);k(this,"$isBusy");k(this,"getAdapter",n=>{let s;switch(n.type){case"raster_layer":s=this.adapters.rasterLayers.get(n.id);break;case"control_layer":s=this.adapters.controlLayers.get(n.id);break;case"regional_guidance":s=this.adapters.regionMasks.get(n.id);break;case"inpaint_mask":s=this.adapters.inpaintMasks.get(n.id);break;default:return null}return s||null});k(this,"deleteAdapter",n=>{switch(n.type){case"raster_layer":return this.adapters.rasterLayers.delete(n.id);case"control_layer":return this.adapters.controlLayers.delete(n.id);case"regional_guidance":return this.adapters.regionMasks.delete(n.id);case"inpaint_mask":return this.adapters.inpaintMasks.delete(n.id);default:return!1}});k(this,"getAdapters",n=>{const s=[];for(const i of n){const o=this.getAdapter(i);o&&s.push(o)}return s});k(this,"getAllAdapters",()=>[...this.adapters.rasterLayers.values(),...this.adapters.controlLayers.values(),...this.adapters.regionMasks.values(),...this.adapters.inpaintMasks.values()]);k(this,"createAdapter",n=>{if(IM(n)){const s=new Q2e(n,this);return this.adapters.rasterLayers.set(s.id,s),s}else if(CJ(n)){const s=new Y2e(n,this);return this.adapters.controlLayers.set(s.id,s),s}else if(wJ(n)){const s=new J2e(n,this);return this.adapters.regionMasks.set(s.id,s),s}else if(SJ(n)){const s=new X2e(n,this);return this.adapters.inpaintMasks.set(s.id,s),s}else we(!1,"Unhandled entity type")});k(this,"getAllModules",()=>[this.stagingArea,this.tool,this.progressImage,this.stateApi,this.background,this.worker,this.entityRenderer,this.compositor,this.stage]);k(this,"initialize",()=>{var n;this.log.debug("Initializing");for(const s of this.getAllModules())(n=s.initialize)==null||n.call(s);$2.set(this)});k(this,"destroy",()=>{this.log.debug("Destroying module");for(const n of this.getAllAdapters())n.destroy();for(const n of this.getAllModules())n.destroy();$2.set(null)});k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,$isBusy:this.$isBusy.get(),rasterLayers:Array.from(this.adapters.rasterLayers.values()).map(n=>n.repr()),controlLayers:Array.from(this.adapters.controlLayers.values()).map(n=>n.repr()),inpaintMasks:Array.from(this.adapters.inpaintMasks.values()).map(n=>n.repr()),regionMasks:Array.from(this.adapters.regionMasks.values()).map(n=>n.repr()),stateApi:this.stateApi.repr(),stagingArea:this.stagingArea.repr(),tool:this.tool.repr(),progressImage:this.progressImage.repr(),background:this.background.repr(),worker:this.worker.repr(),entityRenderer:this.entityRenderer.repr(),compositor:this.compositor.repr(),stage:this.stage.repr()}));k(this,"getLoggingContext",()=>({path:this.path}));k(this,"buildPath",n=>n.parent.path.concat(n.id));k(this,"buildLogger",n=>this.log.child(s=>({...s,context:{...s.context,...n.getLoggingContext()}})));this.id=Te(this.type),this.path=[this.id],this.manager=this,this.parent=this,this.log=$n("canvas").child(o=>({...o,context:{...this.getLoggingContext(),...o.context}})),this.log.debug("Creating canvas manager module"),this.store=s,this.socket=i,this.stateApi=new kCe(this.store,this),this.stage=new rCe(n,this),this.worker=new SCe(this),this.cache=new w1(this),this.entityRenderer=new eCe(this),this.compositor=new M2e(this),this.stagingArea=new iCe(this),this.$isBusy=Wn([this.stateApi.$isFiltering,this.stateApi.$isTransforming,this.stateApi.$isRasterizing,this.stateApi.$isSegmenting,this.stagingArea.$isStaging,this.compositor.$isBusy],(o,a,l,c,d,h)=>o||a||l||c||d||h),this.background=new uw(this),this.stage.addLayer(this.background.konva.layer),this.konva={previewLayer:new Be.Layer({listening:!0,imageSmoothingEnabled:!1})},this.stage.addLayer(this.konva.previewLayer),this.tool=new wCe(this),this.progressImage=new nCe(this),this.konva.previewLayer.add(this.stagingArea.konva.group),this.konva.previewLayer.add(this.progressImage.konva.group),this.konva.previewLayer.add(this.tool.konva.group)}enableDebugging(){this._isDebugging=!0,this.logDebugInfo()}disableDebugging(){this._isDebugging=!1}logDebugInfo(){console.log("Canvas manager",{managerInstance:this,managerInfo:this.repr()})}}function ICe(e){const t=dE(e),[n,s]=u.useState(t),{defaultDpr:i,maxDpr:o,round:a}=e||{};return u.useEffect(()=>{if(!(typeof window<"u"&&"matchMedia"in window))return;const c=()=>s(dE({defaultDpr:i,maxDpr:o,round:a})),d=window.matchMedia(`screen and (resolution: ${n}dppx)`);return d.addEventListener?d.addEventListener("change",c):d.addListener(c),()=>{d.removeEventListener?d.removeEventListener("change",c):d.removeListener(c)}},[n,i,o,a]),n}function dE(e){const{defaultDpr:t=1,maxDpr:n=3,round:s=!0}=e||{},o=typeof window<"u"&&typeof window.devicePixelRatio=="number"?window.devicePixelRatio:t;return Math.min(Math.max(1,s?Math.floor(o):o),n)}const Dv=$n("canvas");Be.showWarnings=!1;const TCe=()=>{At("useKonvaPixelRatioWatcher");const e=ICe({round:!1});u.useLayoutEffect(()=>{Be.pixelRatio=e},[e])},ACe=()=>{At("useInvokeCanvas"),TCe();const e=dn(),t=ae(jM),[n,s]=u.useState(null);return u.useLayoutEffect(()=>{if(Dv.debug("Initializing renderer"),!n)return Dv.debug("No stage container, skipping initialization"),()=>{};if(!t)return Dv.debug("Socket not connected, skipping initialization"),()=>{};const i=$2.get();if(i){i.stage.setContainer(n);return}new _Ce(n,e,t).initialize()},[n,t,e]),s},t$=u.memo(()=>{const e=ACe();return r.jsx(Se,{position:"absolute",top:0,right:0,bottom:0,left:0,ref:e,borderRadius:"base",overflow:"hidden","data-testid":"control-layers-canvas"})});t$.displayName="InvokeCanvasComponent";const n$=u.memo(({adapter:e})=>{const{t}=A(),n=ae(e.segmentAnything.$invert),s=u.useCallback(()=>{e.segmentAnything.$invert.set(!e.segmentAnything.$invert.get())},[e.segmentAnything.$invert]);return r.jsxs(K,{w:"min-content",children:[r.jsx(J,{m:0,children:t("controlLayers.selectObject.invertSelection")}),r.jsx(et,{size:"sm",isChecked:n,onChange:s})]})});n$.displayName="SelectObjectInvert";const s$=u.memo(({adapter:e})=>{const{t}=A(),n=ae(e.segmentAnything.$pointTypeString),s=u.useCallback(i=>{const o=jJ.parse(i),a=kJ[o];e.segmentAnything.$pointType.set(a)},[e.segmentAnything.$pointType]);return r.jsxs(K,{w:"min-content",children:[r.jsx(J,{m:0,children:t("controlLayers.selectObject.pointType")}),r.jsx(_J,{value:n,onChange:s,w:"full",size:"md",children:r.jsxs(T,{alignItems:"center",w:"full",gap:4,fontWeight:"semibold",color:"base.300",children:[r.jsx(yI,{value:"foreground",children:r.jsx(q,{children:t("controlLayers.selectObject.include")})}),r.jsx(yI,{value:"background",children:r.jsx(q,{children:t("controlLayers.selectObject.exclude")})})]})})]})});s$.displayName="SelectObject";const r$=u.memo(({adapter:e})=>{const{t}=A(),n=u.useRef(null);sg("canvas",n,{focusOnMount:!0});const s=Ms("canvas"),i=ae(e.segmentAnything.$isProcessing),o=ae(e.segmentAnything.$hasPoints),a=ae(e.segmentAnything.$hasImageState),l=I(Vp),c=u.useCallback(()=>{e.segmentAnything.saveAs("inpaint_mask")},[e.segmentAnything]),d=u.useCallback(()=>{e.segmentAnything.saveAs("regional_guidance")},[e.segmentAnything]),h=u.useCallback(()=>{e.segmentAnything.saveAs("raster_layer")},[e.segmentAnything]),f=u.useCallback(()=>{e.segmentAnything.saveAs("control_layer")},[e.segmentAnything]);return Re({id:"applySegmentAnything",category:"canvas",callback:e.segmentAnything.apply,options:{enabled:!i&&s},dependencies:[e.segmentAnything,i,s]}),Re({id:"cancelSegmentAnything",category:"canvas",callback:e.segmentAnything.cancel,options:{enabled:!i&&s},dependencies:[e.segmentAnything,i,s]}),r.jsxs(T,{ref:n,bg:"base.800",borderRadius:"base",p:4,flexDir:"column",gap:4,minW:420,h:"auto",shadow:"dark-lg",transitionProperty:"height",transitionDuration:"normal",children:[r.jsxs(T,{w:"full",gap:4,alignItems:"center",children:[r.jsxs(T,{gap:2,children:[r.jsx(Ft,{size:"md",color:"base.300",userSelect:"none",children:t("controlLayers.selectObject.selectObject")}),r.jsx(Ee,{label:r.jsx(o$,{}),children:r.jsx(T,{alignItems:"center",children:r.jsx(lt,{as:bd,color:"base.500"})})})]}),r.jsx(it,{}),r.jsx(f_,{}),r.jsx(Db,{})]}),r.jsxs(T,{w:"full",justifyContent:"space-between",py:2,children:[r.jsx(s$,{adapter:e}),r.jsx(n$,{adapter:e})]}),r.jsxs(Zn,{isAttached:!1,size:"sm",w:"full",children:[r.jsxs(de,{onClick:e.segmentAnything.processImmediate,loadingText:t("controlLayers.selectObject.process"),variant:"ghost",isDisabled:i||!o||l&&a,children:[t("controlLayers.selectObject.process"),i&&r.jsx(Lr,{ms:3,boxSize:5,color:"base.600"})]}),r.jsx(it,{}),r.jsx(de,{onClick:e.segmentAnything.reset,isDisabled:i||!o,loadingText:t("controlLayers.selectObject.reset"),variant:"ghost",children:t("controlLayers.selectObject.reset")}),r.jsx(de,{onClick:e.segmentAnything.apply,loadingText:t("controlLayers.selectObject.apply"),variant:"ghost",isDisabled:i||!a,children:t("controlLayers.selectObject.apply")}),r.jsxs(en,{children:[r.jsx(tn,{as:de,loadingText:t("controlLayers.selectObject.saveAs"),variant:"ghost",isDisabled:i||!a,rightIcon:r.jsx(Di,{}),children:t("controlLayers.selectObject.saveAs")}),r.jsxs(Tt,{children:[r.jsx(pe,{isDisabled:i||!a,onClick:c,children:t("controlLayers.newInpaintMask")}),r.jsx(pe,{isDisabled:i||!a,onClick:d,children:t("controlLayers.newRegionalGuidance")}),r.jsx(pe,{isDisabled:i||!a,onClick:f,children:t("controlLayers.newControlLayer")}),r.jsx(pe,{isDisabled:i||!a,onClick:h,children:t("controlLayers.newRasterLayer")})]})]}),r.jsx(de,{onClick:e.segmentAnything.cancel,isDisabled:i,loadingText:t("common.cancel"),variant:"ghost",children:t("controlLayers.selectObject.cancel")})]})]})});r$.displayName="SegmentAnythingContent";const i$=u.memo(()=>{const e=Lt(),t=ae(e.stateApi.$segmentingAdapter);return t?r.jsx(r$,{adapter:t}):null});i$.displayName="SelectObject";const hE=e=>r.jsx(q,{as:"span",fontWeight:"semibold",children:e.children}),o$=u.memo(()=>{const{t:e}=A();return r.jsxs(T,{gap:3,flexDir:"column",children:[r.jsx(q,{children:r.jsx(Ut,{i18nKey:"controlLayers.selectObject.help1",components:{Bold:r.jsx(hE,{})}})}),r.jsx(q,{children:r.jsx(Ut,{i18nKey:"controlLayers.selectObject.help2",components:{Bold:r.jsx(hE,{})}})}),r.jsx(q,{children:r.jsx(Ut,{i18nKey:"controlLayers.selectObject.help3"})}),r.jsxs(or,{children:[r.jsx(Rt,{children:e("controlLayers.selectObject.clickToAdd")}),r.jsx(Rt,{children:e("controlLayers.selectObject.dragToMove")}),r.jsx(Rt,{children:e("controlLayers.selectObject.clickToRemove")})]})]})});o$.displayName="SelectObjectHelpTooltipContent";const ECe={destination:"canvas"},MCe=()=>{IJ(ECe)},a$=u.memo(e=>(MCe(),I(Fn)?e.children:null));a$.displayName="StagingAreaIsStagingGate";const l$=u.memo(()=>{const e=G(),t=Lt(),n=I(Rp),s=I(Py),i=I(Tn),o=I(Gp),a=ae(t.stagingArea.$shouldShowStagedImage),l=Ms("canvas"),{t:c}=A(),d=u.useCallback(()=>{if(!s)return;const{x:h,y:f}=n,{imageDTO:p,offsetX:g,offsetY:m}=s,y=Mi(p),b={position:{x:h+g,y:f+m},objects:[y]};e(id({overrides:b,isSelected:(i==null?void 0:i.type)==="raster_layer"})),e(TS())},[n,e,i==null?void 0:i.type,s]);return Ii(["enter"],d,{preventDefault:!0,enabled:l&&a&&o>1},[l,a,o]),r.jsx(oe,{tooltip:`${c("common.accept")} (Enter)`,"aria-label":`${c("common.accept")} (Enter)`,icon:r.jsx(og,{}),onClick:d,colorScheme:"invokeBlue",isDisabled:!s})});l$.displayName="StagingAreaToolbarAcceptButton";const c$=u.memo(()=>{const e=G(),{t}=A(),n=u.useCallback(()=>{e(TS())},[e]);return r.jsx(oe,{tooltip:`${t("controlLayers.stagingArea.discardAll")} (Esc)`,"aria-label":t("controlLayers.stagingArea.discardAll"),icon:r.jsx(ri,{}),onClick:n,colorScheme:"error",fontSize:16})});c$.displayName="StagingAreaToolbarDiscardAllButton";const u$=u.memo(()=>{const e=G(),t=I(MP),n=I(Py),s=I(Gp),{t:i}=A(),o=u.useCallback(()=>{n&&e(s===1?TS():TJ({index:t}))},[n,s,e,t]);return r.jsx(oe,{tooltip:i("controlLayers.stagingArea.discard"),"aria-label":i("controlLayers.stagingArea.discard"),icon:r.jsx(Ot,{}),onClick:o,colorScheme:"invokeBlue",fontSize:16,isDisabled:!n})});u$.displayName="StagingAreaToolbarDiscardSelectedButton";const d$=u.memo(()=>{const e=I(MP),t=I(Gp),n=u.useMemo(()=>t>0?`${(e??0)+1} of ${t}`:"0 of 0",[t,e]);return r.jsx(de,{colorScheme:"base",pointerEvents:"none",minW:28,children:n})});d$.displayName="StagingAreaToolbarImageCountButton";const h$=u.memo(()=>{const e=G(),t=Lt(),n=I(Gp),s=ae(t.stagingArea.$shouldShowStagedImage),i=Ms("canvas"),{t:o}=A(),a=u.useCallback(()=>{e(AJ())},[e]);return Ii(["right"],a,{preventDefault:!0,enabled:i&&s&&n>1},[i,s,n]),r.jsx(oe,{tooltip:`${o("controlLayers.stagingArea.next")} (Right)`,"aria-label":`${o("controlLayers.stagingArea.next")} (Right)`,icon:r.jsx(Sde,{}),onClick:a,colorScheme:"invokeBlue",isDisabled:n<=1||!s})});h$.displayName="StagingAreaToolbarNextButton";const f$=u.memo(()=>{const e=G(),t=Lt(),n=I(Gp),s=ae(t.stagingArea.$shouldShowStagedImage),i=Ms("canvas"),{t:o}=A(),a=u.useCallback(()=>{e(EJ())},[e]);return Ii(["left"],a,{preventDefault:!0,enabled:i&&s&&n>1},[i,s,n]),r.jsx(oe,{tooltip:`${o("controlLayers.stagingArea.previous")} (Left)`,"aria-label":`${o("controlLayers.stagingArea.previous")} (Left)`,icon:r.jsx(xde,{}),onClick:a,colorScheme:"invokeBlue",isDisabled:n<=1||!s})});f$.displayName="StagingAreaToolbarPrevButton";const $m={image_category:"general",is_intermediate:!0,silent:!0},p$=u.memo(()=>{const{t:e}=A(),t=I(Py),n=dn(),s=u.useCallback(async()=>{if(!t)return;const{dispatch:l,getState:c}=n,d=await lf(t.imageDTO),h=await Aa({file:d,...$m});Yr({imageDTO:h,type:"raster_layer",dispatch:l,getState:c,overrides:{isEnabled:!1}}),ge({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[t,n,e]),i=u.useCallback(async()=>{if(!t)return;const{dispatch:l,getState:c}=n,d=await lf(t.imageDTO),h=await Aa({file:d,...$m});Yr({imageDTO:h,type:"control_layer",dispatch:l,getState:c,overrides:{isEnabled:!1}}),ge({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[t,n,e]),o=u.useCallback(async()=>{if(!t)return;const{dispatch:l,getState:c}=n,d=await lf(t.imageDTO),h=await Aa({file:d,...$m});Yr({imageDTO:h,type:"inpaint_mask",dispatch:l,getState:c,overrides:{isEnabled:!1}}),ge({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[t,n,e]),a=u.useCallback(async()=>{if(!t)return;const{dispatch:l,getState:c}=n,d=await lf(t.imageDTO),h=await Aa({file:d,...$m});Yr({imageDTO:h,type:"regional_guidance",dispatch:l,getState:c,overrides:{isEnabled:!1}}),ge({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[t,n,e]);return r.jsxs(en,{children:[r.jsx(tn,{as:oe,"aria-label":e("controlLayers.newLayerFromImage"),tooltip:e("controlLayers.newLayerFromImage"),icon:r.jsx(GR,{}),colorScheme:"invokeBlue",isDisabled:!t}),r.jsxs(Tt,{children:[r.jsx(pe,{icon:r.jsx(js,{}),onClickCapture:o,isDisabled:!t,children:e("controlLayers.inpaintMask")}),r.jsx(pe,{icon:r.jsx(js,{}),onClickCapture:a,isDisabled:!t,children:e("controlLayers.regionalGuidance")}),r.jsx(pe,{icon:r.jsx(js,{}),onClickCapture:i,isDisabled:!t,children:e("controlLayers.controlLayer")}),r.jsx(pe,{icon:r.jsx(js,{}),onClickCapture:s,isDisabled:!t,children:e("controlLayers.rasterLayer")})]})]})});p$.displayName="StagingAreaToolbarSaveAsMenu";const fE="SAVE_STAGING_AREA_IMAGE_TO_GALLERY",g$=u.memo(()=>{const e=I(Hs),t=I(Py),{t:n}=A(),s=u.useCallback(async()=>{if(!t)return;(await fs(async()=>{const o=await lf(t.imageDTO);await Aa({file:o,image_category:"general",is_intermediate:!1,board_id:e==="none"?void 0:e,silent:!0})})).isOk()?ge({id:fE,title:n("controlLayers.savedToGalleryOk"),status:"success"}):ge({id:fE,title:n("controlLayers.savedToGalleryError"),status:"error"})},[e,t,n]);return r.jsx(oe,{tooltip:n("controlLayers.stagingArea.saveToGallery"),"aria-label":n("controlLayers.stagingArea.saveToGallery"),icon:r.jsx(so,{}),onClick:s,colorScheme:"invokeBlue",isDisabled:!t})});g$.displayName="StagingAreaToolbarSaveSelectedToGalleryButton";const m$=u.memo(()=>{const e=Lt(),t=ae(e.stagingArea.$shouldShowStagedImage),{t:n}=A(),s=u.useCallback(()=>{e.stagingArea.$shouldShowStagedImage.set(!t)},[e.stagingArea.$shouldShowStagedImage,t]);return r.jsx(oe,{tooltip:n(t?"controlLayers.stagingArea.showResultsOn":"controlLayers.stagingArea.showResultsOff"),"aria-label":n(t?"controlLayers.stagingArea.showResultsOn":"controlLayers.stagingArea.showResultsOff"),"data-alert":!t,icon:t?r.jsx(yd,{}):r.jsx(Bde,{}),onClick:s,colorScheme:"invokeBlue"})});m$.displayName="StagingAreaToolbarToggleShowResultsButton";const y$=u.memo(()=>r.jsxs(r.Fragment,{children:[r.jsxs(Zn,{borderRadius:"base",shadow:"dark-lg",children:[r.jsx(f$,{}),r.jsx(d$,{}),r.jsx(h$,{})]}),r.jsxs(Zn,{borderRadius:"base",shadow:"dark-lg",children:[r.jsx(l$,{}),r.jsx(m$,{}),r.jsx(g$,{}),r.jsx(p$,{}),r.jsx(u$,{}),r.jsx(c$,{})]})]}));y$.displayName="StagingAreaToolbar";const b$=u.memo(()=>{const{t:e}=A(),t=G(),n=I(CP),s=u.useCallback(()=>{t(MJ())},[t]);return r.jsxs(K,{children:[r.jsx(J,{m:0,flexGrow:1,children:e("controlLayers.bboxOverlay")}),r.jsx(et,{size:"sm",isChecked:n,onChange:s})]})});b$.displayName="CanvasSettingsBboxOverlaySwitch";const x$=u.memo(()=>{const{t:e}=A(),t=Lt(),n=u.useCallback(()=>{t.cache.clearAll()},[t]);return r.jsx(de,{onClick:n,size:"sm",colorScheme:"warning",children:e("controlLayers.clearCaches")})});x$.displayName="CanvasSettingsClearCachesButton";const v$=u.memo(()=>{const{t:e}=A(),t=G(),n=u.useCallback(()=>{t(PJ())},[t]);return r.jsx(de,{onClick:n,size:"sm",children:e("controlLayers.clearHistory")})});v$.displayName="CanvasSettingsClearHistoryButton";const PCe=fe(el,e=>e.clipToBbox),C$=u.memo(()=>{const{t:e}=A(),t=G(),n=I(PCe),s=u.useCallback(i=>t(LJ(i.target.checked)),[t]);return r.jsxs(K,{w:"full",children:[r.jsx(J,{flexGrow:1,children:e("controlLayers.clipToBbox")}),r.jsx(Sn,{isChecked:n,onChange:s})]})});C$.displayName="CanvasSettingsClipToBboxCheckbox";const w$=u.memo(()=>{const{t:e}=A(),t=G(),n=I(F0),s=u.useCallback(()=>{t(DJ())},[t]);return r.jsxs(K,{children:[r.jsx(J,{m:0,flexGrow:1,children:e("controlLayers.dynamicGrid")}),r.jsx(et,{size:"sm",isChecked:n,onChange:s})]})});w$.displayName="CanvasSettingsDynamicGridSwitch";const S$=u.memo(()=>{const{t:e}=A(),t=G(),n=I(RJ),s=u.useCallback(()=>{t(OJ())},[t]);return r.jsxs(K,{w:"full",children:[r.jsx(J,{flexGrow:1,children:e("controlLayers.settings.snapToGrid.label")}),r.jsx(Sn,{isChecked:n,onChange:s})]})});S$.displayName="CanvasSettingsSnapToGrid";const LCe=fe(el,e=>e.invertScrollForToolWidth),j$=u.memo(()=>{const{t:e}=A(),t=G(),n=I(LCe),s=u.useCallback(i=>{t(NJ(i.target.checked))},[t]);return r.jsxs(K,{w:"full",children:[r.jsx(J,{flexGrow:1,children:e("controlLayers.settings.invertBrushSizeScrollDirection")}),r.jsx(Sn,{isChecked:n,onChange:s})]})});j$.displayName="CanvasSettingsInvertScrollCheckbox";const k$=u.memo(()=>{const{t:e}=A(),t=G(),n=I(O0),s=u.useCallback(()=>{t(dP())},[t]);return r.jsxs(K,{children:[r.jsx(J,{m:0,flexGrow:1,children:e("controlLayers.settings.isolatedLayerPreview")}),r.jsx(et,{size:"sm",isChecked:n,onChange:s})]})});k$.displayName="CanvasSettingsIsolatedLayerPreviewSwitch";const _$=u.memo(()=>{const{t:e}=A(),t=G(),n=I(E2),s=u.useCallback(()=>{t(FJ())},[t]);return r.jsxs(K,{children:[r.jsx(J,{m:0,flexGrow:1,children:e("controlLayers.settings.isolatedStagingPreview")}),r.jsx(et,{size:"sm",isChecked:n,onChange:s})]})});_$.displayName="CanvasSettingsIsolatedStagingPreviewSwitch";const I$=u.memo(()=>{const{t:e}=A(),t=Lt(),n=u.useCallback(()=>{t.logDebugInfo()},[t]);return r.jsx(de,{onClick:n,size:"sm",children:e("controlLayers.logDebugInfo")})});I$.displayName="CanvasSettingsLogDebugInfoButton";const T$=u.memo(()=>{const{t:e}=A(),t=G(),n=I(BJ),s=u.useCallback(()=>{t($J())},[t]);return r.jsxs(K,{w:"full",children:[r.jsx(J,{flexGrow:1,children:e("controlLayers.outputOnlyMaskedRegions")}),r.jsx(Sn,{isChecked:n,onChange:s})]})});T$.displayName="CanvasSettingsOutputOnlyMaskedRegionsCheckbox";const A$=u.memo(()=>{const{t:e}=A(),t=G(),n=I(QM),s=u.useCallback(()=>t(VJ()),[t]);return r.jsxs(K,{w:"full",children:[r.jsx(J,{flexGrow:1,children:e("controlLayers.settings.preserveMask.label")}),r.jsx(Sn,{isChecked:n,onChange:s})]})});A$.displayName="CanvasSettingsPreserveMaskCheckbox";const E$=u.memo(()=>{const{t:e}=A(),t=G(),n=I(zJ),s=u.useCallback(()=>{t(GJ())},[t]);return r.jsxs(K,{w:"full",children:[r.jsx(J,{flexGrow:1,children:e("controlLayers.settings.pressureSensitivity")}),r.jsx(Sn,{isChecked:n,onChange:s})]})});E$.displayName="CanvasSettingsPressureSensitivityCheckbox";const M$=u.memo(()=>{const{t:e}=A(),t=Lt(),n=u.useCallback(()=>{for(const s of t.getAllAdapters())s.transformer.requestRectCalculation()},[t]);return r.jsx(de,{onClick:n,size:"sm",colorScheme:"warning",children:e("controlLayers.recalculateRects")})});M$.displayName="CanvasSettingsRecalculateRectsButton";const DCe=fe(el,e=>e.showHUD),P$=u.memo(()=>{const{t:e}=A(),t=G(),n=I(DCe),s=u.useCallback(()=>{t(HJ())},[t]);return r.jsxs(K,{children:[r.jsx(J,{m:0,flexGrow:1,children:e("controlLayers.showHUD")}),r.jsx(et,{size:"sm",isChecked:n,onChange:s})]})});P$.displayName="CanvasSettingsShowHUDSwitch";const L$=u.memo(()=>{const{t:e}=A(),t=G(),n=I(O2),s=u.useCallback(()=>{t(WJ())},[t]);return r.jsxs(K,{children:[r.jsx(J,{m:0,flexGrow:1,children:e("controlLayers.showProgressOnCanvas")}),r.jsx(et,{size:"sm",isChecked:n,onChange:s})]})});L$.displayName="CanvasSettingsShowProgressOnCanvas";const D$=u.memo(()=>{const{t:e}=A();return r.jsxs(rs,{isLazy:!0,children:[r.jsx(gs,{children:r.jsx(oe,{"aria-label":e("common.settingsLabel"),icon:r.jsx(xd,{}),variant:"link",alignSelf:"stretch"})}),r.jsxs(is,{children:[r.jsx(Li,{}),r.jsx(ms,{children:r.jsxs(T,{direction:"column",gap:2,children:[r.jsx(j$,{}),r.jsx(A$,{}),r.jsx(C$,{}),r.jsx(T$,{}),r.jsx(S$,{}),r.jsx(E$,{}),r.jsx(L$,{}),r.jsx(_$,{}),r.jsx(k$,{}),r.jsx(w$,{}),r.jsx(b$,{}),r.jsx(P$,{}),r.jsx(RCe,{})]})})]})]})});D$.displayName="CanvasSettingsPopover";const RCe=()=>tl()?r.jsxs(r.Fragment,{children:[r.jsx(wt,{}),r.jsx(x$,{}),r.jsx(M$,{}),r.jsx(I$,{}),r.jsx(v$,{})]}):null,R$=[{r:0,g:0,b:0,a:1},{r:255,g:255,b:255,a:1},{r:255,g:90,b:94,a:1},{r:255,g:146,b:75,a:1},{r:255,g:202,b:59,a:1},{r:197,g:202,b:48,a:1},{r:138,g:201,b:38,a:1},{r:83,g:165,b:117,a:1},{r:23,g:130,b:196,a:1},{r:66,g:103,b:172,a:1},{r:107,g:76,b:147,a:1}],OCe=R$,NCe=R$.map(({r:e,g:t,b:n})=>({r:e,g:t,b:n}));function cl(){return(cl=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e}).apply(this,arguments)}function Tg(e,t){if(e==null)return{};var n,s,i={},o=Object.keys(e);for(s=0;s<o.length;s++)t.indexOf(n=o[s])>=0||(i[n]=e[n]);return i}function hp(e){var t=u.useRef(e),n=u.useRef(function(s){t.current&&t.current(s)});return t.current=e,n.current}var qu=function(e,t,n){return t===void 0&&(t=0),n===void 0&&(n=1),e>n?n:e<t?t:e},Pf=function(e){return"touches"in e},dw=function(e){return e&&e.ownerDocument.defaultView||self},pE=function(e,t,n){var s=e.getBoundingClientRect(),i=Pf(t)?function(o,a){for(var l=0;l<o.length;l++)if(o[l].identifier===a)return o[l];return o[0]}(t.touches,n):t;return{left:qu((i.pageX-(s.left+dw(e).pageXOffset))/s.width),top:qu((i.pageY-(s.top+dw(e).pageYOffset))/s.height)}},gE=function(e){!Pf(e)&&e.preventDefault()},y_=be.memo(function(e){var t=e.onMove,n=e.onKey,s=Tg(e,["onMove","onKey"]),i=u.useRef(null),o=hp(t),a=hp(n),l=u.useRef(null),c=u.useRef(!1),d=u.useMemo(function(){var g=function(b){gE(b),(Pf(b)?b.touches.length>0:b.buttons>0)&&i.current?o(pE(i.current,b,l.current)):y(!1)},m=function(){return y(!1)};function y(b){var C=c.current,x=dw(i.current),v=b?x.addEventListener:x.removeEventListener;v(C?"touchmove":"mousemove",g),v(C?"touchend":"mouseup",m)}return[function(b){var C=b.nativeEvent,x=i.current;if(x&&(gE(C),!function(w,S){return S&&!Pf(w)}(C,c.current)&&x)){if(Pf(C)){c.current=!0;var v=C.changedTouches||[];v.length&&(l.current=v[0].identifier)}x.focus(),o(pE(x,C,l.current)),y(!0)}},function(b){var C=b.which||b.keyCode;C<37||C>40||(b.preventDefault(),a({left:C===39?.05:C===37?-.05:0,top:C===40?.05:C===38?-.05:0}))},y]},[a,o]),h=d[0],f=d[1],p=d[2];return u.useEffect(function(){return p},[p]),be.createElement("div",cl({},s,{onTouchStart:h,onMouseDown:h,className:"react-colorful__interactive",ref:i,onKeyDown:f,tabIndex:0,role:"slider"}))}),Ag=function(e){return e.filter(Boolean).join(" ")},b_=function(e){var t=e.color,n=e.left,s=e.top,i=s===void 0?.5:s,o=Ag(["react-colorful__pointer",e.className]);return be.createElement("div",{className:o,style:{top:100*i+"%",left:100*n+"%"}},be.createElement("div",{className:"react-colorful__pointer-fill",style:{backgroundColor:t}}))},Gs=function(e,t,n){return t===void 0&&(t=0),n===void 0&&(n=Math.pow(10,t)),Math.round(n*e)/n},O$=function(e){var t=e.s,n=e.v,s=e.a,i=(200-t)*n/100;return{h:Gs(e.h),s:Gs(i>0&&i<200?t*n/100/(i<=100?i:200-i)*100:0),l:Gs(i/2),a:Gs(s,2)}},hw=function(e){var t=O$(e);return"hsl("+t.h+", "+t.s+"%, "+t.l+"%)"},Rv=function(e){var t=O$(e);return"hsla("+t.h+", "+t.s+"%, "+t.l+"%, "+t.a+")"},N$=function(e){var t=e.h,n=e.s,s=e.v,i=e.a;t=t/360*6,n/=100,s/=100;var o=Math.floor(t),a=s*(1-n),l=s*(1-(t-o)*n),c=s*(1-(1-t+o)*n),d=o%6;return{r:Gs(255*[s,l,a,a,c,s][d]),g:Gs(255*[c,s,s,l,a,a][d]),b:Gs(255*[a,a,c,s,s,l][d]),a:Gs(i,2)}},F$=function(e){var t=e.r,n=e.g,s=e.b,i=e.a,o=Math.max(t,n,s),a=o-Math.min(t,n,s),l=a?o===t?(n-s)/a:o===n?2+(s-t)/a:4+(t-n)/a:0;return{h:Gs(60*(l<0?l+6:l)),s:Gs(o?a/o*100:0),v:Gs(o/255*100),a:i}},B$=be.memo(function(e){var t=e.hue,n=e.onChange,s=Ag(["react-colorful__hue",e.className]);return be.createElement("div",{className:s},be.createElement(y_,{onMove:function(i){n({h:360*i.left})},onKey:function(i){n({h:qu(t+360*i.left,0,360)})},"aria-label":"Hue","aria-valuenow":Gs(t),"aria-valuemax":"360","aria-valuemin":"0"},be.createElement(b_,{className:"react-colorful__hue-pointer",left:t/360,color:hw({h:t,s:100,v:100,a:1})})))}),$$=be.memo(function(e){var t=e.hsva,n=e.onChange,s={backgroundColor:hw({h:t.h,s:100,v:100,a:1})};return be.createElement("div",{className:"react-colorful__saturation",style:s},be.createElement(y_,{onMove:function(i){n({s:100*i.left,v:100-100*i.top})},onKey:function(i){n({s:qu(t.s+100*i.left,0,100),v:qu(t.v-100*i.top,0,100)})},"aria-label":"Color","aria-valuetext":"Saturation "+Gs(t.s)+"%, Brightness "+Gs(t.v)+"%"},be.createElement(b_,{className:"react-colorful__saturation-pointer",top:1-t.v/100,left:t.s/100,color:hw(t)})))}),x_=function(e,t){if(e===t)return!0;for(var n in e)if(e[n]!==t[n])return!1;return!0};function V$(e,t,n){var s=hp(n),i=u.useState(function(){return e.toHsva(t)}),o=i[0],a=i[1],l=u.useRef({color:t,hsva:o});u.useEffect(function(){if(!e.equal(t,l.current.color)){var d=e.toHsva(t);l.current={hsva:d,color:t},a(d)}},[t,e]),u.useEffect(function(){var d;x_(o,l.current.hsva)||e.equal(d=e.fromHsva(o),l.current.color)||(l.current={hsva:o,color:d},s(d))},[o,e,s]);var c=u.useCallback(function(d){a(function(h){return Object.assign({},h,d)})},[]);return[o,c]}var FCe=typeof window<"u"?u.useLayoutEffect:u.useEffect,BCe=function(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:void 0},mE=new Map,z$=function(e){FCe(function(){var t=e.current?e.current.ownerDocument:document;if(t!==void 0&&!mE.has(t)){var n=t.createElement("style");n.innerHTML=`.react-colorful{position:relative;display:flex;flex-direction:column;width:200px;height:200px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:default}.react-colorful__saturation{position:relative;flex-grow:1;border-color:transparent;border-bottom:12px solid #000;border-radius:8px 8px 0 0;background-image:linear-gradient(0deg,#000,transparent),linear-gradient(90deg,#fff,hsla(0,0%,100%,0))}.react-colorful__alpha-gradient,.react-colorful__pointer-fill{content:"";position:absolute;left:0;top:0;right:0;bottom:0;pointer-events:none;border-radius:inherit}.react-colorful__alpha-gradient,.react-colorful__saturation{box-shadow:inset 0 0 0 1px rgba(0,0,0,.05)}.react-colorful__alpha,.react-colorful__hue{position:relative;height:24px}.react-colorful__hue{background:linear-gradient(90deg,red 0,#ff0 17%,#0f0 33%,#0ff 50%,#00f 67%,#f0f 83%,red)}.react-colorful__last-control{border-radius:0 0 8px 8px}.react-colorful__interactive{position:absolute;left:0;top:0;right:0;bottom:0;border-radius:inherit;outline:none;touch-action:none}.react-colorful__pointer{position:absolute;z-index:1;box-sizing:border-box;width:28px;height:28px;transform:translate(-50%,-50%);background-color:#fff;border:2px solid #fff;border-radius:50%;box-shadow:0 2px 4px rgba(0,0,0,.2)}.react-colorful__interactive:focus .react-colorful__pointer{transform:translate(-50%,-50%) scale(1.1)}.react-colorful__alpha,.react-colorful__alpha-pointer{background-color:#fff;background-image:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill-opacity=".05"><path d="M8 0h8v8H8zM0 8h8v8H0z"/></svg>')}.react-colorful__saturation-pointer{z-index:3}.react-colorful__hue-pointer{z-index:2}`,mE.set(t,n);var s=BCe();s&&n.setAttribute("nonce",s),t.head.appendChild(n)}},[])},$Ce=function(e){var t=e.className,n=e.colorModel,s=e.color,i=s===void 0?n.defaultColor:s,o=e.onChange,a=Tg(e,["className","colorModel","color","onChange"]),l=u.useRef(null);z$(l);var c=V$(n,i,o),d=c[0],h=c[1],f=Ag(["react-colorful",t]);return be.createElement("div",cl({},a,{ref:l,className:f}),be.createElement($$,{hsva:d,onChange:h}),be.createElement(B$,{hue:d.h,onChange:h,className:"react-colorful__last-control"}))},VCe=function(e){var t=e.className,n=e.hsva,s=e.onChange,i={backgroundImage:"linear-gradient(90deg, "+Rv(Object.assign({},n,{a:0}))+", "+Rv(Object.assign({},n,{a:1}))+")"},o=Ag(["react-colorful__alpha",t]),a=Gs(100*n.a);return be.createElement("div",{className:o},be.createElement("div",{className:"react-colorful__alpha-gradient",style:i}),be.createElement(y_,{onMove:function(l){s({a:l.left})},onKey:function(l){s({a:qu(n.a+l.left)})},"aria-label":"Alpha","aria-valuetext":a+"%","aria-valuenow":a,"aria-valuemin":"0","aria-valuemax":"100"},be.createElement(b_,{className:"react-colorful__alpha-pointer",left:n.a,color:Rv(n)})))},zCe=function(e){var t=e.className,n=e.colorModel,s=e.color,i=s===void 0?n.defaultColor:s,o=e.onChange,a=Tg(e,["className","colorModel","color","onChange"]),l=u.useRef(null);z$(l);var c=V$(n,i,o),d=c[0],h=c[1],f=Ag(["react-colorful",t]);return be.createElement("div",cl({},a,{ref:l,className:f}),be.createElement($$,{hsva:d,onChange:h}),be.createElement(B$,{hue:d.h,onChange:h}),be.createElement(VCe,{hsva:d,onChange:h,className:"react-colorful__last-control"}))},GCe={defaultColor:{r:0,g:0,b:0,a:1},toHsva:F$,fromHsva:N$,equal:x_},G$=function(e){return be.createElement(zCe,cl({},e,{colorModel:GCe}))},HCe={defaultColor:{r:0,g:0,b:0},toHsva:function(e){return F$({r:e.r,g:e.g,b:e.b,a:1})},fromHsva:function(e){return{r:(t=N$(e)).r,g:t.g,b:t.b};var t},equal:x_},WCe=function(e){return be.createElement($Ce,cl({},e,{colorModel:HCe}))},UCe=/^#?([0-9A-F]{3,8})$/i,qCe=function(e){var t=e.color,n=t===void 0?"":t,s=e.onChange,i=e.onBlur,o=e.escape,a=e.validate,l=e.format,c=e.process,d=Tg(e,["color","onChange","onBlur","escape","validate","format","process"]),h=u.useState(function(){return o(n)}),f=h[0],p=h[1],g=hp(s),m=hp(i),y=u.useCallback(function(C){var x=o(C.target.value);p(x),a(x)&&g(c?c(x):x)},[o,c,a,g]),b=u.useCallback(function(C){a(C.target.value)||p(o(n)),m(C)},[n,o,a,m]);return u.useEffect(function(){p(o(n))},[n,o]),be.createElement("input",cl({},d,{value:l?l(f):f,spellCheck:"false",onChange:y,onBlur:b}))},yE=function(e){return"#"+e},KCe=function(e){var t=e.prefixed,n=e.alpha,s=Tg(e,["prefixed","alpha"]),i=u.useCallback(function(a){return a.replace(/([^0-9A-F]+)/gi,"").substring(0,n?8:6)},[n]),o=u.useCallback(function(a){return function(l,c){var d=UCe.exec(l),h=d?d[1].length:0;return h===3||h===6||!!c&&h===4||!!c&&h===8}(a,n)},[n]);return be.createElement(qCe,cl({},s,{escape:i,format:t?yE:void 0,process:yE,validate:o}))};const Ov={width:6,height:6,borderColor:"base.100"},ZCe={".react-colorful__hue-pointer":Ov,".react-colorful__saturation-pointer":Ov,".react-colorful__alpha-pointer":Ov,gap:4,flexDir:"column"},YCe={width:"100%"},Vm="3.5rem",XCe=e=>{const{color:t,onChange:n,withNumberInput:s=!1,withSwatches:i=!1}=e,{t:o}=A(),a=u.useCallback(h=>n({...t,r:h}),[t,n]),l=u.useCallback(h=>n({...t,g:h}),[t,n]),c=u.useCallback(h=>n({...t,b:h}),[t,n]),d=u.useCallback(h=>n({...t,a:h}),[t,n]);return r.jsxs(T,{sx:ZCe,children:[r.jsx(G$,{color:t,onChange:n,style:YCe}),s&&r.jsxs(T,{gap:2,children:[r.jsxs(K,{gap:0,children:[r.jsx(J,{children:o("common.red")[0]}),r.jsx(Ie,{value:t.r,onChange:a,min:0,max:255,step:1,w:Vm,defaultValue:90})]}),r.jsxs(K,{gap:0,children:[r.jsx(J,{children:o("common.green")[0]}),r.jsx(Ie,{value:t.g,onChange:l,min:0,max:255,step:1,w:Vm,defaultValue:90})]}),r.jsxs(K,{gap:0,children:[r.jsx(J,{children:o("common.blue")[0]}),r.jsx(Ie,{value:t.b,onChange:c,min:0,max:255,step:1,w:Vm,defaultValue:255})]}),r.jsxs(K,{gap:0,children:[r.jsx(J,{children:o("common.alpha")[0]}),r.jsx(Ie,{value:t.a,onChange:d,step:.1,min:0,max:1,w:Vm,defaultValue:1})]})]}),i&&r.jsx(T,{gap:2,justifyContent:"space-between",children:OCe.map((h,f)=>r.jsx(QCe,{color:h,onChange:n},f))})]})},H$=u.memo(XCe),QCe=({color:e,onChange:t})=>{const n=u.useCallback(()=>{t(e)},[e,t]);return r.jsx(Se,{role:"button",onClick:n,h:8,w:8,bg:Zo(e),borderRadius:"base"})},JCe=fe(el,e=>e.color),W$=u.memo(()=>{const{t:e}=A(),t=I(JCe),n=G(),s=u.useCallback(o=>{n(B2(o))},[n]),i=Nt();return Re({id:"setFillToWhite",category:"canvas",callback:()=>n(B2({r:255,g:255,b:255,a:1})),options:{preventDefault:!0,enabled:!i.isOpen},dependencies:[n,i.isOpen]}),r.jsxs(rs,{isLazy:!0,children:[r.jsx(gs,{children:r.jsx(T,{role:"button","aria-label":e("controlLayers.fill.fillColor"),tabIndex:-1,w:8,h:8,children:r.jsx(Ee,{label:e("controlLayers.fill.fillColor"),children:r.jsx(T,{w:"full",h:"full",alignItems:"center",justifyContent:"center",children:r.jsx(Se,{borderRadius:"full",borderColor:"base.600",w:6,h:6,borderWidth:2,bg:Zo(t)})})})})}),r.jsxs(is,{children:[r.jsx(Li,{}),r.jsx(ms,{minH:64,children:r.jsx(H$,{color:t,onChange:s,withNumberInput:!0,withSwatches:!0})})]})]})});W$.displayName="ToolFillColorPicker";const oa=e=>{const t=Lt();return ae(Wn(t.tool.$tool,s=>s===e))},wc=e=>{const t=Lt();return u.useCallback(()=>{t.tool.$tool.set(e)},[t.tool.$tool,e])},ewe=fe(el,e=>e.brushWidth),twe=e=>`${e} px`;function U$(e){return e<=40?1+49*e/40:e<=70?50+150*(e-40)/30:200+400*(e-70)/30}function gu(e){return e<=50?(e-1)*40/49:e<=200?40+(e-50)*30/150:70+(e-200)*30/400}function nwe(e){return`${String(U$(e))} px`}const swe=[gu(1),gu(50),gu(200),gu(600)],rwe=gu(50),q$=u.memo(()=>{const e=G(),{t}=A(),n=Nt(),s=oa("brush"),i=I(ewe),[o,a]=u.useState(i),l=u.useCallback(m=>{e(AP(uo(Math.round(m),1,600)))},[e]),c=u.useCallback(()=>{let m=Math.round(i*1.15);m===i&&(m+=1),l(m)},[l,i]),d=u.useCallback(()=>{let m=Math.round(i*.85);m===i&&(m-=1),l(m)},[l,i]),h=u.useCallback(m=>{l(U$(m))},[l]),f=u.useCallback(()=>{isNaN(Number(o))?(l(50),a(50)):l(o)},[o,l]),p=u.useCallback((m,y)=>{a(y)},[]),g=u.useCallback(m=>{m.key==="Enter"&&f()},[f]);return u.useEffect(()=>{a(i)},[i]),Re({id:"decrementToolWidth",category:"canvas",callback:d,options:{enabled:s&&!n.isOpen},dependencies:[d,s,n.isOpen]}),Re({id:"incrementToolWidth",category:"canvas",callback:c,options:{enabled:s&&!n.isOpen},dependencies:[c,s,n.isOpen]}),r.jsxs(rs,{children:[r.jsxs(K,{w:"min-content",gap:2,children:[r.jsx(J,{m:0,children:t("controlLayers.width")}),r.jsx(Hp,{children:r.jsxs(Ly,{variant:"outline",display:"flex",alignItems:"center",min:1,max:600,value:o,onChange:p,onBlur:f,w:"76px",format:twe,defaultValue:50,onKeyDown:g,clampValueOnBlur:!1,children:[r.jsx(Dy,{_focusVisible:{zIndex:0},title:"",paddingInlineEnd:7}),r.jsx(gs,{children:r.jsx(oe,{"aria-label":"open-slider",icon:r.jsx(Di,{}),size:"sm",variant:"link",position:"absolute",insetInlineEnd:0,h:"full"})})]})})]}),r.jsxs(is,{w:200,pt:0,pb:2,px:4,children:[r.jsx(Li,{}),r.jsx(ms,{children:r.jsx(Ze,{min:0,max:100,value:gu(o),onChange:h,defaultValue:rwe,marks:swe,formatValue:nwe,alwaysShowMarks:!0})})]})]})});q$.displayName="ToolBrushWidth";const iwe=fe(el,e=>e.eraserWidth),owe=e=>`${e} px`;function K$(e){return e<=40?1+49*e/40:e<=70?50+150*(e-40)/30:200+400*(e-70)/30}function mu(e){return e<=50?(e-1)*40/49:e<=200?40+(e-50)*30/150:70+(e-200)*30/400}function awe(e){return`${String(K$(e))} px`}const lwe=[mu(1),mu(50),mu(200),mu(600)],cwe=mu(50),Z$=u.memo(()=>{const e=G(),{t}=A(),n=Nt(),s=oa("eraser"),i=I(iwe),[o,a]=u.useState(i),l=u.useCallback(m=>{e(EP(uo(Math.round(m),1,600)))},[e]),c=u.useCallback(()=>{let m=Math.round(i*1.15);m===i&&(m+=1),l(m)},[l,i]),d=u.useCallback(()=>{let m=Math.round(i*.85);m===i&&(m-=1),l(m)},[l,i]),h=u.useCallback(m=>{l(K$(m))},[l]),f=u.useCallback(()=>{isNaN(Number(o))?(l(50),a(50)):l(o)},[o,l]),p=u.useCallback((m,y)=>{a(y)},[]),g=u.useCallback(m=>{m.key==="Enter"&&f()},[f]);return u.useEffect(()=>{a(i)},[i]),Re({id:"decrementToolWidth",category:"canvas",callback:d,options:{enabled:s&&!n.isOpen},dependencies:[d,s,n.isOpen]}),Re({id:"incrementToolWidth",category:"canvas",callback:c,options:{enabled:s&&!n.isOpen},dependencies:[c,s,n.isOpen]}),r.jsxs(rs,{children:[r.jsxs(K,{w:"min-content",gap:2,children:[r.jsx(J,{m:0,children:t("controlLayers.width")}),r.jsx(Hp,{children:r.jsxs(Ly,{variant:"outline",display:"flex",alignItems:"center",min:1,max:600,value:o,onChange:p,onBlur:f,w:"76px",format:owe,defaultValue:50,onKeyDown:g,clampValueOnBlur:!1,children:[r.jsx(Dy,{_focusVisible:{zIndex:0},title:"",paddingInlineEnd:7}),r.jsx(gs,{children:r.jsx(oe,{"aria-label":"open-slider",icon:r.jsx(Di,{}),size:"sm",variant:"link",position:"absolute",insetInlineEnd:0,h:"full"})})]})})]}),r.jsxs(is,{w:200,pt:0,pb:2,px:4,children:[r.jsx(Li,{}),r.jsx(ms,{children:r.jsx(Ze,{min:0,max:100,value:mu(o),onChange:h,defaultValue:cwe,marks:lwe,formatValue:awe,alwaysShowMarks:!0})})]})]})});Z$.displayName="ToolEraserWidth";const Y$=u.memo(()=>{const e=Lt(),t=ae(e.tool.$tool);return t==="brush"?r.jsx(q$,{}):t==="eraser"?r.jsx(Z$,{}):null});Y$.displayName="ToolSettings";const X$=u.memo(()=>{const{t:e}=A(),t=Lt(),n=ut(),s=u.useCallback(()=>{t.tool.tools.bbox.fitToLayers()},[t.tool.tools.bbox]);return r.jsx(oe,{onClick:s,variant:"link",alignSelf:"stretch","aria-label":e("controlLayers.fitBboxToLayers"),tooltip:e("controlLayers.fitBboxToLayers"),icon:r.jsx(nhe,{}),isDisabled:n})});X$.displayName="CanvasToolbarFitBboxToLayersButton";const v_=u.memo(()=>{const{t:e}=A(),t=G(),{newGallerySessionWithDialog:n}=R9(),{newCanvasSessionWithDialog:s}=O9(),i=u.useCallback(()=>{t(UJ())},[t]),o=u.useCallback(()=>{t(qJ())},[t]);return r.jsxs(r.Fragment,{children:[r.jsx(pe,{icon:r.jsx(ep,{}),onClick:n,children:e("controlLayers.newGallerySession")}),r.jsx(pe,{icon:r.jsx(ep,{}),onClick:s,children:e("controlLayers.newCanvasSession")}),r.jsx(pe,{icon:r.jsx(e1,{}),onClick:i,children:e("controlLayers.resetCanvasLayers")}),r.jsx(pe,{icon:r.jsx(e1,{}),onClick:o,children:e("controlLayers.resetGenerationSettings")})]})});v_.displayName="SessionMenuItems";const Q$=u.memo(()=>{const{t:e}=A();return r.jsxs(en,{placement:"bottom-end",children:[r.jsx(tn,{as:oe,"aria-label":e("controlLayers.newSession"),icon:r.jsx(ep,{}),variant:"link",alignSelf:"stretch"}),r.jsx(Tt,{children:r.jsx(v_,{})})]})});Q$.displayName="CanvasToolbarNewSessionMenuButton";const J$=u.memo(()=>{const{t:e}=A(),t=G(),n=ut(),s=I(PP),i=u.useCallback(()=>{t(LP())},[t]);return r.jsx(oe,{"aria-label":e("hotkeys.canvas.redo.title"),tooltip:e("hotkeys.canvas.redo.title"),onClick:i,icon:r.jsx(yde,{}),variant:"link",alignSelf:"stretch",isDisabled:n||!s})});J$.displayName="CanvasToolbarRedoButton";const eV=u.memo(()=>{const{t:e}=A(),t=Lt(),n=Ms("canvas"),s=Nt();return Re({id:"fitLayersToCanvas",category:"canvas",callback:t.stage.fitLayersToStage,options:{enabled:n&&!s.isOpen,preventDefault:!0},dependencies:[n,s.isOpen]}),Re({id:"fitBboxToCanvas",category:"canvas",callback:t.stage.fitBboxToStage,options:{enabled:n&&!s.isOpen,preventDefault:!0},dependencies:[n,s.isOpen]}),Re({id:"setZoomTo100Percent",category:"canvas",callback:()=>t.stage.setScale(1),options:{enabled:n&&!s.isOpen,preventDefault:!0},dependencies:[n,s.isOpen]}),Re({id:"setZoomTo200Percent",category:"canvas",callback:()=>t.stage.setScale(2),options:{enabled:n&&!s.isOpen,preventDefault:!0},dependencies:[n,s.isOpen]}),Re({id:"setZoomTo400Percent",category:"canvas",callback:()=>t.stage.setScale(4),options:{enabled:n&&!s.isOpen,preventDefault:!0},dependencies:[n,s.isOpen]}),Re({id:"setZoomTo800Percent",category:"canvas",callback:()=>t.stage.setScale(8),options:{enabled:n&&!s.isOpen,preventDefault:!0},dependencies:[n,s.isOpen]}),r.jsx(oe,{tooltip:e("hotkeys.canvas.fitLayersToCanvas.title"),"aria-label":e("hotkeys.canvas.fitLayersToCanvas.title"),onClick:t.stage.fitLayersToStage,icon:r.jsx(ob,{}),variant:"link",alignSelf:"stretch"})});eV.displayName="CanvasToolbarResetViewButton";const tV=u.memo(()=>{const{t:e}=A(),t=tl(),n=ut(),s=KF(),i=ZF();return r.jsx(oe,{variant:"link",alignSelf:"stretch",onClick:t?i:s,icon:r.jsx(so,{}),"aria-label":e(t?"controlLayers.saveBboxToGallery":"controlLayers.saveCanvasToGallery"),tooltip:e(t?"controlLayers.saveBboxToGallery":"controlLayers.saveCanvasToGallery"),isDisabled:n})});tV.displayName="CanvasToolbarSaveToGalleryButton";function uwe(e){return isNaN(Number(e))?"":`${Ap(Number(e),2).toLocaleString()}%`}function nV(e){return e<=40?10+90*e/40:e<=70?100+400*(e-40)/30:500+1500*(e-70)/30}function kl(e){return e<=100?(e-10)*40/90:e<=500?40+(e-100)*30/400:70+(e-500)*30/1500}function dwe(e){return String(nV(e))}const fw=[kl(10),kl(50),kl(100),kl(500),kl(2e3)],hwe=kl(100),fwe=fw.slice(1,fw.length-1),sV=u.memo(()=>{const e=Lt(),t=ae(Wn(e.stage.$stageAttrs,c=>c.scale)),[n,s]=u.useState(t*100),i=u.useCallback(c=>{let d=c;IS.get()||(d=DP(c,fwe,2));const h=nV(d);e.stage.setScale(h/100)},[e]),o=u.useCallback(()=>{if(isNaN(Number(n))){e.stage.setScale(1),s(100);return}e.stage.setScale(n/100)},[e,n]),a=u.useCallback((c,d)=>{s(d)},[]),l=u.useCallback(c=>{c.key==="Enter"&&o()},[o]);return u.useEffect(()=>{s(t*100)},[t]),r.jsxs(T,{alignItems:"center",children:[r.jsx(pwe,{}),r.jsxs(rs,{children:[r.jsx(Hp,{children:r.jsxs(Ly,{variant:"outline",display:"flex",alignItems:"center",min:e.stage.config.MIN_SCALE*100,max:e.stage.config.MAX_SCALE*100,value:n,onChange:a,onBlur:o,w:"76px",format:uwe,defaultValue:100,onKeyDown:l,clampValueOnBlur:!1,children:[r.jsx(Dy,{paddingInlineEnd:7,title:"",_focusVisible:{zIndex:0}}),r.jsx(gs,{children:r.jsx(oe,{"aria-label":"open-slider",icon:r.jsx(Di,{}),size:"sm",variant:"link",position:"absolute",insetInlineEnd:0,h:"full"})})]})}),r.jsxs(is,{w:200,pt:0,pb:2,px:4,children:[r.jsx(Li,{}),r.jsx(ms,{children:r.jsx(Ze,{min:0,max:100,value:kl(n),onChange:i,defaultValue:hwe,marks:fw,formatValue:dwe,alwaysShowMarks:!0})})]})]}),r.jsx(gwe,{})]})});sV.displayName="CanvasToolbarScale";const rV=[.1,.15,.2,.25,.5,.75,1,1.5,2,2.5,5,7.5,10,15,20],pwe=()=>{const e=Lt(),t=ae(Wn(e.stage.$stageAttrs,s=>s.scale)),n=u.useCallback(()=>{const s=rV.slice().reverse().find(i=>i<t)??e.stage.config.MIN_SCALE;e.stage.setScale(Math.max(s,e.stage.config.MIN_SCALE))},[e.stage,t]);return r.jsx(oe,{onClick:n,icon:r.jsx(XR,{}),"aria-label":"Zoom out",variant:"link",alignSelf:"stretch",isDisabled:t<=e.stage.config.MIN_SCALE})},gwe=()=>{const e=Lt(),t=ae(Wn(e.stage.$stageAttrs,s=>s.scale)),n=u.useCallback(()=>{const s=rV.find(i=>i>t)??e.stage.config.MAX_SCALE;e.stage.setScale(Math.min(s,e.stage.config.MAX_SCALE))},[e.stage,t]);return r.jsx(oe,{onClick:n,icon:r.jsx(QR,{}),"aria-label":"Zoom out",variant:"link",alignSelf:"stretch",isDisabled:t>=e.stage.config.MAX_SCALE})},iV=u.memo(()=>{const{t:e}=A(),t=G(),n=ut(),s=I(RP),i=u.useCallback(()=>{t(OP())},[t]);return r.jsx(oe,{"aria-label":e("hotkeys.canvas.undo.title"),tooltip:e("hotkeys.canvas.undo.title"),onClick:i,icon:r.jsx(ur,{}),variant:"link",alignSelf:"stretch",isDisabled:n||!s})});iV.displayName="CanvasToolbarUndoButton";function oV(){At(oV.name);const e=G(),t=I(Tn),n=ut(),s=I(qf),i=I(An),o=Nt(),a=u.useCallback(()=>{t!==null&&e(jS({entityIdentifier:t}))},[e,t]),l=u.useMemo(()=>t!==null&&!n&&s==="layers"&&i==="canvas",[t,n,s,i]);Re({id:"deleteSelected",category:"canvas",callback:a,options:{enabled:l&&!o.isOpen},dependencies:[l,a,o.isOpen]})}const mwe=()=>{const e=G(),[t,n]=u.useState(null),[s,i]=u.useState(null),o=I(Tn),a=I(KJ),l=Nt();u.useEffect(()=>{(s==null?void 0:s.id)!==(o==null?void 0:o.id)&&(n(s),i(o))},[s,o]);const c=u.useCallback(()=>{a?(s==null?void 0:s.id)!==a.id?(n(s),i(a),e(xu({entityIdentifier:a}))):t&&(i(t),e(xu({entityIdentifier:t}))):t!==null&&s!==null&&(n(s),i(t),e(xu({entityIdentifier:t})))},[a,s,e,t]);Re({id:"quickSwitch",category:"canvas",callback:c,options:{enabled:!l.isOpen},dependencies:[c,l.isOpen]})},ywe=()=>{At("useCanvasFilterHotkey");const e=I(Tn),t=Lb(e);Re({id:"filterSelected",category:"canvas",callback:t.start,options:{enabled:!t.isDisabled,preventDefault:!0},dependencies:[t]})};function aV(){At(aV.name);const e=G(),t=I(Tn),n=ut(),s=ko(t),i=Ri(t),o=Nt(),a=u.useCallback(()=>{t===null||s===null||(s.bufferRenderer.clearBuffer(),e(TP({entityIdentifier:t})))},[s,e,t]),l=u.useMemo(()=>t!==null&&V2(t),[t]);Re({id:"resetSelected",category:"canvas",callback:a,options:{enabled:l&&!n&&!i&&!o.isOpen},dependencies:[l,n,i,a,o.isOpen]})}const bwe=()=>{At("useCanvasTransformHotkey");const e=I(Tn),t=a_(e);Re({id:"transformSelected",category:"canvas",callback:t.start,options:{enabled:!t.isDisabled,preventDefault:!0},dependencies:[t]})},xwe=()=>{At("useCanvasUndoRedo");const e=Iy(),t=ut(),n=Nt(),s=I(RP),i=u.useCallback(()=>{e(OP())},[e]);Re({id:"undo",category:"canvas",callback:i,options:{enabled:s&&!t&&!n.isOpen,preventDefault:!0},dependencies:[s,t,i,n.isOpen]});const o=I(PP),a=u.useCallback(()=>{e(LP())},[e]);Re({id:"redo",category:"canvas",callback:a,options:{enabled:o&&!t&&!n.isOpen,preventDefault:!0},dependencies:[o,a,t,n.isOpen]})},vwe=hn(tt,e=>{const t=e.selectedEntityIdentifier,n=NP(e);let s=null;if(!t)s=n[0]??null;else{const i=n.findIndex(o=>o.id===t.id);s=n[(i+1)%n.length]??null}return s?tr(s):null}),Cwe=hn(tt,e=>{const t=e.selectedEntityIdentifier,n=NP(e);let s=null;if(!t)s=n[0]??null;else{const i=n.findIndex(o=>o.id===t.id);s=n[(i-1+n.length)%n.length]??null}return s?tr(s):null}),wwe=()=>{At("useNextPrevEntityHotkeys");const e=G(),t=I(vwe),n=I(Cwe),s=u.useCallback(()=>{t&&e(xu({entityIdentifier:t}))},[e,t]),i=u.useCallback(()=>{n&&e(xu({entityIdentifier:n}))},[e,n]);Ii([""],i,{preventDefault:!0,ignoreModifiers:!0},[i]),Re({category:"canvas",id:"prevEntity",callback:i,options:{preventDefault:!0},dependencies:[i]}),Ii([""],s,{preventDefault:!0,ignoreModifiers:!0},[s]),Re({category:"canvas",id:"nextEntity",callback:s,options:{preventDefault:!0},dependencies:[s]})},lV=u.memo(()=>(aV(),oV(),xwe(),mwe(),wwe(),bwe(),ywe(),r.jsxs(T,{w:"full",gap:2,alignItems:"center",children:[r.jsx(W$,{}),r.jsx(Y$,{}),r.jsx(it,{}),r.jsxs(T,{alignItems:"center",h:"full",children:[r.jsx(sV,{}),r.jsx(eV,{}),r.jsx(X$,{})]}),r.jsx(wt,{orientation:"vertical"}),r.jsxs(T,{alignItems:"center",h:"full",children:[r.jsx(tV,{}),r.jsx(iV,{}),r.jsx(J$,{}),r.jsx(Q$,{}),r.jsx(D$,{})]})]})));lV.displayName="CanvasToolbar";const Swe=Ge.enum(["fill","contain","cover"]),cV=u.memo(({adapter:e})=>{const{t}=A(),[n,s]=u.useState("contain"),i=ae(e.transformer.$isProcessing),o=u.useCallback(()=>{if(n==="contain"){e.transformer.fitToBboxContain();return}if(n==="cover"){e.transformer.fitToBboxCover();return}if(n==="fill"){e.transformer.fitToBboxFill();return}we(!1)},[e.transformer,n]),a=u.useMemo(()=>[{value:"contain",label:t("controlLayers.transform.fitModeContain")},{value:"cover",label:t("controlLayers.transform.fitModeCover")},{value:"fill",label:t("controlLayers.transform.fitModeFill")}],[t]),l=u.useMemo(()=>a.find(d=>d.value===n)??null,[a,n]),c=u.useCallback(d=>{d&&s(Swe.parse(d.value))},[]);return r.jsxs(T,{gap:4,w:"full",children:[r.jsxs(K,{maxW:64,children:[r.jsx(J,{m:0,children:t("controlLayers.transform.fitMode")}),r.jsx(Ne,{options:a,value:l,onChange:c,isSearchable:!1,isClearable:!1})]}),r.jsx(de,{size:"sm",onClick:o,isDisabled:i,loadingText:t("controlLayers.transform.fitToBbox"),variant:"ghost",children:t("controlLayers.transform.fitToBbox")})]})});cV.displayName="TransformFitToBboxButtons";const uV=u.memo(({adapter:e})=>{const{t}=A(),n=u.useRef(null);sg("canvas",n,{focusOnMount:!0});const s=Ms("canvas"),i=ae(e.transformer.$isProcessing),o=ae(e.transformer.$silentTransform);return Re({id:"applyTransform",category:"canvas",callback:e.transformer.applyTransform,options:{enabled:!i&&s},dependencies:[e.transformer,i,s]}),Re({id:"cancelTransform",category:"canvas",callback:e.transformer.stopTransform,options:{enabled:!i&&s},dependencies:[e.transformer,i,s]}),o?null:r.jsxs(T,{ref:n,bg:"base.800",borderRadius:"base",p:4,flexDir:"column",gap:4,minW:420,h:"auto",shadow:"dark-lg",transitionProperty:"height",transitionDuration:"normal",children:[r.jsxs(T,{w:"full",gap:4,children:[r.jsx(Ft,{size:"md",color:"base.300",userSelect:"none",children:t("controlLayers.transform.transform")}),r.jsx(it,{}),r.jsx(Db,{})]}),r.jsx(cV,{adapter:e}),r.jsxs(Zn,{isAttached:!1,size:"sm",w:"full",alignItems:"center",children:[i&&r.jsx(Lr,{ms:3,boxSize:5,color:"base.600"}),r.jsx(it,{}),r.jsx(de,{onClick:e.transformer.resetTransform,isDisabled:i,loadingText:t("controlLayers.transform.reset"),variant:"ghost",children:t("controlLayers.transform.reset")}),r.jsx(de,{onClick:e.transformer.applyTransform,isDisabled:i,loadingText:t("controlLayers.transform.apply"),variant:"ghost",children:t("controlLayers.transform.apply")}),r.jsx(de,{onClick:e.transformer.stopTransform,isDisabled:i,loadingText:t("common.cancel"),variant:"ghost",children:t("controlLayers.transform.cancel")})]})]})});uV.displayName="TransformContent";const jwe=()=>{const e=Lt(),t=ae(e.stateApi.$transformingAdapter);return t?r.jsx(uV,{adapter:t}):null},dV=u.memo(()=>{const{t:e}=A(),t=G(),n=I(FP),s=I(AS),i=u.useCallback(()=>{t(Ax("slider"))},[t]),o=u.useCallback(()=>{t(Ax("side-by-side"))},[t]),a=u.useCallback(()=>{t(Ax("hover"))},[t]),l=u.useCallback(()=>{t(ZJ())},[t]);Re({id:"swapImages",category:"viewer",callback:l,dependencies:[l]});const c=u.useCallback(()=>{t(YJ(s==="contain"?"fill":"contain"))},[t,s]),d=u.useCallback(()=>{t(Op(null))},[t]);Ii("esc",d,[d]);const h=u.useCallback(()=>{t(XJ())},[t]);return Re({id:"nextComparisonMode",category:"viewer",callback:h,dependencies:[h]}),r.jsxs(T,{w:"full",px:2,gap:2,bg:"base.750",borderTopRadius:"base",h:12,children:[r.jsx(T,{flex:1,justifyContent:"center",children:r.jsxs(T,{marginInlineEnd:"auto",alignItems:"center",children:[r.jsx(oe,{icon:r.jsx(_de,{}),"aria-label":`${e("gallery.swapImages")} (C)`,tooltip:`${e("gallery.swapImages")} (C)`,onClick:l,variant:"link",alignSelf:"stretch"}),n!=="side-by-side"&&r.jsx(oe,{"aria-label":e("gallery.stretchToFit"),tooltip:e("gallery.stretchToFit"),onClick:c,colorScheme:s==="fill"?"invokeBlue":"base",variant:"link",alignSelf:"stretch",icon:r.jsx(ob,{})})]})}),r.jsx(T,{flex:1,justifyContent:"center",children:r.jsxs(Zn,{variant:"outline",alignItems:"center",children:[r.jsx(de,{flexShrink:0,onClick:i,colorScheme:n==="slider"?"invokeBlue":"base",children:e("gallery.slider")}),r.jsx(de,{flexShrink:0,onClick:o,colorScheme:n==="side-by-side"?"invokeBlue":"base",children:e("gallery.sideBySide")}),r.jsx(de,{flexShrink:0,onClick:a,colorScheme:n==="hover"?"invokeBlue":"base",children:e("gallery.hover")})]})}),r.jsx(T,{flex:1,justifyContent:"center",children:r.jsxs(T,{gap:2,marginInlineStart:"auto",alignItems:"center",children:[r.jsx(Ee,{label:r.jsx(kwe,{}),children:r.jsx(T,{alignItems:"center",children:r.jsx(lt,{boxSize:6,color:"base.300",as:Che,lineHeight:0})})}),r.jsx(de,{variant:"link",alignSelf:"stretch",px:2,"aria-label":`${e("gallery.exitCompare")} (Esc)`,tooltip:`${e("gallery.exitCompare")} (Esc)`,onClick:d,children:e("gallery.exitCompare")})]})})]})});dV.displayName="CompareToolbar";const kwe=()=>r.jsxs(or,{children:[r.jsx(Rt,{children:r.jsx(Ut,{i18nKey:"gallery.compareHelp1",components:{Kbd:r.jsx(cf,{})}})}),r.jsx(Rt,{children:r.jsx(Ut,{i18nKey:"gallery.compareHelp2",components:{Kbd:r.jsx(cf,{})}})}),r.jsx(Rt,{children:r.jsx(Ut,{i18nKey:"gallery.compareHelp3",components:{Kbd:r.jsx(cf,{})}})}),r.jsx(Rt,{children:r.jsx(Ut,{i18nKey:"gallery.compareHelp4",components:{Kbd:r.jsx(cf,{})}})})]}),_we=()=>{const{t:e}=A(),t=ae(BP),[n,s]=u.useState(null);return u.useEffect(()=>{if(!t){s(null);return}if(t&&!t.startsWith("Loading model")){s(null);return}const i=setTimeout(()=>{s(`${e("common.loadingModel")}...`)},5e3);return()=>clearTimeout(i)},[t,e]),n},hV=u.memo(()=>{const{t:e}=A(),t=ae(BP);return t?r.jsxs(ac,{status:"loading",borderRadius:"base",fontSize:"sm",shadow:"md",w:"fit-content",children:[r.jsx(lc,{}),r.jsx($p,{children:e("common.generating")}),r.jsx(Ta,{children:t})]}):null});hV.displayName="CanvasAlertsInvocationProgressContentLocal";const fV=u.memo(()=>{const e=_we();return e?r.jsxs(ac,{status:"loading",borderRadius:"base",fontSize:"sm",shadow:"md",w:"fit-content",children:[r.jsx(lc,{}),r.jsx(Ta,{children:e})]}):null});fV.displayName="CanvasAlertsInvocationProgressContentCommercial";const C_=u.memo(()=>{const e=I($P);return I(vM)?e?r.jsx(hV,{}):null:r.jsx(fV,{})});C_.displayName="CanvasAlertsInvocationProgress";function Iwe(){return{x:0,y:0}}function pV(e){var t=e.render,n=e.nativeSetDragImage,s=e.getOffset,i=s===void 0?Iwe:s,o=document.createElement("div");Object.assign(o.style,{position:"fixed",top:0,left:0,zIndex:ED,pointerEvents:"none"}),document.body.append(o);var a=t({container:o});queueMicrotask(function(){var d=i({container:o});if(fd()){var h=o.getBoundingClientRect();if(h.width===0)return;o.style.left="-".concat(h.width-1e-4,"px")}n==null||n(o,d.x,d.y)});function l(){c(),a==null||a(),document.body.removeChild(o)}var c=to({onDragStart:l,onDrop:l})}const I1=32;function gV({element:e,input:t}){return({container:n})=>{const s=e.getBoundingClientRect(),i=n.getBoundingClientRect();let o=t.clientX-s.x,a=t.clientY-s.y;return(a>i.height||o>i.width)&&(o=i.width/2,a=i.height/2),{x:o,y:a}}}function mV(e,t){e.animate([{backgroundColor:t},{}],{duration:700,easing:"cubic-bezier(0.25, 0.1, 0.25, 1.0)",iterations:1})}const Pd=e=>{if(!navigator.userAgent.includes("Firefox"))return wP;const t=new AbortController;return e.addEventListener("mouseover",n=>{(n.target instanceof HTMLTextAreaElement||n.target instanceof HTMLInputElement)&&e.setAttribute("draggable","false")},{signal:t.signal}),e.addEventListener("mouseout",n=>{(n.target instanceof HTMLTextAreaElement||n.target instanceof HTMLInputElement)&&e.setAttribute("draggable","true")},{signal:t.signal}),()=>{e.setAttribute("draggable","true"),t.abort()}},Twe=vo("img"),yV=u.memo(({imageDTO:e})=>r.jsx(T,{w:I1,h:I1,children:r.jsx(Twe,{margin:"auto",maxW:"full",maxH:"full",objectFit:"contain",borderRadius:"base",src:e.thumbnail_url})}));yV.displayName="DndDragPreviewSingleImage";const bV=e=>mc.createPortal(r.jsx(yV,{imageDTO:e.imageDTO}),e.container),xV=({singleImageDndData:e,onGenerateDragPreviewArgs:t,setDragPreviewState:n})=>{const{nativeSetDragImage:s,source:i,location:o}=t;pV({render({container:a}){return n({type:"single-image",container:a,imageDTO:e.payload.imageDTO}),()=>n(null)},nativeSetDragImage:s,getOffset:gV({element:i.element,input:o.current.input})})},Awe={objectFit:"contain",maxW:"full",maxH:"full",borderRadius:"base",cursor:"grab","&[data-is-dragging=true]":{opacity:.3}},ul=u.memo(({imageDTO:e,asThumbnail:t,...n})=>{const s=dn(),[i,o]=u.useState(!1),[a,l]=u.useState(null),[c,d]=u.useState(null);return u.useEffect(()=>{if(a)return qn(Pd(a),pd({element:a,getInitialData:()=>In.getData({imageDTO:e},e.image_name),onDragStart:()=>{o(!0)},onDrop:()=>{o(!1)},onGenerateDragPreview:h=>{In.typeGuard(h.source.data)&&xV({singleImageDndData:h.source.data,onGenerateDragPreviewArgs:h,setDragPreviewState:d})}}))},[e,a,s]),aO(e,a),r.jsxs(r.Fragment,{children:[r.jsx(Wt,{role:"button",ref:l,src:t?e.thumbnail_url:e.image_url,fallbackSrc:t?void 0:e.thumbnail_url,w:e.width,sx:Awe,"data-is-dragging":i,...n}),(c==null?void 0:c.type)==="single-image"?bV(c):null]})});ul.displayName="DndImage";const vV=e=>{const t=I(QJ),[n]=vc(e!=null&&e.has_workflow?e.image_name:null,t);return JJ(n??Xn)};var Nv={},Gh={},Fv={},bE;function w_(){return bE||(bE=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.EolStyle=void 0,function(t){t[t.Crlf=0]="Crlf",t[t.Lf=1]="Lf"}(e.EolStyle||(e.EolStyle={}))}(Fv)),Fv}var Bv={},xE;function S_(){return xE||(xE=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.CommentPolicy=void 0,function(t){t[t.TreatAsError=0]="TreatAsError",t[t.Remove=1]="Remove",t[t.Preserve=2]="Preserve"}(e.CommentPolicy||(e.CommentPolicy={}))}(Bv)),Bv}var $v={},vE;function j_(){return vE||(vE=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.NumberListAlignment=void 0,function(t){t[t.Left=0]="Left",t[t.Right=1]="Right",t[t.Decimal=2]="Decimal",t[t.Normalize=3]="Normalize"}(e.NumberListAlignment||(e.NumberListAlignment={}))}($v)),$v}var CE;function k_(){if(CE)return Gh;CE=1,Object.defineProperty(Gh,"__esModule",{value:!0}),Gh.FracturedJsonOptions=void 0;const e=w_(),t=S_(),n=j_();let s=class{constructor(){this.JsonEolStyle=e.EolStyle.Lf,this.MaxInlineLength=2e9,this.MaxTotalLineLength=120,this.MaxInlineComplexity=2,this.MaxCompactArrayComplexity=1,this.MaxTableRowComplexity=2,this.MinCompactArrayRowItems=3,this.AlwaysExpandDepth=-1,this.NestedBracketPadding=!0,this.SimpleBracketPadding=!1,this.ColonPadding=!0,this.CommaPadding=!0,this.CommentPadding=!0,this.OmitTrailingWhitespace=!1,this.NumberListAlignment=n.NumberListAlignment.Normalize,this.IndentSpaces=4,this.UseTabToIndent=!1,this.PrefixString="",this.CommentPolicy=t.CommentPolicy.TreatAsError,this.PreserveBlankLines=!1,this.AllowTrailingCommas=!1}};return Gh.FracturedJsonOptions=s,Gh}var Hh={},wE;function Ld(){if(wE)return Hh;wE=1,Object.defineProperty(Hh,"__esModule",{value:!0}),Hh.FracturedJsonError=void 0;let e=class extends Error{constructor(n,s){const i=s?`${n} at idx=${s.Index}, row=${s.Row}, col=${s.Column}`:n;super(i),this.InputPosition=s}};return Hh.FracturedJsonError=e,Hh}var Wh={},Uh={},SE;function Ewe(){if(SE)return Uh;SE=1,Object.defineProperty(Uh,"__esModule",{value:!0}),Uh.StringJoinBuffer=void 0;let e=class{constructor(n){this._lineBuff=[],this._docBuff=[],this._trimTrailingWhitespace=n}Add(...n){return this._lineBuff.push(...n),this}EndLine(n){return this.AddLineToWriter(n),this}Flush(){return this.AddLineToWriter(""),this}AsString(){return this._docBuff.join("")}AddLineToWriter(n){if(this._lineBuff.length===0&&n.length===0)return;let s=this._lineBuff.join("");this._trimTrailingWhitespace&&(s=s.trimEnd()),this._docBuff.push(s+n),this._lineBuff=[]}};return Uh.StringJoinBuffer=e,Uh}var qh={},Vv={},jE;function __(){return jE||(jE=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.BracketPaddingType=void 0,function(t){t[t.Empty=0]="Empty",t[t.Simple=1]="Simple",t[t.Complex=2]="Complex"}(e.BracketPaddingType||(e.BracketPaddingType={}))}(Vv)),Vv}var zv={},kE;function Dd(){return kE||(kE=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.JsonItemType=void 0,function(t){t[t.Null=0]="Null",t[t.False=1]="False",t[t.True=2]="True",t[t.String=3]="String",t[t.Number=4]="Number",t[t.Object=5]="Object",t[t.Array=6]="Array",t[t.BlankLine=7]="BlankLine",t[t.LineComment=8]="LineComment",t[t.BlockComment=9]="BlockComment"}(e.JsonItemType||(e.JsonItemType={}))}(zv)),zv}var _E;function Mwe(){if(_E)return qh;_E=1,Object.defineProperty(qh,"__esModule",{value:!0}),qh.PaddedFormattingTokens=void 0;const e=__(),t=w_(),n=Dd();let s=class{constructor(o,a){this._arrStart=[],this._arrStart[e.BracketPaddingType.Empty]="[",this._arrStart[e.BracketPaddingType.Simple]=o.SimpleBracketPadding?"[ ":"[",this._arrStart[e.BracketPaddingType.Complex]=o.NestedBracketPadding?"[ ":"[",this._arrEnd=[],this._arrEnd[e.BracketPaddingType.Empty]="]",this._arrEnd[e.BracketPaddingType.Simple]=o.SimpleBracketPadding?" ]":"]",this._arrEnd[e.BracketPaddingType.Complex]=o.NestedBracketPadding?" ]":"]",this._objStart=[],this._objStart[e.BracketPaddingType.Empty]="{",this._objStart[e.BracketPaddingType.Simple]=o.SimpleBracketPadding?"{ ":"{",this._objStart[e.BracketPaddingType.Complex]=o.NestedBracketPadding?"{ ":"{",this._objEnd=[],this._objEnd[e.BracketPaddingType.Empty]="}",this._objEnd[e.BracketPaddingType.Simple]=o.SimpleBracketPadding?" }":"}",this._objEnd[e.BracketPaddingType.Complex]=o.NestedBracketPadding?" }":"}",this._comma=o.CommaPadding?", ":",",this._colon=o.ColonPadding?": ":":",this._comment=o.CommentPadding?" ":"",this._eol=o.JsonEolStyle===t.EolStyle.Crlf?`\r
`:`
`,this._arrStartLen=this._arrStart.map(a),this._arrEndLen=this._arrEnd.map(a),this._objStartLen=this._objStart.map(a),this._objEndLen=this._objEnd.map(a),this._indentStrings=["",o.UseTabToIndent?"	":" ".repeat(o.IndentSpaces)],this._spaceStrings=[""," "],this._commaLen=a(this._comma),this._colonLen=a(this._colon),this._commentLen=a(this._comment),this._literalNullLen=a("null"),this._literalTrueLen=a("true"),this._literalFalseLen=a("false"),this._prefixStringLen=a(o.PrefixString),this._dummyComma=" ".repeat(this._commaLen)}get Comma(){return this._comma}get Colon(){return this._colon}get Comment(){return this._comment}get EOL(){return this._eol}get CommaLen(){return this._commaLen}get ColonLen(){return this._colonLen}get CommentLen(){return this._commentLen}get LiteralNullLen(){return this._literalNullLen}get LiteralTrueLen(){return this._literalTrueLen}get LiteralFalseLen(){return this._literalFalseLen}get PrefixStringLen(){return this._prefixStringLen}get DummyComma(){return this._dummyComma}ArrStart(o){return this._arrStart[o]}ArrEnd(o){return this._arrEnd[o]}ObjStart(o){return this._objStart[o]}ObjEnd(o){return this._objEnd[o]}Start(o,a){return o===n.JsonItemType.Array?this.ArrStart(a):this.ObjStart(a)}End(o,a){return o===n.JsonItemType.Array?this.ArrEnd(a):this.ObjEnd(a)}ArrStartLen(o){return this._arrStartLen[o]}ArrEndLen(o){return this._arrEndLen[o]}ObjStartLen(o){return this._objStartLen[o]}ObjEndLen(o){return this._objEndLen[o]}StartLen(o,a){return o===n.JsonItemType.Array?this.ArrStartLen(a):this.ObjStartLen(a)}EndLen(o,a){return o===n.JsonItemType.Array?this.ArrEndLen(a):this.ObjEndLen(a)}Indent(o){if(o>=this._indentStrings.length)for(let a=this._indentStrings.length;a<=o;++a)this._indentStrings.push(this._indentStrings[a-1]+this._indentStrings[1]);return this._indentStrings[o]}Spaces(o){if(o>=this._spaceStrings.length)for(let a=this._spaceStrings.length;a<=o;++a)this._spaceStrings.push(" ".repeat(a));return this._spaceStrings[o]}};return qh.PaddedFormattingTokens=s,qh}var Kh={},IE;function Pwe(){if(IE)return Kh;IE=1,Object.defineProperty(Kh,"__esModule",{value:!0}),Kh.TableTemplate=void 0;const e=Dd(),t=__(),n=j_();let s=class Xc{constructor(o,a){this.LocationInParent=void 0,this.Type=e.JsonItemType.Null,this.IsRowDataCompatible=!0,this.RowCount=0,this.NameLength=0,this.SimpleValueLength=0,this.PrefixCommentLength=0,this.MiddleCommentLength=0,this.PostfixCommentLength=0,this.PadType=t.BracketPaddingType.Simple,this.AllowNumberNormalization=!1,this.IsNumberList=!1,this.CompositeValueLength=0,this.TotalLength=0,this.Children=[],this._maxDigBeforeDecRaw=0,this._maxDigAfterDecRaw=0,this._maxDigBeforeDecNorm=0,this._maxDigAfterDecNorm=0,this._pads=o,this._numberListAlignment=a,this.AllowNumberNormalization=a===n.NumberListAlignment.Normalize,this.IsNumberList=!0}MeasureTableRoot(o){for(const a of o.Children)this.MeasureRowSegment(a);this.PruneAndRecompute(Number.MAX_VALUE),this.IsRowDataCompatible&&(this.IsRowDataCompatible=this.RowCount>=2)}TryToFit(o){for(let a=this.GetTemplateComplexity();a>=0;--a){if(this.TotalLength<=o)return!0;this.PruneAndRecompute(a-1)}return!1}FormatNumber(o,a){const l=this._numberListAlignment===n.NumberListAlignment.Normalize&&!this.AllowNumberNormalization?n.NumberListAlignment.Left:this._numberListAlignment;switch(l){case n.NumberListAlignment.Left:o.Add(a.Value,this._pads.Spaces(this.SimpleValueLength-a.ValueLength));return;case n.NumberListAlignment.Right:o.Add(this._pads.Spaces(this.SimpleValueLength-a.ValueLength),a.Value);return}let c,d,h,f;if(l===n.NumberListAlignment.Normalize){if(a.Type===e.JsonItemType.Null){o.Add(this._pads.Spaces(this._maxDigBeforeDecNorm-a.ValueLength),a.Value,this._pads.Spaces(this.CompositeValueLength-this._maxDigBeforeDecNorm));return}c=this._maxDigBeforeDecNorm,d=this._maxDigAfterDecNorm,h=Number(a.Value).toFixed(d),f=h.length}else c=this._maxDigBeforeDecRaw,d=this._maxDigAfterDecRaw,h=a.Value,f=a.ValueLength;let p,g;const m=h.search(Xc._dotOrE);m>0?(p=c-m,g=this.CompositeValueLength-p-f):(p=c-f,g=this.CompositeValueLength-c),o.Add(this._pads.Spaces(p),h,this._pads.Spaces(g))}MeasureRowSegment(o){if(!(o.Type===e.JsonItemType.BlankLine||o.Type===e.JsonItemType.BlockComment||o.Type===e.JsonItemType.LineComment)&&(o.Type===e.JsonItemType.False||o.Type===e.JsonItemType.True?(this.IsRowDataCompatible&&(this.IsRowDataCompatible=this.Type===e.JsonItemType.True||this.Type===e.JsonItemType.Null),this.Type=e.JsonItemType.True,this.IsNumberList=!1):o.Type===e.JsonItemType.Number?(this.IsRowDataCompatible&&(this.IsRowDataCompatible=this.Type===e.JsonItemType.Number||this.Type===e.JsonItemType.Null),this.Type=e.JsonItemType.Number):o.Type===e.JsonItemType.Null?(this._maxDigBeforeDecNorm=Math.max(this._maxDigBeforeDecNorm,this._pads.LiteralNullLen),this._maxDigBeforeDecRaw=Math.max(this._maxDigBeforeDecRaw,this._pads.LiteralNullLen)):(this.IsRowDataCompatible&&(this.IsRowDataCompatible=this.Type===o.Type||this.Type===e.JsonItemType.Null),this.Type===e.JsonItemType.Null&&(this.Type=o.Type),this.IsNumberList=!1),this.IsRowDataCompatible&&(this.IsRowDataCompatible=!o.RequiresMultipleLines),this.RowCount+=1,this.NameLength=Math.max(this.NameLength,o.NameLength),this.SimpleValueLength=Math.max(this.SimpleValueLength,o.ValueLength),this.MiddleCommentLength=Math.max(this.MiddleCommentLength,o.MiddleCommentLength),this.PrefixCommentLength=Math.max(this.PrefixCommentLength,o.PrefixCommentLength),this.PostfixCommentLength=Math.max(this.PostfixCommentLength,o.PostfixCommentLength),o.Complexity>=2&&(this.PadType=t.BracketPaddingType.Complex),!!this.IsRowDataCompatible)){if(o.Type===e.JsonItemType.Array)for(let a=0;a<o.Children.length;++a)this.Children.length<=a&&this.Children.push(new Xc(this._pads,this._numberListAlignment)),this.Children[a].MeasureRowSegment(o.Children[a]);else if(o.Type===e.JsonItemType.Object){if(this.ContainsDuplicateKeys(o.Children)){this.IsRowDataCompatible=!1;return}for(const a of o.Children){let l=this.Children.find(c=>c.LocationInParent===a.Name);l||(l=new Xc(this._pads,this._numberListAlignment),l.LocationInParent=a.Name,this.Children.push(l)),l.MeasureRowSegment(a)}}else if(o.Type===e.JsonItemType.Number&&this.IsNumberList){const l=Number(o.Value),c=l.toString();this.AllowNumberNormalization&&(this.AllowNumberNormalization=!isNaN(l)&&l!==1/0&&l!==-1/0&&c.length<=15&&c.indexOf("e")<0&&(l!==0||Xc._trulyZeroValString.test(o.Value)));const d=c.indexOf(".");this._maxDigBeforeDecNorm=Math.max(this._maxDigBeforeDecNorm,d>=0?d:c.length),this._maxDigAfterDecNorm=Math.max(this._maxDigAfterDecNorm,d>=0?c.length-d-1:0);const h=o.Value.search(Xc._dotOrE);this._maxDigBeforeDecRaw=Math.max(this._maxDigBeforeDecRaw,h>=0?h:o.ValueLength),this._maxDigAfterDecRaw=Math.max(this._maxDigAfterDecRaw,h>=0?o.ValueLength-h-1:0)}this.AllowNumberNormalization&&(this.AllowNumberNormalization=this.IsNumberList)}}PruneAndRecompute(o){(o<=0||!this.IsRowDataCompatible)&&(this.Children=[]);for(const a of this.Children)a.PruneAndRecompute(o-1);if(this.IsNumberList)this.CompositeValueLength=this.GetNumberFieldWidth();else if(this.Children.length>0){const a=this.Children.map(l=>l.TotalLength).reduce((l,c)=>l+c);this.CompositeValueLength=a+Math.max(0,this._pads.CommaLen*(this.Children.length-1))+this._pads.ArrStartLen(this.PadType)+this._pads.ArrEndLen(this.PadType)}else this.CompositeValueLength=this.SimpleValueLength;this.TotalLength=(this.PrefixCommentLength>0?this.PrefixCommentLength+this._pads.CommentLen:0)+(this.NameLength>0?this.NameLength+this._pads.ColonLen:0)+(this.MiddleCommentLength>0?this.MiddleCommentLength+this._pads.CommentLen:0)+this.CompositeValueLength+(this.PostfixCommentLength>0?this.PostfixCommentLength+this._pads.CommentLen:0)}GetTemplateComplexity(){if(this.Children.length===0)return 0;const o=this.Children.map(a=>a.GetTemplateComplexity());return 1+Math.max(...o)}ContainsDuplicateKeys(o){const a=o.map(l=>l.Name);return a.some((l,c)=>a.indexOf(l)!==c)}GetNumberFieldWidth(){if(this._numberListAlignment===n.NumberListAlignment.Normalize&&this.AllowNumberNormalization){const o=this._maxDigAfterDecNorm>0?1:0;return this._maxDigBeforeDecNorm+o+this._maxDigAfterDecNorm}else if(this._numberListAlignment===n.NumberListAlignment.Decimal){const o=this._maxDigAfterDecRaw>0?1:0;return this._maxDigBeforeDecRaw+o+this._maxDigAfterDecRaw}return this.SimpleValueLength}};return Kh.TableTemplate=s,s._trulyZeroValString=new RegExp("^-?[0.]+([eE].*)?$"),s._dotOrE=new RegExp("[.eE]"),Kh}var Zh={},Yh={},TE;function Lwe(){if(TE)return Yh;TE=1,Object.defineProperty(Yh,"__esModule",{value:!0}),Yh.TokenEnumerator=void 0;const e=Ld();let t=class{constructor(s){this._generator=s}get Current(){if(!this._current)throw new e.FracturedJsonError("Illegal enumerator usage");return this._current}MoveNext(){const s=this._generator.next();return this._current=s.value,!s.done}};return Yh.TokenEnumerator=t,Yh}var Xh={},AE;function CV(){if(AE)return Xh;AE=1,Object.defineProperty(Xh,"__esModule",{value:!0}),Xh.JsonItem=void 0;const e=Dd();let t=class{constructor(){this.Type=e.JsonItemType.Null,this.InputPosition={Index:0,Row:0,Column:0},this.Complexity=0,this.Name="",this.Value="",this.PrefixComment="",this.MiddleComment="",this.PostfixComment="",this.IsPostCommentLineStyle=!1,this.NameLength=0,this.ValueLength=0,this.PrefixCommentLength=0,this.MiddleCommentLength=0,this.PostfixCommentLength=0,this.MinimumTotalLength=0,this.RequiresMultipleLines=!1,this.Children=[]}};return Xh.JsonItem=t,Xh}var Gv={},EE;function wV(){return EE||(EE=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.TokenType=void 0,function(t){t[t.Invalid=0]="Invalid",t[t.BeginArray=1]="BeginArray",t[t.EndArray=2]="EndArray",t[t.BeginObject=3]="BeginObject",t[t.EndObject=4]="EndObject",t[t.String=5]="String",t[t.Number=6]="Number",t[t.Null=7]="Null",t[t.True=8]="True",t[t.False=9]="False",t[t.BlockComment=10]="BlockComment",t[t.LineComment=11]="LineComment",t[t.BlankLine=12]="BlankLine",t[t.Comma=13]="Comma",t[t.Colon=14]="Colon"}(e.TokenType||(e.TokenType={}))}(Gv)),Gv}var Qh={},Jh={},ME;function Dwe(){if(ME)return Jh;ME=1,Object.defineProperty(Jh,"__esModule",{value:!0}),Jh.ScannerState=void 0;const e=Ld();let t=class{constructor(i){this.CurrentPosition={Index:0,Row:0,Column:0},this.TokenPosition={Index:0,Row:0,Column:0},this.NonWhitespaceSinceLastNewline=!1,this._originalText=i}Advance(i){if(this.CurrentPosition.Index>=n)throw new Error("Maximum document length exceeded");this.CurrentPosition.Index+=1,this.CurrentPosition.Column+=1,this.NonWhitespaceSinceLastNewline||(this.NonWhitespaceSinceLastNewline=!i)}NewLine(){if(this.CurrentPosition.Index>=n)throw new Error("Maximum document length exceeded");this.CurrentPosition.Index+=1,this.CurrentPosition.Row+=1,this.CurrentPosition.Column=0,this.NonWhitespaceSinceLastNewline=!1}SetTokenStart(){this.TokenPosition=Object.assign({},this.CurrentPosition)}MakeTokenFromBuffer(i,o=!1){const a=this._originalText.substring(this.TokenPosition.Index,this.CurrentPosition.Index);return{Type:i,Text:o?a.trimEnd():a,InputPosition:Object.assign({},this.TokenPosition)}}MakeToken(i,o){return{Type:i,Text:o,InputPosition:Object.assign({},this.TokenPosition)}}Current(){return this.AtEnd()?NaN:this._originalText.charCodeAt(this.CurrentPosition.Index)}AtEnd(){return this.CurrentPosition.Index>=this._originalText.length}Throw(i){throw new e.FracturedJsonError(i,this.CurrentPosition)}};Jh.ScannerState=t;const n=2e9;return Jh}var PE;function Rwe(){if(PE)return Qh;PE=1,Object.defineProperty(Qh,"__esModule",{value:!0}),Qh.TokenGenerator=void 0;const e=Dwe(),t=wV();function*n(N){const U=new e.ScannerState(N);for(;;){if(U.AtEnd())return;const ie=U.Current();switch(ie){case c:case f:case h:U.Advance(!0);break;case d:U.NonWhitespaceSinceLastNewline||(yield U.MakeToken(t.TokenType.BlankLine,`
`)),U.NewLine(),U.SetTokenStart();break;case b:yield s(U,"{",t.TokenType.BeginObject);break;case C:yield s(U,"}",t.TokenType.EndObject);break;case x:yield s(U,"[",t.TokenType.BeginArray);break;case v:yield s(U,"]",t.TokenType.EndArray);break;case w:yield s(U,":",t.TokenType.Colon);break;case S:yield s(U,",",t.TokenType.Comma);break;case re:yield i(U,"true",t.TokenType.True);break;case B:yield i(U,"false",t.TokenType.False);break;case ee:yield i(U,"null",t.TokenType.Null);break;case p:yield o(U);break;case y:yield a(U);break;case P:yield l(U);break;default:H(ie)||U.Throw("Unexpected character"),yield l(U);break}}}Qh.TokenGenerator=n;function s(N,U,ie){N.SetTokenStart();const ue=N.MakeToken(ie,U);return N.Advance(!1),ue}function i(N,U,ie){N.SetTokenStart();for(let xe=1;xe<U.length;++xe)N.AtEnd()&&N.Throw("Unexpected end of input while processing keyword"),N.Advance(!1),N.Current()!==U.charCodeAt(xe)&&N.Throw("Unexpected keyword");const ue=N.MakeToken(ie,U);return N.Advance(!1),ue}function o(N){N.SetTokenStart(),N.AtEnd()&&N.Throw("Unexpected end of input while processing comment"),N.Advance(!1);let U=!1;N.Current()===g?U=!0:N.Current()!==p&&N.Throw("Bad character for start of comment"),N.Advance(!1);let ie=!1;for(;;){if(N.AtEnd())if(U)N.Throw("Unexpected end of input while processing comment");else return N.MakeTokenFromBuffer(t.TokenType.LineComment,!0);const ue=N.Current();if(ue===d){if(N.NewLine(),!U)return N.MakeTokenFromBuffer(t.TokenType.LineComment,!0);continue}if(N.Advance(!1),ue===p&&ie)return N.MakeTokenFromBuffer(t.TokenType.BlockComment);ie=ue===g}}function a(N){N.SetTokenStart(),N.Advance(!1);let U=!1,ie=0;for(;;){N.AtEnd()&&N.Throw("Unexpected end of input while processing string");const ue=N.Current();if(ie>0){V(ue)||N.Throw("Bad unicode escape in string"),ie-=1,N.Advance(!1);continue}if(U){X(ue)||N.Throw("Bad escaped character in string"),ue===te&&(ie=4),U=!1,N.Advance(!1);continue}if(W(ue)&&N.Throw("Control characters are not allowed in strings"),N.Advance(!1),ue===y)return N.MakeTokenFromBuffer(t.TokenType.String);ue===m&&(U=!0)}}function l(N){N.SetTokenStart();let U=Y.Beginning;for(;;){const ie=N.Current();let ue=$.ValidAndConsumed;switch(U){case Y.Beginning:ie===P?U=Y.PastLeadingSign:ie===D?U=Y.PastWhole:H(ie)?U=Y.PastFirstDigitOfWhole:ue=$.InvalidatesToken;break;case Y.PastLeadingSign:H(ie)?ie===D?U=Y.PastWhole:U=Y.PastFirstDigitOfWhole:ue=$.InvalidatesToken;break;case Y.PastFirstDigitOfWhole:ie===E?U=Y.PastDecimalPoint:ie===L||ie===O?U=Y.PastE:H(ie)||(ue=$.StartOfNewToken);break;case Y.PastWhole:ie===E?U=Y.PastDecimalPoint:ie===L||ie===O?U=Y.PastE:ue=$.StartOfNewToken;break;case Y.PastDecimalPoint:H(ie)?U=Y.PastFirstDigitOfFractional:ue=$.InvalidatesToken;break;case Y.PastFirstDigitOfFractional:ie===L||ie===O?U=Y.PastE:H(ie)||(ue=$.StartOfNewToken);break;case Y.PastE:ie===j||ie===P?U=Y.PastExpSign:H(ie)?U=Y.PastFirstDigitOfExponent:ue=$.InvalidatesToken;break;case Y.PastExpSign:H(ie)?U=Y.PastFirstDigitOfExponent:ue=$.InvalidatesToken;break;case Y.PastFirstDigitOfExponent:H(ie)||(ue=$.StartOfNewToken);break}if(ue===$.InvalidatesToken&&N.Throw("Bad character while processing number"),ue===$.StartOfNewToken)return N.MakeTokenFromBuffer(t.TokenType.Number);if(!N.AtEnd()){N.Advance(!1);continue}switch(U){case Y.PastFirstDigitOfWhole:case Y.PastWhole:case Y.PastFirstDigitOfFractional:case Y.PastFirstDigitOfExponent:return N.MakeTokenFromBuffer(t.TokenType.Number);default:N.Throw("Unexpected end of input while processing number");break}}}const c=32,d=10,h=13,f=9,p=47,g=42,m=92,y=34,b=123,C=125,x=91,v=93,w=58,S=44,j=43,P=45,E=46,D=48,M=57,R=97,F=65,_=98,L=101,O=69,B=102,z=70,ee=110,ne=114,re=116,te=117;function H(N){return N>=D&&N<=M}function V(N){return N>=D&&N<=M||N>=R&&N<=B||N>=F&&N<=z}function X(N){switch(N){case y:case m:case p:case _:case B:case ee:case ne:case re:case te:return!0;default:return!1}}function W(N){return N>=0&&N<=31||N===127||N>=128&&N<=159}var Y;(function(N){N[N.Beginning=0]="Beginning",N[N.PastLeadingSign=1]="PastLeadingSign",N[N.PastFirstDigitOfWhole=2]="PastFirstDigitOfWhole",N[N.PastWhole=3]="PastWhole",N[N.PastDecimalPoint=4]="PastDecimalPoint",N[N.PastFirstDigitOfFractional=5]="PastFirstDigitOfFractional",N[N.PastE=6]="PastE",N[N.PastExpSign=7]="PastExpSign",N[N.PastFirstDigitOfExponent=8]="PastFirstDigitOfExponent"})(Y||(Y={}));var $;return function(N){N[N.InvalidatesToken=0]="InvalidatesToken",N[N.ValidAndConsumed=1]="ValidAndConsumed",N[N.StartOfNewToken=2]="StartOfNewToken"}($||($={})),Qh}var LE;function Owe(){if(LE)return Zh;LE=1,Object.defineProperty(Zh,"__esModule",{value:!0}),Zh.Parser=void 0;const e=k_(),t=Lwe(),n=CV(),s=Dd(),i=wV(),o=Ld(),a=S_(),l=Rwe();let c=class Qc{constructor(){this.Options=new e.FracturedJsonOptions}ParseTopLevel(p,g){const m=new t.TokenEnumerator((0,l.TokenGenerator)(p));return this.ParseTopLevelFromEnum(m,g)}ParseTopLevelFromEnum(p,g){const m=[];let y=!1;for(;;){if(!p.MoveNext())return m;const b=this.ParseItem(p),C=b.Type===s.JsonItemType.BlockComment||b.Type===s.JsonItemType.LineComment;if(b.Type===s.JsonItemType.BlankLine)this.Options.PreserveBlankLines&&m.push(b);else if(C){if(this.Options.CommentPolicy===a.CommentPolicy.TreatAsError)throw new o.FracturedJsonError("Comments not allowed with current options",b.InputPosition);this.Options.CommentPolicy===a.CommentPolicy.Preserve&&m.push(b)}else{if(g&&y)throw new o.FracturedJsonError("Unexpected start of second top level element",b.InputPosition);m.push(b),y=!0}}}ParseItem(p){switch(p.Current.Type){case i.TokenType.BeginArray:return this.ParseArray(p);case i.TokenType.BeginObject:return this.ParseObject(p);default:return this.ParseSimple(p.Current)}}ParseSimple(p){const g=new n.JsonItem;return g.Type=Qc.ItemTypeFromTokenType(p),g.Value=p.Text,g.InputPosition=p.InputPosition,g.Complexity=0,g}ParseArray(p){if(p.Current.Type!==i.TokenType.BeginArray)throw new o.FracturedJsonError("Parser logic error",p.Current.InputPosition);const g=p.Current.InputPosition;let m,y=-1,b;const C=[];let x=d.EmptyCollection,v=!1,w=0;for(;!v;){const j=Qc.GetNextTokenOrThrow(p,g);switch(b&&((b==null?void 0:b.InputPosition.Row)!==j.InputPosition.Row||j.Type===i.TokenType.EndArray)&&(m?(m.PostfixComment=b.Value,m.IsPostCommentLineStyle=b.Type===s.JsonItemType.LineComment):C.push(b),b=void 0),m&&y!==j.InputPosition.Row&&(m=void 0),j.Type){case i.TokenType.EndArray:if(x===d.CommaSeen&&!this.Options.AllowTrailingCommas)throw new o.FracturedJsonError("Array may not end with a comma with current options",j.InputPosition);v=!0;break;case i.TokenType.Comma:if(x!==d.ElementSeen)throw new o.FracturedJsonError("Unexpected comma in array",j.InputPosition);x=d.CommaSeen;break;case i.TokenType.BlankLine:if(!this.Options.PreserveBlankLines)break;C.push(this.ParseSimple(j));break;case i.TokenType.BlockComment:if(this.Options.CommentPolicy===a.CommentPolicy.Remove)break;if(this.Options.CommentPolicy===a.CommentPolicy.TreatAsError)throw new o.FracturedJsonError("Comments not allowed with current options",j.InputPosition);b&&(C.push(b),b=void 0);const E=this.ParseSimple(j);if(Qc.IsMultilineComment(E)){C.push(E);break}if(m&&x===d.ElementSeen){m.PostfixComment=E.Value,m.IsPostCommentLineStyle=!1,m=void 0;break}b=E;break;case i.TokenType.LineComment:if(this.Options.CommentPolicy===a.CommentPolicy.Remove)break;if(this.Options.CommentPolicy===a.CommentPolicy.TreatAsError)throw new o.FracturedJsonError("Comments not allowed with current options",j.InputPosition);if(b){C.push(b),C.push(this.ParseSimple(j)),b=void 0;break}if(m){m.PostfixComment=j.Text,m.IsPostCommentLineStyle=!0,m=void 0;break}C.push(this.ParseSimple(j));break;case i.TokenType.False:case i.TokenType.True:case i.TokenType.Null:case i.TokenType.String:case i.TokenType.Number:case i.TokenType.BeginArray:case i.TokenType.BeginObject:if(x===d.ElementSeen)throw new o.FracturedJsonError("Comma missing while processing array",j.InputPosition);const D=this.ParseItem(p);x=d.ElementSeen,w=Math.max(w,D.Complexity+1),b&&(D.PrefixComment=b.Value,b=void 0),C.push(D),m=D,y=p.Current.InputPosition.Row;break;default:throw new o.FracturedJsonError("Unexpected token in array",j.InputPosition)}}const S=new n.JsonItem;return S.Type=s.JsonItemType.Array,S.InputPosition=g,S.Complexity=w,S.Children=C,S}ParseObject(p){if(p.Current.Type!==i.TokenType.BeginObject)throw new o.FracturedJsonError("Parser logic error",p.Current.InputPosition);const g=p.Current.InputPosition,m=[];let y,b,C=-1,x=[],v=[],w,S=!1,j=h.BeforePropName,P=0,E=!1;for(;!E;){const M=Qc.GetNextTokenOrThrow(p,g),R=C!==M.InputPosition.Row,F=M.Type===i.TokenType.EndObject,_=M.Type===i.TokenType.String&&j===h.AfterComma,L=w&&(M.Type===i.TokenType.BlockComment||M.Type===i.TokenType.LineComment);if(y&&b&&(R||F||_||L)){let B;_&&S&&!R&&(B=w,w=void 0),Qc.AttachObjectValuePieces(m,y,b,C,x,v,w),P=Math.max(P,b.Complexity+1),y=void 0,b=void 0,x=[],v=[],w=void 0,B&&x.push(B)}switch(M.Type){case i.TokenType.BlankLine:if(!this.Options.PreserveBlankLines||j===h.AfterPropName||j===h.AfterColon)break;m.push(...x),x=[],m.push(this.ParseSimple(M));break;case i.TokenType.BlockComment:case i.TokenType.LineComment:if(this.Options.CommentPolicy===a.CommentPolicy.Remove)break;if(this.Options.CommentPolicy===a.CommentPolicy.TreatAsError)throw new o.FracturedJsonError("Comments not allowed with current options",M.InputPosition);j===h.BeforePropName||!y?x.push(this.ParseSimple(M)):j===h.AfterPropName||j===h.AfterColon?v.push(M):(w=this.ParseSimple(M),S=j===h.AfterComma);break;case i.TokenType.EndObject:if(j===h.AfterPropName||j===h.AfterColon)throw new o.FracturedJsonError("Unexpected end of object",M.InputPosition);E=!0;break;case i.TokenType.String:if(j===h.BeforePropName||j===h.AfterComma)y=M,j=h.AfterPropName;else if(j===h.AfterColon)b=this.ParseItem(p),C=p.Current.InputPosition.Row,j=h.AfterPropValue;else throw new o.FracturedJsonError("Unexpected string found while processing object",M.InputPosition);break;case i.TokenType.False:case i.TokenType.True:case i.TokenType.Null:case i.TokenType.Number:case i.TokenType.BeginArray:case i.TokenType.BeginObject:if(j!==h.AfterColon)throw new o.FracturedJsonError("Unexpected element while processing object",M.InputPosition);b=this.ParseItem(p),C=p.Current.InputPosition.Row,j=h.AfterPropValue;break;case i.TokenType.Colon:if(j!==h.AfterPropName)throw new o.FracturedJsonError("Unexpected colon while processing object",M.InputPosition);j=h.AfterColon;break;case i.TokenType.Comma:if(j!==h.AfterPropValue)throw new o.FracturedJsonError("Unexpected comma while processing object",M.InputPosition);j=h.AfterComma;break;default:throw new o.FracturedJsonError("Unexpected token while processing object",M.InputPosition)}}if(!this.Options.AllowTrailingCommas&&j===h.AfterComma)throw new o.FracturedJsonError("Object may not end with comma with current options",p.Current.InputPosition);const D=new n.JsonItem;return D.Type=s.JsonItemType.Object,D.InputPosition=g,D.Complexity=P,D.Children=m,D}static ItemTypeFromTokenType(p){switch(p.Type){case i.TokenType.False:return s.JsonItemType.False;case i.TokenType.True:return s.JsonItemType.True;case i.TokenType.Null:return s.JsonItemType.Null;case i.TokenType.Number:return s.JsonItemType.Number;case i.TokenType.String:return s.JsonItemType.String;case i.TokenType.BlankLine:return s.JsonItemType.BlankLine;case i.TokenType.BlockComment:return s.JsonItemType.BlockComment;case i.TokenType.LineComment:return s.JsonItemType.LineComment;default:throw new o.FracturedJsonError("Unexpected Token",p.InputPosition)}}static GetNextTokenOrThrow(p,g){if(!p.MoveNext())throw new o.FracturedJsonError("Unexpected end of input while processing array or object starting",g);return p.Current}static IsMultilineComment(p){return p.Type===s.JsonItemType.BlockComment&&p.Value.includes(`
`)}static AttachObjectValuePieces(p,g,m,y,b,C,x){if(m.Name=g.Text,C.length>0){let v="";for(let w=0;w<C.length;++w)v+=C[w].Text,(w<C.length-1||C[w].Type===i.TokenType.LineComment)&&(v+=`
`);m.MiddleComment=v}if(b.length>0){const v=b.pop();v.Type===s.JsonItemType.BlockComment&&v.InputPosition.Row===m.InputPosition.Row?(m.PrefixComment=v.Value,p.push(...b)):(p.push(...b),p.push(v))}p.push(m),x&&(!this.IsMultilineComment(x)&&x.InputPosition.Row===y?(m.PostfixComment=x.Value,m.IsPostCommentLineStyle=x.Type===s.JsonItemType.LineComment):p.push(x))}};Zh.Parser=c;var d;(function(f){f[f.EmptyCollection=0]="EmptyCollection",f[f.ElementSeen=1]="ElementSeen",f[f.CommaSeen=2]="CommaSeen"})(d||(d={}));var h;return function(f){f[f.BeforePropName=0]="BeforePropName",f[f.AfterPropName=1]="AfterPropName",f[f.AfterColon=2]="AfterColon",f[f.AfterPropValue=3]="AfterPropValue",f[f.AfterComma=4]="AfterComma"}(h||(h={})),Zh}var ef={},DE;function Nwe(){if(DE)return ef;DE=1,Object.defineProperty(ef,"__esModule",{value:!0}),ef.ConvertDataToDom=void 0;const e=CV(),t=Dd(),n=Ld();function s(i,o,a=100){var l;if(a<=0)throw new n.FracturedJsonError("Depth limit exceeded - possible circular reference");const c=typeof i;switch(c){case"function":case"symbol":case"undefined":return}if(i&&i.toJSON){const h=JSON.parse(JSON.stringify(i));return s(h,o,a-1)}const d=new e.JsonItem;if(d.Name=o?JSON.stringify(o):"",i===null)d.Type=t.JsonItemType.Null,d.Value="null";else if(Array.isArray(i)){d.Type=t.JsonItemType.Array,d.Children=i.map(h=>{var f;return(f=s(h,void 0,a-1))!==null&&f!==void 0?f:s(null,void 0,a-1)}),d.Children=[];for(let h=0;h<i.length;++h)d.Children[h]=(l=s(i[h],void 0,a-1))!==null&&l!==void 0?l:s(null,void 0,a-1)}else if(c==="object"){d.Type=t.JsonItemType.Object;for(const h of Object.entries(i)){const f=s(h[1],h[0],a-1);f&&d.Children.push(f)}}else{switch(c){case"string":d.Type=t.JsonItemType.String;break;case"number":case"bigint":d.Type=t.JsonItemType.Number;break;case"boolean":d.Type=i?t.JsonItemType.True:t.JsonItemType.False;break}d.Value=JSON.stringify(i)}if(d.Children.length>0){const h=d.Children.map(f=>f.Complexity).reduce((f,p)=>Math.max(f,p));d.Complexity=h+1}return d}return ef.ConvertDataToDom=s,ef}var RE;function Fwe(){if(RE)return Wh;RE=1,Object.defineProperty(Wh,"__esModule",{value:!0}),Wh.Formatter=void 0;const e=k_(),t=Ewe(),n=Mwe(),s=Dd(),i=__(),o=Pwe(),a=Ld(),l=Owe(),c=Nwe();let d=class Fs{constructor(){this.Options=new e.FracturedJsonOptions,this.StringLengthFunc=Fs.StringLengthByCharCount,this._buffer=new t.StringJoinBuffer(this.Options.OmitTrailingWhitespace),this._pads=new n.PaddedFormattingTokens(new e.FracturedJsonOptions,Fs.StringLengthByCharCount)}static StringLengthByCharCount(f){return f.length}Reformat(f,p=0){const g=new t.StringJoinBuffer(this.Options.OmitTrailingWhitespace),m=new l.Parser;m.Options=this.Options;const y=m.ParseTopLevel(f,!0);return this.FormatTopLevel(y,p,g),g.Flush(),g.AsString()}Serialize(f,p=0,g=100){const m=new t.StringJoinBuffer(this.Options.OmitTrailingWhitespace),y=(0,c.ConvertDataToDom)(f,void 0,g);if(y)return this.FormatTopLevel([y],p,m),m.Flush(),m.AsString()}Minify(f){const p=new t.StringJoinBuffer(this.Options.OmitTrailingWhitespace),g=new l.Parser;g.Options=this.Options;const m=g.ParseTopLevel(f,!0);return this.MinifyTopLevel(m,p),p.Flush(),p.AsString()}FormatTopLevel(f,p,g){this._buffer=g,this._pads=new n.PaddedFormattingTokens(this.Options,this.StringLengthFunc);for(const m of f)this.ComputeItemLengths(m),this.FormatItem(m,p,!1);this._buffer=new t.StringJoinBuffer(this.Options.OmitTrailingWhitespace)}MinifyTopLevel(f,p){this._buffer=p,this._pads=new n.PaddedFormattingTokens(this.Options,this.StringLengthFunc);let g=!0;for(const m of f)g=this.MinifyItem(m,g);this._buffer=new t.StringJoinBuffer(this.Options.OmitTrailingWhitespace)}ComputeItemLengths(f){const p=`
`;for(const g of f.Children)this.ComputeItemLengths(g);switch(f.Type){case s.JsonItemType.Null:f.ValueLength=this._pads.LiteralNullLen;break;case s.JsonItemType.True:f.ValueLength=this._pads.LiteralTrueLen;break;case s.JsonItemType.False:f.ValueLength=this._pads.LiteralFalseLen;break;default:f.ValueLength=this.StringLengthFunc(f.Value);break}if(f.NameLength=this.StringLengthFunc(f.Name),f.PrefixCommentLength=this.StringLengthFunc(f.PrefixComment),f.MiddleCommentLength=this.StringLengthFunc(f.MiddleComment),f.PostfixCommentLength=this.StringLengthFunc(f.PostfixComment),f.RequiresMultipleLines=Fs.IsCommentOrBlankLine(f.Type)||f.Children.some(g=>g.RequiresMultipleLines||g.IsPostCommentLineStyle)||f.PrefixComment.indexOf(p)>=0||f.MiddleComment.indexOf(p)>=0||f.PostfixComment.indexOf(p)>=0||f.Value.indexOf(p)>=0,f.Type===s.JsonItemType.Array||f.Type===s.JsonItemType.Object){const g=Fs.GetPaddingType(f);f.ValueLength=this._pads.StartLen(f.Type,g)+this._pads.EndLen(f.Type,g)+f.Children.map(m=>m.MinimumTotalLength).reduce((m,y)=>m+y,0)+Math.max(0,this._pads.CommaLen*(f.Children.length-1))}f.MinimumTotalLength=(f.PrefixCommentLength>0?f.PrefixCommentLength+this._pads.CommentLen:0)+(f.NameLength>0?f.NameLength+this._pads.ColonLen:0)+(f.MiddleCommentLength>0?f.MiddleCommentLength+this._pads.CommentLen:0)+f.ValueLength+(f.PostfixCommentLength>0?f.PostfixCommentLength+this._pads.CommentLen:0)}FormatItem(f,p,g){switch(f.Type){case s.JsonItemType.Array:case s.JsonItemType.Object:this.FormatContainer(f,p,g);break;case s.JsonItemType.BlankLine:this.FormatBlankLine();break;case s.JsonItemType.BlockComment:case s.JsonItemType.LineComment:this.FormatStandaloneComment(f,p);break;default:f.RequiresMultipleLines?this.FormatSplitKeyValue(f,p,g):this.FormatInlineElement(f,p,g);break}}FormatContainer(f,p,g){p>this.Options.AlwaysExpandDepth&&(this.FormatContainerInline(f,p,g)||this.FormatContainerCompactMultiline(f,p,g))||p>=this.Options.AlwaysExpandDepth&&this.FormatContainerTable(f,p,g)||this.FormatContainerExpanded(f,p,g)}FormatContainerInline(f,p,g){if(f.RequiresMultipleLines)return!1;const m=f.MinimumTotalLength+(g?this._pads.CommaLen:0);return f.Complexity>this.Options.MaxInlineComplexity||m>this.AvailableLineSpace(p)?!1:(this._buffer.Add(this.Options.PrefixString,this._pads.Indent(p)),this.InlineElement(f,g),this._buffer.EndLine(this._pads.EOL),!0)}FormatContainerCompactMultiline(f,p,g){if(f.Type!==s.JsonItemType.Array||f.Complexity>this.Options.MaxCompactArrayComplexity||f.RequiresMultipleLines)return!1;const m=new o.TableTemplate(this._pads,this.Options.NumberListAlignment);m.MeasureTableRoot(f);const y=this.AvailableLineSpace(p+1);let b=this._pads.CommaLen;if(m.IsRowDataCompatible?b+=m.TotalLength:b+=f.Children.map(w=>w.MinimumTotalLength).reduce((w,S)=>w+S,0)/f.Children.length,b*this.Options.MinCompactArrayRowItems>y)return!1;const C=this.StandardFormatStart(f,p);this._buffer.Add(this._pads.Start(f.Type,i.BracketPaddingType.Empty));const x=this.AvailableLineSpace(C+1);let v=-1;for(let w=0;w<f.Children.length;++w){const S=f.Children[w],j=w<f.Children.length-1,P=(j?this._pads.CommaLen:0)+(m.IsRowDataCompatible?m.TotalLength:S.MinimumTotalLength);v<P&&(this._buffer.EndLine(this._pads.EOL).Add(this.Options.PrefixString,this._pads.Indent(C+1)),v=x),m.IsRowDataCompatible?this.InlineTableRowSegment(m,S,j,!1):this.InlineElement(S,j),v-=P}return this._buffer.EndLine(this._pads.EOL).Add(this.Options.PrefixString,this._pads.Indent(C),this._pads.End(f.Type,i.BracketPaddingType.Empty)),this.StandardFormatEnd(f,g),!0}FormatContainerTable(f,p,g){if(f.Complexity>this.Options.MaxTableRowComplexity+1)return!1;const m=this.AvailableLineSpace(p+1)-this._pads.CommaLen;if(f.Children.filter(v=>!Fs.IsCommentOrBlankLine(v.Type)).some(v=>v.MinimumTotalLength>m))return!1;const b=new o.TableTemplate(this._pads,this.Options.NumberListAlignment);if(b.MeasureTableRoot(f),!b.IsRowDataCompatible||!b.TryToFit(m))return!1;const C=this.StandardFormatStart(f,p);this._buffer.Add(this._pads.Start(f.Type,i.BracketPaddingType.Empty)).EndLine(this._pads.EOL);const x=Fs.IndexOfLastElement(f.Children);for(let v=0;v<f.Children.length;++v){const w=f.Children[v];if(w.Type===s.JsonItemType.BlankLine){this.FormatBlankLine();continue}if(w.Type===s.JsonItemType.LineComment||w.Type===s.JsonItemType.BlockComment){this.FormatStandaloneComment(w,C+1);continue}this._buffer.Add(this.Options.PrefixString,this._pads.Indent(C+1)),this.InlineTableRowSegment(b,w,v<x,!0),this._buffer.EndLine(this._pads.EOL)}return this._buffer.Add(this.Options.PrefixString,this._pads.Indent(C),this._pads.End(f.Type,i.BracketPaddingType.Empty)),this.StandardFormatEnd(f,g),!0}FormatContainerExpanded(f,p,g){const m=this.StandardFormatStart(f,p);this._buffer.Add(this._pads.Start(f.Type,i.BracketPaddingType.Empty)).EndLine(this._pads.EOL);const y=Fs.IndexOfLastElement(f.Children);for(let b=0;b<f.Children.length;++b)this.FormatItem(f.Children[b],m+1,b<y);this._buffer.Add(this.Options.PrefixString,this._pads.Indent(m),this._pads.End(f.Type,i.BracketPaddingType.Empty)),this.StandardFormatEnd(f,g)}FormatStandaloneComment(f,p){const g=Fs.NormalizeMultilineComment(f.Value,f.InputPosition.Column);for(const m of g)this._buffer.Add(this.Options.PrefixString,this._pads.Indent(p),m).EndLine(this._pads.EOL)}FormatBlankLine(){this._buffer.Add(this.Options.PrefixString).EndLine(this._pads.EOL)}FormatInlineElement(f,p,g){this._buffer.Add(this.Options.PrefixString,this._pads.Indent(p)),this.InlineElement(f,g),this._buffer.EndLine(this._pads.EOL)}FormatSplitKeyValue(f,p,g){this.StandardFormatStart(f,p),this._buffer.Add(f.Value),this.StandardFormatEnd(f,g)}StandardFormatStart(f,p){if(this._buffer.Add(this.Options.PrefixString,this._pads.Indent(p)),f.PrefixCommentLength>0&&this._buffer.Add(f.PrefixComment,this._pads.Comment),f.NameLength>0&&this._buffer.Add(f.Name,this._pads.Colon),f.MiddleCommentLength===0)return p;if(f.MiddleComment.indexOf(`
`)<0)return this._buffer.Add(f.MiddleComment,this._pads.Comment),p;const g=Fs.NormalizeMultilineComment(f.MiddleComment,Number.MAX_VALUE);this._buffer.EndLine(this._pads.EOL);for(const m of g)this._buffer.Add(this.Options.PrefixString,this._pads.Indent(p+1),m).EndLine(this._pads.EOL);return this._buffer.Add(this.Options.PrefixString,this._pads.Indent(p+1)),p+1}StandardFormatEnd(f,p){p&&f.IsPostCommentLineStyle&&this._buffer.Add(this._pads.Comma),f.PostfixCommentLength>0&&this._buffer.Add(this._pads.Comment,f.PostfixComment),p&&!f.IsPostCommentLineStyle&&this._buffer.Add(this._pads.Comma),this._buffer.EndLine(this._pads.EOL)}InlineElement(f,p){if(f.RequiresMultipleLines)throw new a.FracturedJsonError("Logic error - trying to inline invalid element");f.PrefixCommentLength>0&&this._buffer.Add(f.PrefixComment,this._pads.Comment),f.NameLength>0&&this._buffer.Add(f.Name,this._pads.Colon),f.MiddleCommentLength>0&&this._buffer.Add(f.MiddleComment,this._pads.Comment),this.InlineElementRaw(f),p&&f.IsPostCommentLineStyle&&this._buffer.Add(this._pads.Comma),f.PostfixCommentLength>0&&this._buffer.Add(this._pads.Comment,f.PostfixComment),p&&!f.IsPostCommentLineStyle&&this._buffer.Add(this._pads.Comma)}InlineElementRaw(f){if(f.Type===s.JsonItemType.Array){const p=Fs.GetPaddingType(f);this._buffer.Add(this._pads.ArrStart(p));for(let g=0;g<f.Children.length;++g)this.InlineElement(f.Children[g],g<f.Children.length-1);this._buffer.Add(this._pads.ArrEnd(p))}else if(f.Type===s.JsonItemType.Object){const p=Fs.GetPaddingType(f);this._buffer.Add(this._pads.ObjStart(p));for(let g=0;g<f.Children.length;++g)this.InlineElement(f.Children[g],g<f.Children.length-1);this._buffer.Add(this._pads.ObjEnd(p))}else this._buffer.Add(f.Value)}InlineTableRowSegment(f,p,g,m){f.PrefixCommentLength>0&&this._buffer.Add(p.PrefixComment,this._pads.Spaces(f.PrefixCommentLength-p.PrefixCommentLength),this._pads.Comment),f.NameLength>0&&this._buffer.Add(p.Name,this._pads.Spaces(f.NameLength-p.NameLength),this._pads.Colon),f.MiddleCommentLength>0&&this._buffer.Add(p.MiddleComment,this._pads.Spaces(f.MiddleCommentLength-p.MiddleCommentLength),this._pads.Comment),f.Children.length>0&&p.Type!==s.JsonItemType.Null?f.Type===s.JsonItemType.Array?this.InlineTableRawArray(f,p):this.InlineTableRawObject(f,p):f.IsNumberList?f.FormatNumber(this._buffer,p):(this.InlineElementRaw(p),this._buffer.Add(this._pads.Spaces(f.CompositeValueLength-p.ValueLength)));const y=p.IsPostCommentLineStyle||p.PostfixCommentLength===0;y&&(g?this._buffer.Add(this._pads.Comma):m&&this._buffer.Add(this._pads.DummyComma)),f.PostfixCommentLength>0&&this._buffer.Add(this._pads.Comment,p.PostfixComment,this._pads.Spaces(f.PostfixCommentLength-p.PostfixCommentLength)),y||(g?this._buffer.Add(this._pads.Comma):m&&this._buffer.Add(this._pads.DummyComma))}InlineTableRawArray(f,p){this._buffer.Add(this._pads.ArrStart(f.PadType));for(let g=0;g<f.Children.length;++g){const m=g===f.Children.length-1,y=g===p.Children.length-1,b=g>=p.Children.length,C=f.Children[g];b?(this._buffer.Add(this._pads.Spaces(C.TotalLength)),m||this._buffer.Add(this._pads.DummyComma)):(this.InlineTableRowSegment(C,p.Children[g],!y,!1),y&&!m&&this._buffer.Add(this._pads.DummyComma))}this._buffer.Add(this._pads.ArrEnd(f.PadType))}InlineTableRawObject(f,p){function g(b){return p.Children.find(C=>C.Name===b.LocationInParent)}const m=f.Children.map(b=>({tt:b,ji:g(b)}));let y=m.length-1;for(;y>=0&&!m[y].ji;)y-=1;this._buffer.Add(this._pads.ObjStart(f.PadType));for(let b=0;b<m.length;++b){const C=m[b].tt,x=m[b].ji,v=b===y,w=b===m.length-1;x?(this.InlineTableRowSegment(C,x,!v,!1),v&&!w&&this._buffer.Add(this._pads.DummyComma)):(this._buffer.Add(this._pads.Spaces(C.TotalLength)),w||this._buffer.Add(this._pads.DummyComma))}this._buffer.Add(this._pads.ObjEnd(f.PadType))}AvailableLineSpace(f){return Math.min(this.Options.MaxInlineLength,this.Options.MaxTotalLineLength-this._pads.PrefixStringLen-this.Options.IndentSpaces*f)}MinifyItem(f,p){const g=`
`;if(this._buffer.Add(f.PrefixComment),f.Name.length>0&&this._buffer.Add(f.Name,":"),f.MiddleComment.indexOf(g)>=0){const m=Fs.NormalizeMultilineComment(f.MiddleComment,Number.MAX_VALUE);for(const y of m)this._buffer.Add(y,g)}else this._buffer.Add(f.MiddleComment);if(f.Type===s.JsonItemType.Array||f.Type===s.JsonItemType.Object){let m;f.Type===s.JsonItemType.Array?(this._buffer.Add("["),m="]"):(this._buffer.Add("{"),m="}");let y=!1,b=!1;for(const C of f.Children)Fs.IsCommentOrBlankLine(C.Type)||(y&&this._buffer.Add(","),y=!0),b=this.MinifyItem(C,b);this._buffer.Add(m)}else{if(f.Type===s.JsonItemType.BlankLine)return p||this._buffer.Add(g),this._buffer.Add(g),!0;if(f.Type===s.JsonItemType.LineComment)return p||this._buffer.Add(g),this._buffer.Add(f.Value,g),!0;if(f.Type===s.JsonItemType.BlockComment){if(p||this._buffer.Add(g),f.Value.indexOf(g)>=0){const m=Fs.NormalizeMultilineComment(f.Value,f.InputPosition.Column);for(const y of m)this._buffer.Add(y,g);return!0}return this._buffer.Add(f.Value,g),!0}else this._buffer.Add(f.Value)}return this._buffer.Add(f.PostfixComment),f.PostfixComment.length>0&&f.IsPostCommentLineStyle?(this._buffer.Add(g),!0):!1}static GetPaddingType(f){return f.Children.length===0?i.BracketPaddingType.Empty:f.Complexity>=2?i.BracketPaddingType.Complex:i.BracketPaddingType.Simple}static NormalizeMultilineComment(f,p){const m=f.replace(/\r/g,"").split(`
`).filter(y=>y.length>0);for(let y=1;y<m.length;++y){const b=m[y];let C=0;for(;C<b.length&&C<p&&/\s/.test(b[C]);)C+=1;m[y]=b.substring(C)}return m}static IndexOfLastElement(f){for(let p=f.length-1;p>=0;--p)if(!this.IsCommentOrBlankLine(f[p].Type))return p;return-1}static IsCommentOrBlankLine(f){return f===s.JsonItemType.BlankLine||f===s.JsonItemType.BlockComment||f===s.JsonItemType.LineComment}};return Wh.Formatter=d,Wh}var OE;function Bwe(){return OE||(OE=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Formatter=e.FracturedJsonError=e.NumberListAlignment=e.EolStyle=e.CommentPolicy=e.FracturedJsonOptions=void 0;var t=k_();Object.defineProperty(e,"FracturedJsonOptions",{enumerable:!0,get:function(){return t.FracturedJsonOptions}});var n=S_();Object.defineProperty(e,"CommentPolicy",{enumerable:!0,get:function(){return n.CommentPolicy}});var s=w_();Object.defineProperty(e,"EolStyle",{enumerable:!0,get:function(){return s.EolStyle}});var i=j_();Object.defineProperty(e,"NumberListAlignment",{enumerable:!0,get:function(){return i.NumberListAlignment}});var o=Ld();Object.defineProperty(e,"FracturedJsonError",{enumerable:!0,get:function(){return o.FracturedJsonError}});var a=Fwe();Object.defineProperty(e,"Formatter",{enumerable:!0,get:function(){return a.Formatter}})}(Nv)),Nv}var $we=Bwe();const Vwe=new $we.Formatter,zwe=li({overflowX:"scroll",overflowY:"scroll"}).options,Gwe=vo("pre"),Hwe=e=>{const{label:t,data:n,fileName:s,withDownload:i=!0,withCopy:o=!0,extraCopyActions:a,...l}=e,c=u.useMemo(()=>(zf(n)?n:Vwe.Serialize(n))??"",[n]),d=tl(),h=il(),f=u.useCallback(()=>{h.writeText(c)},[h,c]),p=u.useCallback(()=>{const m=new Blob([c]),y=document.createElement("a");y.href=URL.createObjectURL(m),y.download=`${s||t}.json`,document.body.appendChild(y),y.click(),y.remove()},[c,t,s]),{t:g}=A();return r.jsxs(T,{bg:"base.800",borderRadius:"base",flexGrow:1,w:"full",h:"full",position:"relative",...l,children:[r.jsx(Se,{position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"auto",p:2,fontSize:"sm",children:r.jsx(ps,{defer:!0,style:Wwe,options:zwe,children:r.jsx(Gwe,{whiteSpace:"pre-wrap",children:c})})}),r.jsxs(T,{position:"absolute",top:0,insetInlineEnd:0,p:2,children:[i&&r.jsx(Ee,{label:`${g("gallery.download")} ${t} JSON`,children:r.jsx(oe,{"aria-label":`${g("gallery.download")} ${t} JSON`,icon:r.jsx(md,{size:16}),variant:"ghost",opacity:.7,onClick:p})}),o&&r.jsx(Ee,{label:`${g("gallery.copy")} ${t} JSON`,children:r.jsx(oe,{"aria-label":`${g("gallery.copy")} ${t} JSON`,icon:r.jsx(un,{size:16}),variant:"ghost",opacity:.7,onClick:f})}),d&&(a==null?void 0:a.map(({label:m,getData:y})=>r.jsx(Uwe,{label:m,getData:y,data:n},m)))]})]})},yo=u.memo(Hwe),Wwe={height:"100%",width:"100%"},Uwe=({label:e,data:t,getData:n})=>{const{t:s}=A(),i=il(),o=u.useCallback(()=>{i.writeText(JSON.stringify(n(t),null,2))},[i,t,n]);return r.jsx(Ee,{label:`${s("gallery.copy")} ${e} JSON`,children:r.jsx(oe,{"aria-label":`${s("gallery.copy")} ${e} JSON`,icon:r.jsx(un,{size:16}),variant:"ghost",opacity:.7,onClick:o})})},qwe=({image:e})=>{const{t}=A(),{currentData:n}=vV(e),s=u.useMemo(()=>{if(n!=null&&n.graph)try{return JSON.parse(n.graph)}catch{return null}return null},[n]);return s?r.jsx(yo,{fileName:`${e.image_name.replace(".png","")}_graph`,data:s,label:t("nodes.graph")}):r.jsx(Pt,{label:t("nodes.noGraph")})},Kwe=u.memo(qwe),Zwe=()=>{const{t:e}=A();return r.jsx(q,{children:e("common.loading")})},Ywe=()=>{const{t:e}=A();return r.jsx(q,{children:e("metadata.parsingFailed")})},SV=(e,t)=>{const[n,s]=u.useState(Rc),[i,o]=u.useState(null);u.useEffect(()=>{(()=>{t.parse(e).then(p=>{s(p)}).catch(()=>{s(xl)})})()},[t,e]);const a=u.useMemo(()=>n===Rc||n===xl,[n]),l=u.useMemo(()=>t.getLabel(),[t]);u.useEffect(()=>{(()=>{if(n===Rc){o(null);return}if(n===xl){o(null);return}t.renderValue(n).then(p=>{o(p)}).catch(()=>{})})()},[t,n]);const c=u.useMemo(()=>n===Rc?r.jsx(Zwe,{}):n===xl?r.jsx(Ywe,{}):r.jsx(q,{children:i}),[i,n]),d=u.useCallback(()=>{if(!t.recall||n===Rc||n===xl)return null;t.recall(n,!0).catch(()=>{})},[t,n]),h=u.useMemo(()=>n===Rc||n===xl?null:n,[n]);return{label:l,isDisabled:a,value:n,renderedValue:c,onRecall:d,valueOrNull:h}},jV=u.memo(({label:e,...t})=>{const{t:n}=A();return r.jsx(Ee,{label:n("metadata.recallParameter",{label:e}),children:r.jsx(oe,{"aria-label":n("metadata.recallParameter",{label:e}),icon:r.jsx(NR,{}),size:"xs",variant:"ghost",...t})})});jV.displayName="RecallButton";const I_=u.memo(({label:e,onRecall:t,isDisabled:n,renderedValue:s,direction:i="row"})=>r.jsxs(T,{gap:2,children:[t&&r.jsx(jV,{label:e,onClick:t,isDisabled:n}),r.jsxs(T,{direction:i,fontSize:"sm",children:[r.jsxs(q,{fontWeight:"semibold",whiteSpace:"pre-wrap",pr:2,children:[e,":"]}),s]})]}));I_.displayName="MetadataItemView";const Xwe=Wp(({metadata:e,handlers:t,direction:n="row"})=>{const{label:s,isDisabled:i,value:o,renderedValue:a,onRecall:l}=SV(e,t);return o===xl||t.getIsVisible&&!eee(o)&&!t.getIsVisible(o)?null:r.jsx(I_,{label:s,onRecall:l,isDisabled:i,renderedValue:a,direction:n})}),Gt=Wp(Xwe);Gt.displayName="MetadataItem";const Qwe=({metadata:e})=>{const[t,n]=u.useState([]);u.useEffect(()=>{(async()=>{try{const o=await pt.loras.parse(e);n(o)}catch{n([])}})()},[e]);const s=u.useMemo(()=>pt.loras.getLabel(),[]);return r.jsx(r.Fragment,{children:t.map(i=>r.jsx(Jwe,{label:s,lora:i,handlers:pt.loras},i.model.key))})},Jwe=({label:e,lora:t,handlers:n})=>{const s=u.useCallback(()=>{n.recallItem&&n.recallItem(t,!0).catch(()=>{})},[n,t]),[i,o]=u.useState(null);return u.useEffect(()=>{(async()=>{if(!n.renderItemValue){o(null);return}const l=await n.renderItemValue(t);o(l)})()},[n,t]),r.jsx(I_,{label:e,isDisabled:!1,onRecall:s,renderedValue:i})},eSe=e=>{const t=I(An),{metadata:n}=e;return!n||Object.keys(n).length===0?null:r.jsxs(T,{flexDir:"column",pl:8,children:[r.jsx(Gt,{metadata:n,handlers:pt.generationMode}),r.jsx(Gt,{metadata:n,handlers:pt.positivePrompt,direction:"column"}),r.jsx(Gt,{metadata:n,handlers:pt.negativePrompt,direction:"column"}),r.jsx(Gt,{metadata:n,handlers:pt.sdxlPositiveStylePrompt,direction:"column"}),r.jsx(Gt,{metadata:n,handlers:pt.sdxlNegativeStylePrompt,direction:"column"}),r.jsx(Gt,{metadata:n,handlers:pt.model}),r.jsx(Gt,{metadata:n,handlers:pt.vae}),r.jsx(Gt,{metadata:n,handlers:pt.width}),r.jsx(Gt,{metadata:n,handlers:pt.height}),r.jsx(Gt,{metadata:n,handlers:pt.seed}),r.jsx(Gt,{metadata:n,handlers:pt.steps}),r.jsx(Gt,{metadata:n,handlers:pt.scheduler}),r.jsx(Gt,{metadata:n,handlers:pt.cfgScale}),r.jsx(Gt,{metadata:n,handlers:pt.cfgRescaleMultiplier}),r.jsx(Gt,{metadata:n,handlers:pt.guidance}),t!=="canvas"&&r.jsx(Gt,{metadata:n,handlers:pt.strength}),r.jsx(Gt,{metadata:n,handlers:pt.seamlessX}),r.jsx(Gt,{metadata:n,handlers:pt.seamlessY}),r.jsx(Gt,{metadata:n,handlers:pt.hrfEnabled}),r.jsx(Gt,{metadata:n,handlers:pt.hrfMethod}),r.jsx(Gt,{metadata:n,handlers:pt.hrfStrength}),r.jsx(Gt,{metadata:n,handlers:pt.refinerCFGScale}),r.jsx(Gt,{metadata:n,handlers:pt.refinerModel}),r.jsx(Gt,{metadata:n,handlers:pt.refinerNegativeAestheticScore}),r.jsx(Gt,{metadata:n,handlers:pt.refinerPositiveAestheticScore}),r.jsx(Gt,{metadata:n,handlers:pt.refinerScheduler}),r.jsx(Gt,{metadata:n,handlers:pt.refinerStart}),r.jsx(Gt,{metadata:n,handlers:pt.refinerSteps}),r.jsx(Qwe,{metadata:n})]})},tSe=u.memo(eSe),nSe=({image:e})=>{const{t}=A(),{currentData:n}=vV(e),s=u.useMemo(()=>{if(n!=null&&n.workflow)try{return JSON.parse(n.workflow)}catch{return null}return null},[n]);return s?r.jsx(yo,{fileName:`${e.image_name.replace(".png","")}_workflow`,data:s,label:t("metadata.workflow")}):r.jsx(Pt,{label:t("nodes.noWorkflow")})},sSe=u.memo(nSe),rSe=({image:e})=>{const{t}=A(),{metadata:n}=g9(e.image_name),s=SV(n,pt.createdBy);return r.jsxs(T,{layerStyle:"first",padding:4,gap:1,flexDirection:"column",width:"full",height:"full",borderRadius:"base",position:"absolute",overflow:"hidden",children:[r.jsx(sr,{href:e.image_url,label:e.image_name}),s.valueOrNull&&r.jsxs(q,{children:[t("metadata.createdBy"),": ",s.valueOrNull]}),r.jsxs(sc,{variant:"line",isLazy:!0,display:"flex",flexDir:"column",w:"full",h:"full",children:[r.jsxs(rc,{children:[r.jsx(_n,{children:t("metadata.recallParameters")}),r.jsx(_n,{children:t("metadata.metadata")}),r.jsx(_n,{children:t("metadata.imageDetails")}),r.jsx(_n,{children:t("metadata.workflow")}),r.jsx(_n,{children:t("nodes.graph")})]}),r.jsxs(sd,{children:[r.jsx(Rn,{children:n?r.jsx(os,{children:r.jsx(tSe,{metadata:n})}):r.jsx(Pt,{label:t("metadata.noRecallParameters")})}),r.jsx(Rn,{children:n?r.jsx(yo,{fileName:`${e.image_name.replace(".png","")}_metadata`,data:n,label:t("metadata.metadata")}):r.jsx(Pt,{label:t("metadata.noMetaData")})}),r.jsx(Rn,{children:e?r.jsx(yo,{fileName:`${e.image_name.replace(".png","")}_details`,data:e,label:t("metadata.imageDetails")}):r.jsx(Pt,{label:t("metadata.noImageDetails")})}),r.jsx(Rn,{children:r.jsx(sSe,{image:e})}),r.jsx(Rn,{children:r.jsx(Kwe,{image:e})})]})]})]})},iSe=u.memo(rSe),T_=()=>{const e=I(od),t=oc(e);return{imageDTOs:u.useMemo(()=>{var s;return((s=t.data)==null?void 0:s.items)??Ls},[t.data]),queryResult:t}},pw="gallery-grid",kV=u.memo(({imageDTOs:e})=>{const{t}=A();return r.jsxs(T,{w:I1,h:I1,alignItems:"center",justifyContent:"center",flexDir:"column",bg:"base.900",borderRadius:"base",children:[r.jsx(Ft,{children:e.length}),r.jsx(Ft,{size:"sm",children:t("parameters.images")})]})});kV.displayName="DndDragPreviewMultipleImage";const oSe=e=>mc.createPortal(r.jsx(kV,{imageDTOs:e.imageDTOs}),e.container),aSe=({multipleImageDndData:e,onGenerateDragPreviewArgs:t,setDragPreviewState:n})=>{const{nativeSetDragImage:s,source:i,location:o}=t;pV({render({container:a}){return n({type:"multiple-image",container:a,imageDTOs:e.payload.imageDTOs}),()=>n(null)},nativeSetDragImage:s,getOffset:gV({element:i.element,input:o.current.input})})},lSe={minW:0,svg:{transitionProperty:"common",transitionDuration:"normal",fill:"base.100",_hover:{fill:"base.50"},filter:`drop-shadow(0px 0px 0.1rem var(--invoke-colors-base-900))
      drop-shadow(0px 0px 0.3rem var(--invoke-colors-base-900))
      drop-shadow(0px 0px 0.3rem var(--invoke-colors-base-900))`}},ea=u.memo(e=>{const{onClick:t,tooltip:n,icon:s,...i}=e;return r.jsx(oe,{onClick:t,"aria-label":n,icon:s,variant:"link",sx:lSe,"data-testid":n,...i})});ea.displayName="DndImageIcon";const _V=u.memo(({imageDTO:e})=>{const t=tl(),{t:n}=A(),s=G(),i=u.useCallback(o=>{o.stopPropagation(),e&&s(Pp([e]))},[s,e]);return t?r.jsx(ea,{onClick:i,icon:r.jsx(hb,{}),tooltip:n("gallery.deleteImage_one"),position:"absolute",bottom:2,insetInlineEnd:2}):null});_V.displayName="GalleryImageDeleteIconButton";const IV=u.memo(({imageDTO:e})=>{const t=Nt(),{t:n}=A(),s=u.useCallback(()=>{t.openImageInViewer(e)},[e,t]);return r.jsx(ea,{onClick:s,icon:r.jsx(ob,{}),tooltip:n("gallery.openInViewer"),position:"absolute",insetBlockStart:2,insetInlineStart:2})});IV.displayName="GalleryImageOpenInViewerIconButton";const TV=u.memo(({imageDTO:e})=>r.jsx(q,{className:"gallery-image-size-badge",position:"absolute",background:"base.900",color:"base.50",fontSize:"sm",fontWeight:"semibold",bottom:1,left:1,opacity:.7,px:2,lineHeight:1.25,borderTopEndRadius:"base",pointerEvents:"none",children:`${e.width}x${e.height}`}));TV.displayName="GalleryImageSizeBadge";const AV=u.memo(({imageDTO:e})=>{const t=ae(gS),[n]=mS(),[s]=yS(),i=u.useCallback(()=>{e.starred?s({imageDTOs:[e]}):n({imageDTOs:[e]})},[n,s,e]);return t?r.jsx(ea,{onClick:i,icon:e.starred?t.on.icon:t.off.icon,tooltip:e.starred?t.on.text:t.off.text,position:"absolute",top:2,insetInlineEnd:2}):r.jsx(ea,{onClick:i,icon:e.starred?r.jsx(db,{}):r.jsx($j,{}),tooltip:e.starred?"Unstar":"Star",position:"absolute",top:2,insetInlineEnd:2})});AV.displayName="GalleryImageStarIconButton";const EV=u.memo(({imageDTO:e,isHovered:t})=>{const n=I(tee);return r.jsxs(r.Fragment,{children:[(t||n)&&r.jsx(TV,{imageDTO:e}),(t||e.starred)&&r.jsx(AV,{imageDTO:e}),t&&r.jsx(_V,{imageDTO:e}),t&&r.jsx(IV,{imageDTO:e})]})});EV.displayName="GalleryImageHoverIcons";const MV=e=>`gallery-image-${e}`,PV=u.memo(({width:e,height:t})=>r.jsx(oS,{w:`${e}px`,h:"auto",objectFit:"contain",aspectRatio:`${e}/${t}`}));PV.displayName="SizedSkeletonLoader";const A_="gallery-image-container",cSe={containerType:"inline-size",w:"full",h:"full",".gallery-image-size-badge":{"@container (max-width: 80px)":{"&":{display:"none"}}},"&[data-is-dragging=true]":{opacity:.3},".gallery-image":{touchAction:"none",userSelect:"none",webkitUserSelect:"none",position:"relative",justifyContent:"center",alignItems:"center",aspectRatio:"1/1","::before":{content:'""',display:"inline-block",position:"absolute",top:0,left:0,right:0,bottom:0,pointerEvents:"none",borderRadius:"base"},"&[data-selected=true]::before":{boxShadow:"inset 0px 0px 0px 3px var(--invoke-colors-invokeBlue-500), inset 0px 0px 0px 4px var(--invoke-colors-invokeBlue-800)"},"&[data-selected-for-compare=true]::before":{boxShadow:"inset 0px 0px 0px 3px var(--invoke-colors-invokeGreen-300), inset 0px 0px 0px 4px var(--invoke-colors-invokeGreen-800)"},"&:hover::before":{boxShadow:"inset 0px 0px 0px 1px var(--invoke-colors-invokeBlue-300), inset 0px 0px 0px 2px var(--invoke-colors-invokeBlue-800)"},"&:hover[data-selected=true]::before":{boxShadow:"inset 0px 0px 0px 3px var(--invoke-colors-invokeBlue-400), inset 0px 0px 0px 4px var(--invoke-colors-invokeBlue-800)"},"&:hover[data-selected-for-compare=true]::before":{boxShadow:"inset 0px 0px 0px 3px var(--invoke-colors-invokeGreen-200), inset 0px 0px 0px 4px var(--invoke-colors-invokeGreen-800)"}}},LV=u.memo(({imageDTO:e})=>{const t=dn(),[n,s]=u.useState(!1),[i,o]=u.useState(null),[a,l]=u.useState(null),c=u.useId(),d=u.useMemo(()=>fe(Tr,w=>{var S;return((S=w.imageToCompare)==null?void 0:S.image_name)===e.image_name}),[e.image_name]),h=I(d),f=u.useMemo(()=>fe(Tr,w=>{for(const S of w.selection)if(S.image_name===e.image_name)return!0;return!1}),[e.image_name]),p=I(f);u.useEffect(()=>{if(a)return qn(Pd(a),pd({element:a,getInitialData:()=>{const{gallery:w}=t.getState();return w.selection.length>1&&w.selection.find(({image_name:S})=>S===e.image_name)!==void 0?ni.getData({imageDTOs:w.selection,boardId:w.selectedBoardId}):In.getData({imageDTO:e},e.image_name)},onDragStart:({source:w})=>{if(In.typeGuard(w.data)){s(!0);return}},onGenerateDragPreview:w=>{ni.typeGuard(w.source.data)?aSe({multipleImageDndData:w.source.data,onGenerateDragPreviewArgs:w,setDragPreviewState:o}):In.typeGuard(w.source.data)&&xV({singleImageDndData:w.source.data,onGenerateDragPreviewArgs:w,setDragPreviewState:o})}}),to({onDragStart:({source:w})=>{ni.typeGuard(w.data)&&w.data.payload.imageDTOs.includes(e)&&s(!0)},onDrop:()=>{s(!1)}}))},[e,a,t,c]);const[g,m]=u.useState(!1),y=u.useCallback(()=>{m(!0)},[]),b=u.useCallback(()=>{m(!1)},[]),C=u.useCallback(w=>{t.dispatch(nee({imageDTO:e,shiftKey:w.shiftKey,ctrlKey:w.ctrlKey,metaKey:w.metaKey,altKey:w.altKey}))},[e,t]),x=u.useCallback(()=>{fS.set(!0),t.dispatch(Op(null))},[t]),v=u.useMemo(()=>MV(e.image_name),[e.image_name]);return aO(e,a),r.jsxs(r.Fragment,{children:[r.jsx(Se,{className:A_,sx:cSe,"data-testid":v,"data-is-dragging":n,children:r.jsxs(T,{role:"button",className:"gallery-image",onMouseOver:y,onMouseOut:b,onClick:C,onDoubleClick:x,"data-selected":p,"data-selected-for-compare":h,children:[r.jsx(Wt,{ref:l,src:e.thumbnail_url,fallback:r.jsx(PV,{width:e.width,height:e.height}),w:e.width,objectFit:"contain",maxW:"full",maxH:"full",borderRadius:"base"}),r.jsx(EV,{imageDTO:e,isHovered:g})]})}),(i==null?void 0:i.type)==="multiple-image"?oSe(i):null,(i==null?void 0:i.type)==="single-image"?bV(i):null]})});LV.displayName="GalleryImage";const uSe=Oe({}),dSe=(e,t)=>e.top>=t.top&&e.bottom<=t.bottom&&e.left>=t.left&&e.right<=t.right,hSe=(e,t)=>e>(t.endIndex-t.startIndex)/2+t.startIndex?"end":"start",T1=()=>{const e=document.querySelector(`.${A_}`),t=document.querySelector(`.${pw}`);if(!e||!t)return 0;const n=t.parentElement;if(!n)return 0;const s=e.getBoundingClientRect(),i=n.getBoundingClientRect(),o=window.getComputedStyle(t),a=parseFloat(o.gap);if(!s.width||!s.height||!i.width||!i.height)return 0;let l=0,c=0;for(;c+s.width<=i.width+1;)l++,c+=s.width,c+a<=i.width&&(c+=a);return l},fSe=(e,t)=>{var d,h,f;const n=uSe.get(),s=(d=n.virtuosoRangeRef)==null?void 0:d.current,i=(h=n.rootRef)==null?void 0:h.current,o=(f=n.virtuosoRef)==null?void 0:f.current;if(!s||!o||!i)return;const a=document.querySelector(`[data-testid="${MV(e)}"]`),l=a==null?void 0:a.getBoundingClientRect(),c=i.getBoundingClientRect();(!l||!dSe(l,c))&&o.scrollToIndex({index:t,align:hSe(t,s)})},pSe=(e,t)=>{const n=uo(t-1,0,e.length-1),s=e[n];return{index:n,image:s}},gSe=(e,t)=>{const n=uo(t+1,0,e.length-1),s=e[n];return{index:n,image:s}},mSe=(e,t)=>{const n=T1(),i=t<n?t:uo(t-n,0,e.length-1),o=e[i];return{index:i,image:o}},ySe=(e,t)=>{const n=T1(),i=t<e.length-n?uo(t+n,0,e.length-1):t,o=e[i];return{index:i,image:o}},bSe={left:pSe,right:gSe,up:mSe,down:ySe},DV=()=>{const e=G(),t=see(),n=u.useMemo(()=>fe(Lp,ree,(w,S)=>t?S??w:w),[t]),s=I(n),{imageDTOs:i}=T_(),o=u.useMemo(()=>i.length,[i.length]),a=u.useMemo(()=>i.length===0||!s?0:i.findIndex(w=>w.image_name===s.image_name),[i,s]),l=u.useCallback((w,S)=>{const{index:j,image:P}=bSe[w](i,a);!P||j===a||(e(S?Op(P):CM(P)),fSe(P.image_name,j))},[i,a,e]),c=u.useMemo(()=>a===0,[a]),d=u.useMemo(()=>a===o-1,[a,o]),h=u.useMemo(()=>a<T1(),[a]),f=u.useMemo(()=>a>=o-T1(),[a,o]),p=u.useMemo(()=>a===0,[a]),g=u.useMemo(()=>a===o-1,[a,o]),m=u.useCallback(w=>{l("left",w)},[l]),y=u.useCallback(w=>{l("right",w)},[l]),b=u.useCallback(w=>{l("up",w)},[l]),C=u.useCallback(w=>{l("down",w)},[l]),x=u.useCallback(()=>{y()},[y]),v=u.useCallback(()=>{m()},[m]);return{handleLeftImage:m,handleRightImage:y,handleUpImage:b,handleDownImage:C,isOnFirstImage:c,isOnLastImage:d,isOnFirstRow:h,isOnLastRow:f,nextImage:x,prevImage:v,isOnFirstImageOfView:p,isOnLastImageOfView:g}},yf=(e,t)=>{const n=t-e+1;return Array.from({length:n},(s,i)=>i+e)},yu="ellipsis",xSe=(e,t,n)=>{const s=Math.min(2*n+5,t),i=1,o=t,a=Math.max(e-n,i),l=Math.min(e+n,o),c=a>i+1,d=l<o-1,h=s-2;if(!c&&d)return[...yf(1,h),yu,o];if(c&&!d){const p=yf(o-h+1,o);return[i,yu,...p]}if(c&&d){const p=yf(a,l);return[i,yu,...p,yu,o]}return yf(i,o)},vSe=fe(Tr,e=>e.offset),CSe=fe(Tr,e=>e.limit),Fb=()=>{const e=G(),t=I(vSe),n=I(CSe),s=I(od),{count:i,total:o}=oc(s,{selectFromResult:({data:b})=>({count:(b==null?void 0:b.items.length)??0,total:(b==null?void 0:b.total)??0})}),a=u.useMemo(()=>Math.ceil(t/(n||0)),[t,n]),l=u.useMemo(()=>Math.ceil(o/(n||0)),[o,n]),c=u.useMemo(()=>i?a+1<l:!1,[i,a,l]),d=u.useMemo(()=>i?t>0:!1,[i,t]),h=u.useCallback(b=>{e(wM(b))},[e]),f=u.useMemo(()=>Z2(h,500),[h]),p=u.useCallback(b=>{f({offset:t+(n||0),withHotkey:b})},[f,t,n]),g=u.useCallback(b=>{f({offset:Math.max(t-(n||0),0),withHotkey:b})},[f,t,n]),m=u.useCallback(b=>{f({offset:b*(n||0)})},[f,n]);u.useEffect(()=>{l&&a+1>l&&f({offset:(l-1)*(n||0)})},[a,l,f,n]);const y=u.useMemo(()=>l>7?xSe(a+1,l,1):yf(1,l),[a,l]);return{goPrev:g,goNext:p,isPrevEnabled:d,isNextEnabled:c,pageButtons:y,goToPage:m,currentPage:a,total:o,pages:l}},wSe=({inset:e=8})=>{const{t}=A(),{prevImage:n,nextImage:s,isOnFirstImageOfView:i,isOnLastImageOfView:o}=DV(),{isFetching:a}=T_().queryResult,{isNextEnabled:l,goNext:c,isPrevEnabled:d,goPrev:h}=Fb(),f=u.useMemo(()=>!!(!i||d),[i,d]),p=u.useCallback(()=>{i?d&&!a&&h("arrow"):n()},[h,a,i,d,n]),g=u.useMemo(()=>!!(!o||l),[l,o]),m=u.useCallback(()=>{o?l&&!a&&c("arrow"):s()},[c,a,l,o,s]);return r.jsxs(Se,{pos:"relative",h:"full",w:"full",children:[f&&r.jsx(oe,{position:"absolute",top:"50%",transform:"translate(0, -50%)","aria-label":t("accessibility.previousImage"),icon:r.jsx(Nj,{size:64}),variant:"unstyled",onClick:p,isDisabled:a,color:"base.100",pointerEvents:"auto",insetInlineStart:e}),g&&r.jsx(oe,{position:"absolute",top:"50%",transform:"translate(0, -50%)","aria-label":t("accessibility.nextImage"),icon:r.jsx(ab,{size:64}),variant:"unstyled",onClick:m,isDisabled:a,color:"base.100",pointerEvents:"auto",insetInlineEnd:e})]})},RV=u.memo(wSe),SSe=fe(yy,e=>e.shouldAntialiasProgressImage),jSe=()=>{const e=ae(iee),t=ae(VP),n=I(SSe),s=u.useMemo(()=>({imageRendering:n?"auto":"pixelated"}),[n]);return!e||t?null:r.jsx(Wt,{src:e.dataURL,width:e.width,height:e.height,draggable:!1,"data-testid":"progress-image",objectFit:"contain",maxWidth:"full",maxHeight:"full",position:"absolute",borderRadius:"base",sx:s})},kSe=u.memo(jSe),_Se=()=>{const e=I(xD),t=I(oee),{currentData:n}=nl(t??Xn),[s,i]=u.useState(!1),o=u.useRef(0),a=u.useCallback(()=>{i(!0),window.clearTimeout(o.current)},[]),l=u.useCallback(()=>{o.current=window.setTimeout(()=>{i(!1)},500)},[]);return r.jsxs(T,{onMouseOver:a,onMouseOut:l,width:"full",height:"full",alignItems:"center",justifyContent:"center",position:"relative",children:[r.jsx(OV,{imageDTO:n}),r.jsxs(T,{flexDir:"column",gap:2,position:"absolute",top:0,insetInlineStart:0,pointerEvents:"none",alignItems:"flex-start",children:[r.jsx($ve,{}),r.jsx(C_,{})]}),e&&n&&r.jsx(Se,{position:"absolute",opacity:.8,top:0,width:"full",height:"full",borderRadius:"base",children:r.jsx(iSe,{image:n})}),r.jsx(WF,{children:s&&n&&r.jsx(Se,{as:s_.div,initial:TSe,animate:ASe,exit:ESe,position:"absolute",top:0,right:0,bottom:0,left:0,pointerEvents:"none",children:r.jsx(RV,{})},"nextPrevButtons")})]})},ISe=u.memo(_Se),OV=u.memo(({imageDTO:e})=>{const t=ae(aee),n=ae(VP),s=I(uj);return t&&!n&&s?r.jsx(kSe,{}):e?r.jsx(T,{w:"full",h:"full",position:"absolute",alignItems:"center",justifyContent:"center",children:r.jsx(ul,{imageDTO:e})}):r.jsx(J7,{})});OV.displayName="ImageContent";const TSe={opacity:0},ASe={opacity:1,transition:{duration:.07}},ESe={opacity:0,transition:{duration:.07}},NV=e=>{e.preventDefault()},Yl=u.memo(({type:e,...t})=>{const{t:n}=A();return r.jsx(q,{position:"absolute",bottom:4,insetInlineEnd:e==="first"?void 0:4,insetInlineStart:e==="first"?4:void 0,textOverflow:"clip",whiteSpace:"nowrap",filter:JC,color:"base.50",transitionDuration:"0.2s",transitionProperty:"common",...t,children:n(e==="first"?"gallery.viewerImage":"gallery.compareImage")})});Yl.displayName="ImageComparisonLabel";const FV=u.memo(({firstImage:e,secondImage:t,containerDims:n})=>{const s=I(AS),i=u.useRef(null),o=Ty(!1),a=u.useMemo(()=>mB(n,e),[n,e]),l=u.useMemo(()=>yB(s,a,e,t),[s,a,e,t]);return r.jsx(T,{w:"full",h:"full",maxW:"full",maxH:"full",position:"relative",alignItems:"center",justifyContent:"center",children:r.jsx(T,{id:"image-comparison-wrapper",w:"full",h:"full",maxW:"full",maxH:"full",position:"absolute",alignItems:"center",justifyContent:"center",children:r.jsxs(Se,{ref:i,position:"relative",id:"image-comparison-hover-image-container",w:a.width,h:a.height,maxW:"full",maxH:"full",userSelect:"none",overflow:"hidden",borderRadius:"base",children:[r.jsx(Wt,{id:"image-comparison-hover-first-image",src:e.image_url,fallbackSrc:e.thumbnail_url,w:a.width,h:a.height,maxW:"full",maxH:"full",objectFit:"cover",objectPosition:"top left"}),r.jsx(Yl,{type:"first",opacity:o.isTrue?0:1}),r.jsxs(Se,{id:"image-comparison-hover-second-image-container",position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"hidden",opacity:o.isTrue?1:0,transitionDuration:"0.2s",transitionProperty:"common",children:[r.jsx(Se,{id:"image-comparison-hover-bg",position:"absolute",top:0,left:0,right:0,bottom:0,backgroundImage:Md,backgroundRepeat:"repeat"}),r.jsx(Wt,{position:"relative",id:"image-comparison-hover-second-image",src:t.image_url,fallbackSrc:t.thumbnail_url,w:l.width,h:l.height,maxW:a.width,maxH:a.height,objectFit:s,objectPosition:"top left"}),r.jsx(Yl,{type:"second",opacity:o.isTrue?1:0})]}),r.jsx(Se,{id:"image-comparison-hover-interaction-overlay",position:"absolute",top:0,right:0,bottom:0,left:0,onMouseOver:o.setTrue,onMouseOut:o.setFalse,onContextMenu:NV,userSelect:"none"})]})})})});FV.displayName="ImageComparisonHover";const{createElement:Ku,createContext:MSe,forwardRef:BV,useCallback:Zs,useContext:$V,useEffect:Gl,useImperativeHandle:VV,useLayoutEffect:PSe,useMemo:LSe,useRef:Qs,useState:Iu}=ES,NE=ES[`useId${Math.random()}`.slice(0,5)],DSe=PSe,Bb=MSe(null);Bb.displayName="PanelGroupContext";const Hl=DSe,RSe=typeof NE=="function"?NE:()=>null;let OSe=0;function E_(e=null){const t=RSe(),n=Qs(e||t||null);return n.current===null&&(n.current=""+OSe++),e??n.current}function zV({children:e,className:t="",collapsedSize:n,collapsible:s,defaultSize:i,forwardedRef:o,id:a,maxSize:l,minSize:c,onCollapse:d,onExpand:h,onResize:f,order:p,style:g,tagName:m="div",...y}){const b=$V(Bb);if(b===null)throw Error("Panel components must be rendered within a PanelGroup container");const{collapsePanel:C,expandPanel:x,getPanelSize:v,getPanelStyle:w,groupId:S,isPanelCollapsed:j,reevaluatePanelConstraints:P,registerPanel:E,resizePanel:D,unregisterPanel:M}=b,R=E_(a),F=Qs({callbacks:{onCollapse:d,onExpand:h,onResize:f},constraints:{collapsedSize:n,collapsible:s,defaultSize:i,maxSize:l,minSize:c},id:R,idIsFromProps:a!==void 0,order:p});Qs({didLogMissingDefaultSizeWarning:!1}),Hl(()=>{const{callbacks:L,constraints:O}=F.current,B={...O};F.current.id=R,F.current.idIsFromProps=a!==void 0,F.current.order=p,L.onCollapse=d,L.onExpand=h,L.onResize=f,O.collapsedSize=n,O.collapsible=s,O.defaultSize=i,O.maxSize=l,O.minSize=c,(B.collapsedSize!==O.collapsedSize||B.collapsible!==O.collapsible||B.maxSize!==O.maxSize||B.minSize!==O.minSize)&&P(F.current,B)}),Hl(()=>{const L=F.current;return E(L),()=>{M(L)}},[p,R,E,M]),VV(o,()=>({collapse:()=>{C(F.current)},expand:L=>{x(F.current,L)},getId(){return R},getSize(){return v(F.current)},isCollapsed(){return j(F.current)},isExpanded(){return!j(F.current)},resize:L=>{D(F.current,L)}}),[C,x,v,j,R,D]);const _=w(F.current,i);return Ku(m,{...y,children:e,className:t,id:a,style:{..._,...g},"data-panel":"","data-panel-collapsible":s||void 0,"data-panel-group-id":S,"data-panel-id":R,"data-panel-size":parseFloat(""+_.flexGrow).toFixed(1)})}const ao=BV((e,t)=>Ku(zV,{...e,forwardedRef:t}));zV.displayName="Panel";ao.displayName="forwardRef(Panel)";let gw=null,Ll=null;function NSe(e,t){if(t){const n=(t&qV)!==0,s=(t&KV)!==0,i=(t&ZV)!==0,o=(t&YV)!==0;if(n)return i?"se-resize":o?"ne-resize":"e-resize";if(s)return i?"sw-resize":o?"nw-resize":"w-resize";if(i)return"s-resize";if(o)return"n-resize"}switch(e){case"horizontal":return"ew-resize";case"intersection":return"move";case"vertical":return"ns-resize"}}function FSe(){Ll!==null&&(document.head.removeChild(Ll),gw=null,Ll=null)}function Hv(e,t){const n=NSe(e,t);gw!==n&&(gw=n,Ll===null&&(Ll=document.createElement("style"),document.head.appendChild(Ll)),Ll.innerHTML=`*{cursor: ${n}!important;}`)}function GV(e){return e.type==="keydown"}function HV(e){return e.type.startsWith("pointer")}function WV(e){return e.type.startsWith("mouse")}function $b(e){if(HV(e)){if(e.isPrimary)return{x:e.clientX,y:e.clientY}}else if(WV(e))return{x:e.clientX,y:e.clientY};return{x:1/0,y:1/0}}function BSe(){if(typeof matchMedia=="function")return matchMedia("(pointer:coarse)").matches?"coarse":"fine"}function $Se(e,t,n){return e.x<t.x+t.width&&e.x+e.width>t.x&&e.y<t.y+t.height&&e.y+e.height>t.y}function VSe(e,t){if(e===t)throw new Error("Cannot compare node with itself");const n={a:$E(e),b:$E(t)};let s;for(;n.a.at(-1)===n.b.at(-1);)e=n.a.pop(),t=n.b.pop(),s=e;bt(s,"Stacking order can only be calculated for elements with a common ancestor");const i={a:BE(FE(n.a)),b:BE(FE(n.b))};if(i.a===i.b){const o=s.childNodes,a={a:n.a.at(-1),b:n.b.at(-1)};let l=o.length;for(;l--;){const c=o[l];if(c===a.a)return 1;if(c===a.b)return-1}}return Math.sign(i.a-i.b)}const zSe=/\b(?:position|zIndex|opacity|transform|webkitTransform|mixBlendMode|filter|webkitFilter|isolation)\b/;function GSe(e){var t;const n=getComputedStyle((t=UV(e))!==null&&t!==void 0?t:e).display;return n==="flex"||n==="inline-flex"}function HSe(e){const t=getComputedStyle(e);return!!(t.position==="fixed"||t.zIndex!=="auto"&&(t.position!=="static"||GSe(e))||+t.opacity<1||"transform"in t&&t.transform!=="none"||"webkitTransform"in t&&t.webkitTransform!=="none"||"mixBlendMode"in t&&t.mixBlendMode!=="normal"||"filter"in t&&t.filter!=="none"||"webkitFilter"in t&&t.webkitFilter!=="none"||"isolation"in t&&t.isolation==="isolate"||zSe.test(t.willChange)||t.webkitOverflowScrolling==="touch")}function FE(e){let t=e.length;for(;t--;){const n=e[t];if(bt(n,"Missing node"),HSe(n))return n}return null}function BE(e){return e&&Number(getComputedStyle(e).zIndex)||0}function $E(e){const t=[];for(;e;)t.push(e),e=UV(e);return t}function UV(e){const{parentNode:t}=e;return t&&t instanceof ShadowRoot?t.host:t}const qV=1,KV=2,ZV=4,YV=8,WSe=BSe()==="coarse";let ki=[],Tu=!1,ka=new Map,Vb=new Map;const fp=new Set;function USe(e,t,n,s,i){var o;const{ownerDocument:a}=t,l={direction:n,element:t,hitAreaMargins:s,setResizeHandlerState:i},c=(o=ka.get(a))!==null&&o!==void 0?o:0;return ka.set(a,c+1),fp.add(l),A1(),function(){var h;Vb.delete(e),fp.delete(l);const f=(h=ka.get(a))!==null&&h!==void 0?h:1;if(ka.set(a,f-1),A1(),f===1&&ka.delete(a),ki.includes(l)){const p=ki.indexOf(l);p>=0&&ki.splice(p,1),P_(),i("up",!0,null)}}}function VE(e){const{target:t}=e,{x:n,y:s}=$b(e);Tu=!0,M_({target:t,x:n,y:s}),A1(),ki.length>0&&(E1("down",e),e.preventDefault(),e.stopPropagation())}function tf(e){const{x:t,y:n}=$b(e);if(Tu&&e.buttons===0&&(Tu=!1,E1("up",e)),!Tu){const{target:s}=e;M_({target:s,x:t,y:n})}E1("move",e),P_(),ki.length>0&&e.preventDefault()}function $c(e){const{target:t}=e,{x:n,y:s}=$b(e);Vb.clear(),Tu=!1,ki.length>0&&e.preventDefault(),E1("up",e),M_({target:t,x:n,y:s}),P_(),A1()}function M_({target:e,x:t,y:n}){ki.splice(0);let s=null;e instanceof HTMLElement&&(s=e),fp.forEach(i=>{const{element:o,hitAreaMargins:a}=i,l=o.getBoundingClientRect(),{bottom:c,left:d,right:h,top:f}=l,p=WSe?a.coarse:a.fine;if(t>=d-p&&t<=h+p&&n>=f-p&&n<=c+p){if(s!==null&&document.contains(s)&&o!==s&&!o.contains(s)&&!s.contains(o)&&VSe(s,o)>0){let m=s,y=!1;for(;m&&!m.contains(o);){if($Se(m.getBoundingClientRect(),l)){y=!0;break}m=m.parentElement}if(y)return}ki.push(i)}})}function Wv(e,t){Vb.set(e,t)}function P_(){let e=!1,t=!1;ki.forEach(s=>{const{direction:i}=s;i==="horizontal"?e=!0:t=!0});let n=0;Vb.forEach(s=>{n|=s}),e&&t?Hv("intersection",n):e?Hv("horizontal",n):t?Hv("vertical",n):FSe()}function A1(){ka.forEach((e,t)=>{const{body:n}=t;n.removeEventListener("contextmenu",$c),n.removeEventListener("pointerdown",VE),n.removeEventListener("pointerleave",tf),n.removeEventListener("pointermove",tf)}),window.removeEventListener("pointerup",$c),window.removeEventListener("pointercancel",$c),fp.size>0&&(Tu?(ki.length>0&&ka.forEach((e,t)=>{const{body:n}=t;e>0&&(n.addEventListener("contextmenu",$c),n.addEventListener("pointerleave",tf),n.addEventListener("pointermove",tf))}),window.addEventListener("pointerup",$c),window.addEventListener("pointercancel",$c)):ka.forEach((e,t)=>{const{body:n}=t;e>0&&(n.addEventListener("pointerdown",VE,{capture:!0}),n.addEventListener("pointermove",tf))}))}function E1(e,t){fp.forEach(n=>{const{setResizeHandlerState:s}=n,i=ki.includes(n);s(e,i,t)})}function qSe(){const[e,t]=Iu(0);return Zs(()=>t(n=>n+1),[])}function bt(e,t){if(!e)throw console.error(t),Error(t)}const L_=10;function Xl(e,t,n=L_){return e.toFixed(n)===t.toFixed(n)?0:e>t?1:-1}function Vo(e,t,n=L_){return Xl(e,t,n)===0}function yr(e,t,n){return Xl(e,t,n)===0}function KSe(e,t,n){if(e.length!==t.length)return!1;for(let s=0;s<e.length;s++){const i=e[s],o=t[s];if(!yr(i,o,n))return!1}return!0}function bu({panelConstraints:e,panelIndex:t,size:n}){const s=e[t];bt(s!=null,`Panel constraints not found for index ${t}`);let{collapsedSize:i=0,collapsible:o,maxSize:a=100,minSize:l=0}=s;if(Xl(n,l)<0)if(o){const c=(i+l)/2;Xl(n,c)<0?n=i:n=l}else n=l;return n=Math.min(a,n),n=parseFloat(n.toFixed(L_)),n}function bf({delta:e,initialLayout:t,panelConstraints:n,pivotIndices:s,prevLayout:i,trigger:o}){if(yr(e,0))return t;const a=[...t],[l,c]=s;bt(l!=null,"Invalid first pivot index"),bt(c!=null,"Invalid second pivot index");let d=0;if(o==="keyboard"){{const f=e<0?c:l,p=n[f];bt(p,`Panel constraints not found for index ${f}`);const{collapsedSize:g=0,collapsible:m,minSize:y=0}=p;if(m){const b=t[f];if(bt(b!=null,`Previous layout not found for panel index ${f}`),yr(b,g)){const C=y-b;Xl(C,Math.abs(e))>0&&(e=e<0?0-C:C)}}}{const f=e<0?l:c,p=n[f];bt(p,`No panel constraints found for index ${f}`);const{collapsedSize:g=0,collapsible:m,minSize:y=0}=p;if(m){const b=t[f];if(bt(b!=null,`Previous layout not found for panel index ${f}`),yr(b,y)){const C=b-g;Xl(C,Math.abs(e))>0&&(e=e<0?0-C:C)}}}}{const f=e<0?1:-1;let p=e<0?c:l,g=0;for(;;){const y=t[p];bt(y!=null,`Previous layout not found for panel index ${p}`);const C=bu({panelConstraints:n,panelIndex:p,size:100})-y;if(g+=C,p+=f,p<0||p>=n.length)break}const m=Math.min(Math.abs(e),Math.abs(g));e=e<0?0-m:m}{let p=e<0?l:c;for(;p>=0&&p<n.length;){const g=Math.abs(e)-Math.abs(d),m=t[p];bt(m!=null,`Previous layout not found for panel index ${p}`);const y=m-g,b=bu({panelConstraints:n,panelIndex:p,size:y});if(!yr(m,b)&&(d+=m-b,a[p]=b,d.toPrecision(3).localeCompare(Math.abs(e).toPrecision(3),void 0,{numeric:!0})>=0))break;e<0?p--:p++}}if(KSe(i,a))return i;{const f=e<0?c:l,p=t[f];bt(p!=null,`Previous layout not found for panel index ${f}`);const g=p+d,m=bu({panelConstraints:n,panelIndex:f,size:g});if(a[f]=m,!yr(m,g)){let y=g-m,C=e<0?c:l;for(;C>=0&&C<n.length;){const x=a[C];bt(x!=null,`Previous layout not found for panel index ${C}`);const v=x+y,w=bu({panelConstraints:n,panelIndex:C,size:v});if(yr(x,w)||(y-=w-x,a[C]=w),yr(y,0))break;e>0?C--:C++}}}const h=a.reduce((f,p)=>p+f,0);return yr(h,100)?a:i}function ZSe({layout:e,panelsArray:t,pivotIndices:n}){let s=0,i=100,o=0,a=0;const l=n[0];bt(l!=null,"No pivot index found"),t.forEach((f,p)=>{const{constraints:g}=f,{maxSize:m=100,minSize:y=0}=g;p===l?(s=y,i=m):(o+=y,a+=m)});const c=Math.min(i,100-o),d=Math.max(s,100-a),h=e[l];return{valueMax:c,valueMin:d,valueNow:h}}function Ql(e,t=document){return Array.from(t.querySelectorAll(`[data-panel-resize-handle-id][data-panel-group-id="${e}"]`))}function XV(e,t,n=document){const i=Ql(e,n).findIndex(o=>o.getAttribute("data-panel-resize-handle-id")===t);return i??null}function QV(e,t,n){const s=XV(e,t,n);return s!=null?[s,s+1]:[-1,-1]}function zb(e,t=document){var n;if(t instanceof HTMLElement&&(t==null||(n=t.dataset)===null||n===void 0?void 0:n.panelGroupId)==e)return t;const s=t.querySelector(`[data-panel-group][data-panel-group-id="${e}"]`);return s||null}function Gb(e,t=document){const n=t.querySelector(`[data-panel-resize-handle-id="${e}"]`);return n||null}function YSe(e,t,n,s=document){var i,o,a,l;const c=Gb(t,s),d=Ql(e,s),h=c?d.indexOf(c):-1,f=(i=(o=n[h])===null||o===void 0?void 0:o.id)!==null&&i!==void 0?i:null,p=(a=(l=n[h+1])===null||l===void 0?void 0:l.id)!==null&&a!==void 0?a:null;return[f,p]}function XSe({committedValuesRef:e,eagerValuesRef:t,groupId:n,layout:s,panelDataArray:i,panelGroupElement:o,setLayout:a}){Qs({didWarnAboutMissingResizeHandle:!1}),Hl(()=>{if(!o)return;const l=Ql(n,o);for(let c=0;c<i.length-1;c++){const{valueMax:d,valueMin:h,valueNow:f}=ZSe({layout:s,panelsArray:i,pivotIndices:[c,c+1]}),p=l[c];if(p!=null){const g=i[c];bt(g,`No panel data found for index "${c}"`),p.setAttribute("aria-controls",g.id),p.setAttribute("aria-valuemax",""+Math.round(d)),p.setAttribute("aria-valuemin",""+Math.round(h)),p.setAttribute("aria-valuenow",f!=null?""+Math.round(f):"")}}return()=>{l.forEach((c,d)=>{c.removeAttribute("aria-controls"),c.removeAttribute("aria-valuemax"),c.removeAttribute("aria-valuemin"),c.removeAttribute("aria-valuenow")})}},[n,s,i,o]),Gl(()=>{if(!o)return;const l=t.current;bt(l,"Eager values not found");const{panelDataArray:c}=l,d=zb(n,o);bt(d!=null,`No group found for id "${n}"`);const h=Ql(n,o);bt(h,`No resize handles found for group id "${n}"`);const f=h.map(p=>{const g=p.getAttribute("data-panel-resize-handle-id");bt(g,"Resize handle element has no handle id attribute");const[m,y]=YSe(n,g,c,o);if(m==null||y==null)return()=>{};const b=C=>{if(!C.defaultPrevented)switch(C.key){case"Enter":{C.preventDefault();const x=c.findIndex(v=>v.id===m);if(x>=0){const v=c[x];bt(v,`No panel data found for index ${x}`);const w=s[x],{collapsedSize:S=0,collapsible:j,minSize:P=0}=v.constraints;if(w!=null&&j){const E=bf({delta:yr(w,S)?P-S:S-w,initialLayout:s,panelConstraints:c.map(D=>D.constraints),pivotIndices:QV(n,g,o),prevLayout:s,trigger:"keyboard"});s!==E&&a(E)}}break}}};return p.addEventListener("keydown",b),()=>{p.removeEventListener("keydown",b)}});return()=>{f.forEach(p=>p())}},[o,e,t,n,s,i,a])}function zE(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function JV(e,t){const n=e==="horizontal",{x:s,y:i}=$b(t);return n?s:i}function QSe(e,t,n,s,i){const o=n==="horizontal",a=Gb(t,i);bt(a,`No resize handle element found for id "${t}"`);const l=a.getAttribute("data-panel-group-id");bt(l,"Resize handle element has no group id attribute");let{initialCursorPosition:c}=s;const d=JV(n,e),h=zb(l,i);bt(h,`No group element found for id "${l}"`);const f=h.getBoundingClientRect(),p=o?f.width:f.height;return(d-c)/p*100}function JSe(e,t,n,s,i,o){if(GV(e)){const a=n==="horizontal";let l=0;e.shiftKey?l=100:i!=null?l=i:l=10;let c=0;switch(e.key){case"ArrowDown":c=a?0:l;break;case"ArrowLeft":c=a?-l:0;break;case"ArrowRight":c=a?l:0;break;case"ArrowUp":c=a?0:-l;break;case"End":c=100;break;case"Home":c=-100;break}return c}else return s==null?0:QSe(e,t,n,s,o)}function eje({panelDataArray:e}){const t=Array(e.length),n=e.map(o=>o.constraints);let s=0,i=100;for(let o=0;o<e.length;o++){const a=n[o];bt(a,`Panel constraints not found for index ${o}`);const{defaultSize:l}=a;l!=null&&(s++,t[o]=l,i-=l)}for(let o=0;o<e.length;o++){const a=n[o];bt(a,`Panel constraints not found for index ${o}`);const{defaultSize:l}=a;if(l!=null)continue;const c=e.length-s,d=i/c;s++,t[o]=d,i-=d}return t}function Vc(e,t,n){t.forEach((s,i)=>{const o=e[i];bt(o,`Panel data not found for index ${i}`);const{callbacks:a,constraints:l,id:c}=o,{collapsedSize:d=0,collapsible:h}=l,f=n[c];if(f==null||s!==f){n[c]=s;const{onCollapse:p,onExpand:g,onResize:m}=a;m&&m(s,f),h&&(p||g)&&(g&&(f==null||Vo(f,d))&&!Vo(s,d)&&g(),p&&(f==null||!Vo(f,d))&&Vo(s,d)&&p())}})}function zm(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!=t[n])return!1;return!0}function tje({defaultSize:e,dragState:t,layout:n,panelData:s,panelIndex:i,precision:o=3}){const a=n[i];let l;return a==null?l=e!=null?e.toPrecision(o):"1":s.length===1?l="1":l=a.toPrecision(o),{flexBasis:0,flexGrow:l,flexShrink:1,overflow:"hidden",pointerEvents:t!==null?"none":void 0}}function nje(e,t=10){let n=null;return(...i)=>{n!==null&&clearTimeout(n),n=setTimeout(()=>{e(...i)},t)}}function GE(e){try{if(typeof localStorage<"u")e.getItem=t=>localStorage.getItem(t),e.setItem=(t,n)=>{localStorage.setItem(t,n)};else throw new Error("localStorage not supported in this environment")}catch(t){console.error(t),e.getItem=()=>null,e.setItem=()=>{}}}function ez(e){return`react-resizable-panels:${e}`}function tz(e){return e.map(t=>{const{constraints:n,id:s,idIsFromProps:i,order:o}=t;return i?s:o?`${o}:${JSON.stringify(n)}`:JSON.stringify(n)}).sort((t,n)=>t.localeCompare(n)).join(",")}function nz(e,t){try{const n=ez(e),s=t.getItem(n);if(s){const i=JSON.parse(s);if(typeof i=="object"&&i!=null)return i}}catch{}return null}function sje(e,t,n){var s,i;const o=(s=nz(e,n))!==null&&s!==void 0?s:{},a=tz(t);return(i=o[a])!==null&&i!==void 0?i:null}function rje(e,t,n,s,i){var o;const a=ez(e),l=tz(t),c=(o=nz(e,i))!==null&&o!==void 0?o:{};c[l]={expandToSizes:Object.fromEntries(n.entries()),layout:s};try{i.setItem(a,JSON.stringify(c))}catch(d){console.error(d)}}function HE({layout:e,panelConstraints:t}){const n=[...e],s=n.reduce((o,a)=>o+a,0);if(n.length!==t.length)throw Error(`Invalid ${t.length} panel layout: ${n.map(o=>`${o}%`).join(", ")}`);if(!yr(s,100)&&n.length>0)for(let o=0;o<t.length;o++){const a=n[o];bt(a!=null,`No layout data found for index ${o}`);const l=100/s*a;n[o]=l}let i=0;for(let o=0;o<t.length;o++){const a=n[o];bt(a!=null,`No layout data found for index ${o}`);const l=bu({panelConstraints:t,panelIndex:o,size:a});a!=l&&(i+=a-l,n[o]=l)}if(!yr(i,0))for(let o=0;o<t.length;o++){const a=n[o];bt(a!=null,`No layout data found for index ${o}`);const l=a+i,c=bu({panelConstraints:t,panelIndex:o,size:l});if(a!==c&&(i-=c-a,n[o]=c,yr(i,0)))break}return n}const ije=100,xf={getItem:e=>(GE(xf),xf.getItem(e)),setItem:(e,t)=>{GE(xf),xf.setItem(e,t)}},WE={};function sz({autoSaveId:e=null,children:t,className:n="",direction:s,forwardedRef:i,id:o=null,onLayout:a=null,keyboardResizeBy:l=null,storage:c=xf,style:d,tagName:h="div",...f}){const p=E_(o),g=Qs(null),[m,y]=Iu(null),[b,C]=Iu([]),x=qSe(),v=Qs({}),w=Qs(new Map),S=Qs(0),j=Qs({autoSaveId:e,direction:s,dragState:m,id:p,keyboardResizeBy:l,onLayout:a,storage:c}),P=Qs({layout:b,panelDataArray:[],panelDataArrayChanged:!1});Qs({didLogIdAndOrderWarning:!1,didLogPanelConstraintsWarning:!1,prevPanelIds:[]}),VV(i,()=>({getId:()=>j.current.id,getLayout:()=>{const{layout:V}=P.current;return V},setLayout:V=>{const{onLayout:X}=j.current,{layout:W,panelDataArray:Y}=P.current,$=HE({layout:V,panelConstraints:Y.map(N=>N.constraints)});zE(W,$)||(C($),P.current.layout=$,X&&X($),Vc(Y,$,v.current))}}),[]),Hl(()=>{j.current.autoSaveId=e,j.current.direction=s,j.current.dragState=m,j.current.id=p,j.current.onLayout=a,j.current.storage=c}),XSe({committedValuesRef:j,eagerValuesRef:P,groupId:p,layout:b,panelDataArray:P.current.panelDataArray,setLayout:C,panelGroupElement:g.current}),Gl(()=>{const{panelDataArray:V}=P.current;if(e){if(b.length===0||b.length!==V.length)return;let X=WE[e];X==null&&(X=nje(rje,ije),WE[e]=X);const W=[...V],Y=new Map(w.current);X(e,W,Y,b,c)}},[e,b,c]),Gl(()=>{});const E=Zs(V=>{const{onLayout:X}=j.current,{layout:W,panelDataArray:Y}=P.current;if(V.constraints.collapsible){const $=Y.map(ue=>ue.constraints),{collapsedSize:N=0,panelSize:U,pivotIndices:ie}=bl(Y,V,W);if(bt(U!=null,`Panel size not found for panel "${V.id}"`),!Vo(U,N)){w.current.set(V.id,U);const xe=Jc(Y,V)===Y.length-1?U-N:N-U,Me=bf({delta:xe,initialLayout:W,panelConstraints:$,pivotIndices:ie,prevLayout:W,trigger:"imperative-api"});zm(W,Me)||(C(Me),P.current.layout=Me,X&&X(Me),Vc(Y,Me,v.current))}}},[]),D=Zs((V,X)=>{const{onLayout:W}=j.current,{layout:Y,panelDataArray:$}=P.current;if(V.constraints.collapsible){const N=$.map(je=>je.constraints),{collapsedSize:U=0,panelSize:ie=0,minSize:ue=0,pivotIndices:xe}=bl($,V,Y),Me=X??ue;if(Vo(ie,U)){const je=w.current.get(V.id),Fe=je!=null&&je>=Me?je:Me,$e=Jc($,V)===$.length-1?ie-Fe:Fe-ie,Z=bf({delta:$e,initialLayout:Y,panelConstraints:N,pivotIndices:xe,prevLayout:Y,trigger:"imperative-api"});zm(Y,Z)||(C(Z),P.current.layout=Z,W&&W(Z),Vc($,Z,v.current))}}},[]),M=Zs(V=>{const{layout:X,panelDataArray:W}=P.current,{panelSize:Y}=bl(W,V,X);return bt(Y!=null,`Panel size not found for panel "${V.id}"`),Y},[]),R=Zs((V,X)=>{const{panelDataArray:W}=P.current,Y=Jc(W,V);return tje({defaultSize:X,dragState:m,layout:b,panelData:W,panelIndex:Y})},[m,b]),F=Zs(V=>{const{layout:X,panelDataArray:W}=P.current,{collapsedSize:Y=0,collapsible:$,panelSize:N}=bl(W,V,X);return bt(N!=null,`Panel size not found for panel "${V.id}"`),$===!0&&Vo(N,Y)},[]),_=Zs(V=>{const{layout:X,panelDataArray:W}=P.current,{collapsedSize:Y=0,collapsible:$,panelSize:N}=bl(W,V,X);return bt(N!=null,`Panel size not found for panel "${V.id}"`),!$||Xl(N,Y)>0},[]),L=Zs(V=>{const{panelDataArray:X}=P.current;X.push(V),X.sort((W,Y)=>{const $=W.order,N=Y.order;return $==null&&N==null?0:$==null?-1:N==null?1:$-N}),P.current.panelDataArrayChanged=!0,x()},[x]);Hl(()=>{if(P.current.panelDataArrayChanged){P.current.panelDataArrayChanged=!1;const{autoSaveId:V,onLayout:X,storage:W}=j.current,{layout:Y,panelDataArray:$}=P.current;let N=null;if(V){const ie=sje(V,$,W);ie&&(w.current=new Map(Object.entries(ie.expandToSizes)),N=ie.layout)}N==null&&(N=eje({panelDataArray:$}));const U=HE({layout:N,panelConstraints:$.map(ie=>ie.constraints)});zE(Y,U)||(C(U),P.current.layout=U,X&&X(U),Vc($,U,v.current))}}),Hl(()=>{const V=P.current;return()=>{V.layout=[]}},[]);const O=Zs(V=>function(W){W.preventDefault();const Y=g.current;if(!Y)return()=>null;const{direction:$,dragState:N,id:U,keyboardResizeBy:ie,onLayout:ue}=j.current,{layout:xe,panelDataArray:Me}=P.current,{initialLayout:je}=N??{},Fe=QV(U,V,Y);let nt=JSe(W,V,$,N,ie,Y);const $e=$==="horizontal";document.dir==="rtl"&&$e&&(nt=-nt);const Z=Me.map(ve=>ve.constraints),se=bf({delta:nt,initialLayout:je??xe,panelConstraints:Z,pivotIndices:Fe,prevLayout:xe,trigger:GV(W)?"keyboard":"mouse-or-touch"}),le=!zm(xe,se);(HV(W)||WV(W))&&S.current!=nt&&(S.current=nt,!le&&nt!==0?$e?Wv(V,nt<0?qV:KV):Wv(V,nt<0?ZV:YV):Wv(V,0)),le&&(C(se),P.current.layout=se,ue&&ue(se),Vc(Me,se,v.current))},[]),B=Zs((V,X)=>{const{onLayout:W}=j.current,{layout:Y,panelDataArray:$}=P.current,N=$.map(je=>je.constraints),{panelSize:U,pivotIndices:ie}=bl($,V,Y);bt(U!=null,`Panel size not found for panel "${V.id}"`);const xe=Jc($,V)===$.length-1?U-X:X-U,Me=bf({delta:xe,initialLayout:Y,panelConstraints:N,pivotIndices:ie,prevLayout:Y,trigger:"imperative-api"});zm(Y,Me)||(C(Me),P.current.layout=Me,W&&W(Me),Vc($,Me,v.current))},[]),z=Zs((V,X)=>{const{layout:W,panelDataArray:Y}=P.current,{collapsedSize:$=0,collapsible:N}=X,{collapsedSize:U=0,collapsible:ie,maxSize:ue=100,minSize:xe=0}=V.constraints,{panelSize:Me}=bl(Y,V,W);Me!=null&&(N&&ie&&Vo(Me,$)?Vo($,U)||B(V,U):Me<xe?B(V,xe):Me>ue&&B(V,ue))},[B]),ee=Zs((V,X)=>{const{direction:W}=j.current,{layout:Y}=P.current;if(!g.current)return;const $=Gb(V,g.current);bt($,`Drag handle element not found for id "${V}"`);const N=JV(W,X);y({dragHandleId:V,dragHandleRect:$.getBoundingClientRect(),initialCursorPosition:N,initialLayout:Y})},[]),ne=Zs(()=>{y(null)},[]),re=Zs(V=>{const{panelDataArray:X}=P.current,W=Jc(X,V);W>=0&&(X.splice(W,1),delete v.current[V.id],P.current.panelDataArrayChanged=!0,x())},[x]),te=LSe(()=>({collapsePanel:E,direction:s,dragState:m,expandPanel:D,getPanelSize:M,getPanelStyle:R,groupId:p,isPanelCollapsed:F,isPanelExpanded:_,reevaluatePanelConstraints:z,registerPanel:L,registerResizeHandle:O,resizePanel:B,startDragging:ee,stopDragging:ne,unregisterPanel:re,panelGroupElement:g.current}),[E,m,s,D,M,R,p,F,_,z,L,O,B,ee,ne,re]),H={display:"flex",flexDirection:s==="horizontal"?"row":"column",height:"100%",overflow:"hidden",width:"100%"};return Ku(Bb.Provider,{value:te},Ku(h,{...f,children:t,className:n,id:o,ref:g,style:{...H,...d},"data-panel-group":"","data-panel-group-direction":s,"data-panel-group-id":p}))}const Eg=BV((e,t)=>Ku(sz,{...e,forwardedRef:t}));sz.displayName="PanelGroup";Eg.displayName="forwardRef(PanelGroup)";function Jc(e,t){return e.findIndex(n=>n===t||n.id===t.id)}function bl(e,t,n){const s=Jc(e,t),o=s===e.length-1?[s-1,s]:[s,s+1],a=n[s];return{...t.constraints,panelSize:a,pivotIndices:o}}function oje({disabled:e,handleId:t,resizeHandler:n,panelGroupElement:s}){Gl(()=>{if(e||n==null||s==null)return;const i=Gb(t,s);if(i==null)return;const o=a=>{if(!a.defaultPrevented)switch(a.key){case"ArrowDown":case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"End":case"Home":{a.preventDefault(),n(a);break}case"F6":{a.preventDefault();const l=i.getAttribute("data-panel-group-id");bt(l,`No group element found for id "${l}"`);const c=Ql(l,s),d=XV(l,t,s);bt(d!==null,`No resize element found for id "${t}"`);const h=a.shiftKey?d>0?d-1:c.length-1:d+1<c.length?d+1:0;c[h].focus();break}}};return i.addEventListener("keydown",o),()=>{i.removeEventListener("keydown",o)}},[s,e,t,n])}function rz({children:e=null,className:t="",disabled:n=!1,hitAreaMargins:s,id:i,onBlur:o,onDragging:a,onFocus:l,style:c={},tabIndex:d=0,tagName:h="div",...f}){var p,g;const m=Qs(null),y=Qs({onDragging:a});Gl(()=>{y.current.onDragging=a});const b=$V(Bb);if(b===null)throw Error("PanelResizeHandle components must be rendered within a PanelGroup container");const{direction:C,groupId:x,registerResizeHandle:v,startDragging:w,stopDragging:S,panelGroupElement:j}=b,P=E_(i),[E,D]=Iu("inactive"),[M,R]=Iu(!1),[F,_]=Iu(null),L=Qs({state:E});Hl(()=>{L.current.state=E}),Gl(()=>{if(n)_(null);else{const ee=v(P);_(()=>ee)}},[n,P,v]);const O=(p=s==null?void 0:s.coarse)!==null&&p!==void 0?p:15,B=(g=s==null?void 0:s.fine)!==null&&g!==void 0?g:5;return Gl(()=>{if(n||F==null)return;const ee=m.current;return bt(ee,"Element ref not attached"),USe(P,ee,C,{coarse:O,fine:B},(re,te,H)=>{if(te)switch(re){case"down":{D("drag"),bt(H,'Expected event to be defined for "down" action'),w(P,H);const{onDragging:V}=y.current;V&&V(!0);break}case"move":{const{state:V}=L.current;V!=="drag"&&D("hover"),bt(H,'Expected event to be defined for "move" action'),F(H);break}case"up":{D("hover"),S();const{onDragging:V}=y.current;V&&V(!1);break}}else D("inactive")})},[O,C,n,B,v,P,F,w,S]),oje({disabled:n,handleId:P,resizeHandler:F,panelGroupElement:j}),Ku(h,{...f,children:e,className:t,id:i,onBlur:()=>{R(!1),o==null||o()},onFocus:()=>{R(!0),l==null||l()},ref:m,role:"separator",style:{...{touchAction:"none",userSelect:"none"},...c},tabIndex:d,"data-panel-group-direction":C,"data-panel-group-id":x,"data-resize-handle":"","data-resize-handle-active":E==="drag"?"pointer":M?"keyboard":void 0,"data-resize-handle-state":E,"data-panel-resize-handle-enabled":!n,"data-panel-resize-handle-id":P})}rz.displayName="PanelResizeHandle";const iz=vo(rz),oz={'&[data-resize-handle-state="hover"]':{_before:{background:"base.600 !important"},".resize-handle-dots":{color:"base.400"}},'&[data-resize-handle-state="drag"]':{_before:{background:"base.500 !important"},".resize-handle-dots":{color:"base.300"}},".resize-handle-dots":{pointerEvents:"none",position:"absolute",left:"50%",top:"50%",transform:"translateX(-50%) translateY(-50%) scale(0.75)",background:"base.900",color:"base.500"}},aje={...oz,'&[data-panel-group-direction="vertical"]':{h:4,w:"full",position:"relative",_before:{transitionProperty:"background",transitionDuration:"fast",content:'""',w:"full",h:"2px",background:"base.800",position:"absolute",top:"50%",left:0,transform:"translateY(-50%)"}}},D_=u.memo(e=>r.jsx(iz,{...e,sx:aje,children:r.jsxs(T,{className:"resize-handle-dots",clipPath:"inset(0px 2px 2px 0px)",px:1,children:[r.jsx(lt,{as:W5,me:-.5}),r.jsx(lt,{as:W5,ms:-.5})]})}));D_.displayName="HorizontalResizeHandle";const lje={...oz,'&[data-panel-group-direction="horizontal"]':{w:4,h:"full",position:"relative",_before:{transitionProperty:"background",transitionDuration:"normal",content:'""',w:"2px",h:"full",background:"base.800",position:"absolute",left:"50%",top:0,transform:"translateX(-50%)"}}},M1=u.memo(e=>r.jsx(iz,{...e,sx:lje,children:r.jsxs(T,{flexDir:"column",className:"resize-handle-dots",clipPath:"inset(2px 0px 0px 2px)",py:1,children:[r.jsx(lt,{as:H5,mb:-.5}),r.jsx(lt,{as:H5,mt:-.5})]})}));M1.displayName="VerticalResizeHandle";const az=u.memo(({firstImage:e,secondImage:t})=>{const n=u.useRef(null),s=u.useCallback(()=>{n.current&&n.current.setLayout([50,50])},[]);return r.jsx(T,{w:"full",h:"full",maxW:"full",maxH:"full",position:"relative",alignItems:"center",justifyContent:"center",children:r.jsx(T,{w:"full",h:"full",maxW:"full",maxH:"full",position:"absolute",alignItems:"center",justifyContent:"center",children:r.jsxs(Eg,{ref:n,direction:"horizontal",id:"image-comparison-side-by-side",autoSaveId:"image-comparison-side-by-side",children:[r.jsx(ao,{minSize:20,children:r.jsx(T,{position:"relative",w:"full",h:"full",alignItems:"center",justifyContent:"center",children:r.jsxs(T,{position:"absolute",maxW:"full",maxH:"full",aspectRatio:e.width/e.height,children:[r.jsx(Wt,{id:"image-comparison-side-by-side-first-image",w:e.width,h:e.height,maxW:"full",maxH:"full",src:e.image_url,fallbackSrc:e.thumbnail_url,objectFit:"contain",borderRadius:"base"}),r.jsx(Yl,{type:"first"})]})})}),r.jsx(M1,{id:"image-comparison-side-by-side-handle",onDoubleClick:s}),r.jsx(ao,{minSize:20,children:r.jsx(T,{position:"relative",w:"full",h:"full",alignItems:"center",justifyContent:"center",children:r.jsxs(T,{position:"absolute",maxW:"full",maxH:"full",aspectRatio:t.width/t.height,children:[r.jsx(Wt,{id:"image-comparison-side-by-side-first-image",w:t.width,h:t.height,maxW:"full",maxH:"full",src:t.image_url,fallbackSrc:t.thumbnail_url,objectFit:"contain",borderRadius:"base"}),r.jsx(Yl,{type:"second"})]})})})]})})})});az.displayName="ImageComparisonSideBySide";const lz="50%",R_=2,cje=`${R_}px`,Hb=20,uje=`${Hb}px`,dje=`${Hb/2-R_/2}px`,hje=`calc(${lz} - ${Hb/2}px)`,cz=u.memo(({firstImage:e,secondImage:t,containerDims:n})=>{const s=I(AS),[i,o]=u.useState(hje),[a,l]=u.useState(lz),c=u.useRef(null),d=u.useRef(null),h=u.useRef(null),f=u.useRef(0),p=u.useMemo(()=>mB(n,e),[n,e]),g=u.useMemo(()=>yB(s,p,e,t),[s,p,e,t]),m=u.useCallback(x=>{if(!c.current||!d.current)return;f.current=performance.now();const{x:v,width:w}=d.current.getBoundingClientRect(),S=(x-v)*100/w,j=R_*100/w,P=Math.min(100-j,Math.max(0,S));l(`${P}%`),o(`calc(${P}% - ${Hb/2}px)`)},[]),y=u.useCallback(x=>{h.current===null&&performance.now()>f.current+1e3/60&&(h.current=window.requestAnimationFrame(()=>{m(x.clientX),h.current=null}))},[m]),b=u.useCallback(()=>{window.removeEventListener("mousemove",y)},[y]),C=u.useCallback(x=>{m(x.clientX),window.addEventListener("mouseup",b,{once:!0}),window.addEventListener("mousemove",y)},[y,b,m]);return u.useEffect(()=>()=>{h.current!==null&&cancelAnimationFrame(h.current)},[]),r.jsx(T,{w:"full",h:"full",maxW:"full",maxH:"full",position:"relative",alignItems:"center",justifyContent:"center",children:r.jsx(T,{id:"image-comparison-wrapper",w:"full",h:"full",maxW:"full",maxH:"full",position:"absolute",alignItems:"center",justifyContent:"center",children:r.jsxs(Se,{ref:d,position:"relative",id:"image-comparison-image-container",w:p.width,h:p.height,maxW:"full",maxH:"full",userSelect:"none",overflow:"hidden",borderRadius:"base",children:[r.jsx(Se,{id:"image-comparison-bg",position:"absolute",top:0,left:0,right:0,bottom:0,backgroundImage:Md,backgroundRepeat:"repeat"}),r.jsx(Wt,{position:"relative",id:"image-comparison-second-image",src:t.image_url,fallbackSrc:t.thumbnail_url,w:g.width,h:g.height,maxW:p.width,maxH:p.height,objectFit:s,objectPosition:"top left"}),r.jsx(Yl,{type:"second"}),r.jsxs(Se,{id:"image-comparison-first-image-container",position:"absolute",top:0,left:0,right:0,bottom:0,w:a,overflow:"hidden",children:[r.jsx(Wt,{id:"image-comparison-first-image",src:e.image_url,fallbackSrc:e.thumbnail_url,w:p.width,h:p.height,objectFit:"cover",objectPosition:"top left"}),r.jsx(Yl,{type:"first"})]}),r.jsxs(T,{id:"image-comparison-handle",ref:c,position:"absolute",top:0,bottom:0,left:i,w:uje,cursor:"ew-resize",filter:JC,opacity:.8,color:"base.50",children:[r.jsx(Se,{id:"image-comparison-handle-divider",w:cje,h:"full",bg:"currentColor",shadow:"dark-lg",position:"absolute",top:0,left:dje}),r.jsxs(T,{id:"image-comparison-handle-icons",gap:4,position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, 0)",filter:JC,children:[r.jsx(lt,{as:Nj}),r.jsx(lt,{as:ab})]})]}),r.jsx(Se,{id:"image-comparison-interaction-overlay",position:"absolute",top:0,right:0,bottom:0,left:0,onMouseDown:C,onContextMenu:NV,userSelect:"none",cursor:"ew-resize"})]})})})});cz.displayName="ImageComparisonSlider";const uz=u.memo(({containerDims:e})=>{const{t}=A(),n=I(FP),{firstImage:s,secondImage:i}=I(bB);if(!s||!i)return r.jsx(Pt,{label:t("gallery.selectAnImageToCompare"),icon:KR});if(n==="slider")return r.jsx(cz,{containerDims:e,firstImage:s,secondImage:i});if(n==="side-by-side")return r.jsx(az,{containerDims:e,firstImage:s,secondImage:i});if(n==="hover")return r.jsx(FV,{containerDims:e,firstImage:s,secondImage:i})});uz.displayName="ImageComparison";const dz=u.memo(()=>{const{t:e}=A(),t=u.useMemo(()=>sw.getData(),[]);return r.jsx(Is,{dndTarget:sw,dndTargetData:t,label:e("gallery.selectForCompare")})});dz.displayName="ImageComparisonDroppable";const hz=u.memo(()=>{const e=G(),t=I(xD),n=I(Lp),{t:s}=A(),i=u.useCallback(()=>e(lee(!t)),[e,t]);return Re({id:"toggleMetadata",category:"viewer",callback:i,options:{enabled:!!n},dependencies:[n,t]}),r.jsx(oe,{icon:r.jsx(bd,{}),tooltip:`${s("parameters.info")} (I)`,"aria-label":`${s("parameters.info")} (I)`,onClick:i,isDisabled:!n,variant:"link",alignSelf:"stretch",colorScheme:t?"invokeBlue":"base","data-testid":"toggle-show-metadata-button"})});hz.displayName="ToggleMetadataViewerButton";const fz=u.memo(()=>{const e=G(),t=I(uj),{t:n}=A(),s=u.useCallback(()=>{e(zP(!t))},[e,t]);return r.jsx(oe,{"aria-label":n("settings.displayInProgress"),tooltip:n("settings.displayInProgress"),icon:r.jsx(Hde,{}),onClick:s,variant:"link",alignSelf:"stretch",colorScheme:t?"invokeBlue":"base","data-testid":"toggle-show-progress-button"})});fz.displayName="ToggleProgressButton";const pz=u.memo(e=>{const{onClick:t,isDisabled:n}=e,{t:s}=A(),i=ae(Yn),o=I(xS),a=`${s("gallery.deleteImage",{count:o})} (Del)`;return r.jsx(oe,{onClick:t,icon:r.jsx(ri,{}),tooltip:a,"aria-label":a,isDisabled:n||!i,colorScheme:"error",variant:"link",alignSelf:"stretch"})});pz.displayName="DeleteImageButton";const fje=()=>{const{t:e}=A(),[t,{isLoading:n}]=fg(),s=I(GP),i=G(),o=u.useMemo(()=>{var p;if(!(!t.length||!s))return(p=t.find(g=>g.key===(s==null?void 0:s.key)))==null?void 0:p.description},[t,s]),a=u.useCallback(p=>{i(cee(p))},[i]),{options:l,value:c,onChange:d,placeholder:h,noOptionsMessage:f}=ll({modelConfigs:t,onChange:a,selectedModel:s,isLoading:n});return r.jsxs(K,{orientation:"vertical",children:[r.jsx(J,{children:e("upscaling.postProcessingModel")}),r.jsx(Ee,{label:o,children:r.jsx(Se,{w:"full",children:r.jsx(Ne,{value:c,placeholder:h,options:l,onChange:d,noOptionsMessage:f,isDisabled:l.length===0})})})]})},pje=u.memo(fje),gje=()=>{const[e,{isLoading:t}]=eS(kp),[n,{isLoading:s}]=HP({fixedCacheKey:"resumeProcessor"}),[i,{isLoading:o}]=WP({fixedCacheKey:"pauseProcessor"}),[a,{isLoading:l}]=Ww({fixedCacheKey:"cancelQueueItem"}),[c,{isLoading:d}]=O3({fixedCacheKey:"clearQueue"}),[h,{isLoading:f}]=UP({fixedCacheKey:"pruneQueue"});return t||s||o||l||d||f},gz=u.memo(e=>{const{imageDTO:t}=e,n=G(),s=I(GP),i=gje(),{t:o}=A(),{isOpen:a,onOpen:l,onClose:c}=cr(),d=u.useCallback(()=>{c(),t&&n(kM({imageDTO:t}))},[n,t,c]);return r.jsxs(rs,{isOpen:a,onClose:c,isLazy:!0,children:[r.jsx(gs,{children:r.jsx(oe,{tooltip:o("parameters.postProcessing"),onClick:l,icon:r.jsx(ag,{}),"aria-label":o("parameters.postProcessing"),variant:"link",alignSelf:"stretch"})}),r.jsx(is,{children:r.jsx(ms,{w:96,children:r.jsxs(T,{flexDirection:"column",gap:4,children:[r.jsx(pje,{}),!s&&r.jsx(mje,{}),r.jsx(de,{size:"sm",isDisabled:!t||i||!s,onClick:d,children:o("parameters.processImage")})]})})})]})});gz.displayName="PostProcessingPopover";const mje=()=>{const e=G(),t=u.useCallback(()=>{e(Qt("models")),ql.set(3)},[e]);return r.jsx(T,{bg:"error.500",borderRadius:"base",padding:4,direction:"column",fontSize:"sm",gap:2,children:r.jsx(q,{children:r.jsx(Ut,{i18nKey:"upscaling.postProcessingMissingModelWarning",components:{LinkComponent:r.jsx(de,{size:"sm",flexGrow:0,variant:"link",color:"base.50",onClick:t})}})})})},yje=()=>{const e=I(Lp),{currentData:t}=nl((e==null?void 0:e.image_name)??Xn);return t?r.jsx(mz,{imageDTO:t}):null},bje=u.memo(yje),mz=u.memo(({imageDTO:e})=>{const{t}=A(),n=ae(Mp),s=ok(e),i=I(Fn),o=Bt("upscaling");return r.jsxs(r.Fragment,{children:[r.jsxs(en,{isLazy:!0,children:[r.jsx(tn,{as:oe,"aria-label":t("parameters.imageActions"),tooltip:t("parameters.imageActions"),isDisabled:!e,variant:"link",alignSelf:"stretch",icon:r.jsx(Gj,{})}),r.jsx(Tt,{children:e&&r.jsx(oO,{imageDTO:e})})]}),r.jsx(wt,{orientation:"vertical",h:8,mx:2}),r.jsx(oe,{icon:r.jsx(lb,{}),tooltip:`${t("nodes.loadWorkflow")} (W)`,"aria-label":`${t("nodes.loadWorkflow")} (W)`,isDisabled:!s.hasWorkflow||!n,variant:"link",alignSelf:"stretch",onClick:s.loadWorkflow}),r.jsx(oe,{icon:r.jsx(e1,{}),tooltip:`${t("parameters.remixImage")} (R)`,"aria-label":`${t("parameters.remixImage")} (R)`,isDisabled:!s.hasMetadata,variant:"link",alignSelf:"stretch",onClick:s.remix}),r.jsx(oe,{icon:r.jsx(t7,{}),tooltip:`${t("parameters.usePrompt")} (P)`,"aria-label":`${t("parameters.usePrompt")} (P)`,isDisabled:!s.hasPrompts,variant:"link",alignSelf:"stretch",onClick:s.recallPrompts}),r.jsx(oe,{icon:r.jsx(JR,{}),tooltip:`${t("parameters.useSeed")} (S)`,"aria-label":`${t("parameters.useSeed")} (S)`,isDisabled:!s.hasSeed,variant:"link",alignSelf:"stretch",onClick:s.recallSeed}),r.jsx(oe,{icon:r.jsx(she,{}),tooltip:`${t("parameters.useSize")} (D)`,"aria-label":`${t("parameters.useSize")} (D)`,variant:"link",alignSelf:"stretch",onClick:s.recallSize,isDisabled:i}),r.jsx(oe,{icon:r.jsx(BR,{}),tooltip:`${t("parameters.useAll")} (A)`,"aria-label":`${t("parameters.useAll")} (A)`,isDisabled:!s.hasMetadata,variant:"link",alignSelf:"stretch",onClick:s.recallAll}),o&&r.jsx(gz,{imageDTO:e}),r.jsx(wt,{orientation:"vertical",h:8,mx:2}),r.jsx(pz,{onClick:s.delete})]})});mz.displayName="CurrentImageButtonsContent";const yz=u.memo(({closeButton:e})=>r.jsxs(T,{w:"full",px:2,gap:2,bg:"base.750",borderTopRadius:"base",h:12,children:[r.jsx(T,{flex:1,justifyContent:"center",children:r.jsxs(T,{marginInlineEnd:"auto",alignItems:"center",children:[r.jsx(fz,{}),r.jsx(hz,{})]})}),r.jsx(T,{flex:1,justifyContent:"center",alignItems:"center",children:r.jsx(bje,{})}),r.jsx(T,{flex:1,justifyContent:"center",children:r.jsx(T,{marginInlineStart:"auto",alignItems:"center",children:e})})]}));yz.displayName="ViewerToolbar";var xje=function(){},bz=typeof window<"u",vje=bz?u.useLayoutEffect:u.useEffect,xz={x:0,y:0,width:0,height:0,top:0,left:0,bottom:0,right:0};function Cje(){var e=u.useState(null),t=e[0],n=e[1],s=u.useState(xz),i=s[0],o=s[1],a=u.useMemo(function(){return new window.ResizeObserver(function(l){if(l[0]){var c=l[0].contentRect,d=c.x,h=c.y,f=c.width,p=c.height,g=c.top,m=c.left,y=c.bottom,b=c.right;o({x:d,y:h,width:f,height:p,top:g,left:m,bottom:y,right:b})}})},[]);return vje(function(){if(t)return a.observe(t),function(){a.disconnect()}},[t]),[n,i]}const vz=bz&&typeof window.ResizeObserver<"u"?Cje:function(){return[xje,xz]},wje={focusOnMount:!0},Sje={display:"flex",width:"full",height:"full",position:"absolute",flexDirection:"column",inset:0,alignItems:"center",justifyContent:"center",overflow:"hidden"},Wb=u.memo(({closeButton:e})=>{At("ImageViewer");const t=I(uee),[n,s]=vz();return r.jsxs(_d,{region:"viewer",sx:Sje,layerStyle:"first",...wje,children:[t&&r.jsx(dV,{}),!t&&r.jsx(yz,{closeButton:e}),r.jsxs(Se,{ref:n,w:"full",h:"full",p:2,overflow:"hidden",children:[!t&&r.jsx(ISe,{}),t&&r.jsx(uz,{containerDims:s})]}),r.jsx(dz,{})]})});Wb.displayName="ImageViewer";const Cz=u.memo(()=>Nt().isOpen?r.jsx(Wb,{closeButton:r.jsx(O_,{})}):null);Cz.displayName="GatedImageViewer";const O_=u.memo(()=>{const{t:e}=A(),t=Nt();return At("ImageViewerCloseButton"),Ii("esc",t.close),r.jsx(oe,{tooltip:e("gallery.closeViewer"),"aria-label":e("gallery.closeViewer"),icon:r.jsx(Ot,{}),variant:"link",alignSelf:"stretch",onClick:t.close})});O_.displayName="ImageViewerCloseButton";const jje=u.memo(()=>Nt().isOpen?r.jsx(O_,{}):null);jje.displayName="GatedImageViewerCloseButton";const kje={width:"full",height:"full"},UE=()=>r.jsx(Ki,{children:r.jsxs(Tt,{children:[r.jsx(gB,{}),r.jsx(XF,{})]})}),wz=u.memo(()=>{const e=I(F0),t=I(dee),n=u.useCallback(()=>r.jsx(UE,{}),[]);return r.jsx(_d,{region:"canvas",sx:kje,children:r.jsxs(T,{tabIndex:-1,borderRadius:"base",position:"relative",flexDirection:"column",height:"full",width:"full",gap:2,alignItems:"center",justifyContent:"center",overflow:"hidden",children:[r.jsx(Ki,{children:r.jsx(lV,{})}),r.jsx(Ry,{renderMenu:n,withLongPress:!1,children:s=>r.jsxs(T,{ref:s,position:"relative",w:"full",h:"full",bg:e?"base.850":"base.900",borderRadius:"base",overflow:"hidden",children:[r.jsx(t$,{}),r.jsxs(Ki,{children:[r.jsxs(T,{position:"absolute",flexDir:"column",top:1,insetInlineStart:1,pointerEvents:"none",gap:2,alignItems:"flex-start",children:[t&&r.jsx(KB,{}),r.jsx(pN,{}),r.jsx(iN,{}),r.jsx(Fve,{}),r.jsx(C_,{})]}),r.jsx(T,{position:"absolute",top:1,insetInlineEnd:1,children:r.jsxs(en,{children:[r.jsx(tn,{as:oe,icon:r.jsx(hhe,{}),colorScheme:"base"}),r.jsx(UE,{})]})})]})]})}),r.jsx(T,{position:"absolute",bottom:4,gap:2,align:"center",justify:"center",children:r.jsx(Ki,{children:r.jsx(a$,{children:r.jsx(y$,{})})})}),r.jsx(T,{position:"absolute",bottom:4,children:r.jsxs(Ki,{children:[r.jsx(HB,{}),r.jsx(jwe,{}),r.jsx(i$,{})]})}),r.jsx(Ki,{children:r.jsx(xB,{})}),r.jsx(Cz,{})]})})});wz.displayName="CanvasMainPanelContent";const Au=e=>{const t=I(Oy),n=I(MS);return u.useMemo(()=>{switch(e){case"reference_image":return!t&&!n;case"regional_guidance":return!t&&!n;case"control_layer":return!t&&!n;case"inpaint_mask":return!0;case"raster_layer":return!0;default:we(!1)}},[e,t,n])},Sz=u.memo(()=>{const{t:e}=A(),t=ck(),n=uk(),s=lk(),i=ak(),o=dk(),a=b9(),l=Au("reference_image"),c=Au("regional_guidance"),d=Au("control_layer");return r.jsx(T,{w:"full",h:"full",justifyContent:"center",gap:4,children:r.jsxs(T,{position:"relative",flexDir:"column",gap:4,top:"20%",children:[r.jsxs(T,{flexDir:"column",justifyContent:"flex-start",gap:2,children:[r.jsx(Ft,{size:"xs",children:e("controlLayers.global")}),r.jsx(ze,{feature:"globalReferenceImage",children:r.jsx(de,{size:"sm",variant:"ghost",justifyContent:"flex-start",leftIcon:r.jsx(Vt,{}),onClick:o,isDisabled:!l,children:e("controlLayers.globalReferenceImage")})})]}),r.jsxs(T,{flexDir:"column",gap:2,children:[r.jsx(Ft,{size:"xs",children:e("controlLayers.regional")}),r.jsx(ze,{feature:"inpainting",children:r.jsx(de,{size:"sm",variant:"ghost",justifyContent:"flex-start",leftIcon:r.jsx(Vt,{}),onClick:t,children:e("controlLayers.inpaintMask")})}),r.jsx(ze,{feature:"regionalGuidance",children:r.jsx(de,{size:"sm",variant:"ghost",justifyContent:"flex-start",leftIcon:r.jsx(Vt,{}),onClick:n,isDisabled:!c,children:e("controlLayers.regionalGuidance")})}),r.jsx(ze,{feature:"regionalReferenceImage",children:r.jsx(de,{size:"sm",variant:"ghost",justifyContent:"flex-start",leftIcon:r.jsx(Vt,{}),onClick:a,isDisabled:!c,children:e("controlLayers.regionalReferenceImage")})})]}),r.jsxs(T,{flexDir:"column",justifyContent:"flex-start",gap:2,children:[r.jsx(Ft,{size:"xs",children:e("controlLayers.layer_other")}),r.jsx(ze,{feature:"controlNet",children:r.jsx(de,{size:"sm",variant:"ghost",justifyContent:"flex-start",leftIcon:r.jsx(Vt,{}),onClick:i,isDisabled:!d,children:e("controlLayers.controlLayer")})}),r.jsx(ze,{feature:"rasterLayer",children:r.jsx(de,{size:"sm",variant:"ghost",justifyContent:"flex-start",leftIcon:r.jsx(Vt,{}),onClick:s,children:e("controlLayers.rasterLayer")})})]})]})})});Sz.displayName="CanvasAddEntityButtons";function qE(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,s)}return n}function KE(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?qE(Object(n),!0).forEach(function(s){Si(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qE(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}var _je={top:function(t,n){return Math.abs(n.y-t.top)},right:function(t,n){return Math.abs(t.right-n.x)},bottom:function(t,n){return Math.abs(t.bottom-n.y)},left:function(t,n){return Math.abs(n.x-t.left)}},jz=Symbol("closestEdge");function Ije(e,t){var n,s,i=t.element,o=t.input,a=t.allowedEdges,l={x:o.clientX,y:o.clientY},c=i.getBoundingClientRect(),d=a.map(function(f){return{edge:f,value:_je[f](c,l)}}),h=(n=(s=d.sort(function(f,p){return f.value-p.value})[0])===null||s===void 0?void 0:s.edge)!==null&&n!==void 0?n:null;return KE(KE({},e),{},Si({},jz,h))}function mw(e){var t;return(t=e[jz])!==null&&t!==void 0?t:null}function Tje(e){var t=e.list,n=e.startIndex,s=e.finishIndex;if(n===-1||s===-1)return t;var i=Array.from(t),o=i.splice(n,1),a=pj(o,1),l=a[0];return i.splice(s,0,l),i}function yw(e){var t=e.startIndex,n=e.closestEdgeOfTarget,s=e.indexOfTarget,i=e.axis;if(t===-1||s===-1||t===s)return t;if(n==null)return s;var o=i==="vertical"&&n==="bottom"||i==="horizontal"&&n==="right",a=t<s;return a?o?s:s-1:o?s+1:s}function kz(e){var t=e.list,n=e.startIndex,s=e.closestEdgeOfTarget,i=e.indexOfTarget,o=e.axis;return Tje({list:t,startIndex:n,finishIndex:yw({closestEdgeOfTarget:s,startIndex:n,indexOfTarget:i,axis:o})})}const lo=e=>`var(--invoke-colors-${e.split(".").join("-")})`,N_={overflow:"visible"},_z=u.memo(({type:e})=>{const{t}=A(),n=ut(),s=ck(),i=uk(),o=lk(),a=ak(),l=dk(),c=u.useCallback(()=>{switch(e){case"inpaint_mask":s();break;case"regional_guidance":i();break;case"raster_layer":o();break;case"control_layer":a();break;case"reference_image":l();break}},[a,l,s,o,i,e]),d=u.useMemo(()=>{switch(e){case"inpaint_mask":return t("controlLayers.addInpaintMask");case"regional_guidance":return t("controlLayers.addRegionalGuidance");case"raster_layer":return t("controlLayers.addRasterLayer");case"control_layer":return t("controlLayers.addControlLayer");case"reference_image":return t("controlLayers.addGlobalReferenceImage")}},[e,t]);return r.jsx(oe,{size:"sm","aria-label":d,tooltip:d,variant:"link",icon:r.jsx(js,{}),onClick:c,alignSelf:"stretch",isDisabled:n})});_z.displayName="CanvasEntityAddOfTypeButton";const Aje=e=>{const t=u.useMemo(()=>{switch(e){case"control_layer":return fe(pP,s=>s.length);case"raster_layer":return fe(_S,s=>s.length);case"inpaint_mask":return fe(mP,s=>s.length);case"regional_guidance":return fe(gP,s=>s.length);case"reference_image":return fe(hee,s=>s.length);default:we(!1,"Invalid entity type")}},[e]);return I(t)},Iz=u.memo(({type:e})=>{const{t}=A(),n=Lt(),s=ut(),i=Aje(e),o=u.useCallback(()=>{n.compositor.mergeVisibleOfType(e)},[n.compositor,e]);return r.jsx(oe,{size:"sm","aria-label":t("controlLayers.mergeVisible"),tooltip:t("controlLayers.mergeVisible"),variant:"link",icon:r.jsx(ahe,{}),onClick:o,alignSelf:"stretch",isDisabled:i<=1||s})});Iz.displayName="CanvasEntityMergeVisibleButton";const Tz=u.memo(({type:e})=>{const{t}=A(),n=G(),s=jk(e),i=hB(e,!0),o=u.useCallback(a=>{a.stopPropagation(),n(fee({type:e}))},[n,e]);return r.jsx(oe,{size:"sm","aria-label":t(s?"controlLayers.hidingType":"controlLayers.showingType",{type:i}),tooltip:t(s?"controlLayers.hidingType":"controlLayers.showingType",{type:i}),variant:"link",icon:s?r.jsx(Fde,{}):r.jsx(yd,{}),onClick:o,alignSelf:"stretch"})});Tz.displayName="CanvasEntityTypeIsHiddenToggle";const Eje=e=>u.useMemo(()=>{switch(e){case"control_layer":return"controlNet";case"inpaint_mask":return"inpainting";case"raster_layer":return"rasterLayer";case"regional_guidance":return"regionalGuidanceAndReferenceImage";case"reference_image":return"globalReferenceImage";default:return}},[e]),Mje=e=>{const t=u.useMemo(()=>fe(tt,s=>{switch(e){case"control_layer":return s.controlLayers.entities.length;case"raster_layer":return s.rasterLayers.entities.length;case"inpaint_mask":return s.inpaintMasks.entities.length;case"regional_guidance":return s.regionalGuidance.entities.length;case"reference_image":return s.referenceImages.entities.length;default:return 0}}),[e]);return I(t)},Pje=e=>{const{t}=A(),n=jk(e),s=Mje(e);return u.useMemo(()=>{const o=n?"hidden":"visible";switch(e){case"control_layer":return t("controlLayers.controlLayers_withCount",{count:s,context:o});case"raster_layer":return t("controlLayers.rasterLayers_withCount",{count:s,context:o});case"inpaint_mask":return t("controlLayers.inpaintMasks_withCount",{count:s,context:o});case"regional_guidance":return t("controlLayers.regionalGuidance_withCount",{count:s,context:o});case"reference_image":return t("controlLayers.globalReferenceImages_withCount",{count:s,context:o});default:return""}},[e,t,s,n])},Rd=u.memo(({isSelected:e,type:t,children:n,entityIdentifiers:s})=>{const i=Pje(t),o=Eje(t),a=Ty(!0),l=G();return u.useEffect(()=>to({canMonitor({source:c}){return!(!_u.typeGuard(c.data)||c.data.payload.entityIdentifier.type!==t)},onDrop({location:c,source:d}){const h=c.current.dropTargets[0];if(!h)return;const f=d.data,p=h.data;if(!_u.typeGuard(f)||!_u.typeGuard(p))return;const g=s.findIndex(x=>x.id===f.payload.entityIdentifier.id),m=s.findIndex(x=>x.id===p.payload.entityIdentifier.id);if(m<0||g<0||g===m)return;const y=mw(p);let b=0;if(y==="bottom"?b=1:y==="top"&&(b=-1),g===m+b)return;mc.flushSync(()=>{l(pee({type:t,entityIdentifiers:kz({list:s,startIndex:g,indexOfTarget:m,closestEdgeOfTarget:y,axis:"vertical"})}))});const C=document.querySelector(`[data-entity-id="${f.payload.entityIdentifier.id}"]`);C instanceof HTMLElement&&mV(C,lo("base.700"))}}),[l,s,t]),r.jsxs(T,{flexDir:"column",w:"full",children:[r.jsxs(T,{w:"full",children:[r.jsxs(T,{flexGrow:1,as:de,onClick:a.toggle,justifyContent:"space-between",alignItems:"center",gap:3,variant:"unstyled",p:0,h:8,children:[r.jsx(lt,{boxSize:4,as:Di,transform:a.isTrue?void 0:"rotate(-90deg)",fill:e?"base.200":"base.500",transitionProperty:"common",transitionDuration:"fast"}),o?r.jsx(ze,{feature:o,children:r.jsx(q,{fontWeight:"semibold",color:e?"base.200":"base.500",userSelect:"none",transitionProperty:"common",transitionDuration:"fast",children:i})}):r.jsx(q,{fontWeight:"semibold",color:e?"base.200":"base.500",userSelect:"none",transitionProperty:"common",transitionDuration:"fast",children:i}),r.jsx(it,{})]}),F2(t)&&r.jsx(Iz,{type:t}),F2(t)&&r.jsx(Tz,{type:t}),r.jsx(_z,{type:t})]}),r.jsx(Ja,{in:a.isTrue,style:N_,children:r.jsx(T,{flexDir:"column",gap:2,pt:2,children:n})})]})});Rd.displayName="CanvasEntityGroupList";const Gm={type:"idle"},Lje=(e,t)=>{const[n,s]=u.useState(Gm),[i,o]=u.useState(!1);return u.useEffect(()=>{const a=e.current;if(a)return qn(Pd(a),pd({element:a,getInitialData(){return _u.getData({entityIdentifier:t})},onDragStart(){s({type:"is-dragging"}),o(!0)},onDrop(){s(Gm),o(!1)}}),Bu({element:a,canDrop({source:l}){return!(!_u.typeGuard(l.data)||l.data.payload.entityIdentifier.type!==t.type)},getData({input:l}){const c=_u.getData({entityIdentifier:t});return Ije(c,{element:a,input:l,allowedEdges:["top","bottom"]})},getIsSticky(){return!0},onDragEnter({self:l}){const c=mw(l.data);s({type:"is-dragging-over",closestEdge:c})},onDrag({self:l}){const c=mw(l.data);s(d=>d.type==="is-dragging-over"&&d.closestEdge===c?d:{type:"is-dragging-over",closestEdge:c})},onDragLeave(){s(Gm)},onDrop(){s(Gm)}}))},[t,e]),[n,i]},Az=e=>{const t=u.useMemo(()=>fe(Tn,s=>(s==null?void 0:s.id)===e.id),[e.id]);return I(t)},P1={thickness:2,backgroundColor:"base.500"},Dje={display:"block",position:"absolute",zIndex:1,borderRadius:"full",pointerEvents:"none",background:P1.backgroundColor},Rje={horizontal:{height:`${P1.thickness}px`,left:2,right:2},vertical:{width:`${P1.thickness}px`,top:2,bottom:2}},Oje={top:"horizontal",bottom:"horizontal",left:"vertical",right:"vertical"},Nje={top:{top:"var(--local-line-offset)"},right:{right:"var(--local-line-offset)"},bottom:{bottom:"var(--local-line-offset)"},left:{left:"var(--local-line-offset)"}};function Fje({edge:e,gap:t="0px"}){const n=`calc(-0.5 * (${t} + ${P1.thickness}px))`,s=Oje[e];return r.jsx(Se,{sx:{...Dje,...Rje[s],...Nje[e],"--local-line-offset":n}})}const Bje=({dndState:e,gap:t})=>e.type!=="is-dragging-over"||!e.closestEdge?null:r.jsx(Fje,{edge:e.closestEdge,gap:t||"var(--invoke-space-2)"}),$je={position:"relative",flexDir:"column",w:"full",bg:"base.850",borderRadius:"base","&[data-selected=true]":{bg:"base.800"},"&[data-is-dragging=true]":{opacity:.3},transitionProperty:"common"},Od=u.memo(e=>{const t=G(),n=Ye(),s=Az(n),i=u.useCallback(()=>{s||t(xu({entityIdentifier:n}))},[t,n,s]),o=u.useRef(null),[a,l]=Lje(o,n);return r.jsxs(Se,{position:"relative",children:[r.jsx(T,{"data-entity-id":n.id,"data-selected":s,"data-is-dragging":l,ref:o,onClick:i,sx:$je,children:e.children}),r.jsx(Bje,{dndState:a})]})});Od.displayName="CanvasEntityContainer";const Nd=u.memo(({children:e,...t})=>{const n=Ye(),s=u.useCallback(()=>{if(n.type==="regional_guidance")return r.jsx(Tt,{children:r.jsx(h_,{})});if(n.type==="inpaint_mask")return r.jsx(Tt,{children:r.jsx(c_,{})});if(n.type==="raster_layer")return r.jsx(Tt,{children:r.jsx(d_,{})});if(n.type==="control_layer")return r.jsx(Tt,{children:r.jsx(l_,{})});if(n.type==="reference_image")return r.jsx(Tt,{children:r.jsx(u_,{})});we(!1,"Unhandled entity type")},[n]);return r.jsx(Ry,{renderMenu:s,children:i=>r.jsx(T,{ref:i,gap:2,alignItems:"center",p:2,...t,children:e})})});Nd.displayName="CanvasEntityHeader";const Ez=u.memo(()=>{const{t:e}=A(),t=Ye(),n=G(),s=ut(),i=u.useCallback(()=>{n(jS({entityIdentifier:t}))},[n,t]);return r.jsx(oe,{size:"sm","aria-label":e("common.delete"),tooltip:e("common.delete"),variant:"link",alignSelf:"stretch",icon:r.jsx(hb,{}),onClick:i,colorScheme:"error",isDisabled:s})});Ez.displayName="CanvasEntityDeleteButton";const Mz=e=>{const t=u.useMemo(()=>fe(tt,s=>{const i=Qa(s,e);return i?i.isEnabled:!1}),[e]);return I(t)},Pz=u.memo(()=>{const{t:e}=A(),t=Ye(),n=Mz(t),s=ut(),i=G(),o=u.useCallback(()=>{i(gee({entityIdentifier:t}))},[i,t]);return r.jsx(oe,{size:"sm","aria-label":e(n?"common.enabled":"common.disabled"),tooltip:e(n?"common.enabled":"common.disabled"),variant:"link",alignSelf:"stretch",icon:n?r.jsx(uhe,{}):r.jsx(Mde,{}),onClick:o,isDisabled:s})});Pz.displayName="CanvasEntityEnabledToggle";const Vje=(e,t)=>fe(tt,Jw,(n,s)=>{const i=Or(n,e,"CanvasEntityHeaderWarnings");let o=[];const a=i.type;return a==="control_layer"?o=oM(i,s):a==="regional_guidance"?o=lM(i,s):a==="inpaint_mask"?o=uM():a==="raster_layer"?o=cM():a==="reference_image"?o=aM(i,s):we(!1,"Unexpected entity type"),o.length===0?Ls:o.map(l=>t(l)).map(wl)}),Lz=u.memo(()=>{const e=Ye(),{t}=A(),n=Mz(e),s=u.useMemo(()=>Vje(e,t),[e,t]),i=I(s);return i.length===0?null:r.jsx(oe,{as:"span",size:"sm",variant:"link",alignSelf:"stretch","aria-label":"warnings",tooltip:r.jsx(Dz,{warnings:i}),icon:r.jsx(ug,{}),colorScheme:"warning",isDisabled:!n})});Lz.displayName="CanvasEntityHeaderWarnings";const Dz=u.memo(e=>{const{t}=A();return r.jsxs(T,{flexDir:"column",children:[r.jsxs(q,{children:[t("controlLayers.warnings.problemsFound"),":"]}),r.jsx(or,{children:e.warnings.map((n,s)=>r.jsx(Rt,{children:n},s))})]})});Dz.displayName="TooltipContent";const zje=e=>{const t=u.useMemo(()=>fe(tt,s=>{var i;return((i=s.bookmarkedEntityIdentifier)==null?void 0:i.id)===e.id}),[e]);return I(t)},Rz=u.memo(()=>{const{t:e}=A(),t=Ye(),n=zje(t),s=G(),i=u.useCallback(()=>{s(n?bI({entityIdentifier:null}):bI({entityIdentifier:t}))},[s,t,n]);return r.jsx(oe,{size:"sm","aria-label":e(n?"controlLayers.removeBookmark":"controlLayers.bookmark"),tooltip:e(n?"controlLayers.removeBookmark":"controlLayers.bookmark"),variant:"link",alignSelf:"stretch",icon:n?r.jsx(che,{}):r.jsx(Ide,{}),onClick:i})});Rz.displayName="CanvasEntityIsBookmarkedForQuickSwitchToggle";const Oz=u.memo(()=>{const{t:e}=A(),t=Ye(),n=Ri(t),s=ut(),i=G(),o=u.useCallback(()=>{i(mee({entityIdentifier:t}))},[i,t]);return r.jsx(oe,{size:"sm","aria-label":e(n?"controlLayers.locked":"controlLayers.unlocked"),tooltip:e(n?"controlLayers.locked":"controlLayers.unlocked"),variant:"link",alignSelf:"stretch",icon:n?r.jsx(o7,{}):r.jsx(ZR,{}),onClick:o,isDisabled:s})});Oz.displayName="CanvasEntityIsLockedToggle";const Fd=u.memo(()=>{const e=Ye();return r.jsxs(T,{alignSelf:"stretch",children:[r.jsx(Lz,{}),r.jsx(Rz,{}),e.type!=="reference_image"&&r.jsx(Oz,{}),r.jsx(Pz,{}),r.jsx(Ez,{})]})});Fd.displayName="CanvasEntityHeaderCommonActions";const Nz=vo.canvas,Gje=36,ZE=`${Gje}px`,Mg=u.memo(()=>{const e=Ye(),t=o1e(e),n=u.useMemo(()=>fe(tt,d=>{const h=Qa(d,e);return h&&(h.type==="inpaint_mask"||h.type==="regional_guidance")?Zl(h.fill.color):null}),[e]),s=yee(n),i=u.useRef(null),o=ae(t.transformer.$pixelRect),a=ae(t.transformer.$nodeRect),l=ae(t.$canvasCache),c=u.useMemo(()=>ii(()=>{if(!i.current)return;const d=i.current.getContext("2d");if(!d)return;const h=t.transformer.$pixelRect.get(),f=t.transformer.$nodeRect.get(),p=t.$canvasCache.get();if(!p||p.width===0||p.height===0||h.width===0||h.height===0){d.clearRect(0,0,i.current.width,i.current.height);return}d.clearRect(0,0,i.current.width,i.current.height),i.current.width=h.width,i.current.height=h.height;const g=h.x-f.x,m=h.y-f.y,y=h.width,b=h.height,C=0,x=0,v=h.width,w=h.height;d.drawImage(p,g,m,y,b,C,x,v,w),s&&(d.fillStyle=s,d.globalCompositeOperation="source-in",d.fillRect(0,0,h.width,h.height))},300),[t.$canvasCache,t.transformer.$nodeRect,t.transformer.$pixelRect,s]);return u.useEffect(c,[c,l,a,o]),r.jsx(Ee,{label:r.jsx(Hje,{canvasRef:i}),p:2,closeOnScroll:!0,children:r.jsxs(T,{position:"relative",alignItems:"center",justifyContent:"center",w:ZE,h:ZE,borderRadius:"sm",borderWidth:1,bg:"base.900",flexShrink:0,children:[r.jsx(Se,{position:"absolute",top:0,right:0,bottom:0,left:0,bgImage:Md,bgSize:"5px"}),r.jsx(Nz,{position:"relative",ref:i,objectFit:"contain",maxW:"full",maxH:"full"})]})})});Mg.displayName="CanvasEntityPreviewImage";const Hje=({canvasRef:e})=>{const t=u.useRef(null);return u.useEffect(()=>{if(!t.current||!e.current)return;const n=t.current.getContext("2d");if(n){if(e.current.width===0||e.current.height===0){n.clearRect(0,0,t.current.width,t.current.height);return}t.current.width=e.current.width,t.current.height=e.current.height,n.clearRect(0,0,t.current.width,t.current.height),n.drawImage(e.current,0,0)}},[e]),r.jsxs(T,{position:"relative",alignItems:"center",justifyContent:"center",w:150,h:150,borderRadius:"sm",borderWidth:1,bg:"base.900",flexShrink:0,children:[r.jsx(Se,{position:"absolute",top:0,right:0,bottom:0,left:0,bgImage:Md,bgSize:"8px"}),r.jsx(Nz,{position:"relative",ref:t,objectFit:"contain",maxW:"full",maxH:"full"})]})},Ub=u.memo(({children:e})=>r.jsx(T,{flexDir:"column",gap:2,px:2,pb:2,children:e}));Ub.displayName="CanvasEntitySettingsWrapper";const aa=({value:e,defaultValue:t,onChange:n,onStartEditing:s,inputRef:i})=>{const[o,a]=u.useState(!1),[l,c]=u.useState(e),d=u.useCallback(()=>{var y;const m=l.trim()||t;c(m),m!==e&&n(m),a(!1),(y=i==null?void 0:i.current)==null||y.setSelectionRange(0,0)},[l,t,e,i,n]),h=u.useCallback(g=>{c(g.target.value)},[]),f=u.useCallback(g=>{g.key==="Enter"&&!g.shiftKey?d():g.key==="Escape"&&(c(e),n(e),a(!1))},[n,d,e]),p=u.useCallback(()=>{a(!0),s==null||s()},[s]);return u.useEffect(()=>{c(e)},[e]),u.useEffect(()=>{var g,m;o&&((g=i==null?void 0:i.current)==null||g.focus(),(m=i==null?void 0:i.current)==null||m.select())},[i,o]),{isEditing:o,startEditing:p,value:l,inputProps:{value:l,onChange:h,onKeyDown:f,onBlur:d}}},Fz=u.memo(e=>{const t=Ye(),n=Az(t),s=hN(t);return r.jsx(q,{size:"sm",fontWeight:"semibold",userSelect:"none",color:n?"base.100":"base.300",...e,children:s})});Fz.displayName="CanvasEntityTitle";const Bd=u.memo(()=>{const e=G(),t=Ye(),n=u.useRef(null),s=uN(t),i=dN(t.type),o=u.useCallback(l=>{e(bee({entityIdentifier:t,name:l}))},[e,t]),a=aa({value:s||i,defaultValue:i,onChange:o,inputRef:n});return a.isEditing?r.jsx(kt,{ref:n,...a.inputProps,variant:"outline",_focusVisible:{borderRadius:"base",h:"unset"}}):r.jsx(Fz,{cursor:"text",onDoubleClick:a.startEditing})});Bd.displayName="CanvasEntityTitleEdit";const Wje=e=>fe(tt,t=>Or(t,e,"ControlLayerBadgesContent").withTransparencyEffect),Bz=u.memo(()=>{const e=Ye("control_layer"),{t}=A(),n=u.useMemo(()=>Wje(e),[e]);return I(n)?r.jsx(Kn,{color:"base.300",bg:"transparent",borderWidth:1,userSelect:"none",children:t("controlLayers.transparency")}):null});Bz.displayName="ControlLayerBadgesContent";const $z=u.memo(()=>{const e=Ye("control_layer");return r.jsx(ra,{entityIdentifier:e,children:r.jsx(Bz,{})})});$z.displayName="ControlLayerBadges";const Uv=$n("gallery"),Sc=({onUpload:e,isDisabled:t,allowMultiple:n})=>{const s=I(Hs),i=I(LM),[o,a]=AM(),l=$9(),{t:c}=A(),d=u.useCallback(async m=>{try{if(n){let y=[];i?y=await Promise.all(m.map((b,C)=>l(b,C))):y=await DM(m.map((b,C)=>({file:b,image_category:"user",is_intermediate:!1,board_id:s==="none"?void 0:s,silent:!1,isFirstUploadOfBatch:C===0}))),e&&e(y)}else{if(m.length>1){Uv.warn("Multiple files dropped but only one allowed");return}if(m.length===0){Uv.warn("No files dropped");return}const y=m[0];we(y!==void 0);const b=await o({file:y,image_category:"user",is_intermediate:!1,board_id:s==="none"?void 0:s,silent:!0}).unwrap();e&&e(b)}}catch{ge({id:"UPLOAD_FAILED",title:c("toast.imageUploadFailed"),status:"error"})}},[n,s,e,o,i,l,c]),h=u.useCallback(m=>{if(m.length>0){const y=m.map(C=>({errors:C.errors.map(({message:x})=>x),file:C.file.path}));Uv.error({errors:y},"Invalid upload");const b=c("toast.uploadFailedInvalidUploadDesc");ge({id:"UPLOAD_FAILED",title:c("toast.uploadFailed"),description:b,status:"error"});return}},[c]),{getRootProps:f,getInputProps:p,open:g}=sa({accept:{"image/png":[".png"],"image/jpeg":[".jpg",".jpeg",".png"],"image/webp":[".webp"]},onDropAccepted:d,onDropRejected:h,disabled:t,noDrag:!0,multiple:n});return{getUploadButtonProps:f,getUploadInputProps:p,openUploader:g,request:a}},Vz={"&[data-error=true]":{borderColor:"error.500",borderStyle:"solid",borderWidth:1}},F_=({isDisabled:e=!1,onUpload:t,isError:n=!1,...s})=>{const i=Sc({isDisabled:e,allowMultiple:!1,onUpload:t});return r.jsxs(r.Fragment,{children:[r.jsx(oe,{"aria-label":"Upload image",variant:"outline",sx:Vz,"data-error":n,icon:r.jsx(lg,{}),isLoading:i.request.isLoading,...s,...i.getUploadButtonProps()}),r.jsx("input",{...i.getUploadInputProps()})]})},Uje=({isDisabled:e=!1,onUpload:t,isError:n=!1,...s})=>{const i=Sc({isDisabled:e,allowMultiple:!0,onUpload:t});return r.jsxs(r.Fragment,{children:[r.jsx(oe,{"aria-label":"Upload image",variant:"outline",sx:Vz,"data-error":n,icon:r.jsx(lg,{}),isLoading:i.request.isLoading,...s,...i.getUploadButtonProps()}),r.jsx("input",{...i.getUploadInputProps()})]})},qje=e=>`${Math.round(e*100)}%`,Kje=["Begin Step %","End Step %"],qb=u.memo(({beginEndStepPct:e,onChange:t})=>{const{t:n}=A(),s=u.useCallback(()=>{t([0,1])},[t]);return r.jsxs(K,{orientation:"horizontal",pe:2,children:[r.jsx(ze,{feature:"controlNetBeginEnd",children:r.jsx(J,{m:0,children:n("controlLayers.beginEndStepPercentShort")})}),r.jsx(xee,{"aria-label":Kje,value:e,onChange:t,onReset:s,min:0,max:1,step:.05,fineStep:.01,minStepsBetweenThumbs:1,formatValue:qje,marks:!0,withThumbTooltip:!0})]})});qb.displayName="BeginEndStepPct";const Zje=e=>e.toFixed(2),Yje=[0,1,2],Xje=fe(Pr,e=>e.sd.ca.weight),Kb=u.memo(({weight:e,onChange:t})=>{const{t:n}=A(),s=I(Xje);return r.jsxs(K,{orientation:"horizontal",children:[r.jsx(ze,{feature:"controlNetWeight",children:r.jsx(J,{m:0,children:n("controlLayers.weight")})}),r.jsx(Ze,{value:e,onChange:t,defaultValue:s.initial,min:s.sliderMin,max:s.sliderMax,step:s.coarseStep,fineStep:s.fineStep,marks:Yje,formatValue:Zje}),r.jsx(Ie,{value:e,onChange:t,min:s.numberInputMin,max:s.numberInputMax,step:s.coarseStep,fineStep:s.fineStep,maxW:20,defaultValue:s.initial})]})});Kb.displayName="Weight";const zz=u.memo(({controlMode:e,onChange:t})=>{const{t:n}=A(),s=u.useMemo(()=>[{label:n("controlLayers.controlMode.balanced"),value:"balanced"},{label:n("controlLayers.controlMode.prompt"),value:"more_prompt"},{label:n("controlLayers.controlMode.control"),value:"more_control"},{label:n("controlLayers.controlMode.megaControl"),value:"unbalanced"}],[n]),i=u.useCallback(a=>{we(vee(a==null?void 0:a.value)),t(a.value)},[t]),o=u.useMemo(()=>s.filter(a=>a.value===e)[0],[s,e]);return e?r.jsxs(K,{children:[r.jsx(ze,{feature:"controlNetControlMode",children:r.jsx(J,{m:0,children:n("controlLayers.controlMode.controlMode")})}),r.jsx(Ne,{value:o,options:s,onChange:i,isClearable:!1,isSearchable:!1})]}):null});zz.displayName="ControlLayerControlAdapterControlMode";const Qje=e=>e.base.toUpperCase(),Jje=e=>`${e.base.toUpperCase()} / ${e.type.replaceAll("_"," ").toUpperCase()}`,eke=fe(nd,e=>{var t;return((t=e.model)==null?void 0:t.base)??"sdxl"}),Zt=e=>{const{t}=A(),n=I(eke),s=I(My),{modelConfigs:i,selectedModel:o,getIsDisabled:a,onChange:l,isLoading:c,groupByType:d=!1}=e,h=u.useMemo(()=>{if(!i)return[];const y=Qw(i,d?Jje:Qje),b=$3(y,(C,x,v)=>(C.push({label:v,options:x.map(w=>({label:w.name,value:w.key,description:s&&w.description||void 0,isDisabled:a?a(w):!1}))}),C),[]);return b.sort(C=>{var x,v;return(v=(x=C.label)==null?void 0:x.split("/")[0])!=null&&v.toLowerCase().includes(n)?-1:1}),b},[i,d,a,n,s]),f=u.useMemo(()=>h.flatMap(y=>y.options).find(y=>o?y.value===o.key:!1)??null,[h,o]),p=u.useCallback(y=>{if(!y){l(null);return}const b=i.find(C=>C.key===y.value);if(!b){l(null);return}l(b)},[i,l]),g=u.useMemo(()=>c?t("common.loading"):h.length===0?t("models.noModelsAvailable"):t("models.selectModel"),[c,h,t]),m=u.useCallback(()=>t("models.noMatchingModels"),[t]);return{options:h,value:f,onChange:p,placeholder:g,noOptionsMessage:m}},Gz=u.memo(({modelKey:e,onChange:t})=>{const{t:n}=A(),s=I(cc),[i,{isLoading:o}]=nfe(),a=u.useMemo(()=>i.find(g=>g.key===e),[i,e]),l=u.useCallback(g=>{g&&t(g)},[t]),c=u.useCallback(g=>{const m=s===g.base;return!!!s||!m},[s]),{options:d,value:h,onChange:f,noOptionsMessage:p}=Zt({modelConfigs:i,onChange:l,selectedModel:a,getIsDisabled:c,isLoading:o,groupByType:!0});return r.jsx(Ee,{label:a==null?void 0:a.description,children:r.jsx(K,{isInvalid:!h||s!==(a==null?void 0:a.base),w:"full",children:r.jsx(Ne,{options:d,placeholder:n("common.placeholderSelectAModel"),value:h,onChange:f,noOptionsMessage:p})})})});Gz.displayName="ControlLayerControlAdapterModel";const tke=e=>fe(tt,t=>Or(t,e,"ControlLayerControlAdapter").controlAdapter),Hz=u.memo(()=>{var C;const{t:e}=A(),{dispatch:t,getState:n}=dn(),s=Ye("control_layer"),i=u.useMemo(()=>tke(s),[s]),o=I(i),a=Lb(s),l=I(Ga),c=i1e("control_layer"),d=u.useCallback(x=>{t(Cee({entityIdentifier:s,beginEndStepPct:x}))},[t,s]),h=u.useCallback(x=>{t(wee({entityIdentifier:s,controlMode:x}))},[t,s]),f=u.useCallback(x=>{t(See({entityIdentifier:s,weight:x}))},[t,s]),p=u.useCallback(x=>{t(jee({entityIdentifier:s,modelConfig:x}));const v=c.filterer.$isFiltering.get(),w=c.filterer.$simple.get();if(v&&!w)return;const S=kB(x);if(!S){v&&c.filterer.cancel();return}const j=S.buildDefaults();v?(c.filterer.$filterConfig.set(j),c.filterer.process()):c.filterer.start(j)},[c.filterer,t,s]),g=qve(s),m=ut(),y=u.useMemo(()=>({onUpload:x=>{mk({entityIdentifier:s,imageDTO:x,dispatch:t,getState:n})},allowMultiple:!1}),[t,s,n]),b=Sc(y);return r.jsxs(T,{flexDir:"column",gap:3,position:"relative",w:"full",children:[r.jsxs(T,{w:"full",gap:2,children:[r.jsx(Gz,{modelKey:((C=o.model)==null?void 0:C.key)??null,onChange:p}),r.jsx(oe,{onClick:a.start,isDisabled:a.isDisabled,size:"sm",alignSelf:"stretch",variant:"link","aria-label":e("controlLayers.filter.filter"),tooltip:e("controlLayers.filter.filter"),icon:r.jsx(Hj,{})}),r.jsx(oe,{onClick:g,isDisabled:m,size:"sm",alignSelf:"stretch",variant:"link","aria-label":e("controlLayers.pullBboxIntoLayer"),tooltip:e("controlLayers.pullBboxIntoLayer"),icon:r.jsx(rl,{})}),r.jsx(oe,{isDisabled:m,size:"sm",alignSelf:"stretch",variant:"link","aria-label":e("accessibility.uploadImage"),tooltip:e("accessibility.uploadImage"),icon:r.jsx(lg,{}),...b.getUploadButtonProps()}),r.jsx("input",{...b.getUploadInputProps()})]}),r.jsx(Kb,{weight:o.weight,onChange:f}),o.type!=="control_lora"&&r.jsx(qb,{beginEndStepPct:o.beginEndStepPct,onChange:d}),o.type==="controlnet"&&!l&&r.jsx(zz,{controlMode:o.controlMode,onChange:h})]})});Hz.displayName="ControlLayerControlAdapter";const Wz=u.memo(()=>{const e=Ye("control_layer"),{dispatch:t,getState:n}=dn(),s=ut(),i=u.useCallback(l=>{mk({imageDTO:l,entityIdentifier:e,dispatch:t,getState:n})},[t,e,n]),o=Sc({onUpload:i,allowMultiple:!1}),a=u.useCallback(()=>{t(jr("gallery"))},[t]);return r.jsxs(T,{flexDir:"column",gap:3,position:"relative",w:"full",p:4,children:[r.jsx(q,{textAlign:"center",color:"base.300",children:r.jsx(Ut,{i18nKey:"controlLayers.controlLayerEmptyState",components:{UploadButton:r.jsx(de,{isDisabled:s,size:"sm",variant:"link",color:"base.300",...o.getUploadButtonProps()}),GalleryButton:r.jsx(de,{onClick:a,isDisabled:s,size:"sm",variant:"link",color:"base.300"})}})}),r.jsx("input",{...o.getUploadInputProps()})]})});Wz.displayName="ControlLayerSettingsEmptyState";const Uz=u.memo(()=>{const e=Ye();return Sg(e)?r.jsx(Wz,{}):r.jsx(Hz,{})});Uz.displayName="ControlLayerSettings";const qz=u.memo(({id:e})=>{const{t}=A(),n=ut(),s=u.useMemo(()=>({id:e,type:"control_layer"}),[e]),i=u.useMemo(()=>dp.getData({entityIdentifier:s},s.id),[s]);return r.jsx(Cc.Provider,{value:s,children:r.jsx(aN,{children:r.jsx(ra,{entityIdentifier:s,children:r.jsxs(Od,{children:[r.jsxs(Nd,{children:[r.jsx(Mg,{}),r.jsx(Bd,{}),r.jsx(it,{}),r.jsx($z,{}),r.jsx(Fd,{})]}),r.jsx(Ub,{children:r.jsx(Uz,{})}),r.jsx(Is,{dndTarget:dp,dndTargetData:i,label:t("controlLayers.replaceLayer"),isDisabled:n})]})})})})});qz.displayName="ControlLayer";const nke=hn(tt,e=>e.controlLayers.entities.map(tr).toReversed()),ske=fe(Tn,e=>(e==null?void 0:e.type)==="control_layer"),Kz=u.memo(()=>{const e=I(ske),t=I(nke);if(t.length===0)return null;if(t.length>0)return r.jsx(Rd,{type:"control_layer",isSelected:e,entityIdentifiers:t,children:t.map(n=>r.jsx(qz,{id:n.id},n.id))})});Kz.displayName="ControlLayerEntityList";const Zz=u.memo(({id:e})=>{const t=u.useMemo(()=>({id:e,type:"inpaint_mask"}),[e]);return r.jsx(Cc.Provider,{value:t,children:r.jsx(lN,{children:r.jsx(ra,{entityIdentifier:t,children:r.jsx(Od,{children:r.jsxs(Nd,{children:[r.jsx(Mg,{}),r.jsx(Bd,{}),r.jsx(it,{}),r.jsx(Fd,{})]})})})})})});Zz.displayName="InpaintMask";const rke=hn(tt,e=>e.inpaintMasks.entities.map(tr).toReversed()),ike=fe(Tn,e=>(e==null?void 0:e.type)==="inpaint_mask"),Yz=u.memo(()=>{const e=I(ike),t=I(rke);if(t.length===0)return null;if(t.length>0)return r.jsx(Rd,{type:"inpaint_mask",isSelected:e,entityIdentifiers:t,children:t.map(n=>r.jsx(Zz,{id:n.id},n.id))})});Yz.displayName="InpaintMaskList";const bw="ViT-L",YE=[{label:"ViT-H",value:"ViT-H"},{label:"ViT-G",value:"ViT-G"},{label:bw,value:bw}],B_=u.memo(({model:e,onChange:t})=>{const{t:n}=A(),s=u.useCallback(l=>{we(kee(l==null?void 0:l.value)),t(l.value)},[t]),i=I(Ga),o=u.useMemo(()=>YE.map(l=>({...l,isDisabled:i&&l.value!==bw})),[i]),a=u.useMemo(()=>YE.find(l=>l.value===e),[e]);return r.jsx(K,{width:"max-content",minWidth:28,children:r.jsx(Ne,{options:o,placeholder:n("common.placeholderSelectAModel"),value:a,onChange:s})})});B_.displayName="CLIPVisionModel";const $_=u.memo(({imageInfluence:e,onChange:t})=>{const{t:n}=A(),s=u.useMemo(()=>[{label:n("controlLayers.fluxReduxImageInfluence.lowest"),value:"lowest"},{label:n("controlLayers.fluxReduxImageInfluence.low"),value:"low"},{label:n("controlLayers.fluxReduxImageInfluence.medium"),value:"medium"},{label:n("controlLayers.fluxReduxImageInfluence.high"),value:"high"},{label:n("controlLayers.fluxReduxImageInfluence.highest"),value:"highest"}],[n]),i=u.useCallback(a=>{we(_ee(a==null?void 0:a.value)),t(a.value)},[t]),o=u.useMemo(()=>s.find(a=>a.value===e),[s,e]);return r.jsxs(K,{children:[r.jsx(J,{m:0,children:n("controlLayers.fluxReduxImageInfluence.imageInfluence")}),r.jsx(Ne,{value:o,options:s,onChange:i})]})});$_.displayName="FLUXReduxImageInfluence";const V_=u.memo(({method:e,onChange:t})=>{const{t:n}=A(),s=I(My),i=u.useMemo(()=>[{label:n("controlLayers.ipAdapterMethod.full"),value:"full",description:s?n("controlLayers.ipAdapterMethod.fullDesc"):void 0},{label:n("controlLayers.ipAdapterMethod.style"),value:"style",description:s?n("controlLayers.ipAdapterMethod.styleDesc"):void 0},{label:n("controlLayers.ipAdapterMethod.composition"),value:"composition",description:s?n("controlLayers.ipAdapterMethod.compositionDesc"):void 0}],[n,s]),o=u.useCallback(l=>{we(Iee(l==null?void 0:l.value)),t(l.value)},[t]),a=u.useMemo(()=>i.find(l=>l.value===e),[i,e]);return r.jsxs(K,{children:[r.jsx(ze,{feature:"ipAdapterMethod",children:r.jsx(J,{m:0,children:n("controlLayers.ipAdapterMethod.ipAdapterMethod")})}),r.jsx(Ne,{value:a,options:i,onChange:o})]})});V_.displayName="IPAdapterMethod";const Xz=u.memo(()=>{const{t:e}=A(),t=Ye("reference_image"),n=G(),s=ut(),i=u.useCallback(h=>{E9({imageDTO:h,entityIdentifier:t,dispatch:n})},[n,t]),o=Sc({onUpload:i,allowMultiple:!1}),a=u.useCallback(()=>{n(jr("gallery"))},[n]),l=r_(t),c=u.useMemo(()=>cp.getData({entityIdentifier:t}),[t]),d=u.useMemo(()=>({UploadButton:r.jsx(de,{isDisabled:s,size:"sm",variant:"link",color:"base.300",...o.getUploadButtonProps()}),GalleryButton:r.jsx(de,{onClick:a,isDisabled:s,size:"sm",variant:"link",color:"base.300"}),PullBboxButton:r.jsx(de,{onClick:l,isDisabled:s,size:"sm",variant:"link",color:"base.300"})}),[s,a,l,o]);return r.jsxs(T,{flexDir:"column",gap:3,position:"relative",w:"full",p:4,children:[r.jsx(q,{textAlign:"center",color:"base.300",children:r.jsx(Ut,{i18nKey:"controlLayers.referenceImageEmptyState",components:d})}),r.jsx("input",{...o.getUploadInputProps()}),r.jsx(Is,{dndTarget:cp,dndTargetData:c,label:e("controlLayers.useImage"),isDisabled:s})]})});Xz.displayName="IPAdapterSettingsEmptyState";const z_=u.memo(({image:e,onChangeImage:t,dndTarget:n,dndTargetData:s})=>{const{t:i}=A(),o=ae(Yn),{currentData:a,isError:l}=nl((e==null?void 0:e.image_name)??Xn),c=u.useCallback(()=>{t(null)},[t]);u.useEffect(()=>{o&&l&&c()},[c,l,o]);const d=u.useCallback(h=>{t(h)},[t]);return r.jsxs(T,{position:"relative",w:"full",h:"full",alignItems:"center","data-error":!a&&!(e!=null&&e.image_name),children:[!a&&r.jsx(F_,{w:"full",h:"full",isError:!a&&!(e!=null&&e.image_name),onUpload:d,fontSize:36}),a&&r.jsxs(r.Fragment,{children:[r.jsx(ul,{imageDTO:a,borderWidth:1,borderStyle:"solid"}),r.jsx(T,{position:"absolute",flexDir:"column",top:2,insetInlineEnd:2,gap:1,children:r.jsx(ea,{onClick:c,icon:r.jsx(ur,{size:16}),tooltip:i("common.reset")})})]}),r.jsx(Is,{dndTarget:n,dndTargetData:s,label:i("gallery.drop")})]})});z_.displayName="IPAdapterImagePreview";const G_=u.memo(({isRegionalGuidance:e,modelKey:t,onChangeModel:n})=>{const{t:s}=A(),i=I(cc),o=u.useCallback(y=>!(e&&y.base==="flux"&&y.type==="ip_adapter"),[e]),[a,{isLoading:l}]=rfe(o),c=u.useMemo(()=>a.find(y=>y.key===t),[a,t]),d=u.useCallback(y=>{y&&n(y)},[n]),h=u.useCallback(y=>{const b=!!i,C=i===y.base;return!b||!C},[i]),{options:f,value:p,onChange:g,noOptionsMessage:m}=Zt({modelConfigs:a,onChange:d,selectedModel:c,getIsDisabled:h,isLoading:l});return r.jsx(Ee,{label:c==null?void 0:c.description,children:r.jsx(K,{isInvalid:!p||i!==(c==null?void 0:c.base),w:"full",children:r.jsx(Ne,{options:f,placeholder:s("common.placeholderSelectAModel"),value:p,onChange:g,noOptionsMessage:m})})})});G_.displayName="IPAdapterModel";const oke=e=>fe(tt,t=>Or(t,e,"IPAdapterSettings").ipAdapter),Qz=u.memo(()=>{var b,C;const{t:e}=A(),t=G(),n=Ye("reference_image"),s=u.useMemo(()=>oke(n),[n]),i=I(s),o=u.useCallback(x=>{t(Tee({entityIdentifier:n,beginEndStepPct:x}))},[t,n]),a=u.useCallback(x=>{t(Aee({entityIdentifier:n,weight:x}))},[t,n]),l=u.useCallback(x=>{t(Eee({entityIdentifier:n,method:x}))},[t,n]),c=u.useCallback(x=>{t(Mee({entityIdentifier:n,imageInfluence:x}))},[t,n]),d=u.useCallback(x=>{t(Pee({entityIdentifier:n,modelConfig:x}))},[t,n]),h=u.useCallback(x=>{t(Lee({entityIdentifier:n,clipVisionModel:x}))},[t,n]),f=u.useCallback(x=>{t(cS({entityIdentifier:n,imageDTO:x}))},[t,n]),p=u.useMemo(()=>{var x;return cp.getData({entityIdentifier:n},(x=i.image)==null?void 0:x.image_name)},[n,(b=i.image)==null?void 0:b.image_name]),g=r_(n),m=ut(),y=I(Ga);return r.jsx(Ub,{children:r.jsxs(T,{flexDir:"column",gap:2,position:"relative",w:"full",children:[r.jsxs(T,{gap:2,alignItems:"center",w:"full",children:[r.jsx(G_,{isRegionalGuidance:!1,modelKey:((C=i.model)==null?void 0:C.key)??null,onChangeModel:d}),i.type==="ip_adapter"&&r.jsx(B_,{model:i.clipVisionModel,onChange:h}),r.jsx(oe,{onClick:g,isDisabled:m,variant:"ghost","aria-label":e("controlLayers.pullBboxIntoReferenceImage"),tooltip:e("controlLayers.pullBboxIntoReferenceImage"),icon:r.jsx(rl,{})})]}),r.jsxs(T,{gap:2,w:"full",children:[i.type==="ip_adapter"&&r.jsxs(T,{flexDir:"column",gap:2,w:"full",children:[!y&&r.jsx(V_,{method:i.method,onChange:l}),r.jsx(Kb,{weight:i.weight,onChange:a}),r.jsx(qb,{beginEndStepPct:i.beginEndStepPct,onChange:o})]}),i.type==="flux_redux"&&r.jsx(T,{flexDir:"column",gap:2,w:"full",alignItems:"flex-start",children:r.jsx($_,{imageInfluence:i.imageInfluence??"lowest",onChange:c})}),r.jsx(T,{alignItems:"center",justifyContent:"center",h:32,w:32,aspectRatio:"1/1",flexGrow:1,children:r.jsx(z_,{image:i.image,onChangeImage:f,dndTarget:cp,dndTargetData:p})})]})]})})});Qz.displayName="IPAdapterSettingsContent";const ake=e=>fe(tt,t=>{const n=Qa(t,e);return!!n&&n.ipAdapter.image!==null}),Jz=u.memo(()=>{const e=Ye("reference_image"),t=u.useMemo(()=>ake(e),[e]);return I(t)?r.jsx(Qz,{}):r.jsx(Xz,{})});Jz.displayName="IPAdapterSettings";const eG=u.memo(({id:e})=>{const t=u.useMemo(()=>({id:e,type:"reference_image"}),[e]);return r.jsx(Cc.Provider,{value:t,children:r.jsx(ra,{entityIdentifier:t,children:r.jsxs(Od,{children:[r.jsxs(Nd,{ps:4,py:5,children:[r.jsx(Bd,{}),r.jsx(it,{}),r.jsx(Fd,{})]}),r.jsx(Jz,{})]})})})});eG.displayName="IPAdapter";const lke=hn(tt,e=>e.referenceImages.entities.map(tr).toReversed()),cke=fe(Tn,e=>(e==null?void 0:e.type)==="reference_image"),tG=u.memo(()=>{const e=I(cke),t=I(lke);if(t.length===0)return null;if(t.length>0)return r.jsx(Rd,{type:"reference_image",isSelected:e,entityIdentifiers:t,children:t.map(n=>r.jsx(eG,{id:n.id},n.id))})});tG.displayName="IPAdapterList";const nG=u.memo(({id:e})=>{const{t}=A(),n=ut(),s=u.useMemo(()=>({id:e,type:"raster_layer"}),[e]),i=u.useMemo(()=>dp.getData({entityIdentifier:s},s.id),[s]);return r.jsx(Cc.Provider,{value:s,children:r.jsx(oN,{children:r.jsx(ra,{entityIdentifier:s,children:r.jsxs(Od,{children:[r.jsxs(Nd,{children:[r.jsx(Mg,{}),r.jsx(Bd,{}),r.jsx(it,{}),r.jsx(Fd,{})]}),r.jsx(Is,{dndTarget:dp,dndTargetData:i,label:t("controlLayers.replaceLayer"),isDisabled:n})]})})})})});nG.displayName="RasterLayer";const uke=hn(tt,e=>e.rasterLayers.entities.map(tr).toReversed()),dke=fe(Tn,e=>(e==null?void 0:e.type)==="raster_layer"),sG=u.memo(()=>{const e=I(dke),t=I(uke);if(t.length===0)return null;if(t.length>0)return r.jsx(Rd,{type:"raster_layer",isSelected:e,entityIdentifiers:t,children:t.map(n=>r.jsx(nG,{id:n.id},n.id))})});sG.displayName="RasterLayerEntityList";const rG=u.memo(()=>{const e=Ye("regional_guidance"),{t}=A(),n=u.useMemo(()=>fe(tt,i=>Or(i,e,"RegionalGuidanceBadges").autoNegative),[e]),s=I(n);return r.jsx(r.Fragment,{children:s&&r.jsx(Kn,{color:"base.300",bg:"transparent",borderWidth:1,userSelect:"none",children:t("controlLayers.autoNegative")})})});rG.displayName="RegionalGuidanceBadges";const hke=()=>{const e=Ye("regional_guidance"),{t}=A(),n=x9(e),s=v9(e),i=C9(e),o=u.useMemo(()=>w9(e),[e]),a=I(o);return r.jsxs(T,{w:"full",p:2,justifyContent:"space-between",children:[r.jsx(de,{size:"sm",variant:"ghost",leftIcon:r.jsx(Vt,{}),onClick:s,isDisabled:!a.canAddPositivePrompt,children:t("controlLayers.prompt")}),r.jsx(de,{size:"sm",variant:"ghost",leftIcon:r.jsx(Vt,{}),onClick:i,isDisabled:!a.canAddNegativePrompt,children:t("controlLayers.negativePrompt")}),r.jsx(de,{size:"sm",variant:"ghost",leftIcon:r.jsx(Vt,{}),onClick:n,children:t("controlLayers.referenceImage")})]})},iG=u.memo(({referenceImageId:e})=>{const{t}=A(),n=Ye("regional_guidance"),s=G(),i=ut(),o=u.useCallback(p=>{M9({imageDTO:p,entityIdentifier:n,referenceImageId:e,dispatch:s})},[s,n,e]),a=Sc({onUpload:o,allowMultiple:!1}),l=u.useCallback(()=>{s(jr("gallery"))},[s]),c=u.useCallback(()=>{s(qP({entityIdentifier:n,referenceImageId:e}))},[s,n,e]),d=YF(n,e),h=u.useMemo(()=>up.getData({entityIdentifier:n,referenceImageId:e}),[n,e]),f=u.useMemo(()=>({UploadButton:r.jsx(de,{isDisabled:i,size:"sm",variant:"link",color:"base.300",...a.getUploadButtonProps()}),GalleryButton:r.jsx(de,{onClick:l,isDisabled:i,size:"sm",variant:"link",color:"base.300"}),PullBboxButton:r.jsx(de,{onClick:d,isDisabled:i,size:"sm",variant:"link",color:"base.300"})}),[i,l,d,a]);return r.jsxs(T,{flexDir:"column",gap:2,position:"relative",w:"full",children:[r.jsxs(T,{alignItems:"center",gap:2,children:[r.jsx(q,{fontWeight:"semibold",color:"base.400",children:t("controlLayers.referenceImage")}),r.jsx(it,{}),r.jsx(oe,{size:"sm",variant:"link",alignSelf:"stretch",icon:r.jsx(Ot,{}),tooltip:t("controlLayers.deleteReferenceImage"),"aria-label":t("controlLayers.deleteReferenceImage"),onClick:c,colorScheme:"error"})]}),r.jsx(T,{alignItems:"center",gap:2,p:4,children:r.jsx(q,{textAlign:"center",color:"base.300",children:r.jsx(Ut,{i18nKey:"controlLayers.referenceImageEmptyState",components:f})})}),r.jsx("input",{...a.getUploadInputProps()}),r.jsx(Is,{dndTarget:up,dndTargetData:h,label:t("controlLayers.useImage"),isDisabled:i})]})});iG.displayName="RegionalGuidanceIPAdapterSettingsEmptyState";const oG=u.memo(({referenceImageId:e})=>{var C,x;const t=Ye("regional_guidance"),{t:n}=A(),s=G(),i=u.useCallback(()=>{s(qP({entityIdentifier:t,referenceImageId:e}))},[s,t,e]),o=u.useMemo(()=>fe(tt,v=>{const w=KP(v,t,e);return we(w,`Regional Guidance IP Adapter with id ${e} not found`),w.ipAdapter}),[t,e]),a=I(o),l=u.useCallback(v=>{s(Dee({entityIdentifier:t,referenceImageId:e,beginEndStepPct:v}))},[s,t,e]),c=u.useCallback(v=>{s(Ree({entityIdentifier:t,referenceImageId:e,weight:v}))},[s,t,e]),d=u.useCallback(v=>{s(Oee({entityIdentifier:t,referenceImageId:e,method:v}))},[s,t,e]),h=u.useCallback(v=>{s(Nee({entityIdentifier:t,referenceImageId:e,imageInfluence:v}))},[s,t,e]),f=u.useCallback(v=>{s(Fee({entityIdentifier:t,referenceImageId:e,modelConfig:v}))},[s,t,e]),p=u.useCallback(v=>{s(Bee({entityIdentifier:t,referenceImageId:e,clipVisionModel:v}))},[s,t,e]),g=u.useCallback(v=>{s(uS({entityIdentifier:t,referenceImageId:e,imageDTO:v}))},[s,t,e]),m=u.useMemo(()=>{var v;return up.getData({entityIdentifier:t,referenceImageId:e},(v=a.image)==null?void 0:v.image_name)},[t,(C=a.image)==null?void 0:C.image_name,e]),y=YF(t,e),b=ut();return r.jsxs(T,{flexDir:"column",gap:2,children:[r.jsxs(T,{alignItems:"center",gap:2,children:[r.jsx(q,{fontWeight:"semibold",color:"base.400",children:n("controlLayers.referenceImage")}),r.jsx(it,{}),r.jsx(oe,{size:"sm",variant:"link",alignSelf:"stretch",icon:r.jsx(Ot,{}),tooltip:n("controlLayers.deleteReferenceImage"),"aria-label":n("controlLayers.deleteReferenceImage"),onClick:i,colorScheme:"error"})]}),r.jsxs(T,{flexDir:"column",gap:2,position:"relative",w:"full",children:[r.jsxs(T,{gap:2,alignItems:"center",w:"full",children:[r.jsx(G_,{isRegionalGuidance:!0,modelKey:((x=a.model)==null?void 0:x.key)??null,onChangeModel:f}),a.type==="ip_adapter"&&r.jsx(B_,{model:a.clipVisionModel,onChange:p}),r.jsx(oe,{onClick:y,isDisabled:b,variant:"ghost","aria-label":n("controlLayers.pullBboxIntoReferenceImage"),tooltip:n("controlLayers.pullBboxIntoReferenceImage"),icon:r.jsx(rl,{})})]}),r.jsxs(T,{gap:2,w:"full",children:[a.type==="ip_adapter"&&r.jsxs(T,{flexDir:"column",gap:2,w:"full",children:[r.jsx(V_,{method:a.method,onChange:d}),r.jsx(Kb,{weight:a.weight,onChange:c}),r.jsx(qb,{beginEndStepPct:a.beginEndStepPct,onChange:l})]}),a.type==="flux_redux"&&r.jsx(T,{flexDir:"column",gap:2,w:"full",children:r.jsx($_,{imageInfluence:a.imageInfluence??"lowest",onChange:h})}),r.jsx(T,{alignItems:"center",justifyContent:"center",h:32,w:32,aspectRatio:"1/1",flexGrow:1,children:r.jsx(z_,{image:a.image,onChangeImage:g,dndTarget:up,dndTargetData:m})})]})]})]})});oG.displayName="RegionalGuidanceIPAdapterSettingsContent";const fke=(e,t)=>fe(tt,n=>{const s=KP(n,e,t);return!!s&&s.ipAdapter.image!==null}),aG=u.memo(({referenceImageId:e})=>{const t=Ye("regional_guidance"),n=u.useMemo(()=>fke(t,e),[t,e]);return I(n)?r.jsx(oG,{referenceImageId:e}):r.jsx(iG,{referenceImageId:e})});aG.displayName="RegionalGuidanceIPAdapterSettings";const lG=u.memo(()=>{const e=Ye("regional_guidance"),t=u.useMemo(()=>hn(tt,s=>{const i=Or(s,e,"RegionalGuidanceIPAdapters").referenceImages.map(({id:o})=>o);return i.length===0?Ls:i}),[e]),n=I(t);return n.length===0?null:r.jsx(r.Fragment,{children:n.map((s,i)=>r.jsxs(u.Fragment,{children:[i>0&&r.jsx(wt,{}),r.jsx(aG,{referenceImageId:s})]},s))})});lG.displayName="RegionalGuidanceLayerIPAdapterList";const H_=u.memo(({onDelete:e,...t})=>{const{t:n}=A();return r.jsx(oe,{tooltip:n("common.delete"),variant:"link","aria-label":n("common.delete"),icon:r.jsx(Ot,{}),onClick:e,flexGrow:0,size:"sm",p:0,colorScheme:"error",...t})});H_.displayName="RegionalGuidanceDeletePromptButton";const jc=u.memo(e=>{const{onOpen:t,isOpen:n}=e,{t:s}=A();return r.jsx(Ee,{label:s("prompt.addPromptTrigger"),children:r.jsx(oe,{variant:"promptOverlay",isDisabled:n,"aria-label":s("prompt.addPromptTrigger"),icon:r.jsx(Lde,{}),onClick:t})})});jc.displayName="AddPromptTriggerButton";const pke=()=>Pe("prompt.noMatchingTriggers"),cG=u.memo(({onSelect:e,onClose:t})=>{const{t:n}=A(),s=I(Ny),i=I($ee),{data:o,isLoading:a}=Up((s==null?void 0:s.key)??Xn),[l,{isLoading:c}]=yb(),[d,{isLoading:h}]=W7(),f=u.useCallback(g=>{if(!g){e("");return}e(g.value)},[e]),p=u.useMemo(()=>{var m;const g=[];if(d){const y=d.filter(b=>b.base===(o==null?void 0:o.base)).map(b=>({label:b.name,value:`<${b.name}>`}));y.length>0&&g.push({label:n("prompt.compatibleEmbeddings"),options:y})}if(l){const y=l.filter(b=>fo(i,C=>C.model.key).includes(b.key)).map(b=>b.trigger_phrases?b.trigger_phrases.map(C=>({label:C,value:C})):[]).flatMap(b=>b);y.length>0&&g.push({label:n("modelManager.loraTriggerPhrases"),options:Vee(y)})}return o&&D0(o)&&((m=o.trigger_phrases)!=null&&m.length)&&g.push({label:n("modelManager.mainModelTriggerPhrases"),options:o.trigger_phrases.map(y=>({label:y,value:y}))}),g},[d,l,o,n,i]);return r.jsx(K,{children:r.jsx(Ne,{placeholder:n(c||h||a?"common.loading":"prompt.addPromptTrigger"),defaultMenuIsOpen:!0,autoFocus:!0,value:null,options:p,noOptionsMessage:pke,onChange:f,onMenuClose:t,"data-testid":"add-prompt-trigger",sx:gke})})});cG.displayName="PromptTriggerSelect";const gke={w:"full"},kc=u.memo(e=>{const{onSelect:t,isOpen:n,onClose:s,width:i,children:o}=e;return r.jsxs(rs,{isOpen:n,onClose:s,placement:"bottom",openDelay:0,closeDelay:0,closeOnBlur:!0,returnFocusOnClose:!1,isLazy:!0,children:[r.jsx(Hp,{children:o}),r.jsx(is,{p:0,insetBlockStart:-1,shadow:"dark-lg",borderColor:"invokeBlue.300",borderWidth:"2px",borderStyle:"solid",children:r.jsx(ms,{p:0,width:`calc(${i}px - 0.25rem)`,children:r.jsx(cG,{onClose:s,onSelect:t})})})]})});kc.displayName="PromptPopover";const $d=({prompt:e,textareaRef:t,onChange:n})=>{const{isOpen:s,onClose:i,onOpen:o}=cr(),a=u.useCallback(p=>{n(p.target.value)},[n]),l=u.useCallback(p=>{if(!t.current)return;const g=t.current.selectionStart;if(qe(g))return;let m=e.slice(0,g);m+=`${p}`;const y=m.length;m+=e.slice(g),mc.flushSync(()=>{n(m)}),t.current.selectionStart=y,t.current.selectionEnd=y},[t,n,e]),c=u.useCallback(()=>{var p;(p=t.current)==null||p.focus()},[t]),d=u.useCallback(()=>{i(),c()},[c,i]),h=u.useCallback(p=>{l(p),d()},[d,l]),f=u.useCallback(p=>{p.key==="<"&&(o(),p.preventDefault())},[o]);return{onChange:a,isOpen:s,onClose:i,onOpen:o,onSelect:h,onKeyDown:f,onFocus:c}},mke={outline:"none"},uG=u.memo(()=>{var m;const e=Ye("regional_guidance"),t=u.useMemo(()=>fe(tt,y=>Or(y,e,"RegionalGuidanceNegativePrompt").negativePrompt??""),[e]),n=I(t),s=G(),i=u.useRef(null),{t:o}=A(),a=u.useCallback(y=>{s(A2({entityIdentifier:e,prompt:y}))},[s,e]),l=u.useCallback(()=>{s(A2({entityIdentifier:e,prompt:null}))},[s,e]),{onChange:c,isOpen:d,onClose:h,onOpen:f,onSelect:p,onKeyDown:g}=$d({prompt:n,textareaRef:i,onChange:a});return r.jsx(kc,{isOpen:d,onClose:h,onSelect:p,width:(m=i.current)==null?void 0:m.clientWidth,children:r.jsxs(Se,{pos:"relative",w:"full",children:[r.jsx(ss,{id:"prompt",name:"prompt",ref:i,value:n,placeholder:o("parameters.negativePromptPlaceholder"),onChange:c,onKeyDown:g,variant:"outline",paddingInlineStart:2,paddingInlineEnd:8,fontSize:"sm",zIndex:"0 !important",_focusVisible:mke}),r.jsxs(T,{flexDir:"column",gap:2,position:"absolute",insetBlockStart:2,insetInlineEnd:0,alignItems:"center",justifyContent:"center",children:[r.jsx(H_,{onDelete:l}),r.jsx(jc,{isOpen:d,onOpen:f})]})]})})});uG.displayName="RegionalGuidanceNegativePrompt";const yke={outline:"none"},dG=u.memo(()=>{var m;const e=Ye("regional_guidance"),t=u.useMemo(()=>fe(tt,y=>Or(y,e,"RegionalGuidancePositivePrompt").positivePrompt??""),[e]),n=I(t),s=G(),i=u.useRef(null),{t:o}=A(),a=u.useCallback(y=>{s(T2({entityIdentifier:e,prompt:y}))},[s,e]),l=u.useCallback(()=>{s(T2({entityIdentifier:e,prompt:null}))},[s,e]),{onChange:c,isOpen:d,onClose:h,onOpen:f,onSelect:p,onKeyDown:g}=$d({prompt:n,textareaRef:i,onChange:a});return r.jsx(kc,{isOpen:d,onClose:h,onSelect:p,width:(m=i.current)==null?void 0:m.clientWidth,children:r.jsxs(Se,{pos:"relative",w:"full",children:[r.jsx(ss,{id:"prompt",name:"prompt",ref:i,value:n,placeholder:o("parameters.positivePromptPlaceholder"),onChange:c,onKeyDown:g,variant:"outline",paddingInlineStart:2,paddingInlineEnd:8,minH:28,zIndex:"0 !important",_focusVisible:yke}),r.jsxs(T,{flexDir:"column",gap:2,position:"absolute",insetBlockStart:2,insetInlineEnd:0,alignItems:"center",justifyContent:"center",children:[r.jsx(H_,{onDelete:l}),r.jsx(jc,{isOpen:d,onOpen:f})]})]})})});dG.displayName="RegionalGuidancePositivePrompt";const bke=e=>hn(tt,t=>{const n=Or(t,e,"RegionalGuidanceSettings");return{hasPositivePrompt:n.positivePrompt!==null,hasNegativePrompt:n.negativePrompt!==null,hasIPAdapters:n.referenceImages.length>0}}),hG=u.memo(()=>{const e=Ye("regional_guidance"),t=u.useMemo(()=>bke(e),[e]),n=I(t);return r.jsxs(Ub,{children:[!n.hasPositivePrompt&&!n.hasNegativePrompt&&!n.hasIPAdapters&&r.jsx(hke,{}),n.hasPositivePrompt&&r.jsxs(r.Fragment,{children:[r.jsx(dG,{}),!n.hasNegativePrompt&&n.hasIPAdapters&&r.jsx(wt,{})]}),n.hasNegativePrompt&&r.jsxs(r.Fragment,{children:[r.jsx(uG,{}),n.hasIPAdapters&&r.jsx(wt,{})]}),n.hasIPAdapters&&r.jsx(lG,{})]})});hG.displayName="RegionalGuidanceSettings";const fG=u.memo(({id:e})=>{const t=u.useMemo(()=>({id:e,type:"regional_guidance"}),[e]);return r.jsx(Cc.Provider,{value:t,children:r.jsx(cN,{children:r.jsx(ra,{entityIdentifier:t,children:r.jsxs(Od,{children:[r.jsxs(Nd,{children:[r.jsx(Mg,{}),r.jsx(Bd,{}),r.jsx(it,{}),r.jsx(rG,{}),r.jsx(Fd,{})]}),r.jsx(hG,{})]})})})})});fG.displayName="RegionalGuidance";const xke=hn(tt,e=>e.regionalGuidance.entities.map(tr).toReversed()),vke=fe(Tn,e=>(e==null?void 0:e.type)==="regional_guidance"),pG=u.memo(()=>{const e=I(vke),t=I(xke);if(t.length===0)return null;if(t.length>0)return r.jsx(Rd,{type:"regional_guidance",isSelected:e,entityIdentifiers:t,children:t.map(n=>r.jsx(fG,{id:n.id},n.id))})});pG.displayName="RegionalGuidanceEntityList";const gG=u.memo(()=>r.jsx(os,{children:r.jsxs(T,{flexDir:"column",gap:2,"data-testid":"control-layers-layer-list",w:"full",h:"full",children:[r.jsx(tG,{}),r.jsx(Yz,{}),r.jsx(pG,{}),r.jsx(Kz,{}),r.jsx(sG,{})]})}));gG.displayName="CanvasEntityList";const mG=u.memo(()=>{const{t:e}=A(),t=ut(),n=dk(),s=ck(),i=uk(),o=b9(),a=lk(),l=ak(),c=Au("reference_image"),d=Au("regional_guidance"),h=Au("control_layer");return r.jsxs(en,{children:[r.jsx(tn,{as:oe,minW:8,variant:"link",alignSelf:"stretch",tooltip:e("controlLayers.addLayer"),"aria-label":e("controlLayers.addLayer"),icon:r.jsx(Vt,{}),"data-testid":"control-layers-add-layer-menu-button",isDisabled:t}),r.jsxs(Tt,{children:[r.jsx(Sr,{title:e("controlLayers.global"),children:r.jsx(pe,{icon:r.jsx(Vt,{}),onClick:n,isDisabled:!c,children:e("controlLayers.globalReferenceImage")})}),r.jsxs(Sr,{title:e("controlLayers.regional"),children:[r.jsx(pe,{icon:r.jsx(Vt,{}),onClick:s,children:e("controlLayers.inpaintMask")}),r.jsx(pe,{icon:r.jsx(Vt,{}),onClick:i,isDisabled:!d,children:e("controlLayers.regionalGuidance")}),r.jsx(pe,{icon:r.jsx(Vt,{}),onClick:o,isDisabled:!d,children:e("controlLayers.regionalReferenceImage")})]}),r.jsxs(Sr,{title:e("controlLayers.layer_other"),children:[r.jsx(pe,{icon:r.jsx(Vt,{}),onClick:l,isDisabled:!h,children:e("controlLayers.controlLayer")}),r.jsx(pe,{icon:r.jsx(Vt,{}),onClick:a,children:e("controlLayers.rasterLayer")})]})]})]})});mG.displayName="EntityListGlobalActionBarAddLayerMenu";const yG=u.memo(()=>{const{t:e}=A(),t=G(),n=ut(),s=I(Tn),i=u.useCallback(()=>{s&&t(nP({entityIdentifier:s}))},[t,s]);return r.jsx(oe,{onClick:i,isDisabled:!s||n,minW:8,variant:"link",alignSelf:"stretch","aria-label":e("controlLayers.duplicate"),tooltip:e("controlLayers.duplicate"),icon:r.jsx(i7,{})})});yG.displayName="EntityListSelectedEntityActionBarDuplicateButton";const qv={width:6,height:6,borderColor:"base.100"},Cke={".react-colorful__hue-pointer":qv,".react-colorful__saturation-pointer":qv,".react-colorful__alpha-pointer":qv,gap:4,flexDir:"column"},wke={width:"100%"},Kv="3.5rem",Ske=e=>{const{color:t,onChange:n,withNumberInput:s=!1,withSwatches:i=!1}=e,{t:o}=A(),a=u.useCallback(d=>n({...t,r:d}),[t,n]),l=u.useCallback(d=>n({...t,g:d}),[t,n]),c=u.useCallback(d=>n({...t,b:d}),[t,n]);return r.jsxs(T,{sx:Cke,children:[r.jsx(WCe,{color:t,onChange:n,style:wke}),s&&r.jsxs(T,{gap:4,children:[r.jsxs(K,{gap:0,children:[r.jsx(J,{children:o("common.red")[0]}),r.jsx(Ie,{flexGrow:1,value:t.r,onChange:a,min:0,max:255,step:1,w:Kv,defaultValue:90})]}),r.jsxs(K,{gap:0,children:[r.jsx(J,{children:o("common.green")[0]}),r.jsx(Ie,{flexGrow:1,value:t.g,onChange:l,min:0,max:255,step:1,w:Kv,defaultValue:90})]}),r.jsxs(K,{gap:0,children:[r.jsx(J,{children:o("common.blue")[0]}),r.jsx(Ie,{flexGrow:1,value:t.b,onChange:c,min:0,max:255,step:1,w:Kv,defaultValue:255})]})]}),i&&r.jsx(T,{gap:2,justifyContent:"space-between",children:NCe.map((d,h)=>r.jsx(kke,{color:d,onChange:n},h))})]})},jke=u.memo(Ske),kke=({color:e,onChange:t})=>{const n=u.useCallback(()=>{t(e)},[e,t]);return r.jsx(Se,{role:"button",onClick:n,h:8,w:8,bg:Zl(e),borderRadius:"base"})},bG=u.memo(({style:e,onChange:t})=>{const{t:n}=A(),s=u.useCallback(a=>{zee(a==null?void 0:a.value)&&t(a.value)},[t]),i=u.useMemo(()=>[{value:"solid",label:n("controlLayers.fill.solid")},{value:"diagonal",label:n("controlLayers.fill.diagonal")},{value:"crosshatch",label:n("controlLayers.fill.crosshatch")},{value:"grid",label:n("controlLayers.fill.grid")},{value:"horizontal",label:n("controlLayers.fill.horizontal")},{value:"vertical",label:n("controlLayers.fill.vertical")}],[n]),o=u.useMemo(()=>i.find(a=>a.value===e),[i,e]);return r.jsxs(K,{children:[r.jsx(J,{m:0,children:n("controlLayers.fill.fillStyle")}),r.jsx(Ne,{value:o,options:i,onChange:s,isSearchable:!1})]})});bG.displayName="MaskFillStyle";const xG=u.memo(()=>{const{t:e}=A(),t=G(),n=I(Tn),s=I(Gee),i=u.useCallback(a=>{n&&V2(n)&&t(Hee({entityIdentifier:n,color:a}))},[t,n]),o=u.useCallback(a=>{n&&V2(n)&&t(Wee({entityIdentifier:n,style:a}))},[t,n]);return!n||!s?null:r.jsxs(rs,{isLazy:!0,children:[r.jsx(gs,{children:r.jsx(T,{role:"button","aria-label":e("controlLayers.maskFill"),tabIndex:-1,w:8,h:8,children:r.jsx(Ee,{label:e("controlLayers.maskFill"),children:r.jsx(T,{w:"full",h:"full",alignItems:"center",justifyContent:"center",children:r.jsx(Se,{borderRadius:"full",borderColor:"base.600",w:6,h:6,borderWidth:2,bg:Zl(s.color)})})})})}),r.jsx(is,{children:r.jsx(ms,{minH:64,children:r.jsxs(T,{flexDir:"column",gap:4,children:[r.jsx(jke,{color:s.color,onChange:i,withNumberInput:!0,withSwatches:!0}),r.jsx(bG,{style:s.style,onChange:o})]})})})]})});xG.displayName="EntityListSelectedEntityActionBarFill";const vG=u.memo(()=>{const{t:e}=A(),t=I(Tn),n=Lb(t);return!t||!P2(t)?null:r.jsx(oe,{onClick:n.start,isDisabled:n.isDisabled,minW:8,variant:"link",alignSelf:"stretch","aria-label":e("controlLayers.filter.filter"),tooltip:e("controlLayers.filter.filter"),icon:r.jsx(Hj,{})})});vG.displayName="EntityListSelectedEntityActionBarFilterButton";function _ke(e){return isNaN(Number(e))?"":`${Ap(Number(e),2).toLocaleString()}%`}function Ike(e){return e/100}function eu(e){return e*100}function Tke(e){return String(e)}const xw=[eu(0),eu(.25),eu(.5),eu(.75),eu(1)],Ake=eu(1),Eke=xw.slice(1,xw.length-1),Mke=fe(tt,e=>{const t=e.selectedEntityIdentifier;if(!t)return 1;const n=Qa(e,t);return!n||!Uee(n)?1:n.opacity}),CG=u.memo(()=>{const{t:e}=A(),t=G(),n=I(Tn),s=I(Mke),[i,o]=u.useState(s*100),a=u.useCallback(h=>{if(!n)return;let f=h;IS.get()||(f=DP(h,Eke,2));const p=Ike(f);t(xI({entityIdentifier:n,opacity:p}))},[t,n]),l=u.useCallback(()=>{if(n){if(isNaN(Number(i))){o(100);return}t(xI({entityIdentifier:n,opacity:uo(i/100,0,1)}))}},[t,i,n]),c=u.useCallback((h,f)=>{o(f)},[]),d=u.useCallback(h=>{h.key==="Enter"&&l()},[l]);return u.useEffect(()=>{o((s??1)*100)},[s]),r.jsxs(rs,{children:[r.jsxs(K,{w:"min-content",gap:2,isDisabled:n===null||n.type==="reference_image",children:[r.jsx(J,{m:0,children:e("controlLayers.opacity")}),r.jsx(Hp,{children:r.jsxs(Ly,{display:"flex",alignItems:"center",min:0,max:100,step:1,value:i,onChange:c,onBlur:l,w:"76px",format:_ke,defaultValue:1,onKeyDown:d,clampValueOnBlur:!1,variant:"outline",children:[r.jsx(Dy,{paddingInlineEnd:7,_focusVisible:{zIndex:0},title:""}),r.jsx(gs,{children:r.jsx(oe,{"aria-label":"open-slider",icon:r.jsx(Di,{}),size:"sm",variant:"link",position:"absolute",insetInlineEnd:0,h:"full",isDisabled:n===null||n.type==="reference_image"})})]})})]}),r.jsxs(is,{w:200,pt:0,pb:2,px:4,children:[r.jsx(Li,{}),r.jsx(ms,{children:r.jsx(Ze,{min:0,max:100,value:i,onChange:a,defaultValue:Ake,marks:xw,formatValue:Tke,alwaysShowMarks:!0,isDisabled:n===null||n.type==="reference_image"})})]})]})});CG.displayName="EntityListSelectedEntityActionBarOpacity";const wG=u.memo(()=>{const{t:e}=A(),t=I(Tn),n=JF(t);return!t||!L2(t)?null:r.jsx(oe,{onClick:n.start,isDisabled:n.isDisabled,minW:8,variant:"link",alignSelf:"stretch","aria-label":e("controlLayers.selectObject.selectObject"),tooltip:e("controlLayers.selectObject.selectObject"),icon:r.jsx(c7,{})})});wG.displayName="EntityListSelectedEntityActionBarSelectObjectButton";const SG=u.memo(()=>{const{t:e}=A(),t=I(Tn),n=a_(t);return!t||!i0(t)?null:r.jsx(oe,{onClick:n.start,isDisabled:n.isDisabled,minW:8,variant:"link",alignSelf:"stretch","aria-label":e("controlLayers.transform.transform"),tooltip:e("controlLayers.transform.transform"),icon:r.jsx(ag,{})})});SG.displayName="EntityListSelectedEntityActionBarTransformButton";const jG=u.memo(()=>{const{t:e}=A(),t=ut(),n=I(Tn),s=ko(n),i=QF(),o=u.useCallback(()=>{i(s)},[i,s]);return!n||!qee(n)?null:r.jsx(oe,{onClick:o,isDisabled:!n||t,minW:8,variant:"link",alignSelf:"stretch","aria-label":e("controlLayers.saveLayerToAssets"),tooltip:e("controlLayers.saveLayerToAssets"),icon:r.jsx(so,{})})});jG.displayName="EntityListSelectedEntityActionBarSaveToAssetsButton";const kG=u.memo(()=>r.jsxs(T,{w:"full",gap:2,alignItems:"center",ps:1,children:[r.jsx(CG,{}),r.jsx(it,{}),r.jsx(xG,{}),r.jsxs(T,{h:"full",children:[r.jsx(wG,{}),r.jsx(vG,{}),r.jsx(SG,{}),r.jsx(jG,{}),r.jsx(yG,{}),r.jsx(mG,{})]})]}));kG.displayName="EntityListSelectedEntityActionBar";const Pke=({amplitude:e,stroke:t,strokeWidth:n,width:s,height:i,segments:o=5})=>{const a=()=>{if(e===0)return`M0,${i/2} L${s},${i/2}`;const l=Math.min(i/2,e),c=s/o;let d=`M0,${i/2}`;for(let h=1;h<=o;h++){const f=h*c,p=i/2+(h%2===0?l:-l);d+=` Q${f-c/2},${p} ${f},${i/2}`}return d};return r.jsx("svg",{width:s,height:i,viewBox:`0 0 ${s} ${i}`,xmlns:"http://www.w3.org/2000/svg",children:r.jsx("path",{d:a(),fill:"none",stroke:t,strokeWidth:n})})},_G=()=>{const e=I(ZP),{currentData:t}=Up(e??Xn);return t},Lke=fe(_S,e=>e.length>0),IG=u.memo(()=>{const e=I(Kee),t=G(),n=I(Lke),s=_G(),i=u.useCallback(d=>{t(Zee(d))},[t]),o=I(Yee),{t:a}=A(),[l]=PS("colors",["invokeBlue.300"]),c=u.useMemo(()=>!n||(s==null?void 0:s.type)==="main"&&(s==null?void 0:s.base)==="flux"&&s.variant==="inpaint",[n,s]);return r.jsxs(K,{isDisabled:c,p:1,justifyContent:"space-between",h:8,children:[r.jsxs(T,{gap:3,alignItems:"center",children:[r.jsx(ze,{feature:"paramDenoisingStrength",children:r.jsx(J,{mr:0,children:`${a("parameters.denoisingStrength")}`})}),n&&r.jsx(Pke,{amplitude:e*10,stroke:l,strokeWidth:1,width:40,height:14})]}),c?r.jsx(T,{alignItems:"center",children:r.jsx(Kn,{opacity:"0.6",children:a("parameters.disabledNoRasterContent")})}):r.jsxs(r.Fragment,{children:[r.jsx(Ze,{step:o.coarseStep,fineStep:o.fineStep,min:o.sliderMin,max:o.sliderMax,defaultValue:o.initial,onChange:i,value:e}),r.jsx(Ie,{step:o.coarseStep,fineStep:o.fineStep,min:o.numberInputMin,max:o.numberInputMax,defaultValue:o.initial,onChange:i,value:e,variant:"outline"})]})]})});IG.displayName="ParamDenoisingStrength";const Dke={width:"full",height:"full"},TG=u.memo(()=>{const e=I(Xee);return r.jsx(_d,{region:"layers",sx:Dke,children:r.jsxs(T,{flexDir:"column",gap:2,w:"full",h:"full",children:[r.jsx(kG,{}),r.jsx(wt,{py:0}),r.jsx(IG,{}),r.jsx(wt,{py:0}),!e&&r.jsx(Sz,{}),e&&r.jsx(gG,{})]})})});TG.displayName="CanvasLayersPanelContent";const AG=u.memo(()=>{const e=ae(Qee),t=ae(vS);return e&&t?r.jsx(by,{fontSize:"md",fontWeight:"semibold",noOfLines:1,wordBreak:"break-all",href:t,children:e}):null});AG.displayName="GalleryHeader";const Eu=Symbol("NO_SIZE"),vw=e=>{const t=u.useRef(null),[n,s]=u.useState(1),[i,o]=u.useState(1),a=u.useCallback(()=>{if(!(t!=null&&t.current))return;const C=Zv(e.minSizePx,e.imperativePanelGroupRef,e.panelGroupDirection),x=Zv(e.defaultSizePx??e.minSizePx,e.imperativePanelGroupRef,e.panelGroupDirection);if(C===Eu||x===Eu)return;s(C),x>C?o(x):o(C);const v=t.current.getSize();!t.current.isCollapsed()&&v<C&&C>0&&t.current.resize(C)},[e.defaultSizePx,e.imperativePanelGroupRef,e.minSizePx,e.panelGroupDirection]);u.useLayoutEffect(()=>{if(!e.imperativePanelGroupRef.current)return;const C=e.imperativePanelGroupRef.current.getId(),x=zb(C),v=Ql(C);if(!x)return;const w=new ResizeObserver(a);return w.observe(x),v.forEach(S=>w.observe(S)),a(),()=>{w.disconnect()}},[e.imperativePanelGroupRef,a]);const[l,c]=u.useState(()=>{var C;return!!((C=t.current)!=null&&C.isCollapsed())}),d=u.useCallback(()=>{var C;c(!0),(C=e.onCollapse)==null||C.call(e,!0)},[e]),h=u.useCallback(()=>{var C;c(!1),(C=e.onCollapse)==null||C.call(e,!1)},[e]),f=u.useCallback(()=>{var C,x,v;(C=t.current)!=null&&C.isCollapsed()?(x=t.current)==null||x.expand():(v=t.current)==null||v.collapse()},[]),p=u.useCallback(()=>{var C;(C=t.current)==null||C.expand()},[]),g=u.useCallback(()=>{var C;(C=t.current)==null||C.collapse()},[]),m=u.useCallback(C=>{var v;const x=Zv(C,e.imperativePanelGroupRef,e.panelGroupDirection);x!==Eu&&((v=t.current)==null||v.resize(x))},[e]),y=u.useCallback(()=>{var C;(C=t.current)==null||C.resize(n)},[n]),b=u.useCallback(()=>{var C,x;if(Math.abs((((C=t.current)==null?void 0:C.getSize())??0)-i)<.01){g();return}(x=t.current)==null||x.resize(i)},[i,g]);return{isCollapsed:l,reset:y,toggle:f,expand:p,collapse:g,resize:m,panelProps:{id:e.id,defaultSize:i,onCollapse:d,onExpand:h,ref:t,minSize:n},resizeHandleProps:{onDoubleClick:b}}},Zv=(e,t,n)=>{if(!t.current)return Eu;const s=t.current.getId(),i=zb(s);if(!i)return Eu;let o=n==="horizontal"?i.offsetWidth:i.offsetHeight;return o?(Ql(s).forEach(a=>{o-=n==="horizontal"?a.offsetWidth:a.offsetHeight}),Math.max(Math.min(e/o*100,100),1)):Eu},W_=fe(Pr,e=>e.allowPrivateBoards),Rke=({isPrivateBoard:e})=>{const{t}=A(),n=G(),s=I(W_),[i,{isLoading:o}]=Jee(),a=u.useMemo(()=>t(s?e?"boards.addPrivateBoard":"boards.addSharedBoard":"boards.addBoard"),[s,e,t]),l=u.useCallback(async()=>{try{const c=await i({board_name:t("boards.myBoard"),is_private:e}).unwrap();n(Hf({boardId:c.board_id})),n(B0(""))}catch{}},[t,i,e,n]);return r.jsx(oe,{icon:r.jsx(Vt,{}),isLoading:o,tooltip:a,"aria-label":a,onClick:l,size:"md","data-testid":"add-board-button",variant:"link",w:8,h:8})},Oke=u.memo(Rke),U_=u.memo(()=>{const{t:e}=A();return r.jsx(Kn,{color:"invokeBlue.400",borderColor:"invokeBlue.700",borderWidth:1,bg:"transparent",flexShrink:0,children:e("common.auto")})});U_.displayName="AutoAddBadge";const Nke=({board:e,children:t})=>{const{t:n}=A(),s=G(),i=I(ad),o=u.useMemo(()=>fe(Hs,C=>e.board_id===C),[e.board_id]),[a]=YP(),l=I(o),c=pg(e.board_id),d=Bt("bulkDownload"),[h]=bS(),f=u.useCallback(()=>{s(qp(e.board_id))},[e.board_id,s]),p=u.useCallback(()=>{h({image_names:[],board_id:e.board_id})},[e.board_id,h]),g=u.useCallback(async()=>{try{await a({board_id:e.board_id,changes:{archived:!0}}).unwrap()}catch{ge({status:"error",title:"Unable to archive board"})}},[e.board_id,a]),m=u.useCallback(()=>{a({board_id:e.board_id,changes:{archived:!1}})},[e.board_id,a]),y=u.useCallback(()=>{hf.set(e)},[e]),b=u.useCallback(()=>r.jsx(Tt,{visibility:"visible",children:r.jsxs(Sr,{title:c,children:[!i&&r.jsx(pe,{icon:r.jsx(Vt,{}),isDisabled:l,onClick:f,children:n(l?"boards.selectedForAutoAdd":"boards.menuItemAutoAdd")}),d&&r.jsx(pe,{icon:r.jsx(HR,{}),onClickCapture:p,children:n("boards.downloadBoard")}),e.archived&&r.jsx(pe,{icon:r.jsx(OR,{}),onClick:m,children:n("boards.unarchiveBoard")}),!e.archived&&r.jsx(pe,{icon:r.jsx(lhe,{}),onClick:g,children:n("boards.archiveBoard")}),r.jsx(pe,{color:"error.300",icon:r.jsx(ri,{}),onClick:y,isDestructive:!0,children:n("boards.deleteBoard")})]})}),[c,i,l,f,n,d,p,e.archived,m,g,y]);return r.jsx(Ry,{renderMenu:b,children:t})},Fke=u.memo(Nke),EG=u.memo(({board:e,isSelected:t})=>{const{t:n}=A(),s=Ty(!1),i=u.useRef(null),[o,a]=YP(),l=u.useCallback(async d=>{(await fs(()=>o({board_id:e.board_id,changes:{board_name:d}}).unwrap())).isErr()&&ge({status:"error",title:n("boards.updateBoardError")})},[e.board_id,n,o]),c=aa({value:e.board_name,defaultValue:e.board_name,onChange:l,inputRef:i,onStartEditing:s.setTrue});return c.isEditing?r.jsx(kt,{ref:i,...c.inputProps,variant:"outline",isDisabled:a.isLoading,_focusVisible:{borderWidth:1,borderColor:"invokeBlueAlpha.400",borderRadius:"base"}}):r.jsxs(T,{alignItems:"center",gap:3,onMouseOver:s.setTrue,onMouseOut:s.setFalse,children:[r.jsx(q,{size:"sm",fontWeight:"semibold",userSelect:"none",color:t?"base.100":"base.300",onDoubleClick:c.startEditing,cursor:"text",children:c.value}),s.isTrue&&r.jsx(oe,{"aria-label":"edit name",icon:r.jsx(cb,{}),size:"sm",variant:"ghost",onClick:c.startEditing})]})});EG.displayName="CanvasEntityTitleEdit";const MG=({board:e})=>{const{t}=A(),{imagesTotal:n}=XP((e==null?void 0:e.board_id)||"none",{selectFromResult:({data:o})=>({imagesTotal:(o==null?void 0:o.total)??0})}),{assetsTotal:s}=ete((e==null?void 0:e.board_id)||"none",{selectFromResult:({data:o})=>({assetsTotal:(o==null?void 0:o.total)??0})}),{currentData:i}=nl((e==null?void 0:e.cover_image_name)??Xn);return r.jsxs(T,{flexDir:"column",alignItems:"center",gap:1,children:[i&&r.jsx(Wt,{src:i.thumbnail_url,draggable:!1,objectFit:"cover",maxW:150,aspectRatio:"1/1",borderRadius:"base",borderBottomRadius:"lg"}),r.jsxs(T,{flexDir:"column",alignItems:"center",children:[r.jsxs(q,{noOfLines:1,children:[t("boards.imagesWithCount",{count:n}),", ",t("boards.assetsWithCount",{count:s})]}),(e==null?void 0:e.archived)&&r.jsxs(q,{children:["(",t("boards.archived"),")"]})]})]})},Bke={bg:"base.850"},$ke=({board:e,isSelected:t})=>{const n=G(),{t:s}=A(),i=I(Hs),o=I(ad),a=I(LS),l=u.useCallback(()=>{a!==e.board_id&&n(Hf({boardId:e.board_id})),o&&i!==e.board_id&&n(qp(e.board_id))},[a,e.board_id,o,i,n]),c=u.useMemo(()=>x1.getData({boardId:e.board_id}),[e.board_id]);return r.jsxs(Se,{position:"relative",w:"full",h:12,children:[r.jsx(Fke,{board:e,children:d=>r.jsx(Ee,{label:r.jsx(MG,{board:e}),openDelay:1e3,placement:"left",closeOnScroll:!0,p:2,children:r.jsxs(T,{ref:d,onClick:l,alignItems:"center",borderRadius:"base",cursor:"pointer",py:1,ps:1,pe:4,gap:4,bg:t?"base.850":void 0,_hover:Bke,w:"full",h:"full",children:[r.jsx(zke,{board:e}),r.jsx(T,{w:"full",children:r.jsx(EG,{board:e,isSelected:t})}),i===e.board_id&&r.jsx(U_,{}),e.archived&&r.jsx(lt,{as:OR,fill:"base.300"}),r.jsx(q,{variant:"subtext",children:e.image_count})]})})}),r.jsx(Is,{dndTarget:x1,dndTargetData:c,label:s("gallery.move")})]})},Vke=u.memo($ke),zke=({board:e})=>{const{currentData:t}=nl(e.cover_image_name??Xn);return t?r.jsx(Wt,{src:t.thumbnail_url,draggable:!1,objectFit:"cover",w:10,h:10,borderRadius:"base",borderBottomRadius:"lg"}):r.jsx(T,{w:10,h:10,justifyContent:"center",alignItems:"center",children:r.jsx(lt,{boxSize:10,as:vhe,opacity:.7,color:"base.500"})})},Gke=fe(Hs,e=>e==="none"),Hke=({children:e})=>{const{t}=A(),n=G(),s=I(ad),i=I(Gke),o=Bt("bulkDownload"),[a]=bS(),l=u.useCallback(()=>{n(qp("none"))},[n]),c=u.useCallback(()=>{a({image_names:[],board_id:"none"})},[a]),d=u.useCallback(()=>r.jsx(Tt,{visibility:"visible",children:r.jsxs(Sr,{title:t("boards.uncategorized"),children:[!s&&r.jsx(pe,{icon:r.jsx(Vt,{}),isDisabled:i,onClick:l,children:t(i?"boards.selectedForAutoAdd":"boards.menuItemAutoAdd")}),o&&r.jsx(pe,{icon:r.jsx(HR,{}),onClickCapture:c,children:t("boards.downloadBoard")})]})}),[s,c,l,o,i,t]);return r.jsx(Ry,{renderMenu:d,children:e})},Wke=u.memo(Hke),Uke={bg:"base.850"},PG=u.memo(({isSelected:e})=>{const t=G(),{imagesTotal:n}=XP("none",{selectFromResult:({data:h})=>({imagesTotal:(h==null?void 0:h.total)??0})}),s=I(Hs),i=I(ad),o=I(Fy),a=pg("none"),l=u.useCallback(()=>{t(Hf({boardId:"none"})),i&&t(qp("none"))},[t,i]),c=u.useMemo(()=>v1.getData(),[]),{t:d}=A();return o.length?null:r.jsxs(Se,{position:"relative",w:"full",h:12,children:[r.jsx(Wke,{children:h=>r.jsx(Ee,{label:r.jsx(MG,{board:null}),openDelay:1e3,placement:"left",closeOnScroll:!0,children:r.jsxs(T,{ref:h,onClick:l,w:"full",h:"full",alignItems:"center",borderRadius:"base",cursor:"pointer",py:1,ps:1,pe:4,gap:4,bg:e?"base.850":void 0,_hover:Uke,children:[r.jsx(T,{w:"10",justifyContent:"space-around",children:r.jsx(lt,{boxSize:8,opacity:1,stroke:"base.500",viewBox:"0 0 66 66",fill:"none",children:r.jsx("path",{d:"M43.9137 16H63.1211V3H3.12109V16H22.3285L43.9137 50H63.1211V63H3.12109V50H22.3285",strokeWidth:"5"})})}),r.jsx(q,{fontSize:"sm",color:e?"base.100":"base.300",fontWeight:"semibold",noOfLines:1,flexGrow:1,children:a}),s==="none"&&r.jsx(U_,{}),r.jsx(q,{variant:"subtext",children:n})]})})}),r.jsx(Is,{dndTarget:v1,dndTargetData:c,label:d("gallery.move")})]})});PG.displayName="HoverableBoard";const XE=u.memo(PG),QE=({isPrivate:e})=>{const{t}=A(),n=I(LS),s=I(Fy),i=I(tte),{data:o}=ic(i),a=I(W_),{isOpen:l,onToggle:c}=cr({defaultIsOpen:!0}),d=u.useMemo(()=>o?o.filter(p=>s.length?p.is_private===e&&p.board_name.toLowerCase().includes(s.toLowerCase()):p.is_private===e):Ls,[s,o,e]),h=u.useMemo(()=>{const p=[];return a&&e&&!s.length&&p.push(r.jsx(XE,{isSelected:n==="none"},"none")),!a&&!s.length&&p.push(r.jsx(XE,{isSelected:n==="none"},"none")),d.forEach(g=>{p.push(r.jsx(Vke,{board:g,isSelected:n===g.board_id},g.board_id))}),p},[a,e,s.length,d,n]),f=u.useMemo(()=>t(a?e?"boards.private":"boards.shared":"boards.boards"),[e,a,t]);return r.jsxs(T,{direction:"column",children:[r.jsxs(T,{position:"sticky",w:"full",justifyContent:"space-between",alignItems:"center",ps:2,py:1,zIndex:1,top:0,bg:"base.900",children:[a?r.jsx(de,{variant:"unstyled",onClick:c,children:r.jsxs(T,{gap:"2",alignItems:"center",children:[r.jsx(lt,{boxSize:4,as:Di,transform:l?void 0:"rotate(-90deg)",fill:"base.500"}),r.jsx(q,{fontSize:"sm",fontWeight:"semibold",userSelect:"none",color:"base.500",children:f})]})}):r.jsx(q,{fontSize:"sm",fontWeight:"semibold",userSelect:"none",color:"base.500",children:f}),r.jsx(Oke,{isPrivateBoard:e})]}),r.jsx(Ja,{in:l,style:N_,children:r.jsx(T,{direction:"column",gap:1,children:h.length?h:r.jsx(q,{variant:"subtext",textAlign:"center",children:t("boards.noBoards",{boardType:s.length?"Matching":""})})})})]})},qke={height:"100%",width:"100%"},Kke=()=>{const e=I(W_),[t,n]=u.useState(null);return u.useEffect(()=>{const s=t==null?void 0:t.osInstance();if(!s)return;const i=s.elements().viewport,o=i.style.overflowY;i.style.setProperty("overflow-y","scroll","important");const a=qn(vj({element:i}),WD({element:i}));return i.style.setProperty("overflow-y",o),a},[t]),r.jsx(Se,{position:"relative",w:"full",h:"full",children:r.jsx(Se,{position:"absolute",top:0,right:0,bottom:0,left:0,children:r.jsxs(ps,{ref:n,style:qke,options:Ul.options,children:[e&&r.jsx(QE,{isPrivate:!0}),r.jsx(QE,{isPrivate:!1})]})})})},Zke=u.memo(Kke),Yke=()=>{const e=G(),t=I(Fy),{t:n}=A(),s=u.useCallback(l=>{e(B0(l))},[e]),i=u.useCallback(()=>{e(B0(""))},[e]),o=u.useCallback(l=>{l.key==="Escape"&&i()},[i]),a=u.useCallback(l=>{s(l.target.value)},[s]);return r.jsxs(ta,{children:[r.jsx(kt,{placeholder:n("boards.searchBoard"),value:t,onKeyDown:o,onChange:a,"data-testid":"board-search-input"}),t&&t.length&&r.jsx(co,{h:"full",pe:2,children:r.jsx(oe,{onClick:i,size:"sm",variant:"link","aria-label":n("boards.clearSearch"),icon:r.jsx(Ot,{})})})]})},Xke=u.memo(Yke),Qke=()=>{const e=G(),{t}=A(),n=I(Hs),s=I(ad),{options:i,hasBoards:o}=ic({},{selectFromResult:({data:d})=>{const h=[{label:t("common.none"),value:"none"}].concat((d??[]).map(({board_id:f,board_name:p})=>({label:p,value:f})));return{options:h,hasBoards:h.length>1}}}),a=u.useCallback(d=>{d&&e(qp(d.value))},[e]),l=u.useMemo(()=>i.find(d=>d.value===n),[i,n]),c=u.useCallback(()=>t("boards.noMatching"),[t]);return r.jsxs(K,{isDisabled:!o||s,children:[r.jsx(J,{children:t("boards.autoAddBoard")}),r.jsx(Ne,{value:l,options:i,onChange:a,placeholder:t("boards.selectBoard"),noOptionsMessage:c})]})},Jke=u.memo(Qke),e_e=()=>{const e=G(),{t}=A(),n=I(ad),s=u.useCallback(i=>e(nte(i.target.checked)),[e]);return r.jsxs(K,{children:[r.jsx(J,{flexGrow:1,children:t("gallery.autoAssignBoardOnClick")}),r.jsx(Sn,{isChecked:n,onChange:s})]})},t_e=u.memo(e_e),n_e=fe(Tr,e=>e.shouldShowArchivedBoards),s_e=()=>{const e=G(),{t}=A(),n=I(n_e),s=u.useCallback(i=>{e(ste(i.target.checked))},[e]);return r.jsxs(K,{children:[r.jsx(J,{flexGrow:1,children:t("gallery.showArchivedBoards")}),r.jsx(Sn,{isChecked:n,onChange:s})]})},r_e=u.memo(s_e),i_e=Ge.enum(["created_at","board_name"]),o_e=e=>i_e.safeParse(e).success,a_e=Ge.enum(["ASC","DESC"]),l_e=e=>a_e.safeParse(e).success,c_e=()=>{const{t:e}=A(),t=I(rte),n=I(ite),s=u.useMemo(()=>[{value:"created_at",label:e("workflows.created")},{value:"board_name",label:e("workflows.name")}],[e]),i=u.useMemo(()=>[{value:"ASC",label:e("workflows.ascending")},{value:"DESC",label:e("workflows.descending")}],[e]),o=G(),a=u.useCallback(h=>{!o_e(h==null?void 0:h.value)||h.value===t||o(ote(h.value))},[t,o]),l=u.useMemo(()=>s.find(h=>h.value===t)||s[0],[t,s]),c=u.useCallback(h=>{!l_e(h==null?void 0:h.value)||h.value===n||o(ate(h.value))},[n,o]),d=u.useMemo(()=>i.find(h=>h.value===n),[n,i]);return r.jsxs(T,{flexDir:"column",gap:4,children:[r.jsxs(K,{orientation:"horizontal",gap:1,children:[r.jsx(J,{children:e("common.orderBy")}),r.jsx(Ne,{isSearchable:!1,value:l,options:s,onChange:a})]}),r.jsxs(K,{orientation:"horizontal",gap:1,children:[r.jsx(J,{children:e("common.direction")}),r.jsx(Ne,{isSearchable:!1,value:d,options:i,onChange:c})]})]})},u_e=()=>{const{t:e}=A();return r.jsxs(rs,{isLazy:!0,children:[r.jsx(gs,{children:r.jsx(oe,{size:"sm",variant:"link",alignSelf:"stretch","aria-label":e("gallery.boardsSettings"),icon:r.jsx(xd,{}),tooltip:e("gallery.boardsSettings")})}),r.jsx(is,{children:r.jsx(ms,{children:r.jsxs(T,{direction:"column",gap:2,children:[r.jsx(t_e,{}),r.jsx(r_e,{}),r.jsx(Jke,{}),r.jsx(Se,{py:2,children:r.jsx(wt,{})}),r.jsx(c_e,{})]})})})]})},d_e=u.memo(u_e),h_e=()=>{At("gallery-search-state");const e=G(),t=I(lte),[n,s]=u.useState(t),i=u.useMemo(()=>ii(l=>{e(vI(l))},1e3),[e]),o=u.useCallback(l=>{s(l),i(l)},[i]),a=u.useCallback(()=>{i.cancel(),s(""),e(vI(""))},[i,e]);return[n,o,a]},f_e=fe(Tr,e=>e.alwaysShowImageSizeBadge),p_e=()=>{const e=G(),{t}=A(),n=I(f_e),s=u.useCallback(i=>e(cte(i.target.checked)),[e]);return r.jsxs(K,{children:[r.jsx(J,{flexGrow:1,children:t("gallery.alwaysShowImageSizeBadge")}),r.jsx(Sn,{isChecked:n,onChange:s})]})},g_e=u.memo(p_e),m_e=fe(Tr,e=>e.shouldAutoSwitch),y_e=()=>{const e=G(),{t}=A(),n=I(m_e),s=u.useCallback(i=>{e(ute(i.target.checked))},[e]);return r.jsxs(K,{children:[r.jsx(J,{flexGrow:1,children:t("gallery.autoSwitchNewImages")}),r.jsx(Sn,{isChecked:n,onChange:s})]})},b_e=u.memo(y_e),x_e=()=>{const e=G(),{t}=A(),n=I(QP),s=u.useCallback(i=>{e(dte(i))},[e]);return r.jsxs(K,{children:[r.jsx(J,{children:t("gallery.galleryImageSize")}),r.jsx(Ze,{value:n,onChange:s,min:45,max:256,defaultValue:90})]})},v_e=u.memo(x_e),C_e=fe(Tr,e=>e.starredFirst),w_e=()=>{const e=G(),{t}=A(),n=I(C_e),s=u.useCallback(i=>{e(hte(i.target.checked))},[e]);return r.jsxs(K,{w:"full",children:[r.jsx(J,{flexGrow:1,m:0,children:t("gallery.showStarredImagesFirst")}),r.jsx(et,{size:"sm",isChecked:n,onChange:s})]})},S_e=u.memo(w_e),j_e=fe(Tr,e=>e.orderDir),k_e=()=>{const e=G(),{t}=A(),n=I(j_e),s=u.useMemo(()=>[{value:"DESC",label:t("gallery.newestFirst")},{value:"ASC",label:t("gallery.oldestFirst")}],[t]),i=u.useCallback(a=>{we((a==null?void 0:a.value)==="ASC"||(a==null?void 0:a.value)==="DESC"),e(fte(a.value))},[e]),o=u.useMemo(()=>s.find(a=>a.value===n),[n,s]);return r.jsxs(K,{children:[r.jsx(J,{flexGrow:1,m:0,children:t("gallery.sortDirection")}),r.jsx(Ne,{isSearchable:!1,value:o,options:s,onChange:i})]})},__e=u.memo(k_e),I_e=()=>{const{t:e}=A();return r.jsxs(rs,{isLazy:!0,children:[r.jsx(gs,{children:r.jsx(oe,{size:"sm",variant:"link",alignSelf:"stretch","aria-label":e("gallery.imagesSettings"),icon:r.jsx(xd,{}),tooltip:e("gallery.imagesSettings")})}),r.jsx(is,{children:r.jsx(ms,{children:r.jsxs(T,{direction:"column",gap:2,children:[r.jsx(v_e,{}),r.jsx(b_e,{}),r.jsx(g_e,{}),r.jsx(wt,{pt:2}),r.jsx(S_e,{}),r.jsx(__e,{})]})})})]})},T_e=u.memo(I_e),A_e=()=>{const e=Sc({allowMultiple:!0});return r.jsxs(r.Fragment,{children:[r.jsx(oe,{size:"sm",alignSelf:"stretch",variant:"link","aria-label":Pe("accessibility.uploadImages"),tooltip:Pe("accessibility.uploadImages"),icon:r.jsx(lg,{}),...e.getUploadButtonProps()}),r.jsx("input",{...e.getUploadInputProps()})]})},LG=u.memo(()=>{const e=G(),t=I(pte),{imageDTOs:n}=T_(),s=Ms("gallery"),i=u.useCallback(()=>{e(Sy([...t,...n]))},[e,t,n]);return Re({id:"selectAllOnPage",category:"gallery",callback:i,options:{preventDefault:!0,enabled:s},dependencies:[i,s]}),t.length<=1?null:r.jsx(DG,{})});LG.displayName="GallerySelectionCountTag";const DG=u.memo(()=>{const{t:e}=A(),t=G(),n=Ms("gallery"),s=I(gte),i=I(xS),o=u.useCallback(()=>{s&&t(Sy([s]))},[t,s]);return Re({id:"clearSelection",category:"gallery",callback:o,options:{enabled:i>0&&n},dependencies:[o,i,n]}),r.jsxs(DS,{position:"absolute",bg:"invokeBlue.800",color:"base.50",py:2,px:4,userSelect:"none",shadow:"dark-lg",fontWeight:"semibold",border:1,borderStyle:"solid",borderColor:"whiteAlpha.300",children:[r.jsxs(JP,{children:[i," ",e("common.selected")]}),r.jsx(RS,{onClick:o})]})});DG.displayName="GallerySelectionCountTagContent";const E_e=()=>{At("useGalleryHotkeys");const{goNext:e,goPrev:t,isNextEnabled:n,isPrevEnabled:s}=Fb(),i=G(),o=I(j=>j.gallery.selection),a=I(od),l=oc(a),c=I(qf),d=I(An),h=Ms("workflows"),f=Ms("gallery"),p=Ms("viewer"),g=u.useMemo(()=>d!=="canvas"?!0:c==="gallery",[d,c]),{handleLeftImage:m,handleRightImage:y,handleUpImage:b,handleDownImage:C,isOnFirstRow:x,isOnLastRow:v,isOnFirstImageOfView:w,isOnLastImageOfView:S}=DV();Re({id:"galleryNavLeft",category:"gallery",callback:j=>{if(!(j.target instanceof HTMLElement&&j.target.getAttribute("role")==="tab")){if(w&&s&&!l.isFetching){t("arrow");return}m(!1)}},options:{preventDefault:!0,enabled:f||p},dependencies:[m,w,t,s,l.isFetching,f,p]}),Re({id:"galleryNavRight",category:"gallery",callback:j=>{if(!(j.target instanceof HTMLElement&&j.target.getAttribute("role")==="tab")){if(S&&n&&!l.isFetching){e("arrow");return}S||y(!1)}},options:{preventDefault:!0,enabled:f||p},dependencies:[S,e,n,l.isFetching,y,f,p]}),Re({id:"galleryNavUp",category:"gallery",callback:()=>{if(x&&s&&!l.isFetching){t("arrow");return}b(!1)},options:{preventDefault:!0,enabled:f},dependencies:[b,x,t,s,l.isFetching,f]}),Re({id:"galleryNavDown",category:"gallery",callback:()=>{if(v&&n&&!l.isFetching){e("arrow");return}C(!1)},options:{preventDefault:!0,enabled:f},dependencies:[v,e,n,l.isFetching,C,f]}),Re({id:"galleryNavLeftAlt",category:"gallery",callback:()=>{if(w&&s&&!l.isFetching){t("alt+arrow");return}m(!0)},options:{preventDefault:!0,enabled:f||p},dependencies:[m,w,t,s,l.isFetching,f,p]}),Re({id:"galleryNavRightAlt",category:"gallery",callback:()=>{if(S&&n&&!l.isFetching){e("alt+arrow");return}S||y(!0)},options:{preventDefault:!0,enabled:f||p},dependencies:[S,e,n,l.isFetching,y,f,p]}),Re({id:"galleryNavUpAlt",category:"gallery",callback:()=>{if(x&&s&&!l.isFetching){t("alt+arrow");return}b(!0)},options:{preventDefault:!0,enabled:f},dependencies:[b,x,t,s,l.isFetching,f]}),Re({id:"galleryNavDownAlt",category:"gallery",callback:()=>{if(v&&n&&!l.isFetching){e("alt+arrow");return}C(!0)},options:{preventDefault:!0,enabled:f},dependencies:[v,e,n,l.isFetching,C,f]}),Re({id:"deleteSelection",category:"gallery",callback:()=>{o.length&&i(Pp(o))},options:{enabled:(f||p)&&g&&!h},dependencies:[h,g,o,h]})},M_e=()=>{E_e();const{t:e}=A(),t=I(od),{hasImages:n,isLoading:s,isError:i}=oc(t,{selectFromResult:({data:o,isLoading:a,isSuccess:l,isError:c})=>({hasImages:o&&o.items.length>0,isLoading:a,isSuccess:l,isError:c})});return i?r.jsx(Se,{w:"full",h:"full",children:r.jsx(Pt,{label:e("gallery.unableToLoad"),icon:r7})}):s?r.jsx(T,{w:"full",h:"full",alignItems:"center",justifyContent:"center",children:r.jsx(Pt,{label:e("gallery.loading"),icon:Gu})}):n?r.jsx(RG,{}):r.jsx(T,{w:"full",h:"full",alignItems:"center",justifyContent:"center",children:r.jsx(Pt,{label:e("gallery.noImagesInGallery"),icon:Gu})})},P_e=u.memo(M_e),RG=u.memo(()=>{const e=G(),t=I(QP),n=I(mte),[s,i]=u.useState(null),o=u.useMemo(()=>ii(()=>{if(!s)return;const a=document.querySelector(`.${A_}`);if(!a)return;const l=document.querySelector(`.${pw}`);if(!l)return;const c=a.getBoundingClientRect(),d=s.getBoundingClientRect(),h=window.getComputedStyle(l),f=parseFloat(h.gap);if(!c.width||!c.height||!d.width||!d.height)return;let p=0,g=0;for(;g+c.height<=d.height+1;)p++,g+=c.height,g+f<=d.height&&(g+=f);let m=0;for(g=0;g+c.width<=d.width+1;)m++,g+=c.width,g+f<=d.width&&(g+=f);const y=Math.max(m,m*p);n===0||n===y||e(yte(y))},300),[s,e,n]);return u.useEffect(()=>{o()},[o,t]),u.useEffect(()=>{if(!s)return;const a=new ResizeObserver(o);return a.observe(s),o(),()=>{a.disconnect()}},[o,s,e]),r.jsxs(Se,{position:"relative",w:"full",h:"full",mt:2,children:[r.jsx(Se,{ref:i,position:"absolute",top:0,right:0,bottom:0,left:0,w:"full",h:"full",overflow:"hidden",children:r.jsx(Ar,{className:pw,gridTemplateColumns:`repeat(auto-fill, minmax(${t}px, 1fr))`,gap:1,children:r.jsx(OG,{})})}),r.jsx(LG,{})]})});RG.displayName="GalleryImageGridContent";const OG=u.memo(()=>{const e=I(od),{imageDTOs:t}=oc(e,{selectFromResult:({data:n})=>({imageDTOs:(n==null?void 0:n.items)??Ls})});return r.jsx(r.Fragment,{children:t.map(n=>r.jsx(LV,{imageDTO:n},n.image_name))})});OG.displayName="GalleryImageGridImages";const NG=u.memo(()=>{const{t:e}=A(),t=cr();return r.jsxs(rs,{isOpen:t.isOpen,onClose:t.onClose,isLazy:!0,lazyBehavior:"unmount",children:[r.jsx(gs,{children:r.jsx(de,{"aria-label":e("gallery.jump"),size:"sm",onClick:t.onToggle,variant:"outline",children:e("gallery.jump")})}),r.jsxs(is,{children:[r.jsx(Li,{}),r.jsx(ms,{children:r.jsx(FG,{disclosure:t})})]})]})});NG.displayName="JumpTo";const FG=u.memo(({disclosure:e})=>{const{t}=A(),{goToPage:n,currentPage:s,pages:i}=Fb(),[o,a]=u.useState(s),l=u.useRef(null),c=u.useCallback(h=>{a(h-1)},[]),d=u.useCallback(()=>{n(o),e.onClose()},[n,o,e]);return Ii("enter",()=>{d()},{enabled:e.isOpen,enableOnFormTags:["input"]},[e.isOpen,d]),Ii("esc",()=>{a(s),e.onClose()},{enabled:e.isOpen,enableOnFormTags:["input"]},[e.isOpen,e.onClose]),u.useEffect(()=>{setTimeout(()=>{var f;const h=(f=l.current)==null?void 0:f.querySelector("input");h==null||h.focus(),h==null||h.select()},0),a(s)},[s]),r.jsxs(T,{gap:2,alignItems:"center",children:[r.jsx(K,{children:r.jsx(Ie,{ref:l,size:"sm",maxW:"60px",value:o+1,min:1,max:i,step:1,onChange:c})}),r.jsx(de,{h:"full",size:"sm",onClick:d,children:t("gallery.go")})]})});FG.displayName="JumpToContent";const BG=u.memo(()=>{const{goPrev:e,goNext:t,isPrevEnabled:n,isNextEnabled:s,pageButtons:i,goToPage:o,currentPage:a,total:l}=Fb(),c=u.useCallback(()=>{e()},[e]),d=u.useCallback(()=>{t()},[t]);return l?r.jsxs(T,{justifyContent:"center",alignItems:"center",w:"full",gap:1,pt:2,children:[r.jsx(oe,{size:"sm","aria-label":"prev",icon:r.jsx(Nj,{}),onClick:c,isDisabled:!n,variant:"ghost"}),r.jsx(it,{}),i.map((h,f)=>r.jsx($G,{page:h,currentPage:a,goToPage:o},`${h}_${f}`)),r.jsx(it,{}),r.jsx(oe,{size:"sm","aria-label":"next",icon:r.jsx(ab,{}),onClick:d,isDisabled:!s,variant:"ghost"}),r.jsx(NG,{})]}):null});BG.displayName="GalleryPagination";const $G=u.memo(({page:e,currentPage:t,goToPage:n})=>{const s=u.useCallback(()=>{e!==yu&&n(e-1)},[n,e]);return e===yu?r.jsx(de,{size:"sm",variant:"link",isDisabled:!0,children:"..."}):r.jsx(de,{size:"sm",onClick:s,variant:t===e-1?"solid":"outline",children:e})});$G.displayName="PageButton";const VG=u.memo(({searchTerm:e,onChangeSearchTerm:t,onResetSearchTerm:n})=>{const{t:s}=A(),i=I(od),{isPending:o}=oc(i,{selectFromResult:({isLoading:c,isFetching:d})=>({isPending:c||d})}),a=u.useCallback(c=>{t(c.target.value)},[t]),l=u.useCallback(c=>{c.key==="Escape"&&n()},[n]);return r.jsxs(ta,{children:[r.jsx(kt,{placeholder:s("gallery.searchImages"),value:e,onChange:a,"data-testid":"image-search-input",onKeyDown:l}),o&&r.jsx(co,{h:"full",pe:2,children:r.jsx(Lr,{size:"sm",opacity:.5})}),!o&&e.length&&r.jsx(co,{h:"full",pe:2,children:r.jsx(oe,{onClick:n,size:"sm",variant:"link","aria-label":s("boards.clearSearch"),icon:r.jsx(Ot,{})})})]})});VG.displayName="GallerySearch";const JE={fontWeight:"semibold",fontSize:"sm",color:"base.300"},e8={borderColor:"base.800",borderBottomColor:"base.900",color:"invokeBlue.300"},L_e={flexShrink:0,minHeight:0,width:"100%"},D_e=fe(Tr,e=>e.galleryView),R_e=fe(Tr,e=>e.searchTerm),O_e=()=>{const{t:e}=A(),t=G(),n=I(D_e),s=I(R_e),i=cr({defaultIsOpen:s.length>0}),[o,a,l]=h_e(),c=u.useCallback(()=>{t(I2("images"))},[t]),d=u.useCallback(()=>{t(I2("assets"))},[t]),h=u.useCallback(()=>{i.onToggle(),l()},[l,i]),f=I(LS),p=pg(f);return r.jsxs(T,{flexDirection:"column",alignItems:"center",justifyContent:"space-between",h:"full",w:"full",pt:1,minH:0,children:[r.jsx(sc,{index:n==="images"?0:1,variant:"enclosed",display:"flex",flexDir:"column",w:"full",children:r.jsxs(rc,{gap:2,fontSize:"sm",borderColor:"base.800",alignItems:"center",w:"full",children:[r.jsx(q,{fontSize:"sm",fontWeight:"semibold",noOfLines:1,px:"2",wordBreak:"break-all",children:p}),r.jsx(it,{}),r.jsx(Ee,{label:e("gallery.imagesTab"),children:r.jsx(_n,{sx:JE,_selected:e8,onClick:c,"data-testid":"images-tab",children:e("parameters.images")})}),r.jsx(Ee,{label:e("gallery.assetsTab"),children:r.jsx(_n,{sx:JE,_selected:e8,onClick:d,"data-testid":"assets-tab",children:e("gallery.assets")})}),r.jsxs(T,{h:"full",justifyContent:"flex-end",children:[r.jsx(A_e,{}),r.jsx(T_e,{}),r.jsx(oe,{size:"sm",variant:"link",alignSelf:"stretch",onClick:h,tooltip:i.isOpen?`${e("gallery.exitSearch")}`:`${e("gallery.displaySearch")}`,"aria-label":e("gallery.displaySearch"),icon:r.jsx(YR,{})})]})]})}),r.jsx(Ja,{in:i.isOpen,style:L_e,children:r.jsx(Se,{w:"full",pt:2,children:r.jsx(VG,{searchTerm:o,onChangeSearchTerm:a,onResetSearchTerm:l})})}),r.jsx(P_e,{}),r.jsx(BG,{})]})},N_e={flexShrink:0,minHeight:0},F_e={width:"full",height:"full",position:"relative",flexDirection:"column",display:"flex"},B_e=()=>{const{t:e}=A(),t=I(Fy),n=G(),s=cr({defaultIsOpen:!!t.length}),i=u.useRef(null),o=u.useMemo(()=>({id:"boards-list-panel",minSizePx:128,defaultSizePx:256,imperativePanelGroupRef:i,panelGroupDirection:"vertical"}),[]),a=vw(o),l=u.useCallback(()=>{t.length&&n(B0("")),s.onToggle(),a.expand()},[t.length,s,a,n]);return r.jsxs(_d,{region:"gallery",sx:F_e,children:[r.jsxs(T,{alignItems:"center",justifyContent:"space-between",w:"full",children:[r.jsx(T,{flexGrow:1,flexBasis:0,children:r.jsx(de,{size:"sm",variant:"ghost",onClick:a.toggle,rightIcon:a.isCollapsed?r.jsx(Di,{}):r.jsx($R,{}),children:a.isCollapsed?e("boards.viewBoards"):e("boards.hideBoards")})}),r.jsx(T,{children:r.jsx(AG,{})}),r.jsxs(T,{flexGrow:1,flexBasis:0,justifyContent:"flex-end",children:[r.jsx(d_e,{}),r.jsx(oe,{size:"sm",variant:"link",alignSelf:"stretch",onClick:l,tooltip:s.isOpen?`${e("gallery.exitBoardSearch")}`:`${e("gallery.displayBoardSearch")}`,"aria-label":e("gallery.displayBoardSearch"),icon:r.jsx(YR,{}),colorScheme:s.isOpen?"invokeBlue":"base"})]})]}),r.jsxs(Eg,{ref:i,direction:"vertical",autoSaveId:"boards-list-panel",children:[r.jsx(ao,{collapsible:!0,...a.panelProps,children:r.jsxs(T,{flexDir:"column",w:"full",h:"full",children:[r.jsx(Ja,{in:s.isOpen,style:N_e,children:r.jsx(Se,{w:"full",pt:2,children:r.jsx(Xke,{})})}),r.jsx(wt,{pt:2}),r.jsx(Zke,{})]})}),r.jsx(D_,{id:"gallery-panel-handle",...a.resizeHandleProps}),r.jsx(ao,{id:"gallery-wrapper-panel",minSize:20,children:r.jsx(O_e,{})})]})]})},zG=u.memo(B_e),GG=u.memo(()=>{const{t:e}=A(),t=I(qf),n=Nt(),s=G(),i=u.useMemo(()=>t==="gallery"?1:0,[t]),o=u.useCallback(()=>{t!=="gallery"&&s(jr("gallery")),n.toggle()},[n,t,s]),a=u.useCallback(l=>{s(l===0?jr("layers"):jr("gallery"))},[s]);return Re({id:"toggleViewer",category:"viewer",callback:n.toggle,dependencies:[n]}),r.jsxs(sc,{index:i,onChange:a,w:"full",h:"full",display:"flex",flexDir:"column",children:[r.jsxs(rc,{alignItems:"center",children:[r.jsx(HG,{}),r.jsx(it,{}),r.jsx(de,{size:"sm",variant:"ghost",onClick:o,children:n.isOpen?e("gallery.closeViewer"):e("gallery.openViewer")})]}),r.jsxs(sd,{w:"full",h:"full",children:[r.jsx(Rn,{w:"full",h:"full",p:0,pt:3,children:r.jsx(Ki,{children:r.jsx(TG,{})})}),r.jsx(Rn,{w:"full",h:"full",p:0,pt:3,children:r.jsx(zG,{})})]})]})});GG.displayName="CanvasRightPanel";const HG=u.memo(()=>{const{t:e}=A(),t=gc(),n=I(bte),[s,i]=u.useState("idle"),[o,a]=u.useState("idle"),l=u.useRef(null),c=u.useRef(null),d=u.useRef(null),h=u.useMemo(()=>n===0?e("controlLayers.layer_other"):`${e("controlLayers.layer_other")} (${n})`,[n,e]);return u.useEffect(()=>{if(!l.current)return;const f=()=>qf(t.getState())==="layers",p=()=>{f()||(i("over"),d.current=window.setTimeout(()=>{d.current=null,t.dispatch(jr("layers")),i("idle"),a("potential")},300))},g=()=>{f()?i("idle"):i("potential"),d.current!==null&&clearTimeout(d.current)},m=()=>{i("potential")};return qn(Bu({element:l.current,onDragEnter:p,onDragLeave:g}),to({canMonitor:({source:y})=>!In.typeGuard(y.data)&&!ni.typeGuard(y.data)?!1:!f(),onDragStart:m}),iC({element:l.current,onDragEnter:p,onDragLeave:g}),Sf({canMonitor:()=>!f(),onDragStart:m}))},[t]),u.useEffect(()=>{if(!c.current)return;const f=()=>qf(t.getState())==="gallery",p=()=>{f()||(a("over"),d.current=window.setTimeout(()=>{d.current=null,t.dispatch(jr("gallery")),a("idle"),i("potential")},300))},g=()=>{f()?a("idle"):a("potential"),d.current!==null&&clearTimeout(d.current)},m=()=>{a("potential")};return qn(Bu({element:c.current,onDragEnter:p,onDragLeave:g}),to({canMonitor:({source:y})=>!In.typeGuard(y.data)&&!ni.typeGuard(y.data)?!1:!f(),onDragStart:m}),iC({element:c.current,onDragEnter:p,onDragLeave:g}),Sf({canMonitor:()=>!f(),onDragStart:m}))},[t]),u.useEffect(()=>{const f=()=>{a("idle"),i("idle")},p=qn(to({onDrop:f}),Sf({onDrop:f}));return()=>{p(),d.current!==null&&clearTimeout(d.current)}},[]),r.jsxs(r.Fragment,{children:[r.jsxs(_n,{ref:l,position:"relative",w:32,children:[r.jsx(Se,{as:"span",w:"full",children:h}),r.jsx(tp,{dndState:s,withBackdrop:!1})]}),r.jsxs(_n,{ref:c,position:"relative",w:32,children:[r.jsx(Se,{as:"span",w:"full",children:e("gallery.gallery")}),r.jsx(tp,{dndState:o,withBackdrop:!1})]})]})});HG.displayName="PanelTabs";const Yv=$n("dnd"),$_e=()=>{At("useDropMonitor"),u.useEffect(()=>qn(to({canMonitor:({source:e})=>{const t=e.data;return!(!In.typeGuard(t)&&!ni.typeGuard(t))},onDrop:({source:e,location:t})=>{const n=t.current.dropTargets[0];if(!n){Yv.warn("No dnd target");return}const s=e.data,i=n.data,{dispatch:o,getState:a}=Fp();for(const l of Jve){if(!l.typeGuard(i))continue;const c={sourceData:s,targetData:i,dispatch:o,getState:a};if(l.isValid(c)){Yv.debug(Ci({sourceData:s,targetData:i}),"Handling dnd drop"),l.handler(c);return}}Yv.warn(Ci({sourceData:s,targetData:i}),"Invalid drop")}})),[])},V_e=fe(Qe,e=>{var t;return(t=xte(e))==null?void 0:t.data}),z_e=()=>{const{t:e}=A(),t=I(V_e),[n]=vc(t,300);return n?r.jsx(yo,{data:n,label:"Node Data",bg:"base.850",color:"base.200"}):r.jsx(Pt,{label:e("nodes.noNodeSelected"),icon:null})},G_e=u.memo(z_e),WG=e=>{const t=u.useMemo(()=>fe(Qe,s=>OS(s,e).data.notes),[e]);return I(t)},UG=u.memo(({nodeId:e})=>{const t=G(),{t:n}=A(),s=WG(e),i=u.useCallback(o=>{t(vte({nodeId:e,notes:o.target.value}))},[t,e]);return r.jsxs(K,{orientation:"vertical",h:"full",children:[r.jsx(J,{children:n("nodes.notes")}),r.jsx(ss,{value:s,onChange:i,rows:10,resize:"none",variant:"darkFilled"})]})});UG.displayName="InvocationNodeNotesTextarea";const q_=e=>{const t=u.useMemo(()=>fe(Qe,s=>ed(s,e).type),[e]);return I(t)},qG=e=>{const t=ae(sn),n=q_(e);return u.useMemo(()=>t[n]??null,[t,n])},Zb=u.memo(({nodeId:e,fallback:t,children:n})=>qG(e)?r.jsx(r.Fragment,{children:n}):t);Zb.displayName="TemplateGate";const K_=e=>{const t=u.useMemo(()=>fe(Qe,s=>OS(s,e).data.version),[e]);return I(t)},Rs=e=>{const t=ae(sn),n=q_(e);return u.useMemo(()=>{const i=t[n];return we(i,`Template for node type ${n} not found`),i},[t,n])},KG=e=>{const t=q_(e),n=K_(e),s=Rs(e);return u.useMemo(()=>t!==s.type?!0:n!==s.version,[s.type,s.version,t,n])},ZG=e=>{const t=ae(sn),n=u.useMemo(()=>fe(Qe,i=>{const o=i.nodes.find(l=>l.id===e);if(!Pn(o))return null;const a=t[o.data.type];return(a==null?void 0:a.title)??null}),[e,t]);return I(n)},Z_=e=>{const t=u.useMemo(()=>fe(Qe,s=>{const i=s.nodes.find(o=>o.id===e);return(i==null?void 0:i.data.label)??null}),[e]);return I(t)},H_e=({nodeId:e,title:t})=>{const n=G(),s=Z_(e),i=ZG(e),{t:o}=A(),a=u.useRef(null),l=u.useCallback(d=>{n(eL({nodeId:e,label:d}))},[n,e]),c=aa({value:s||t||i||o("nodes.problemSettingTitle"),defaultValue:t||i||o("nodes.problemSettingTitle"),onChange:l,inputRef:a});return r.jsxs(T,{w:"full",alignItems:"center",children:[!c.isEditing&&r.jsx(q,{size:"sm",fontWeight:"semibold",userSelect:"none",onDoubleClick:c.startEditing,children:c.value}),c.isEditing&&r.jsx(kt,{ref:a,...c.inputProps,variant:"outline",_focusVisible:{borderRadius:"base",h:"unset"}})]})},W_e=u.memo(H_e),U_e=()=>{const{t:e}=A(),t=I(NS);return t?r.jsx(Zb,{nodeId:t,fallback:r.jsx(Pt,{label:e("nodes.noNodeSelected"),icon:null}),children:r.jsx(YG,{nodeId:t})}):r.jsx(Pt,{label:e("nodes.noNodeSelected"),icon:null})},q_e=u.memo(U_e),YG=u.memo(({nodeId:e})=>{const{t}=A(),n=K_(e),s=Rs(e),i=KG(e);return r.jsx(Se,{position:"relative",w:"full",h:"full",children:r.jsx(os,{children:r.jsxs(T,{flexDir:"column",position:"relative",w:"full",h:"full",gap:1,children:[r.jsxs(K,{children:[r.jsx(J,{m:0,children:t("nodes.nodeName")}),r.jsx(W_e,{nodeId:e})]}),r.jsxs(Cte,{children:[r.jsxs(K,{children:[r.jsx(J,{m:0,children:t("nodes.nodeType")}),r.jsx(q,{fontSize:"sm",fontWeight:"semibold",children:s.title})]}),r.jsxs(K,{isInvalid:i,children:[r.jsx(J,{m:0,children:t("nodes.nodeVersion")}),r.jsx(q,{fontSize:"sm",fontWeight:"semibold",children:n})]})]}),r.jsx(UG,{nodeId:e})]})})})});YG.displayName="Content";const K_e=({output:e})=>{const{image:t}=e,{currentData:n}=nl(t.image_name);return n?r.jsx(ul,{imageDTO:n}):null},Z_e=u.memo(K_e),Y_e=()=>{const e=I(NS),{t}=A();return e?r.jsx(Zb,{nodeId:e,fallback:r.jsx(Pt,{label:t("nodes.noNodeSelected"),icon:null}),children:r.jsx(XG,{nodeId:e})}):r.jsx(Pt,{label:t("nodes.noNodeSelected"),icon:null})},X_e=u.memo(Y_e),Q_e=(e,t)=>`${e.type}-${t}`,XG=u.memo(({nodeId:e})=>{const{t}=A(),n=Rs(e),s=FS(e);return!s||s.outputs.length===0?r.jsx(Pt,{label:t("nodes.noOutputRecorded"),icon:null}):r.jsx(Se,{position:"relative",w:"full",h:"full",children:r.jsx(os,{children:r.jsx(T,{position:"relative",flexDir:"column",alignItems:"flex-start",p:1,gap:2,h:"full",w:"full",children:n.outputType==="image_output"?s.outputs.map((i,o)=>r.jsx(Z_e,{output:i},Q_e(i,o))):r.jsx(yo,{data:s.outputs,label:t("nodes.nodeOutputs"),bg:"base.850",color:"base.200"})})})})});XG.displayName="Content";const J_e=()=>{const e=I(NS),{t}=A();return e?r.jsx(Zb,{nodeId:e,fallback:r.jsx(Pt,{label:t("nodes.noNodeSelected"),icon:null}),children:r.jsx(QG,{nodeId:e})}):r.jsx(Pt,{label:t("nodes.noNodeSelected"),icon:null})},e4e=u.memo(J_e),QG=u.memo(({nodeId:e})=>{const{t}=A(),n=Rs(e);return r.jsx(yo,{data:n,label:t("nodes.nodeTemplate"),bg:"base.850",color:"base.200"})});QG.displayName="Content";const t4e=()=>{const{t:e}=A();return r.jsxs(sc,{variant:"enclosed",display:"flex",flexDir:"column",w:"full",h:"full",children:[r.jsxs(rc,{children:[r.jsx(_n,{children:e("common.details")}),r.jsx(_n,{children:e("common.outputs")}),r.jsx(_n,{children:e("common.data")}),r.jsx(_n,{children:e("common.template")})]}),r.jsxs(sd,{h:"full",pt:2,children:[r.jsx(Rn,{h:"full",p:0,children:r.jsx(q_e,{})}),r.jsx(Rn,{h:"full",p:0,children:r.jsx(X_e,{})}),r.jsx(Rn,{h:"full",p:0,children:r.jsx(G_e,{})}),r.jsx(Rn,{h:"full",p:0,children:r.jsx(e4e,{})})]})]})},n4e=u.memo(t4e),JG=u.createContext(null),Pg=u.memo(({id:e,layout:t,children:n})=>{const s=u.useMemo(()=>({id:e,layout:t}),[e,t]);return r.jsx(JG.Provider,{value:s,children:n})});Pg.displayName="ContainerContextProvider";const Oi=()=>{const e=u.useContext(JG);return we(e!==null,"useContainerContext must be used inside a ContainerContextProvider and cannot be used by the root container"),e},eH=u.createContext(0),Lg=u.memo(({depth:e,children:t})=>r.jsx(eH.Provider,{value:e,children:t}));Lg.displayName="DepthContextProvider";const Yb=()=>u.useContext(eH),s4e={bg:"base.700",flexShrink:0,'&[data-parent-layout="column"]':{width:"100%",height:"1px"},'&[data-parent-layout="row"]':{height:"100%",width:"1px"}},tH=u.memo(()=>{const e=Oi();return r.jsx(T,{sx:s4e,"data-parent-layout":e.layout})});tH.displayName="DividerElementComponent";const r4e={top:(e,t,n)=>{const s=Math.abs(t.y-e.top);if(!n)return s;const i=Math.min(e.height/4,10);return s<=i?0:1/0},right:(e,t,n)=>{const s=Math.abs(e.right-t.x);if(!n)return s;const i=Math.min(e.width/4,10);return s<=i?0:1/0},bottom:(e,t,n)=>{const s=Math.abs(e.bottom-t.y);if(!n)return s;const i=Math.min(e.height/4,10);return s<=i?0:1/0},left:(e,t,n)=>{const s=Math.abs(t.x-e.left);if(!n)return s;const i=Math.min(e.width/4,10);return s<=i?0:1/0},center:(e,t,n)=>{const s=e.left+e.width/2,i=e.top+e.height/2;return Math.sqrt((t.x-s)**2+(t.y-i)**2)}},nH=Symbol("centerWithClosestEdge");function sH(e,{element:t,input:n,allowedCenterOrEdge:s}){var d;const i={x:n.clientX,y:n.clientY},o=t.getBoundingClientRect(),a=s.includes("center"),c=((d=s.map(h=>({edge:h,value:r4e[h](o,i,a)})).sort((h,f)=>h.value-f.value)[0])==null?void 0:d.edge)??null;return{...e,[nH]:c}}function rH(e){return e[nH]??null}const di=$n("dnd"),iH=Symbol("form-element"),Dl=e=>({[iH]:!0,element:e}),Dg=e=>iH in e,oH=Symbol("node-field"),i4e=(e,t,n)=>({[oH]:!0,nodeId:e,fieldName:t,fieldTemplate:n}),Xb=e=>oH in e,o4e=e=>{const t=document.querySelector(`#${e}`);t instanceof HTMLElement&&mV(t,lo("base.800"))},Y_=()=>{const e=dn();return u.useCallback((n,s)=>{const i=BS(e.getState());return wte(i,n,s)},[e])},a4e=()=>{const e=dn();return u.useCallback(n=>{const s=BS(e.getState());return jte(s,n)},[e])},aH=()=>{const e=dn();return u.useCallback(n=>{const s=BS(e.getState());return kte(s,n)},[e])},l4e=()=>{const e=dn();return u.useCallback(n=>{const{nodes:s}=Qe(e.getState());return Ste(s,n)},[e])},c4e=e=>{if(Xb(e.data)){const{nodeId:t,fieldName:n,fieldTemplate:s}=e.data;return tL(t,n,s.type)}return Dg(e.data)?e.data.element:null},u4e=e=>Dg(e.data)?e.data.element:null,d4e=()=>{At("useBuilderDndMonitor");const e=G(),t=u.useCallback((o,a)=>{mc.flushSync(()=>{e(o)}),o4e(a)},[e]),n=Y_(),s=l4e(),i=a4e();u.useEffect(()=>to({canMonitor:({source:o})=>Dg(o.data)||Xb(o.data),onDrop:({location:o,source:a})=>{const l=o.current.dropTargets[0];if(!l)return;const c=c4e(a),d=u4e(l);if(!c||!d||c.id===d.id)return;const h=!i(c.id),f=rH(l.data);if(h)if(f==="center"){if(di.trace("Adding new element to empty container"),!Xr(d)){di.error(Ci({target:l,source:a}),"Expected target to be a container");return}t(z2({element:c,parentId:d.id,index:0,initialValue:s(c)}),c.id);return}else{if(di.trace("Adding new element to container with children (dropped on edge of container child)"),d.parentId===void 0){di.error(Ci({target:l,source:a}),"Expected target to have a parent");return}const p=n(d.parentId,Xr),g=p.data.children.indexOf(d.id),m=yw({startIndex:g+1,indexOfTarget:g,closestEdgeOfTarget:f,axis:p.data.layout==="row"?"horizontal":"vertical"});t(z2({element:c,parentId:p.id,index:m,initialValue:s(c)}),c.id);return}else if(f==="center"){if(di.trace("Reparenting element to an empty container"),!Xr(d)){di.error(Ci({target:l,source:a}),"Expected target to be a container");return}t(CI({id:c.id,newParentId:d.id,index:0}),c.id);return}else if(d.parentId===c.parentId){if(di.trace("Moving element within container"),d.parentId===void 0){di.error(Ci({target:l,source:a}),"Expected target to have a parent");return}const p=n(d.parentId,Xr),g=p.data.children.indexOf(c.id),m=p.data.children.indexOf(d.id),y=kz({list:p.data.children,startIndex:g,indexOfTarget:m,closestEdgeOfTarget:f,axis:p.data.layout==="row"?"horizontal":"vertical"});t(G2({id:p.id,changes:{children:y}}),c.id);return}else if(d.parentId!==c.parentId){if(di.trace("Reparenting element to container with children (dropped on edge of container child)"),d.parentId===void 0){di.error(Ci({target:l,source:a}),"Expected target to have a parent");return}const p=n(d.parentId,Xr),g=p.data.children.indexOf(d.id),m=yw({startIndex:p.data.children.length+1,indexOfTarget:g,closestEdgeOfTarget:f,axis:p.data.layout==="row"?"horizontal":"vertical"});t(CI({id:c.id,newParentId:p.id,index:m}),c.id);return}else di.error(Ci({target:l,source:a}),"Unhandled drop event!")}}),[t,i,n,s])},Rg=(e,t,n)=>{const s=p4e(e),[i,o]=u.useState(!1),[a,l]=u.useState(null),c=Y_(),d=aH();return u.useEffect(()=>{s&&we(!1,"Root element should not be draggable");const h=t.current,f=n.current;if(!(!h||!f))return qn(Pd(h),pd({element:h,dragHandle:f,getInitialData:()=>{const p=c(e);return Dl(p)},onDragStart:()=>{o(!0)},onDrop:()=>{o(!1)}}),Bu({element:h,getIsSticky:()=>!1,canDrop:({source:p})=>Xb(p.data)?!0:Dg(p.data)?p.data.element.id!==c(e).parentId:!1,getData:({input:p})=>{const g=c(e),m=Dl(g),y=d(g);return sH(m,{element:h,input:p,allowedCenterOrEdge:y})},onDrag:({self:p,location:g,source:m})=>{var C;const y=(C=g.current.dropTargets.at(0))==null?void 0:C.element;if(!y||y!==h){l(null);return}const b=rH(p.data);if(b==="center"&&m.element===h){l(null);return}l(b)},onDragLeave:()=>{l(null)},onDrop:()=>{l(null)}}))},[n,t,e,d,c,s]),[a,i]},h4e=e=>{const[t,n]=u.useState(!1),s=Y_(),i=aH(),o=I($S);return u.useEffect(()=>{const a=e.current;if(a)return qn(Bu({element:a,getIsSticky:()=>!1,canDrop:({source:l})=>s(o,Xr).data.children.length!==0?!1:!!(Xb(l.data)||Dg(l.data)),getData:({input:l})=>{const c=s(o,Xr),d=Dl(c);return sH(d,{element:a,input:l,allowedCenterOrEdge:["center"]})},onDrag:()=>{n(!0)},onDragLeave:()=>{n(!1)},onDrop:()=>{n(!1)}}))},[e,i,s,o]),t},f4e=(e,t,n,s,i)=>{const[o,a]=u.useState(!1);return u.useEffect(()=>{const l=s.current,c=i.current;if(!(!l||!c))return qn(Pd(l),pd({element:l,dragHandle:c,getInitialData:()=>i4e(e,t,n),onDragStart:()=>{a(!0)},onDrop:()=>{a(!1)}}))},[i,s,t,n,e]),o},p4e=e=>{const t=I($S);return u.useMemo(()=>t===e,[t,e])},L1={thickness:2,backgroundColor:"base.600"},g4e={display:"block",position:"absolute",zIndex:1,borderRadius:"full",pointerEvents:"none",background:L1.backgroundColor},m4e={horizontal:{height:`${L1.thickness}px`,left:2,right:2},vertical:{width:`${L1.thickness}px`,top:2,bottom:2}},y4e={top:"horizontal",bottom:"horizontal",left:"vertical",right:"vertical"},b4e={top:{top:"var(--local-line-offset)"},right:{right:"var(--local-line-offset)"},bottom:{bottom:"var(--local-line-offset)"},left:{left:"var(--local-line-offset)"}};function x4e({edge:e,gap:t="0px"}){const n=`calc(-0.5 * (${t} + ${L1.thickness}px))`,s=y4e[e];return r.jsx(Se,{sx:{...g4e,...m4e[s],...b4e[e],"--local-line-offset":n}})}const Og=({activeDropRegion:e,gap:t})=>!e||e==="center"?null:r.jsx(x4e,{edge:e,gap:t||"var(--invoke-space-2)"}),v4e={w:"full",h:"full",borderWidth:1,borderRadius:"base",borderTopRadius:"unset",borderTop:"unset",borderColor:"baseAlpha.250",'&[data-depth="0"]':{borderColor:"baseAlpha.100"},'&[data-depth="1"]':{borderColor:"baseAlpha.150"},'&[data-depth="2"]':{borderColor:"baseAlpha.200"},'&[data-is-dragging="true"]':{opacity:.3}},Vd=u.memo(({children:e,...t})=>{const n=Yb();return r.jsx(T,{sx:v4e,"data-depth":n,...t,children:e})});Vd.displayName="FormElementEditModeContent";const C4e={position:"relative",minH:8,py:.5,alignItems:"center",w:"full",h:"full"},Qb=u.memo(({children:e})=>r.jsx(T,{sx:C4e,children:e}));Qb.displayName="InputFieldWrapper";const w4e=(e,t)=>{const n=u.useMemo(()=>fe(Qe,i=>{const o=ld(i,e);return o?!!o.data.inputs[t]:!1}),[t,e]);return I(n)},S4e=(e,t)=>{const n=ae(sn),s=u.useMemo(()=>fe(Qe,o=>{const a=ld(o,e);if(!a)return t;const l=a.data.inputs[t],c=n[a.data.type],d=c==null?void 0:c.inputs[t];return(l==null?void 0:l.label)||(d==null?void 0:d.title)||t}),[t,e,n]);return I(s)},j4e=(e,t)=>{const n=ae(sn),s=u.useMemo(()=>fe(Qe,o=>{const a=ld(o,e);if(!a)return!1;const l=n[a.data.type];return!!(l==null?void 0:l.inputs[t])}),[t,e,n]);return I(s)},_c=u.memo(({nodeId:e,fieldName:t,children:n,fallback:s,formatLabel:i})=>{const o=w4e(e,t),a=j4e(e,t);return!a||!o?s!==void 0?s:r.jsx(lH,{nodeId:e,fieldName:t,formatLabel:i,hasInstance:o,hasTemplate:a}):n});_c.displayName="InputFieldGate";const lH=u.memo(({nodeId:e,fieldName:t,formatLabel:n,hasTemplate:s,hasInstance:i})=>{const{t:o}=A(),a=S4e(e,t),l=u.useMemo(()=>n?n(a):s&&!i?o("nodes.missingField_withName",{name:a}):!s&&i?o("nodes.unexpectedField_withName",{name:a}):o("nodes.unknownField_withName",{name:a}),[n,i,s,a,o]);return r.jsx(Qb,{children:r.jsx(T,{w:"full",px:1,py:1,justifyContent:"center",children:r.jsx(q,{fontWeight:"semibold",color:"error.300",whiteSpace:"pre",textAlign:"center",children:l})})})});lH.displayName="Fallback";const cH=u.memo(({element:e})=>{const{id:t,data:n}=e,{layout:s}=n,{t:i}=A(),o=G(),a=u.useCallback(()=>{o(G2({id:t,changes:{layout:"row"}}))},[o,t]),l=u.useCallback(()=>{o(G2({id:t,changes:{layout:"column"}}))},[o,t]);return r.jsxs(rs,{placement:"top",isLazy:!0,lazyBehavior:"unmount",children:[r.jsx(gs,{children:r.jsx(oe,{"aria-label":"settings",icon:r.jsx(u7,{}),variant:"link",size:"sm",alignSelf:"stretch"})}),r.jsx(hc,{children:r.jsxs(is,{children:[r.jsx(Li,{}),r.jsx(ms,{children:r.jsxs(K,{children:[r.jsx(J,{m:0,children:i("workflows.builder.layout")}),r.jsxs(Zn,{variant:"outline",size:"sm",children:[r.jsx(de,{onClick:a,colorScheme:s==="row"?"invokeBlue":"base",children:i("workflows.builder.row")}),r.jsx(de,{onClick:l,colorScheme:s==="column"?"invokeBlue":"base",children:i("workflows.builder.column")})]})]})})]})})]})});cH.displayName="ContainerElementSettings";const zd=(e,t,n)=>{const s=(n==null?void 0:n.min)??t.min,i=(n==null?void 0:n.max)??t.max,o=(n==null?void 0:n.step)??t.step;if(o===void 0)return Math.min(Math.max(e,s),i);let a=Math.round(e/o)*o;return a<s?a=Math.ceil(s/o)*o:a>i&&(a=Math.floor(i/o)*o),Math.min(Math.max(a,s),i)},Ng=(e,t,n,s={})=>{const{min:i,max:o,step:a}=s,l=G(),c=u.useMemo(()=>a!==void 0?a:qe(n.multipleOf)?.1:n.multipleOf,[n.multipleOf,a]),d=u.useMemo(()=>a!==void 0?a:qe(n.multipleOf)?.01:n.multipleOf,[n.multipleOf,a]),h=u.useMemo(()=>{let m=-4294967295;return i!==void 0?m=i:qe(n.minimum)?qe(n.exclusiveMinimum)||(m=n.exclusiveMinimum+.01):m=n.minimum,By(m,c)},[n.exclusiveMinimum,n.minimum,i,c]),f=u.useMemo(()=>{let m=cd;return o!==void 0?m=o:qe(n.maximum)?qe(n.exclusiveMaximum)||(m=n.exclusiveMaximum-.01):m=n.maximum,Fu(m,c)},[n.exclusiveMaximum,n.maximum,o,c]),p=u.useCallback(m=>zd(m,{min:h,max:f,step:c},{min:i,max:o,step:a}),[f,h,o,i,a,c]),g=u.useCallback(m=>{l(VS({nodeId:e,fieldName:t,value:m}))},[l,t,e]);return{defaultValue:n.default,onChange:g,min:h,max:f,step:c,fineStep:d,constrainValue:p}},Ic=(e,t)=>{const n=u.useMemo(()=>fe(Qe,i=>{const o=Ey(i,e,t);return we(o,`Instance for input field ${t} not found`),o}),[t,e]);return I(n)},uH=u.memo(({id:e,settings:t,nodeId:n,fieldName:s,fieldTemplate:i})=>r.jsxs(r.Fragment,{children:[r.jsx(dH,{id:e,settings:t,nodeId:n,fieldName:s,fieldTemplate:i}),r.jsx(hH,{id:e,settings:t,nodeId:n,fieldName:s,fieldTemplate:i}),r.jsx(fH,{id:e,settings:t,nodeId:n,fieldName:s,fieldTemplate:i})]}));uH.displayName="NodeFieldElementFloatSettings";const dH=u.memo(({id:e,settings:t})=>{const{t:n}=A(),s=G(),i=u.useCallback(o=>{const a={...t,component:nL.parse(o.target.value)};s(ns({id:e,changes:{settings:a}}))},[t,s,e]);return r.jsxs(K,{orientation:"vertical",children:[r.jsx(J,{flex:1,children:n("workflows.builder.component")}),r.jsxs(_i,{value:t.component,onChange:i,size:"sm",children:[r.jsx("option",{value:"number-input",children:n("workflows.builder.numberInput")}),r.jsx("option",{value:"slider",children:n("workflows.builder.slider")}),r.jsx("option",{value:"number-input-and-slider",children:n("workflows.builder.both")})]})]})});dH.displayName="SettingComponent";const hH=u.memo(({id:e,settings:t,nodeId:n,fieldName:s,fieldTemplate:i})=>{const{t:o}=A(),a=G(),l=Ic(n,s),c=Ng(n,s,i),d=u.useCallback(()=>{const g={...t,min:t.min!==void 0?void 0:c.min};a(ns({id:e,changes:{settings:g}}))},[t,a,c,e]),h=u.useCallback(g=>{const m={...t,min:g};a(ns({id:e,changes:{settings:m}}));const y=zd(l.value,c,m);l.value!==y&&a(VS({nodeId:n,fieldName:s,value:y}))},[t,a,l.value,s,c,e,n]),f=u.useMemo(()=>By(c.min,c.step),[c.min,c.step]),p=u.useMemo(()=>(t.max??c.max)-c.step,[t.max,c.max,c.step]);return r.jsxs(K,{orientation:"vertical",children:[r.jsxs(T,{justifyContent:"space-between",w:"full",alignItems:"center",children:[r.jsx(J,{m:0,children:o("workflows.builder.minimum")}),r.jsx(et,{isChecked:t.min!==void 0,onChange:d,size:"sm"})]}),r.jsx(Ie,{w:"full",isDisabled:t.min===void 0,value:t.min===void 0?`${c.min} (inherited)`:t.min,onChange:h,min:f,max:p,step:c.step})]})});hH.displayName="SettingMin";const fH=u.memo(({id:e,settings:t,nodeId:n,fieldName:s,fieldTemplate:i})=>{const{t:o}=A(),a=G(),l=Ic(n,s),c=Ng(n,s,i),d=u.useCallback(()=>{const g={...t,max:t.max!==void 0?void 0:c.max};a(ns({id:e,changes:{settings:g}}))},[t,a,c,e]),h=u.useCallback(g=>{const m={...t,max:g};a(ns({id:e,changes:{settings:m}}));const y=zd(l.value,c,m);l.value!==y&&a(VS({nodeId:n,fieldName:s,value:y}))},[t,a,l.value,s,c,e,n]),f=u.useMemo(()=>(t.min??c.min)+c.step,[t.min,c.min,c.step]),p=u.useMemo(()=>Fu(c.max,c.step),[c.max,c.step]);return r.jsxs(K,{orientation:"vertical",children:[r.jsxs(T,{justifyContent:"space-between",w:"full",alignItems:"center",children:[r.jsx(J,{m:0,children:o("workflows.builder.maximum")}),r.jsx(et,{isChecked:t.max!==void 0,onChange:d,size:"sm"})]}),r.jsx(Ie,{w:"full",isDisabled:t.max===void 0,value:t.max===void 0?`${c.max} (inherited)`:t.max,onChange:h,min:f,max:p,step:c.step})]})});fH.displayName="SettingMax";const Fg=(e,t,n,s={})=>{const{min:i,max:o,step:a}=s,l=G(),c=u.useMemo(()=>a!==void 0?a:qe(n.multipleOf)?1:n.multipleOf,[n.multipleOf,a]),d=u.useMemo(()=>a!==void 0?a:qe(n.multipleOf)?1:n.multipleOf,[n.multipleOf,a]),h=u.useMemo(()=>{let m=-4294967295;return i!==void 0?m=i:qe(n.minimum)?qe(n.exclusiveMinimum)||(m=n.exclusiveMinimum+1):m=n.minimum,By(m,c)},[n.exclusiveMinimum,n.minimum,i,c]),f=u.useMemo(()=>{let m=cd;return o!==void 0?m=o:qe(n.maximum)?qe(n.exclusiveMaximum)||(m=n.exclusiveMaximum-1):m=n.maximum,Fu(m,c)},[n.exclusiveMaximum,n.maximum,o,c]),p=u.useCallback(m=>zd(m,{min:h,max:f,step:c},{min:i,max:o,step:a}),[f,h,o,i,a,c]),g=u.useCallback(m=>{l(zS({nodeId:e,fieldName:t,value:m}))},[l,t,e]);return{defaultValue:n.default,onChange:g,min:h,max:f,step:c,fineStep:d,constrainValue:p}},pH=u.memo(({id:e,settings:t,nodeId:n,fieldName:s,fieldTemplate:i})=>r.jsxs(r.Fragment,{children:[r.jsx(gH,{id:e,settings:t,nodeId:n,fieldName:s,fieldTemplate:i}),r.jsx(mH,{id:e,settings:t,nodeId:n,fieldName:s,fieldTemplate:i}),r.jsx(yH,{id:e,settings:t,nodeId:n,fieldName:s,fieldTemplate:i})]}));pH.displayName="NodeFieldElementIntegerSettings";const gH=u.memo(({id:e,settings:t})=>{const{t:n}=A(),s=G(),i=u.useCallback(o=>{const a={...t,component:nL.parse(o.target.value)};s(ns({id:e,changes:{settings:a}}))},[t,s,e]);return r.jsxs(K,{orientation:"vertical",children:[r.jsx(J,{flex:1,children:n("workflows.builder.component")}),r.jsxs(_i,{value:t.component,onChange:i,size:"sm",children:[r.jsx("option",{value:"number-input",children:n("workflows.builder.numberInput")}),r.jsx("option",{value:"slider",children:n("workflows.builder.slider")}),r.jsx("option",{value:"number-input-and-slider",children:n("workflows.builder.both")})]})]})});gH.displayName="SettingComponent";const mH=u.memo(({id:e,settings:t,nodeId:n,fieldName:s,fieldTemplate:i})=>{const{t:o}=A(),a=G(),l=Ic(n,s),c=Fg(n,s,i),d=u.useCallback(()=>{const g={...t,min:t.min!==void 0?void 0:c.min};a(ns({id:e,changes:{settings:g}}))},[t,a,c.min,e]),h=u.useCallback(g=>{const m={...t,min:g};a(ns({id:e,changes:{settings:m}}));const y=zd(l.value,c,m);l.value!==y&&a(zS({nodeId:n,fieldName:s,value:y}))},[t,a,e,l,c,n,s]),f=u.useMemo(()=>By(c.min,c.step),[c.min,c.step]),p=u.useMemo(()=>(t.max??c.max)-c.step,[t.max,c.max,c.step]);return r.jsxs(K,{orientation:"vertical",children:[r.jsxs(T,{justifyContent:"space-between",w:"full",alignItems:"center",children:[r.jsx(J,{m:0,children:o("workflows.builder.minimum")}),r.jsx(et,{isChecked:t.min!==void 0,onChange:d,size:"sm"})]}),r.jsx(Ie,{w:"full",isDisabled:t.min===void 0,value:t.min??`${c.min} (inherited)`,onChange:h,min:f,max:p,step:c.step})]})});mH.displayName="SettingMin";const yH=u.memo(({id:e,settings:t,nodeId:n,fieldName:s,fieldTemplate:i})=>{const{t:o}=A(),a=G(),l=Ic(n,s),c=Fg(n,s,i),d=u.useCallback(()=>{const g={...t,max:t.max!==void 0?void 0:c.max};a(ns({id:e,changes:{settings:g}}))},[t,a,c.max,e]),h=u.useCallback(g=>{const m={...t,max:g};a(ns({id:e,changes:{settings:m}}));const y=zd(l.value,c,m);l.value!==y&&a(zS({nodeId:n,fieldName:s,value:y}))},[t,a,l.value,s,c,e,n]),f=u.useMemo(()=>(t.min??c.min)+c.step,[t.min,c.min,c.step]),p=u.useMemo(()=>Fu(c.max,c.step),[c.max,c.step]);return r.jsxs(K,{orientation:"vertical",children:[r.jsxs(T,{justifyContent:"space-between",w:"full",alignItems:"center",children:[r.jsx(J,{m:0,children:o("workflows.builder.maximum")}),r.jsx(et,{isChecked:t.max!==void 0,onChange:d,size:"sm"})]}),r.jsx(Ie,{w:"full",isDisabled:t.max===void 0,value:t.max??`${c.max} (inherited)`,onChange:h,min:f,max:p,step:c.step})]})});yH.displayName="SettingMax";const bH=u.memo(({id:e,settings:t})=>{const{t:n}=A(),s=G(),i=u.useCallback(o=>{const a=_te.parse(o.target.value);if(a!==t.component)if(a==="dropdown"){const l={...t,component:a,options:[H2()]};s(ns({id:e,changes:{settings:l}}));return}else{const l=Yo({...t,component:a},"options");s(ns({id:e,changes:{settings:l}}))}},[t,s,e]);return r.jsxs(K,{children:[r.jsx(J,{flex:1,children:n("workflows.builder.component")}),r.jsxs(_i,{value:t.component,onChange:i,size:"sm",children:[r.jsx("option",{value:"input",children:n("workflows.builder.singleLine")}),r.jsx("option",{value:"textarea",children:n("workflows.builder.multiLine")}),r.jsx("option",{value:"dropdown",children:n("workflows.builder.dropdown")})]})]})});bH.displayName="NodeFieldElementStringSettings";const Ni=(e,t)=>{const n=Rs(e);return u.useMemo(()=>{const i=n.inputs[t];return we(i,`Template for input field ${t} not found.`),i},[t,n.inputs])},xH=u.memo(({element:e})=>{const{id:t,data:n}=e,{showDescription:s,fieldIdentifier:i}=n,{nodeId:o,fieldName:a}=i,l=Ni(o,a),{t:c}=A(),d=G(),h=u.useCallback(()=>{d(ns({id:t,changes:{showDescription:!s}}))},[d,t,s]),f=u.useMemo(()=>n.settings?n.settings:P0(l)?Ite():M0(l)?Tte():sL(l)?Ate():null,[n.settings,l]);return r.jsxs(rs,{placement:"top",isLazy:!0,lazyBehavior:"unmount",children:[r.jsx(gs,{children:r.jsx(oe,{"aria-label":"settings",icon:r.jsx(u7,{}),variant:"link",size:"sm",alignSelf:"stretch"})}),r.jsx(hc,{children:r.jsxs(is,{children:[r.jsx(Li,{}),r.jsx(ms,{minW:48,children:r.jsxs(T,{w:"full",h:"full",gap:2,flexDir:"column",children:[r.jsxs(K,{children:[r.jsx(J,{flex:1,children:c("workflows.builder.showDescription")}),r.jsx(et,{size:"sm",isChecked:s,onChange:h})]}),(f==null?void 0:f.type)==="integer-field-config"&&P0(l)&&r.jsx(pH,{id:t,settings:f,nodeId:o,fieldName:a,fieldTemplate:l}),(f==null?void 0:f.type)==="float-field-config"&&M0(l)&&r.jsx(uH,{id:t,settings:f,nodeId:o,fieldName:a,fieldTemplate:l}),(f==null?void 0:f.type)==="string-field-config"&&r.jsx(bH,{id:t,settings:f})]})})]})})]})});xH.displayName="NodeFieldElementSettings";const k0=Oe(null),vH=e=>{const[t,n]=u.useState(!1);u.useEffect(()=>k0.subscribe(a=>{n(a===e)}),[t,e]);const s=u.useCallback(()=>{k0.set(e)},[e]),i=u.useCallback(()=>{k0.set(null)},[]);return{isMouseOverNode:t,handleMouseOver:s,handleMouseOut:i}},Xv=Oe(null),Bg=e=>{const[t,n]=u.useState(!1);u.useEffect(()=>Xv.subscribe(a=>{n(a===e)}),[t,e]);const s=u.useCallback(()=>{Xv.set(e)},[e]),i=u.useCallback(()=>{Xv.set(null)},[]);return{isMouseOverFormField:t,handleMouseOver:s,handleMouseOut:i}},k4e=$n("workflows"),Jb=e=>u.useCallback(()=>{const n=Cf.get();if(!n){k4e.warn("No flow instance found, cannot zoom to node");return}n.fitView({duration:300,maxZoom:1.5,nodes:[{id:e}]})},[e]),_4e={w:"full",ps:2,h:8,minH:8,maxH:8,borderTopRadius:"base",alignItems:"center",color:"base.500",bg:"baseAlpha.250",cursor:"grab",'&[data-depth="0"]':{bg:"baseAlpha.100"},'&[data-depth="1"]':{bg:"baseAlpha.150"},'&[data-depth="2"]':{bg:"baseAlpha.200"},'&[data-is-dragging="true"]':{opacity:.3},_hover:{bg:"baseAlpha.300"}},Gd=u.memo(({element:e,dragHandleRef:t,...n})=>{const s=Yb();return r.jsxs(T,{ref:t,sx:_4e,"data-depth":s,...n,children:[r.jsx(SH,{element:e}),r.jsx(it,{}),Xr(e)&&r.jsx(cH,{element:e}),GS(e)&&r.jsxs(_c,{nodeId:e.data.fieldIdentifier.nodeId,fieldName:e.data.fieldIdentifier.fieldName,fallback:null,children:[r.jsx(CH,{element:e}),r.jsx(xH,{element:e})]}),r.jsx(wH,{element:e})]})});Gd.displayName="FormElementEditModeHeader";const CH=u.memo(({element:e})=>{const{t}=A(),{nodeId:n}=e.data.fieldIdentifier,s=Jb(n),i=Bg(n);return r.jsx(oe,{onMouseOver:i.handleMouseOver,onMouseOut:i.handleMouseOut,tooltip:t("workflows.builder.zoomToNode"),"aria-label":t("workflows.builder.zoomToNode"),onClick:s,icon:r.jsx(zde,{}),variant:"link",size:"sm",alignSelf:"stretch"})});CH.displayName="ZoomToNodeButton";const wH=u.memo(({element:e})=>{const{t}=A(),n=G(),s=u.useCallback(()=>{n(Ete({id:e.id}))},[n,e.id]);return r.jsx(oe,{tooltip:t("common.delete"),"aria-label":t("common.delete"),onClick:s,icon:r.jsx(Ot,{}),variant:"link",size:"sm",alignSelf:"stretch",colorScheme:"error"})});wH.displayName="RemoveElementButton";const SH=u.memo(({element:e})=>{const{t}=A(),n=u.useMemo(()=>Xr(e)&&e.data.layout==="column"?t("workflows.builder.containerColumnLayout"):Xr(e)&&e.data.layout==="row"?t("workflows.builder.containerRowLayout"):t(`workflows.builder.${Uae(e.type)}`),[e,t]);return r.jsx(q,{fontWeight:"semibold",noOfLines:1,wordBreak:"break-all",userSelect:"none",children:n})});SH.displayName="Label";const I4e={position:"relative",borderRadius:"base",'&[data-parent-layout="column"]':{w:"full",h:"min-content"},'&[data-parent-layout="row"]':{w:"min-content",h:"full"},flexDir:"column"},jH=u.memo(({el:e})=>{const t=u.useRef(null),n=u.useRef(null),[s,i]=Rg(e.id,t,n),o=Oi(),{id:a}=e;return r.jsxs(T,{ref:t,id:a,className:rL,sx:I4e,"data-parent-layout":o.layout,children:[r.jsx(Gd,{dragHandleRef:n,element:e,"data-is-dragging":i}),r.jsx(Vd,{"data-is-dragging":i,p:4,children:r.jsx(tH,{})}),r.jsx(Og,{activeDropRegion:s,gap:"var(--invoke-space-4)"})]})});jH.displayName="DividerElementEditMode";const T4e={bg:"base.700",flexShrink:0,'&[data-layout="column"]':{width:"100%",height:"1px"},'&[data-layout="row"]':{height:"100%",width:"1px"}},kH=u.memo(({el:e})=>{const t=Oi(),{id:n}=e;return r.jsx(T,{id:n,className:rL,sx:T4e,"data-layout":(t==null?void 0:t.layout)||"column"})});kH.displayName="DividerElementViewMode";const Hd=e=>{const t=u.useMemo(()=>Mte(e),[e]);return I(t)},_H=u.memo(({id:e})=>{const t=Hd(e),n=I(Co);if(!(!t||!iL(t)))return n==="view"?r.jsx(kH,{el:t}):r.jsx(jH,{el:t})});_H.displayName="DividerElement";function Ds(){return Ds=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)({}).hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Ds.apply(null,arguments)}function A4e(e,t){if(e==null)return{};var n={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.includes(s))continue;n[s]=e[s]}return n}var E4e=u.useLayoutEffect,M4e=function(t){var n=be.useRef(t);return E4e(function(){n.current=t}),n},t8=function(t,n){if(typeof t=="function"){t(n);return}t.current=n},P4e=function(t,n){var s=be.useRef();return be.useCallback(function(i){t.current=i,s.current&&t8(s.current,null),s.current=n,n&&t8(n,i)},[n])},n8={"min-height":"0","max-height":"none",height:"0",visibility:"hidden",overflow:"hidden",position:"absolute","z-index":"-1000",top:"0",right:"0",display:"block"},L4e=function(t){Object.keys(n8).forEach(function(n){t.style.setProperty(n,n8[n],"important")})},s8=L4e,Ns=null,r8=function(t,n){var s=t.scrollHeight;return n.sizingStyle.boxSizing==="border-box"?s+n.borderSize:s-n.paddingSize};function D4e(e,t,n,s){n===void 0&&(n=1),s===void 0&&(s=1/0),Ns||(Ns=document.createElement("textarea"),Ns.setAttribute("tabindex","-1"),Ns.setAttribute("aria-hidden","true"),s8(Ns)),Ns.parentNode===null&&document.body.appendChild(Ns);var i=e.paddingSize,o=e.borderSize,a=e.sizingStyle,l=a.boxSizing;Object.keys(a).forEach(function(p){var g=p;Ns.style[g]=a[g]}),s8(Ns),Ns.value=t;var c=r8(Ns,e);Ns.value=t,c=r8(Ns,e),Ns.value="x";var d=Ns.scrollHeight-i,h=d*n;l==="border-box"&&(h=h+i+o),c=Math.max(h,c);var f=d*s;return l==="border-box"&&(f=f+i+o),c=Math.min(f,c),[c,d]}var i8=function(){},R4e=function(t,n){return t.reduce(function(s,i){return s[i]=n[i],s},{})},O4e=["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopWidth","boxSizing","fontFamily","fontSize","fontStyle","fontWeight","letterSpacing","lineHeight","paddingBottom","paddingLeft","paddingRight","paddingTop","tabSize","textIndent","textRendering","textTransform","width","wordBreak","wordSpacing","scrollbarGutter"],N4e=!!document.documentElement.currentStyle,F4e=function(t){var n=window.getComputedStyle(t);if(n===null)return null;var s=R4e(O4e,n),i=s.boxSizing;if(i==="")return null;N4e&&i==="border-box"&&(s.width=parseFloat(s.width)+parseFloat(s.borderRightWidth)+parseFloat(s.borderLeftWidth)+parseFloat(s.paddingRight)+parseFloat(s.paddingLeft)+"px");var o=parseFloat(s.paddingBottom)+parseFloat(s.paddingTop),a=parseFloat(s.borderBottomWidth)+parseFloat(s.borderTopWidth);return{sizingStyle:s,paddingSize:o,borderSize:a}},B4e=F4e;function X_(e,t,n){var s=M4e(n);u.useLayoutEffect(function(){var i=function(a){return s.current(a)};if(e)return e.addEventListener(t,i),function(){return e.removeEventListener(t,i)}},[])}var $4e=function(t,n){X_(document.body,"reset",function(s){t.current.form===s.target&&n(s)})},V4e=function(t){X_(window,"resize",t)},z4e=function(t){X_(document.fonts,"loadingdone",t)},G4e=["cacheMeasurements","maxRows","minRows","onChange","onHeightChange"],H4e=function(t,n){var s=t.cacheMeasurements,i=t.maxRows,o=t.minRows,a=t.onChange,l=a===void 0?i8:a,c=t.onHeightChange,d=c===void 0?i8:c,h=A4e(t,G4e),f=h.value!==void 0,p=u.useRef(null),g=P4e(p,n),m=u.useRef(0),y=u.useRef(),b=function(){var v=p.current,w=s&&y.current?y.current:B4e(v);if(w){y.current=w;var S=D4e(w,v.value||v.placeholder||"x",o,i),j=S[0],P=S[1];m.current!==j&&(m.current=j,v.style.setProperty("height",j+"px","important"),d(j,{rowHeight:P}))}},C=function(v){f||b(),l(v)};return u.useLayoutEffect(b),$4e(p,function(){if(!f){var x=p.current,v=x.value;requestAnimationFrame(function(){v!==x.value&&b()})}}),V4e(b),z4e(b),u.createElement("textarea",Ds({},h,{onChange:C,ref:g}))},W4e=u.forwardRef(H4e);const U4e=vo(W4e),Q_=Wp(oL(({variant:e,...t},n)=>{const s=Pte("Textarea",{variant:e});return r.jsx(U4e,{__css:s,ref:n,...t})}));Q_.displayName="AutosizeTextarea";const $g={a:{fontWeight:"semibold"},"a:hover":{textDecoration:"underline"}},Vg={target:"_blank",rel:"noopener noreferrer",validate:e=>/^https?:\/\//.test(e)},q4e="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2ntley5rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6logistics9properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3ncaster6d0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2psy3ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0america6xi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mgensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",K4e="121342632165322333335355455655552435435422463632574574330355524444661154543332344423364211133222221212112052232222232212222223222241112222224322321222",Jl=(e,t)=>{for(const n in t)e[n]=t[n];return e},Cw="numeric",ww="ascii",Sw="alpha",Lf="asciinumeric",vf="alphanumeric",jw="domain",IH="emoji",Z4e="scheme",Y4e="slashscheme",Qv="whitespace";function X4e(e,t){return e in t||(t[e]=[]),t[e]}function Rl(e,t,n){t[Cw]&&(t[Lf]=!0,t[vf]=!0),t[ww]&&(t[Lf]=!0,t[Sw]=!0),t[Lf]&&(t[vf]=!0),t[Sw]&&(t[vf]=!0),t[vf]&&(t[jw]=!0),t[IH]&&(t[jw]=!0);for(const s in t){const i=X4e(s,n);i.indexOf(e)<0&&i.push(e)}}function Q4e(e,t){const n={};for(const s in t)t[s].indexOf(e)>=0&&(n[s]=!0);return n}function br(e=null){this.j={},this.jr=[],this.jd=null,this.t=e}br.groups={};br.prototype={accepts(){return!!this.t},go(e){const t=this,n=t.j[e];if(n)return n;for(let s=0;s<t.jr.length;s++){const i=t.jr[s][0],o=t.jr[s][1];if(o&&i.test(e))return o}return t.jd},has(e,t=!1){return t?e in this.j:!!this.go(e)},ta(e,t,n,s){for(let i=0;i<e.length;i++)this.tt(e[i],t,n,s)},tr(e,t,n,s){s=s||br.groups;let i;return t&&t.j?i=t:(i=new br(t),n&&s&&Rl(t,n,s)),this.jr.push([e,i]),i},ts(e,t,n,s){let i=this;const o=e.length;if(!o)return i;for(let a=0;a<o-1;a++)i=i.tt(e[a]);return i.tt(e[o-1],t,n,s)},tt(e,t,n,s){s=s||br.groups;const i=this;if(t&&t.j)return i.j[e]=t,t;const o=t;let a,l=i.go(e);if(l?(a=new br,Jl(a.j,l.j),a.jr.push.apply(a.jr,l.jr),a.jd=l.jd,a.t=l.t):a=new br,o){if(s)if(a.t&&typeof a.t=="string"){const c=Jl(Q4e(a.t,s),n);Rl(o,c,s)}else n&&Rl(o,n,s);a.t=o}return i.j[e]=a,a}};const yt=(e,t,n,s,i)=>e.ta(t,n,s,i),jn=(e,t,n,s,i)=>e.tr(t,n,s,i),o8=(e,t,n,s,i)=>e.ts(t,n,s,i),_e=(e,t,n,s,i)=>e.tt(t,n,s,i),Lo="WORD",kw="UWORD",TH="ASCIINUMERICAL",AH="ALPHANUMERICAL",pp="LOCALHOST",_w="TLD",Iw="UTLD",_0="SCHEME",tu="SLASH_SCHEME",J_="NUM",Tw="WS",e4="NL",Df="OPENBRACE",Rf="CLOSEBRACE",D1="OPENBRACKET",R1="CLOSEBRACKET",O1="OPENPAREN",N1="CLOSEPAREN",F1="OPENANGLEBRACKET",B1="CLOSEANGLEBRACKET",$1="FULLWIDTHLEFTPAREN",V1="FULLWIDTHRIGHTPAREN",z1="LEFTCORNERBRACKET",G1="RIGHTCORNERBRACKET",H1="LEFTWHITECORNERBRACKET",W1="RIGHTWHITECORNERBRACKET",U1="FULLWIDTHLESSTHAN",q1="FULLWIDTHGREATERTHAN",K1="AMPERSAND",t4="APOSTROPHE",Z1="ASTERISK",xa="AT",Y1="BACKSLASH",X1="BACKTICK",Q1="CARET",_a="COLON",n4="COMMA",J1="DOLLAR",zi="DOT",ey="EQUALS",s4="EXCLAMATION",Ur="HYPHEN",Of="PERCENT",ty="PIPE",ny="PLUS",sy="POUND",Nf="QUERY",r4="QUOTE",EH="FULLWIDTHMIDDLEDOT",i4="SEMI",Gi="SLASH",Ff="TILDE",ry="UNDERSCORE",MH="EMOJI",iy="SYM";var PH=Object.freeze({__proto__:null,WORD:Lo,UWORD:kw,ASCIINUMERICAL:TH,ALPHANUMERICAL:AH,LOCALHOST:pp,TLD:_w,UTLD:Iw,SCHEME:_0,SLASH_SCHEME:tu,NUM:J_,WS:Tw,NL:e4,OPENBRACE:Df,CLOSEBRACE:Rf,OPENBRACKET:D1,CLOSEBRACKET:R1,OPENPAREN:O1,CLOSEPAREN:N1,OPENANGLEBRACKET:F1,CLOSEANGLEBRACKET:B1,FULLWIDTHLEFTPAREN:$1,FULLWIDTHRIGHTPAREN:V1,LEFTCORNERBRACKET:z1,RIGHTCORNERBRACKET:G1,LEFTWHITECORNERBRACKET:H1,RIGHTWHITECORNERBRACKET:W1,FULLWIDTHLESSTHAN:U1,FULLWIDTHGREATERTHAN:q1,AMPERSAND:K1,APOSTROPHE:t4,ASTERISK:Z1,AT:xa,BACKSLASH:Y1,BACKTICK:X1,CARET:Q1,COLON:_a,COMMA:n4,DOLLAR:J1,DOT:zi,EQUALS:ey,EXCLAMATION:s4,HYPHEN:Ur,PERCENT:Of,PIPE:ty,PLUS:ny,POUND:sy,QUERY:Nf,QUOTE:r4,FULLWIDTHMIDDLEDOT:EH,SEMI:i4,SLASH:Gi,TILDE:Ff,UNDERSCORE:ry,EMOJI:MH,SYM:iy});const Eo=/[a-z]/,nf=new RegExp("\\p{L}","u"),Jv=new RegExp("\\p{Emoji}","u"),Mo=/\d/,e2=/\s/,a8="\r",t2=`
`,J4e="",eIe="",n2="";let Hm=null,Wm=null;function tIe(e=[]){const t={};br.groups=t;const n=new br;Hm==null&&(Hm=l8(q4e)),Wm==null&&(Wm=l8(K4e)),_e(n,"'",t4),_e(n,"{",Df),_e(n,"}",Rf),_e(n,"[",D1),_e(n,"]",R1),_e(n,"(",O1),_e(n,")",N1),_e(n,"<",F1),_e(n,">",B1),_e(n,"",$1),_e(n,"",V1),_e(n,"",z1),_e(n,"",G1),_e(n,"",H1),_e(n,"",W1),_e(n,"",U1),_e(n,"",q1),_e(n,"&",K1),_e(n,"*",Z1),_e(n,"@",xa),_e(n,"`",X1),_e(n,"^",Q1),_e(n,":",_a),_e(n,",",n4),_e(n,"$",J1),_e(n,".",zi),_e(n,"=",ey),_e(n,"!",s4),_e(n,"-",Ur),_e(n,"%",Of),_e(n,"|",ty),_e(n,"+",ny),_e(n,"#",sy),_e(n,"?",Nf),_e(n,'"',r4),_e(n,"/",Gi),_e(n,";",i4),_e(n,"~",Ff),_e(n,"_",ry),_e(n,"\\",Y1),_e(n,"",EH);const s=jn(n,Mo,J_,{[Cw]:!0});jn(s,Mo,s);const i=jn(s,Eo,TH,{[Lf]:!0}),o=jn(s,nf,AH,{[vf]:!0}),a=jn(n,Eo,Lo,{[ww]:!0});jn(a,Mo,i),jn(a,Eo,a),jn(i,Mo,i),jn(i,Eo,i);const l=jn(n,nf,kw,{[Sw]:!0});jn(l,Eo),jn(l,Mo,o),jn(l,nf,l),jn(o,Mo,o),jn(o,Eo),jn(o,nf,o);const c=_e(n,t2,e4,{[Qv]:!0}),d=_e(n,a8,Tw,{[Qv]:!0}),h=jn(n,e2,Tw,{[Qv]:!0});_e(n,n2,h),_e(d,t2,c),_e(d,n2,h),jn(d,e2,h),_e(h,a8),_e(h,t2),jn(h,e2,h),_e(h,n2,h);const f=jn(n,Jv,MH,{[IH]:!0});_e(f,"#"),jn(f,Jv,f),_e(f,J4e,f);const p=_e(f,eIe);_e(p,"#"),jn(p,Jv,f);const g=[[Eo,a],[Mo,i]],m=[[Eo,null],[nf,l],[Mo,o]];for(let y=0;y<Hm.length;y++)da(n,Hm[y],_w,Lo,g);for(let y=0;y<Wm.length;y++)da(n,Wm[y],Iw,kw,m);Rl(_w,{tld:!0,ascii:!0},t),Rl(Iw,{utld:!0,alpha:!0},t),da(n,"file",_0,Lo,g),da(n,"mailto",_0,Lo,g),da(n,"http",tu,Lo,g),da(n,"https",tu,Lo,g),da(n,"ftp",tu,Lo,g),da(n,"ftps",tu,Lo,g),Rl(_0,{scheme:!0,ascii:!0},t),Rl(tu,{slashscheme:!0,ascii:!0},t),e=e.sort((y,b)=>y[0]>b[0]?1:-1);for(let y=0;y<e.length;y++){const b=e[y][0],x=e[y][1]?{[Z4e]:!0}:{[Y4e]:!0};b.indexOf("-")>=0?x[jw]=!0:Eo.test(b)?Mo.test(b)?x[Lf]=!0:x[ww]=!0:x[Cw]=!0,o8(n,b,b,x)}return o8(n,"localhost",pp,{ascii:!0}),n.jd=new br(iy),{start:n,tokens:Jl({groups:t},PH)}}function LH(e,t){const n=nIe(t.replace(/[A-Z]/g,l=>l.toLowerCase())),s=n.length,i=[];let o=0,a=0;for(;a<s;){let l=e,c=null,d=0,h=null,f=-1,p=-1;for(;a<s&&(c=l.go(n[a]));)l=c,l.accepts()?(f=0,p=0,h=l):f>=0&&(f+=n[a].length,p++),d+=n[a].length,o+=n[a].length,a++;o-=f,a-=p,d-=f,i.push({t:h.t,v:t.slice(o-d,o),s:o-d,e:o})}return i}function nIe(e){const t=[],n=e.length;let s=0;for(;s<n;){let i=e.charCodeAt(s),o,a=i<55296||i>56319||s+1===n||(o=e.charCodeAt(s+1))<56320||o>57343?e[s]:e.slice(s,s+2);t.push(a),s+=a.length}return t}function da(e,t,n,s,i){let o;const a=t.length;for(let l=0;l<a-1;l++){const c=t[l];e.j[c]?o=e.j[c]:(o=new br(s),o.jr=i.slice(),e.j[c]=o),e=o}return o=new br(n),o.jr=i.slice(),e.j[t[a-1]]=o,o}function l8(e){const t=[],n=[];let s=0,i="0123456789";for(;s<e.length;){let o=0;for(;i.indexOf(e[s+o])>=0;)o++;if(o>0){t.push(n.join(""));for(let a=parseInt(e.substring(s,s+o),10);a>0;a--)n.pop();s+=o}else n.push(e[s]),s++}return t}const Zu={defaultProtocol:"http",events:null,format:c8,formatHref:c8,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function ex(e,t=null){let n=Jl({},Zu);e&&(n=Jl(n,e instanceof ex?e.o:e));const s=n.ignoreTags,i=[];for(let o=0;o<s.length;o++)i.push(s[o].toUpperCase());this.o=n,t&&(this.defaultRender=t),this.ignoreTags=i}ex.prototype={o:Zu,ignoreTags:[],defaultRender(e){return e},check(e){return this.get("validate",e.toString(),e)},get(e,t,n){const s=t!=null;let i=this.o[e];return i&&(typeof i=="object"?(i=n.t in i?i[n.t]:Zu[e],typeof i=="function"&&s&&(i=i(t,n))):typeof i=="function"&&s&&(i=i(t,n.t,n)),i)},getObj(e,t,n){let s=this.o[e];return typeof s=="function"&&t!=null&&(s=s(t,n.t,n)),s},render(e){const t=e.render(this);return(this.get("render",null,e)||this.defaultRender)(t,e.t,e)}};function c8(e){return e}var DH=Object.freeze({__proto__:null,defaults:Zu,Options:ex,assign:Jl});function RH(e,t){this.t="token",this.v=e,this.tk=t}RH.prototype={isLink:!1,toString(){return this.v},toHref(e){return this.toString()},toFormattedString(e){const t=this.toString(),n=e.get("truncate",t,this),s=e.get("format",t,this);return n&&s.length>n?s.substring(0,n)+"":s},toFormattedHref(e){return e.get("formatHref",this.toHref(e.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(e=Zu.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(e),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(e){return{type:this.t,value:this.toFormattedString(e),isLink:this.isLink,href:this.toFormattedHref(e),start:this.startIndex(),end:this.endIndex()}},validate(e){return e.get("validate",this.toString(),this)},render(e){const t=this,n=this.toHref(e.get("defaultProtocol")),s=e.get("formatHref",n,this),i=e.get("tagName",n,t),o=this.toFormattedString(e),a={},l=e.get("className",n,t),c=e.get("target",n,t),d=e.get("rel",n,t),h=e.getObj("attributes",n,t),f=e.getObj("events",n,t);return a.href=s,l&&(a.class=l),c&&(a.target=c),d&&(a.rel=d),h&&Jl(a,h),{tagName:i,attributes:a,content:o,eventListeners:f}}};function tx(e,t){class n extends RH{constructor(i,o){super(i,o),this.t=e}}for(const s in t)n.prototype[s]=t[s];return n.t=e,n}const u8=tx("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),d8=tx("text"),sIe=tx("nl"),Um=tx("url",{isLink:!0,toHref(e=Zu.defaultProtocol){return this.hasProtocol()?this.v:`${e}://${this.v}`},hasProtocol(){const e=this.tk;return e.length>=2&&e[0].t!==pp&&e[1].t===_a}}),Gr=e=>new br(e);function rIe({groups:e}){const t=e.domain.concat([K1,Z1,xa,Y1,X1,Q1,J1,ey,Ur,J_,Of,ty,ny,sy,Gi,iy,Ff,ry]),n=[_a,n4,zi,s4,Of,Nf,r4,i4,F1,B1,Df,Rf,R1,D1,O1,N1,$1,V1,z1,G1,H1,W1,U1,q1],s=[K1,t4,Z1,Y1,X1,Q1,J1,ey,Ur,Df,Rf,Of,ty,ny,sy,Nf,Gi,iy,Ff,ry],i=Gr(),o=_e(i,Ff);yt(o,s,o),yt(o,e.domain,o);const a=Gr(),l=Gr(),c=Gr();yt(i,e.domain,a),yt(i,e.scheme,l),yt(i,e.slashscheme,c),yt(a,s,o),yt(a,e.domain,a);const d=_e(a,xa);_e(o,xa,d),_e(l,xa,d),_e(c,xa,d);const h=_e(o,zi);yt(h,s,o),yt(h,e.domain,o);const f=Gr();yt(d,e.domain,f),yt(f,e.domain,f);const p=_e(f,zi);yt(p,e.domain,f);const g=Gr(u8);yt(p,e.tld,g),yt(p,e.utld,g),_e(d,pp,g);const m=_e(f,Ur);_e(m,Ur,m),yt(m,e.domain,f),yt(g,e.domain,f),_e(g,zi,p),_e(g,Ur,m);const y=_e(g,_a);yt(y,e.numeric,u8);const b=_e(a,Ur),C=_e(a,zi);_e(b,Ur,b),yt(b,e.domain,a),yt(C,s,o),yt(C,e.domain,a);const x=Gr(Um);yt(C,e.tld,x),yt(C,e.utld,x),yt(x,e.domain,a),yt(x,s,o),_e(x,zi,C),_e(x,Ur,b),_e(x,xa,d);const v=_e(x,_a),w=Gr(Um);yt(v,e.numeric,w);const S=Gr(Um),j=Gr();yt(S,t,S),yt(S,n,j),yt(j,t,S),yt(j,n,j),_e(x,Gi,S),_e(w,Gi,S);const P=_e(l,_a),E=_e(c,_a),D=_e(E,Gi),M=_e(D,Gi);yt(l,e.domain,a),_e(l,zi,C),_e(l,Ur,b),yt(c,e.domain,a),_e(c,zi,C),_e(c,Ur,b),yt(P,e.domain,S),_e(P,Gi,S),_e(P,Nf,S),yt(M,e.domain,S),yt(M,t,S),_e(M,Gi,S);const R=[[Df,Rf],[D1,R1],[O1,N1],[F1,B1],[$1,V1],[z1,G1],[H1,W1],[U1,q1]];for(let F=0;F<R.length;F++){const[_,L]=R[F],O=_e(S,_);_e(j,_,O),_e(O,L,S);const B=Gr(Um);yt(O,t,B);const z=Gr();yt(O,n),yt(B,t,B),yt(B,n,z),yt(z,t,B),yt(z,n,z),_e(B,L,S),_e(z,L,S)}return _e(i,pp,x),_e(i,e4,sIe),{start:i,tokens:PH}}function iIe(e,t,n){let s=n.length,i=0,o=[],a=[];for(;i<s;){let l=e,c=null,d=null,h=0,f=null,p=-1;for(;i<s&&!(c=l.go(n[i].t));)a.push(n[i++]);for(;i<s&&(d=c||l.go(n[i].t));)c=null,l=d,l.accepts()?(p=0,f=l):p>=0&&p++,i++,h++;if(p<0)i-=h,i<s&&(a.push(n[i]),i++);else{a.length>0&&(o.push(s2(d8,t,a)),a=[]),i-=p,h-=p;const g=f.t,m=n.slice(i-h,i);o.push(s2(g,t,m))}}return a.length>0&&o.push(s2(d8,t,a)),o}function s2(e,t,n){const s=n[0].s,i=n[n.length-1].e,o=t.slice(s,i);return new e(o,n)}const vs={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function oIe(){vs.scanner=tIe(vs.customSchemes);for(let e=0;e<vs.tokenQueue.length;e++)vs.tokenQueue[e][1]({scanner:vs.scanner});vs.parser=rIe(vs.scanner.tokens);for(let e=0;e<vs.pluginQueue.length;e++)vs.pluginQueue[e][1]({scanner:vs.scanner,parser:vs.parser});return vs.initialized=!0,vs}function OH(e){return vs.initialized||oIe(),iIe(vs.parser.start,e,LH(vs.scanner.start,e))}OH.scan=LH;function aIe(e,t,n){const s=OH(e),i=[];for(let o=0;o<s.length;o++){const a=s[o];if(a.t==="nl"&&t.get("nl2br")){const l=`__linkify-el-${n.elementId++}`;i.push(u.createElement("br",{key:l}))}else if(!a.isLink||!t.check(a))i.push(a.toString());else{let l=t.render(a);if(!("key"in l.props)){const c=`__linkify-el-${n.elementId++}`,d=DH.assign({key:c},l.props);l=u.cloneElement(l,d)}i.push(l)}}return i}function NH(e,t,n){if(u.Children.count(e.props.children)===0)return e;const s=[];u.Children.forEach(e.props.children,a=>{typeof a=="string"?s.push.apply(s,aIe(a,t,n)):u.isValidElement(a)?typeof a.type=="string"&&t.ignoreTags.indexOf(a.type.toUpperCase())>=0?s.push(a):s.push(NH(a,t,n)):s.push(a)});const i=`__linkify-el-${n.elementId++}`,o=DH.assign({key:i},e.props);return u.cloneElement(e,o,s)}const zg=e=>{let t=0;const n=({tagName:c,attributes:d,content:h})=>(d.key=`__linkify-lnk-${t++}`,d.class&&(d.className=d.class,delete d.class),u.createElement(c,d,h)),s={key:"__linkify-wrapper"};for(const c in e)c!=="options"&&c!=="as"&&c!=="tagName"&&c!=="children"&&(s[c]=e[c]);const i=new ex(e.options,n),o=e.as||e.tagName||u.Fragment||"span",a=e.children,l=u.createElement(o,s,a);return NH(l,i,{elementId:0})},lIe={fontWeight:"bold",fontSize:"2xl",whiteSpace:"pre-wrap",'&[data-is-empty="true"]':{opacity:.3},...$g},o4=u.memo(({content:e,...t})=>{const{t:n}=A();return r.jsx(q,{sx:lIe,"data-is-empty":e==="",...t,children:r.jsx(zg,{options:Vg,children:e||n("workflows.builder.headingPlaceholder")})})});o4.displayName="HeadingElementContent";const FH=u.memo(({el:e})=>{const{t}=A(),n=G(),{id:s,data:i}=e,{content:o}=i,a=u.useRef(null),l=u.useCallback(d=>{n(Lte({id:s,changes:{content:d}}))},[n,s]),c=aa({value:o,defaultValue:"",onChange:l,inputRef:a});return c.isEditing?r.jsx(Q_,{ref:a,placeholder:t("workflows.builder.headingPlaceholder"),...c.inputProps,variant:"outline",overflowWrap:"anywhere",w:"full",minRows:1,maxRows:10,resize:"none",p:1,px:2,fontWeight:"bold",fontSize:"2xl",_focusVisible:{borderRadius:"base",h:"unset"}}):r.jsx(o4,{content:c.value,onDoubleClick:c.startEditing})});FH.displayName="HeadingElementContentEditable";const cIe={position:"relative",borderRadius:"base",minW:32,'&[data-parent-layout="column"]':{w:"full",h:"min-content"},'&[data-parent-layout="row"]':{flex:"1 0 0"},flexDir:"column"},BH=u.memo(({el:e})=>{const t=u.useRef(null),n=u.useRef(null),[s,i]=Rg(e.id,t,n),o=Oi(),{id:a}=e;return r.jsxs(T,{ref:t,id:a,className:aL,sx:cIe,"data-parent-layout":o.layout,children:[r.jsx(Gd,{dragHandleRef:n,element:e,"data-is-dragging":i}),r.jsx(Vd,{"data-is-dragging":i,p:4,children:r.jsx(FH,{el:e})}),r.jsx(Og,{activeDropRegion:s,gap:"var(--invoke-space-4)"})]})});BH.displayName="HeadingElementEditMode";const uIe={'&[data-parent-layout="column"]':{w:"full",h:"min-content"},'&[data-parent-layout="row"]':{flex:"1 1 0",minW:32}},$H=u.memo(({el:e})=>{const{id:t,data:n}=e,{content:s}=n,i=Oi();return r.jsx(T,{id:t,className:aL,sx:uIe,"data-parent-layout":i.layout,children:r.jsx(o4,{content:s})})});$H.displayName="HeadingElementViewMode";const VH=u.memo(({id:e})=>{const t=Hd(e),n=I(Co);return!t||!lL(t)?null:n==="view"?r.jsx($H,{el:t}):r.jsx(BH,{el:t})});VH.displayName="HeadingElement";const Aw=u.memo(e=>{const{nodeId:t,field:n,fieldTemplate:s,settings:i}=e,{defaultValue:o,onChange:a,min:l,max:c,step:d,fineStep:h}=Ng(t,n.name,s,i);return r.jsx(Ie,{defaultValue:o,onChange:a,value:n.value,min:l,max:c,step:d,fineStep:h,className:Ve,flex:"1 1 0"})});Aw.displayName="FloatFieldInput ";const zH=u.memo(e=>{const{nodeId:t,field:n,fieldTemplate:s,settings:i}=e,{defaultValue:o,onChange:a,min:l,max:c,step:d,fineStep:h}=Ng(t,n.name,s,i);return r.jsxs(r.Fragment,{children:[r.jsx(Ze,{defaultValue:o,onChange:a,value:n.value,min:l,max:c,step:d,fineStep:h,className:Ve,marks:!0,withThumbTooltip:!0,flex:"1 1 0"}),r.jsx(Ie,{defaultValue:o,onChange:a,value:n.value,min:l,max:c,step:d,fineStep:h,className:Ve,flex:"1 1 0"})]})});zH.displayName="FloatFieldInputAndSlider ";const GH=u.memo(e=>{const{nodeId:t,field:n,fieldTemplate:s,settings:i}=e,{defaultValue:o,onChange:a,min:l,max:c,step:d,fineStep:h}=Ng(t,n.name,s,i);return r.jsx(Ze,{defaultValue:o,onChange:a,value:n.value,min:l,max:c,step:d,fineStep:h,className:Ve,marks:!0,withThumbTooltip:!0,flex:"1 1 0"})});GH.displayName="FloatFieldSlider ";const HH=(e,t=300)=>{const n=dn(),[s,i]=u.useState(()=>e(n.getState()));return u.useEffect(()=>{let o=e(n.getState()),a=null;const l=n.subscribe(()=>{const c=e(n.getState());c!==o&&(a!==null&&window.clearTimeout(a),a=window.setTimeout(()=>{i(c),o=c},t))});return()=>{l(),a!==null&&window.clearTimeout(a)}},[t,e,n]),s},Gg=(e,t)=>{const n=ae(sn),s=u.useMemo(()=>fe(Qe,o=>{const a=ld(o,e);if(!a)return!1;const l=HS(o,e,t),c=n[a.data.type];we(c,`Template for input node type ${a.data.type} not found.`);const d=c.inputs[t];return we(d,`Template for input field ${t} not found.`),cj(a,c,l,d,o).length>0}),[e,t,n]);return HH(s)},dIe=li({}).options,hIe={borderWidth:1,"&[data-error=true]":{borderColor:"error.500",borderStyle:"solid"}},WH=u.memo(e=>{const{nodeId:t,field:n,fieldTemplate:s}=e,i=dn(),{t:o}=A(),a=Gg(t,n.name),l=u.useCallback(y=>{i.dispatch(Dte({nodeId:t,fieldName:n.name,value:y}))},[n.name,t,i]),c=u.useCallback(y=>{const b=n.value?[...n.value]:[];b.splice(y,1),l(b)},[n.value,l]),d=u.useCallback((y,b)=>{const C=n.value?[...n.value]:[];C[y]=b,l(C)},[n.value,l]),h=u.useCallback(()=>{const y=n.value?[...n.value,0]:[0];l(y)},[n.value,l]),f=u.useMemo(()=>{let y=-4294967295;return qe(s.minimum)||(y=s.minimum),qe(s.exclusiveMinimum)||(y=s.exclusiveMinimum+.01),y},[s.exclusiveMinimum,s.minimum]),p=u.useMemo(()=>{let y=cd;return qe(s.maximum)||(y=s.maximum),qe(s.exclusiveMaximum)||(y=s.exclusiveMaximum-.01),y},[s.exclusiveMaximum,s.maximum]),g=u.useMemo(()=>qe(s.multipleOf)?.1:s.multipleOf,[s.multipleOf]),m=u.useMemo(()=>qe(s.multipleOf)?.01:s.multipleOf,[s.multipleOf]);return r.jsxs(T,{className:Ve,position:"relative",w:"full",h:"auto",maxH:64,alignItems:"stretch",justifyContent:"center",p:1,sx:hIe,"data-error":a,borderRadius:"base",flexDir:"column",gap:1,children:[r.jsx(de,{onClick:h,variant:"ghost",children:o("nodes.addItem")}),n.value&&n.value.length>0&&r.jsxs(r.Fragment,{children:[r.jsx(wt,{}),r.jsx(ps,{className:rt,defer:!0,style:jo,options:dIe,children:r.jsx(Ar,{gap:1,gridTemplateColumns:"auto 1fr auto",alignItems:"center",children:n.value.map((y,b)=>r.jsx(UH,{value:y,index:b,min:f,max:p,step:g,fineStep:m,onRemoveNumber:c,onChangeNumber:d},b))})})]})]})});WH.displayName="FloatFieldCollectionInputComponent";const UH=u.memo(({value:e,index:t,min:n,max:s,step:i,fineStep:o,onRemoveNumber:a,onChangeNumber:l})=>{const{t:c}=A(),d=u.useCallback(()=>{a(t)},[t,a]),h=u.useCallback(f=>{l(t,f)},[t,l]);return r.jsxs(r.Fragment,{children:[r.jsx(xt,{children:r.jsxs(J,{ps:1,m:0,children:[t+1,"."]})}),r.jsx(xt,{children:r.jsx(Ie,{onChange:h,value:e,min:n,max:s,step:i,fineStep:o,className:Ve,flexGrow:1})}),r.jsx(xt,{children:r.jsx(oe,{tabIndex:-1,size:"sm",variant:"link",alignSelf:"stretch",onClick:d,icon:r.jsx(Ot,{}),"aria-label":c("common.delete")})})]})});UH.displayName="FloatListItemContent";const qH=u.memo(({state:e,onChange:t})=>{const{t:n}=A(),s=u.useCallback(a=>{t({...e,start:a})},[t,e]),i=u.useCallback(a=>{t({...e,step:a})},[t,e]),o=u.useCallback(a=>{t({...e,count:a})},[t,e]);return r.jsxs(T,{gap:2,alignItems:"flex-end",children:[r.jsxs(K,{orientation:"vertical",children:[r.jsx(J,{children:n("common.start")}),r.jsx(Ie,{value:e.start,onChange:s,min:-1/0,max:1/0,step:.01})]}),r.jsxs(K,{orientation:"vertical",children:[r.jsx(J,{children:n("common.step")}),r.jsx(Ie,{value:e.step,onChange:i,min:-1/0,max:1/0,step:.01})]}),r.jsxs(K,{orientation:"vertical",children:[r.jsx(J,{children:n("common.count")}),r.jsx(Ie,{value:e.count,onChange:o,min:1,max:1/0})]})]})});qH.displayName="FloatGeneratorArithmeticSequenceSettings";const KH=u.memo(({state:e,onChange:t})=>{const{t:n}=A(),s=u.useCallback(a=>{t({...e,start:a})},[t,e]),i=u.useCallback(a=>{t({...e,end:a})},[t,e]),o=u.useCallback(a=>{t({...e,count:a})},[t,e]);return r.jsxs(T,{gap:2,alignItems:"flex-end",children:[r.jsxs(K,{orientation:"vertical",children:[r.jsx(J,{children:n("common.start")}),r.jsx(Ie,{value:e.start,onChange:s,min:-1/0,max:1/0,step:.01})]}),r.jsxs(K,{orientation:"vertical",children:[r.jsx(J,{children:n("common.end")}),r.jsx(Ie,{value:e.end,onChange:i,min:-1/0,max:1/0,step:.01})]}),r.jsxs(K,{orientation:"vertical",children:[r.jsx(J,{children:n("common.count")}),r.jsx(Ie,{value:e.count,onChange:o,min:1,max:1/0})]})]})});KH.displayName="FloatGeneratorLinearDistributionSettings";const fIe=1024*128,Wd=u.memo(({value:e,onChange:t})=>{const{t:n}=A(),s=u.useCallback(l=>{const c=l[0];if(!c)return;const d=new FileReader;d.onload=()=>{const h=d.result;zf(h)&&t(h)},d.onerror=()=>{ge({title:"Failed to load file",status:"error"})},d.readAsText(c)},[t]),{getInputProps:i,getRootProps:o}=sa({accept:{"text/csv":[".csv"],"text/plain":[".txt"]},maxSize:fIe,onDropAccepted:s,noDrag:!0,multiple:!1}),a=u.useCallback(l=>{t(l.target.value)},[t]);return r.jsxs(K,{orientation:"vertical",position:"relative",alignItems:"stretch",children:[r.jsxs(J,{m:0,display:"flex",alignItems:"center",children:[n("common.input"),r.jsx(it,{}),r.jsx(oe,{tooltip:n("nodes.generatorLoadFromFile"),"aria-label":n("nodes.generatorLoadFromFile"),icon:r.jsx(bhe,{}),variant:"link",...o()}),r.jsx("input",{...i()})]}),r.jsx(ss,{className:`${Ve} ${si} ${rt}`,value:e,onChange:a,p:2,resize:"none",rows:5,fontSize:"sm"})]})});Wd.displayName="GeneratorTextareaWithFileUpload";const ZH=u.memo(({state:e,onChange:t})=>{const{t:n}=A(),s=u.useCallback(o=>{t({...e,splitOn:o.target.value})},[t,e]),i=u.useCallback(o=>{t({...e,input:o})},[t,e]);return r.jsxs(T,{gap:2,flexDir:"column",children:[r.jsxs(K,{orientation:"vertical",children:[r.jsx(J,{children:n("nodes.splitOn")}),r.jsx(kt,{value:e.splitOn,onChange:s})]}),r.jsx(Wd,{value:e.input,onChange:i})]})});ZH.displayName="FloatGeneratorParseStringSettings";const YH=u.memo(({state:e,onChange:t})=>{const{t:n}=A(),s=u.useCallback(c=>{t({...e,min:c})},[t,e]),i=u.useCallback(c=>{t({...e,max:c})},[t,e]),o=u.useCallback(c=>{t({...e,count:c})},[t,e]),a=u.useCallback(()=>{t({...e,seed:qe(e.seed)?0:null})},[t,e]),l=u.useCallback(c=>{t({...e,seed:c})},[t,e]);return r.jsx(T,{gap:2,flexDir:"column",children:r.jsxs(T,{gap:2,alignItems:"flex-end",children:[r.jsxs(K,{orientation:"vertical",children:[r.jsx(J,{children:n("common.min")}),r.jsx(Ie,{value:e.min,onChange:s,min:-1/0,max:1/0,step:.01})]}),r.jsxs(K,{orientation:"vertical",children:[r.jsx(J,{children:n("common.max")}),r.jsx(Ie,{value:e.max,onChange:i,min:-1/0,max:1/0,step:.01})]}),r.jsxs(K,{orientation:"vertical",children:[r.jsx(J,{children:n("common.count")}),r.jsx(Ie,{value:e.count,onChange:o,min:1,max:1/0})]}),r.jsxs(K,{orientation:"vertical",children:[r.jsxs(J,{alignItems:"center",justifyContent:"space-between",m:0,display:"flex",w:"full",children:[n("common.seed"),r.jsx(Sn,{onChange:a,isChecked:!qe(e.seed)})]}),r.jsx(Ie,{isDisabled:qe(e.seed),value:e.seed??"...",onChange:l,min:-1/0,max:1/0})]})]})})});YH.displayName="FloatGeneratorUniformRandomDistributionSettings";const pIe=li({}).options,XH=u.memo(e=>{const{nodeId:t,field:n}=e,{t:s}=A(),i=G(),o=u.useCallback(d=>{i(wI({nodeId:t,fieldName:n.name,value:d}))},[i,n.name,t]),a=u.useCallback(d=>{const h=Rte(d.target.value);h&&i(wI({nodeId:t,fieldName:n.name,value:h}))},[i,n.name,t]),[l]=vc(n,300),c=u.useMemo(()=>{if(l.value.type===Ex&&qe(l.value.seed)){const{count:h}=l.value;return`<${s("nodes.generatorNRandomValues",{count:h})}>`}const d=K3(l);return d.length===0?`<${s("nodes.generatorNoValues")}>`:d.map(h=>Ap(h,2)).join(", ")},[l,s]);return r.jsxs(T,{flexDir:"column",gap:2,flexGrow:1,children:[r.jsxs(_i,{className:`${rt} ${Ve}`,onChange:a,value:n.value.type,size:"sm",children:[r.jsx("option",{value:SI,children:s("nodes.arithmeticSequence")}),r.jsx("option",{value:jI,children:s("nodes.linearDistribution")}),r.jsx("option",{value:Ex,children:s("nodes.uniformRandomDistribution")}),r.jsx("option",{value:kI,children:s("nodes.parseString")})]}),n.value.type===SI&&r.jsx(qH,{state:n.value,onChange:o}),n.value.type===jI&&r.jsx(KH,{state:n.value,onChange:o}),n.value.type===Ex&&r.jsx(YH,{state:n.value,onChange:o}),n.value.type===kI&&r.jsx(ZH,{state:n.value,onChange:o}),r.jsx(T,{w:"full",h:"full",p:2,borderWidth:1,borderRadius:"base",maxH:128,children:r.jsx(T,{w:"full",h:"auto",children:r.jsx(ps,{className:`${rt} ${Ve}`,defer:!0,style:jo,options:pIe,children:r.jsx(q,{className:`${rt} ${Ve}`,fontFamily:"monospace",userSelect:"text",cursor:"text",children:c})})})})]})});XH.displayName="FloatGeneratorFieldInputComponent";const gIe=li({}).options,mIe={borderWidth:1,"&[data-error=true]":{borderColor:"error.500",borderStyle:"solid"}},QH=u.memo(e=>{const{t}=A(),{nodeId:n,field:s}=e,i=dn(),o=Gg(n,s.name),a=u.useMemo(()=>nw.getData({fieldIdentifier:{nodeId:n,fieldName:s.name}}),[s,n]),l=u.useCallback(d=>{i.dispatch(D2({nodeId:n,fieldName:s.name,value:d}))},[i,n,s.name]),c=u.useCallback(d=>{const h=s.value?[...s.value]:[];h.splice(d,1),i.dispatch(D2({nodeId:n,fieldName:s.name,value:h}))},[s.name,s.value,n,i]);return r.jsxs(T,{className:Ve,position:"relative",w:"full",h:"full",minH:16,maxH:64,alignItems:"stretch",justifyContent:"center",children:[(!s.value||s.value.length===0)&&r.jsx(Uje,{w:"full",h:"auto",isError:o,onUpload:l,fontSize:24}),s.value&&s.value.length>0&&r.jsx(Se,{w:"full",h:"auto",p:1,sx:mIe,"data-error":o,borderRadius:"base",children:r.jsx(ps,{className:rt,defer:!0,style:jo,options:gIe,children:r.jsx(Ar,{w:"full",h:"full",templateColumns:"repeat(4, 1fr)",gap:1,children:s.value.map((d,h)=>r.jsx(xt,{position:"relative",className:Ve,children:r.jsx(JH,{value:d,index:h,onRemoveImage:c})},h))})})}),r.jsx(Is,{dndTarget:nw,dndTargetData:a,label:t("gallery.drop")})]})});QH.displayName="ImageFieldCollectionInputComponent";const JH=u.memo(({value:e,index:t,onRemoveImage:n})=>{const s=nl(e.image_name),i=u.useCallback(()=>{n(t)},[t,n]);return s.isLoading?r.jsx(xb,{}):s.data?r.jsxs(r.Fragment,{children:[r.jsx(ul,{imageDTO:s.data,asThumbnail:!0,objectFit:"contain",w:"full",h:"full",aspectRatio:"1/1",backgroundSize:8,backgroundImage:Md}),r.jsx(ea,{onClick:i,icon:r.jsx(Ot,{}),tooltip:"Remove Image from Collection",position:"absolute",flexDir:"column",top:1,insetInlineEnd:1,gap:1})]}):r.jsxs(r.Fragment,{children:[r.jsx(Pt,{icon:WR}),r.jsx(ea,{onClick:i,icon:r.jsx(Ot,{}),tooltip:"Remove Image from Collection",position:"absolute",flexDir:"column",top:1,insetInlineEnd:1,gap:1})]})});JH.displayName="ImageGridItemContent";const eW=u.memo(({state:e,onChange:t})=>{const{t:n}=A(),s=u.useCallback(o=>{t({...e,category:o})},[t,e]),i=u.useCallback(o=>{t({...e,board_id:o})},[t,e]);return r.jsxs(T,{gap:2,flexDir:"column",children:[r.jsxs(K,{orientation:"vertical",children:[r.jsx(J,{children:n("common.board")}),r.jsx(bIe,{board_id:e.board_id,onChange:i})]}),r.jsxs(K,{orientation:"vertical",children:[r.jsx(J,{children:n("nodes.generatorImagesCategory")}),r.jsx(xIe,{category:e.category,onChange:s})]})]})});eW.displayName="ImageGeneratorImagesFromBoardSettings";const yIe={include_archived:!1},bIe=({board_id:e,onChange:t})=>{const{t:n}=A(),s=ic(yIe),i=u.useMemo(()=>s.data?s.data.map(c=>({label:c.board_name,value:c.board_id})):Ls,[s.data]),o=u.useCallback(c=>{c&&t(c.value)},[t]),a=u.useMemo(()=>i.find(c=>c.value===e)??null,[e,i]),l=u.useCallback(()=>n("boards.noMatching"),[n]);return r.jsx(Ne,{className:`${rt} ${Ve}`,value:a,options:i,onChange:o,placeholder:n("boards.selectBoard"),noOptionsMessage:l})},xIe=({category:e,onChange:t})=>{const{t:n}=A(),s=u.useMemo(()=>[{label:n("gallery.images"),value:"images"},{label:n("gallery.assets"),value:"assets"}],[n]),i=u.useCallback(l=>{!l||l.value!=="images"&&l.value!=="assets"||t(l.value)},[t]),o=u.useMemo(()=>s.find(l=>l.value===e),[s,e]),a=u.useCallback(()=>n("boards.noMatching"),[n]);return r.jsx(Ne,{className:`${rt} ${Ve}`,value:o,options:s,onChange:i,placeholder:n("boards.selectBoard"),noOptionsMessage:a})},vIe=li({}).options,tW=u.memo(e=>{const{nodeId:t,field:n}=e,{t:s}=A(),i=G(),o=u.useCallback(h=>{i(_I({nodeId:t,fieldName:n.name,value:h}))},[i,n.name,t]),a=u.useCallback(h=>{const f=Ote(h.target.value);i(_I({nodeId:t,fieldName:n.name,value:f}))},[i,n.name,t]),[l,c]=u.useState(null),d=u.useMemo(()=>ii(async h=>{const f=await H3(h,i);f.length===0?c(`<${s("nodes.generatorNoValues")}>`):c(`<${s("nodes.generatorImages",{count:f.length})}>`)},300),[i,s]);return u.useEffect(()=>{d(n)},[n,d]),r.jsxs(T,{flexDir:"column",gap:2,flexGrow:1,children:[r.jsx(_i,{className:`${rt} ${Ve}`,onChange:a,value:n.value.type,size:"sm",children:r.jsx("option",{value:II,children:s("nodes.generatorImagesFromBoard")})}),n.value.type===II&&r.jsx(eW,{state:n.value,onChange:o}),r.jsx(T,{w:"full",h:"full",p:2,borderWidth:1,borderRadius:"base",maxH:128,children:r.jsx(T,{w:"full",h:"auto",children:r.jsx(ps,{className:`${rt} ${Ve}`,defer:!0,style:jo,options:vIe,children:r.jsx(q,{className:`${rt} ${Ve}`,fontFamily:"monospace",userSelect:"text",cursor:"text",children:l})})})})]})});tW.displayName="ImageGeneratorFieldInputComponent";const CIe=li({}).options,wIe={borderWidth:1,"&[data-error=true]":{borderColor:"error.500",borderStyle:"solid"}},nW=u.memo(e=>{const{nodeId:t,field:n,fieldTemplate:s}=e,i=dn(),{t:o}=A(),a=Gg(t,n.name),l=u.useCallback(y=>{i.dispatch(Nte({nodeId:t,fieldName:n.name,value:y}))},[n.name,t,i]),c=u.useCallback(y=>{const b=n.value?[...n.value]:[];b.splice(y,1),l(b)},[n.value,l]),d=u.useCallback((y,b)=>{const C=n.value?[...n.value]:[];C[y]=b,l(C)},[n.value,l]),h=u.useCallback(()=>{const y=n.value?[...n.value,0]:[0];l(y)},[n.value,l]),f=u.useMemo(()=>{let y=-4294967295;return qe(s.minimum)||(y=s.minimum),qe(s.exclusiveMinimum)||(y=s.exclusiveMinimum+.01),y},[s.exclusiveMinimum,s.minimum]),p=u.useMemo(()=>{let y=cd;return qe(s.maximum)||(y=s.maximum),qe(s.exclusiveMaximum)||(y=s.exclusiveMaximum-.01),y},[s.exclusiveMaximum,s.maximum]),g=u.useMemo(()=>qe(s.multipleOf)?1:s.multipleOf,[s.multipleOf]),m=u.useMemo(()=>qe(s.multipleOf)?1:s.multipleOf,[s.multipleOf]);return r.jsxs(T,{className:Ve,position:"relative",w:"full",h:"auto",maxH:64,alignItems:"stretch",justifyContent:"center",p:1,sx:wIe,"data-error":a,borderRadius:"base",flexDir:"column",gap:1,children:[r.jsx(de,{onClick:h,variant:"ghost",children:o("nodes.addItem")}),n.value&&n.value.length>0&&r.jsxs(r.Fragment,{children:[r.jsx(wt,{}),r.jsx(ps,{className:rt,defer:!0,style:jo,options:CIe,children:r.jsx(Ar,{gap:1,gridTemplateColumns:"auto 1fr auto",alignItems:"center",children:n.value.map((y,b)=>r.jsx(sW,{value:y,index:b,min:f,max:p,step:g,fineStep:m,onRemoveNumber:c,onChangeNumber:d},b))})})]})]})});nW.displayName="IntegerFieldCollectionInputComponent";const sW=u.memo(({value:e,index:t,min:n,max:s,step:i,fineStep:o,onRemoveNumber:a,onChangeNumber:l})=>{const{t:c}=A(),d=u.useCallback(()=>{a(t)},[t,a]),h=u.useCallback(f=>{l(t,Math.floor(f))},[t,l]);return r.jsxs(r.Fragment,{children:[r.jsx(xt,{children:r.jsxs(J,{ps:1,m:0,children:[t+1,"."]})}),r.jsx(xt,{children:r.jsx(Ie,{onChange:h,value:e,min:n,max:s,step:i,fineStep:o,className:Ve,flexGrow:1})}),r.jsx(xt,{children:r.jsx(oe,{tabIndex:-1,size:"sm",variant:"link",alignSelf:"stretch",onClick:d,icon:r.jsx(Ot,{}),"aria-label":c("common.delete")})})]})});sW.displayName="IntegerListItemContent";const rW=u.memo(({state:e,onChange:t})=>{const{t:n}=A(),s=u.useCallback(a=>{t({...e,start:a})},[t,e]),i=u.useCallback(a=>{t({...e,step:a})},[t,e]),o=u.useCallback(a=>{t({...e,count:a})},[t,e]);return r.jsxs(T,{gap:2,alignItems:"flex-end",children:[r.jsxs(K,{orientation:"vertical",children:[r.jsx(J,{children:n("common.start")}),r.jsx(Ie,{value:e.start,onChange:s,min:-1/0,max:1/0})]}),r.jsxs(K,{orientation:"vertical",children:[r.jsx(J,{children:n("common.step")}),r.jsx(Ie,{value:e.step,onChange:i,min:-1/0,max:1/0})]}),r.jsxs(K,{orientation:"vertical",children:[r.jsx(J,{children:n("common.count")}),r.jsx(Ie,{value:e.count,onChange:o,min:1,max:1/0})]})]})});rW.displayName="IntegerGeneratorArithmeticSequenceSettings";const iW=u.memo(({state:e,onChange:t})=>{const{t:n}=A(),s=u.useCallback(a=>{t({...e,start:a})},[t,e]),i=u.useCallback(a=>{t({...e,end:a})},[t,e]),o=u.useCallback(a=>{t({...e,count:a})},[t,e]);return r.jsxs(T,{gap:2,alignItems:"flex-end",children:[r.jsxs(K,{orientation:"vertical",children:[r.jsx(J,{children:n("common.start")}),r.jsx(Ie,{value:e.start,onChange:s,min:-1/0,max:1/0})]}),r.jsxs(K,{orientation:"vertical",children:[r.jsx(J,{children:n("common.end")}),r.jsx(Ie,{value:e.end,onChange:i,min:-1/0,max:1/0})]}),r.jsxs(K,{orientation:"vertical",children:[r.jsx(J,{children:n("common.count")}),r.jsx(Ie,{value:e.count,onChange:o,min:1,max:1/0})]})]})});iW.displayName="IntegerGeneratorLinearDistributionSettings";const oW=u.memo(({state:e,onChange:t})=>{const{t:n}=A(),s=u.useCallback(o=>{t({...e,splitOn:o.target.value})},[t,e]),i=u.useCallback(o=>{t({...e,input:o})},[t,e]);return r.jsxs(T,{gap:2,flexDir:"column",children:[r.jsxs(K,{orientation:"vertical",children:[r.jsx(J,{children:n("nodes.splitOn")}),r.jsx(kt,{value:e.splitOn,onChange:s})]}),r.jsx(Wd,{value:e.input,onChange:i})]})});oW.displayName="IntegerGeneratorParseStringSettings";const aW=u.memo(({state:e,onChange:t})=>{const{t:n}=A(),s=u.useCallback(c=>{t({...e,min:c})},[t,e]),i=u.useCallback(c=>{t({...e,max:c})},[t,e]),o=u.useCallback(c=>{t({...e,count:c})},[t,e]),a=u.useCallback(()=>{t({...e,seed:qe(e.seed)?0:null})},[t,e]),l=u.useCallback(c=>{t({...e,seed:c})},[t,e]);return r.jsx(T,{gap:2,flexDir:"column",children:r.jsxs(T,{gap:2,alignItems:"flex-end",children:[r.jsxs(K,{orientation:"vertical",children:[r.jsx(J,{children:n("common.min")}),r.jsx(Ie,{value:e.min,onChange:s,min:-1/0,max:1/0})]}),r.jsxs(K,{orientation:"vertical",children:[r.jsx(J,{children:n("common.max")}),r.jsx(Ie,{value:e.max,onChange:i,min:-1/0,max:1/0})]}),r.jsxs(K,{orientation:"vertical",children:[r.jsx(J,{children:n("common.count")}),r.jsx(Ie,{value:e.count,onChange:o,min:1,max:1/0})]}),r.jsxs(K,{orientation:"vertical",children:[r.jsxs(J,{alignItems:"center",justifyContent:"space-between",m:0,display:"flex",w:"full",children:[n("common.seed"),r.jsx(Sn,{onChange:a,isChecked:!qe(e.seed)})]}),r.jsx(Ie,{isDisabled:qe(e.seed),value:e.seed??"...",onChange:l,min:-1/0,max:1/0})]})]})})});aW.displayName="IntegerGeneratorUniformRandomDistributionSettings";const SIe=li({}).options,lW=u.memo(e=>{const{nodeId:t,field:n}=e,{t:s}=A(),i=G(),o=u.useCallback(d=>{i(TI({nodeId:t,fieldName:n.name,value:d}))},[i,n.name,t]),a=u.useCallback(d=>{const h=Fte(d.target.value);i(TI({nodeId:t,fieldName:n.name,value:h}))},[i,n.name,t]),[l]=vc(n,300),c=u.useMemo(()=>{if(l.value.type===Mx&&qe(l.value.seed)){const{count:h}=l.value;return`<${s("nodes.generatorNRandomValues",{count:h})}>`}const d=Y3(l);return d.length===0?`<${s("nodes.generatorNoValues")}>`:d.map(h=>Ap(h,2)).join(", ")},[l,s]);return r.jsxs(T,{flexDir:"column",gap:2,flexGrow:1,children:[r.jsxs(_i,{className:`${rt} ${Ve}`,onChange:a,value:n.value.type,size:"sm",children:[r.jsx("option",{value:AI,children:s("nodes.arithmeticSequence")}),r.jsx("option",{value:EI,children:s("nodes.linearDistribution")}),r.jsx("option",{value:Mx,children:s("nodes.uniformRandomDistribution")}),r.jsx("option",{value:MI,children:s("nodes.parseString")})]}),n.value.type===AI&&r.jsx(rW,{state:n.value,onChange:o}),n.value.type===EI&&r.jsx(iW,{state:n.value,onChange:o}),n.value.type===Mx&&r.jsx(aW,{state:n.value,onChange:o}),n.value.type===MI&&r.jsx(oW,{state:n.value,onChange:o}),r.jsx(T,{w:"full",h:"full",p:2,borderWidth:1,borderRadius:"base",maxH:128,children:r.jsx(T,{w:"full",h:"auto",children:r.jsx(ps,{className:`${rt} ${Ve}`,defer:!0,style:jo,options:SIe,children:r.jsx(q,{className:`${rt} ${Ve}`,fontFamily:"monospace",userSelect:"text",cursor:"text",children:c})})})})]})});lW.displayName="IntegerGeneratorFieldInputComponent";const jIe=e=>{const{nodeId:t,field:n}=e,s=G(),{data:i,isLoading:o}=Ip(),a=u.useCallback(g=>{g&&s(Bte({nodeId:t,fieldName:n.name,value:g}))},[s,n.name,t]),l=u.useMemo(()=>i?Ya.selectAll(i):Ls,[i]),{options:c,value:d,onChange:h,placeholder:f,noOptionsMessage:p}=Zt({modelConfigs:l,onChange:a,isLoading:o,selectedModel:n.value,groupByType:!0});return r.jsx(T,{w:"full",alignItems:"center",gap:2,children:r.jsx(K,{className:`${rt} ${Ve}`,isDisabled:!c.length,isInvalid:!d,children:r.jsx(Ne,{value:d,placeholder:f,options:c,onChange:h,noOptionsMessage:p})})})},kIe=u.memo(jIe),_Ie=li({}).options,IIe={borderWidth:1,"&[data-error=true]":{borderColor:"error.500",borderStyle:"solid"}},cW=u.memo(e=>{const{nodeId:t,field:n}=e,{t:s}=A(),i=dn(),o=Gg(t,n.name),a=u.useCallback(d=>{const h=n.value?[...n.value]:[];h.splice(d,1),i.dispatch(Px({nodeId:t,fieldName:n.name,value:h}))},[n.name,n.value,t,i]),l=u.useCallback((d,h)=>{const f=n.value?[...n.value]:[];f[d]=h,i.dispatch(Px({nodeId:t,fieldName:n.name,value:f}))},[n.name,n.value,t,i]),c=u.useCallback(()=>{const d=n.value?[...n.value,""]:[""];i.dispatch(Px({nodeId:t,fieldName:n.name,value:d}))},[n.name,n.value,t,i]);return r.jsxs(T,{className:Ve,position:"relative",w:"full",h:"auto",maxH:64,alignItems:"stretch",justifyContent:"center",p:1,sx:IIe,"data-error":o,borderRadius:"base",flexDir:"column",gap:1,children:[r.jsx(de,{onClick:c,variant:"ghost",children:s("nodes.addItem")}),n.value&&n.value.length>0&&r.jsxs(r.Fragment,{children:[r.jsx(wt,{}),r.jsx(ps,{className:rt,defer:!0,style:jo,options:_Ie,children:r.jsx(Ar,{gap:1,gridTemplateColumns:"auto 1fr auto",alignItems:"center",children:n.value.map((d,h)=>r.jsx(uW,{value:d,index:h,onRemoveString:a,onChangeString:l},h))})})]})]})});cW.displayName="StringFieldCollectionInputComponent";const uW=u.memo(({value:e,index:t,onRemoveString:n,onChangeString:s})=>{const{t:i}=A(),o=u.useCallback(()=>{n(t)},[t,n]),a=u.useCallback(l=>{s(t,l.target.value)},[t,s]);return r.jsxs(r.Fragment,{children:[r.jsx(xt,{children:r.jsxs(q,{variant:"subtext",textAlign:"center",minW:8,children:[t+1,"."]})}),r.jsx(xt,{children:r.jsx(kt,{placeholder:i("workflows.emptyStringPlaceholder"),size:"sm",resize:"none",value:e,onChange:a})}),r.jsx(xt,{children:r.jsx(oe,{tabIndex:-1,size:"sm",variant:"link",minW:8,minH:8,onClick:o,icon:r.jsx(Ot,{}),"aria-label":i("common.delete")})})]})});uW.displayName="ListItemContent";const dW=u.memo(({state:e,onChange:t})=>{const{t:n}=A(),s=u.useCallback(o=>{t({...e,input:o})},[t,e]),i=u.useCallback(o=>{t({...e,maxPrompts:o})},[t,e]);return r.jsxs(T,{gap:2,flexDir:"column",children:[r.jsxs(K,{orientation:"vertical",children:[r.jsx(J,{children:n("dynamicPrompts.maxPrompts")}),r.jsx(Ie,{value:e.maxPrompts,onChange:i,min:1,max:1e3,w:"full"})]}),r.jsx(Wd,{value:e.input,onChange:s})]})});dW.displayName="StringGeneratorDynamicPromptsCombinatorialSettings";const hW=u.memo(({state:e,onChange:t})=>{const{t:n}=A(),s=u.useCallback(l=>{t({...e,input:l})},[t,e]),i=u.useCallback(l=>{t({...e,count:l})},[t,e]),o=u.useCallback(()=>{t({...e,seed:qe(e.seed)?0:null})},[t,e]),a=u.useCallback(l=>{t({...e,seed:l})},[t,e]);return r.jsxs(T,{gap:2,flexDir:"column",children:[r.jsxs(T,{gap:2,children:[r.jsxs(K,{orientation:"vertical",children:[r.jsxs(J,{alignItems:"center",justifyContent:"space-between",display:"flex",w:"full",pe:.5,children:[n("common.seed"),r.jsx(Sn,{onChange:o,isChecked:!qe(e.seed)})]}),r.jsx(Ie,{isDisabled:qe(e.seed),value:e.seed??"...",onChange:a,min:-1/0,max:1/0})]}),r.jsxs(K,{orientation:"vertical",children:[r.jsx(J,{children:n("common.count")}),r.jsx(Ie,{value:e.count,onChange:i,min:1,max:1e3})]})]}),r.jsx(Wd,{value:e.input,onChange:s})]})});hW.displayName="StringGeneratorDynamicPromptsRandomSettings";const fW=u.memo(({state:e,onChange:t})=>{const{t:n}=A(),s=u.useCallback(o=>{t({...e,splitOn:o.target.value})},[t,e]),i=u.useCallback(o=>{t({...e,input:o})},[t,e]);return r.jsxs(T,{gap:2,flexDir:"column",children:[r.jsxs(K,{orientation:"vertical",children:[r.jsx(J,{children:n("nodes.splitOn")}),r.jsx(kt,{value:e.splitOn,onChange:s})]}),r.jsx(Wd,{value:e.input,onChange:i})]})});fW.displayName="StringGeneratorParseStringSettings";const TIe=li({}).options,pW=u.memo(e=>{const{nodeId:t,field:n}=e,{t:s}=A(),i=G(),o=u.useCallback(h=>{i(PI({nodeId:t,fieldName:n.name,value:h}))},[i,n.name,t]),a=u.useCallback(h=>{const f=$te(h.target.value);i(PI({nodeId:t,fieldName:n.name,value:f}))},[i,n.name,t]),[l,c]=u.useState(null),d=u.useMemo(()=>ii(async h=>{const f=await U3(h,i);f.length===0?c(`<${s("nodes.generatorNoValues")}>`):c(f.join(", "))},300),[i,s]);return u.useEffect(()=>{d(n)},[n,d]),r.jsxs(T,{flexDir:"column",gap:2,flexGrow:1,children:[r.jsxs(_i,{className:`${rt} ${Ve}`,onChange:a,value:n.value.type,size:"sm",children:[r.jsx("option",{value:LI,children:s("nodes.parseString")}),r.jsx("option",{value:DI,children:s("nodes.dynamicPromptsRandom")}),r.jsx("option",{value:RI,children:s("nodes.dynamicPromptsCombinatorial")})]}),n.value.type===LI&&r.jsx(fW,{state:n.value,onChange:o}),n.value.type===DI&&r.jsx(hW,{state:n.value,onChange:o}),n.value.type===RI&&r.jsx(dW,{state:n.value,onChange:o}),r.jsx(T,{w:"full",h:"full",p:2,borderWidth:1,borderRadius:"base",maxH:128,children:r.jsx(T,{w:"full",h:"auto",children:r.jsx(ps,{className:`${rt} ${Ve}`,defer:!0,style:jo,options:TIe,children:r.jsx(q,{className:`${rt} ${Ve}`,fontFamily:"monospace",userSelect:"text",cursor:"text",whiteSpace:"pre",children:l})})})})]})});pW.displayName="StringGeneratorFieldInputComponent";const Ew=u.memo(e=>{const{nodeId:t,field:n,fieldTemplate:s,settings:i}=e,{defaultValue:o,onChange:a,min:l,max:c,step:d,fineStep:h,constrainValue:f}=Fg(t,n.name,s,i);return r.jsx(Ie,{defaultValue:o,onChange:a,value:n.value,min:l,max:c,step:d,fineStep:h,className:Ve,flex:"1 1 0",constrainValue:f})});Ew.displayName="IntegerFieldInput";const gW=u.memo(e=>{const{nodeId:t,field:n,fieldTemplate:s,settings:i}=e,{defaultValue:o,onChange:a,min:l,max:c,step:d,fineStep:h}=Fg(t,n.name,s,i);return r.jsxs(r.Fragment,{children:[r.jsx(Ze,{defaultValue:o,onChange:a,value:n.value,min:l,max:c,step:d,fineStep:h,className:Ve,marks:!0,withThumbTooltip:!0,flex:"1 1 0"}),r.jsx(Ie,{defaultValue:o,onChange:a,value:n.value,min:l,max:c,step:d,fineStep:h,className:Ve,flex:"1 1 0"})]})});gW.displayName="IntegerFieldInputAndSlider";const mW=u.memo(e=>{const{nodeId:t,field:n,fieldTemplate:s,settings:i}=e,{defaultValue:o,onChange:a,min:l,max:c,step:d,fineStep:h}=Fg(t,n.name,s,i);return r.jsx(Ze,{defaultValue:o,onChange:a,value:n.value,min:l,max:c,step:d,fineStep:h,className:Ve,marks:!0,withThumbTooltip:!0,flex:"1 1 0"})});mW.displayName="IntegerFieldSlider";const a4=e=>{const{nodeId:t,field:n,fieldTemplate:s}=e,i=G(),o=u.useCallback(a=>{i(Vte({nodeId:t,fieldName:n.name,value:a.target.value}))},[i,n.name,t]);return{value:n.value,onChange:o,defaultValue:s.default}},yW=u.memo(e=>{const{value:t,onChange:n}=a4(e);return r.jsx(_i,{onChange:n,className:`${Ve} ${si} ${rt}`,isDisabled:e.settings.options.length===0,value:t,children:e.settings.options.map((s,i)=>r.jsx("option",{value:s.value,children:s.label||s.value||`Option ${i+1}`},`${i}_${s.value}`))})});yW.displayName="StringFieldDropdown";const Mw=u.memo(e=>{const{value:t,onChange:n}=a4(e),{t:s}=A();return r.jsx(kt,{className:`${Ve} ${si} ${rt}`,placeholder:s("workflows.emptyStringPlaceholder"),value:t,onChange:n})});Mw.displayName="StringFieldInput";const Pw=u.memo(e=>{const{t}=A(),{value:n,onChange:s}=a4(e);return r.jsx(ss,{className:`${Ve} ${si} ${rt}`,placeholder:t("workflows.emptyStringPlaceholder"),value:n,onChange:s,h:"full",fontSize:"sm",p:2})});Pw.displayName="StringFieldTextarea";const AIe={include_archived:!0},EIe=e=>e==="auto"||e==="none"?e:{board_id:e},MIe=e=>{const{nodeId:t,field:n}=e,s=G(),{t:i}=A(),o=ic(AIe),a=u.useMemo(()=>({label:i("common.auto"),value:"auto"}),[i]),l=u.useMemo(()=>({label:`${i("common.none")} (${i("boards.uncategorized")})`,value:"none"}),[i]),c=u.useMemo(()=>{const p=[a,l];if(o.data)for(const g of o.data)p.push({label:g.board_name,value:g.board_id});return p},[a,o.data,l]),d=u.useCallback(p=>{if(!p)return;const g=EIe(p.value);s(zte({nodeId:t,fieldName:n.name,value:g}))},[s,n.name,t]),h=u.useMemo(()=>{const p=n.value;return!p||p==="auto"?a:p==="none"?l:c.find(m=>m.value===p.board_id)??a},[n.value,c,a,l]),f=u.useCallback(()=>i("boards.noMatching"),[i]);return r.jsx(Ne,{className:`${rt} ${Ve}`,value:h,options:c,onChange:d,placeholder:i("boards.selectBoard"),noOptionsMessage:f})},PIe=u.memo(MIe),LIe=e=>{const{nodeId:t,field:n}=e,s=G(),i=u.useCallback(o=>{s(Gte({nodeId:t,fieldName:n.name,value:o.target.checked}))},[s,n.name,t]);return r.jsx(et,{className:`${Ve} ${yc}`,onChange:i,isChecked:n.value})},DIe=u.memo(LIe),RIe=e=>{const{nodeId:t,field:n}=e,{t:s}=A(),i=I(y=>y.config.disabledTabs),o=G(),[a,{isLoading:l}]=xc(),c=u.useCallback(y=>{y&&o(Hte({nodeId:t,fieldName:n.name,value:y}))},[o,n.name,t]),{options:d,value:h,onChange:f,placeholder:p,noOptionsMessage:g}=Zt({modelConfigs:a,onChange:c,isLoading:l,selectedModel:n.value}),m=e.fieldTemplate.required;return r.jsx(T,{w:"full",alignItems:"center",gap:2,children:r.jsx(Ee,{label:!i.includes("models")&&s("modelManager.starterModelsInModelManager"),children:r.jsx(K,{className:`${rt} ${Ve}`,isDisabled:!d.length,isInvalid:!h&&m,children:r.jsx(Ne,{value:h,placeholder:m?p:`(Optional) ${p}`,options:d,onChange:f,noOptionsMessage:g})})})})},OIe=u.memo(RIe),NIe=e=>{const{nodeId:t,field:n}=e,{t:s}=A(),i=I(y=>y.config.disabledTabs),o=G(),[a,{isLoading:l}]=xc(),c=u.useCallback(y=>{y&&o(Wte({nodeId:t,fieldName:n.name,value:y}))},[o,n.name,t]),{options:d,value:h,onChange:f,placeholder:p,noOptionsMessage:g}=Zt({modelConfigs:a.filter(y=>cL(y)),onChange:c,isLoading:l,selectedModel:n.value}),m=e.fieldTemplate.required;return r.jsx(T,{w:"full",alignItems:"center",gap:2,children:r.jsx(Ee,{label:!i.includes("models")&&s("modelManager.starterModelsInModelManager"),children:r.jsx(K,{className:`${rt} ${Ve}`,isDisabled:!d.length,isInvalid:!h&&m,children:r.jsx(Ne,{value:h,placeholder:m?p:`(Optional) ${p}`,options:d,onChange:f,noOptionsMessage:g})})})})},FIe=u.memo(NIe),BIe=e=>{const{nodeId:t,field:n}=e,{t:s}=A(),i=I(y=>y.config.disabledTabs),o=G(),[a,{isLoading:l}]=xc(),c=u.useCallback(y=>{y&&o(Ute({nodeId:t,fieldName:n.name,value:y}))},[o,n.name,t]),{options:d,value:h,onChange:f,placeholder:p,noOptionsMessage:g}=Zt({modelConfigs:a.filter(y=>uL(y)),onChange:c,isLoading:l,selectedModel:n.value}),m=e.fieldTemplate.required;return r.jsx(T,{w:"full",alignItems:"center",gap:2,children:r.jsx(Ee,{label:!i.includes("models")&&s("modelManager.starterModelsInModelManager"),children:r.jsx(K,{className:`${rt} ${Ve}`,isDisabled:!d.length,isInvalid:!h&&m,children:r.jsx(Ne,{value:h,placeholder:m?p:`(Optional) ${p}`,options:d,onChange:f,noOptionsMessage:g})})})})},$Ie=u.memo(BIe),VIe=e=>{const{nodeId:t,field:n}=e,s=G(),[i,{isLoading:o}]=efe(),a=u.useCallback(p=>{p&&s(Kp({nodeId:t,fieldName:n.name,value:p}))},[s,n.name,t]),{options:l,value:c,onChange:d,placeholder:h,noOptionsMessage:f}=Zt({modelConfigs:i,onChange:a,isLoading:o,selectedModel:n.value});return r.jsx(T,{w:"full",alignItems:"center",gap:2,children:r.jsx(K,{className:`${rt} ${Ve}`,isDisabled:!l.length,isInvalid:!c&&e.fieldTemplate.required,children:r.jsx(Ne,{value:c,placeholder:h,options:l,onChange:d,noOptionsMessage:f})})})},zIe=u.memo(VIe),GIe={r:0,g:0,b:0,a:255},HIe=e=>{const{nodeId:t,field:n}=e,s=G(),i=u.useMemo(()=>{if(!n.value)return GIe;const{r:a,g:l,b:c,a:d}=n.value;return{r:a,g:l,b:c,a:d/255}},[n.value]),o=u.useCallback(a=>{typeof a=="string"&&(a=L2e(a,1));const{r:l,g:c,b:d,a:h}=a,f=Math.round(h*255);s(qte({nodeId:t,fieldName:n.name,value:{r:l,g:c,b:d,a:f}}))},[s,n.name,t]);return r.jsxs(T,{flexDir:"column",gap:2,w:"full",children:[r.jsx(KCe,{style:{background:lo("base.700"),color:lo("base.100"),fontSize:12,paddingInlineStart:10,borderRadius:4,paddingBlock:4,outline:"none"},className:Ve,color:P2e(i,!0),onChange:o,prefixed:!0,alpha:!0}),r.jsx(G$,{className:Ve,color:i,onChange:o,style:{width:"100%"}})]})},WIe=u.memo(HIe),UIe=e=>{const{nodeId:t,field:n}=e,{t:s}=A(),i=I(y=>y.config.disabledTabs),o=G(),[a,{isLoading:l}]=z7(),c=u.useCallback(y=>{y&&o(Kte({nodeId:t,fieldName:n.name,value:y}))},[o,n.name,t]),{options:d,value:h,onChange:f,placeholder:p,noOptionsMessage:g}=Zt({modelConfigs:a.filter(y=>bM(y)),onChange:c,isLoading:l,selectedModel:n.value}),m=e.fieldTemplate.required;return r.jsx(T,{w:"full",alignItems:"center",gap:2,children:r.jsx(Ee,{label:!i.includes("models")&&s("modelManager.starterModelsInModelManager"),children:r.jsx(K,{className:`${rt} ${Ve}`,isDisabled:!d.length,isInvalid:!h&&m,children:r.jsx(Ne,{value:h,placeholder:m?p:`(Optional) ${p}`,options:d,onChange:f,noOptionsMessage:g})})})})},qIe=u.memo(UIe),KIe=e=>{const{nodeId:t,field:n}=e,s=G(),[i,{isLoading:o}]=Qj(),a=u.useCallback(p=>{p&&s(Zte({nodeId:t,fieldName:n.name,value:p}))},[s,n.name,t]),{options:l,value:c,onChange:d,placeholder:h,noOptionsMessage:f}=Zt({modelConfigs:i,onChange:a,selectedModel:n.value,isLoading:o});return r.jsx(Ee,{label:c==null?void 0:c.description,children:r.jsx(K,{className:`${rt} ${Ve}`,isInvalid:!c,children:r.jsx(Ne,{value:c,placeholder:h,options:l,onChange:d,noOptionsMessage:f})})})},ZIe=u.memo(KIe),YIe=e=>{const{nodeId:t,field:n,fieldTemplate:s}=e,i=G(),o=u.useCallback(a=>{i(Yte({nodeId:t,fieldName:n.name,value:a.target.value}))},[i,n.name,t]);return r.jsx(_i,{className:`${rt} ${Ve}`,onChange:o,value:n.value,size:"sm",children:s.options.map(a=>r.jsx("option",{value:a,children:s.ui_choice_labels?s.ui_choice_labels[a]:a},a))})},XIe=u.memo(YIe),QIe=e=>{const{nodeId:t,field:n}=e,s=G(),[i,{isLoading:o}]=Qhe(),a=u.useCallback(p=>{p&&s(Kp({nodeId:t,fieldName:n.name,value:p}))},[s,n.name,t]),{options:l,value:c,onChange:d,placeholder:h,noOptionsMessage:f}=Zt({modelConfigs:i,onChange:a,isLoading:o,selectedModel:n.value});return r.jsx(T,{w:"full",alignItems:"center",gap:2,children:r.jsx(K,{className:`${rt} ${Ve}`,isDisabled:!l.length,isInvalid:!c,children:r.jsx(Ne,{value:c,placeholder:h,options:l,onChange:d,noOptionsMessage:f})})})},JIe=u.memo(QIe),e5e=e=>{const{nodeId:t,field:n}=e,s=G(),[i,{isLoading:o}]=K7(),a=u.useCallback(h=>{h&&s(Xte({nodeId:t,fieldName:n.name,value:h}))},[s,n.name,t]),{options:l,value:c,onChange:d}=Zt({modelConfigs:i,onChange:a,selectedModel:n.value,isLoading:o});return r.jsx(Ee,{label:c==null?void 0:c.description,children:r.jsx(K,{className:`${rt} ${Ve}`,isInvalid:!c,children:r.jsx(Ne,{value:c,placeholder:"Pick one",options:l,onChange:d})})})},t5e=u.memo(e5e),n5e=e=>{const{nodeId:t,field:n}=e,{t:s}=A(),i=I(m=>m.config.disabledTabs),o=G(),[a,{isLoading:l}]=U7(),c=u.useCallback(m=>{m&&o(Qte({nodeId:t,fieldName:n.name,value:m}))},[o,n.name,t]),{options:d,value:h,onChange:f,placeholder:p,noOptionsMessage:g}=Zt({modelConfigs:a,onChange:c,isLoading:l,selectedModel:n.value});return r.jsx(T,{w:"full",alignItems:"center",gap:2,children:r.jsx(Ee,{label:!i.includes("models")&&s("modelManager.starterModelsInModelManager"),children:r.jsx(K,{className:`${rt} ${Ve}`,isDisabled:!d.length,isInvalid:!h,children:r.jsx(Ne,{value:h,placeholder:p,options:d,onChange:f,noOptionsMessage:g})})})})},s5e=u.memo(n5e),r5e=e=>{var p;const{t}=A(),{nodeId:n,field:s,fieldTemplate:i}=e,o=G(),a=ae(Yn),{currentData:l,isError:c}=nl(((p=s.value)==null?void 0:p.image_name)??Xn),d=u.useCallback(()=>{o(M2({nodeId:n,fieldName:s.name,value:void 0}))},[o,s.name,n]),h=u.useMemo(()=>{var g;return tw.getData({fieldIdentifier:{nodeId:n,fieldName:s.name}},(g=s.value)==null?void 0:g.image_name)},[s,n]);u.useEffect(()=>{a&&c&&d()},[d,a,c]);const f=u.useCallback(g=>{o(M2({nodeId:n,fieldName:s.name,value:g}))},[o,s.name,n]);return r.jsxs(T,{position:"relative",className:Ve,w:"full",h:32,alignItems:"stretch",children:[!l&&r.jsx(F_,{w:"full",h:"auto",isError:i.required&&!s.value,onUpload:f,fontSize:24}),l&&r.jsxs(r.Fragment,{children:[r.jsx(T,{borderRadius:"base",borderWidth:1,borderStyle:"solid",children:r.jsx(ul,{imageDTO:l,asThumbnail:!0})}),r.jsx(q,{position:"absolute",background:"base.900",color:"base.50",fontSize:"sm",fontWeight:"semibold",insetInlineEnd:1,insetBlockEnd:1,opacity:.7,px:2,borderRadius:"base",pointerEvents:"none",children:`${l.width}x${l.height}`})]}),r.jsx(Is,{dndTarget:tw,dndTargetData:h,label:t("gallery.drop")})]})},i5e=u.memo(r5e),o5e=u.memo(()=>{const{t:e}=A();return r.jsx(T,{h:16,w:"full",alignItems:"center",justifyContent:"center",children:r.jsx(q,{fontSize:16,fontWeight:"semibold",children:e("gallery.dropOrUpload")})})});o5e.displayName="UploadElement";const a5e=e=>{const{nodeId:t,field:n}=e,s=G(),[i,{isLoading:o}]=H7(),a=u.useCallback(h=>{h&&s(Jte({nodeId:t,fieldName:n.name,value:h}))},[s,n.name,t]),{options:l,value:c,onChange:d}=Zt({modelConfigs:i,onChange:a,selectedModel:n.value,isLoading:o});return r.jsx(Ee,{label:c==null?void 0:c.description,children:r.jsx(K,{className:`${rt} ${Ve}`,isInvalid:!c,children:r.jsx(Ne,{value:c,placeholder:"Pick one",options:l,onChange:d})})})},l5e=u.memo(a5e),c5e=e=>{const{nodeId:t,field:n}=e,s=G(),[i,{isLoading:o}]=Z7(),a=u.useCallback(p=>{p&&s(ene({nodeId:t,fieldName:n.name,value:p}))},[s,n.name,t]),{options:l,value:c,onChange:d,placeholder:h,noOptionsMessage:f}=Zt({modelConfigs:i,onChange:a,selectedModel:n.value,isLoading:o});return r.jsx(K,{className:`${rt} ${Ve}`,isInvalid:!c,isDisabled:!l.length,children:r.jsx(Ne,{value:c,placeholder:h,noOptionsMessage:f,options:l,onChange:d})})},u5e=u.memo(c5e),d5e=e=>{const{nodeId:t,field:n}=e,s=G(),[i,{isLoading:o}]=yb(),a=u.useCallback(p=>{p&&s(tne({nodeId:t,fieldName:n.name,value:p}))},[s,n.name,t]),{options:l,value:c,onChange:d,placeholder:h,noOptionsMessage:f}=Zt({modelConfigs:i,onChange:a,selectedModel:n.value,isLoading:o});return r.jsx(K,{className:`${rt} ${Ve}`,isInvalid:!c,isDisabled:!l.length,children:r.jsx(Ne,{value:c,placeholder:h,noOptionsMessage:f,options:l,onChange:d})})},h5e=u.memo(d5e),f5e=e=>{const{nodeId:t,field:n}=e,s=G(),[i,{isLoading:o}]=Xhe(),a=u.useCallback(p=>{p&&s(Kp({nodeId:t,fieldName:n.name,value:p}))},[s,n.name,t]),{options:l,value:c,onChange:d,placeholder:h,noOptionsMessage:f}=Zt({modelConfigs:i,onChange:a,isLoading:o,selectedModel:n.value});return r.jsx(T,{w:"full",alignItems:"center",gap:2,children:r.jsx(K,{className:`${rt} ${Ve}`,isDisabled:!l.length,isInvalid:!c,children:r.jsx(Ne,{value:c,placeholder:h,options:l,onChange:d,noOptionsMessage:f})})})},p5e=u.memo(f5e),g5e=e=>{const{nodeId:t,field:n}=e,s=G(),[i,{isLoading:o}]=mb(),a=u.useCallback(p=>{p&&s(nne({nodeId:t,fieldName:n.name,value:p}))},[s,n.name,t]),{options:l,value:c,onChange:d,placeholder:h,noOptionsMessage:f}=Zt({modelConfigs:i,onChange:a,isLoading:o,selectedModel:n.value});return r.jsx(T,{w:"full",alignItems:"center",gap:2,children:r.jsx(K,{className:`${rt} ${Ve}`,isDisabled:!l.length,isInvalid:!c,children:r.jsx(Ne,{value:c,placeholder:h,options:l,onChange:d,noOptionsMessage:f})})})},m5e=u.memo(g5e),y5e=e=>{const{nodeId:t,field:n}=e,s=G(),i=u.useCallback(a=>{Zp(a==null?void 0:a.value)&&s(sne({nodeId:t,fieldName:n.name,value:a.value}))},[s,n.name,t]),o=u.useMemo(()=>ho.find(a=>a.value===(n==null?void 0:n.value)),[n==null?void 0:n.value]);return r.jsx(K,{className:`${rt} ${Ve} ${yc}`,children:r.jsx(Ne,{value:o,options:ho,onChange:i})})},b5e=u.memo(y5e),x5e=e=>{const{nodeId:t,field:n}=e,s=G(),[i,{isLoading:o}]=Jhe(),a=u.useCallback(p=>{p&&s(Kp({nodeId:t,fieldName:n.name,value:p}))},[s,n.name,t]),{options:l,value:c,onChange:d,placeholder:h,noOptionsMessage:f}=Zt({modelConfigs:i,onChange:a,isLoading:o,selectedModel:n.value});return r.jsx(T,{w:"full",alignItems:"center",gap:2,children:r.jsx(K,{className:`${rt} ${Ve}`,isDisabled:!l.length,isInvalid:!c&&e.fieldTemplate.required,children:r.jsx(Ne,{value:c,placeholder:h,options:l,onChange:d,noOptionsMessage:f})})})},v5e=u.memo(x5e),C5e=e=>{const{nodeId:t,field:n}=e,s=G(),[i,{isLoading:o}]=tfe(),a=u.useCallback(p=>{p&&s(Kp({nodeId:t,fieldName:n.name,value:p}))},[s,n.name,t]),{options:l,value:c,onChange:d,placeholder:h,noOptionsMessage:f}=Zt({modelConfigs:i,onChange:a,isLoading:o,selectedModel:n.value});return r.jsx(T,{w:"full",alignItems:"center",gap:2,children:r.jsx(K,{className:`${rt} ${Ve}`,isDisabled:!l.length,isInvalid:!c,children:r.jsx(Ne,{value:c,placeholder:h,options:l,onChange:d,noOptionsMessage:f})})})},w5e=u.memo(C5e),S5e=e=>{const{nodeId:t,field:n}=e,s=G(),[i,{isLoading:o}]=q7(),a=u.useCallback(h=>{h&&s(rne({nodeId:t,fieldName:n.name,value:h}))},[s,n.name,t]),{options:l,value:c,onChange:d}=Zt({modelConfigs:i,onChange:a,selectedModel:n.value,isLoading:o});return r.jsx(Ee,{label:c==null?void 0:c.description,children:r.jsx(K,{className:`${rt} ${Ve}`,isInvalid:!c,children:r.jsx(Ne,{value:c,placeholder:"Pick one",options:l,onChange:d})})})},j5e=u.memo(S5e),k5e=e=>{const{nodeId:t,field:n}=e,s=G(),[i,{isLoading:o}]=fg(),a=u.useCallback(h=>{h&&s(ine({nodeId:t,fieldName:n.name,value:h}))},[s,n.name,t]),{options:l,value:c,onChange:d}=Zt({modelConfigs:i,onChange:a,selectedModel:n.value,isLoading:o});return r.jsx(Ee,{label:c==null?void 0:c.description,children:r.jsx(K,{className:`${rt} ${Ve}`,isInvalid:!c,children:r.jsx(Ne,{value:c,placeholder:"Pick one",options:l,onChange:d})})})},_5e=u.memo(k5e),I5e=e=>{const{nodeId:t,field:n}=e,s=G(),[i,{isLoading:o}]=G7(),a=u.useCallback(h=>{h&&s(one({nodeId:t,fieldName:n.name,value:h}))},[s,n.name,t]),{options:l,value:c,onChange:d}=Zt({modelConfigs:i,onChange:a,selectedModel:n.value,isLoading:o});return r.jsx(Ee,{label:c==null?void 0:c.description,children:r.jsx(K,{className:`${rt} ${Ve}`,isInvalid:!c,children:r.jsx(Ne,{value:c,placeholder:"Pick one",options:l,onChange:d})})})},T5e=u.memo(I5e),A5e=e=>{const{nodeId:t,field:n}=e,{t:s}=A(),i=I(WS),o=G(),[a,{isLoading:l}]=Jj(),c=u.useCallback(y=>{y&&o(ane({nodeId:t,fieldName:n.name,value:y}))},[o,n.name,t]),{options:d,value:h,onChange:f,placeholder:p,noOptionsMessage:g}=Zt({modelConfigs:a,onChange:c,isLoading:l,selectedModel:n.value}),m=e.fieldTemplate.required;return r.jsx(T,{w:"full",alignItems:"center",gap:2,children:r.jsx(Ee,{label:!i&&s("modelManager.starterModelsInModelManager"),children:r.jsx(K,{className:`${rt} ${Ve}`,isDisabled:!d.length,isInvalid:!h&&m,children:r.jsx(Ne,{value:h,placeholder:m?p:`(Optional) ${p}`,options:d,onChange:f,noOptionsMessage:g})})})})},E5e=u.memo(A5e),M5e=e=>{const{nodeId:t,field:n}=e,s=G(),[i,{isLoading:o}]=bb(),a=u.useCallback(g=>{g&&s(lne({nodeId:t,fieldName:n.name,value:g}))},[s,n.name,t]),{options:l,value:c,onChange:d,placeholder:h,noOptionsMessage:f}=Zt({modelConfigs:i,onChange:a,selectedModel:n.value,isLoading:o}),p=e.fieldTemplate.required;return r.jsx(T,{w:"full",alignItems:"center",gap:2,children:r.jsx(K,{className:`${rt} ${Ve}`,isDisabled:!l.length,isInvalid:!c&&p,children:r.jsx(Ne,{value:c,placeholder:p?h:`(Optional) ${h}`,options:l,onChange:d,noOptionsMessage:f})})})},P5e=u.memo(M5e),nx=u.memo(({nodeId:e,fieldName:t,settings:n})=>{const s=Ic(e,t),i=Ni(e,t);if(Q3(i))return Kw(s)?r.jsx(cW,{nodeId:e,field:s,fieldTemplate:i}):null;if(sL(i)){if(!cne(s))return null;if(!n||n.type!=="string-field-config")return i.ui_component==="textarea"?r.jsx(Pw,{nodeId:e,field:s,fieldTemplate:i}):r.jsx(Mw,{nodeId:e,field:s,fieldTemplate:i});if(n.component==="input")return r.jsx(Mw,{nodeId:e,field:s,fieldTemplate:i});if(n.component==="textarea")return r.jsx(Pw,{nodeId:e,field:s,fieldTemplate:i});if(n.component==="dropdown")return r.jsx(yW,{nodeId:e,field:s,fieldTemplate:i,settings:n});we(!1,"Unexpected settings")}if(une(i))return dne(s)?r.jsx(DIe,{nodeId:e,field:s,fieldTemplate:i}):null;if(P0(i)){if(!nM(s))return null;if(!n||n.type!=="integer-field-config")return r.jsx(Ew,{nodeId:e,field:s,fieldTemplate:i});if(n.component==="number-input")return r.jsx(Ew,{nodeId:e,field:s,fieldTemplate:i,settings:n});if(n.component==="slider")return r.jsx(mW,{nodeId:e,field:s,fieldTemplate:i,settings:n});if(n.component==="number-input-and-slider")return r.jsx(gW,{nodeId:e,field:s,fieldTemplate:i,settings:n});we(!1,"Unexpected settings.component")}if(M0(i)){if(!tM(s))return null;if(!n||n.type!=="float-field-config")return r.jsx(Aw,{nodeId:e,field:s,fieldTemplate:i});if(n.component==="number-input")return r.jsx(Aw,{nodeId:e,field:s,fieldTemplate:i,settings:n});if(n.component==="slider")return r.jsx(GH,{nodeId:e,field:s,fieldTemplate:i,settings:n});if(n.component==="number-input-and-slider")return r.jsx(zH,{nodeId:e,field:s,fieldTemplate:i,settings:n});we(!1,"Unexpected settings.component")}return J3(i)?Yw(s)?r.jsx(nW,{nodeId:e,field:s,fieldTemplate:i}):null:eM(i)?Zw(s)?r.jsx(WH,{nodeId:e,field:s,fieldTemplate:i}):null:hne(i)?fne(s)?r.jsx(XIe,{nodeId:e,field:s,fieldTemplate:i}):null:X3(i)?gy(s)?r.jsx(QH,{nodeId:e,field:s,fieldTemplate:i}):null:pne(i)?gne(s)?r.jsx(i5e,{nodeId:e,field:s,fieldTemplate:i}):null:V3(i)?z3(s)?r.jsx(PIe,{nodeId:e,field:s,fieldTemplate:i}):null:mne(i)?yne(s)?r.jsx(p5e,{nodeId:e,field:s,fieldTemplate:i}):null:bne(i)?xne(s)?r.jsx(kIe,{nodeId:e,field:s,fieldTemplate:i}):null:vne(i)?Cne(s)?r.jsx(m5e,{nodeId:e,field:s,fieldTemplate:i}):null:wne(i)?Sne(s)?r.jsx(P5e,{nodeId:e,field:s,fieldTemplate:i}):null:jne(i)?kne(s)?r.jsx(E5e,{nodeId:e,field:s,fieldTemplate:i}):null:_ne(i)?Ine(s)?r.jsx(OIe,{nodeId:e,field:s,fieldTemplate:i}):null:Tne(i)?Ane(s)?r.jsx($Ie,{nodeId:e,field:s,fieldTemplate:i}):null:Ene(i)?Mne(s)?r.jsx(FIe,{nodeId:e,field:s,fieldTemplate:i}):null:Pne(i)?Lne(s)?r.jsx(qIe,{nodeId:e,field:s,fieldTemplate:i}):null:Dne(i)?Rne(s)?r.jsx(u5e,{nodeId:e,field:s,fieldTemplate:i}):null:One(i)?Nne(s)?r.jsx(s5e,{nodeId:e,field:s,fieldTemplate:i}):null:Fne(i)?Bne(s)?r.jsx(h5e,{nodeId:e,field:s,fieldTemplate:i}):null:$ne(i)?Vne(s)?r.jsx(ZIe,{nodeId:e,field:s,fieldTemplate:i}):null:zne(i)?Gne(s)?r.jsx(l5e,{nodeId:e,field:s,fieldTemplate:i}):null:Hne(i)?Wne(s)?r.jsx(T5e,{nodeId:e,field:s,fieldTemplate:i}):null:Une(i)?qne(s)?r.jsx(_5e,{nodeId:e,field:s,fieldTemplate:i}):null:Kne(i)?Zne(s)?r.jsx(j5e,{nodeId:e,field:s,fieldTemplate:i}):null:Yne(i)?Xne(s)?r.jsx(t5e,{nodeId:e,field:s,fieldTemplate:i}):null:Qne(i)?Jne(s)?r.jsx(WIe,{nodeId:e,field:s,fieldTemplate:i}):null:ese(i)?tse(s)?r.jsx(JIe,{nodeId:e,field:s,fieldTemplate:i}):null:nse(i)?sse(s)?r.jsx(v5e,{nodeId:e,field:s,fieldTemplate:i}):null:rse(i)?ise(s)?r.jsx(zIe,{nodeId:e,field:s,fieldTemplate:i}):null:ose(i)?ase(s)?r.jsx(w5e,{nodeId:e,field:s,fieldTemplate:i}):null:lse(i)?cse(s)?r.jsx(b5e,{nodeId:e,field:s,fieldTemplate:i}):null:use(i)?q3(s)?r.jsx(XH,{nodeId:e,field:s,fieldTemplate:i}):null:dse(i)?Z3(s)?r.jsx(lW,{nodeId:e,field:s,fieldTemplate:i}):null:hse(i)?W3(s)?r.jsx(pW,{nodeId:e,field:s,fieldTemplate:i}):null:fse(i)&&G3(s)?r.jsx(tW,{nodeId:e,field:s,fieldTemplate:i}):null});nx.displayName="InputFieldRenderer";const sx=(e,t)=>{const n=u.useMemo(()=>fe(Qe,i=>{var o;return((o=Ey(i,e,t))==null?void 0:o.description)??""}),[t,e]);return I(n)},bW=u.memo(({el:e})=>{const{data:t}=e,{fieldIdentifier:n}=t,s=G(),i=sx(n.nodeId,n.fieldName),o=Ni(n.nodeId,n.fieldName),a=u.useRef(null),l=u.useCallback(d=>{s(dL({nodeId:n.nodeId,fieldName:n.fieldName,val:d}))},[s,n.fieldName,n.nodeId]),c=aa({value:i||o.description,defaultValue:o.description,inputRef:a,onChange:l});return c.isEditing?r.jsx(ss,{ref:a,variant:"outline",fontSize:"sm",p:1,px:2,_focusVisible:{borderRadius:"base",h:"unset"},...c.inputProps}):r.jsx(Js,{onDoubleClick:c.startEditing,sx:$g,children:r.jsx(zg,{options:Vg,children:c.value})})});bW.displayName="NodeFieldElementDescriptionEditable";const r2=Symbol("uniqueNonexistentValue"),L5e=(e,t,n)=>{const s=G(),i=u.useMemo(()=>fe(Qe,d=>e in d.formFieldInitialValues?d.formFieldInitialValues[e]:r2),[e]),o=I(i),a=u.useMemo(()=>fe(Qe,d=>{var p;if(o===r2)return!1;const h=d.nodes.find(g=>g.id===t);if(!Pn(h))return;const f=(p=h.data.inputs[n])==null?void 0:p.value;return!Al(f,o)}),[n,o,t]),l=I(a),c=u.useCallback(()=>{o!==r2&&s(US({nodeId:t,fieldName:n,value:o}))},[s,n,t,o]);return{initialValue:o,isValueChanged:l,resetToInitialValue:c}},l4=u.memo(({element:e})=>{const{t}=A(),{id:n,data:s}=e,{nodeId:i,fieldName:o}=s.fieldIdentifier,{isValueChanged:a,resetToInitialValue:l}=L5e(n,i,o);return a?r.jsx(oe,{variant:"link",size:"sm",alignSelf:"stretch",tooltip:t("nodes.resetToDefaultValue"),"aria-label":t("nodes.resetToDefaultValue"),icon:r.jsx(ur,{}),onClick:l,isDisabled:!a}):null});l4.displayName="NodeFieldElementResetToInitialValueIconButton";const c4=(e,t)=>{const n=u.useMemo(()=>fe(Qe,i=>{var o;return((o=Ey(i,e,t))==null?void 0:o.label)??""}),[t,e]);return I(n)},xW=u.memo(({el:e})=>{const{data:t}=e,{fieldIdentifier:n}=t,s=G(),i=c4(n.nodeId,n.fieldName),o=Ni(n.nodeId,n.fieldName),a=u.useRef(null),l=u.useCallback(d=>{s(hL({nodeId:n.nodeId,fieldName:n.fieldName,label:d}))},[s,n.fieldName,n.nodeId]),c=aa({value:i||o.title,defaultValue:o.title,inputRef:a,onChange:l});return c.isEditing?r.jsx(kt,{ref:a,variant:"outline",p:1,px:2,_focusVisible:{borderRadius:"base",h:"unset"},...c.inputProps}):r.jsxs(T,{w:"full",gap:4,children:[r.jsx(J,{onDoubleClick:c.startEditing,cursor:"text",children:c.value}),r.jsx(it,{}),r.jsx(l4,{element:e})]})});xW.displayName="NodeFieldElementLabelEditable";const D5e=li({}).options,vW=u.memo(({id:e,settings:t})=>{const{t:n}=A(),s=G(),i=u.useCallback(d=>{const h=[...t.options];h.splice(d,1),s(ns({id:e,changes:{settings:{...t,options:h}}}))},[t,s,e]),o=u.useCallback((d,h)=>{if(!t.options[d])return;const f={...t.options[d],value:h},p=[...t.options];p[d]=f,s(ns({id:e,changes:{settings:{...t,options:p}}}))},[s,e,t]),a=u.useCallback((d,h)=>{if(!t.options[d])return;const f={...t.options[d],label:h},p=[...t.options];p[d]=f,s(ns({id:e,changes:{settings:{...t,options:p}}}))},[s,e,t]),l=u.useCallback(()=>{const d=[...t.options,H2()];s(ns({id:e,changes:{settings:{...t,options:d}}}))},[s,e,t]),c=u.useCallback(()=>{const d=[H2()];s(ns({id:e,changes:{settings:{...t,options:d}}}))},[s,e,t]);return r.jsxs(T,{className:Ve,position:"relative",w:"full",h:"auto",maxH:64,alignItems:"stretch",justifyContent:"center",borderRadius:"base",flexDir:"column",gap:2,children:[r.jsxs(Zn,{isAttached:!1,w:"full",children:[r.jsx(de,{onClick:l,variant:"ghost",flex:1,leftIcon:r.jsx(Vt,{}),children:n("workflows.builder.addOption")}),r.jsx(de,{onClick:c,variant:"ghost",flex:1,leftIcon:r.jsx(ur,{}),children:n("workflows.builder.resetOptions")})]}),t.options.length>0&&r.jsxs(r.Fragment,{children:[r.jsx(wt,{}),r.jsx(ps,{className:rt,defer:!0,style:jo,options:D5e,children:r.jsxs(Ar,{gap:1,gridTemplateColumns:"auto 1fr 1fr auto",gridTemplateRows:"auto 1fr",alignItems:"center",children:[r.jsx(xt,{minW:8,children:r.jsx(q,{textAlign:"center",variant:"subtext",children:"#"})}),r.jsx(xt,{children:r.jsx(q,{textAlign:"center",variant:"subtext",children:n("common.label")})}),r.jsx(xt,{children:r.jsx(q,{textAlign:"center",variant:"subtext",children:n("common.value")})}),r.jsx(xt,{}),t.options.map(({value:d,label:h},f)=>r.jsx(CW,{value:d,label:h,index:f,onRemoveOption:i,onChangeOptionValue:o,onChangeOptionLabel:a,isRemoveDisabled:t.options.length<=1},f))]})})]})]})});vW.displayName="NodeFieldElementStringDropdownSettings";const CW=u.memo(({value:e,label:t,index:n,onRemoveOption:s,onChangeOptionValue:i,onChangeOptionLabel:o,isRemoveDisabled:a})=>{const{t:l}=A(),c=u.useCallback(()=>{s(n)},[n,s]),d=u.useCallback(f=>{i(n,f.target.value)},[n,i]),h=u.useCallback(f=>{o(n,f.target.value)},[n,o]);return r.jsxs(r.Fragment,{children:[r.jsx(xt,{children:r.jsxs(q,{variant:"subtext",textAlign:"center",children:[n+1,"."]})}),r.jsx(xt,{children:r.jsx(kt,{size:"sm",resize:"none",placeholder:"label",value:t,onChange:h})}),r.jsx(xt,{children:r.jsx(kt,{size:"sm",resize:"none",placeholder:"value",value:e,onChange:d})}),r.jsx(xt,{children:r.jsx(oe,{tabIndex:-1,size:"sm",variant:"link",minW:8,minH:8,onClick:c,isDisabled:a,icon:r.jsx(Ot,{}),"aria-label":l("common.delete")})})]})});CW.displayName="ListItemContent";const R5e={position:"relative",borderRadius:"base",'&[data-parent-layout="column"]':{w:"full",h:"min-content"},'&[data-parent-layout="row"]':{flex:"1 1 0"},flexDir:"column"},wW=u.memo(({el:e})=>{const t=u.useRef(null),n=u.useRef(null),[s,i]=Rg(e.id,t,n),o=Oi(),{id:a}=e;return r.jsxs(T,{ref:t,id:a,className:fL,sx:R5e,"data-parent-layout":o.layout,children:[r.jsx(SW,{dragHandleRef:n,el:e,isDragging:i}),r.jsx(rx,{nodeId:e.data.fieldIdentifier.nodeId}),r.jsx(Og,{activeDropRegion:s,gap:"var(--invoke-space-4)"})]})});wW.displayName="NodeFieldElementEditMode";const SW=u.memo(({el:e,dragHandleRef:t,isDragging:n})=>{var l;const{id:s,data:i}=e,{fieldIdentifier:o,showDescription:a}=i;return r.jsxs(r.Fragment,{children:[r.jsx(Gd,{dragHandleRef:t,element:e,"data-is-dragging":n}),r.jsx(Vd,{"data-is-dragging":n,p:4,children:r.jsx(_c,{nodeId:o.nodeId,fieldName:o.fieldName,children:r.jsxs(K,{flex:"1 1 0",orientation:"vertical",children:[r.jsx(xW,{el:e}),r.jsx(T,{w:"full",gap:4,children:r.jsx(nx,{nodeId:o.nodeId,fieldName:o.fieldName,settings:i.settings})}),a&&r.jsx(bW,{el:e}),((l=i.settings)==null?void 0:l.type)==="string-field-config"&&i.settings.component==="dropdown"&&r.jsxs(r.Fragment,{children:[r.jsx(wt,{}),r.jsx(vW,{id:s,settings:i.settings})]})]})})})]})});SW.displayName="NodeFieldElementEditModeContent";const O5e={position:"absolute",top:0,insetInlineEnd:0,bottom:0,insetInlineStart:0,borderRadius:"base",transitionProperty:"none",pointerEvents:"none",display:"none",'&[data-is-mouse-over-node-or-form-field="true"]':{display:"block",bg:"invokeBlueAlpha.100"}},rx=u.memo(({nodeId:e})=>{const t=vH(e),n=Bg(e);return r.jsx(Se,{sx:O5e,"data-is-mouse-over-node-or-form-field":t.isMouseOverNode||n.isMouseOverFormField})});rx.displayName="NodeFieldElementOverlay";const jW=u.memo(({el:e})=>{const{data:t}=e,{fieldIdentifier:n}=t,s=c4(n.nodeId,n.fieldName),i=Ni(n.nodeId,n.fieldName),o=u.useMemo(()=>s||i.title,[s,i.title]);return r.jsxs(T,{w:"full",gap:4,children:[r.jsx(J,{children:o}),r.jsx(it,{}),r.jsx(l4,{element:e})]})});jW.displayName="NodeFieldElementLabel";const N5e=(e,t)=>{const n=qG(e);return u.useMemo(()=>(n==null?void 0:n.inputs[t])??null,[t,n==null?void 0:n.inputs])},F5e={'&[data-parent-layout="column"]':{w:"full",h:"min-content"},'&[data-parent-layout="row"]':{flex:"1 1 0",minW:32},'&[data-with-description="false"]':{pb:2}},B5e=()=>{const{t:e}=A();return u.useCallback(n=>e("nodes.unknownFieldEditWorkflowToFix_withName",{name:n}),[e])},kW=u.memo(({el:e})=>{const{id:t,data:n}=e,{fieldIdentifier:s,showDescription:i}=n,o=sx(s.nodeId,s.fieldName),a=N5e(s.nodeId,s.fieldName),l=Oi(),c=B5e(),d=u.useMemo(()=>o||(a==null?void 0:a.description)||"",[o,a==null?void 0:a.description]);return r.jsx(T,{id:t,className:fL,sx:F5e,"data-parent-layout":l.layout,"data-with-description":i&&!!d,children:r.jsx(_c,{nodeId:e.data.fieldIdentifier.nodeId,fieldName:e.data.fieldIdentifier.fieldName,formatLabel:c,children:r.jsx(_W,{el:e})})})});kW.displayName="NodeFieldElementViewMode";const _W=u.memo(({el:e})=>{const{data:t}=e,{fieldIdentifier:n,showDescription:s}=t,i=sx(n.nodeId,n.fieldName),o=Ni(n.nodeId,n.fieldName),a=u.useMemo(()=>i||o.description,[i,o.description]);return r.jsxs(K,{flex:"1 1 0",orientation:"vertical",children:[r.jsx(jW,{el:e}),r.jsx(T,{w:"full",gap:4,children:r.jsx(nx,{nodeId:n.nodeId,fieldName:n.fieldName,settings:t.settings})}),s&&a&&r.jsx(Js,{sx:$g,children:r.jsx(zg,{options:Vg,children:a})})]})});_W.displayName="NodeFieldElementViewModeContent";const IW=u.memo(({id:e})=>{const t=Hd(e),n=I(Co);return!t||!GS(t)?null:n==="view"?r.jsx(kW,{el:t}):r.jsx(wW,{el:t})});IW.displayName="NodeFieldElement";const $5e={fontSize:"md",whiteSpace:"pre-wrap",overflowWrap:"anywhere",'&[data-is-empty="true"]':{opacity:.3},...$g},u4=u.memo(({content:e,...t})=>{const{t:n}=A();return r.jsx(q,{sx:$5e,"data-is-empty":e==="",...t,children:r.jsx(zg,{options:Vg,children:e||n("workflows.builder.textPlaceholder")})})});u4.displayName="TextElementContent";const TW=u.memo(({el:e})=>{const{t}=A(),n=G(),{id:s,data:i}=e,{content:o}=i,a=u.useRef(null),l=u.useCallback(d=>{n(pse({id:s,changes:{content:d}}))},[n,s]),c=aa({value:o,defaultValue:"",onChange:l,inputRef:a});return c.isEditing?r.jsx(Q_,{ref:a,placeholder:t("workflows.builder.textPlaceholder"),...c.inputProps,fontSize:"md",variant:"outline",overflowWrap:"anywhere",w:"full",minRows:1,maxRows:10,resize:"none",p:2}):r.jsx(u4,{content:c.value,onDoubleClick:c.startEditing})});TW.displayName="TextElementContentEditable";const V5e={position:"relative",borderRadius:"base",minW:32,'&[data-parent-layout="column"]':{w:"full",h:"min-content"},'&[data-parent-layout="row"]':{flex:"1 0 0"},flexDir:"column"},AW=u.memo(({el:e})=>{const t=u.useRef(null),n=u.useRef(null),[s,i]=Rg(e.id,t,n),o=Oi(),{id:a}=e;return r.jsxs(T,{ref:t,id:a,className:pL,sx:V5e,"data-parent-layout":o.layout,children:[r.jsx(Gd,{dragHandleRef:n,element:e,"data-is-dragging":i}),r.jsx(Vd,{"data-is-dragging":i,p:4,children:r.jsx(TW,{el:e})}),r.jsx(Og,{activeDropRegion:s,gap:"var(--invoke-space-4)"})]})});AW.displayName="TextElementEditMode";const z5e={'&[data-parent-layout="column"]':{w:"full",h:"min-content"},'&[data-parent-layout="row"]':{flex:"1 1 0",minW:32}},EW=u.memo(({el:e})=>{const{id:t,data:n}=e,{content:s}=n,i=Oi();return r.jsx(T,{id:t,className:pL,sx:z5e,"data-parent-layout":i.layout,children:r.jsx(u4,{content:s})})});EW.displayName="TextElementViewMode";const MW=u.memo(({id:e})=>{const t=Hd(e),n=I(Co);return!t||!gL(t)?null:n==="view"?r.jsx(EW,{el:t}):r.jsx(AW,{el:t})});MW.displayName="TextElement";const PW=u.memo(({id:e})=>{const t=Hd(e),n=I(Co);return!t||!Xr(t)?null:n==="view"?r.jsx(LW,{el:t}):r.jsx(DW,{el:t})});PW.displayName="ContainerElementComponent";const G5e={gap:2,'&[data-self-layout="column"]':{flexDir:"column",alignItems:"stretch"},'&[data-self-layout="row"]':{flexDir:"row",alignItems:"flex-start",overflowX:"auto",overflowY:"visible",h:"min-content",flexShrink:0},'&[data-parent-layout="column"]':{w:"full",h:"min-content"},'&[data-parent-layout="row"]':{flex:"1 1 0",minW:32}},LW=u.memo(({el:e})=>{const{t}=A(),n=Yb(),s=Oi(),{id:i,data:o}=e,{children:a,layout:l}=o;return r.jsx(Lg,{depth:n+1,children:r.jsx(Pg,{id:i,layout:l,children:r.jsxs(T,{id:i,className:bL,sx:G5e,"data-self-layout":l,"data-depth":n,"data-parent-layout":s.layout,children:[a.map(c=>r.jsx(Hg,{id:c},c)),a.length===0&&r.jsx(T,{p:8,w:"full",h:"full",alignItems:"center",justifyContent:"center",children:r.jsx(q,{variant:"subtext",children:t("workflows.builder.containerPlaceholder")})})]})})})});LW.displayName="ContainerElementComponentViewMode";const H5e={borderRadius:"base",position:"relative",'&[data-active-drop-region="center"]':{opacity:1,bg:"base.850"},flexDir:"column",'&[data-parent-layout="column"]':{w:"full",h:"min-content"},'&[data-parent-layout="row"]':{flex:"1 1 0",h:"min-content"}},W5e={gap:4,p:4,flex:"1 1 0",'&[data-self-layout="column"]':{flexDir:"column"},'&[data-self-layout="row"]':{flexDir:"row",overflowX:"auto"}},DW=u.memo(({el:e})=>{const t=Yb(),n=u.useRef(null),s=u.useRef(null),i=u.useRef(null),[o,a]=Rg(e.id,n,s),{id:l,data:c}=e,{children:d,layout:h}=c,f=Oi();return u.useEffect(()=>{const p=i.current;if(p&&h!=="column")return vj({element:p})},[h]),r.jsx(Lg,{depth:t+1,children:r.jsx(Pg,{id:l,layout:h,children:r.jsxs(T,{id:l,ref:n,className:bL,sx:H5e,"data-depth":t,"data-parent-layout":f.layout,"data-active-drop-region":o,children:[r.jsx(Gd,{dragHandleRef:s,element:e,"data-is-dragging":a}),r.jsx(Vd,{"data-is-dragging":a,children:r.jsxs(T,{ref:i,sx:W5e,"data-self-layout":h,children:[d.map(p=>r.jsx(Hg,{id:p},p)),d.length===0&&r.jsx(BW,{})]})}),r.jsx(Og,{activeDropRegion:o,gap:"var(--invoke-space-4)"})]})})})});DW.displayName="ContainerElementComponentEditMode";const RW={position:"relative",alignItems:"center",borderRadius:"base",w:"full",h:"full",gap:2,display:"flex",flex:1,maxW:"768px",'&[data-self-layout="column"]':{flexDir:"column",alignItems:"stretch"},'&[data-self-layout="row"]':{flexDir:"row",alignItems:"flex-start"}},OW=u.memo(()=>{const e=I(mL),{id:t,data:n}=e,{children:s,layout:i}=n;return r.jsx(Lg,{depth:0,children:r.jsx(Pg,{id:t,layout:i,children:r.jsx(Se,{id:t,className:yL,sx:RW,"data-self-layout":i,"data-depth":0,children:s.map(o=>r.jsx(Hg,{id:o},o))})})})});OW.displayName="RootContainerElementViewMode";const U5e={...RW,gap:4,'&[data-is-dragging-over="true"]':{opacity:1,bg:"base.850"}},NW=u.memo(()=>{const e=I(mL),{id:t,data:n}=e,{children:s,layout:i}=n,o=u.useRef(null),a=h4e(o);return r.jsx(Lg,{depth:0,children:r.jsx(Pg,{id:t,layout:i,children:r.jsxs(T,{ref:o,id:t,className:yL,sx:U5e,"data-self-layout":i,"data-depth":0,"data-is-dragging-over":a,children:[s.map(l=>r.jsx(Hg,{id:l},l)),s.length===0&&r.jsx(FW,{})]})})})});NW.displayName="RootContainerElementEditMode";const FW=u.memo(()=>{const{t:e}=A();return r.jsx(T,{p:8,w:"full",h:"full",alignItems:"center",justifyContent:"center",children:r.jsx(q,{variant:"subtext",children:e("workflows.builder.emptyRootPlaceholderEditMode")})})});FW.displayName="RootPlaceholder";const BW=u.memo(()=>{const{t:e}=A();return r.jsx(T,{p:8,w:"full",h:"full",alignItems:"center",justifyContent:"center",children:r.jsx(q,{variant:"subtext",children:e("workflows.builder.containerPlaceholder")})})});BW.displayName="NonRootPlaceholder";const Hg=u.memo(({id:e})=>{const t=Hd(e);if(!t)return null;if(Xr(t))return r.jsx(PW,{id:e},e);if(GS(t))return r.jsx(IW,{id:e},e);if(iL(t))return r.jsx(_H,{id:e},e);if(lL(t))return r.jsx(VH,{id:e},e);if(gL(t))return r.jsx(MW,{id:e},e);we(!1,`Unhandled type for element with id ${e}`)});Hg.displayName="FormElementComponent";const q5e=()=>{const e=dn();return u.useCallback(()=>{const n=gse(e.getState()),s=mse(e.getState());for(const i of s){if(!(i.id in n))continue;const{nodeId:o,fieldName:a}=i.data.fieldIdentifier;e.dispatch(US({nodeId:o,fieldName:a,value:n[i.id]}))}},[e])},$W=u.memo(()=>{const{t:e}=A(),t=dn(),n=q5e(),s=u.useCallback(()=>{t.dispatch(yse())},[t]);return r.jsxs(en,{placement:"bottom-end",children:[r.jsx(tn,{as:oe,icon:r.jsx(GR,{}),variant:"ghost",size:"sm"}),r.jsxs(Tt,{children:[r.jsx(pe,{icon:r.jsx(ur,{}),onClick:n,children:e("workflows.builder.resetAllNodeFields")}),r.jsx(pe,{isDestructive:!0,icon:r.jsx(Vj,{}),onClick:s,children:e("workflows.builder.deleteAllElements")})]})]})});$W.displayName="WorkflowBuilderEditMenu";const K5e={pt:3,w:"full",'&[data-is-empty="true"]':{pt:0}},VW=u.memo(()=>{const{t:e}=A();return d4e(),r.jsx(T,{justifyContent:"center",w:"full",h:"full",children:r.jsxs(T,{flexDir:"column",w:"full",maxW:"768px",gap:2,children:[r.jsxs(T,{w:"full",alignItems:"center",gap:2,pt:3,children:[r.jsx(qm,{type:"container",children:e("workflows.builder.container")}),r.jsx(qm,{type:"divider",children:e("workflows.builder.divider")}),r.jsx(qm,{type:"heading",children:e("workflows.builder.heading")}),r.jsx(qm,{type:"text",children:e("workflows.builder.text")}),r.jsx(de,{size:"sm",variant:"ghost",tooltip:e("workflows.builder.nodeFieldTooltip"),children:e("workflows.builder.nodeField")}),r.jsx(it,{}),r.jsx($W,{})]}),r.jsx(os,{children:r.jsx(zW,{})})]})})});VW.displayName="WorkflowBuilder";const zW=u.memo(()=>{const{t:e}=A(),t=I(xL),n=vy(),s=ae(Mp);return n.isLoading||!s?r.jsx(Pt,{label:e("nodes.loadingNodes"),icon:null}):r.jsx(T,{sx:K5e,"data-is-empty":t,children:r.jsx(NW,{})})});zW.displayName="WorkflowBuilderContent";const Z5e=(e,t)=>{const[n,s]=u.useState(!1);return u.useEffect(()=>{const i=t.current;if(i)return qn(Pd(i),pd({element:i,getInitialData:()=>{if(e==="container"){const o=bse("row",[]);return Dl(o)}if(e==="divider"){const o=xse();return Dl(o)}if(e==="heading"){const o=vse("");return Dl(o)}if(e==="text"){const o=Cse("");return Dl(o)}we(!1)},onDragStart:()=>{s(!0)},onDrop:()=>{s(!1)}}))},[t,e]),n},Y5e={cursor:"grab",borderStyle:"dashed",_active:{borderStyle:"dashed"},_disabled:{borderStyle:"dashed",opacity:.5}},qm=({type:e,children:t})=>{const n=u.useRef(null),s=Z5e(e,n);return r.jsx(de,{as:"div",ref:n,size:"sm",isDisabled:s,variant:"outline",sx:Y5e,children:t})},GW=(e,t)=>{const n=Rs(e);return u.useMemo(()=>{const i=n.inputs[t];return we(i,`Template for input field ${t} not found.`),i.title},[t,n.inputs])},X5e=(e,t)=>{const n=u.useMemo(()=>fe(Qe,i=>HS(i,e,t).label),[t,e]);return I(n)},HW=e=>{const t=ae(sn),n=u.useMemo(()=>fe(Qe,i=>{const o=i.nodes.find(l=>l.id===e);we(Pn(o),"Node not found");const a=t[o.data.type];return we(a,"Template not found"),a.title}),[e,t]);return I(n)},WW=e=>{const t=u.useMemo(()=>fe(Qe,s=>{const i=s.nodes.find(o=>o.id===e);return we(Pn(i),"Node not found"),i.data.label}),[e]);return I(t)},Q5e=e=>{const t=e.filter(i=>!i.ui_hidden),n=t.filter(i=>!qe(i.ui_order)).sort((i,o)=>(i.ui_order??0)-(o.ui_order??0)),s=t.filter(i=>qe(i.ui_order));return n.concat(s).map(i=>i.name).filter(i=>i!=="is_intermediate")},UW=e=>{const t=Rs(e);return u.useMemo(()=>Q5e(fo(t.outputs)),[t.outputs])},ix=(e,t)=>{const n=Rs(e);return u.useMemo(()=>{const i=n.outputs[t];return we(i,`Template for output field ${t} not found`),i},[t,n.outputs])},h8=$n("generation"),qW=u.memo(()=>r.jsxs(T,{flexDir:"column",gap:2,h:"full",children:[r.jsxs(Zn,{isAttached:!1,size:"sm",variant:"ghost",children:[r.jsx(it,{}),r.jsx(JW,{}),r.jsx(eU,{})]}),r.jsx(os,{children:r.jsxs(T,{flexDir:"column",gap:2,w:"full",h:"full",children:[r.jsx(KW,{}),r.jsx(YW,{}),r.jsx(XW,{})]})})]}));qW.displayName="PublishWorkflowPanelContent";const KW=u.memo(()=>{const{t:e}=A(),t=ae(Xo);return r.jsxs(T,{flexDir:"column",borderWidth:1,borderRadius:"base",gap:2,p:2,children:[r.jsxs(T,{alignItems:"center",children:[r.jsx(q,{fontWeight:"semibold",children:e("workflows.builder.publishedWorkflowOutputs")}),r.jsx(it,{}),r.jsx(QW,{variant:"link",size:"sm"})]}),r.jsx(wt,{}),!t&&r.jsx(q,{fontWeight:"semibold",color:"error.300",children:e("workflows.builder.noOutputNodeSelected")}),t&&r.jsx(ZW,{outputNodeId:t})]})});KW.displayName="OutputFields";const ZW=u.memo(({outputNodeId:e})=>{const t=UW(e);return r.jsx(r.Fragment,{children:t.map(n=>r.jsx(tU,{nodeId:e,fieldName:n},`${e}-${n}`))})});ZW.displayName="OutputFieldsContent";const YW=u.memo(()=>{const{t:e}=A(),t=Ky();return t.publishable.length===0?r.jsx(T,{flexDir:"column",borderWidth:1,borderRadius:"base",gap:2,p:2,children:r.jsx(q,{fontWeight:"semibold",color:"warning.300",children:e("workflows.builder.noPublishableInputs")})}):r.jsxs(T,{flexDir:"column",borderWidth:1,borderRadius:"base",gap:2,p:2,children:[r.jsx(q,{fontWeight:"semibold",children:e("workflows.builder.publishedWorkflowInputs")}),r.jsx(wt,{}),t.publishable.map(({nodeId:n,fieldName:s})=>r.jsx(d4,{nodeId:n,fieldName:s},`${n}-${s}`))]})});YW.displayName="PublishableInputFields";const XW=u.memo(()=>{const{t:e}=A(),t=Ky();return t.unpublishable.length===0?null:r.jsxs(T,{flexDir:"column",borderWidth:1,borderRadius:"base",gap:2,p:2,children:[r.jsx(q,{fontWeight:"semibold",color:"warning.300",children:e("workflows.builder.unpublishableInputs")}),r.jsx(wt,{}),t.unpublishable.map(({nodeId:n,fieldName:s})=>r.jsx(d4,{nodeId:n,fieldName:s},`${n}-${s}`))]})});XW.displayName="UnpublishableInputFields";const QW=u.memo(e=>{const{t}=A(),n=ae(Xo),s=ae(Ha),i=u.useCallback(()=>{Xo.set(null),Ha.set(!0)},[]);return r.jsx(de,{leftIcon:r.jsx(Cde,{}),isDisabled:s,tooltip:s?t("workflows.builder.selectingOutputNodeDesc"):void 0,onClick:i,...e,children:t(s?"workflows.builder.selectingOutputNode":n?"workflows.builder.changeOutputNode":"workflows.builder.selectOutputNode")})});QW.displayName="SelectOutputNodeButton";const JW=u.memo(()=>{const{t:e}=A(),t=u.useCallback(()=>{na.set(!1),Ha.set(!1),Xo.set(null)},[]);return r.jsx(de,{leftIcon:r.jsx(Ot,{}),onClick:t,children:e("common.cancel")})});JW.displayName="CancelDeployButton";const eU=u.memo(()=>{const{t:e}=A(),t=ae(cle),n=ae(hd),s=fc(),i=I(mD),o=ae(Xo),a=ae(Ha),l=Ky(),c=I(_y),d=ae(vS),h=yD(),f=u.useCallback(async()=>{const p=await fs(()=>h(!0,!0));p.isErr()?(ge({id:"TOAST_PUBLISH_FAILED",status:"error",title:e("workflows.builder.publishFailed"),description:e("workflows.builder.publishFailedDesc"),duration:null}),h8.error({error:Un(p.error)},"Failed to enqueue batch")):(ge({id:"TOAST_PUBLISH_SUCCESSFUL",status:"success",title:e("workflows.builder.publishSuccess"),description:r.jsx(Ut,{i18nKey:"workflows.builder.publishSuccessDesc",components:{LinkComponent:r.jsx(vb,{href:d??""})}}),duration:null}),we(p.value.enqueueResult.batch.batch_id),we(p.value.batchConfig.validation_run_data),$0.set({batchId:p.value.enqueueResult.batch.batch_id,workflowId:p.value.batchConfig.validation_run_data.workflow_id}),h8.debug(Ci(p.value),"Enqueued batch"))},[h,d,e]);return r.jsx(h4,{isWorkflowSaved:!s,hasUnpublishableNodes:i,isReadyToEnqueue:n,hasOutputNode:o!==null&&!a,hasPublishableInputs:l.publishable.length>0,hasUnpublishableInputs:l.unpublishable.length>0,children:r.jsx(de,{leftIcon:r.jsx(vd,{}),isDisabled:!c||!n||s||i||!t||!(o!==null&&!a),onClick:f,children:e("workflows.builder.publish")})})});eU.displayName="DoValidationRunButton";const d4=u.memo(({nodeId:e,fieldName:t})=>{const n=Bg(e),s=WW(e),i=HW(e),o=X5e(e,t),a=GW(e,t),l=Jb(e);return r.jsxs(T,{flexDir:"column",position:"relative",p:2,borderRadius:"base",onMouseOver:n.handleMouseOver,onMouseOut:n.handleMouseOut,onClick:l,children:[r.jsx(q,{fontWeight:"semibold",children:`${s||i} -> ${o||a}`}),r.jsx(q,{variant:"subtext",children:`${e} -> ${t}`}),r.jsx(rx,{nodeId:e})]})});d4.displayName="NodeInputFieldPreview";const tU=u.memo(({nodeId:e,fieldName:t})=>{const n=Bg(e),s=WW(e),i=HW(e),o=ix(e,t),a=Jb(e);return r.jsxs(T,{flexDir:"column",position:"relative",p:2,borderRadius:"base",onMouseOver:n.handleMouseOver,onMouseOut:n.handleMouseOut,onClick:a,children:[r.jsx(q,{fontWeight:"semibold",children:`${s||i} -> ${o.title}`}),r.jsx(q,{variant:"subtext",children:`${e} -> ${t}`}),r.jsx(rx,{nodeId:e})]})});tU.displayName="NodeOutputFieldPreview";const nU=u.memo(()=>{const{t:e}=A(),t=I(_y),n=ae(hd),s=fc(),i=I(mD),o=Ky(),a=u.useCallback(()=>{na.set(!0)},[]);return r.jsx(h4,{isWorkflowSaved:!s,hasUnpublishableNodes:i,isReadyToEnqueue:n,hasOutputNode:!0,hasPublishableInputs:o.publishable.length>0,hasUnpublishableInputs:o.unpublishable.length>0,children:r.jsx(de,{onClick:a,leftIcon:r.jsx(vd,{}),variant:"ghost",size:"sm",isDisabled:!t||!n||s||i,children:e("workflows.builder.publish")})})});nU.displayName="StartPublishFlowButton";const h4=u.memo(({isWorkflowSaved:e,hasUnpublishableNodes:t,isReadyToEnqueue:n,hasOutputNode:s,hasPublishableInputs:i,hasUnpublishableInputs:o,children:a})=>{const{t:l}=A(),c=u.useMemo(()=>{const h=[];return i||h.push(l("workflows.builder.warningWorkflowHasNoPublishableInputFields")),o&&h.push(l("workflows.builder.warningWorkflowHasUnpublishableInputFields")),h},[i,o,l]),d=u.useMemo(()=>{const h=[];return e||h.push(l("workflows.builder.errorWorkflowHasUnsavedChanges")),t&&h.push(l("workflows.builder.errorWorkflowHasUnpublishableNodes")),n||h.push(l("workflows.builder.errorWorkflowHasInvalidGraph")),s||h.push(l("workflows.builder.errorWorkflowHasNoOutputNode")),h},[t,s,n,e,l]);return d.length===0&&c.length===0?a:r.jsx(Ee,{label:r.jsxs(T,{flexDir:"column",children:[d.length>0&&r.jsxs(r.Fragment,{children:[r.jsxs(q,{color:"error.700",fontWeight:"semibold",children:[l("workflows.builder.cannotPublish"),":"]}),r.jsx(or,{children:d.map((h,f)=>r.jsx(Rt,{children:h},f))})]}),c.length>0&&r.jsxs(r.Fragment,{children:[r.jsxs(q,{color:"warning.700",fontWeight:"semibold",children:[l("workflows.builder.publishWarnings"),":"]}),r.jsx(or,{children:c.map((h,f)=>r.jsx(Rt,{children:h},f))})]})]}),children:a})});h4.displayName="PublishTooltip";const J5e=({imageUrl:e,onChange:t})=>{const[n,s]=u.useState(null),i=u.useCallback(async h=>{if(!h){s(null);return}try{const f=await kb(h);if(f){const p=new File([f],"workflow.png",{type:"image/png"});s(p)}}catch{s(null)}},[]);u.useEffect(()=>{i(e)},[e,i]);const{t:o}=A(),a=u.useCallback(h=>{const f=h[0];f&&(s(f),t(URL.createObjectURL(f)))},[t]),l=u.useCallback(()=>{s(null),t(null)},[t]),{getInputProps:c,getRootProps:d}=sa({accept:{"image/png":[".png"],"image/jpeg":[".jpg",".jpeg",".png"]},onDropAccepted:a,noDrag:!0,multiple:!1});return n?r.jsxs(Se,{position:"relative",flexShrink:0,children:[r.jsx(Wt,{src:URL.createObjectURL(n),objectFit:"cover",objectPosition:"50% 50%",w:100,h:100,borderRadius:"base"}),r.jsx(oe,{position:"absolute",insetInlineEnd:0,insetBlockStart:0,onClick:l,"aria-label":o("stylePresets.deleteImage"),tooltip:o("stylePresets.deleteImage"),icon:r.jsx(ur,{}),size:"md",variant:"ghost"})]}):r.jsxs(r.Fragment,{children:[r.jsx(Ee,{label:o("stylePresets.uploadImage"),children:r.jsx(T,{as:de,w:100,h:100,opacity:.3,borderRadius:"base",alignItems:"center",justifyContent:"center",flexShrink:0,...d(),children:r.jsx(lt,{as:cg,w:8,h:8})})}),r.jsx("input",{...c()})]})},e6e=({workflowId:e,thumbnailUrl:t})=>{const{t:n}=A(),[s,i]=u.useState(null),[o,a]=u.useState(!1),[l,{isLoading:c}]=wse(),[d,{isLoading:h}]=Sse(),f=u.useCallback(g=>{i(g),a(!0)},[]),p=u.useCallback(async()=>{try{if(s){const g=await kb(s);if(!g)return;const m=new File([g],"workflow_thumbnail.png",{type:"image/png"});await l({workflow_id:e,image:m}).unwrap()}else await d(e).unwrap();a(!1),ge({status:"success",title:"Workflow thumbnail updated"})}catch{ge({status:"error",title:"Failed to update thumbnail"})}},[d,l,e,s]);return r.jsxs(T,{alignItems:"center",gap:4,children:[r.jsx(J5e,{imageUrl:t,onChange:f}),r.jsx(de,{size:"sm",isLoading:c||h,onClick:p,isDisabled:!o||!e,children:n("common.saveChanges")})]})},t6e=()=>{const e=I(py),t=I($y),n=I(vL),s=I(jse),i=I(kse),o=I(_se),a=I(Ise),l=I(Tse),c=G(),d=u.useCallback(C=>{c(ZM(C.target.value))},[c]),h=u.useCallback(C=>{c(Ase(C.target.value))},[c]),f=u.useCallback(C=>{c(Ese(C.target.value))},[c]),p=u.useCallback(C=>{c(Mse(C.target.value))},[c]),g=u.useCallback(C=>{c(Pse(C.target.value))},[c]),m=u.useCallback(C=>{c(Lse(C.target.value))},[c]),y=u.useCallback(C=>{c(Dse(C.target.value))},[c]),{t:b}=A();return r.jsx(os,{children:r.jsx(T,{flexDir:"column",alignItems:"flex-start",gap:2,h:"full",children:r.jsxs(ks,{orientation:"vertical",formControlProps:s6e,children:[r.jsxs(K,{children:[r.jsx(J,{children:b("nodes.workflowName")}),r.jsx(kt,{variant:"darkFilled",value:t,onChange:d})]}),r.jsx(r6e,{id:e}),r.jsxs(K,{children:[r.jsx(J,{children:b("nodes.workflowVersion")}),r.jsx(kt,{variant:"darkFilled",value:l,onChange:p})]}),r.jsxs(K,{children:[r.jsx(J,{children:b("nodes.workflowAuthor")}),r.jsx(kt,{variant:"darkFilled",value:i,onChange:h})]}),r.jsxs(K,{children:[r.jsx(J,{children:b("nodes.workflowContact")}),r.jsx(kt,{variant:"darkFilled",value:o,onChange:f})]}),r.jsxs(K,{children:[r.jsx(J,{children:b("nodes.workflowTags")}),r.jsx(kt,{variant:"darkFilled",value:a,onChange:m})]}),r.jsxs(K,{children:[r.jsx(J,{children:b("nodes.workflowDescription")}),r.jsx(ss,{variant:"darkFilled",onChange:g,value:n,fontSize:"sm",resize:"none",rows:3})]}),r.jsxs(K,{children:[r.jsx(J,{children:b("nodes.workflowNotes")}),r.jsx(ss,{variant:"darkFilled",onChange:y,value:s,fontSize:"sm",resize:"none",rows:10})]})]})})})},n6e=u.memo(t6e),s6e={flexShrink:0},r6e=({id:e})=>{const{t}=A(),{data:n}=N3(e??Xn);return n?n.workflow.meta.category==="default"&&n.thumbnail_url?r.jsxs(K,{children:[r.jsx(J,{children:t("workflows.workflowThumbnail")}),r.jsx(Se,{position:"relative",flexShrink:0,children:r.jsx(Wt,{src:n.thumbnail_url,objectFit:"cover",objectPosition:"50% 50%",w:100,h:100,borderRadius:"base"})})]}):n.workflow.meta.category!=="default"?r.jsxs(K,{children:[r.jsx(J,{children:t("workflows.workflowThumbnail")}),r.jsx(e6e,{thumbnailUrl:n.thumbnail_url,workflowId:n.workflow_id})]}):null:null},i6e=()=>{const e=ae(Rse),{t}=A();return r.jsx(T,{flexDir:"column",alignItems:"flex-start",gap:2,h:"full",children:r.jsx(yo,{data:e,label:t("nodes.workflow"),bg:"base.850",color:"base.200"})})},o6e=u.memo(i6e),a6e=()=>{const{t:e}=A(),t=I(_y);return r.jsxs(sc,{variant:"enclosed",display:"flex",w:"full",h:"full",flexDir:"column",children:[r.jsxs(rc,{children:[r.jsx(_n,{children:e("workflows.builder.builder")}),r.jsx(_n,{children:e("common.details")}),r.jsx(_n,{children:"JSON"}),r.jsx(it,{}),t&&r.jsx(nU,{})]}),r.jsxs(sd,{h:"full",pt:2,children:[r.jsx(Rn,{h:"full",p:0,children:r.jsx(VW,{})}),r.jsx(Rn,{h:"full",p:0,children:r.jsx(n6e,{})}),r.jsx(Rn,{h:"full",p:0,children:r.jsx(o6e,{})})]})]})},l6e=u.memo(a6e),c6e={height:"100%",width:"100%"},sU=u.memo(()=>{const e=u.useRef(null),t=u.useCallback(()=>{e.current&&e.current.setLayout([50,50])},[]);return r.jsx(Se,{position:"relative",w:"full",h:"full",children:r.jsxs(Eg,{ref:e,id:"workflow-panel-group",autoSaveId:"workflow-panel-group",direction:"vertical",style:c6e,children:[r.jsx(ao,{id:"workflow",collapsible:!0,minSize:25,children:r.jsx(l6e,{})}),r.jsx(D_,{onDoubleClick:t}),r.jsx(ao,{id:"inspector",collapsible:!0,minSize:25,children:r.jsx(n4e,{})})]})})});sU.displayName="EditModeLeftPanelContent";const u6e=e=>!!e.id&&e.meta.category!=="default",d6e=()=>{const{t:e}=A(),t=G(),n=JO(),[s,{isLoading:i,isError:o}]=Ose(),a=my(),l=u.useRef();return{saveWorkflow:u.useCallback(async d=>{l.current=a({title:e("workflows.savingWorkflow"),status:"loading",duration:null,isClosable:!1});try{await s(d).unwrap(),t(Nse()),t(YM({formFieldInitialValues:n()})),a.update(l.current,{title:e("workflows.workflowSaved"),status:"success",duration:1e3,isClosable:!0})}catch{a.isActive(`auth-error-toast-${va.endpoints.updateWorkflow.name}`)?a.close(l.current):a.update(l.current,{title:e("workflows.problemSavingWorkflow"),status:"error",duration:1e3,isClosable:!0})}},[a,e,t,n,s]),isLoading:i,isError:o}},ox=()=>{const e=qS(),t=bc(),{saveWorkflow:n}=d6e();return u.useCallback(()=>{const i=e();u6e(i)&&!t?n(i):eN(i)},[e,t,n])},rU=u.memo(()=>{const{t:e}=A(),t=ox(),[n]=Fse(),s=I(py),i=u.useCallback(async()=>{if(s)try{await n(s).unwrap(),ge({title:e("toast.workflowUnpublished"),status:"success"})}catch{ge({title:e("toast.problemUnpublishingWorkflow"),description:e("toast.problemUnpublishingWorkflowDescription"),status:"error"})}},[n,s,e]);return r.jsxs(T,{flexDir:"column",w:"full",h:"full",gap:2,alignItems:"center",children:[r.jsx(Ft,{size:"md",pt:32,children:e("workflows.builder.workflowLocked")}),r.jsx(q,{fontSize:"md",children:e("workflows.builder.publishedWorkflowsLocked")}),r.jsx(de,{size:"md",onClick:t,variant:"ghost",leftIcon:r.jsx(un,{}),children:e("common.saveAs")}),r.jsx(de,{size:"md",onClick:i,variant:"ghost",leftIcon:r.jsx(Qde,{}),children:e("workflows.builder.unpublish")})]})});rU.displayName="PublishedWorkflowPanelContent";const iU=u.memo(()=>{const e=I(vL);return e?r.jsx(Ee,{label:e,children:r.jsx(q,{color:"base.300",fontStyle:"italic",sx:$g,noOfLines:1,children:r.jsx(zg,{options:Vg,children:e})})}):null});iU.displayName="ActiveWorkflowDescription";const h6e=()=>{const e=ky(),{t}=A(),n=I($y);return r.jsx(de,{variant:"ghost",rightIcon:r.jsx(fhe,{}),size:"sm",onClick:e.open,children:r.jsx(q,{display:"auto",noOfLines:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",wordBreak:"break-all",children:n||t("workflows.chooseWorkflowFromLibrary")})})},oU=u.memo(()=>{const e=G(),t=I(Co),{t:n}=A(),s=u.useCallback(o=>{o.stopPropagation(),e(za("edit"))},[e]),i=u.useCallback(o=>{o.stopPropagation(),e(za("view"))},[e]);return t==="view"?r.jsx(oe,{"aria-label":n("nodes.editMode"),tooltip:n("nodes.editMode"),onClick:s,icon:r.jsx(phe,{}),variant:"ghost",size:"sm"}):r.jsx(oe,{"aria-label":n("nodes.viewMode"),tooltip:n("nodes.viewMode"),onClick:i,icon:r.jsx(yd,{}),variant:"ghost",size:"sm"})});oU.displayName="WorkflowViewEditToggleButton";const f6e=()=>{const e=G(),t=qS();return u.useCallback(()=>{const s=t(),i=new Blob([JSON.stringify(s,null,2)]),o=document.createElement("a");o.href=URL.createObjectURL(i),o.download=`${s.name||"My Workflow"}.json`,document.body.appendChild(o),o.click(),o.remove(),e(qM())},[t,e])},p6e=()=>{const{t:e}=A(),t=f6e();return r.jsx(pe,{as:"button",icon:r.jsx(md,{}),onClick:t,children:e("workflows.downloadWorkflow")})},g6e=u.memo(p6e),m6e=()=>{const{t:e}=A(),t=ae(sn),{onOpen:n}=QO();return r.jsx(pe,{as:"button",icon:r.jsx(Fj,{}),onClick:n,isDisabled:!tS(t),children:e("workflows.loadFromGraph")})},y6e=u.memo(m6e),aU=u.memo(()=>{const{t:e}=A(),t=bk();return r.jsx(pe,{as:"button",icon:r.jsx(ep,{}),onClick:t.createWithDialog,children:e("nodes.newWorkflow")})});aU.displayName="NewWorkflowMenuItem";const b6e=()=>{const{t:e}=A(),t=qS(),n=u.useCallback(s=>{s.stopPropagation();const i=t();eN(i)},[t]);return r.jsx(pe,{as:"button",icon:r.jsx(un,{}),onClick:n,children:e("workflows.saveWorkflowAs")})},x6e=u.memo(b6e),v6e=()=>{const{t:e}=A(),t=ox(),n=fc(),s=bc();return r.jsx(pe,{as:"button",isDisabled:!n||!!s,icon:r.jsx(so,{}),onClick:t,children:e("workflows.saveWorkflow")})},C6e=u.memo(v6e),w6e=()=>{const{t:e}=A(),t=Xa(),n=u.useCallback(([o])=>{o&&t({type:"file",data:o})},[t]),{getRootProps:s,getInputProps:i}=sa({accept:{"application/json":[".json"]},onDropAccepted:n,noDrag:!0,multiple:!1});return r.jsxs(pe,{as:"button",icon:r.jsx(cg,{}),...s(),children:[e("workflows.uploadWorkflow"),r.jsx("input",{...i()})]})},S6e=u.memo(w6e),lU=u.memo(()=>{const{t:e}=A(),{isOpen:t,onOpen:n,onClose:s}=cr(),i=tl();return Bp(s),r.jsxs(en,{isOpen:t,onOpen:n,onClose:s,children:[r.jsx(tn,{as:oe,"aria-label":e("workflows.workflowEditorMenu"),icon:r.jsx(Gj,{}),pointerEvents:"auto",size:"sm",variant:"ghost"}),r.jsxs(Tt,{pointerEvents:"auto",children:[r.jsx(aU,{}),r.jsx(S6e,{}),r.jsx(Es,{}),r.jsx(C6e,{}),r.jsx(x6e,{}),r.jsx(g6e,{}),i&&r.jsx(Es,{}),i&&r.jsx(y6e,{})]})]})});lU.displayName="WorkflowLibraryMenu";const j6e=()=>{const{t:e}=A(),t=ox();return r.jsx(oe,{tooltip:e("workflows.saveWorkflow"),"aria-label":e("workflows.saveWorkflow"),icon:r.jsx(so,{}),onClick:t,pointerEvents:"auto",variant:"ghost",size:"sm"})},k6e=u.memo(j6e),cU=u.memo(()=>{const e=I(Co),t=bc();return r.jsxs(T,{w:"full",alignItems:"center",gap:1,minW:0,children:[r.jsx(h6e,{}),r.jsx(it,{}),e==="edit"&&!t&&r.jsx(k6e,{}),r.jsx(oU,{}),r.jsx(lU,{})]})});cU.displayName="ActiveWorkflowNameAndActions";const _6e=()=>{const e=Bse();return r.jsx(T,{w:"full",h:"full",userSelect:"none",justifyContent:"center",children:r.jsxs(T,{alignItems:"center",justifyContent:"center",borderRadius:"base",flexDir:"column",gap:5,maxW:"230px",pt:24,children:[r.jsx(Wt,{src:SS,alt:"invoke-ai-logo",opacity:.2,mixBlendMode:"overlay",w:16,h:16,minW:16,minH:16,userSelect:"none"}),e?r.jsx(I6e,{}):r.jsx(T6e,{})]})})},I6e=()=>{const{t:e}=A(),t=G(),n=ky(),s=u.useCallback(()=>{t(za("edit"))},[t]);return r.jsxs(r.Fragment,{children:[r.jsxs(T,{gap:2,children:[r.jsx(de,{size:"sm",onClick:s,children:e("nodes.newWorkflow")}),r.jsx(de,{size:"sm",colorScheme:"invokeBlue",onClick:n.open,children:e("nodes.loadWorkflow")})]}),r.jsx(q,{textAlign:"center",fontSize:"md",children:r.jsx(Ut,{i18nKey:"nodes.workflowHelpText",size:"sm",components:A6e})})]})},T6e=()=>{const{t:e}=A(),t=G(),n=u.useCallback(()=>{t(za("edit"))},[t]);return r.jsxs(r.Fragment,{children:[r.jsx(q,{textAlign:"center",fontSize:"md",children:e("nodes.noFieldsViewMode")}),r.jsx(de,{size:"sm",colorScheme:"invokeBlue",onClick:n,children:e("nodes.edit")})]})},A6e={LinkComponent:r.jsx(by,{fontSize:"md",fontWeight:"semibold",href:"https://support.invoke.ai/support/solutions/articles/151000159663-example-workflows",target:"_blank"})},uU=u.memo(()=>r.jsx(Se,{position:"relative",w:"full",h:"full",children:r.jsx(os,{children:r.jsx(dU,{})})}));uU.displayName="ViewModeLeftPanelContent";const dU=u.memo(()=>{const{isLoading:e}=vy(),t=ae(Mp),n=I(xL);return e||!t?r.jsx(Pt,{label:Pe("nodes.loadingNodes"),icon:null}):n?r.jsx(_6e,{}):r.jsx(T,{w:"full",justifyContent:"center",children:r.jsx(OW,{})})});dU.displayName=" ViewModeLeftPanelContentInner";const E6e=()=>{const e=I(Co),t=bc(),n=ae(na);return r.jsxs(T,{w:"full",h:"full",gap:2,flexDir:"column",children:[n&&r.jsx(qW,{}),!n&&r.jsx(cU,{}),!n&&!t&&e==="view"&&r.jsx(iU,{}),!n&&!t&&e==="view"&&r.jsx(uU,{}),!n&&!t&&e==="edit"&&r.jsx(sU,{}),t&&r.jsx(rU,{})]})},M6e=u.memo(E6e),hU=u.memo(()=>{const e=Bt("cancelAndClearAll");return tl()?e?r.jsx(pU,{}):r.jsx(gU,{}):r.jsx(fU,{})});hU.displayName="ClearQueueIconButton";const fU=u.memo(()=>{const{t:e}=A(),t=qy();return r.jsx(oe,{size:"lg",isDisabled:t.isDisabled,isLoading:t.isLoading,"aria-label":e("queue.cancel"),tooltip:e("queue.cancelTooltip"),icon:r.jsx(Ot,{}),colorScheme:"error",onClick:t.cancelQueueItem})});fU.displayName="CancelCurrentIconButton";const pU=u.memo(()=>{const{t:e}=A(),t=yg();return r.jsx(oe,{size:"lg",isDisabled:t.isDisabled,isLoading:t.isLoading,"aria-label":e("queue.clear"),tooltip:e("queue.clearTooltip"),icon:r.jsx(ri,{}),colorScheme:"error",onClick:t.openDialog})});pU.displayName="CancelAndClearAllIconButton";const gU=u.memo(()=>{const{t:e}=A(),t=mg();return r.jsx(oe,{size:"lg",isDisabled:t.isDisabled,isLoading:t.isLoading,"aria-label":e("queue.clear"),tooltip:e("queue.cancelAllExceptCurrentTooltip"),icon:r.jsx(fb,{}),colorScheme:"error",onClick:t.openDialog})});gU.displayName="CancelAllExceptCurrentIconButton";const mU=u.memo(({targetRef:e})=>{const[t,n]=u.useState(null),s=ae(W2),{queueSize:i}=oi(void 0,{selectFromResult:o=>({queueSize:o.data?o.data.queue.pending+o.data.queue.in_progress:0})});return u.useEffect(()=>{if(!e.current)return;const o=e.current,a=o.parentElement;if(!a)return;const l=()=>{if(!W2.get())return;const{x:d,y:h}=o.getBoundingClientRect();n({x:`${d-7}px`,y:`${h-5}px`})},c=new ResizeObserver(l);return c.observe(a),l(),()=>{c.disconnect()}},[e]),i===0||!t||!s?null:r.jsx(hc,{children:r.jsx(Kn,{pos:"absolute",insetInlineStart:t.x,insetBlockStart:t.y,colorScheme:"invokeYellow",zIndex:"docked",shadow:"dark-lg",userSelect:"none",children:i})})});mU.displayName="QueueCountBadge";const yU=()=>{const{t:e}=A(),t=ae(Yn),{data:n}=oi(),[s,{isLoading:i}]=WP({fixedCacheKey:"pauseProcessor"}),o=u.useMemo(()=>!!(n!=null&&n.processor.is_started),[n==null?void 0:n.processor.is_started]),a=u.useCallback(async()=>{if(o)try{await s().unwrap(),ge({id:"PAUSE_SUCCEEDED",title:e("queue.pauseSucceeded"),status:"success"})}catch{ge({id:"PAUSE_FAILED",title:e("queue.pauseFailed"),status:"error"})}},[o,s,e]),l=u.useMemo(()=>!t||!o,[t,o]);return{pauseProcessor:a,isLoading:i,isStarted:o,isDisabled:l}},bU=()=>{const e=ae(Yn),{data:t}=oi(),{t:n}=A(),[s,{isLoading:i}]=HP({fixedCacheKey:"resumeProcessor"}),o=u.useMemo(()=>!!(t!=null&&t.processor.is_started),[t==null?void 0:t.processor.is_started]),a=u.useCallback(async()=>{if(!o)try{await s().unwrap(),ge({id:"PROCESSOR_RESUMED",title:n("queue.resumeSucceeded"),status:"success"})}catch{ge({id:"PROCESSOR_RESUME_FAILED",title:n("queue.resumeFailed"),status:"error"})}},[o,s,n]),l=u.useMemo(()=>!e||o,[e,o]);return{resumeProcessor:a,isLoading:i,isStarted:o,isDisabled:l}},xU=u.memo(()=>{const e=u.useRef(null),t=G(),{t:n}=A(),s=Bt("pauseQueue"),i=Bt("resumeQueue"),o=Bt("cancelAndClearAll"),a=mg(),l=qy(),c=yg(),{resumeProcessor:d,isLoading:h,isDisabled:f}=bU(),{pauseProcessor:p,isLoading:g,isDisabled:m}=yU(),y=u.useCallback(()=>{t(Qt("queue"))},[t]);return r.jsxs(r.Fragment,{children:[r.jsxs(en,{placement:"bottom-end",children:[r.jsx(tn,{ref:e,as:oe,size:"lg","aria-label":"Queue Actions Menu",icon:r.jsx(Yde,{})}),r.jsxs(Tt,{children:[r.jsx(Sr,{title:n("common.new"),children:r.jsx(v_,{})}),r.jsxs(Sr,{title:n("queue.queue"),children:[r.jsx(pe,{isDestructive:!0,icon:r.jsx(Ot,{}),onClick:l.cancelQueueItem,isLoading:l.isLoading,isDisabled:l.isDisabled,children:n("queue.cancelTooltip")}),r.jsx(pe,{isDestructive:!0,icon:r.jsx(fb,{}),onClick:a.openDialog,isLoading:a.isLoading,isDisabled:a.isDisabled,children:n("queue.cancelAllExceptCurrentTooltip")}),o&&r.jsx(pe,{isDestructive:!0,icon:r.jsx(ri,{}),onClick:c.openDialog,isLoading:c.isLoading,isDisabled:c.isDisabled,children:n("queue.clearTooltip")}),i&&r.jsx(pe,{icon:r.jsx(l7,{}),onClick:d,isLoading:h,isDisabled:f,children:n("queue.resumeTooltip")}),s&&r.jsx(pe,{icon:r.jsx(a7,{}),onClick:p,isLoading:g,isDisabled:m,children:n("queue.pauseTooltip")}),r.jsx(pe,{icon:r.jsx(e7,{}),onClick:y,children:n("queue.openQueue")})]})]})]}),r.jsx(mU,{targetRef:e})]})});xU.displayName="QueueActionsMenuButton";const P6e=e=>({bg:"base.700",w:"72px",cursor:"pointer","&[data-checked]":{".thumb":{left:`calc(100% - ${e})`,transform:"translateX(-100%)",bg:"invokeGreen.300"},".unchecked-icon":{color:"base.50",opacity:.4},".checked-icon":{color:"base.900",opacity:1}},"&[data-disabled]":{bg:"base.700",".thumb":{bg:"base.500"},".unchecked-icon":{color:"base.800"},".checked-icon":{color:"base.800"}},".thumb":{transition:"left 0.1s ease-in-out, transform 0.1s ease-in-out",left:e,transform:"translateX(0)",bg:"invokeBlue.400",shadow:"md"},".unchecked-icon":{color:"base.900",opacity:1},".checked-icon":{color:"base.50",opacity:.4}}),vU=u.memo(()=>{const{t:e}=A(),t=G(),n=I(KS),s=I(Fn),i=PS("space",1),o=u.useMemo(()=>P6e(i),[i]),a=u.useCallback(h=>{t($se(h.target.checked))},[t]),{getCheckboxProps:l,getInputProps:c,htmlProps:d}=Vse({onChange:a,isChecked:n,isDisabled:s});return r.jsxs(rs,{trigger:"hover",children:[r.jsx(gs,{children:r.jsx(vo.label,{...d,children:r.jsxs(T,{position:"relative",borderRadius:"base",alignItems:"center",justifyContent:"space-between",h:"full",p:i,gap:i,sx:o,...l(),children:[r.jsx("input",{...c(),hidden:!0}),r.jsx(Se,{className:"thumb",position:"absolute",borderRadius:"base",w:10,top:i,bottom:i}),r.jsx(T,{w:10,h:"full",alignItems:"center",justifyContent:"center",pos:"relative",children:r.jsx(lt,{className:"unchecked-icon",w:6,h:6,as:Gu,"aria-label":e("controlLayers.sendToGallery")})}),r.jsx(T,{w:10,h:"full",alignItems:"center",justifyContent:"center",pos:"relative",children:r.jsx(lt,{className:"checked-icon",w:6,h:6,as:Bj,"aria-label":e("controlLayers.sendToCanvas")})})]})})}),r.jsx(hc,{children:r.jsxs(is,{maxW:296,p:2,bg:"base.200",color:"base.800",children:[r.jsx(Li,{bg:"base.200",left:n?"18px !important":"-18px !important",transitionProperty:"all",transitionDuration:"0.2s"}),r.jsx(ms,{children:r.jsx(CU,{})})]})})]})});vU.displayName="SendToToggle";const CU=u.memo(()=>{const{t:e}=A(),t=I(KS);return I(Fn)?r.jsxs(T,{flexDir:"column",children:[r.jsx(q,{fontWeight:"semibold",children:e("controlLayers.sendingToCanvas")}),r.jsx(q,{fontWeight:"normal",children:r.jsx(Ut,{i18nKey:"controlLayers.viewProgressOnCanvas",components:{Btn:r.jsx(wU,{})}})})]}):r.jsxs(T,{flexDir:"column",children:[r.jsx(q,{fontWeight:"semibold",children:e(t?"controlLayers.sendToCanvas":"controlLayers.sendToGallery")}),r.jsx(q,{fontWeight:"normal",children:e(t?"controlLayers.sendToCanvasDesc":"controlLayers.sendToGalleryDesc")})]})});CU.displayName="TooltipContent";const wU=u.memo(e=>{const t=G(),n=u.useCallback(()=>{t(Qt("canvas")),t(jr("layers")),fS.set(!1)},[t]);return r.jsx(de,{onClick:n,size:"sm",variant:"link",color:"base.800",_hover:{color:"base.900",textDecoration:"underline"},children:e.children})});wU.displayName="ActivateCanvasButton";const L6e=()=>{const{t:e}=A(),t=kk(),{data:n}=oi(),s=ae(Yn),i=ae(Bo),o=u.useMemo(()=>i?(i.percentage??0)*100:0,[i]),a=u.useMemo(()=>!s||!(n!=null&&n.queue.in_progress)?!1:!i||i.percentage===null,[s,i,n==null?void 0:n.queue.in_progress]),l=u.useMemo(()=>t==="canvas"?"invokeGreen":t==="gallery"?"invokeBlue":"base",[t]);return r.jsx(yM,{value:o,"aria-label":e("accessibility.invokeProgressBar"),isIndeterminate:a,h:2,w:"full",colorScheme:l})},D6e=u.memo(L6e),SU=u.memo(()=>{const e=I(ZS),t=I(zse),n=G(),s=u.useCallback(i=>{n(Gse(i))},[n]);return r.jsx(ze,{feature:"paramIterations",children:r.jsx(Ie,{step:t.coarseStep,fineStep:t.fineStep,min:1,max:999,onChange:s,value:e,defaultValue:1,pos:"absolute",insetInlineEnd:0,h:"full",ps:0,w:"72px",flexShrink:0,variant:"iterations"})})});SU.displayName="QueueIterationsNumberInput";const jU=({prepend:e,children:t,...n})=>r.jsx(Ee,{label:r.jsx(kU,{prepend:e}),maxW:512,...n,children:t}),kU=u.memo(({prepend:e=!1})=>{const t=I(An);return t==="canvas"?r.jsx(_U,{prepend:e}):t==="workflows"?r.jsx(TU,{prepend:e}):t==="upscaling"?r.jsx(IU,{prepend:e}):null});kU.displayName="TooltipContent";const _U=u.memo(({prepend:e=!1})=>{const t=ae(hd),n=ae(Pa);return r.jsxs(T,{flexDir:"column",gap:1,children:[r.jsx(ax,{isReady:t,prepend:e}),r.jsx(f4,{}),n.length>0&&r.jsxs(r.Fragment,{children:[r.jsx(gp,{}),r.jsx(lx,{reasons:n})]}),r.jsx(gp,{}),r.jsx(MU,{})]})});_U.displayName="CanvasTabTooltipContent";const IU=u.memo(({prepend:e=!1})=>{const t=ae(hd),n=ae(Pa);return r.jsxs(T,{flexDir:"column",gap:1,children:[r.jsx(ax,{isReady:t,prepend:e}),r.jsx(f4,{}),n.length>0&&r.jsxs(r.Fragment,{children:[r.jsx(gp,{}),r.jsx(lx,{reasons:n})]})]})});IU.displayName="UpscaleTabTooltipContent";const TU=u.memo(({prepend:e=!1})=>{const t=ae(hd),n=ae(Pa);return r.jsxs(T,{flexDir:"column",gap:1,children:[r.jsx(ax,{isReady:t,prepend:e}),r.jsx(AU,{}),n.length>0&&r.jsxs(r.Fragment,{children:[r.jsx(gp,{}),r.jsx(lx,{reasons:n})]})]})});TU.displayName="WorkflowsTabTooltipContent";const f4=u.memo(()=>{const{t:e}=A(),t=I(Ile),n=I(ZS),s=u.useMemo(()=>{const i=Math.min(t*n,1e4),o=e("queue.prompts",{count:t}),a=e("queue.iterations",{count:n}),l=e("queue.generations",{count:i});return`${t} ${o}  ${n} ${a} -> ${i} ${l}`.toLowerCase()},[n,t,e]);return r.jsx(q,{children:s})});f4.displayName="QueueCountPredictionCanvasOrUpscaleTab";const AU=u.memo(()=>{const{t:e}=A(),t=G(),n=I(Qe),[s,i]=u.useState("LOADING"),o=u.useMemo(()=>ii(async c=>{i("LOADING");const d=await ple(c,t);i(d)},300),[t]);u.useEffect(()=>{o(n)},[o,n]);const a=I(ZS),l=u.useMemo(()=>{if(s==="LOADING")return`${e("common.loading")}...`;const c=e("queue.iterations",{count:a});if(s==="NO_BATCHES"){const f=Math.min(1e4,a),p=e("queue.generations",{count:f});return`${a} ${c} -> ${f} ${p}`.toLowerCase()}if(s==="EMPTY_BATCHES")return e("parameters.invoke.batchNodeEmptyCollection");if(s==="MISMATCHED_BATCH_GROUP")return e("parameters.invoke.batchNodeCollectionSizeMismatchNoGroupId");const d=Math.min(s*a,1e4),h=e("queue.generations",{count:d});return`${s} ${e("queue.batchSize")}  ${a} ${c} -> ${d} ${h}`.toLowerCase()},[s,a,e]);return r.jsx(q,{children:l})});AU.displayName="QueueCountPredictionWorkflowsTab";const ax=u.memo(({isReady:e,prepend:t})=>{const{t:n}=A(),s=I(jy),[i,o]=eS(kp),a=ae(na),l=bc(),c=u.useMemo(()=>o.isLoading?n("queue.enqueueing"):n(s?"dynamicPrompts.loading":a?"workflows.builder.publishInProgress":l?"workflows.builder.publishedWorkflowIsLocked":e?t?"queue.queueFront":"queue.queueBack":"queue.notReady"),[o.isLoading,s,a,l,e,n,t]);return r.jsx(q,{fontWeight:"semibold",children:c})});ax.displayName="IsReadyText";const lx=u.memo(({reasons:e})=>r.jsx(or,{children:e.map((t,n)=>r.jsx(EU,{reason:t},`${t.content}.${n}`))}));lx.displayName="ReasonsList";const EU=u.memo(({reason:e})=>r.jsx(Rt,{children:r.jsxs("span",{children:[e.prefix&&r.jsxs(q,{as:"span",fontWeight:"semibold",children:[e.prefix,":"," "]}),r.jsx(q,{as:"span",children:e.content})]})}));EU.displayName="ReasonListItem";const gp=u.memo(()=>r.jsx(wt,{opacity:.2,borderColor:"base.900"}));gp.displayName="StyledDivider";const MU=u.memo(()=>{const{t:e}=A(),t=I(KS),n=I(Hs),s=pg(n),i=u.useMemo(()=>e(t?"controlLayers.stagingOnCanvas":"parameters.invoke.addingImagesTo"),[t,e]),o=u.useMemo(()=>t?e("queue.canvas"):s||e("boards.uncategorized"),[s,t,e]);return r.jsxs(q,{fontStyle:"oblique 10deg",children:[i," ",r.jsx(q,{as:"span",fontWeight:"semibold",children:o})]})});MU.displayName="AddingToText";const f8="Invoke",PU=u.memo(()=>{const e=hj(),t=tl(),n=I(jy);return r.jsxs(T,{pos:"relative",w:"200px",children:[r.jsx(SU,{}),r.jsx(jU,{prepend:t,children:r.jsxs(de,{onClick:t?e.enqueueFront:e.enqueueBack,isLoading:e.isLoading||n,loadingText:f8,isDisabled:e.isDisabled,rightIcon:t?r.jsx(vd,{}):r.jsx(ub,{}),variant:"solid",colorScheme:"invokeYellow",size:"lg",w:"calc(100% - 60px)",flexShrink:0,justifyContent:"space-between",spinnerPlacement:"end",children:[r.jsx("span",{children:f8}),r.jsx(it,{})]})})]})});PU.displayName="InvokeQueueBackButton";const R6e=()=>{const e=I(An);return r.jsxs(T,{w:"full",position:"relative",borderRadius:"base",gap:2,flexDir:"column",children:[r.jsxs(T,{gap:2,children:[r.jsx(PU,{}),r.jsx(it,{}),e==="canvas"&&r.jsx(Ki,{children:r.jsx(vU,{})}),r.jsx(xU,{}),r.jsx(hU,{})]}),r.jsx(D6e,{})]})},O6e=u.memo(R6e),N6e=e=>{const{t}=A();return r.jsx(T,{pos:"absolute",transform:"translate(0, -50%)",minW:8,top:"50%",insetInlineEnd:2,children:r.jsx(Ee,{label:t("accessibility.toggleRightPanel"),placement:"start",children:r.jsx(oe,{"aria-label":t("accessibility.toggleRightPanel"),onClick:e.panelApi.toggle,icon:r.jsx(Wde,{}),h:48})})})},F6e=u.memo(N6e),LU=u.memo(()=>{const{t:e}=A(),t=wc("bbox"),n=oa("bbox"),s=Nt();return Re({id:"selectBboxTool",category:"canvas",callback:t,options:{enabled:!n&&!s.isOpen},dependencies:[t,n,s.isOpen]}),r.jsx(Ee,{label:`${e("controlLayers.tool.bbox")} (C)`,placement:"end",children:r.jsx(oe,{"aria-label":`${e("controlLayers.tool.bbox")} (C)`,icon:r.jsx(rl,{}),colorScheme:n?"invokeBlue":"base",variant:"solid",onClick:t})})});LU.displayName="ToolBboxButton";const DU=u.memo(()=>{const{t:e}=A(),t=oa("brush"),n=wc("brush"),s=Nt();return Re({id:"selectBrushTool",category:"canvas",callback:n,options:{enabled:!t&&!s.isOpen},dependencies:[t,n,s.isOpen]}),r.jsx(Ee,{label:`${e("controlLayers.tool.brush")} (B)`,placement:"end",children:r.jsx(oe,{"aria-label":`${e("controlLayers.tool.brush")} (B)`,icon:r.jsx(Bj,{}),colorScheme:t?"invokeBlue":"base",variant:"solid",onClick:n})})});DU.displayName="ToolBrushButton";const RU=u.memo(()=>{const{t:e}=A(),t=oa("colorPicker"),n=wc("colorPicker"),s=Nt();return Re({id:"selectColorPickerTool",category:"canvas",callback:n,options:{enabled:!t&&!s.isOpen},dependencies:[n,t,s.isOpen]}),r.jsx(Ee,{label:`${e("controlLayers.tool.colorPicker")} (I)`,placement:"end",children:r.jsx(oe,{"aria-label":`${e("controlLayers.tool.colorPicker")} (I)`,icon:r.jsx($de,{}),colorScheme:t?"invokeBlue":"base",variant:"solid",onClick:n})})});RU.displayName="ToolColorPickerButton";const OU=u.memo(()=>{const{t:e}=A(),t=oa("move"),n=wc("move"),s=Nt();return Re({id:"selectMoveTool",category:"canvas",callback:n,options:{enabled:!t&&!s.isOpen},dependencies:[t,n,s.isOpen]}),r.jsx(Ee,{label:`${e("controlLayers.tool.move")} (V)`,placement:"end",children:r.jsx(oe,{"aria-label":`${e("controlLayers.tool.move")} (V)`,icon:r.jsx(Rde,{}),colorScheme:t?"invokeBlue":"base",variant:"solid",onClick:n})})});OU.displayName="ToolMoveButton";const NU=u.memo(()=>{const{t:e}=A(),t=oa("rect"),n=wc("rect"),s=Nt();return Re({id:"selectRectTool",category:"canvas",callback:n,options:{enabled:!t&&!s.isOpen},dependencies:[t,n,s.isOpen]}),r.jsx(Ee,{label:`${e("controlLayers.tool.rectangle")} (U)`,placement:"end",children:r.jsx(oe,{"aria-label":`${e("controlLayers.tool.rectangle")} (U)`,icon:r.jsx(the,{}),colorScheme:t?"invokeBlue":"base",variant:"solid",onClick:n})})});NU.displayName="ToolRectButton";const FU=u.memo(()=>{const{t:e}=A(),t=oa("eraser"),n=wc("eraser"),s=Nt();return Re({id:"selectEraserTool",category:"canvas",callback:n,options:{enabled:!t&&!s.isOpen},dependencies:[t,n,s.isOpen]}),r.jsx(Ee,{label:`${e("controlLayers.tool.eraser")} (E)`,placement:"end",children:r.jsx(oe,{"aria-label":`${e("controlLayers.tool.eraser")} (E)`,icon:r.jsx(Nde,{}),colorScheme:t?"invokeBlue":"base",variant:"solid",onClick:n})})});FU.displayName="ToolEraserButton";const BU=u.memo(()=>{const{t:e}=A(),t=oa("view"),n=wc("view"),s=Nt();return Re({id:"selectViewTool",category:"canvas",callback:n,options:{enabled:!t&&!s.isOpen},dependencies:[n,t,s.isOpen]}),r.jsx(Ee,{label:`${e("controlLayers.tool.view")} (H)`,placement:"end",children:r.jsx(oe,{"aria-label":`${e("controlLayers.tool.view")} (H)`,icon:r.jsx(Gde,{}),colorScheme:t?"invokeBlue":"base",variant:"solid",onClick:n})})});BU.displayName="ToolViewButton";const B6e=()=>r.jsx(r.Fragment,{children:r.jsxs(Zn,{isAttached:!0,orientation:"vertical",children:[r.jsx(DU,{}),r.jsx(FU,{}),r.jsx(NU,{}),r.jsx(OU,{}),r.jsx(BU,{}),r.jsx(LU,{}),r.jsx(RU,{})]})}),$6e=({togglePanel:e})=>{const{t}=A(),n=I(An),s=Nt(),i=Bt("cancelAndClearAll");return r.jsxs(T,{pos:"absolute",transform:"translate(0, -50%)",top:"50%",insetInlineStart:2,direction:"column",gap:2,children:[n==="canvas"&&!s.isOpen&&r.jsx(Ki,{children:r.jsx(B6e,{})}),r.jsxs(Zn,{orientation:"vertical",h:48,children:[r.jsx(Ee,{label:t("accessibility.toggleLeftPanel"),placement:"end",children:r.jsx(oe,{"aria-label":t("accessibility.toggleLeftPanel"),onClick:e,icon:r.jsx(ohe,{}),flexGrow:1})}),r.jsx($U,{}),r.jsx(VU,{}),i&&r.jsx(zU,{}),!i&&r.jsx(GU,{})]})]})},V6e=u.memo($6e),$U=u.memo(()=>{const{t:e}=A(),t=hj(),n=tl(),{data:s}=oi(),i=u.useMemo(()=>{const o=((s==null?void 0:s.queue.in_progress)??0)>0;return!t.isDisabled&&o?r.jsx(lt,{boxSize:6,as:Pde,animation:Vy}):n?r.jsx(vd,{}):r.jsx(ub,{})},[t.isDisabled,s==null?void 0:s.queue.in_progress,n]);return r.jsx(jU,{prepend:n,placement:"end",children:r.jsx(oe,{"aria-label":e("queue.queueBack"),onClick:n?t.enqueueFront:t.enqueueBack,isLoading:t.isLoading,isDisabled:t.isDisabled,icon:i,colorScheme:"invokeYellow",flexGrow:1})})});$U.displayName="InvokeIconButton";const VU=u.memo(()=>{const{t:e}=A(),t=qy();return r.jsx(Ee,{label:e("queue.cancelTooltip"),placement:"end",children:r.jsx(oe,{isDisabled:t.isDisabled,isLoading:t.isLoading,"aria-label":e("queue.cancelTooltip"),icon:r.jsx(Ot,{}),onClick:t.cancelQueueItem,colorScheme:"error",flexGrow:1})})});VU.displayName="CancelCurrentIconButton";const zU=u.memo(()=>{const{t:e}=A(),t=yg();return r.jsx(Ee,{label:e("queue.clearTooltip"),placement:"end",children:r.jsx(oe,{isDisabled:t.isDisabled,isLoading:t.isLoading,"aria-label":e("queue.clearTooltip"),icon:r.jsx(ri,{}),colorScheme:"error",onClick:t.openDialog,flexGrow:1})})});zU.displayName="CancelAndClearAllIconButton";const GU=u.memo(()=>{const{t:e}=A(),t=mg();return r.jsx(Ee,{label:e("queue.cancelAllExceptCurrentTooltip"),placement:"end",children:r.jsx(oe,{isDisabled:t.isDisabled,isLoading:t.isLoading,"aria-label":e("queue.clear"),icon:r.jsx(fb,{}),colorScheme:"error",onClick:t.openDialog,flexGrow:1})})});GU.displayName="CancelAllExceptCurrentIconButton";const Wg=({label:e})=>r.jsx(q,{variant:"subtext",fontWeight:"semibold",pos:"absolute",top:1,left:2,children:e}),Ug=u.memo(e=>r.jsx(T,{pos:"absolute",insetBlockStart:0,insetInlineEnd:0,flexDir:"column",p:2,gap:2,alignItems:"center",justifyContent:"center",children:e.children}));Ug.displayName="PromptOverlayButtonWrapper";const z6e=(e,t)=>{if(!t||!t.length)return["",e,""];if(!t.includes(Bl))return["",`${e} `,t];const[n,...s]=t.split(Bl);return[n||"",e,s.join(Bl)||""]},HU=({presetPrompt:e,prompt:t,label:n})=>{const s=G(),{t:i}=A(),o=u.useMemo(()=>z6e(t,e),[e,t]),a=u.useCallback(()=>{s(o0(!1))},[s]);return r.jsx(Se,{position:"absolute",top:0,bottom:0,left:0,right:0,layerStyle:"second",borderRadius:"base",children:r.jsxs(T,{flexDir:"column",onClick:a,justifyContent:"space-between",h:"full",borderWidth:1,borderTopWidth:24,borderColor:"transparent",paddingInlineEnd:10,paddingInlineStart:3,paddingTop:0,paddingBottom:3,children:[r.jsx(Wg,{label:n}),r.jsx(T,{overflow:"scroll",children:r.jsx(q,{w:"full",lineHeight:"short",children:o.map((l,c)=>r.jsx(q,{as:"span",color:c===1?"white":"base.200",fontWeight:c===1?"semibold":"normal",children:l},c))})}),r.jsx(Ee,{label:i("stylePresets.viewModeTooltip"),children:r.jsx(T,{position:"absolute",insetInlineEnd:0,insetBlockStart:0,alignItems:"center",justifyContent:"center",p:2,bg:"base.900",opacity:.8,backgroundClip:"border-box",borderBottomStartRadius:"base",children:r.jsx(lt,{as:yd,color:"base.500",boxSize:4})})})]})})},WU=u.memo(()=>{var m;const e=G(),t=I(eP),n=I(YS),s=I(Ep),{activeStylePreset:i}=Yp(void 0,{selectFromResult:({data:y})=>{let b=null;return y&&(b=y.find(C=>C.id===s)),{activeStylePreset:b}}}),o=u.useRef(null),{t:a}=A(),l=u.useCallback(y=>{e(CL(y))},[e]),{onChange:c,isOpen:d,onClose:h,onOpen:f,onSelect:p,onKeyDown:g}=$d({prompt:t,textareaRef:o,onChange:l});return r.jsx(kc,{isOpen:d,onClose:h,onSelect:p,width:(m=o.current)==null?void 0:m.clientWidth,children:r.jsxs(Se,{pos:"relative",w:"full",children:[r.jsx(ss,{id:"negativePrompt",name:"negativePrompt",ref:o,value:t,onChange:c,onKeyDown:g,fontSize:"sm",variant:"darkFilled",minH:28,borderTopWidth:24,paddingInlineEnd:10,paddingInlineStart:3,paddingTop:0,paddingBottom:3}),r.jsx(Ug,{children:r.jsx(jc,{isOpen:d,onOpen:f})}),r.jsx(Wg,{label:a("parameters.negativePromptPlaceholder")}),n&&r.jsx(HU,{prompt:t,presetPrompt:(i==null?void 0:i.preset_data.negative_prompt)||"",label:`${a("parameters.negativePromptPlaceholder")} (${a("stylePresets.preview")})`})]})})});WU.displayName="ParamNegativePrompt";const G6e={svg:{animation:Vy}},UU=u.memo(()=>{const{t:e}=A(),t=I(jy),n=I(NM),{isOpen:s,onOpen:i}=G9();return r.jsx(Ee,{label:e(t?"dynamicPrompts.loading":"dynamicPrompts.showDynamicPrompts"),children:r.jsx(oe,{size:"sm",variant:"promptOverlay",isDisabled:s,"aria-label":e("dynamicPrompts.showDynamicPrompts"),icon:r.jsx(Tde,{}),onClick:i,sx:t?G6e:void 0,colorScheme:n&&!t?"error":"base"})})});UU.displayName="ShowDynamicPromptsPreviewButton";const qU=u.memo(()=>{const e=I(Hse),t=G(),{t:n}=A(),s=u.useCallback(()=>{t(Wse(!e))},[t,e]),i=u.useMemo(()=>n(e?"sdxl.concatPromptStyle":"sdxl.freePromptStyle"),[e,n]);return r.jsx(Ee,{label:i,children:r.jsx(oe,{"aria-label":i,onClick:s,icon:e?r.jsx(Kde,{size:14}):r.jsx(Zde,{size:14}),variant:"promptOverlay",fontSize:12,px:.5})})});qU.displayName="SDXLConcatButton";const KU=u.memo(()=>{var C;const e=G(),t=I(JM),n=I(cc),s=I(YS),i=I(Ep),{activeStylePreset:o}=Yp(void 0,{selectFromResult:({data:x})=>{let v=null;return x&&(v=x.find(w=>w.id===i)),{activeStylePreset:v}}}),a=u.useRef(null),{t:l}=A(),c=u.useCallback(x=>{e(wL(x))},[e]),{onChange:d,isOpen:h,onClose:f,onOpen:p,onSelect:g,onKeyDown:m,onFocus:y}=$d({prompt:t,textareaRef:a,onChange:c}),b=u.useCallback(x=>{y(),x.preventDefault()},[y]);return Re({id:"focusPrompt",category:"app",callback:b,options:{preventDefault:!0,enableOnFormTags:["INPUT","SELECT","TEXTAREA"]},dependencies:[b]}),r.jsx(kc,{isOpen:h,onClose:f,onSelect:g,width:(C=a.current)==null?void 0:C.clientWidth,children:r.jsxs(Se,{pos:"relative",children:[r.jsx(ss,{id:"prompt",name:"prompt",ref:a,value:t,onChange:d,minH:40,onKeyDown:m,variant:"darkFilled",borderTopWidth:24,paddingInlineEnd:10,paddingInlineStart:3,paddingTop:0,paddingBottom:3}),r.jsxs(Ug,{children:[r.jsx(jc,{isOpen:h,onOpen:p}),n==="sdxl"&&r.jsx(qU,{}),r.jsx(UU,{})]}),r.jsx(Wg,{label:l("parameters.positivePromptPlaceholder")}),s&&r.jsx(HU,{prompt:t,presetPrompt:(o==null?void 0:o.preset_data.positive_prompt)||"",label:`${l("parameters.positivePromptPlaceholder")} (${l("stylePresets.preview")})`})]})})});KU.displayName="ParamPositivePrompt";const ZU=u.memo(()=>{var f;const e=G(),t=I(Use),n=u.useRef(null),{t:s}=A(),i=u.useCallback(p=>{e(qse(p))},[e]),{onChange:o,isOpen:a,onClose:l,onOpen:c,onSelect:d,onKeyDown:h}=$d({prompt:t,textareaRef:n,onChange:i});return r.jsx(kc,{isOpen:a,onClose:l,onSelect:d,width:(f=n.current)==null?void 0:f.clientWidth,children:r.jsxs(Se,{pos:"relative",children:[r.jsx(ss,{id:"prompt",name:"prompt",ref:n,value:t,onChange:o,onKeyDown:h,fontSize:"sm",variant:"darkFilled",minH:24,borderTopWidth:24,paddingInlineEnd:10,paddingInlineStart:3,paddingTop:0,paddingBottom:3}),r.jsx(Ug,{children:r.jsx(jc,{isOpen:a,onOpen:c})}),r.jsx(Wg,{label:s("sdxl.negStylePrompt")})]})})});ZU.displayName="ParamSDXLNegativeStylePrompt";const YU=u.memo(()=>{var f;const e=G(),t=I(Kse),n=u.useRef(null),{t:s}=A(),i=u.useCallback(p=>{e(Zse(p))},[e]),{onChange:o,isOpen:a,onClose:l,onOpen:c,onSelect:d,onKeyDown:h}=$d({prompt:t,textareaRef:n,onChange:i});return r.jsx(kc,{isOpen:a,onClose:l,onSelect:d,width:(f=n.current)==null?void 0:f.clientWidth,children:r.jsxs(Se,{pos:"relative",children:[r.jsx(ss,{id:"prompt",name:"prompt",ref:n,value:t,onChange:o,onKeyDown:h,fontSize:"sm",variant:"darkFilled",minH:24,borderTopWidth:24,paddingInlineEnd:10,paddingInlineStart:3,paddingTop:0,paddingBottom:3}),r.jsx(Ug,{children:r.jsx(jc,{isOpen:a,onOpen:c})}),r.jsx(Wg,{label:s("sdxl.posStylePrompt")})]})})});YU.displayName="ParamSDXLPositiveStylePrompt";const H6e=Yse(e=>{var s;const t=((s=e.model)==null?void 0:s.base)==="sdxl",n=e.shouldConcatPrompts;return t&&!n}),p4=u.memo(()=>{const e=I(H6e),t=I(Ga);return r.jsxs(T,{flexDir:"column",gap:2,children:[r.jsx(KU,{}),e&&r.jsx(YU,{}),!t&&r.jsx(WU,{}),e&&r.jsx(ZU,{})]})});p4.displayName="Prompts";const W6e=()=>{const e=I(SL),t=I(jL),n=G(),{t:s}=A(),i=u.useCallback(o=>n(Xse(o)),[n]);return r.jsxs(K,{children:[r.jsx(ze,{feature:"paramCFGRescaleMultiplier",children:r.jsx(J,{children:s("parameters.cfgRescaleMultiplier")})}),r.jsx(Ze,{value:e,defaultValue:t.initial,min:t.sliderMin,max:t.sliderMax,step:t.coarseStep,fineStep:t.fineStep,onChange:i,marks:!0}),r.jsx(Ie,{value:e,defaultValue:t.initial,min:t.numberInputMin,max:t.numberInputMax,step:t.coarseStep,fineStep:t.fineStep,onChange:i})]})},U6e=u.memo(W6e),q6e=()=>{const e=G(),{t}=A(),n=I(Qse),[s,{isLoading:i}]=xc(),o=u.useCallback(h=>{h&&e(Jse(Ei.parse(h)))},[e]),{options:a,value:l,onChange:c,noOptionsMessage:d}=ll({modelConfigs:s,onChange:o,selectedModel:n,isLoading:i});return r.jsxs(K,{isDisabled:!a.length,isInvalid:!a.length,minW:0,flexGrow:1,children:[r.jsx(J,{m:0,children:t("modelManager.clipEmbed")}),r.jsx(Ne,{value:l,options:a,onChange:c,noOptionsMessage:d})]})},K6e=u.memo(q6e),Z6e=()=>{const e=G(),{t}=A(),n=I(ere),[s,{isLoading:i}]=xc(),o=u.useCallback(h=>{h&&e(tre(Ei.parse(h)))},[e]),{options:a,value:l,onChange:c,noOptionsMessage:d}=ll({modelConfigs:s.filter(h=>cL(h)),onChange:o,selectedModel:n,isLoading:i});return r.jsxs(K,{isDisabled:!a.length,isInvalid:!a.length,minW:0,flexGrow:1,children:[r.jsx(J,{m:0,children:t("modelManager.clipGEmbed")}),r.jsx(Ne,{value:l,options:a,onChange:c,noOptionsMessage:d})]})},Y6e=u.memo(Z6e),X6e=()=>{const e=G(),{t}=A(),n=I(nre),[s,{isLoading:i}]=xc(),o=u.useCallback(h=>{h&&e(sre(Ei.parse(h)))},[e]),{options:a,value:l,onChange:c,noOptionsMessage:d}=ll({modelConfigs:s.filter(h=>uL(h)),onChange:o,selectedModel:n,isLoading:i});return r.jsxs(K,{isDisabled:!a.length,isInvalid:!a.length,minW:0,flexGrow:1,children:[r.jsx(J,{m:0,children:t("modelManager.clipLEmbed")}),r.jsx(Ne,{value:l,options:a,onChange:c,noOptionsMessage:d})]})},Q6e=u.memo(X6e),J6e=()=>{const e=I(rre),t=I(ire),n=I(Ny),s=G(),{t:i}=A(),o=u.useCallback(c=>{s(ore(c))},[s]),a=u.useMemo(()=>n?om[n.base].maxClip:om["sd-1"].maxClip,[n]),l=u.useMemo(()=>n?om[n.base].markers:om["sd-1"].markers,[n]);return(n==null?void 0:n.base)==="sdxl"?null:r.jsxs(K,{children:[r.jsx(ze,{feature:"clipSkip",children:r.jsx(J,{children:i("parameters.clipSkip")})}),r.jsx(Ze,{value:e,defaultValue:t.initial,min:t.sliderMin,max:a,step:t.coarseStep,fineStep:t.fineStep,onChange:o,marks:l}),r.jsx(Ie,{value:e,defaultValue:t.initial,min:t.numberInputMin,max:a,step:t.coarseStep,fineStep:t.fineStep,onChange:o})]})},eTe=u.memo(J6e),tTe=()=>{const e=G(),{t}=A(),n=I(are),[s,{isLoading:i}]=Jj(),o=u.useCallback(h=>{h&&e(lre(Ei.parse(h)))},[e]),{options:a,value:l,onChange:c,noOptionsMessage:d}=ll({modelConfigs:s,onChange:o,selectedModel:n,isLoading:i});return r.jsxs(K,{isDisabled:!a.length,isInvalid:!a.length,minW:0,flexGrow:1,children:[r.jsx(J,{m:0,children:t("modelManager.t5Encoder")}),r.jsx(Ne,{value:l,options:a,onChange:c,noOptionsMessage:d})]})},p8=u.memo(tTe),nTe=()=>{const{t:e}=A(),t=I(cre),n=G(),s=u.useCallback(i=>{n(ure(i.target.checked))},[n]);return r.jsxs(K,{children:[r.jsx(ze,{feature:"seamlessTilingXAxis",children:r.jsx(J,{children:e("parameters.seamlessXAxis")})}),r.jsx(et,{isChecked:t,onChange:s})]})},sTe=u.memo(nTe),rTe=()=>{const{t:e}=A(),t=I(dre),n=G(),s=u.useCallback(i=>{n(hre(i.target.checked))},[n]);return r.jsxs(K,{children:[r.jsx(ze,{feature:"seamlessTilingYAxis",children:r.jsx(J,{children:e("parameters.seamlessYAxis")})}),r.jsx(et,{isChecked:t,onChange:s})]})},iTe=u.memo(rTe),g4=u.memo(()=>{const e=I(tP),t=I(XS),{t:n}=A(),s=G(),i=u.useCallback(o=>s(kL(o)),[s]);return r.jsxs(K,{flexGrow:1,children:[r.jsx(ze,{feature:"paramSeed",children:r.jsx(J,{children:n("parameters.seed")})}),r.jsx(Ie,{step:1,min:_L,max:cd,isDisabled:t,onChange:i,value:e,flexGrow:1,defaultValue:0})]})});g4.displayName="ParamSeedNumberInput";const m4=u.memo(()=>{const e=G(),{t}=A(),n=I(XS),s=u.useCallback(i=>e(fre(i.target.checked)),[e]);return r.jsxs(K,{w:"min-content",children:[r.jsx(J,{m:0,children:t("common.random")}),r.jsx(et,{isChecked:n,onChange:s})]})});m4.displayName="ParamSeedRandomize";const oTe=(e,t)=>Math.floor(Math.random()*(t-e+1)+e),y4=u.memo(()=>{const e=G(),t=I(XS),{t:n}=A(),s=u.useCallback(()=>e(kL(oTe(_L,cd))),[e]);return r.jsx(de,{size:"sm",isDisabled:t,onClick:s,leftIcon:r.jsx(ihe,{}),flexShrink:0,children:n("parameters.shuffle")})});y4.displayName="ParamSeedShuffle";const aTe=()=>{const e=G(),{t}=A(),n=I(pre),[s,{isLoading:i}]=U7(),o=u.useCallback(h=>{h&&e(gre(Ei.parse(h)))},[e]),{options:a,value:l,onChange:c,noOptionsMessage:d}=Zt({modelConfigs:s,onChange:o,selectedModel:n,isLoading:i});return r.jsxs(K,{isDisabled:!a.length,isInvalid:!a.length,minW:0,flexGrow:1,children:[r.jsx(ze,{feature:"paramVAE",children:r.jsx(J,{m:0,children:t("modelManager.vae")})}),r.jsx(Ne,{value:l,options:a,onChange:c,noOptionsMessage:d})]})},lTe=u.memo(aTe),cTe=()=>{const e=G(),{t}=A(),n=I(cc),s=I(IL),[i,{isLoading:o}]=bb(),a=u.useCallback(p=>{const g=n===p.base;return!!!n||!g},[n]),l=u.useCallback(p=>{e(mre(p?Ei.parse(p):null))},[e]),{options:c,value:d,onChange:h,noOptionsMessage:f}=Zt({modelConfigs:i,onChange:l,selectedModel:s,isLoading:o,getIsDisabled:a});return r.jsxs(K,{isDisabled:!c.length,isInvalid:!c.length,minW:0,flexGrow:1,children:[r.jsx(ze,{feature:"paramVAE",children:r.jsx(J,{m:0,children:t("modelManager.vae")})}),r.jsx(Ne,{isClearable:!0,value:d,placeholder:d?d.value:t("models.defaultVAE"),options:c,onChange:h,noOptionsMessage:f})]})},uTe=u.memo(cTe),g8=[{label:"FP16",value:"fp16"},{label:"FP32",value:"fp32"}],dTe=()=>{const{t:e}=A(),t=G(),n=I(TL),s=u.useCallback(o=>{AL(o==null?void 0:o.value)&&t(yre(o.value))},[t]),i=u.useMemo(()=>g8.find(o=>o.value===n),[n]);return r.jsxs(K,{flexGrow:0,children:[r.jsx(ze,{feature:"paramVAEPrecision",children:r.jsx(J,{m:0,children:e("modelManager.vaePrecision")})}),r.jsx(Ne,{value:i,options:g8,onChange:s})]})},hTe=u.memo(dTe),Ud=e=>{const t=G(),n=u.useMemo(()=>fe(td,o=>o.accordions[e.id]??e.defaultIsOpen),[e]),s=I(n),i=u.useCallback(()=>{t(bre({id:e.id,isOpen:!s}))},[e.id,t,s]);return{isOpen:s,onToggle:i}},fTe={minW:"9.2rem"},pTe={flexGrow:1},b4=u.memo(()=>{const e=I(xre),{currentData:t}=Up(e??Xn),n=I(An),s=I(Ga),i=I(Oy),o=u.useMemo(()=>hn([nd,Ga],(h,f)=>{const p=[];if(f){if(t){let g=t.name;h.vaePrecision==="fp16"&&(g+=` ${h.vaePrecision}`),p.push(g)}}else{if(t){let g=t.name;h.vaePrecision==="fp16"&&(g+=` ${h.vaePrecision}`),p.push(g)}else h.vaePrecision==="fp16"&&p.push(`VAE ${h.vaePrecision}`);h.clipSkip&&p.push(`Skip ${h.clipSkip}`),h.cfgRescaleMultiplier&&p.push(`Rescale ${h.cfgRescaleMultiplier}`),(h.seamlessXAxis||h.seamlessYAxis)&&p.push("seamless"),n==="upscaling"&&!h.shouldRandomizeSeed&&p.push("Manual Seed")}return p}),[t,n]),a=I(o),{t:l}=A(),{isOpen:c,onToggle:d}=Ud({id:`'advanced-settings-${n}`,defaultIsOpen:!1});return r.jsx(ud,{label:l("accordions.advanced.title"),badges:a,isOpen:c,onToggle:d,children:r.jsxs(T,{gap:4,alignItems:"center",p:4,flexDir:"column","data-testid":"advanced-settings-accordion",children:[r.jsxs(T,{gap:4,w:"full",children:[s?r.jsx(lTe,{}):r.jsx(uTe,{}),!s&&!i&&r.jsx(hTe,{})]}),n==="upscaling"?r.jsxs(T,{gap:4,alignItems:"center",children:[r.jsx(g4,{}),r.jsx(y4,{}),r.jsx(m4,{})]}):r.jsxs(r.Fragment,{children:[!s&&!i&&r.jsxs(r.Fragment,{children:[r.jsxs(ks,{formLabelProps:fTe,children:[r.jsx(eTe,{}),r.jsx(U6e,{})]}),r.jsx(T,{gap:4,w:"full",children:r.jsxs(ks,{formLabelProps:pTe,children:[r.jsx(sTe,{}),r.jsx(iTe,{})]})})]}),s&&r.jsxs(ks,{children:[r.jsx(p8,{}),r.jsx(K6e,{})]}),i&&r.jsxs(ks,{children:[r.jsx(p8,{}),r.jsx(Q6e,{}),r.jsx(Y6e,{})]})]})]})})});b4.displayName="AdvancedSettingsAccordion";const gTe=()=>{const e=G(),t=I(vre),n=I(Cre),{t:s}=A(),i=u.useCallback(o=>{e(wre(o))},[e]);return r.jsxs(K,{children:[r.jsx(ze,{feature:"compositingCoherenceEdgeSize",children:r.jsx(J,{children:s("parameters.coherenceEdgeSize")})}),r.jsx(Ze,{min:n.sliderMin,max:n.sliderMax,step:n.coarseStep,fineStep:n.fineStep,value:t,defaultValue:n.initial,onChange:i,marks:!0}),r.jsx(Ie,{min:n.numberInputMin,max:n.numberInputMax,step:n.coarseStep,fineStep:n.fineStep,value:t,defaultValue:n.initial,onChange:i})]})},mTe=u.memo(gTe),yTe=()=>{const e=G(),t=I(Sre),{t:n}=A(),s=u.useCallback(i=>{e(jre(i))},[e]);return r.jsxs(K,{children:[r.jsx(ze,{feature:"compositingCoherenceMinDenoise",children:r.jsx(J,{children:n("parameters.coherenceMinDenoise")})}),r.jsx(Ze,{min:0,max:1,step:.01,value:t,defaultValue:0,onChange:s}),r.jsx(Ie,{min:0,max:1,step:.01,value:t,defaultValue:0,onChange:s})]})},bTe=u.memo(yTe),xTe=()=>{const e=G(),t=I(kre),{t:n}=A(),s=u.useMemo(()=>[{label:n("parameters.gaussianBlur"),value:"Gaussian Blur"},{label:n("parameters.boxBlur"),value:"Box Blur"},{label:n("parameters.staged"),value:"Staged"}],[n]),i=u.useCallback(a=>{_re(a==null?void 0:a.value)&&e(Ire(a.value))},[e]),o=u.useMemo(()=>s.find(a=>a.value===t),[t,s]);return r.jsxs(K,{children:[r.jsx(ze,{feature:"compositingCoherenceMode",children:r.jsx(J,{children:n("parameters.coherenceMode")})}),r.jsx(Ne,{options:s,value:o,onChange:i})]})},vTe=u.memo(xTe),CTe=()=>{const{t:e}=A(),t=G(),n=I(Tre),s=I(Are),i=u.useCallback(o=>{t(Ere(o))},[t]);return r.jsxs(K,{children:[r.jsx(ze,{feature:"compositingMaskBlur",children:r.jsx(J,{children:e("parameters.maskBlur")})}),r.jsx(Ze,{value:n,onChange:i,min:s.sliderMin,max:s.sliderMax,defaultValue:s.initial,step:s.coarseStep,fineStep:s.fineStep,marks:!0}),r.jsx(Ie,{value:n,onChange:i,defaultValue:s.initial,min:s.numberInputMin,max:s.numberInputMax,step:s.coarseStep,fineStep:s.fineStep})]})},wTe=u.memo(CTe),STe=()=>{const{t:e}=A(),t=G(),n=I(Xp),{data:s}=EL(),i=u.useMemo(()=>s?s.infill_methods.map(l=>({label:l,value:l})):[],[s]),o=u.useCallback(l=>{!l||!i.find(c=>c.value===l.value)||t(Mre(l.value))},[t,i]),a=u.useMemo(()=>i.find(l=>l.value===n),[i,n]);return r.jsxs(K,{isDisabled:i.length===0,children:[r.jsx(ze,{feature:"infillMethod",children:r.jsx(J,{children:e("parameters.infillMethod")})}),r.jsx(Ne,{value:a,options:i,onChange:o})]})},jTe=u.memo(STe),kTe=()=>{const e=G(),t=I(Pre),n=I(Xp),{t:s}=A(),i=u.useCallback(o=>{e(Lre(o))},[e]);return r.jsx(T,{flexDir:"column",gap:4,children:r.jsxs(K,{isDisabled:n!=="color",children:[r.jsx(J,{children:s("parameters.infillColorValue")}),r.jsx(Se,{w:"full",pt:2,pb:2,children:r.jsx(H$,{color:t,onChange:i})})]})})},_Te=u.memo(kTe),ITe=()=>{const e=G(),t=I(Xp),n=I(Dre),s=I(Rre),{t:i}=A(),o=u.useCallback(a=>{e(Ore(a))},[e]);return r.jsxs(K,{isDisabled:t!=="patchmatch",children:[r.jsx(ze,{feature:"patchmatchDownScaleSize",children:r.jsx(J,{children:i("parameters.patchmatchDownScaleSize")})}),r.jsx(Ze,{value:n,onChange:o,marks:!0,defaultValue:s.initial,min:s.sliderMin,max:s.sliderMax,step:s.coarseStep,fineStep:s.fineStep}),r.jsx(Ie,{value:n,onChange:o,defaultValue:s.initial,min:s.numberInputMin,max:s.numberInputMax,step:s.coarseStep,fineStep:s.fineStep})]})},TTe=u.memo(ITe),ATe=()=>{const e=G(),t=I(Nre),n=I(Fre),s=I(Xp),{t:i}=A(),o=u.useCallback(a=>{e(Bre(a))},[e]);return r.jsxs(K,{isDisabled:s!=="tile",children:[r.jsx(J,{children:i("parameters.tileSize")}),r.jsx(Ze,{value:t,onChange:o,defaultValue:n.initial,min:n.sliderMin,max:n.sliderMax,step:n.coarseStep,fineStep:n.fineStep,marks:!0}),r.jsx(Ie,{value:t,onChange:o,defaultValue:n.initial,min:n.numberInputMin,max:n.numberInputMax,step:n.coarseStep,fineStep:n.fineStep})]})},ETe=u.memo(ATe),MTe=()=>{const e=I(Xp);return e==="tile"?r.jsx(ETe,{}):e==="patchmatch"?r.jsx(TTe,{}):e==="color"?r.jsx(_Te,{}):null},PTe=u.memo(MTe),m8={minW:"4.5rem"},XU=u.memo(()=>{const{t:e}=A(),{isOpen:t,onToggle:n}=Ud({id:"compositing-settings",defaultIsOpen:!1});return r.jsx(ud,{isOpen:t,onToggle:n,label:e("accordions.compositing.title"),children:r.jsxs(sc,{variant:"collapse",children:[r.jsxs(rc,{children:[r.jsx(_n,{children:e("accordions.compositing.coherenceTab")}),r.jsx(_n,{children:e("accordions.compositing.infillTab")})]}),r.jsxs(sd,{children:[r.jsx(Rn,{children:r.jsx(T,{gap:4,p:4,flexDir:"column",children:r.jsxs(ks,{formLabelProps:m8,children:[r.jsx(vTe,{}),r.jsx(mTe,{}),r.jsx(bTe,{}),r.jsx(wTe,{})]})})}),r.jsx(Rn,{children:r.jsx(T,{gap:4,p:4,flexDir:"column",children:r.jsxs(ks,{formLabelProps:m8,children:[r.jsx(jTe,{}),r.jsx(PTe,{})]})})})]})]})})});XU.displayName="CompositingSettingsAccordion";const LTe=[-1,0,1,2],QU=u.memo(e=>{const{lora:t}=e,n=G(),{data:s}=Up(t.model.key),i=u.useCallback(l=>{n($re({id:t.id,weight:l}))},[n,t.id]),o=u.useCallback(()=>{n(Vre({id:t.id,isEnabled:!t.isEnabled}))},[n,t.id,t.isEnabled]),a=u.useCallback(()=>{n(zre({id:t.id}))},[n,t.id]);return r.jsxs(Gre,{variant:"lora",children:[r.jsx(Hre,{children:r.jsxs(T,{alignItems:"center",justifyContent:"space-between",width:"100%",gap:2,children:[r.jsx(q,{noOfLines:1,wordBreak:"break-all",color:t.isEnabled?"base.200":"base.500",children:(s==null?void 0:s.name)??t.model.key.substring(0,8)}),r.jsxs(T,{alignItems:"center",gap:2,children:[r.jsx(et,{size:"sm",onChange:o,isChecked:t.isEnabled}),r.jsx(oe,{"aria-label":"Remove LoRA",variant:"ghost",size:"sm",onClick:a,icon:r.jsx(ri,{})})]})]})}),r.jsx(ze,{feature:"loraWeight",children:r.jsxs(Wre,{children:[r.jsx(Ze,{value:t.weight,onChange:i,min:-1,max:2,step:.01,marks:LTe,defaultValue:.75,isDisabled:!t.isEnabled}),r.jsx(Ie,{value:t.weight,onChange:i,min:-10,max:10,step:.01,w:20,flexShrink:0,defaultValue:.75,isDisabled:!t.isEnabled})]})})]})});QU.displayName="LoRACard";const DTe=hn(QS,e=>e.loras),JU=u.memo(()=>{const e=I(DTe);return e.length?r.jsx(T,{flexWrap:"wrap",gap:2,children:e.map(t=>r.jsx(QU,{lora:t},t.id))}):null});JU.displayName="LoRAList";const RTe=fe(QS,e=>e.loras),OTe=()=>{const e=G(),[t,{isLoading:n}]=yb(),{t:s}=A(),i=I(RTe),o=I(cc),a=p=>{const g=o===p.base,m=!!i.find(b=>b.model.key===p.key);return!!!o||!g||m},l=u.useCallback(p=>{p&&e(Ure({model:p}))},[e]),{options:c,onChange:d}=Zt({modelConfigs:t,getIsDisabled:a,onChange:l}),h=u.useMemo(()=>n?s("common.loading"):c.length===0?s("models.noLoRAsInstalled"):s("models.addLora"),[n,c.length,s]),f=u.useCallback(()=>s("models.noMatchingLoRAs"),[s]);return r.jsxs(K,{isDisabled:!c.length,children:[r.jsx(ze,{feature:"lora",children:r.jsxs(J,{children:[s("models.concepts")," "]})}),r.jsx(Ne,{placeholder:h,value:null,options:c,noOptionsMessage:f,onChange:d,"data-testid":"add-lora",sx:FTe})]})},NTe=u.memo(OTe),FTe={w:"full"},BTe=()=>{const e=I(ML),t=I(zy),n=G(),{t:s}=A(),i=u.useMemo(()=>[t.sliderMin,Math.floor(t.sliderMax/2),t.sliderMax],[t.sliderMax,t.sliderMin]),o=u.useCallback(a=>n(qre(a)),[n]);return r.jsxs(K,{children:[r.jsx(ze,{feature:"paramCFGScale",children:r.jsx(J,{children:s("parameters.cfgScale")})}),r.jsx(Ze,{value:e,defaultValue:t.initial,min:t.sliderMin,max:t.sliderMax,step:t.coarseStep,fineStep:t.fineStep,onChange:o,marks:i}),r.jsx(Ie,{value:e,defaultValue:t.initial,min:t.numberInputMin,max:t.numberInputMax,step:t.coarseStep,fineStep:t.fineStep,onChange:o})]})},$Te=u.memo(BTe),VTe=()=>{const e=I(PL),t=I(LL),n=G(),{t:s}=A(),i=u.useMemo(()=>[t.sliderMin,Math.floor(t.sliderMax-(t.sliderMax-t.sliderMin)/2),t.sliderMax],[t.sliderMax,t.sliderMin]),o=u.useCallback(a=>n(Kre(a)),[n]);return r.jsxs(K,{children:[r.jsx(ze,{feature:"paramGuidance",children:r.jsx(J,{children:s("parameters.guidance")})}),r.jsx(Ze,{value:e,defaultValue:t.initial,min:t.sliderMin,max:t.sliderMax,step:t.coarseStep,fineStep:t.fineStep,onChange:o,marks:i}),r.jsx(Ie,{value:e,defaultValue:t.initial,min:t.numberInputMin,max:t.numberInputMax,step:t.coarseStep,fineStep:t.fineStep,onChange:o})]})},zTe=u.memo(VTe),GTe=()=>{const e=G(),{t}=A(),n=I(DL),s=u.useCallback(o=>{Zp(o==null?void 0:o.value)&&e(Zre(o.value))},[e]),i=u.useMemo(()=>ho.find(o=>o.value===n),[n]);return r.jsxs(K,{children:[r.jsx(ze,{feature:"paramScheduler",children:r.jsx(J,{children:t("parameters.scheduler")})}),r.jsx(Ne,{value:i,options:ho,onChange:s})]})},HTe=u.memo(GTe),WTe=()=>{const e=I(RL),t=I(JS),n=G(),{t:s}=A(),i=u.useMemo(()=>[t.sliderMin,Math.floor(t.sliderMax/2),t.sliderMax],[t.sliderMax,t.sliderMin]),o=u.useCallback(a=>{n(Yre(a))},[n]);return r.jsxs(K,{children:[r.jsx(ze,{feature:"paramSteps",children:r.jsx(J,{children:s("parameters.steps")})}),r.jsx(Ze,{value:e,defaultValue:t.initial,min:t.sliderMin,max:t.sliderMax,step:t.coarseStep,fineStep:t.fineStep,onChange:o,marks:i}),r.jsx(Ie,{value:e,defaultValue:t.initial,min:t.numberInputMin,max:t.numberInputMax,step:t.coarseStep,fineStep:t.fineStep,onChange:o})]})},UTe=u.memo(WTe),eq=u.memo(e=>{const{t}=A(),n=G(),s=I(WS),i=u.useCallback(()=>{n(Qt("models"))},[n]);return s?null:r.jsx(oe,{icon:r.jsx(xd,{}),tooltip:`${t("common.goTo")} ${t("ui.tabs.modelsTab")}`,"aria-label":`${t("common.goTo")} ${t("ui.tabs.modelsTab")}`,onClick:i,size:"sm",variant:"ghost",...e})});eq.displayName="NavigateToModelManagerButton";function qTe(e){return he({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M12.5 6.9c1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-.53.12-1.03.3-1.48.54l1.47 1.47c.41-.17.91-.27 1.51-.27zM5.33 4.06 4.06 5.33 7.5 8.77c0 2.08 1.56 3.21 3.91 3.91l3.51 3.51c-.34.48-1.05.91-2.42.91-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c.96-.18 1.82-.55 2.45-1.12l2.22 2.22 1.27-1.27L5.33 4.06z"},child:[]}]})(e)}const KTe=()=>{const e=G(),{t}=A(),n=I(An),s=I(ZP),[i,{isLoading:o}]=gb(),a=u.useMemo(()=>{if(!i||s===null)return null;const b=i.find(C=>C.key===s);return b||null},[i,s]),l=u.useMemo(()=>{var b;if(!(!i.length||!a))return(b=i.find(C=>C.key===(a==null?void 0:a.key)))==null?void 0:b.description},[i,a]),c=u.useCallback(b=>{if(b)try{e(Xre(Ei.parse(b)))}catch{}},[e]),d=u.useCallback(b=>n==="upscaling"&&b.base==="flux",[n]),{options:h,value:f,onChange:p,placeholder:g,noOptionsMessage:m}=Zt({modelConfigs:i,selectedModel:a,onChange:c,isLoading:o,getIsDisabled:d}),y=u.useMemo(()=>a&&Qre(a)&&a.config_path==="flux-dev",[a]);return r.jsxs(K,{isDisabled:!i.length,isInvalid:!f||!i.length,children:[r.jsxs(T,{alignItems:"center",children:[r.jsx(ze,{feature:"paramModel",children:r.jsx(J,{children:t("modelManager.model")})}),y?r.jsx(ze,{feature:"fluxDevLicense",hideDisable:!0,children:r.jsx(T,{justifyContent:"flex-start",children:r.jsx(lt,{as:qTe})})}):r.jsx(it,{})]}),r.jsx(Ee,{label:l,children:r.jsx(Se,{w:"full",minW:0,children:r.jsx(Ne,{value:f,placeholder:g,options:h,onChange:p,noOptionsMessage:m,isInvalid:f==null?void 0:f.isDisabled})})})]})},ZTe=u.memo(KTe),YTe=()=>{const e=I(Ny),{t}=A(),n=G(),{data:s}=Ip(),i=I(DL),o=I(RL),a=I(IL),l=I(TL),c=I(ej),d=I(tj),h=I(PL),f=I(ML),p=I(SL),g=u.useMemo(()=>!s||e===null?null:Ya.selectById(s,e.key),[s,e]),m=u.useMemo(()=>{const v=g&&D0(g)&&g.default_settings;return v&&Object.values(v).some(w=>!!w)},[g]),y=u.useMemo(()=>g&&D0(g)&&g.default_settings?g.default_settings:Jre,[g]),b=u.useMemo(()=>{const v=[];if(m){const{vae:w,vae_precision:S,cfg_scale:j,cfg_rescale_multiplier:P,steps:E,scheduler:D,width:M,height:R,guidance:F}=y;!qe(w)&&a&&w!==a.key&&v.push(t("modelManager.vae")),!qe(w)&&!a&&w!=="default"&&v.push(t("modelManager.vae")),!qe(S)&&S!==l&&v.push(t("modelManager.vaePrecision")),!qe(j)&&j!==f&&v.push(t("parameters.cfgScale")),!qe(P)&&P!==p&&v.push(t("parameters.cfgRescaleMultiplier")),!qe(E)&&E!==o&&v.push(t("parameters.steps")),!qe(D)&&D!==i&&v.push(t("parameters.scheduler")),!qe(M)&&M!==c&&v.push(t("parameters.width")),!qe(R)&&R!==d&&v.push(t("parameters.height")),!qe(F)&&F!==h&&v.push(t("parameters.guidance"))}return v},[m,a,l,f,p,o,i,c,d,h,t,y]),C=u.useMemo(()=>e?m?b.length===0?t("modelManager.usingDefaultSettings"):r.jsxs(T,{direction:"column",gap:2,children:[r.jsx(q,{children:t("modelManager.defaultSettingsOutOfSync")}),r.jsx(or,{children:b.map(v=>r.jsx(Rt,{children:v},v))}),r.jsx(q,{children:t("modelManager.restoreDefaultSettings")})]}):t("modelManager.noDefaultSettings"):t("modelManager.noModelSelected"),[e,m,b,t]),x=u.useCallback(()=>{n(eie())},[n]);return r.jsx(oe,{icon:r.jsx(ub,{}),tooltip:C,"aria-label":t("modelManager.useDefaultSettings"),isDisabled:!e||!m||b.length===0,onClick:x,size:"sm",variant:"ghost",colorScheme:"warning"})},XTe=()=>{const e=I(tie),t=I(zy),n=G(),{t:s}=A(),i=u.useMemo(()=>[t.sliderMin,Math.floor(t.sliderMax/2),t.sliderMax],[t.sliderMax,t.sliderMin]),o=u.useCallback(a=>n(nie(a)),[n]);return r.jsxs(K,{children:[r.jsx(ze,{feature:"paramCFGScale",children:r.jsx(J,{children:s("parameters.cfgScale")})}),r.jsx(Ze,{value:e,defaultValue:t.initial,min:t.sliderMin,max:t.sliderMax,step:t.coarseStep,fineStep:t.fineStep,onChange:o,marks:i}),r.jsx(Ie,{value:e,defaultValue:t.initial,min:t.numberInputMin,max:t.numberInputMax,step:t.coarseStep,fineStep:t.fineStep,onChange:o})]})},QTe=u.memo(XTe),JTe=()=>{const e=G(),{t}=A(),n=I(sie),s=u.useCallback(o=>{Zp(o==null?void 0:o.value)&&e(rie(o.value))},[e]),i=u.useMemo(()=>ho.find(o=>o.value===n),[n]);return r.jsxs(K,{children:[r.jsx(ze,{feature:"paramScheduler",children:r.jsx(J,{children:t("parameters.scheduler")})}),r.jsx(Ne,{value:i,options:ho,onChange:s})]})},eAe=u.memo(JTe),x4=e=>{const t=G(),n=u.useMemo(()=>fe(td,o=>o.expanders[e.id]??e.defaultIsOpen),[e]),s=I(n),i=u.useCallback(()=>{t(iie({id:e.id,isOpen:!s}))},[t,e.id,s]);return{isOpen:s,onToggle:i}},tAe={minW:"4rem"},v4=u.memo(()=>{const{t:e}=A(),t=_G(),n=I(An),s=I(Ga),i=I(Oy),o=I(MS),a=u.useMemo(()=>n==="upscaling",[n]),l=u.useMemo(()=>hn(QS,m=>{const y=m.loras.filter(x=>x.isEnabled).length,b=y?[`${y} ${e("models.concepts")}`]:Ls,C=t?[t.name,t.base]:Ls;return{loraTabBadges:b,accordionBadges:C}}),[t,e]),{loraTabBadges:c,accordionBadges:d}=I(l),{isOpen:h,onToggle:f}=x4({id:"generation-settings-advanced",defaultIsOpen:!1}),{isOpen:p,onToggle:g}=Ud({id:`generation-settings-${n}`,defaultIsOpen:n!=="upscaling"});return r.jsx(ud,{label:e("accordions.generation.title"),badges:[...d,...c],isOpen:p,onToggle:g,children:r.jsxs(Se,{px:4,pt:4,"data-testid":"generation-accordion",children:[r.jsxs(T,{gap:4,flexDir:"column",children:[r.jsxs(T,{gap:4,alignItems:"center",children:[r.jsx(ZTe,{}),r.jsxs(T,{children:[r.jsx(YTe,{}),r.jsx(eq,{})]})]}),r.jsxs(T,{gap:4,flexDir:"column",children:[r.jsx(NTe,{}),r.jsx(JU,{})]})]}),r.jsx(nj,{label:e("accordions.advanced.options"),isOpen:h,onToggle:f,children:r.jsx(T,{gap:4,flexDir:"column",pb:4,children:r.jsxs(ks,{formLabelProps:tAe,children:[!s&&!i&&!o&&!a&&r.jsx(HTe,{}),a&&r.jsx(eAe,{}),r.jsx(UTe,{}),s&&t&&!oie(t)&&r.jsx(zTe,{}),a&&r.jsx(QTe,{}),!s&&!a&&r.jsx($Te,{})]})})})]})})});v4.displayName="GenerationSettingsAccordion";const tq=u.memo(()=>{const e=I(aie),t=G(),n=u.useCallback(i=>{t(lie(i.target.checked))},[t]),{t:s}=A();return r.jsxs(K,{w:"min-content",children:[r.jsx(ze,{feature:"optimizedDenoising",children:r.jsxs(J,{m:0,children:[s("parameters.optimizedImageToImage")," (",s("settings.beta"),")"]})}),r.jsx(et,{isChecked:e,onChange:n})]})});tq.displayName="ParamOptimizedDenoisingToggle";const nAe=fe(tt,e=>e.bbox.scaleMethod==="manual"),sAe=fe(tt,e=>e.bbox.scaledSize.height),rAe=fe(Pr,e=>e.sd.scaledBoundingBoxHeight),iAe=()=>{const{t:e}=A(),t=G(),n=I(Fn),s=I(Qp),i=I(nAe),o=I(sAe),a=I(rAe),l=I(zp),c=u.useCallback(d=>{t(cie(d))},[t]);return r.jsxs(K,{isDisabled:!i||n,children:[r.jsx(J,{children:e("parameters.scaledHeight")}),r.jsx(Ze,{min:a.sliderMin,max:a.sliderMax,step:a.coarseStep,fineStep:l,value:o,onChange:c,marks:!0,defaultValue:s}),r.jsx(Ie,{min:a.numberInputMin,max:a.numberInputMax,step:a.coarseStep,fineStep:l,value:o,onChange:c,defaultValue:s})]})},oAe=u.memo(iAe),aAe=fe(tt,e=>e.bbox.scaleMethod==="manual"),lAe=fe(tt,e=>e.bbox.scaledSize.width),cAe=fe(Pr,e=>e.sd.scaledBoundingBoxWidth),uAe=()=>{const{t:e}=A(),t=G(),n=I(Fn),s=I(Qp),i=I(aAe),o=I(lAe),a=I(cAe),l=I(zp),c=u.useCallback(d=>{t(uie(d))},[t]);return r.jsxs(K,{isDisabled:!i||n,children:[r.jsx(J,{children:e("parameters.scaledWidth")}),r.jsx(Ze,{min:a.sliderMin,max:a.sliderMax,step:a.coarseStep,fineStep:l,value:o,onChange:c,defaultValue:s,marks:!0}),r.jsx(Ie,{min:a.numberInputMin,max:a.numberInputMax,step:a.coarseStep,fineStep:l,value:o,onChange:c,defaultValue:s})]})},dAe=u.memo(uAe),hAe=fe(tt,e=>e.bbox.scaleMethod),fAe=()=>{const e=G(),{t}=A(),n=I(hAe),s=I(Fn),i=u.useMemo(()=>[{label:t("modelManager.none"),value:"none"},{label:t("common.auto"),value:"auto"},{label:t("modelManager.manual"),value:"manual"}],[t]),o=u.useCallback(l=>{die(l==null?void 0:l.value)&&e(hie(l.value))},[e]),a=u.useMemo(()=>i.find(l=>l.value===n),[n,i]);return r.jsxs(K,{isDisabled:s,children:[r.jsx(ze,{feature:"scaleBeforeProcessing",children:r.jsx(J,{children:t("parameters.scaleBeforeProcessing")})}),r.jsx(Ne,{value:a,options:i,onChange:o})]})},pAe=u.memo(fAe),nq=u.memo(()=>{const{t:e}=A(),t=G(),n=I(fie),s=I(Fn),i=u.useCallback(a=>{!a||!pie(a.value)||t(gie({id:a.value}))},[t]),o=u.useMemo(()=>OI.filter(a=>a.value===n)[0],[n]);return r.jsxs(K,{isDisabled:s,children:[r.jsx(ze,{feature:"paramAspect",children:r.jsx(J,{children:e("parameters.aspect")})}),r.jsx(Ne,{value:o,onChange:i,options:OI,sx:gAe})]})});nq.displayName="BboxAspectRatioSelect";const gAe={minW:24},sq=u.memo(()=>{const{t:e}=A(),t=G(),n=I(Qp),s=I(tj),i=I(OL),o=I(Fn),a=I(zp),l=u.useCallback(d=>{t(mie({height:d}))},[t]),c=u.useMemo(()=>[i.sliderMin,n,i.sliderMax],[i.sliderMin,i.sliderMax,n]);return r.jsxs(K,{isDisabled:o,children:[r.jsx(ze,{feature:"paramHeight",children:r.jsx(J,{children:e("parameters.height")})}),r.jsx(Ze,{value:s,defaultValue:n,onChange:l,min:i.sliderMin,max:i.sliderMax,step:i.coarseStep,fineStep:a,marks:c}),r.jsx(Ie,{value:s,defaultValue:n,onChange:l,min:i.numberInputMin,max:i.numberInputMax,step:i.coarseStep,fineStep:a})]})});sq.displayName="BboxHeight";const mAe=fe(tt,e=>e.bbox.aspectRatio.isLocked),rq=u.memo(()=>{const{t:e}=A(),t=G(),n=I(mAe),s=I(Fn),i=u.useCallback(()=>{t(yie())},[t]);return r.jsx(oe,{tooltip:e("parameters.lockAspectRatio"),"aria-label":e("parameters.lockAspectRatio"),onClick:i,variant:n?"outline":"ghost",size:"sm",icon:n?r.jsx(o7,{}):r.jsx(ZR,{}),isDisabled:s})});rq.displayName="BboxLockAspectRatioButton";const iq=u.memo(()=>{const e=I(ej),t=I(tj),n=I(bie),[s,i]=vz(),o=u.useMemo(()=>{if(!i)return{width:0,height:0};let a=e,l=t;return e>t?(a=i.width,l=a/n):(l=i.height,a=l*n),{width:a,height:l}},[i,e,t,n]);return r.jsx(T,{w:"full",h:"full",alignItems:"center",justifyContent:"center",ref:s,children:r.jsx(T,{position:"relative",borderRadius:"base",borderColor:"base.600",borderWidth:"3px",width:`${o.width}px`,height:`${o.height}px`,alignItems:"center",justifyContent:"center",children:r.jsxs(Ar,{borderRadius:"base",position:"absolute",top:0,right:0,bottom:0,left:0,gridTemplateColumns:"1fr 1fr 1fr",gridTemplateRows:"1fr 1fr 1fr",gap:"1px",bg:"base.700",children:[r.jsx(xt,{bg:"base.800"}),r.jsx(xt,{bg:"base.800"}),r.jsx(xt,{bg:"base.800"}),r.jsx(xt,{bg:"base.800"}),r.jsx(xt,{bg:"base.800"}),r.jsx(xt,{bg:"base.800"}),r.jsx(xt,{bg:"base.800"}),r.jsx(xt,{bg:"base.800"}),r.jsx(xt,{bg:"base.800"})]})})})});iq.displayName="BboxPreview";const yAe=fe(tt,e=>e.bbox.rect.width),bAe=fe(tt,e=>e.bbox.rect.height),oq=u.memo(()=>{const{t:e}=A(),t=G(),n=I(Fn),s=I(yAe),i=I(bAe),o=I(Qp),a=u.useMemo(()=>xie(s,i,o),[i,s,o]),l=u.useMemo(()=>vie(s,i,o),[i,s,o]),c=u.useCallback(()=>{t(Cie())},[t]),d=u.useMemo(()=>e(a?"parameters.setToOptimalSizeTooSmall":l?"parameters.setToOptimalSizeTooLarge":"parameters.setToOptimalSize"),[l,a,e]);return r.jsx(oe,{tooltip:d,"aria-label":e("parameters.setToOptimalSize"),onClick:c,variant:"ghost",size:"sm",icon:r.jsx(ub,{}),colorScheme:a||l?"warning":"base",isDisabled:n})});oq.displayName="BboxSetOptimalSizeButton";const aq=u.memo(()=>{const{t:e}=A(),t=G(),n=I(Fn),s=u.useCallback(()=>{t(wie())},[t]);return r.jsx(oe,{tooltip:e("parameters.swapDimensions"),"aria-label":e("parameters.swapDimensions"),onClick:s,variant:"ghost",size:"sm",icon:r.jsx(kde,{}),isDisabled:n})});aq.displayName="BboxSwapDimensionsButton";const lq=u.memo(()=>{const{t:e}=A(),t=G(),n=I(ej),s=I(Qp),i=I(NL),o=I(Fn),a=I(zp),l=u.useCallback(d=>{t(Sie({width:d}))},[t]),c=u.useMemo(()=>[i.sliderMin,s,i.sliderMax],[i.sliderMax,i.sliderMin,s]);return r.jsxs(K,{isDisabled:o,children:[r.jsx(ze,{feature:"paramWidth",children:r.jsx(J,{children:e("parameters.width")})}),r.jsx(Ze,{value:n,onChange:l,defaultValue:s,min:i.sliderMin,max:i.sliderMax,step:i.coarseStep,fineStep:a,marks:c}),r.jsx(Ie,{value:n,onChange:l,defaultValue:s,min:i.numberInputMin,max:i.numberInputMax,step:i.coarseStep,fineStep:a})]})});lq.displayName="BboxWidth";const cq=u.memo(()=>r.jsxs(T,{gap:4,alignItems:"center",children:[r.jsx(T,{gap:4,flexDirection:"column",width:"full",children:r.jsxs(ks,{formLabelProps:xAe,children:[r.jsxs(T,{gap:4,children:[r.jsx(nq,{}),r.jsx(aq,{}),r.jsx(rq,{}),r.jsx(oq,{})]}),r.jsx(lq,{}),r.jsx(sq,{})]})}),r.jsx(T,{w:"108px",h:"108px",flexShrink:0,flexGrow:0,alignItems:"center",justifyContent:"center",children:r.jsx(iq,{})})]}));cq.displayName="BboxSettings";const xAe={minW:10},vAe=hn([tt,nd],(e,t)=>{const{shouldRandomizeSeed:n}=t,s=[],{aspectRatio:i}=e.bbox,{width:o,height:a}=e.bbox.rect;if(s.push(`${o}${a}`),s.push(i.id),i.isLocked&&s.push("locked"),n||s.push("Manual Seed"),s.length===0)return Ls}),CAe={minW:"4.5rem"},uq=u.memo(()=>{const{t:e}=A(),t=I(vAe),n=I(hP),{isOpen:s,onToggle:i}=Ud({id:"image-settings",defaultIsOpen:!0}),{isOpen:o,onToggle:a}=x4({id:"image-settings-advanced",defaultIsOpen:!1}),l=I(Ga),c=I(Oy);return r.jsx(ud,{label:e("accordions.image.title"),badges:t,isOpen:s,onToggle:i,children:r.jsxs(T,{px:4,pt:4,w:"full",h:"full",flexDir:"column","data-testid":"image-settings-accordion",children:[r.jsx(cq,{}),r.jsxs(T,{py:3,gap:4,alignItems:"center",children:[r.jsx(g4,{}),r.jsx(y4,{}),r.jsx(m4,{})]}),r.jsx(nj,{label:e("accordions.advanced.options"),isOpen:o,onToggle:a,children:r.jsxs(T,{gap:4,pb:4,flexDir:"column",children:[(l||c)&&r.jsx(tq,{}),r.jsx(pAe,{}),n!=="none"&&r.jsxs(ks,{formLabelProps:CAe,children:[r.jsx(dAe,{}),r.jsx(oAe,{})]})]})})]})})});uq.displayName="ImageSettingsAccordion";const wAe=()=>{const{t:e}=A(),t=G(),n=I(jie),s=I(zy),i=u.useMemo(()=>[s.sliderMin,Math.floor(s.sliderMax/2),s.sliderMax],[s.sliderMax,s.sliderMin]),o=u.useCallback(a=>t(kie(a)),[t]);return r.jsxs(K,{children:[r.jsx(ze,{feature:"refinerCfgScale",children:r.jsx(J,{children:e("sdxl.cfgScale")})}),r.jsx(Ze,{value:n,defaultValue:s.initial,min:s.sliderMin,max:s.sliderMax,step:s.coarseStep,fineStep:s.fineStep,onChange:o,marks:i}),r.jsx(Ie,{value:n,defaultValue:s.initial,min:s.numberInputMin,max:s.numberInputMax,step:s.coarseStep,fineStep:s.fineStep,onChange:o})]})},SAe=u.memo(wAe),jAe=e=>e.base==="sdxl-refiner",kAe=()=>{const e=G(),t=I(_ie),{t:n}=A(),[s,{isLoading:i}]=mb(),o=u.useCallback(p=>{if(!p){e(NI(null));return}e(NI(Ei.parse(p)))},[e]),{options:a,value:l,onChange:c,placeholder:d,noOptionsMessage:h}=ll({modelConfigs:s,onChange:o,selectedModel:t,isLoading:i,optionsFilter:jAe}),f=u.useCallback(()=>{o(null)},[o]);return r.jsxs(K,{isDisabled:!a.length,isInvalid:!a.length,w:"full",children:[r.jsx(ze,{feature:"refinerModel",children:r.jsx(J,{children:n("sdxl.refinermodel")})}),r.jsxs(T,{w:"full",minW:0,gap:2,alignItems:"center",children:[r.jsx(Ne,{value:l,placeholder:d,options:a,onChange:c,noOptionsMessage:h}),r.jsx(oe,{size:"sm",variant:"ghost",icon:r.jsx(Ot,{}),"aria-label":n("common.reset"),onClick:f,isDisabled:!l})]})]})},_Ae=u.memo(kAe),IAe=()=>{const e=I(Iie),t=G(),{t:n}=A(),s=u.useCallback(i=>t(Tie(i)),[t]);return r.jsxs(K,{children:[r.jsx(ze,{feature:"refinerNegativeAestheticScore",children:r.jsx(J,{children:n("sdxl.negAestheticScore")})}),r.jsx(Ze,{min:1,max:10,step:.5,fineStep:.1,onChange:s,value:e,defaultValue:2.5,marks:!0}),r.jsx(Ie,{min:1,max:10,step:.5,fineStep:.1,onChange:s,value:e,defaultValue:2.5})]})},TAe=u.memo(IAe),AAe=()=>{const e=I(Aie),t=G(),{t:n}=A(),s=u.useCallback(i=>t(Eie(i)),[t]);return r.jsxs(K,{children:[r.jsx(ze,{feature:"refinerPositiveAestheticScore",children:r.jsx(J,{children:n("sdxl.posAestheticScore")})}),r.jsx(Ze,{step:.5,min:1,max:10,fineStep:.1,onChange:s,value:e,defaultValue:6,marks:!0}),r.jsx(Ie,{step:.5,min:1,max:10,fineStep:.1,onChange:s,value:e,defaultValue:6})]})},EAe=u.memo(AAe),MAe=()=>{const e=G(),{t}=A(),n=I(Mie),s=u.useCallback(o=>{Zp(o==null?void 0:o.value)&&e(Pie(o.value))},[e]),i=u.useMemo(()=>ho.find(o=>o.value===n),[n]);return r.jsxs(K,{children:[r.jsx(ze,{feature:"refinerScheduler",children:r.jsx(J,{children:t("sdxl.scheduler")})}),r.jsx(Ne,{value:i,options:ho,onChange:s})]})},PAe=u.memo(MAe),LAe=()=>{const e=I(Lie),t=G(),n=u.useCallback(i=>t(Die(i)),[t]),{t:s}=A();return r.jsxs(K,{children:[r.jsx(ze,{feature:"refinerStart",children:r.jsx(J,{children:s("sdxl.refinerStart")})}),r.jsx(Ze,{step:.01,min:0,max:1,onChange:n,defaultValue:.8,value:e,marks:!0}),r.jsx(Ie,{step:.01,min:0,max:1,onChange:n,defaultValue:.8,value:e})]})},DAe=u.memo(LAe),RAe=()=>{const{t:e}=A(),t=G(),n=I(Rie),s=I(JS),i=u.useMemo(()=>[s.sliderMin,Math.floor(s.sliderMax/2),s.sliderMax],[s.sliderMax,s.sliderMin]),o=u.useCallback(a=>{t(Oie(a))},[t]);return r.jsxs(K,{children:[r.jsx(ze,{feature:"refinerSteps",children:r.jsx(J,{children:e("sdxl.steps")})}),r.jsx(Ze,{value:n,defaultValue:s.initial,min:s.sliderMin,max:s.sliderMax,step:s.coarseStep,fineStep:s.fineStep,onChange:o,marks:i}),r.jsx(Ie,{value:n,defaultValue:s.initial,min:s.numberInputMin,max:s.numberInputMax,step:s.coarseStep,fineStep:s.fineStep,onChange:o})]})},OAe=u.memo(RAe),NAe=()=>{const[e]=mb();return!!e.length},FAe={minW:"9.2rem"},BAe={minW:"5rem"},$Ae=hn(nd,e=>e.refinerModel?["Enabled"]:void 0),dq=u.memo(()=>{const{t:e}=A(),t=NAe(),n=I($Ae),{isOpen:s,onToggle:i}=Ud({id:"refiner-settings",defaultIsOpen:!1});return r.jsx(ud,{label:e("sdxl.refiner"),badges:n,isOpen:s,onToggle:i,children:t?r.jsx(fq,{}):r.jsx(hq,{})})});dq.displayName="RefinerSettingsAccordion";const hq=u.memo(()=>{const{t:e}=A();return r.jsx(T,{justifyContent:"center",p:4,children:r.jsx(q,{fontSize:"sm",color:"base.500",children:e("models.noRefinerModelsInstalled")})})});hq.displayName="RefinerSettingsAccordionNoRefiner";const fq=u.memo(()=>{const e=I(Nie);return r.jsx(ks,{isDisabled:!e,children:r.jsxs(T,{p:4,gap:4,flexDir:"column",minW:0,children:[r.jsx(_Ae,{}),r.jsxs(ks,{formLabelProps:BAe,isDisabled:!e,children:[r.jsx(PAe,{}),r.jsx(OAe,{}),r.jsx(SAe,{}),r.jsx(DAe,{})]}),r.jsxs(ks,{formLabelProps:FAe,isDisabled:!e,children:[r.jsx(EAe,{}),r.jsx(TAe,{})]})]})})});fq.displayName="RefinerSettingsAccordionContent";const VAe={svg:{animation:Vy}},zAe=()=>{const[e,{isLoading:t}]=Fie(),{t:n}=A(),{presetCount:s}=Yp(void 0,{selectFromResult:({data:o})=>({presetCount:((o==null?void 0:o.filter(l=>l.type!=="default"))??Ls).length})}),i=u.useCallback(async()=>{let o;try{const a=await e().unwrap();o=new Blob([a],{type:"text/csv"})}catch{ge({status:"error",title:n("stylePresets.exportFailed")});return}if(o){const a=window.URL.createObjectURL(o),l=document.createElement("a");l.href=a,l.download="data.csv",document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(a),ge({status:"success",title:n("stylePresets.exportDownloaded")})}},[e,n]);return r.jsx(oe,{onClick:i,icon:t?r.jsx(d7,{}):r.jsx(md,{}),tooltip:n("stylePresets.exportPromptTemplates"),"aria-label":n("stylePresets.exportPromptTemplates"),size:"md",variant:"link",w:8,h:8,sx:t?VAe:void 0,isDisabled:t||s===0})},GAe={svg:{animation:Vy}},HAe=()=>{const[e,{isLoading:t}]=Bie(),{t:n}=A(),s=u.useCallback(a=>{const l=a[0];l&&e(l).unwrap().then(()=>{ge({status:"success",title:n("toast.importSuccessful")})}).catch(c=>{ge({status:"error",title:n("toast.importFailed"),description:c?`${c.data.detail}`:void 0})})},[e,n]),{getInputProps:i,getRootProps:o}=sa({accept:{"text/csv":[".csv"],"application/json":[".json"]},onDropAccepted:s,noDrag:!0,multiple:!1});return r.jsxs(r.Fragment,{children:[r.jsx(oe,{icon:t?r.jsx(d7,{}):r.jsx(cg,{}),tooltip:r.jsx(WAe,{}),"aria-label":n("stylePresets.importTemplates"),size:"md",variant:"link",w:8,h:8,sx:t?GAe:void 0,isDisabled:t,...o()}),r.jsx("input",{...i()})]})},WAe=()=>{const{t:e}=A();return r.jsxs(T,{flexDir:"column",children:[r.jsx(q,{pb:1,fontWeight:"semibold",children:e("stylePresets.importTemplates")}),r.jsx(q,{children:e("stylePresets.acceptedColumnsKeys")}),r.jsxs(or,{children:[r.jsx(Rt,{children:e("stylePresets.nameColumn")}),r.jsx(Rt,{children:e("stylePresets.positivePromptColumn")}),r.jsx(Rt,{children:e("stylePresets.negativePromptColumn")})]})]})},UAe=()=>{const e=u.useCallback(()=>{Wa.set({prefilledFormData:null,updatingStylePresetId:null,isModalOpen:!0})},[]),{t}=A();return r.jsx(oe,{icon:r.jsx(Vt,{}),tooltip:t("stylePresets.createPromptTemplate"),"aria-label":t("stylePresets.createPromptTemplate"),onClick:e,size:"md",variant:"ghost",w:8,h:8})},qd=u.memo,zc="40px",qAe="24px",KAe=({presetImageUrl:e,imageWidth:t})=>r.jsx(Ee,{closeOnScroll:!0,openDelay:0,label:e&&r.jsx(Wt,{src:e,draggable:!1,objectFit:"cover",maxW:150,aspectRatio:"1/1",borderRadius:"base",borderBottomRadius:"lg"}),p:2,children:r.jsx(Wt,{src:e||"",fallbackStrategy:"beforeLoadOrError",fallback:r.jsx(T,{height:t||zc,minWidth:t||zc,bg:"base.650",borderRadius:"base",alignItems:"center",justifyContent:"center",children:r.jsx(lt,{color:"base.500",as:Wj,boxSize:t?t/2:qAe})}),objectFit:"cover",objectPosition:"50% 50%",height:t||zc,width:t||zc,minHeight:t||zc,minWidth:t||zc,borderRadius:"base"})}),pq=qd(KAe),ZAe=({preset:e})=>{const t=G(),n=I(Ep),{t:s}=A(),i=F0e(),o=u.useCallback(d=>{d.stopPropagation();const{name:h,preset_data:f}=e,{positive_prompt:p,negative_prompt:g}=f;Wa.set({prefilledFormData:{name:h,positivePrompt:p||"",negativePrompt:g||"",imageUrl:e.image,type:e.type},updatingStylePresetId:e.id,isModalOpen:!0})},[e]),a=u.useCallback(()=>{t(R0(e.id)),Uf.set(!1)},[t,e.id]),l=u.useCallback(d=>{d.stopPropagation(),i(e)},[i,e]),c=u.useCallback(d=>{d.stopPropagation();const{name:h,preset_data:f}=e,{positive_prompt:p,negative_prompt:g}=f;Wa.set({prefilledFormData:{name:`${h} (${s("common.copy")})`,positivePrompt:p||"",negativePrompt:g||"",imageUrl:e.image,type:"user"},updatingStylePresetId:null,isModalOpen:!0})},[e,s]);return r.jsxs(T,{gap:4,onClick:a,cursor:"pointer",_hover:{backgroundColor:"base.750"},py:3,px:2,borderRadius:"base",alignItems:"flex-start",w:"full",children:[r.jsx(pq,{presetImageUrl:e.image}),r.jsxs(T,{flexDir:"column",w:"full",children:[r.jsxs(T,{w:"full",justifyContent:"space-between",alignItems:"flex-start",children:[r.jsxs(T,{alignItems:"center",gap:2,children:[r.jsx(q,{fontSize:"md",noOfLines:2,children:e.name}),n===e.id&&r.jsx(Kn,{color:"invokeBlue.400",borderColor:"invokeBlue.700",borderWidth:1,bg:"transparent",flexShrink:0,children:s("stylePresets.active")})]}),r.jsxs(T,{alignItems:"center",gap:1,children:[r.jsx(oe,{size:"sm",variant:"ghost","aria-label":s("stylePresets.copyTemplate"),onClick:c,icon:r.jsx(un,{})}),e.type!=="default"&&r.jsxs(r.Fragment,{children:[r.jsx(oe,{size:"sm",variant:"ghost","aria-label":s("stylePresets.editTemplate"),onClick:o,icon:r.jsx(cb,{})}),r.jsx(oe,{size:"sm",variant:"ghost","aria-label":s("stylePresets.deleteTemplate"),onClick:l,colorScheme:"error",icon:r.jsx(Vj,{})})]})]})]}),r.jsxs(T,{flexDir:"column",gap:1,children:[r.jsxs(q,{fontSize:"xs",children:[r.jsxs(q,{as:"span",fontWeight:"semibold",children:[s("stylePresets.positivePrompt"),":"]})," ",e.preset_data.positive_prompt]}),r.jsxs(q,{fontSize:"xs",children:[r.jsxs(q,{as:"span",fontWeight:"semibold",children:[s("stylePresets.negativePrompt"),":"]})," ",e.preset_data.negative_prompt]})]})]})]})},i2=({title:e,data:t})=>{const{t:n}=A(),{onToggle:s,isOpen:i}=cr({defaultIsOpen:!0}),o=I(sj);return r.jsxs(T,{flexDir:"column",children:[r.jsx(de,{variant:"unstyled",onClick:s,children:r.jsxs(T,{gap:2,alignItems:"center",children:[r.jsx(lt,{boxSize:4,as:Di,transform:i?void 0:"rotate(-90deg)",fill:"base.500"}),r.jsx(q,{fontSize:"sm",fontWeight:"semibold",userSelect:"none",color:"base.500",children:e})]})}),r.jsx(Ja,{in:i,style:N_,children:t.length?t.map(a=>r.jsx(ZAe,{preset:a},a.id)):r.jsx(Pt,{fontSize:"sm",py:4,label:n(o?"stylePresets.noMatchingTemplates":"stylePresets.noTemplates"),icon:null})})]})},YAe=()=>{const e=G(),t=I(sj),{t:n}=A(),s=u.useCallback(l=>{e(FI(l))},[e]),i=u.useCallback(()=>{e(FI(""))},[e]),o=u.useCallback(l=>{l.key==="Escape"&&i()},[i]),a=u.useCallback(l=>{s(l.target.value)},[s]);return r.jsxs(ta,{children:[r.jsx(kt,{placeholder:n("stylePresets.searchByName"),value:t,onKeyDown:o,onChange:a}),t&&t.length&&r.jsx(co,{h:"full",pe:2,children:r.jsx(oe,{onClick:i,size:"sm",variant:"link","aria-label":n("boards.clearSearch"),icon:r.jsx(Ot,{})})})]})},XAe=u.memo(YAe),gq=()=>{const e=I(sj),t=I(KM),{data:n}=Yp(void 0,{selectFromResult:({data:i})=>({data:((i==null?void 0:i.filter(l=>l.name.toLowerCase().includes(e.toLowerCase())))||Ls).reduce((l,c)=>(c.type==="default"?l.defaultPresets.push(c):c.type==="project"?l.sharedPresets.push(c):l.presets.push(c),l),{defaultPresets:[],sharedPresets:[],presets:[]})})}),{t:s}=A();return r.jsxs(T,{flexDir:"column",gap:2,padding:3,layerStyle:"second",borderRadius:"base",children:[r.jsxs(T,{alignItems:"center",gap:2,w:"full",justifyContent:"space-between",children:[r.jsx(XAe,{}),r.jsx(UAe,{}),r.jsx(HAe,{}),r.jsx(zAe,{})]}),r.jsx(i2,{title:s("stylePresets.myTemplates"),data:n.presets}),t&&r.jsx(i2,{title:s("stylePresets.sharedTemplates"),data:n.sharedPresets}),r.jsx(i2,{title:s("stylePresets.defaultTemplates"),data:n.defaultPresets})]})},QAe=()=>{const e=I(YS),t=I(Ep),{activeStylePreset:n}=Yp(void 0,{selectFromResult:({data:h})=>{let f=null;return h&&(f=h.find(p=>p.id===t)),{activeStylePreset:f}}}),s=G(),{t:i}=A(),{presetModifiedPositivePrompt:o,presetModifiedNegativePrompt:a}=$ie(),l=u.useCallback(h=>{h.stopPropagation(),s(o0(!1)),s(R0(null))},[s]),c=u.useCallback(h=>{h.stopPropagation(),s(wL(o)),s(CL(a)),s(o0(!1)),s(R0(null))},[s,o,a]),d=u.useCallback(h=>{h.stopPropagation(),s(o0(!e))},[s,e]);return n?r.jsxs(T,{w:"full",alignItems:"center",gap:2,minW:0,children:[r.jsx(pq,{imageWidth:25,presetImageUrl:n.image}),r.jsx(Kn,{colorScheme:"invokeBlue",variant:"subtle",justifySelf:"flex-start",children:n.name}),r.jsx(it,{}),r.jsx(Ee,{label:i("stylePresets.toggleViewMode"),children:r.jsx(oe,{onClick:d,variant:"outline",size:"sm","aria-label":i("stylePresets.toggleViewMode"),colorScheme:e?"invokeBlue":"base",icon:r.jsx(yd,{})})}),r.jsx(Ee,{label:i("stylePresets.flatten"),children:r.jsx(oe,{onClick:c,variant:"outline",size:"sm","aria-label":i("stylePresets.flatten"),icon:r.jsx(s7,{})})}),r.jsx(Ee,{label:i("stylePresets.clearTemplateSelection"),children:r.jsx(oe,{onClick:l,variant:"outline",size:"sm","aria-label":i("stylePresets.clearTemplateSelection"),icon:r.jsx(Ot,{})})})]}):r.jsx(T,{h:25,alignItems:"center",children:r.jsx(q,{fontSize:"sm",fontWeight:"semibold",color:"base.300",children:i("stylePresets.choosePromptTemplate")})})},JAe={bg:"base.750"},mq=()=>{const e=ae(Uf),{t}=A(),n=u.useCallback(()=>{Uf.set(!e)},[e]);return r.jsxs(T,{onClick:n,backgroundColor:"base.800",justifyContent:"space-between",alignItems:"center",py:2,px:3,borderRadius:"base",gap:2,role:"button",_hover:JAe,transitionProperty:"background-color",transitionDuration:"normal",w:"full",children:[r.jsx(QAe,{}),r.jsx(oe,{"aria-label":t("stylePresets.viewList"),variant:"ghost",icon:r.jsx(Di,{}),size:"sm"})]})},y8={height:"100%",width:"100%"},eEe=()=>{const e=I(Vie),t=I(MS),n=ae(Uf);return r.jsxs(T,{w:"full",h:"full",flexDir:"column",gap:2,children:[r.jsx(mq,{}),r.jsx(T,{w:"full",h:"full",position:"relative",children:r.jsxs(Se,{position:"absolute",top:0,left:0,right:0,bottom:0,children:[n&&r.jsx(ps,{defer:!0,style:y8,options:Ul.options,children:r.jsx(T,{gap:2,flexDirection:"column",h:"full",w:"full",children:r.jsx(gq,{})})}),r.jsx(ps,{defer:!0,style:y8,options:Ul.options,children:r.jsxs(T,{gap:2,flexDirection:"column",h:"full",w:"full",children:[r.jsx(p4,{}),r.jsx(uq,{}),r.jsx(v4,{}),r.jsx(XU,{}),e&&r.jsx(dq,{}),!t&&r.jsx(b4,{})]})})]})})]})},tEe=u.memo(eEe),nEe={diffusers:"diffusers",lycoris:"lycoris",checkpoint:"checkpoint",invokeai:"internal",embedding_file:"embedding",embedding_folder:"embedding",t5_encoder:"t5_encoder",bnb_quantized_int8b:"bnb_quantized_int8b",bnb_quantized_nf4b:"quantized",gguf_quantized:"gguf"},sEe={diffusers:"base",lycoris:"base",checkpoint:"orange",invokeai:"base",embedding_file:"base",embedding_folder:"base",t5_encoder:"base",bnb_quantized_int8b:"base",bnb_quantized_nf4b:"base",gguf_quantized:"base"},rEe=({format:e})=>r.jsx(Kn,{flexGrow:0,colorScheme:sEe[e],variant:"subtle",children:nEe[e]}),iEe=u.memo(rEe);/**
 * filesize
 *
 * @copyright 2024 Jason Mulligan <jason.mulligan@avoidwork.com>
 * @license BSD-3-Clause
 * @version 10.1.6
 */const oEe="array",aEe="bit",b8="bits",lEe="byte",x8="bytes",Gc="",cEe="exponent",uEe="function",v8="iec",dEe="Invalid number",hEe="Invalid rounding method",o2="jedec",fEe="object",C8=".",pEe="round",gEe="s",mEe="si",yEe="kbit",bEe="kB",xEe=" ",vEe="string",CEe="0",a2={symbol:{iec:{bits:["bit","Kibit","Mibit","Gibit","Tibit","Pibit","Eibit","Zibit","Yibit"],bytes:["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"]},jedec:{bits:["bit","Kbit","Mbit","Gbit","Tbit","Pbit","Ebit","Zbit","Ybit"],bytes:["B","KB","MB","GB","TB","PB","EB","ZB","YB"]}},fullform:{iec:["","kibi","mebi","gibi","tebi","pebi","exbi","zebi","yobi"],jedec:["","kilo","mega","giga","tera","peta","exa","zetta","yotta"]}};function yq(e,{bits:t=!1,pad:n=!1,base:s=-1,round:i=2,locale:o=Gc,localeOptions:a={},separator:l=Gc,spacer:c=xEe,symbols:d={},standard:h=Gc,output:f=vEe,fullform:p=!1,fullforms:g=[],exponent:m=-1,roundingMethod:y=pEe,precision:b=0}={}){let C=m,x=Number(e),v=[],w=0,S=Gc;h===mEe?(s=10,h=o2):h===v8||h===o2?s=2:s===2?h=v8:(s=10,h=o2);const j=s===10?1e3:1024,P=p===!0,E=x<0,D=Math[y];if(typeof e!="bigint"&&isNaN(e))throw new TypeError(dEe);if(typeof D!==uEe)throw new TypeError(hEe);if(E&&(x=-x),(C===-1||isNaN(C))&&(C=Math.floor(Math.log(x)/Math.log(j)),C<0&&(C=0)),C>8&&(b>0&&(b+=8-C),C=8),f===cEe)return C;if(x===0)v[0]=0,S=v[1]=a2.symbol[h][t?b8:x8][C];else{w=x/(s===2?Math.pow(2,C*10):Math.pow(1e3,C)),t&&(w=w*8,w>=j&&C<8&&(w=w/j,C++));const M=Math.pow(10,C>0?i:0);v[0]=D(w*M)/M,v[0]===j&&C<8&&m===-1&&(v[0]=1,C++),S=v[1]=s===10&&C===1?t?yEe:bEe:a2.symbol[h][t?b8:x8][C]}if(E&&(v[0]=-v[0]),b>0&&(v[0]=v[0].toPrecision(b)),v[1]=d[v[1]]||v[1],o===!0?v[0]=v[0].toLocaleString():o.length>0?v[0]=v[0].toLocaleString(o,a):l.length>0&&(v[0]=v[0].toString().replace(C8,l)),n&&i>0){const M=v[0].toString(),R=l||(M.match(/(\D)/g)||[]).pop()||C8,F=M.toString().split(R),_=F[1]||Gc,L=_.length,O=i-L;v[0]=`${F[0]}${R}${_.padEnd(L+O,CEe)}`}return P&&(v[1]=g[C]?g[C]:a2.fullform[h][C]+(t?aEe:lEe)+(v[0]===1?Gc:gEe)),f===oEe?v:f===fEe?{value:v[0],symbol:v[1],exponent:C,unit:S}:v.join(c)}const No="40px",wEe="24px",SEe=({image_url:e})=>e?r.jsx(Wt,{src:e,objectFit:"cover",objectPosition:"50% 50%",height:No,width:No,minHeight:No,minWidth:No,borderRadius:"base"}):r.jsx(T,{height:No,minWidth:No,bg:"base.650",borderRadius:"base",alignItems:"center",justifyContent:"center",children:r.jsx(lt,{color:"base.500",as:Wj,boxSize:wEe})}),jEe=qd(SEe),kEe={_hover:{bg:"base.700"},"&[aria-selected='true']":{bg:"base.700"}},_Ee=({model:e})=>{const{t}=A(),n=G(),s=u.useMemo(()=>fe(zie,p=>p.selectedModelKey===e.key),[e.key]),i=I(s),[o]=Gie(),{isOpen:a,onOpen:l,onClose:c}=cr(),d=u.useCallback(()=>{n(U2(e.key))},[e.key,n]),h=u.useCallback(p=>{p.stopPropagation(),l()},[l]),f=u.useCallback(()=>{o({key:e.key}).unwrap().then(p=>{ge({id:"MODEL_DELETED",title:`${t("modelManager.modelDeleted")}: ${e.name}`,status:"success"})}).catch(p=>{p&&ge({id:"MODEL_DELETE_FAILED",title:`${t("modelManager.modelDeleteFailed")}: ${e.name}`,status:"error"})}),n(U2(null))},[o,e,n,t]);return r.jsxs(T,{sx:kEe,"aria-selected":i,justifyContent:"flex-start",p:2,borderRadius:"base",w:"full",alignItems:"center",gap:2,cursor:"pointer",onClick:d,children:[r.jsxs(T,{gap:2,w:"full",h:"full",minW:0,children:[r.jsx(jEe,{image_url:e.cover_image}),r.jsxs(T,{gap:1,alignItems:"flex-start",flexDir:"column",w:"full",minW:0,children:[r.jsxs(T,{gap:2,w:"full",alignItems:"flex-start",children:[r.jsx(q,{fontWeight:"semibold",noOfLines:1,wordBreak:"break-all",children:e.name}),r.jsx(q,{variant:"subtext",fontStyle:"italic",children:yq(e.file_size)}),r.jsx(it,{})]}),r.jsx(q,{variant:"subtext",noOfLines:1,children:e.description||"No Description"})]}),r.jsxs(T,{h:No,flexDir:"column",alignItems:"flex-end",justifyContent:"space-between",gap:2,children:[r.jsx(f7,{base:e.base}),r.jsx(iEe,{format:e.format})]})]}),r.jsx(oe,{onClick:h,icon:r.jsx(ri,{size:16}),"aria-label":t("modelManager.deleteConfig"),colorScheme:"error",h:No,w:No}),r.jsx(ai,{isOpen:a,onClose:c,title:t("modelManager.deleteModel"),acceptCallback:f,acceptButtonText:t("modelManager.delete"),useInert:!1,children:r.jsxs(T,{rowGap:4,flexDirection:"column",children:[r.jsx(q,{fontWeight:"bold",children:t("modelManager.deleteMsg1")}),r.jsx(q,{children:t("modelManager.deleteMsg2")})]})})]})},IEe=u.memo(_Ee),cs=u.memo(e=>{const{title:t,modelList:n}=e;return r.jsx(Wi,{title:t,contentSx:{gap:1,p:2},children:n.map(s=>r.jsx(IEe,{model:s},s.key))})});cs.displayName="ModelListWrapper";const TEe=()=>{const e=I(FL),t=I(BL),{t:n}=A(),[s,{isLoading:i}]=gb(),o=u.useMemo(()=>xs(s,t,e),[s,t,e]),[a,{isLoading:l}]=mb(),c=u.useMemo(()=>xs(a,t,e),[a,t,e]),[d,{isLoading:h}]=yb(),f=u.useMemo(()=>xs(d,t,e),[d,t,e]),[p,{isLoading:g}]=W7(),m=u.useMemo(()=>xs(p,t,e),[p,t,e]),[y,{isLoading:b}]=Qj(),C=u.useMemo(()=>xs(y,t,e),[y,t,e]),[x,{isLoading:v}]=G7(),w=u.useMemo(()=>xs(x,t,e),[x,t,e]),[S,{isLoading:j}]=H7(),P=u.useMemo(()=>xs(S,t,e),[S,t,e]),[E,{isLoading:D}]=sfe(),M=u.useMemo(()=>xs(E,t,e),[E,t,e]),[R,{isLoading:F}]=bb({excludeSubmodels:!0}),_=u.useMemo(()=>xs(R,t,e),[R,t,e]),[L,{isLoading:O}]=Jj({excludeSubmodels:!0}),B=u.useMemo(()=>xs(L,t,e),[L,t,e]),[z,{isLoading:ee}]=z7(),ne=u.useMemo(()=>xs(z,t,e),[z,t,e]),[re,{isLoading:te}]=xc({excludeSubmodels:!0}),H=u.useMemo(()=>xs(re,t,e),[re,t,e]),[V,{isLoading:X}]=fg(),W=u.useMemo(()=>xs(V,t,e),[V,t,e]),[Y,{isLoading:$}]=q7(),N=u.useMemo(()=>xs(Y,t,e),[Y,t,e]),[U,{isLoading:ie}]=K7(),ue=u.useMemo(()=>xs(U,t,e),[U,t,e]),[xe,{isLoading:Me}]=Z7(),je=u.useMemo(()=>xs(xe,t,e),[xe,t,e]),Fe=u.useMemo(()=>o.length+c.length+f.length+m.length+C.length+w.length+P.length+M.length+_.length+W.length+N.length+ue.length+L.length+re.length+z.length,[C.length,m.length,P.length,M.length,f.length,o.length,c.length,w.length,_.length,W.length,N.length,ue.length,L.length,re.length,z.length]);return r.jsx(os,{children:r.jsxs(T,{flexDirection:"column",w:"full",h:"full",gap:4,children:[i&&r.jsx(Jn,{loadingMessage:"Loading Main Models..."}),!i&&o.length>0&&r.jsx(cs,{title:n("modelManager.main"),modelList:o},"main"),l&&r.jsx(Jn,{loadingMessage:"Loading Refiner Models..."}),!l&&c.length>0&&r.jsx(cs,{title:n("sdxl.refiner"),modelList:c},"refiner"),h&&r.jsx(Jn,{loadingMessage:"Loading LoRAs..."}),!h&&f.length>0&&r.jsx(cs,{title:n("modelManager.loraModels"),modelList:f},"loras"),g&&r.jsx(Jn,{loadingMessage:"Loading Textual Inversions..."}),!g&&m.length>0&&r.jsx(cs,{title:n("modelManager.textualInversions"),modelList:m},"textual-inversions"),F&&r.jsx(Jn,{loadingMessage:"Loading VAEs..."}),!F&&_.length>0&&r.jsx(cs,{title:"VAE",modelList:_},"vae"),b&&r.jsx(Jn,{loadingMessage:"Loading ControlNets..."}),!b&&C.length>0&&r.jsx(cs,{title:"ControlNet",modelList:C},"controlnets"),j&&r.jsx(Jn,{loadingMessage:"Loading IP Adapters..."}),!j&&P.length>0&&r.jsx(cs,{title:n("common.ipAdapter"),modelList:P},"ip-adapters"),D&&r.jsx(Jn,{loadingMessage:"Loading CLIP Vision Models..."}),!D&&M.length>0&&r.jsx(cs,{title:"CLIP Vision",modelList:M},"clip-vision"),v&&r.jsx(Jn,{loadingMessage:"Loading T2I Adapters..."}),!v&&w.length>0&&r.jsx(cs,{title:n("common.t2iAdapter"),modelList:w},"t2i-adapters"),O&&r.jsx(Jn,{loadingMessage:"Loading T5 Encoder Models..."}),!O&&B.length>0&&r.jsx(cs,{title:n("modelManager.t5Encoder"),modelList:B},"t5-encoder"),ee&&r.jsx(Jn,{loadingMessage:"Loading Control Loras..."}),!ee&&ne.length>0&&r.jsx(cs,{title:n("modelManager.controlLora"),modelList:ne},"control-lora"),te&&r.jsx(Jn,{loadingMessage:"Loading Clip Embed Models..."}),!te&&H.length>0&&r.jsx(cs,{title:n("modelManager.clipEmbed"),modelList:H},"clip-embed"),Me&&r.jsx(Jn,{loadingMessage:"Loading LLaVA OneVision Models..."}),!Me&&je.length>0&&r.jsx(cs,{title:n("modelManager.llavaOnevision"),modelList:je},"llava-onevision"),X&&r.jsx(Jn,{loadingMessage:"Loading Image-to-Image Models..."}),!X&&W.length>0&&r.jsx(cs,{title:n("modelManager.spandrelImageToImage"),modelList:W},"spandrel-image-to-image"),$&&r.jsx(Jn,{loadingMessage:"Loading SigLIP Models..."}),!$&&N.length>0&&r.jsx(cs,{title:n("modelManager.sigLip"),modelList:N},"sig-lip"),ie&&r.jsx(Jn,{loadingMessage:"Loading Flux Redux Models..."}),!ie&&ue.length>0&&r.jsx(cs,{title:n("modelManager.fluxRedux"),modelList:ue},"flux-redux"),Fe===0&&r.jsx(T,{w:"full",h:"full",alignItems:"center",justifyContent:"center",children:r.jsx(q,{children:n("modelManager.noMatchingModels")})})]})})},AEe=u.memo(TEe),xs=(e,t,n)=>e.filter(s=>{const i=s.name.toLowerCase().includes(t.toLowerCase()),o=EEe(s,n);return i&&o}),EEe=(e,t)=>t==="refiner"?e.base==="sdxl-refiner":t==="main"&&e.base==="sdxl-refiner"?!1:t?e.type===t:!0,bq=u.memo(()=>{const{t:e}=A(),t=G(),n=u.useMemo(()=>({main:e("modelManager.main"),refiner:e("sdxl.refiner"),lora:"LoRA",embedding:e("modelManager.textualInversions"),controlnet:"ControlNet",vae:"VAE",t2i_adapter:e("common.t2iAdapter"),t5_encoder:e("modelManager.t5Encoder"),clip_embed:e("modelManager.clipEmbed"),ip_adapter:e("common.ipAdapter"),clip_vision:"CLIP Vision",spandrel_image_to_image:e("modelManager.spandrelImageToImage"),control_lora:e("modelManager.controlLora"),siglip:e("modelManager.sigLip"),flux_redux:e("modelManager.fluxRedux"),llava_onevision:e("modelManager.llavaOnevision")}),[e]),s=I(FL),i=u.useCallback(a=>{t(BI(a))},[t]),o=u.useCallback(()=>{t(BI(null))},[t]);return r.jsxs(en,{children:[r.jsx(tn,{as:de,size:"sm",leftIcon:r.jsx(Vde,{}),children:s?n[s]:e("modelManager.allModels")}),r.jsxs(Tt,{children:[r.jsx(pe,{onClick:o,children:e("modelManager.allModels")}),aj(n).map(a=>r.jsx(pe,{bg:s===a?"base.700":"transparent",onClick:i.bind(null,a),children:n[a]},a))]})]})});bq.displayName="ModelTypeFilter";const xq=u.memo(()=>{const e=G(),t=I(BL),n=u.useCallback(i=>{e($I(i.target.value))},[e]),s=u.useCallback(()=>{e($I(""))},[e]);return r.jsxs(T,{gap:2,alignItems:"center",justifyContent:"space-between",children:[r.jsx(bq,{}),r.jsx(it,{}),r.jsxs(ta,{maxW:"400px",children:[r.jsx(kt,{placeholder:Pe("modelManager.search"),value:t||"","data-testid":"board-search-input",onChange:n}),!!(t!=null&&t.length)&&r.jsx(co,{h:"full",pe:2,children:r.jsx(oe,{size:"sm",variant:"link","aria-label":Pe("boards.clearSearch"),icon:r.jsx(Ot,{}),onClick:s})})]})]})});xq.displayName="ModelListNavigation";const vq=u.memo(()=>{const{t:e}=A(),t=G(),n=u.useCallback(()=>{t(U2(null))},[t]),s=I(Jp);return r.jsxs(T,{flexDir:"column",layerStyle:"first",p:4,gap:4,borderRadius:"base",w:"50%",h:"full",children:[r.jsxs(T,{w:"full",gap:4,justifyContent:"space-between",alignItems:"center",children:[r.jsx(Ft,{fontSize:"xl",py:1,children:e("common.modelManager")}),!!s&&r.jsx(de,{size:"sm",colorScheme:"invokeYellow",leftIcon:r.jsx(Vt,{}),onClick:n,children:e("modelManager.addModels")})]}),r.jsxs(T,{flexDir:"column",layerStyle:"second",p:4,gap:4,borderRadius:"base",w:"full",h:"full",children:[r.jsx(xq,{}),r.jsx(AEe,{})]})]})});vq.displayName="ModelManager";const MEe=({model_key:e,model_image:t})=>{const[n,s]=u.useState(t||null),{t:i}=A(),[o,a]=Hie(),[l]=Wie(),c=u.useCallback(p=>{const g=p[0];!g||!e||o({key:e,image:g}).unwrap().then(()=>{s(URL.createObjectURL(g)),ge({id:"MODEL_IMAGE_UPDATED",title:i("modelManager.modelImageUpdated"),status:"success"})}).catch(()=>{ge({id:"MODEL_IMAGE_UPDATE_FAILED",title:i("modelManager.modelImageUpdateFailed"),status:"error"})})},[e,i,o]),d=u.useCallback(()=>{e&&(s(null),l(e).unwrap().then(()=>{ge({id:"MODEL_IMAGE_DELETED",title:i("modelManager.modelImageDeleted"),status:"success"})}).catch(()=>{ge({id:"MODEL_IMAGE_DELETE_FAILED",title:i("modelManager.modelImageDeleteFailed"),status:"error"})}))},[e,i,l]),{getInputProps:h,getRootProps:f}=sa({accept:{"image/png":[".png"],"image/jpeg":[".jpg",".jpeg",".png"],"image/webp":[".webp"]},onDropAccepted:c,noDrag:!0,multiple:!1});return n?r.jsxs(Se,{position:"relative",flexShrink:0,children:[r.jsx(Wt,{src:n,objectFit:"cover",objectPosition:"50% 50%",height:108,width:108,minWidth:108,borderRadius:"base"}),r.jsx(oe,{position:"absolute",insetInlineEnd:0,insetBlockStart:0,onClick:d,"aria-label":i("modelManager.deleteModelImage"),tooltip:i("modelManager.deleteModelImage"),icon:r.jsx(ur,{}),size:"md",variant:"ghost"})]}):r.jsxs(r.Fragment,{children:[r.jsx(oe,{variant:"ghost","aria-label":i("modelManager.uploadImage"),tooltip:i("modelManager.uploadImage"),w:108,h:108,fontSize:36,icon:r.jsx(lg,{}),isLoading:a.isLoading,...f()}),r.jsx("input",{...h()})]})},PEe=qd(MEe),C4=u.memo(({modelConfig:e,children:t})=>{const{t:n}=A();return r.jsxs(T,{alignItems:"flex-start",gap:4,children:[r.jsx(PEe,{model_key:e.key,model_image:e.cover_image}),r.jsxs(T,{flexDir:"column",gap:1,flexGrow:1,minW:0,children:[r.jsxs(T,{gap:2,children:[r.jsx(Ft,{as:"h2",fontSize:"lg",noOfLines:1,wordBreak:"break-all",children:e.name}),r.jsx(it,{}),t]}),e.source&&r.jsxs(q,{variant:"subtext",noOfLines:1,wordBreak:"break-all",children:[n("modelManager.source"),": ",e.source]}),r.jsx(q,{noOfLines:3,children:e.description})]})]})});C4.displayName="ModelHeader";const w8=[{value:"sd-1",label:Oc["sd-1"]},{value:"sd-2",label:Oc["sd-2"]},{value:"sd-3",label:Oc["sd-3"]},{value:"flux",label:Oc.flux},{value:"sdxl",label:Oc.sdxl},{value:"sdxl-refiner",label:Oc["sdxl-refiner"]}],LEe=({control:e})=>{const{field:t}=ys({control:e,name:"base"}),n=u.useMemo(()=>w8.find(i=>i.value===t.value),[t.value]),s=u.useCallback(i=>{t.onChange(i==null?void 0:i.value)},[t]);return r.jsx(Ne,{value:n,options:w8,onChange:s})},DEe=qd(LEe),S8=[{value:"normal",label:"Normal"},{value:"inpaint",label:"Inpaint"},{value:"depth",label:"Depth"}],REe=({control:e})=>{const{field:t}=ys({control:e,name:"variant"}),n=u.useMemo(()=>S8.find(i=>i.value===t.value),[t.value]),s=u.useCallback(i=>{t.onChange(i==null?void 0:i.value)},[t]);return r.jsx(Ne,{value:n,options:S8,onChange:s})},OEe=qd(REe),j8=[{value:"none",label:"-"},{value:"epsilon",label:"epsilon"},{value:"v_prediction",label:"v_prediction"},{value:"sample",label:"sample"}],NEe=({control:e})=>{const{field:t}=ys({control:e,name:"prediction_type"}),n=u.useMemo(()=>j8.find(i=>i.value===t.value),[t.value]),s=u.useCallback(i=>{(i==null?void 0:i.value)==="none"?t.onChange(void 0):t.onChange(i==null?void 0:i.value)},[t]);return r.jsx(Ne,{value:n,options:j8,onChange:s})},FEe=qd(NEe),k8={validate:e=>e&&e.trim().length>3||"Must be at least 3 characters"},Cq=u.memo(({modelConfig:e})=>{var c,d;const{t}=A(),[n,{isLoading:s}]=Gy(),i=G(),o=hg({defaultValues:e,mode:"onChange"}),a=u.useCallback(h=>{const f={key:e.key,body:h};n(f).unwrap().then(p=>{o.reset(p,{keepDefaultValues:!0}),i(q2("view")),ge({id:"MODEL_UPDATED",title:t("modelManager.modelUpdated"),status:"success"})}).catch(p=>{o.reset(),ge({id:"MODEL_UPDATE_FAILED",title:t("modelManager.modelUpdateFailed"),status:"error"})})},[i,e.key,o,t,n]),l=u.useCallback(()=>{i(q2("view"))},[i]);return r.jsxs(T,{flexDir:"column",gap:4,children:[r.jsxs(C4,{modelConfig:e,children:[r.jsx(de,{flexShrink:0,size:"sm",onClick:l,leftIcon:r.jsx(Ot,{}),children:t("common.cancel")}),r.jsx(de,{flexShrink:0,size:"sm",colorScheme:"invokeYellow",leftIcon:r.jsx(og,{}),onClick:o.handleSubmit(a),isLoading:s,isDisabled:!!Object.keys(o.formState.errors).length,children:t("common.save")})]}),r.jsx(T,{flexDir:"column",h:"full",children:r.jsxs("form",{children:[r.jsx(T,{w:"full",justifyContent:"space-between",gap:4,alignItems:"center",children:r.jsxs(K,{flexDir:"column",alignItems:"flex-start",gap:1,isInvalid:!!o.formState.errors.name,children:[r.jsx(J,{children:t("modelManager.modelName")}),r.jsx(kt,{...o.register("name",k8),size:"md"}),((c=o.formState.errors.name)==null?void 0:c.message)&&r.jsx(Tp,{children:(d=o.formState.errors.name)==null?void 0:d.message})]})}),r.jsxs(T,{flexDir:"column",gap:3,mt:"4",children:[r.jsx(T,{gap:"4",alignItems:"center",children:r.jsxs(K,{flexDir:"column",alignItems:"flex-start",gap:1,children:[r.jsx(J,{children:t("modelManager.description")}),r.jsx(ss,{...o.register("description"),minH:32})]})}),e.type!=="clip_vision"&&r.jsx(Ft,{as:"h3",fontSize:"md",mt:"4",children:t("modelManager.modelSettings")}),r.jsxs(Hy,{columns:2,gap:4,children:[e.type!=="clip_vision"&&r.jsxs(K,{flexDir:"column",alignItems:"flex-start",gap:1,children:[r.jsx(J,{children:t("modelManager.baseModel")}),r.jsx(DEe,{control:o.control})]}),e.type==="main"&&r.jsxs(K,{flexDir:"column",alignItems:"flex-start",gap:1,children:[r.jsx(J,{children:t("modelManager.variant")}),r.jsx(OEe,{control:o.control})]}),e.type==="main"&&e.format==="checkpoint"&&r.jsxs(r.Fragment,{children:[r.jsxs(K,{flexDir:"column",alignItems:"flex-start",gap:1,children:[r.jsx(J,{children:t("modelManager.pathToConfig")}),r.jsx(kt,{...o.register("config_path",k8)})]}),r.jsxs(K,{flexDir:"column",alignItems:"flex-start",gap:1,children:[r.jsx(J,{children:t("modelManager.predictionType")}),r.jsx(FEe,{control:o.control})]}),r.jsxs(K,{flexDir:"column",alignItems:"flex-start",gap:1,children:[r.jsx(J,{children:t("modelManager.upcastAttention")}),r.jsx(Sn,{...o.register("upcast_attention")})]})]})]})]})]})})]})});Cq.displayName="ModelEdit";const BEe=e=>u.useMemo(()=>{var n,s;return{preprocessor:{isEnabled:!qe((n=e==null?void 0:e.default_settings)==null?void 0:n.preprocessor),value:((s=e==null?void 0:e.default_settings)==null?void 0:s.preprocessor)||"none"}}},[e==null?void 0:e.default_settings]),Fi=Wp(e=>{const{field:t}=ys(e),n=u.useMemo(()=>!!t.value.isEnabled,[t.value]),s=u.useCallback(i=>{const o={...t.value,isEnabled:i.target.checked};t.onChange(o)},[t]);return r.jsx(et,{size:"sm",isChecked:n,onChange:s})});Fi.displayName="SettingToggle";const _8=[{label:"Canny",value:"canny_image_processor"},{label:"MLSD",value:"mlsd_image_processor"},{label:"Depth Anything",value:"depth_anything_image_processor"},{label:"Normal BAE",value:"normalbae_image_processor"},{label:"Pidi",value:"pidi_image_processor"},{label:"Lineart",value:"lineart_image_processor"},{label:"Lineart Anime",value:"lineart_anime_image_processor"},{label:"HED",value:"hed_image_processor"},{label:"Content Shuffle",value:"content_shuffle_image_processor"},{label:"DW OpenPose",value:"dw_openpose_image_processor"},{label:"MediaPipe Face",value:"mediapipe_face_processor"},{label:"ZoeDepth",value:"zoe_depth_image_processor"},{label:"Color Map",value:"color_map_image_processor"},{label:"None",value:"none"}],wq=u.memo(e=>{const{t}=A(),{field:n}=ys(e),s=u.useCallback(a=>{if(!a)return;const l={...n.value,value:a.value};n.onChange(l)},[n]),i=u.useMemo(()=>_8.find(a=>a.value===n.value.value),[n]),o=u.useMemo(()=>!n.value.isEnabled,[n.value]);return r.jsxs(K,{flexDir:"column",gap:2,alignItems:"flex-start",children:[r.jsxs(T,{justifyContent:"space-between",w:"full",children:[r.jsx(ze,{feature:"controlNetProcessor",children:r.jsx(J,{children:t("controlLayers.filter.filter")})}),r.jsx(Fi,{control:e.control,name:"preprocessor"})]}),r.jsx(Ne,{isDisabled:o,value:i,options:_8,onChange:s})]})});wq.displayName="DefaultPreprocessor";const Sq=u.memo(({modelConfig:e})=>{const{t}=A(),n=BEe(e),[s,{isLoading:i}]=Gy(),{handleSubmit:o,control:a,formState:l,reset:c}=hg({defaultValues:n}),d=u.useCallback(h=>{const f={preprocessor:h.preprocessor.isEnabled?h.preprocessor.value:null};s({key:e.key,body:{default_settings:f}}).unwrap().then(p=>{ge({id:"DEFAULT_SETTINGS_SAVED",title:t("modelManager.defaultSettingsSaved"),status:"success"}),c(h)}).catch(p=>{p&&ge({id:"DEFAULT_SETTINGS_SAVE_FAILED",title:`${p.data.detail} `,status:"error"})})},[s,e.key,t,c]);return r.jsxs(r.Fragment,{children:[r.jsxs(T,{gap:"4",justifyContent:"space-between",w:"full",pb:4,children:[r.jsx(Ft,{fontSize:"md",children:t("modelManager.defaultSettings")}),r.jsx(de,{size:"sm",leftIcon:r.jsx(og,{}),colorScheme:"invokeYellow",isDisabled:!l.isDirty,onClick:o(d),isLoading:i,children:t("common.save")})]}),r.jsx(Hy,{columns:2,gap:8,children:r.jsx(wq,{control:a,name:"preprocessor"})})]})});Sq.displayName="ControlAdapterModelDefaultSettings";const jq=u.memo(({modelConfig:e})=>{const{t}=A(),[n,{isLoading:s}]=Uie(),{isOpen:i,onOpen:o,onClose:a}=cr(),l=u.useCallback(()=>{if(!e||s)return;const c=`CONVERTING_MODEL_${e.key}`;ge({id:c,title:`${t("modelManager.convertingModelBegin")}: ${e.name}`,status:"info"}),n(e.key).unwrap().then(()=>{ge({id:c,title:`${t("modelManager.modelConverted")}: ${e.name}`,status:"success"})}).catch(()=>{ge({id:c,title:`${t("modelManager.modelConversionFailed")}: ${e.name}`,status:"error"})})},[e,s,t,n]);return r.jsxs(r.Fragment,{children:[r.jsxs(de,{onClick:o,size:"sm","aria-label":t("modelManager.convertToDiffusers"),className:" modal-close-btn",isLoading:s,flexShrink:0,children:[" ",t("modelManager.convert")]}),r.jsx(ai,{title:`${t("modelManager.convert")} ${e.name}`,acceptCallback:l,acceptButtonText:`${t("modelManager.convert")}`,isOpen:i,onClose:a,useInert:!1,children:r.jsxs(T,{flexDirection:"column",rowGap:4,children:[r.jsx(q,{fontSize:"md",children:t("modelManager.convertToDiffusersHelpText1")}),r.jsxs(or,{children:[r.jsx(Rt,{children:r.jsx(q,{fontSize:"md",children:t("modelManager.convertToDiffusersHelpText2")})}),r.jsx(Rt,{children:r.jsx(q,{fontSize:"md",children:t("modelManager.convertToDiffusersHelpText3")})}),r.jsx(Rt,{children:r.jsx(q,{fontSize:"md",children:t("modelManager.convertToDiffusersHelpText4")})}),r.jsx(Rt,{children:r.jsx(q,{fontSize:"md",children:t("modelManager.convertToDiffusersHelpText5")})})]}),r.jsx(wt,{}),r.jsx(q,{fontSize:"md",children:t("modelManager.convertToDiffusersHelpText6")})]})})]})});jq.displayName="ModelConvertButton";const kq=u.memo(()=>{const{t:e}=A(),t=G(),n=u.useCallback(()=>{t(q2("edit"))},[t]);return r.jsx(de,{size:"sm",leftIcon:r.jsx(cb,{}),colorScheme:"invokeYellow",onClick:n,flexShrink:0,children:e("modelManager.edit")})});kq.displayName="ModelEditButton";const _q=u.memo(({modelConfig:e})=>{const{t}=A(),[n,s]=u.useState(""),[i,{isLoading:o}]=Gy(),a=u.useCallback(p=>{s(p.target.value)},[]),l=u.useMemo(()=>(e==null?void 0:e.trigger_phrases)||[],[e]),c=u.useMemo(()=>{const p=[];return n.length&&l.includes(n)&&p.push("Phrase is already in list"),p},[n,l]),d=u.useCallback(async()=>{!n.length||l.includes(n)||(s(""),await i({key:e.key,body:{trigger_phrases:[...l,n]}}).unwrap())},[n,l,i,e.key]),h=u.useCallback(async p=>{const g=l.filter(m=>m!==p);await i({key:e.key,body:{trigger_phrases:g}}).unwrap()},[l,i,e]),f=u.useCallback(p=>{p.preventDefault(),d()},[d]);return r.jsxs(T,{flexDir:"column",w:"full",gap:"5",children:[r.jsx("form",{onSubmit:f,children:r.jsxs(K,{w:"full",isInvalid:!!c.length,orientation:"vertical",children:[r.jsx(J,{children:t("modelManager.triggerPhrases")}),r.jsxs(T,{flexDir:"column",w:"full",children:[r.jsxs(T,{gap:"3",alignItems:"center",w:"full",children:[r.jsx(kt,{value:n,onChange:a,placeholder:t("modelManager.typePhraseHere")}),r.jsx(de,{leftIcon:r.jsx(Vt,{}),size:"sm",onClick:d,isDisabled:!n||!!c.length,isLoading:o,children:t("common.add")})]}),c.map(p=>r.jsx(Tp,{children:p},p))]})]})}),r.jsx(T,{gap:"4",flexWrap:"wrap",children:l.map((p,g)=>r.jsxs(DS,{size:"md",py:2,px:4,bg:"base.700",children:[r.jsx(JP,{children:p}),r.jsx(RS,{onClick:h.bind(null,p),isDisabled:o})]},g))})]})});_q.displayName="TriggerPhrases";const $Ee=hn(Pr,e=>{const{steps:t,guidance:n,scheduler:s,cfgRescaleMultiplier:i,vaePrecision:o,width:a,height:l}=e.sd,{guidance:c}=e.flux;return{initialSteps:t.initial,initialCfg:n.initial,initialScheduler:s,initialCfgRescaleMultiplier:i.initial,initialVaePrecision:o,initialWidth:a.initial,initialHeight:l.initial,initialGuidance:c.initial}}),VEe=e=>{const{initialSteps:t,initialCfg:n,initialScheduler:s,initialCfgRescaleMultiplier:i,initialVaePrecision:o,initialWidth:a,initialHeight:l,initialGuidance:c}=I($Ee);return u.useMemo(()=>{var h,f,p,g,m,y,b,C,x,v,w,S,j,P,E,D,M,R;return{vae:{isEnabled:!qe((h=e==null?void 0:e.default_settings)==null?void 0:h.vae),value:((f=e==null?void 0:e.default_settings)==null?void 0:f.vae)||"default"},vaePrecision:{isEnabled:!qe((p=e==null?void 0:e.default_settings)==null?void 0:p.vae_precision),value:((g=e==null?void 0:e.default_settings)==null?void 0:g.vae_precision)||o||"fp32"},scheduler:{isEnabled:!qe((m=e==null?void 0:e.default_settings)==null?void 0:m.scheduler),value:((y=e==null?void 0:e.default_settings)==null?void 0:y.scheduler)||s||"dpmpp_3m_k"},steps:{isEnabled:!qe((b=e==null?void 0:e.default_settings)==null?void 0:b.steps),value:((C=e==null?void 0:e.default_settings)==null?void 0:C.steps)||t},cfgScale:{isEnabled:!qe((x=e==null?void 0:e.default_settings)==null?void 0:x.cfg_scale),value:((v=e==null?void 0:e.default_settings)==null?void 0:v.cfg_scale)||n},cfgRescaleMultiplier:{isEnabled:!qe((w=e==null?void 0:e.default_settings)==null?void 0:w.cfg_rescale_multiplier),value:((S=e==null?void 0:e.default_settings)==null?void 0:S.cfg_rescale_multiplier)||i},width:{isEnabled:!qe((j=e==null?void 0:e.default_settings)==null?void 0:j.width),value:((P=e==null?void 0:e.default_settings)==null?void 0:P.width)||a},height:{isEnabled:!qe((E=e==null?void 0:e.default_settings)==null?void 0:E.height),value:((D=e==null?void 0:e.default_settings)==null?void 0:D.height)||l},guidance:{isEnabled:!qe((M=e==null?void 0:e.default_settings)==null?void 0:M.guidance),value:((R=e==null?void 0:e.default_settings)==null?void 0:R.guidance)||c}}},[e,o,s,t,n,i,a,l,c])},Iq=u.memo(({control:e,optimalDimension:t})=>{const{field:n}=ys({control:e,name:"height"}),s=I(OL),{t:i}=A(),o=u.useMemo(()=>[s.sliderMin,t,s.sliderMax],[s.sliderMin,t,s.sliderMax]),a=u.useCallback(d=>{const h={...n.value,value:d};n.onChange(h)},[n]),l=u.useMemo(()=>n.value.value,[n.value]),c=u.useMemo(()=>!n.value.isEnabled,[n.value]);return r.jsxs(K,{flexDir:"column",gap:2,alignItems:"flex-start",children:[r.jsxs(T,{justifyContent:"space-between",w:"full",children:[r.jsx(ze,{feature:"paramHeight",children:r.jsx(J,{children:i("parameters.height")})}),r.jsx(Fi,{control:e,name:"height"})]}),r.jsxs(T,{w:"full",gap:4,children:[r.jsx(Ze,{value:l,min:s.sliderMin,max:s.sliderMax,step:s.coarseStep,fineStep:s.fineStep,onChange:a,marks:o,isDisabled:c}),r.jsx(Ie,{value:l,min:s.numberInputMin,max:s.numberInputMax,step:s.coarseStep,fineStep:s.fineStep,onChange:a,isDisabled:c})]})]})});Iq.displayName="DefaultHeight";const Tq=u.memo(({control:e,optimalDimension:t})=>{const{field:n}=ys({control:e,name:"width"}),s=I(NL),{t:i}=A(),o=u.useMemo(()=>[s.sliderMin,t,s.sliderMax],[s.sliderMin,t,s.sliderMax]),a=u.useCallback(d=>{const h={...n.value,value:d};n.onChange(h)},[n]),l=u.useMemo(()=>n.value.value,[n.value]),c=u.useMemo(()=>!n.value.isEnabled,[n.value]);return r.jsxs(K,{flexDir:"column",gap:2,alignItems:"flex-start",children:[r.jsxs(T,{justifyContent:"space-between",w:"full",children:[r.jsx(ze,{feature:"paramWidth",children:r.jsx(J,{children:i("parameters.width")})}),r.jsx(Fi,{control:e,name:"width"})]}),r.jsxs(T,{w:"full",gap:4,children:[r.jsx(Ze,{value:l,min:s.sliderMin,max:s.sliderMax,step:s.coarseStep,fineStep:s.fineStep,onChange:a,marks:o,isDisabled:c}),r.jsx(Ie,{value:l,min:s.numberInputMin,max:s.numberInputMax,step:s.coarseStep,fineStep:s.fineStep,onChange:a,isDisabled:c})]})]})});Tq.displayName="DefaultWidth";const Aq=u.memo(e=>{const{field:t}=ys(e),n=I(jL),{t:s}=A(),i=u.useMemo(()=>[n.sliderMin,Math.floor(n.sliderMax/2),n.sliderMax],[n.sliderMax,n.sliderMin]),o=u.useCallback(c=>{const d={...t.value,value:c};t.onChange(d)},[t]),a=u.useMemo(()=>t.value.value,[t.value]),l=u.useMemo(()=>!t.value.isEnabled,[t.value]);return r.jsxs(K,{flexDir:"column",gap:2,alignItems:"flex-start",children:[r.jsxs(T,{justifyContent:"space-between",w:"full",children:[r.jsx(ze,{feature:"paramCFGRescaleMultiplier",children:r.jsx(J,{children:s("parameters.cfgRescaleMultiplier")})}),r.jsx(Fi,{control:e.control,name:"cfgRescaleMultiplier"})]}),r.jsxs(T,{w:"full",gap:4,children:[r.jsx(Ze,{value:a,min:n.sliderMin,max:n.sliderMax,step:n.coarseStep,fineStep:n.fineStep,onChange:o,marks:i,isDisabled:l}),r.jsx(Ie,{value:a,min:n.numberInputMin,max:n.numberInputMax,step:n.coarseStep,fineStep:n.fineStep,onChange:o,isDisabled:l})]})]})});Aq.displayName="DefaultCfgRescaleMultiplier";const Eq=u.memo(e=>{const{field:t}=ys(e),n=I(zy),{t:s}=A(),i=u.useMemo(()=>[n.sliderMin,Math.floor(n.sliderMax/2),n.sliderMax],[n.sliderMax,n.sliderMin]),o=u.useCallback(c=>{const d={...t.value,value:c};t.onChange(d)},[t]),a=u.useMemo(()=>t.value.value,[t.value]),l=u.useMemo(()=>!t.value.isEnabled,[t.value]);return r.jsxs(K,{flexDir:"column",gap:2,alignItems:"flex-start",children:[r.jsxs(T,{justifyContent:"space-between",w:"full",children:[r.jsx(ze,{feature:"paramCFGScale",children:r.jsx(J,{children:s("parameters.cfgScale")})}),r.jsx(Fi,{control:e.control,name:"cfgScale"})]}),r.jsxs(T,{w:"full",gap:4,children:[r.jsx(Ze,{value:a,min:n.sliderMin,max:n.sliderMax,step:n.coarseStep,fineStep:n.fineStep,onChange:o,marks:i,isDisabled:l}),r.jsx(Ie,{value:a,min:n.numberInputMin,max:n.numberInputMax,step:n.coarseStep,fineStep:n.fineStep,onChange:o,isDisabled:l})]})]})});Eq.displayName="DefaultCfgScale";const Mq=u.memo(e=>{const{field:t}=ys(e),n=I(LL),{t:s}=A(),i=u.useMemo(()=>[n.sliderMin,Math.floor(n.sliderMax-(n.sliderMax-n.sliderMin)/2),n.sliderMax],[n.sliderMax,n.sliderMin]),o=u.useCallback(c=>{const d={...t.value,value:c};t.onChange(d)},[t]),a=u.useMemo(()=>t.value.value,[t.value]),l=u.useMemo(()=>!t.value.isEnabled,[t.value]);return r.jsxs(K,{flexDir:"column",gap:2,alignItems:"flex-start",children:[r.jsxs(T,{justifyContent:"space-between",w:"full",children:[r.jsx(ze,{feature:"paramGuidance",children:r.jsx(J,{children:s("parameters.guidance")})}),r.jsx(Fi,{control:e.control,name:"guidance"})]}),r.jsxs(T,{w:"full",gap:4,children:[r.jsx(Ze,{value:a,min:n.sliderMin,max:n.sliderMax,step:n.coarseStep,fineStep:n.fineStep,onChange:o,marks:i,isDisabled:l}),r.jsx(Ie,{value:a,min:n.numberInputMin,max:n.numberInputMax,step:n.coarseStep,fineStep:n.fineStep,onChange:o,isDisabled:l})]})]})});Mq.displayName="DefaultGuidance";const Pq=u.memo(e=>{const{t}=A(),{field:n}=ys(e),s=u.useCallback(a=>{if(!Zp(a==null?void 0:a.value))return;const l={...n.value,value:a.value};n.onChange(l)},[n]),i=u.useMemo(()=>ho.find(a=>a.value===n.value.value),[n]),o=u.useMemo(()=>!n.value.isEnabled,[n.value]);return r.jsxs(K,{flexDir:"column",gap:2,alignItems:"flex-start",children:[r.jsxs(T,{justifyContent:"space-between",w:"full",children:[r.jsx(ze,{feature:"paramScheduler",children:r.jsx(J,{children:t("parameters.scheduler")})}),r.jsx(Fi,{control:e.control,name:"scheduler"})]}),r.jsx(Ne,{isDisabled:o,value:i,options:ho,onChange:s})]})});Pq.displayName="DefaultScheduler";const Lq=u.memo(e=>{const{field:t}=ys(e),n=I(JS),{t:s}=A(),i=u.useMemo(()=>[n.sliderMin,Math.floor(n.sliderMax/2),n.sliderMax],[n.sliderMax,n.sliderMin]),o=u.useCallback(c=>{const d={...t.value,value:c};t.onChange(d)},[t]),a=u.useMemo(()=>t.value.value,[t.value]),l=u.useMemo(()=>!t.value.isEnabled,[t.value]);return r.jsxs(K,{flexDir:"column",gap:2,alignItems:"flex-start",children:[r.jsxs(T,{justifyContent:"space-between",w:"full",children:[r.jsx(ze,{feature:"paramSteps",children:r.jsx(J,{children:s("parameters.steps")})}),r.jsx(Fi,{control:e.control,name:"steps"})]}),r.jsxs(T,{w:"full",gap:4,children:[r.jsx(Ze,{value:a,min:n.sliderMin,max:n.sliderMax,step:n.coarseStep,fineStep:n.fineStep,onChange:o,marks:i,isDisabled:l}),r.jsx(Ie,{value:a,min:n.numberInputMin,max:n.numberInputMax,step:n.coarseStep,fineStep:n.fineStep,onChange:o,isDisabled:l})]})]})});Lq.displayName="DefaultSteps";const Dq=u.memo(e=>{const{t}=A(),{field:n}=ys(e),s=I(Jp),{data:i}=Up(s??Xn),[o]=bb(),a=u.useMemo(()=>{const h=o.filter(p=>p.base===(i==null?void 0:i.base)).map(p=>({label:p.name,value:p.key}));return[{label:"Default VAE",value:"default"},...h]},[i==null?void 0:i.base,o]),l=u.useCallback(h=>{const f=h!=null&&h.value?h.value:"default",p={...n.value,value:f};n.onChange(p)},[n]),c=u.useMemo(()=>a.find(h=>h.value===n.value.value),[a,n.value]),d=u.useMemo(()=>!n.value.isEnabled,[n.value]);return r.jsxs(K,{flexDir:"column",gap:2,alignItems:"flex-start",children:[r.jsxs(T,{justifyContent:"space-between",w:"full",children:[r.jsx(ze,{feature:"paramVAE",children:r.jsx(J,{children:t("modelManager.vae")})}),r.jsx(Fi,{control:e.control,name:"vae"})]}),r.jsx(Ne,{isDisabled:d,value:c,options:a,onChange:l})]})});Dq.displayName="DefaultVae";const I8=[{label:"FP16",value:"fp16"},{label:"FP32",value:"fp32"}],Rq=u.memo(e=>{const{t}=A(),{field:n}=ys(e),s=u.useCallback(a=>{if(!AL(a==null?void 0:a.value))return;const l={...n.value,value:a.value};n.onChange(l)},[n]),i=u.useMemo(()=>I8.find(a=>a.value===n.value.value),[n]),o=u.useMemo(()=>!n.value.isEnabled,[n.value]);return r.jsxs(K,{flexDir:"column",gap:1,alignItems:"flex-start",children:[r.jsxs(T,{justifyContent:"space-between",w:"full",children:[r.jsx(ze,{feature:"paramVAEPrecision",children:r.jsx(J,{children:t("modelManager.vaePrecision")})}),r.jsx(Fi,{control:e.control,name:"vaePrecision"})]}),r.jsx(Ne,{isDisabled:o,value:i,options:I8,onChange:s})]})});Rq.displayName="DefaultVaePrecision";const Oq=u.memo(({modelConfig:e})=>{const t=I(Jp),{t:n}=A(),s=u.useMemo(()=>e.base==="flux",[e]),i=VEe(e),o=u.useMemo(()=>{const g=e==null?void 0:e.base;return TM(g??null)},[e]),[a,{isLoading:l}]=Gy(),{handleSubmit:c,control:d,formState:h,reset:f}=hg({defaultValues:i}),p=u.useCallback(g=>{if(!t)return;const m={vae:g.vae.isEnabled?g.vae.value:null,vae_precision:g.vaePrecision.isEnabled?g.vaePrecision.value:null,cfg_scale:g.cfgScale.isEnabled?g.cfgScale.value:null,cfg_rescale_multiplier:g.cfgRescaleMultiplier.isEnabled?g.cfgRescaleMultiplier.value:null,steps:g.steps.isEnabled?g.steps.value:null,scheduler:g.scheduler.isEnabled?g.scheduler.value:null,width:g.width.isEnabled?g.width.value:null,height:g.height.isEnabled?g.height.value:null,guidance:g.guidance.isEnabled?g.guidance.value:null};a({key:t,body:{default_settings:m}}).unwrap().then(y=>{ge({id:"DEFAULT_SETTINGS_SAVED",title:n("modelManager.defaultSettingsSaved"),status:"success"}),f(g)}).catch(y=>{y&&ge({id:"DEFAULT_SETTINGS_SAVE_FAILED",title:`${y.data.detail} `,status:"error"})})},[t,f,a,n]);return r.jsxs(r.Fragment,{children:[r.jsxs(T,{gap:"4",justifyContent:"space-between",w:"full",pb:4,children:[r.jsx(Ft,{fontSize:"md",children:n("modelManager.defaultSettings")}),r.jsx(de,{size:"sm",leftIcon:r.jsx(og,{}),colorScheme:"invokeYellow",isDisabled:!h.isDirty,onClick:c(p),isLoading:l,children:n("common.save")})]}),r.jsxs(Hy,{columns:2,gap:8,children:[r.jsx(Dq,{control:d,name:"vae"}),!s&&r.jsx(Rq,{control:d,name:"vaePrecision"}),!s&&r.jsx(Pq,{control:d,name:"scheduler"}),r.jsx(Lq,{control:d,name:"steps"}),s&&r.jsx(Mq,{control:d,name:"guidance"}),!s&&r.jsx(Eq,{control:d,name:"cfgScale"}),!s&&r.jsx(Aq,{control:d,name:"cfgRescaleMultiplier"}),r.jsx(Tq,{control:d,optimalDimension:o}),r.jsx(Iq,{control:d,optimalDimension:o})]})]})});Oq.displayName="MainModelDefaultSettings";const Hr=u.memo(({label:e,value:t})=>r.jsxs(K,{flexDir:"column",alignItems:"flex-start",gap:0,children:[r.jsx(J,{children:e}),r.jsx(q,{fontSize:"md",noOfLines:1,wordBreak:"break-all",children:t||"-"})]}));Hr.displayName="ModelAttrView";const Nq=u.memo(({modelConfig:e})=>{const{t}=A(),n=u.useMemo(()=>e.type==="main"&&e.base!=="sdxl-refiner"||e.type==="controlnet"||e.type==="t2i_adapter"||e.type==="control_lora"||e.type==="main"||e.type==="lora",[e.base,e.type]);return r.jsxs(T,{flexDir:"column",gap:4,children:[r.jsxs(C4,{modelConfig:e,children:[e.format==="checkpoint"&&e.type==="main"&&r.jsx(jq,{modelConfig:e}),r.jsx(kq,{})]}),r.jsxs(T,{flexDir:"column",h:"full",gap:4,children:[r.jsx(Se,{layerStyle:"second",borderRadius:"base",p:4,children:r.jsxs(Hy,{columns:2,gap:4,children:[r.jsx(Hr,{label:t("modelManager.baseModel"),value:e.base}),r.jsx(Hr,{label:t("modelManager.modelType"),value:e.type}),r.jsx(Hr,{label:t("common.format"),value:e.format}),r.jsx(Hr,{label:t("modelManager.path"),value:e.path}),r.jsx(Hr,{label:t("modelManager.fileSize"),value:yq(e.file_size)}),e.type==="main"&&r.jsx(Hr,{label:t("modelManager.variant"),value:e.variant}),e.type==="main"&&e.format==="diffusers"&&e.repo_variant&&r.jsx(Hr,{label:t("modelManager.repoVariant"),value:e.repo_variant}),e.type==="main"&&e.format==="checkpoint"&&r.jsxs(r.Fragment,{children:[r.jsx(Hr,{label:t("modelManager.pathToConfig"),value:e.config_path}),r.jsx(Hr,{label:t("modelManager.predictionType"),value:e.prediction_type}),r.jsx(Hr,{label:t("modelManager.upcastAttention"),value:`${e.upcast_attention}`})]}),e.type==="ip_adapter"&&e.format==="invokeai"&&r.jsx(Hr,{label:t("modelManager.imageEncoderModelId"),value:e.image_encoder_model_id})]})}),n&&r.jsxs(Se,{layerStyle:"second",borderRadius:"base",p:4,children:[e.type==="main"&&e.base!=="sdxl-refiner"&&r.jsx(Oq,{modelConfig:e}),(e.type==="controlnet"||e.type==="t2i_adapter"||e.type==="control_lora")&&r.jsx(Sq,{modelConfig:e}),(e.type==="main"||e.type==="lora")&&r.jsx(_q,{modelConfig:e})]})]})]})});Nq.displayName="ModelView";const Fq=u.memo(()=>{const{t:e}=A(),t=I(qie),n=I(Jp),{data:s,isLoading:i}=Ip(),o=u.useMemo(()=>{if(!s||n===null)return null;const a=Ya.selectById(s,n);return a||null},[s,n]);return i?r.jsx(xb,{label:e("common.loading")}):o?t==="view"?r.jsx(Nq,{modelConfig:o}):r.jsx(Cq,{modelConfig:o}):r.jsx(Pt,{label:e("common.somethingWentWrong"),icon:WR})});Fq.displayName="Model";const Bq=u.memo(()=>{const e=I(Jp);return r.jsx(Se,{layerStyle:"first",p:4,borderRadius:"base",w:"50%",h:"full",children:e?r.jsx(Fq,{},e):r.jsx(V7,{})})});Bq.displayName="ModelPane";const zEe=()=>r.jsxs(T,{layerStyle:"body",w:"full",h:"full",gap:"2",children:[r.jsx(vq,{}),r.jsx(Bq,{})]}),GEe=u.memo(zEe),HEe=()=>{const{t:e}=A(),{data:t}=eg(),n=ae(Yn),[s,{isLoading:i}]=Kie({fixedCacheKey:"clearInvocationCache"}),o=u.useMemo(()=>!(t!=null&&t.size)||!n,[t==null?void 0:t.size,n]);return{clearInvocationCache:u.useCallback(async()=>{if(!o)try{await s().unwrap(),ge({id:"INVOCATION_CACHE_CLEAR_SUCCEEDED",title:e("invocationCache.clearSucceeded"),status:"success"})}catch{ge({id:"INVOCATION_CACHE_CLEAR_FAILED",title:e("invocationCache.clearFailed"),status:"error"})}},[o,s,e]),isLoading:i,cacheStatus:t,isDisabled:o}},WEe=()=>{const{t:e}=A(),{clearInvocationCache:t,isDisabled:n,isLoading:s}=HEe();return r.jsx(de,{isDisabled:n,isLoading:s,onClick:t,children:e("invocationCache.clear")})},UEe=u.memo(WEe),qEe=({children:e,...t})=>r.jsx(Zie,{alignItems:"center",justifyContent:"center",w:"full",h:"full",layerStyle:"first",borderRadius:"base",py:2,px:3,gap:6,flexWrap:"nowrap",...t,children:e}),$q=u.memo(qEe),KEe={'&[aria-disabled="true"]':{color:"base.500"}},ZEe=({label:e,value:t,isDisabled:n=!1,...s})=>r.jsxs(Yie,{flexGrow:1,textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap","aria-disabled":n,sx:KEe,...s,children:[r.jsx(Xie,{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",children:e}),r.jsx(Qie,{children:t})]}),Ui=u.memo(ZEe),YEe=()=>{const{t:e}=A(),{data:t}=eg(),n=ae(Yn),[s,{isLoading:i}]=Jie({fixedCacheKey:"disableInvocationCache"}),o=u.useMemo(()=>!(t!=null&&t.enabled)||!n||(t==null?void 0:t.max_size)===0,[t==null?void 0:t.enabled,t==null?void 0:t.max_size,n]);return{disableInvocationCache:u.useCallback(async()=>{if(!o)try{await s().unwrap(),ge({id:"INVOCATION_CACHE_DISABLE_SUCCEEDED",title:e("invocationCache.disableSucceeded"),status:"success"})}catch{ge({id:"INVOCATION_CACHE_DISABLE_FAILED",title:e("invocationCache.disableFailed"),status:"error"})}},[o,s,e]),isLoading:i,cacheStatus:t,isDisabled:o}},XEe=()=>{const{t:e}=A(),{data:t}=eg(),n=ae(Yn),[s,{isLoading:i}]=eoe({fixedCacheKey:"enableInvocationCache"}),o=u.useMemo(()=>(t==null?void 0:t.enabled)||!n||(t==null?void 0:t.max_size)===0,[t==null?void 0:t.enabled,t==null?void 0:t.max_size,n]);return{enableInvocationCache:u.useCallback(async()=>{if(!o)try{await s().unwrap(),ge({id:"INVOCATION_CACHE_ENABLE_SUCCEEDED",title:e("invocationCache.enableSucceeded"),status:"success"})}catch{ge({id:"INVOCATION_CACHE_ENABLE_FAILED",title:e("invocationCache.enableFailed"),status:"error"})}},[o,s,e]),isLoading:i,cacheStatus:t,isDisabled:o}},QEe=()=>{const{t:e}=A(),{data:t}=eg(),{enableInvocationCache:n,isDisabled:s,isLoading:i}=XEe(),{disableInvocationCache:o,isDisabled:a,isLoading:l}=YEe();return t!=null&&t.enabled?r.jsx(de,{isDisabled:a,isLoading:l,onClick:o,children:e("invocationCache.disable")}):r.jsx(de,{isDisabled:s,isLoading:i,onClick:n,children:e("invocationCache.enable")})},JEe=u.memo(QEe),e8e=()=>{const{t:e}=A(),{data:t}=eg(void 0);return r.jsxs($q,{children:[r.jsx(Ui,{isDisabled:!(t!=null&&t.enabled),label:e("invocationCache.cacheSize"),value:(t==null?void 0:t.size)??0}),r.jsx(Ui,{isDisabled:!(t!=null&&t.enabled),label:e("invocationCache.hits"),value:(t==null?void 0:t.hits)??0}),r.jsx(Ui,{isDisabled:!(t!=null&&t.enabled),label:e("invocationCache.misses"),value:(t==null?void 0:t.misses)??0}),r.jsx(Ui,{isDisabled:!(t!=null&&t.enabled),label:e("invocationCache.maxCacheSize"),value:(t==null?void 0:t.max_size)??0}),r.jsxs(Zn,{w:24,orientation:"vertical",size:"sm",children:[r.jsx(UEe,{}),r.jsx(JEe,{})]})]})},t8e=u.memo(e8e),cx=0,dl=1,Kd=2,Vq=4;function T8(e){return()=>e}function n8e(e){e()}function zq(e,t){return n=>e(t(n))}function A8(e,t){return()=>e(t)}function Gq(e,t){return n=>e(t,n)}function w4(e){return e!==void 0}function s8e(...e){return()=>{e.map(n8e)}}function Tc(){}function ux(e,t){return t(e),e}function r8e(e,t){return t(e)}function fn(...e){return e}function Ht(e,t){return e(dl,t)}function vt(e,t){e(cx,t)}function S4(e){e(Kd)}function Ts(e){return e(Vq)}function Ke(e,t){return Ht(e,Gq(t,cx))}function bo(e,t){const n=e(dl,s=>{n(),t(s)});return n}function E8(e){let t,n;return s=>i=>{t=i,n&&clearTimeout(n),n=setTimeout(()=>{s(t)},e)}}function Hq(e,t){return e===t}function cn(e=Hq){let t;return n=>s=>{e(t,s)||(t=s,n(s))}}function ct(e){return t=>n=>{e(n)&&t(n)}}function Ue(e){return t=>zq(t,e)}function qi(e){return t=>()=>{t(e)}}function ke(e,...t){const n=i8e(...t);return(s,i)=>{switch(s){case Kd:S4(e);return;case dl:return Ht(e,n(i))}}}function Ji(e,t){return n=>s=>{n(t=e(t,s))}}function Yu(e){return t=>n=>{e>0?e--:t(n)}}function Oa(e){let t=null,n;return s=>i=>{t=i,!n&&(n=setTimeout(()=>{n=void 0,s(t)},e))}}function Ct(...e){const t=new Array(e.length);let n=0,s=null;const i=Math.pow(2,e.length)-1;return e.forEach((o,a)=>{const l=Math.pow(2,a);Ht(o,c=>{const d=n;n=n|l,t[a]=c,d!==i&&n===i&&s&&(s(),s=null)})}),o=>a=>{const l=()=>{o([a].concat(t))};n===i?l():s=l}}function i8e(...e){return t=>e.reduceRight(r8e,t)}function o8e(e){let t,n;const s=()=>t==null?void 0:t();return function(i,o){switch(i){case dl:return o?n===o?void 0:(s(),n=o,t=Ht(e,o),t):(s(),Tc);case Kd:s(),n=null;return}}}function Ae(e){let t=e;const n=Et();return(s,i)=>{switch(s){case cx:t=i;break;case dl:{i(t);break}case Vq:return t}return n(s,i)}}function As(e,t){return ux(Ae(t),n=>Ke(e,n))}function Et(){const e=[];return(t,n)=>{switch(t){case cx:e.slice().forEach(s=>{s(n)});return;case Kd:e.splice(0,e.length);return;case dl:return e.push(n),()=>{const s=e.indexOf(n);s>-1&&e.splice(s,1)}}}}function _r(e){return ux(Et(),t=>Ke(e,t))}function $t(e,t=[],{singleton:n}={singleton:!0}){return{constructor:e,dependencies:t,id:a8e(),singleton:n}}const a8e=()=>Symbol();function l8e(e){const t=new Map,n=({constructor:s,dependencies:i,id:o,singleton:a})=>{if(a&&t.has(o))return t.get(o);const l=s(i.map(c=>n(c)));return a&&t.set(o,l),l};return n(e)}function Hn(...e){const t=Et(),n=new Array(e.length);let s=0;const i=Math.pow(2,e.length)-1;return e.forEach((o,a)=>{const l=Math.pow(2,a);Ht(o,c=>{n[a]=c,s=s|l,s===i&&vt(t,n)})}),function(o,a){switch(o){case Kd:{S4(t);return}case dl:return s===i&&a(n),Ht(t,a)}}}function dt(e,t=Hq){return ke(e,cn(t))}function M8(...e){return function(t,n){switch(t){case Kd:return;case dl:return s8e(...e.map(s=>Ht(s,n)))}}}var Ir=(e=>(e[e.DEBUG=0]="DEBUG",e[e.INFO=1]="INFO",e[e.WARN=2]="WARN",e[e.ERROR=3]="ERROR",e))(Ir||{});const c8e={0:"debug",3:"error",1:"log",2:"warn"},u8e=()=>typeof globalThis>"u"?window:globalThis,hl=$t(()=>{const e=Ae(3);return{log:Ae((t,n,s=1)=>{var i;const o=(i=u8e().VIRTUOSO_LOG_LEVEL)!=null?i:Ts(e);s>=o&&console[c8e[s]]("%creact-virtuoso: %c%s %o","color: #0253b3; font-weight: bold","color: initial",t,n)}),logLevel:e}},[],{singleton:!0});function Ac(e,t,n){return j4(e,t,n).callbackRef}function j4(e,t,n){const s=be.useRef(null);let i=o=>{};if(typeof ResizeObserver<"u"){const o=be.useMemo(()=>new ResizeObserver(a=>{const l=()=>{const c=a[0].target;c.offsetParent!==null&&e(c)};n?l():requestAnimationFrame(l)}),[e]);i=a=>{a&&t?(o.observe(a),s.current=a):(s.current&&o.unobserve(s.current),s.current=null)}}return{callbackRef:i,ref:s}}function d8e(e,t,n,s,i,o,a,l,c){const d=be.useCallback(h=>{const f=h8e(h.children,t,l?"offsetWidth":"offsetHeight",i);let p=h.parentElement;for(;!p.dataset.virtuosoScroller;)p=p.parentElement;const g=p.lastElementChild.dataset.viewportType==="window",m=a?l?a.scrollLeft:a.scrollTop:g?l?window.pageXOffset||document.documentElement.scrollLeft:window.pageYOffset||document.documentElement.scrollTop:l?p.scrollLeft:p.scrollTop,y=a?l?a.scrollWidth:a.scrollHeight:g?l?document.documentElement.scrollWidth:document.documentElement.scrollHeight:l?p.scrollWidth:p.scrollHeight,b=a?l?a.offsetWidth:a.offsetHeight:g?l?window.innerWidth:window.innerHeight:l?p.offsetWidth:p.offsetHeight;s({scrollHeight:y,scrollTop:Math.max(m,0),viewportHeight:b}),o==null||o(l?P8("column-gap",getComputedStyle(h).columnGap,i):P8("row-gap",getComputedStyle(h).rowGap,i)),f!==null&&e(f)},[e,t,i,o,a,s]);return j4(d,n,c)}function h8e(e,t,n,s){const i=e.length;if(i===0)return null;const o=[];for(let a=0;a<i;a++){const l=e.item(a);if(l.dataset.index===void 0)continue;const c=parseInt(l.dataset.index),d=parseFloat(l.dataset.knownSize),h=t(l,n);if(h===0&&s("Zero-sized element, this should not happen",{child:l},Ir.ERROR),h===d)continue;const f=o[o.length-1];o.length===0||f.size!==h||f.endIndex!==c-1?o.push({endIndex:c,size:h,startIndex:c}):o[o.length-1].endIndex++}return o}function P8(e,t,n){return t!=="normal"&&!(t!=null&&t.endsWith("px"))&&n(`${e} was not resolved to pixel value correctly`,t,Ir.WARN),t==="normal"?0:parseInt(t??"0",10)}function Wq(e,t,n){const s=be.useRef(null),i=be.useCallback(c=>{if(!(c!=null&&c.offsetParent))return;const d=c.getBoundingClientRect(),h=d.width;let f,p;if(t){const g=t.getBoundingClientRect(),m=d.top-g.top;p=g.height-Math.max(0,m),f=m+t.scrollTop}else p=window.innerHeight-Math.max(0,d.top),f=d.top+window.pageYOffset;s.current={offsetTop:f,visibleHeight:p,visibleWidth:h},e(s.current)},[e,t]),{callbackRef:o,ref:a}=j4(i,!0,n),l=be.useCallback(()=>{i(a.current)},[i,a]);return be.useEffect(()=>{if(t){t.addEventListener("scroll",l);const c=new ResizeObserver(()=>{requestAnimationFrame(l)});return c.observe(t),()=>{t.removeEventListener("scroll",l),c.unobserve(t)}}else return window.addEventListener("scroll",l),window.addEventListener("resize",l),()=>{window.removeEventListener("scroll",l),window.removeEventListener("resize",l)}},[l,t]),o}const Us=$t(()=>{const e=Et(),t=Et(),n=Ae(0),s=Et(),i=Ae(0),o=Et(),a=Et(),l=Ae(0),c=Ae(0),d=Ae(0),h=Ae(0),f=Et(),p=Et(),g=Ae(!1),m=Ae(!1),y=Ae(!1);return Ke(ke(e,Ue(({scrollTop:b})=>b)),t),Ke(ke(e,Ue(({scrollHeight:b})=>b)),a),Ke(t,i),{deviation:n,fixedFooterHeight:d,fixedHeaderHeight:c,footerHeight:h,headerHeight:l,horizontalDirection:m,scrollBy:p,scrollContainerState:e,scrollHeight:a,scrollingInProgress:g,scrollTo:f,scrollTop:t,skipAnimationFrameInResizeObserver:y,smoothScrollTargetReached:s,statefulScrollTop:i,viewportHeight:o}},[],{singleton:!0}),mp={lvl:0};function Uq(e,t){const n=e.length;if(n===0)return[];let{index:s,value:i}=t(e[0]);const o=[];for(let a=1;a<n;a++){const{index:l,value:c}=t(e[a]);o.push({end:l-1,start:s,value:i}),s=l,i=c}return o.push({end:1/0,start:s,value:i}),o}function Jt(e){return e===mp}function yp(e,t){if(!Jt(e))return t===e.k?e.v:t<e.k?yp(e.l,t):yp(e.r,t)}function Ai(e,t,n="k"){if(Jt(e))return[-1/0,void 0];if(Number(e[n])===t)return[e.k,e.v];if(Number(e[n])<t){const s=Ai(e.r,t,n);return s[0]===-1/0?[e.k,e.v]:s}return Ai(e.l,t,n)}function wr(e,t,n){return Jt(e)?Zq(t,n,1):t===e.k?Gn(e,{k:t,v:n}):t<e.k?L8(Gn(e,{l:wr(e.l,t,n)})):L8(Gn(e,{r:wr(e.r,t,n)}))}function Mu(){return mp}function dx(e,t,n){if(Jt(e))return[];const s=Ai(e,t)[0];return f8e(Dw(e,s,n))}function Lw(e,t){if(Jt(e))return mp;const{k:n,l:s,r:i}=e;if(t===n){if(Jt(s))return i;if(Jt(i))return s;{const[o,a]=Kq(s);return I0(Gn(e,{k:o,l:qq(s),v:a}))}}else return t<n?I0(Gn(e,{l:Lw(s,t)})):I0(Gn(e,{r:Lw(i,t)}))}function Ol(e){return Jt(e)?[]:[...Ol(e.l),{k:e.k,v:e.v},...Ol(e.r)]}function Dw(e,t,n){if(Jt(e))return[];const{k:s,l:i,r:o,v:a}=e;let l=[];return s>t&&(l=l.concat(Dw(i,t,n))),s>=t&&s<=n&&l.push({k:s,v:a}),s<=n&&(l=l.concat(Dw(o,t,n))),l}function I0(e){const{l:t,lvl:n,r:s}=e;if(s.lvl>=n-1&&t.lvl>=n-1)return e;if(n>s.lvl+1){if(l2(t))return Yq(Gn(e,{lvl:n-1}));if(!Jt(t)&&!Jt(t.r))return Gn(t.r,{l:Gn(t,{r:t.r.l}),lvl:n,r:Gn(e,{l:t.r.r,lvl:n-1})});throw new Error("Unexpected empty nodes")}else{if(l2(e))return Rw(Gn(e,{lvl:n-1}));if(!Jt(s)&&!Jt(s.l)){const i=s.l,o=l2(i)?s.lvl-1:s.lvl;return Gn(i,{l:Gn(e,{lvl:n-1,r:i.l}),lvl:i.lvl+1,r:Rw(Gn(s,{l:i.r,lvl:o}))})}else throw new Error("Unexpected empty nodes")}}function Gn(e,t){return Zq(t.k!==void 0?t.k:e.k,t.v!==void 0?t.v:e.v,t.lvl!==void 0?t.lvl:e.lvl,t.l!==void 0?t.l:e.l,t.r!==void 0?t.r:e.r)}function qq(e){return Jt(e.r)?e.l:I0(Gn(e,{r:qq(e.r)}))}function l2(e){return Jt(e)||e.lvl>e.r.lvl}function Kq(e){return Jt(e.r)?[e.k,e.v]:Kq(e.r)}function Zq(e,t,n,s=mp,i=mp){return{k:e,l:s,lvl:n,r:i,v:t}}function L8(e){return Rw(Yq(e))}function Yq(e){const{l:t}=e;return!Jt(t)&&t.lvl===e.lvl?Gn(t,{r:Gn(e,{l:t.r})}):e}function Rw(e){const{lvl:t,r:n}=e;return!Jt(n)&&!Jt(n.r)&&n.lvl===t&&n.r.lvl===t?Gn(n,{l:Gn(e,{r:n.l}),lvl:t+1}):e}function f8e(e){return Uq(e,({k:t,v:n})=>({index:t,value:n}))}function Xq(e,t){return!!(e&&e.startIndex===t.startIndex&&e.endIndex===t.endIndex)}function bp(e,t){return!!(e&&e[0]===t[0]&&e[1]===t[1])}const k4=$t(()=>({recalcInProgress:Ae(!1)}),[],{singleton:!0});function Qq(e,t,n){return e[oy(e,t,n)]}function oy(e,t,n,s=0){let i=e.length-1;for(;s<=i;){const o=Math.floor((s+i)/2),a=e[o],l=n(a,t);if(l===0)return o;if(l===-1){if(i-s<2)return o-1;i=o-1}else{if(i===s)return o;s=o+1}}throw new Error(`Failed binary finding record in array - ${e.join(",")}, searched for ${t}`)}function p8e(e,t,n,s){const i=oy(e,t,s),o=oy(e,n,s,i);return e.slice(i,o+1)}function Za(e,t){return Math.round(e.getBoundingClientRect()[t])}function hx(e){return!Jt(e.groupOffsetTree)}function _4({index:e},t){return t===e?0:t<e?-1:1}function g8e(){return{groupIndices:[],groupOffsetTree:Mu(),lastIndex:0,lastOffset:0,lastSize:0,offsetTree:[],sizeTree:Mu()}}function m8e(e,t){let n=Jt(e)?0:1/0;for(const s of t){const{endIndex:i,size:o,startIndex:a}=s;if(n=Math.min(n,a),Jt(e)){e=wr(e,0,o);continue}const l=dx(e,a-1,i+1);if(l.some(S8e(s)))continue;let c=!1,d=!1;for(const{end:h,start:f,value:p}of l)c?(i>=f||o===p)&&(e=Lw(e,f)):(d=p!==o,c=!0),h>i&&i>=f&&p!==o&&(e=wr(e,i+1,p));d&&(e=wr(e,a,o))}return[e,n]}function y8e(e){return typeof e.groupIndex<"u"}function b8e({offset:e},t){return t===e?0:t<e?-1:1}function xp(e,t,n){if(t.length===0)return 0;const{index:s,offset:i,size:o}=Qq(t,e,_4),a=e-s,l=o*a+(a-1)*n+i;return l>0?l+n:l}function Jq(e,t){if(!hx(t))return e;let n=0;for(;t.groupIndices[n]<=e+n;)n++;return e+n}function eK(e,t,n){if(y8e(e))return t.groupIndices[e.groupIndex]+1;{const s=e.index==="LAST"?n:e.index;let i=Jq(s,t);return i=Math.max(0,i,Math.min(n,i)),i}}function x8e(e,t,n,s=0){return s>0&&(t=Math.max(t,Qq(e,s,_4).offset)),Uq(p8e(e,t,n,b8e),w8e)}function v8e(e,[t,n,s,i]){t.length>0&&s("received item sizes",t,Ir.DEBUG);const o=e.sizeTree;let a=o,l=0;if(n.length>0&&Jt(o)&&t.length===2){const p=t[0].size,g=t[1].size;a=n.reduce((m,y)=>wr(wr(m,y,p),y+1,g),a)}else[a,l]=m8e(a,t);if(a===o)return e;const{lastIndex:c,lastOffset:d,lastSize:h,offsetTree:f}=Ow(e.offsetTree,l,a,i);return{groupIndices:n,groupOffsetTree:n.reduce((p,g)=>wr(p,g,xp(g,f,i)),Mu()),lastIndex:c,lastOffset:d,lastSize:h,offsetTree:f,sizeTree:a}}function C8e(e){return Ol(e).map(({k:t,v:n},s,i)=>{const o=i[s+1];return{endIndex:o?o.k-1:1/0,size:n,startIndex:t}})}function D8(e,t){let n=0,s=0;for(;n<e;)n+=t[s+1]-t[s]-1,s++;return s-(n===e?0:1)}function Ow(e,t,n,s){let i=e,o=0,a=0,l=0,c=0;if(t!==0){c=oy(i,t-1,_4),l=i[c].offset;const d=Ai(n,t-1);o=d[0],a=d[1],i.length&&i[c].size===Ai(n,t)[1]&&(c-=1),i=i.slice(0,c+1)}else i=[];for(const{start:d,value:h}of dx(n,t,1/0)){const f=d-o,p=f*a+l+f*s;i.push({index:d,offset:p,size:h}),o=d,l=p,a=h}return{lastIndex:o,lastOffset:l,lastSize:a,offsetTree:i}}function w8e(e){return{index:e.index,value:e}}function S8e(e){const{endIndex:t,size:n,startIndex:s}=e;return i=>i.start===s&&(i.end===t||i.end===1/0)&&i.value===n}const j8e={offsetHeight:"height",offsetWidth:"width"},_o=$t(([{log:e},{recalcInProgress:t}])=>{const n=Et(),s=Et(),i=As(s,0),o=Et(),a=Et(),l=Ae(0),c=Ae([]),d=Ae(void 0),h=Ae(void 0),f=Ae((S,j)=>Za(S,j8e[j])),p=Ae(void 0),g=Ae(0),m=g8e(),y=As(ke(n,Ct(c,e,g),Ji(v8e,m),cn()),m),b=As(ke(c,cn(),Ji((S,j)=>({current:j,prev:S.current}),{current:[],prev:[]}),Ue(({prev:S})=>S)),[]);Ke(ke(c,ct(S=>S.length>0),Ct(y,g),Ue(([S,j,P])=>{const E=S.reduce((D,M,R)=>wr(D,M,xp(M,j.offsetTree,P)||R),Mu());return{...j,groupIndices:S,groupOffsetTree:E}})),y),Ke(ke(s,Ct(y),ct(([S,{lastIndex:j}])=>S<j),Ue(([S,{lastIndex:j,lastSize:P}])=>[{endIndex:j,size:P,startIndex:S}])),n),Ke(d,h);const C=As(ke(d,Ue(S=>S===void 0)),!0);Ke(ke(h,ct(S=>S!==void 0&&Jt(Ts(y).sizeTree)),Ue(S=>[{endIndex:0,size:S,startIndex:0}])),n);const x=_r(ke(n,Ct(y),Ji(({sizes:S},[j,P])=>({changed:P!==S,sizes:P}),{changed:!1,sizes:m}),Ue(S=>S.changed)));Ht(ke(l,Ji((S,j)=>({diff:S.prev-j,prev:j}),{diff:0,prev:0}),Ue(S=>S.diff)),S=>{const{groupIndices:j}=Ts(y);if(S>0)vt(t,!0),vt(o,S+D8(S,j));else if(S<0){const P=Ts(b);P.length>0&&(S-=D8(-S,P)),vt(a,S)}}),Ht(ke(l,Ct(e)),([S,j])=>{S<0&&j("`firstItemIndex` prop should not be set to less than zero. If you don't know the total count, just use a very high value",{firstItemIndex:l},Ir.ERROR)});const v=_r(o);Ke(ke(o,Ct(y),Ue(([S,j])=>{const P=j.groupIndices.length>0,E=[],D=j.lastSize;if(P){const M=yp(j.sizeTree,0);let R=0,F=0;for(;R<S;){const L=j.groupIndices[F],O=j.groupIndices.length===F+1?1/0:j.groupIndices[F+1]-L-1;E.push({endIndex:L,size:M,startIndex:L}),E.push({endIndex:L+1+O-1,size:D,startIndex:L+1}),F++,R+=O+1}const _=Ol(j.sizeTree);return R!==S&&_.shift(),_.reduce((L,{k:O,v:B})=>{let z=L.ranges;return L.prevSize!==0&&(z=[...L.ranges,{endIndex:O+S-1,size:L.prevSize,startIndex:L.prevIndex}]),{prevIndex:O+S,prevSize:B,ranges:z}},{prevIndex:S,prevSize:0,ranges:E}).ranges}return Ol(j.sizeTree).reduce((M,{k:R,v:F})=>({prevIndex:R+S,prevSize:F,ranges:[...M.ranges,{endIndex:R+S-1,size:M.prevSize,startIndex:M.prevIndex}]}),{prevIndex:0,prevSize:D,ranges:[]}).ranges})),n);const w=_r(ke(a,Ct(y,g),Ue(([S,{offsetTree:j},P])=>{const E=-S;return xp(E,j,P)})));return Ke(ke(a,Ct(y,g),Ue(([S,j,P])=>{if(j.groupIndices.length>0){if(Jt(j.sizeTree))return j;let E=Mu();const D=Ts(b);let M=0,R=0,F=0;for(;M<-S;){F=D[R];const _=D[R+1]-F-1;R++,M+=_+1}if(E=Ol(j.sizeTree).reduce((_,{k:L,v:O})=>wr(_,Math.max(0,L+S),O),E),M!==-S){const _=yp(j.sizeTree,F);E=wr(E,0,_);const L=Ai(j.sizeTree,-S+1)[1];E=wr(E,1,L)}return{...j,sizeTree:E,...Ow(j.offsetTree,0,E,P)}}else{const E=Ol(j.sizeTree).reduce((D,{k:M,v:R})=>wr(D,Math.max(0,M+S),R),Mu());return{...j,sizeTree:E,...Ow(j.offsetTree,0,E,P)}}})),y),{beforeUnshiftWith:v,data:p,defaultItemSize:h,firstItemIndex:l,fixedItemSize:d,gap:g,groupIndices:c,itemSize:f,listRefresh:x,shiftWith:a,shiftWithOffset:w,sizeRanges:n,sizes:y,statefulTotalCount:i,totalCount:s,trackItemSizes:C,unshiftWith:o}},fn(hl,k4),{singleton:!0});function k8e(e){return e.reduce((t,n)=>(t.groupIndices.push(t.totalCount),t.totalCount+=n+1,t),{groupIndices:[],totalCount:0})}const tK=$t(([{groupIndices:e,sizes:t,totalCount:n},{headerHeight:s,scrollTop:i}])=>{const o=Et(),a=Et(),l=_r(ke(o,Ue(k8e)));return Ke(ke(l,Ue(c=>c.totalCount)),n),Ke(ke(l,Ue(c=>c.groupIndices)),e),Ke(ke(Hn(i,t,s),ct(([c,d])=>hx(d)),Ue(([c,d,h])=>Ai(d.groupOffsetTree,Math.max(c-h,0),"v")[0]),cn(),Ue(c=>[c])),a),{groupCounts:o,topItemsIndexes:a}},fn(_o,Us)),fl=$t(([{log:e}])=>{const t=Ae(!1),n=_r(ke(t,ct(s=>s),cn()));return Ht(t,s=>{s&&Ts(e)("props updated",{},Ir.DEBUG)}),{didMount:n,propsReady:t}},fn(hl),{singleton:!0}),_8e=typeof document<"u"&&"scrollBehavior"in document.documentElement.style;function nK(e){const t=typeof e=="number"?{index:e}:e;return t.align||(t.align="start"),(!t.behavior||!_8e)&&(t.behavior="auto"),t.offset||(t.offset=0),t}const qg=$t(([{gap:e,listRefresh:t,sizes:n,totalCount:s},{fixedFooterHeight:i,fixedHeaderHeight:o,footerHeight:a,headerHeight:l,scrollingInProgress:c,scrollTo:d,smoothScrollTargetReached:h,viewportHeight:f},{log:p}])=>{const g=Et(),m=Et(),y=Ae(0);let b=null,C=null,x=null;function v(){b&&(b(),b=null),x&&(x(),x=null),C&&(clearTimeout(C),C=null),vt(c,!1)}return Ke(ke(g,Ct(n,f,s,y,l,a,p),Ct(e,o,i),Ue(([[w,S,j,P,E,D,M,R],F,_,L])=>{const O=nK(w),{align:B,behavior:z,offset:ee}=O,ne=P-1,re=eK(O,S,ne);let te=xp(re,S.offsetTree,F)+D;B==="end"?(te+=_+Ai(S.sizeTree,re)[1]-j+L,re===ne&&(te+=M)):B==="center"?te+=(_+Ai(S.sizeTree,re)[1]-j+L)/2:te-=E,ee&&(te+=ee);const H=V=>{v(),V?(R("retrying to scroll to",{location:w},Ir.DEBUG),vt(g,w)):(vt(m,!0),R("list did not change, scroll successful",{},Ir.DEBUG))};if(v(),z==="smooth"){let V=!1;x=Ht(t,X=>{V=V||X}),b=bo(h,()=>{H(V)})}else b=bo(ke(t,I8e(150)),H);return C=setTimeout(()=>{v()},1200),vt(c,!0),R("scrolling from index to",{behavior:z,index:re,top:te},Ir.DEBUG),{behavior:z,top:te}})),d),{scrollTargetReached:m,scrollToIndex:g,topListHeight:y}},fn(_o,Us,hl),{singleton:!0});function I8e(e){return t=>{const n=setTimeout(()=>{t(!1)},e);return s=>{s&&(t(!0),clearTimeout(n))}}}function I4(e,t){e==0?t():requestAnimationFrame(()=>{I4(e-1,t)})}function T4(e,t){const n=t-1;return typeof e=="number"?e:e.index==="LAST"?n:e.index}const Kg=$t(([{defaultItemSize:e,listRefresh:t,sizes:n},{scrollTop:s},{scrollTargetReached:i,scrollToIndex:o},{didMount:a}])=>{const l=Ae(!0),c=Ae(0),d=Ae(!0);return Ke(ke(a,Ct(c),ct(([h,f])=>!!f),qi(!1)),l),Ke(ke(a,Ct(c),ct(([h,f])=>!!f),qi(!1)),d),Ht(ke(Hn(t,a),Ct(l,n,e,d),ct(([[,h],f,{sizeTree:p},g,m])=>h&&(!Jt(p)||w4(g))&&!f&&!m),Ct(c)),([,h])=>{bo(i,()=>{vt(d,!0)}),I4(4,()=>{bo(s,()=>{vt(l,!0)}),vt(o,h)})}),{initialItemFinalLocationReached:d,initialTopMostItemIndex:c,scrolledToInitialItem:l}},fn(_o,Us,qg,fl),{singleton:!0});function sK(e,t){return Math.abs(e-t)<1.01}const vp="up",Bf="down",T8e="none",A8e={atBottom:!1,notAtBottomBecause:"NOT_SHOWING_LAST_ITEM",state:{offsetBottom:0,scrollHeight:0,scrollTop:0,viewportHeight:0}},E8e=0,Zg=$t(([{footerHeight:e,headerHeight:t,scrollBy:n,scrollContainerState:s,scrollTop:i,viewportHeight:o}])=>{const a=Ae(!1),l=Ae(!0),c=Et(),d=Et(),h=Ae(4),f=Ae(E8e),p=As(ke(M8(ke(dt(i),Yu(1),qi(!0)),ke(dt(i),Yu(1),qi(!1),E8(100))),cn()),!1),g=As(ke(M8(ke(n,qi(!0)),ke(n,qi(!1),E8(200))),cn()),!1);Ke(ke(Hn(dt(i),dt(f)),Ue(([x,v])=>x<=v),cn()),l),Ke(ke(l,Oa(50)),d);const m=_r(ke(Hn(s,dt(o),dt(t),dt(e),dt(h)),Ji((x,[{scrollHeight:v,scrollTop:w},S,j,P,E])=>{const D=w+S-v>-E,M={scrollHeight:v,scrollTop:w,viewportHeight:S};if(D){let F,_;return w>x.state.scrollTop?(F="SCROLLED_DOWN",_=x.state.scrollTop-w):(F="SIZE_DECREASED",_=x.state.scrollTop-w||x.scrollTopDelta),{atBottom:!0,atBottomBecause:F,scrollTopDelta:_,state:M}}let R;return M.scrollHeight>x.state.scrollHeight?R="SIZE_INCREASED":S<x.state.viewportHeight?R="VIEWPORT_HEIGHT_DECREASING":w<x.state.scrollTop?R="SCROLLING_UPWARDS":R="NOT_FULLY_SCROLLED_TO_LAST_ITEM_BOTTOM",{atBottom:!1,notAtBottomBecause:R,state:M}},A8e),cn((x,v)=>x&&x.atBottom===v.atBottom))),y=As(ke(s,Ji((x,{scrollHeight:v,scrollTop:w,viewportHeight:S})=>{if(sK(x.scrollHeight,v))return{changed:!1,jump:0,scrollHeight:v,scrollTop:w};{const j=v-(w+S)<1;return x.scrollTop!==w&&j?{changed:!0,jump:x.scrollTop-w,scrollHeight:v,scrollTop:w}:{changed:!0,jump:0,scrollHeight:v,scrollTop:w}}},{changed:!1,jump:0,scrollHeight:0,scrollTop:0}),ct(x=>x.changed),Ue(x=>x.jump)),0);Ke(ke(m,Ue(x=>x.atBottom)),a),Ke(ke(a,Oa(50)),c);const b=Ae(Bf);Ke(ke(s,Ue(({scrollTop:x})=>x),cn(),Ji((x,v)=>Ts(g)?{direction:x.direction,prevScrollTop:v}:{direction:v<x.prevScrollTop?vp:Bf,prevScrollTop:v},{direction:Bf,prevScrollTop:0}),Ue(x=>x.direction)),b),Ke(ke(s,Oa(50),qi(T8e)),b);const C=Ae(0);return Ke(ke(p,ct(x=>!x),qi(0)),C),Ke(ke(i,Oa(100),Ct(p),ct(([x,v])=>!!v),Ji(([x,v],[w])=>[v,w],[0,0]),Ue(([x,v])=>v-x)),C),{atBottomState:m,atBottomStateChange:c,atBottomThreshold:h,atTopStateChange:d,atTopThreshold:f,isAtBottom:a,isAtTop:l,isScrolling:p,lastJumpDueToItemResize:y,scrollDirection:b,scrollVelocity:C}},fn(Us)),ay="top",ly="bottom",R8="none";function O8(e,t,n){return typeof e=="number"?n===vp&&t===ay||n===Bf&&t===ly?e:0:n===vp?t===ay?e.main:e.reverse:t===ly?e.main:e.reverse}function N8(e,t){var n;return typeof e=="number"?e:(n=e[t])!=null?n:0}const A4=$t(([{deviation:e,fixedHeaderHeight:t,headerHeight:n,scrollTop:s,viewportHeight:i}])=>{const o=Et(),a=Ae(0),l=Ae(0),c=Ae(0),d=As(ke(Hn(dt(s),dt(i),dt(n),dt(o,bp),dt(c),dt(a),dt(t),dt(e),dt(l)),Ue(([h,f,p,[g,m],y,b,C,x,v])=>{const w=h-x,S=b+C,j=Math.max(p-w,0);let P=R8;const E=N8(v,ay),D=N8(v,ly);return g-=x,g+=p+C,m+=p+C,m-=x,g>h+S-E&&(P=vp),m<h-j+f+D&&(P=Bf),P!==R8?[Math.max(w-p-O8(y,ay,P)-E,0),w-j-C+f+O8(y,ly,P)+D]:null}),ct(h=>h!=null),cn(bp)),[0,0]);return{increaseViewportBy:l,listBoundary:o,overscan:c,topListHeight:a,visibleRange:d}},fn(Us),{singleton:!0});function M8e(e,t,n){if(hx(t)){const s=Jq(e,t);return[{index:Ai(t.groupOffsetTree,s)[0],offset:0,size:0},{data:n==null?void 0:n[0],index:s,offset:0,size:0}]}return[{data:n==null?void 0:n[0],index:e,offset:0,size:0}]}const c2={bottom:0,firstItemIndex:0,items:[],offsetBottom:0,offsetTop:0,top:0,topItems:[],topListHeight:0,totalCount:0};function T0(e,t,n,s,i,o){const{lastIndex:a,lastOffset:l,lastSize:c}=i;let d=0,h=0;if(e.length>0){d=e[0].offset;const y=e[e.length-1];h=y.offset+y.size}const f=n-a,p=l+f*c+(f-1)*s,g=d,m=p-h;return{bottom:h,firstItemIndex:o,items:F8(e,i,o),offsetBottom:m,offsetTop:d,top:g,topItems:F8(t,i,o),topListHeight:t.reduce((y,b)=>b.size+y,0),totalCount:n}}function rK(e,t,n,s,i,o){let a=0;if(n.groupIndices.length>0)for(const h of n.groupIndices){if(h-a>=e)break;a++}const l=e+a,c=T4(t,l),d=Array.from({length:l}).map((h,f)=>({data:o[f+c],index:f+c,offset:0,size:0}));return T0(d,[],l,i,n,s)}function F8(e,t,n){if(e.length===0)return[];if(!hx(t))return e.map(d=>({...d,index:d.index+n,originalIndex:d.index}));const s=e[0].index,i=e[e.length-1].index,o=[],a=dx(t.groupOffsetTree,s,i);let l,c=0;for(const d of e){(!l||l.end<d.index)&&(l=a.shift(),c=t.groupIndices.indexOf(l.start));let h;d.index===l.start?h={index:c,type:"group"}:h={groupIndex:c,index:d.index-(c+1)+n},o.push({...h,data:d.data,offset:d.offset,originalIndex:d.index,size:d.size})}return o}const Ec=$t(([{data:e,firstItemIndex:t,gap:n,sizes:s,totalCount:i},o,{listBoundary:a,topListHeight:l,visibleRange:c},{initialTopMostItemIndex:d,scrolledToInitialItem:h},{topListHeight:f},p,{didMount:g},{recalcInProgress:m}])=>{const y=Ae([]),b=Ae(0),C=Et();Ke(o.topItemsIndexes,y);const x=As(ke(Hn(g,m,dt(c,bp),dt(i),dt(s),dt(d),h,dt(y),dt(t),dt(n),e),ct(([j,P,,E,,,,,,,D])=>{const M=D&&D.length!==E;return j&&!P&&!M}),Ue(([,,[j,P],E,D,M,R,F,_,L,O])=>{const B=D,{offsetTree:z,sizeTree:ee}=B,ne=Ts(b);if(E===0)return{...c2,totalCount:E};if(j===0&&P===0)return ne===0?{...c2,totalCount:E}:rK(ne,M,D,_,L,O||[]);if(Jt(ee))return ne>0?null:T0(M8e(T4(M,E),B,O),[],E,L,B,_);const re=[];if(F.length>0){const W=F[0],Y=F[F.length-1];let $=0;for(const N of dx(ee,W,Y)){const U=N.value,ie=Math.max(N.start,W),ue=Math.min(N.end,Y);for(let xe=ie;xe<=ue;xe++)re.push({data:O==null?void 0:O[xe],index:xe,offset:$,size:U}),$+=U}}if(!R)return T0([],re,E,L,B,_);const te=F.length>0?F[F.length-1]+1:0,H=x8e(z,j,P,te);if(H.length===0)return null;const V=E-1,X=ux([],W=>{for(const Y of H){const $=Y.value;let N=$.offset,U=Y.start;const ie=$.size;if($.offset<j){U+=Math.floor((j-$.offset+L)/(ie+L));const xe=U-Y.start;N+=xe*ie+xe*L}U<te&&(N+=(te-U)*ie,U=te);const ue=Math.min(Y.end,V);for(let xe=U;xe<=ue&&!(N>=P);xe++)W.push({data:O==null?void 0:O[xe],index:xe,offset:N,size:ie}),N+=ie+L}});return T0(X,re,E,L,B,_)}),ct(j=>j!==null),cn()),c2);Ke(ke(e,ct(w4),Ue(j=>j==null?void 0:j.length)),i),Ke(ke(x,Ue(j=>j.topListHeight)),f),Ke(f,l),Ke(ke(x,Ue(j=>[j.top,j.bottom])),a),Ke(ke(x,Ue(j=>j.items)),C);const v=_r(ke(x,ct(({items:j})=>j.length>0),Ct(i,e),ct(([{items:j},P])=>j[j.length-1].originalIndex===P-1),Ue(([,j,P])=>[j-1,P]),cn(bp),Ue(([j])=>j))),w=_r(ke(x,Oa(200),ct(({items:j,topItems:P})=>j.length>0&&j[0].originalIndex===P.length),Ue(({items:j})=>j[0].index),cn())),S=_r(ke(x,ct(({items:j})=>j.length>0),Ue(({items:j})=>{let P=0,E=j.length-1;for(;j[P].type==="group"&&P<E;)P++;for(;j[E].type==="group"&&E>P;)E--;return{endIndex:j[E].index,startIndex:j[P].index}}),cn(Xq)));return{endReached:v,initialItemCount:b,itemsRendered:C,listState:x,rangeChanged:S,startReached:w,topItemsIndexes:y,...p}},fn(_o,tK,A4,Kg,qg,Zg,fl,k4),{singleton:!0}),iK=$t(([{fixedFooterHeight:e,fixedHeaderHeight:t,footerHeight:n,headerHeight:s},{listState:i}])=>{const o=Et(),a=As(ke(Hn(n,e,s,t,i),Ue(([l,c,d,h,f])=>l+c+d+h+f.offsetBottom+f.bottom)),0);return Ke(dt(a),o),{totalListHeight:a,totalListHeightChanged:o}},fn(Us,Ec),{singleton:!0}),P8e=$t(([{viewportHeight:e},{totalListHeight:t}])=>{const n=Ae(!1),s=As(ke(Hn(n,e,t),ct(([i])=>i),Ue(([,i,o])=>Math.max(0,i-o)),Oa(0),cn()),0);return{alignToBottom:n,paddingTopAddition:s}},fn(Us,iK),{singleton:!0});function B8(e){return e?e==="smooth"?"smooth":"auto":!1}const L8e=(e,t)=>typeof e=="function"?B8(e(t)):t&&B8(e),D8e=$t(([{listRefresh:e,totalCount:t},{atBottomState:n,isAtBottom:s},{scrollToIndex:i},{scrolledToInitialItem:o},{didMount:a,propsReady:l},{log:c},{scrollingInProgress:d}])=>{const h=Ae(!1),f=Et();let p=null;function g(y){vt(i,{align:"end",behavior:y,index:"LAST"})}Ht(ke(Hn(ke(dt(t),Yu(1)),a),Ct(dt(h),s,o,d),Ue(([[y,b],C,x,v,w])=>{let S=b&&v,j="auto";return S&&(j=L8e(C,x||w),S=S&&!!j),{followOutputBehavior:j,shouldFollow:S,totalCount:y}}),ct(({shouldFollow:y})=>y)),({followOutputBehavior:y,totalCount:b})=>{p&&(p(),p=null),p=bo(e,()=>{Ts(c)("following output to ",{totalCount:b},Ir.DEBUG),g(y),p=null})});function m(y){const b=bo(n,C=>{y&&!C.atBottom&&C.notAtBottomBecause==="SIZE_INCREASED"&&!p&&(Ts(c)("scrolling to bottom due to increased size",{},Ir.DEBUG),g("auto"))});setTimeout(b,100)}return Ht(ke(Hn(dt(h),t,l),ct(([y,,b])=>y&&b),Ji(({value:y},[,b])=>({refreshed:y===b,value:b}),{refreshed:!1,value:0}),ct(({refreshed:y})=>y),Ct(h,t)),([,y])=>{Ts(o)&&m(y!==!1)}),Ht(f,()=>{m(Ts(h)!==!1)}),Ht(Hn(dt(h),n),([y,b])=>{y&&!b.atBottom&&b.notAtBottomBecause==="VIEWPORT_HEIGHT_DECREASING"&&g("auto")}),{autoscrollToBottom:f,followOutput:h}},fn(_o,Zg,qg,Kg,fl,hl,Us)),R8e=$t(([{data:e,firstItemIndex:t,gap:n,sizes:s},{initialTopMostItemIndex:i},{initialItemCount:o,listState:a},{didMount:l}])=>(Ke(ke(l,Ct(o),ct(([,c])=>c!==0),Ct(i,s,t,n,e),Ue(([[,c],d,h,f,p,g=[]])=>rK(c,d,h,f,p,g))),a),{}),fn(_o,Kg,Ec,fl),{singleton:!0}),O8e=$t(([{didMount:e},{scrollTo:t},{listState:n}])=>{const s=Ae(0);return Ht(ke(e,Ct(s),ct(([,i])=>i!==0),Ue(([,i])=>({top:i}))),i=>{bo(ke(n,Yu(1),ct(o=>o.items.length>1)),()=>{requestAnimationFrame(()=>{vt(t,i)})})}),{initialScrollTop:s}},fn(fl,Us,Ec),{singleton:!0}),N8e=({itemBottom:e,itemTop:t,locationParams:{align:n,behavior:s,...i},viewportBottom:o,viewportTop:a})=>t<a?{...i,align:n??"start",behavior:s}:e>o?{...i,align:n??"end",behavior:s}:null,F8e=$t(([{gap:e,sizes:t,totalCount:n},{fixedFooterHeight:s,fixedHeaderHeight:i,headerHeight:o,scrollingInProgress:a,scrollTop:l,viewportHeight:c},{scrollToIndex:d}])=>{const h=Et();return Ke(ke(h,Ct(t,c,n,o,i,s,l),Ct(e),Ue(([[f,p,g,m,y,b,C,x],v])=>{const{align:w,behavior:S,calculateViewLocation:j=N8e,done:P,...E}=f,D=eK(f,p,m-1),M=xp(D,p.offsetTree,v)+y+b,R=M+Ai(p.sizeTree,D)[1],F=x+b,_=x+g-C,L=j({itemBottom:R,itemTop:M,locationParams:{align:w,behavior:S,...E},viewportBottom:_,viewportTop:F});return L?P&&bo(ke(a,ct(O=>!O),Yu(Ts(a)?1:2)),P):P&&P(),L}),ct(f=>f!==null)),d),{scrollIntoView:h}},fn(_o,Us,qg,Ec,hl),{singleton:!0}),oK=$t(([{scrollVelocity:e}])=>{const t=Ae(!1),n=Et(),s=Ae(!1);return Ke(ke(e,Ct(s,t,n),ct(([i,o])=>!!o),Ue(([i,o,a,l])=>{const{enter:c,exit:d}=o;if(a){if(d(i,l))return!1}else if(c(i,l))return!0;return a}),cn()),t),Ht(ke(Hn(t,e,n),Ct(s)),([[i,o,a],l])=>{i&&l&&l.change&&l.change(o,a)}),{isSeeking:t,scrollSeekConfiguration:s,scrollSeekRangeChanged:n,scrollVelocity:e}},fn(Zg),{singleton:!0}),E4=$t(([{scrollContainerState:e,scrollTo:t}])=>{const n=Et(),s=Et(),i=Et(),o=Ae(!1),a=Ae(void 0);return Ke(ke(Hn(n,s),Ue(([{scrollHeight:l,scrollTop:c,viewportHeight:d},{offsetTop:h}])=>({scrollHeight:l,scrollTop:Math.max(0,c-h),viewportHeight:d}))),e),Ke(ke(t,Ct(s),Ue(([l,{offsetTop:c}])=>({...l,top:l.top+c}))),i),{customScrollParent:a,useWindowScroll:o,windowScrollContainerState:n,windowScrollTo:i,windowViewportRect:s}},fn(Us)),B8e=$t(([{sizeRanges:e,sizes:t},{headerHeight:n,scrollTop:s},{initialTopMostItemIndex:i},{didMount:o},{useWindowScroll:a,windowScrollContainerState:l,windowViewportRect:c}])=>{const d=Et(),h=Ae(void 0),f=Ae(null),p=Ae(null);return Ke(l,f),Ke(c,p),Ht(ke(d,Ct(t,s,a,f,p,n)),([g,m,y,b,C,x,v])=>{const w=C8e(m.sizeTree);b&&C!==null&&x!==null&&(y=C.scrollTop-x.offsetTop),y-=v,g({ranges:w,scrollTop:y})}),Ke(ke(h,ct(w4),Ue($8e)),i),Ke(ke(o,Ct(h),ct(([,g])=>g!==void 0),cn(),Ue(([,g])=>g.ranges)),e),{getState:d,restoreStateFrom:h}},fn(_o,Us,Kg,fl,E4));function $8e(e){return{align:"start",index:0,offset:e.scrollTop}}const V8e=$t(([{topItemsIndexes:e}])=>{const t=Ae(0);return Ke(ke(t,ct(n=>n>=0),Ue(n=>Array.from({length:n}).map((s,i)=>i))),e),{topItemCount:t}},fn(Ec));function aK(e){let t=!1,n;return()=>(t||(t=!0,n=e()),n)}const z8e=aK(()=>/iP(ad|od|hone)/i.test(navigator.userAgent)&&/WebKit/i.test(navigator.userAgent)),G8e=$t(([{deviation:e,scrollBy:t,scrollingInProgress:n,scrollTop:s},{isAtBottom:i,isScrolling:o,lastJumpDueToItemResize:a,scrollDirection:l},{listState:c},{beforeUnshiftWith:d,gap:h,shiftWithOffset:f,sizes:p},{log:g},{recalcInProgress:m}])=>{const y=_r(ke(c,Ct(a),Ji(([,C,x,v],[{bottom:w,items:S,offsetBottom:j,totalCount:P},E])=>{const D=w+j;let M=0;return x===P&&C.length>0&&S.length>0&&(S[0].originalIndex===0&&C[0].originalIndex===0||(M=D-v,M!==0&&(M+=E))),[M,S,P,D]},[0,[],0,0]),ct(([C])=>C!==0),Ct(s,l,n,i,g,m),ct(([,C,x,v,,,w])=>!w&&!v&&C!==0&&x===vp),Ue(([[C],,,,,x])=>(x("Upward scrolling compensation",{amount:C},Ir.DEBUG),C))));function b(C){C>0?(vt(t,{behavior:"auto",top:-C}),vt(e,0)):(vt(e,0),vt(t,{behavior:"auto",top:-C}))}return Ht(ke(y,Ct(e,o)),([C,x,v])=>{v&&z8e()?vt(e,x-C):b(-C)}),Ht(ke(Hn(As(o,!1),e,m),ct(([C,x,v])=>!C&&!v&&x!==0),Ue(([C,x])=>x),Oa(1)),b),Ke(ke(f,Ue(C=>({top:-C}))),t),Ht(ke(d,Ct(p,h),Ue(([C,{groupIndices:x,lastSize:v,sizeTree:w},S])=>{function j(P){return P*(v+S)}if(x.length===0)return j(C);{let P=0;const E=yp(w,0);let D=0,M=0;for(;D<C;){D++,P+=E;let R=x.length===M+1?1/0:x[M+1]-x[M]-1;D+R>C&&(P-=E,R=C-D+1),D+=R,P+=j(R),M++}return P}})),C=>{vt(e,C),requestAnimationFrame(()=>{vt(t,{top:C}),requestAnimationFrame(()=>{vt(e,0),vt(m,!1)})})}),{deviation:e}},fn(Us,Zg,Ec,_o,hl,k4)),H8e=$t(([e,t,n,s,i,o,a,l,c,d])=>({...e,...t,...n,...s,...i,...o,...a,...l,...c,...d}),fn(A4,R8e,fl,oK,iK,O8e,P8e,E4,F8e,hl)),lK=$t(([{data:e,defaultItemSize:t,firstItemIndex:n,fixedItemSize:s,gap:i,groupIndices:o,itemSize:a,sizeRanges:l,sizes:c,statefulTotalCount:d,totalCount:h,trackItemSizes:f},{initialItemFinalLocationReached:p,initialTopMostItemIndex:g,scrolledToInitialItem:m},y,b,C,{listState:x,topItemsIndexes:v,...w},{scrollToIndex:S},j,{topItemCount:P},{groupCounts:E},D])=>(Ke(w.rangeChanged,D.scrollSeekRangeChanged),Ke(ke(D.windowViewportRect,Ue(M=>M.visibleHeight)),y.viewportHeight),{data:e,defaultItemHeight:t,firstItemIndex:n,fixedItemHeight:s,gap:i,groupCounts:E,initialItemFinalLocationReached:p,initialTopMostItemIndex:g,scrolledToInitialItem:m,sizeRanges:l,topItemCount:P,topItemsIndexes:v,totalCount:h,...C,groupIndices:o,itemSize:a,listState:x,scrollToIndex:S,statefulTotalCount:d,trackItemSizes:f,...w,...D,...y,sizes:c,...b}),fn(_o,Kg,Us,B8e,D8e,Ec,qg,G8e,V8e,tK,H8e));function W8e(e,t){const n={},s={};let i=0;const o=e.length;for(;i<o;)s[e[i]]=1,i+=1;for(const a in t)Object.hasOwn(s,a)||(n[a]=t[a]);return n}const Km=typeof document<"u"?be.useLayoutEffect:be.useEffect;function cK(e,t,n){const s=Object.keys(t.required||{}),i=Object.keys(t.optional||{}),o=Object.keys(t.methods||{}),a=Object.keys(t.events||{}),l=be.createContext({});function c(b,C){b.propsReady&&vt(b.propsReady,!1);for(const x of s){const v=b[t.required[x]];vt(v,C[x])}for(const x of i)if(x in C){const v=b[t.optional[x]];vt(v,C[x])}b.propsReady&&vt(b.propsReady,!0)}function d(b){return o.reduce((C,x)=>(C[x]=v=>{const w=b[t.methods[x]];vt(w,v)},C),{})}function h(b){return a.reduce((C,x)=>(C[x]=o8e(b[t.events[x]]),C),{})}const f=be.forwardRef((b,C)=>{const{children:x,...v}=b,[w]=be.useState(()=>ux(l8e(e),P=>{c(P,v)})),[S]=be.useState(A8(h,w));Km(()=>{for(const P of a)P in v&&Ht(S[P],v[P]);return()=>{Object.values(S).map(S4)}},[v,S,w]),Km(()=>{c(w,v)}),be.useImperativeHandle(C,T8(d(w)));const j=n;return r.jsx(l.Provider,{value:w,children:n?r.jsx(j,{...W8e([...s,...i,...a],v),children:x}):x})}),p=b=>be.useCallback(Gq(vt,be.useContext(l)[b]),[b]),g=b=>{const C=be.useContext(l)[b],x=be.useCallback(v=>Ht(C,v),[C]);return be.useSyncExternalStore(x,()=>Ts(C),()=>Ts(C))},m=b=>{const C=be.useContext(l)[b],[x,v]=be.useState(A8(Ts,C));return Km(()=>Ht(C,w=>{w!==x&&v(T8(w))}),[C,x]),x},y=be.version.startsWith("18")?g:m;return{Component:f,useEmitter:(b,C)=>{const x=be.useContext(l)[b];Km(()=>Ht(x,C),[C,x])},useEmitterValue:y,usePublisher:p}}const uK=be.createContext(void 0),dK=be.createContext(void 0),hK=typeof document<"u"?be.useLayoutEffect:be.useEffect;function fK(e,t,n,s=Tc,i,o){const a=be.useRef(null),l=be.useRef(null),c=be.useRef(null),d=be.useCallback(p=>{const g=p.target,m=g===window||g===document,y=o?m?window.pageXOffset||document.documentElement.scrollLeft:g.scrollLeft:m?window.pageYOffset||document.documentElement.scrollTop:g.scrollTop,b=o?m?document.documentElement.scrollWidth:g.scrollWidth:m?document.documentElement.scrollHeight:g.scrollHeight,C=o?m?window.innerWidth:g.offsetWidth:m?window.innerHeight:g.offsetHeight,x=()=>{e({scrollHeight:b,scrollTop:Math.max(y,0),viewportHeight:C})};p.suppressFlushSync?x():$L.flushSync(x),l.current!==null&&(y===l.current||y<=0||y===b-C)&&(l.current=null,t(!0),c.current&&(clearTimeout(c.current),c.current=null))},[e,t]);be.useEffect(()=>{const p=i||a.current;return s(i||a.current),d({suppressFlushSync:!0,target:p}),p.addEventListener("scroll",d,{passive:!0}),()=>{s(null),p.removeEventListener("scroll",d)}},[a,d,n,s,i]);function h(p){const g=a.current;if(!g||(o?"offsetWidth"in g&&g.offsetWidth===0:"offsetHeight"in g&&g.offsetHeight===0))return;const m=p.behavior==="smooth";let y,b,C;g===window?(b=Math.max(Za(document.documentElement,o?"width":"height"),o?document.documentElement.scrollWidth:document.documentElement.scrollHeight),y=o?window.innerWidth:window.innerHeight,C=o?document.documentElement.scrollLeft:document.documentElement.scrollTop):(b=g[o?"scrollWidth":"scrollHeight"],y=Za(g,o?"width":"height"),C=g[o?"scrollLeft":"scrollTop"]);const x=b-y;if(p.top=Math.ceil(Math.max(Math.min(x,p.top),0)),sK(y,b)||p.top===C){e({scrollHeight:b,scrollTop:C,viewportHeight:y}),m&&t(!0);return}m?(l.current=p.top,c.current&&clearTimeout(c.current),c.current=setTimeout(()=>{c.current=null,l.current=null,t(!0)},1e3)):l.current=null,o&&(p={behavior:p.behavior,left:p.top}),g.scrollTo(p)}function f(p){o&&(p={behavior:p.behavior,left:p.top}),a.current.scrollBy(p)}return{scrollByCallback:f,scrollerRef:a,scrollToCallback:h}}const u2="-webkit-sticky",$8="sticky",pK=aK(()=>{if(typeof document>"u")return $8;const e=document.createElement("div");return e.style.position=u2,e.style.position===u2?u2:$8});function M4(e){return e}const U8e=$t(()=>{const e=Ae(c=>`Item ${c}`),t=Ae(null),n=Ae(c=>`Group ${c}`),s=Ae({}),i=Ae(M4),o=Ae("div"),a=Ae(Tc),l=(c,d=null)=>As(ke(s,Ue(h=>h[c]),cn()),d);return{components:s,computeItemKey:i,context:t,EmptyPlaceholder:l("EmptyPlaceholder"),FooterComponent:l("Footer"),GroupComponent:l("Group","div"),groupContent:n,HeaderComponent:l("Header"),HeaderFooterTag:o,ItemComponent:l("Item","div"),itemContent:e,ListComponent:l("List","div"),ScrollerComponent:l("Scroller","div"),scrollerRef:a,ScrollSeekPlaceholder:l("ScrollSeekPlaceholder"),TopItemListComponent:l("TopItemList")}}),q8e=$t(([e,t])=>({...e,...t}),fn(lK,U8e)),K8e=({height:e})=>r.jsx("div",{style:{height:e}}),Z8e={overflowAnchor:"none",position:pK(),zIndex:1},gK={overflowAnchor:"none"},Y8e={...gK,display:"inline-block",height:"100%"},V8=be.memo(function({showTopList:e=!1}){const t=ft("listState"),n=ei("sizeRanges"),s=ft("useWindowScroll"),i=ft("customScrollParent"),o=ei("windowScrollContainerState"),a=ei("scrollContainerState"),l=i||s?o:a,c=ft("itemContent"),d=ft("context"),h=ft("groupContent"),f=ft("trackItemSizes"),p=ft("itemSize"),g=ft("log"),m=ei("gap"),y=ft("horizontalDirection"),{callbackRef:b}=d8e(n,p,f,e?Tc:l,g,m,i,y,ft("skipAnimationFrameInResizeObserver")),[C,x]=be.useState(0);P4("deviation",L=>{C!==L&&x(L)});const v=ft("EmptyPlaceholder"),w=ft("ScrollSeekPlaceholder")||K8e,S=ft("ListComponent"),j=ft("ItemComponent"),P=ft("GroupComponent"),E=ft("computeItemKey"),D=ft("isSeeking"),M=ft("groupIndices").length>0,R=ft("alignToBottom"),F=ft("initialItemFinalLocationReached"),_=e?{}:{boxSizing:"border-box",...y?{display:"inline-block",height:"100%",marginLeft:C!==0?C:R?"auto":0,paddingLeft:t.offsetTop,paddingRight:t.offsetBottom,whiteSpace:"nowrap"}:{marginTop:C!==0?C:R?"auto":0,paddingBottom:t.offsetBottom,paddingTop:t.offsetTop},...F?{}:{visibility:"hidden"}};return!e&&t.totalCount===0&&v?r.jsx(v,{...hs(v,d)}):r.jsx(S,{...hs(S,d),"data-testid":e?"virtuoso-top-item-list":"virtuoso-item-list",ref:b,style:_,children:(e?t.topItems:t.items).map(L=>{const O=L.originalIndex,B=E(O+t.firstItemIndex,L.data,d);return D?u.createElement(w,{...hs(w,d),height:L.size,index:L.index,key:B,type:L.type||"item",...L.type==="group"?{}:{groupIndex:L.groupIndex}}):L.type==="group"?u.createElement(P,{...hs(P,d),"data-index":O,"data-item-index":L.index,"data-known-size":L.size,key:B,style:Z8e},h(L.index,d)):u.createElement(j,{...hs(j,d),...e3e(j,L.data),"data-index":O,"data-item-group-index":L.groupIndex,"data-item-index":L.index,"data-known-size":L.size,key:B,style:y?Y8e:gK},M?c(L.index,L.groupIndex,L.data,d):c(L.index,L.data,d))})})}),X8e={height:"100%",outline:"none",overflowY:"auto",position:"relative",WebkitOverflowScrolling:"touch"},Q8e={outline:"none",overflowX:"auto",position:"relative"},fx=e=>({height:"100%",position:"absolute",top:0,width:"100%",...e?{display:"flex",flexDirection:"column"}:{}}),J8e={position:pK(),top:0,width:"100%",zIndex:1};function hs(e,t){if(typeof e!="string")return{context:t}}function e3e(e,t){return{item:typeof e=="string"?void 0:t}}const t3e=be.memo(function(){const e=ft("HeaderComponent"),t=ei("headerHeight"),n=ft("HeaderFooterTag"),s=Ac(be.useMemo(()=>o=>{t(Za(o,"height"))},[t]),!0,ft("skipAnimationFrameInResizeObserver")),i=ft("context");return e?r.jsx(n,{ref:s,children:r.jsx(e,{...hs(e,i)})}):null}),n3e=be.memo(function(){const e=ft("FooterComponent"),t=ei("footerHeight"),n=ft("HeaderFooterTag"),s=Ac(be.useMemo(()=>o=>{t(Za(o,"height"))},[t]),!0,ft("skipAnimationFrameInResizeObserver")),i=ft("context");return e?r.jsx(n,{ref:s,children:r.jsx(e,{...hs(e,i)})}):null});function mK({useEmitter:e,useEmitterValue:t,usePublisher:n}){return be.memo(function({children:s,style:i,...o}){const a=n("scrollContainerState"),l=t("ScrollerComponent"),c=n("smoothScrollTargetReached"),d=t("scrollerRef"),h=t("context"),f=t("horizontalDirection")||!1,{scrollByCallback:p,scrollerRef:g,scrollToCallback:m}=fK(a,c,l,d,void 0,f);return e("scrollTo",m),e("scrollBy",p),r.jsx(l,{"data-testid":"virtuoso-scroller","data-virtuoso-scroller":!0,ref:g,style:{...f?Q8e:X8e,...i},tabIndex:0,...o,...hs(l,h),children:s})})}function yK({useEmitter:e,useEmitterValue:t,usePublisher:n}){return be.memo(function({children:s,style:i,...o}){const a=n("windowScrollContainerState"),l=t("ScrollerComponent"),c=n("smoothScrollTargetReached"),d=t("totalListHeight"),h=t("deviation"),f=t("customScrollParent"),p=t("context"),{scrollByCallback:g,scrollerRef:m,scrollToCallback:y}=fK(a,c,l,Tc,f);return hK(()=>(m.current=f||window,()=>{m.current=null}),[m,f]),e("windowScrollTo",y),e("scrollBy",g),r.jsx(l,{"data-virtuoso-scroller":!0,style:{position:"relative",...i,...d!==0?{height:d+h}:{}},...o,...hs(l,p),children:s})})}const s3e=({children:e})=>{const t=be.useContext(uK),n=ei("viewportHeight"),s=ei("fixedItemHeight"),i=ft("alignToBottom"),o=ft("horizontalDirection"),a=be.useMemo(()=>zq(n,c=>Za(c,o?"width":"height")),[n,o]),l=Ac(a,!0,ft("skipAnimationFrameInResizeObserver"));return be.useEffect(()=>{t&&(n(t.viewportHeight),s(t.itemHeight))},[t,n,s]),r.jsx("div",{"data-viewport-type":"element",ref:l,style:fx(i),children:e})},r3e=({children:e})=>{const t=be.useContext(uK),n=ei("windowViewportRect"),s=ei("fixedItemHeight"),i=ft("customScrollParent"),o=Wq(n,i,ft("skipAnimationFrameInResizeObserver")),a=ft("alignToBottom");return be.useEffect(()=>{t&&(s(t.itemHeight),n({offsetTop:0,visibleHeight:t.viewportHeight,visibleWidth:100}))},[t,n,s]),r.jsx("div",{"data-viewport-type":"window",ref:o,style:fx(a),children:e})},i3e=({children:e})=>{const t=ft("TopItemListComponent")||"div",n=ft("headerHeight"),s={...J8e,marginTop:`${n}px`},i=ft("context");return r.jsx(t,{style:s,...hs(t,i),children:e})},o3e=be.memo(function(e){const t=ft("useWindowScroll"),n=ft("topItemsIndexes").length>0,s=ft("customScrollParent"),i=ft("context"),o=s||t?c3e:l3e,a=s||t?r3e:s3e;return r.jsxs(o,{...e,...hs(o,i),children:[n&&r.jsx(i3e,{children:r.jsx(V8,{showTopList:!0})}),r.jsxs(a,{children:[r.jsx(t3e,{}),r.jsx(V8,{}),r.jsx(n3e,{})]})]})}),{Component:a3e,useEmitter:P4,useEmitterValue:ft,usePublisher:ei}=cK(q8e,{events:{atBottomStateChange:"atBottomStateChange",atTopStateChange:"atTopStateChange",endReached:"endReached",groupIndices:"groupIndices",isScrolling:"isScrolling",itemsRendered:"itemsRendered",rangeChanged:"rangeChanged",startReached:"startReached",totalListHeightChanged:"totalListHeightChanged"},methods:{autoscrollToBottom:"autoscrollToBottom",getState:"getState",scrollBy:"scrollBy",scrollIntoView:"scrollIntoView",scrollTo:"scrollTo",scrollToIndex:"scrollToIndex"},optional:{alignToBottom:"alignToBottom",atBottomThreshold:"atBottomThreshold",atTopThreshold:"atTopThreshold",components:"components",computeItemKey:"computeItemKey",context:"context",customScrollParent:"customScrollParent",data:"data",defaultItemHeight:"defaultItemHeight",firstItemIndex:"firstItemIndex",fixedItemHeight:"fixedItemHeight",followOutput:"followOutput",groupContent:"groupContent",groupCounts:"groupCounts",headerFooterTag:"HeaderFooterTag",horizontalDirection:"horizontalDirection",increaseViewportBy:"increaseViewportBy",initialItemCount:"initialItemCount",initialScrollTop:"initialScrollTop",initialTopMostItemIndex:"initialTopMostItemIndex",itemContent:"itemContent",itemSize:"itemSize",logLevel:"logLevel",overscan:"overscan",restoreStateFrom:"restoreStateFrom",scrollerRef:"scrollerRef",scrollSeekConfiguration:"scrollSeekConfiguration",skipAnimationFrameInResizeObserver:"skipAnimationFrameInResizeObserver",topItemCount:"topItemCount",totalCount:"totalCount",useWindowScroll:"useWindowScroll"},required:{}},o3e),l3e=mK({useEmitter:P4,useEmitterValue:ft,usePublisher:ei}),c3e=yK({useEmitter:P4,useEmitterValue:ft,usePublisher:ei}),u3e=a3e,d3e=$t(()=>{const e=Ae(c=>r.jsxs("td",{children:["Item $",c]})),t=Ae(null),n=Ae(null),s=Ae(null),i=Ae({}),o=Ae(M4),a=Ae(Tc),l=(c,d=null)=>As(ke(i,Ue(h=>h[c]),cn()),d);return{components:i,computeItemKey:o,context:t,EmptyPlaceholder:l("EmptyPlaceholder"),FillerRow:l("FillerRow"),fixedFooterContent:s,fixedHeaderContent:n,itemContent:e,ScrollerComponent:l("Scroller","div"),scrollerRef:a,ScrollSeekPlaceholder:l("ScrollSeekPlaceholder"),TableBodyComponent:l("TableBody","tbody"),TableComponent:l("Table","table"),TableFooterComponent:l("TableFoot","tfoot"),TableHeadComponent:l("TableHead","thead"),TableRowComponent:l("TableRow","tr")}});fn(lK,d3e);const z8={bottom:0,itemHeight:0,items:[],itemWidth:0,offsetBottom:0,offsetTop:0,top:0},h3e={bottom:0,itemHeight:0,items:[{index:0}],itemWidth:0,offsetBottom:0,offsetTop:0,top:0},{ceil:G8,floor:cy,max:$f,min:d2,round:H8}=Math;function W8(e,t,n){return Array.from({length:t-e+1}).map((s,i)=>({data:n===null?null:n[i+e],index:i+e}))}function f3e(e){return{...h3e,items:e}}function Zm(e,t){return e&&e.width===t.width&&e.height===t.height}function p3e(e,t){return e&&e.column===t.column&&e.row===t.row}const g3e=$t(([{increaseViewportBy:e,listBoundary:t,overscan:n,visibleRange:s},{footerHeight:i,headerHeight:o,scrollBy:a,scrollContainerState:l,scrollTo:c,scrollTop:d,smoothScrollTargetReached:h,viewportHeight:f},p,g,{didMount:m,propsReady:y},{customScrollParent:b,useWindowScroll:C,windowScrollContainerState:x,windowScrollTo:v,windowViewportRect:w},S])=>{const j=Ae(0),P=Ae(0),E=Ae(z8),D=Ae({height:0,width:0}),M=Ae({height:0,width:0}),R=Et(),F=Et(),_=Ae(0),L=Ae(null),O=Ae({column:0,row:0}),B=Et(),z=Et(),ee=Ae(!1),ne=Ae(0),re=Ae(!0),te=Ae(!1),H=Ae(!1);Ht(ke(m,Ct(ne),ct(([N,U])=>!!U)),()=>{vt(re,!1)}),Ht(ke(Hn(m,re,M,D,ne,te),ct(([N,U,ie,ue,,xe])=>N&&!U&&ie.height!==0&&ue.height!==0&&!xe)),([,,,,N])=>{vt(te,!0),I4(1,()=>{vt(R,N)}),bo(ke(d),()=>{vt(t,[0,0]),vt(re,!0)})}),Ke(ke(z,ct(N=>N!=null&&N.scrollTop>0),qi(0)),P),Ht(ke(m,Ct(z),ct(([,N])=>N!=null)),([,N])=>{N&&(vt(D,N.viewport),vt(M,N.item),vt(O,N.gap),N.scrollTop>0&&(vt(ee,!0),bo(ke(d,Yu(1)),U=>{vt(ee,!1)}),vt(c,{top:N.scrollTop})))}),Ke(ke(D,Ue(({height:N})=>N)),f),Ke(ke(Hn(dt(D,Zm),dt(M,Zm),dt(O,(N,U)=>N&&N.column===U.column&&N.row===U.row),dt(d)),Ue(([N,U,ie,ue])=>({gap:ie,item:U,scrollTop:ue,viewport:N}))),B),Ke(ke(Hn(dt(j),s,dt(O,p3e),dt(M,Zm),dt(D,Zm),dt(L),dt(P),dt(ee),dt(re),dt(ne)),ct(([,,,,,,,N])=>!N),Ue(([N,[U,ie],ue,xe,Me,je,Fe,,nt,$e])=>{const{column:Z,row:se}=ue,{height:le,width:ve}=xe,{width:ye}=Me;if(Fe===0&&(N===0||ye===0))return z8;if(ve===0){const bn=T4($e,N),ls=bn+Math.max(Fe-1,0);return f3e(W8(bn,ls,je))}const me=bK(ye,ve,Z);let ce,Ce;nt?U===0&&ie===0&&Fe>0?(ce=0,Ce=Fe-1):(ce=me*cy((U+se)/(le+se)),Ce=me*G8((ie+se)/(le+se))-1,Ce=d2(N-1,$f(Ce,me-1)),ce=d2(Ce,$f(0,ce))):(ce=0,Ce=-1);const He=W8(ce,Ce,je),{bottom:Xe,top:mt}=U8(Me,ue,xe,He),rn=G8(N/me),pn=rn*le+(rn-1)*se-Xe;return{bottom:Xe,itemHeight:le,items:He,itemWidth:ve,offsetBottom:pn,offsetTop:mt,top:mt}})),E),Ke(ke(L,ct(N=>N!==null),Ue(N=>N.length)),j),Ke(ke(Hn(D,M,E,O),ct(([N,U,{items:ie}])=>ie.length>0&&U.height!==0&&N.height!==0),Ue(([N,U,{items:ie},ue])=>{const{bottom:xe,top:Me}=U8(N,ue,U,ie);return[Me,xe]}),cn(bp)),t);const V=Ae(!1);Ke(ke(d,Ct(V),Ue(([N,U])=>U||N!==0)),V);const X=_r(ke(Hn(E,j),ct(([{items:N}])=>N.length>0),Ct(V),ct(([[N,U],ie])=>{const ue=N.items[N.items.length-1].index===U-1;return(ie||N.bottom>0&&N.itemHeight>0&&N.offsetBottom===0&&N.items.length===U)&&ue}),Ue(([[,N]])=>N-1),cn())),W=_r(ke(dt(E),ct(({items:N})=>N.length>0&&N[0].index===0),qi(0),cn())),Y=_r(ke(dt(E),Ct(ee),ct(([{items:N},U])=>N.length>0&&!U),Ue(([{items:N}])=>({endIndex:N[N.length-1].index,startIndex:N[0].index})),cn(Xq),Oa(0)));Ke(Y,g.scrollSeekRangeChanged),Ke(ke(R,Ct(D,M,j,O),Ue(([N,U,ie,ue,xe])=>{const Me=nK(N),{align:je,behavior:Fe,offset:nt}=Me;let $e=Me.index;$e==="LAST"&&($e=ue-1),$e=$f(0,$e,d2(ue-1,$e));let Z=Nw(U,xe,ie,$e);return je==="end"?Z=H8(Z-U.height+ie.height):je==="center"&&(Z=H8(Z-U.height/2+ie.height/2)),nt&&(Z+=nt),{behavior:Fe,top:Z}})),c);const $=As(ke(E,Ue(N=>N.offsetBottom+N.bottom)),0);return Ke(ke(w,Ue(N=>({height:N.visibleHeight,width:N.visibleWidth}))),D),{customScrollParent:b,data:L,deviation:_,footerHeight:i,gap:O,headerHeight:o,increaseViewportBy:e,initialItemCount:P,itemDimensions:M,overscan:n,restoreStateFrom:z,scrollBy:a,scrollContainerState:l,scrollHeight:F,scrollTo:c,scrollToIndex:R,scrollTop:d,smoothScrollTargetReached:h,totalCount:j,useWindowScroll:C,viewportDimensions:D,windowScrollContainerState:x,windowScrollTo:v,windowViewportRect:w,...g,gridState:E,horizontalDirection:H,initialTopMostItemIndex:ne,totalListHeight:$,...p,endReached:X,propsReady:y,rangeChanged:Y,startReached:W,stateChanged:B,stateRestoreInProgress:ee,...S}},fn(A4,Us,Zg,oK,fl,E4,hl));function bK(e,t,n){return $f(1,cy((e+n)/(cy(t)+n)))}function U8(e,t,n,s){const{height:i}=n;if(i===void 0||s.length===0)return{bottom:0,top:0};const o=Nw(e,t,n,s[0].index);return{bottom:Nw(e,t,n,s[s.length-1].index)+i,top:o}}function Nw(e,t,n,s){const i=bK(e.width,n.width,t.column),o=cy(s/i),a=o*n.height+$f(0,o-1)*t.row;return a>0?a+t.row:a}const m3e=$t(()=>{const e=Ae(f=>`Item ${f}`),t=Ae({}),n=Ae(null),s=Ae("virtuoso-grid-item"),i=Ae("virtuoso-grid-list"),o=Ae(M4),a=Ae("div"),l=Ae(Tc),c=(f,p=null)=>As(ke(t,Ue(g=>g[f]),cn()),p),d=Ae(!1),h=Ae(!1);return Ke(dt(h),d),{components:t,computeItemKey:o,context:n,FooterComponent:c("Footer"),HeaderComponent:c("Header"),headerFooterTag:a,itemClassName:s,ItemComponent:c("Item","div"),itemContent:e,listClassName:i,ListComponent:c("List","div"),readyStateChanged:d,reportReadyState:h,ScrollerComponent:c("Scroller","div"),scrollerRef:l,ScrollSeekPlaceholder:c("ScrollSeekPlaceholder","div")}}),y3e=$t(([e,t])=>({...e,...t}),fn(g3e,m3e)),b3e=be.memo(function(){const e=mn("gridState"),t=mn("listClassName"),n=mn("itemClassName"),s=mn("itemContent"),i=mn("computeItemKey"),o=mn("isSeeking"),a=ti("scrollHeight"),l=mn("ItemComponent"),c=mn("ListComponent"),d=mn("ScrollSeekPlaceholder"),h=mn("context"),f=ti("itemDimensions"),p=ti("gap"),g=mn("log"),m=mn("stateRestoreInProgress"),y=ti("reportReadyState"),b=Ac(be.useMemo(()=>C=>{const x=C.parentElement.parentElement.scrollHeight;a(x);const v=C.firstChild;if(v){const{height:w,width:S}=v.getBoundingClientRect();f({height:w,width:S})}p({column:q8("column-gap",getComputedStyle(C).columnGap,g),row:q8("row-gap",getComputedStyle(C).rowGap,g)})},[a,f,p,g]),!0,!1);return hK(()=>{e.itemHeight>0&&e.itemWidth>0&&y(!0)},[e]),m?null:r.jsx(c,{className:t,ref:b,...hs(c,h),"data-testid":"virtuoso-item-list",style:{paddingBottom:e.offsetBottom,paddingTop:e.offsetTop},children:e.items.map(C=>{const x=i(C.index,C.data,h);return o?r.jsx(d,{...hs(d,h),height:e.itemHeight,index:C.index,width:e.itemWidth},x):u.createElement(l,{...hs(l,h),className:n,"data-index":C.index,key:x},s(C.index,C.data,h))})})}),x3e=be.memo(function(){const e=mn("HeaderComponent"),t=ti("headerHeight"),n=mn("headerFooterTag"),s=Ac(be.useMemo(()=>o=>{t(Za(o,"height"))},[t]),!0,!1),i=mn("context");return e?r.jsx(n,{ref:s,children:r.jsx(e,{...hs(e,i)})}):null}),v3e=be.memo(function(){const e=mn("FooterComponent"),t=ti("footerHeight"),n=mn("headerFooterTag"),s=Ac(be.useMemo(()=>o=>{t(Za(o,"height"))},[t]),!0,!1),i=mn("context");return e?r.jsx(n,{ref:s,children:r.jsx(e,{...hs(e,i)})}):null}),C3e=({children:e})=>{const t=be.useContext(dK),n=ti("itemDimensions"),s=ti("viewportDimensions"),i=Ac(be.useMemo(()=>o=>{s(o.getBoundingClientRect())},[s]),!0,!1);return be.useEffect(()=>{t&&(s({height:t.viewportHeight,width:t.viewportWidth}),n({height:t.itemHeight,width:t.itemWidth}))},[t,s,n]),r.jsx("div",{ref:i,style:fx(!1),children:e})},w3e=({children:e})=>{const t=be.useContext(dK),n=ti("windowViewportRect"),s=ti("itemDimensions"),i=mn("customScrollParent"),o=Wq(n,i,!1);return be.useEffect(()=>{t&&(s({height:t.itemHeight,width:t.itemWidth}),n({offsetTop:0,visibleHeight:t.viewportHeight,visibleWidth:t.viewportWidth}))},[t,n,s]),r.jsx("div",{ref:o,style:fx(!1),children:e})},S3e=be.memo(function({...e}){const t=mn("useWindowScroll"),n=mn("customScrollParent"),s=n||t?k3e:j3e,i=n||t?w3e:C3e,o=mn("context");return r.jsx(s,{...e,...hs(s,o),children:r.jsxs(i,{children:[r.jsx(x3e,{}),r.jsx(b3e,{}),r.jsx(v3e,{})]})})}),{useEmitter:xK,useEmitterValue:mn,usePublisher:ti}=cK(y3e,{events:{atBottomStateChange:"atBottomStateChange",atTopStateChange:"atTopStateChange",endReached:"endReached",isScrolling:"isScrolling",rangeChanged:"rangeChanged",readyStateChanged:"readyStateChanged",startReached:"startReached",stateChanged:"stateChanged"},methods:{scrollBy:"scrollBy",scrollTo:"scrollTo",scrollToIndex:"scrollToIndex"},optional:{components:"components",computeItemKey:"computeItemKey",context:"context",customScrollParent:"customScrollParent",data:"data",headerFooterTag:"headerFooterTag",increaseViewportBy:"increaseViewportBy",initialItemCount:"initialItemCount",initialTopMostItemIndex:"initialTopMostItemIndex",itemClassName:"itemClassName",itemContent:"itemContent",listClassName:"listClassName",logLevel:"logLevel",overscan:"overscan",restoreStateFrom:"restoreStateFrom",scrollerRef:"scrollerRef",scrollSeekConfiguration:"scrollSeekConfiguration",totalCount:"totalCount",useWindowScroll:"useWindowScroll"}},S3e),j3e=mK({useEmitter:xK,useEmitterValue:mn,usePublisher:ti}),k3e=yK({useEmitter:xK,useEmitterValue:mn,usePublisher:ti});function q8(e,t,n){return t!=="normal"&&!(t!=null&&t.endsWith("px"))&&n(`${e} was not resolved to pixel value correctly`,t,Ir.WARN),t==="normal"?0:parseInt(t??"0",10)}const K8={pending:{colorScheme:"cyan",translationKey:"queue.pending"},in_progress:{colorScheme:"yellow",translationKey:"queue.in_progress"},completed:{colorScheme:"green",translationKey:"queue.completed"},failed:{colorScheme:"red",translationKey:"queue.failed"},canceled:{colorScheme:"orange",translationKey:"queue.canceled"}},_3e=({status:e})=>{const{t}=A();return r.jsx(Kn,{colorScheme:K8[e].colorScheme,children:t(K8[e].translationKey)})},I3e=u.memo(_3e),vK=e=>{const{t}=A();return t(e==="canvas"?"queue.canvas":e==="gallery"?"queue.gallery":"queue.other")},CK=e=>{const{t}=A();return t(e==="generation"?"queue.generation":e==="workflows"?"queue.workflows":e==="upscaling"?"queue.upscaling":"queue.other")},wK=e=>{const t=ae(Yn),[n,{isLoading:s}]=Ww(),{t:i}=A();return{cancelQueueItem:u.useCallback(async()=>{try{await n(e).unwrap(),ge({id:"QUEUE_CANCEL_SUCCEEDED",title:i("queue.cancelSucceeded"),status:"success"})}catch{ge({id:"QUEUE_CANCEL_FAILED",title:i("queue.cancelFailed"),status:"error"})}},[e,i,n]),isLoading:s,isDisabled:!t}},SK=e=>{const t=ae(Yn),[n,{isLoading:s}]=toe(),{t:i}=A();return{retryQueueItem:u.useCallback(async()=>{try{if(!(await n([e]).unwrap()).retried_item_ids.includes(e))throw new Error("Failed to retry item");ge({id:"QUEUE_RETRY_SUCCEEDED",title:i("queue.retrySucceeded"),status:"success"})}catch{ge({id:"QUEUE_RETRY_FAILED",title:i("queue.retryFailed"),status:"error"})}},[e,i,n]),isLoading:s,isDisabled:!t}},jK=(e,t)=>Number(((Date.parse(t)-Date.parse(e))/1e3).toFixed(2)),zs={number:"3rem",statusBadge:"5.7rem",time:"4rem",origin:"5rem",destination:"6rem",batchId:"5rem",fieldValues:"auto",validationRun:"auto",actions:"auto"},T3e=e=>{const t=ae(Yn),{isCanceled:n}=F3({batch_id:e},{selectFromResult:({data:l})=>l?{isCanceled:(l==null?void 0:l.in_progress)===0&&(l==null?void 0:l.pending)===0}:{isCanceled:!0}}),[s,{isLoading:i}]=noe({fixedCacheKey:"cancelByBatchIds"}),{t:o}=A();return{cancelBatch:u.useCallback(async()=>{if(!n)try{await s({batch_ids:[e]}).unwrap(),ge({id:"CANCEL_BATCH_SUCCEEDED",title:o("queue.cancelBatchSucceeded"),status:"success"})}catch{ge({id:"CANCEL_BATCH_FAILED",title:o("queue.cancelBatchFailed"),status:"error"})}},[e,n,o,s]),isLoading:i,isCanceled:n,isDisabled:!t}},A3e=({queueItemDTO:e})=>{const{session_id:t,batch_id:n,item_id:s,origin:i,destination:o}=e,{t:a}=A(),l=Bt("retryQueueItem"),{cancelBatch:c,isLoading:d,isCanceled:h}=T3e(n),{cancelQueueItem:f,isLoading:p}=wK(s),{retryQueueItem:g,isLoading:m}=SK(s),{data:y}=soe(s),b=CK(i),C=vK(o),x=u.useMemo(()=>{if(!y)return a("common.loading");if(!y.completed_at||!y.started_at)return a(`queue.${y.status}`);const S=jK(y.started_at,y.completed_at);return y.status==="completed"?`${a("queue.completedIn")} ${S}${S===1?"":"s"}`:`${S}s`},[y,a]),v=u.useMemo(()=>!!y&&["canceled","completed","failed"].includes(y.status),[y]),w=u.useMemo(()=>!!y&&["canceled","failed"].includes(y.status),[y]);return r.jsxs(T,{layerStyle:"third",flexDir:"column",p:2,pt:0,borderRadius:"base",gap:2,children:[r.jsxs(T,{layerStyle:"second",p:2,gap:2,justifyContent:"space-between",alignItems:"center",borderRadius:"base",h:20,children:[r.jsx(Hc,{label:a("queue.status"),data:x}),r.jsx(Hc,{label:a("queue.origin"),data:b}),r.jsx(Hc,{label:a("queue.destination"),data:C}),r.jsx(Hc,{label:a("queue.item"),data:s}),r.jsx(Hc,{label:a("queue.batch"),data:n}),r.jsx(Hc,{label:a("queue.session"),data:t}),r.jsxs(Zn,{size:"xs",orientation:"vertical",children:[(!w||!l)&&r.jsx(de,{onClick:f,isLoading:p,isDisabled:y?v:!0,"aria-label":a("queue.cancelItem"),leftIcon:r.jsx(Ot,{}),colorScheme:"error",children:a("queue.cancelItem")}),w&&l&&r.jsx(de,{onClick:g,isLoading:m,isDisabled:!y,"aria-label":a("queue.retryItem"),leftIcon:r.jsx(ur,{}),colorScheme:"invokeBlue",children:a("queue.retryItem")}),r.jsx(de,{onClick:c,isLoading:d,isDisabled:h,"aria-label":a("queue.cancelBatch"),leftIcon:r.jsx(Ot,{}),colorScheme:"error",children:a("queue.cancelBatch")})]})]}),((y==null?void 0:y.error_traceback)||(y==null?void 0:y.error_message))&&r.jsxs(T,{layerStyle:"second",p:3,gap:1,justifyContent:"space-between",alignItems:"flex-start",borderRadius:"base",flexDir:"column",children:[r.jsx(Ft,{size:"sm",color:"error.400",children:a("common.error")}),r.jsx("pre",{children:(y==null?void 0:y.error_traceback)||(y==null?void 0:y.error_message)})]}),r.jsx(T,{layerStyle:"second",h:512,w:"full",borderRadius:"base",alignItems:"center",justifyContent:"center",children:y?r.jsx(yo,{label:"Queue Item",data:y,extraCopyActions:[{label:"Graph",getData:S=>vP(S,"session.graph")}]}):r.jsx(Lr,{opacity:.5})})]})},E3e=u.memo(A3e),Hc=({label:e,data:t})=>r.jsxs(T,{flexDir:"column",justifyContent:"flex-start",p:1,gap:1,overflow:"hidden",h:"full",w:"full",children:[r.jsx(Ft,{size:"md",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",children:e}),r.jsx(q,{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",children:t})]}),Z8={bg:"base.700"},M3e={_hover:Z8,"&[aria-selected='true']":Z8},P3e=({index:e,item:t,context:n})=>{const{t:s}=A(),i=Bt("retryQueueItem"),o=u.useCallback(()=>{n.toggleQueueItem(t.item_id)},[n,t.item_id]),{cancelQueueItem:a,isLoading:l}=wK(t.item_id),c=u.useCallback(v=>{v.stopPropagation(),a()},[a]),{retryQueueItem:d,isLoading:h}=SK(t.item_id),f=u.useCallback(v=>{v.stopPropagation(),d()},[d]),p=u.useMemo(()=>n.openQueueItems.includes(t.item_id),[n.openQueueItems,t.item_id]),g=u.useMemo(()=>!t.completed_at||!t.started_at?void 0:`${jK(t.started_at,t.completed_at)}s`,[t]),m=u.useMemo(()=>["canceled","completed","failed"].includes(t.status),[t.status]),y=u.useMemo(()=>["canceled","failed"].includes(t.status),[t.status]),b=u.useMemo(()=>t.is_api_validation_run===!0,[t.is_api_validation_run]),C=CK(t.origin),x=vK(t.destination);return r.jsxs(T,{flexDir:"column","aria-selected":p,fontSize:"sm",borderRadius:"base",justifyContent:"center",sx:M3e,"data-testid":"queue-item",children:[r.jsxs(T,{minH:9,alignItems:"center",gap:4,p:1.5,cursor:"pointer",onClick:o,children:[r.jsx(T,{w:zs.number,justifyContent:"flex-end",alignItems:"center",flexShrink:0,children:r.jsx(q,{variant:"subtext",children:e+1})}),r.jsx(T,{w:zs.statusBadge,alignItems:"center",flexShrink:0,children:r.jsx(I3e,{status:t.status})}),r.jsx(T,{w:zs.origin,flexShrink:0,children:r.jsx(q,{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",alignItems:"center",children:C})}),r.jsx(T,{w:zs.destination,flexShrink:0,children:r.jsx(q,{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",alignItems:"center",children:x})}),r.jsx(T,{w:zs.time,alignItems:"center",flexShrink:0,children:g||"-"}),r.jsx(T,{w:zs.batchId,flexShrink:0,children:r.jsx(q,{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",alignItems:"center",children:t.batch_id})}),r.jsx(T,{alignItems:"center",overflow:"hidden",flexGrow:1,children:t.field_values&&r.jsx(T,{gap:2,w:"full",whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden",children:t.field_values.filter(v=>v.node_path!=="metadata_accumulator").map(({node_path:v,field_name:w,value:S})=>r.jsxs(q,{as:"span",children:[r.jsxs(q,{as:"span",fontWeight:"semibold",children:[v,".",w]}),": ",JSON.stringify(S)]},`${t.item_id}.${v}.${w}.${S}`))})}),r.jsx(T,{alignItems:"center",w:zs.validationRun,flexShrink:0,children:b&&r.jsx(Kn,{children:s("workflows.builder.publishingValidationRun")})}),r.jsx(T,{alignItems:"center",w:zs.actions,pe:3,children:r.jsxs(Zn,{size:"xs",variant:"ghost",children:[(!y||!i||b)&&r.jsx(oe,{onClick:c,isDisabled:m,isLoading:l,"aria-label":s("queue.cancelItem"),icon:r.jsx(Ot,{})}),y&&i&&!b&&r.jsx(oe,{onClick:f,isLoading:h,"aria-label":s("queue.retryItem"),icon:r.jsx(ur,{})})]})})]}),r.jsx(Ja,{in:p,transition:L3e,unmountOnExit:!0,children:r.jsx(E3e,{queueItemDTO:t})})]})},L3e={enter:{duration:.1},exit:{duration:.1}},D3e=u.memo(P3e),kK=Wp(oL((e,t)=>r.jsx(T,{...e,ref:t,flexDirection:"column",gap:.5,children:e.children})));kK.displayName="QueueListComponent";const R3e=()=>{const{t:e}=A();return r.jsxs(T,{alignItems:"center",gap:4,p:1,pb:2,textTransform:"uppercase",fontWeight:"bold",fontSize:"sm",letterSpacing:1,children:[r.jsx(T,{w:zs.number,justifyContent:"flex-end",alignItems:"center",children:r.jsx(q,{variant:"subtext",children:"#"})}),r.jsx(T,{ps:.5,w:zs.statusBadge,alignItems:"center",children:r.jsx(q,{variant:"subtext",children:e("queue.status")})}),r.jsx(T,{ps:.5,w:zs.origin,alignItems:"center",children:r.jsx(q,{variant:"subtext",children:e("queue.origin")})}),r.jsx(T,{ps:.5,w:zs.destination,alignItems:"center",children:r.jsx(q,{variant:"subtext",children:e("queue.destination")})}),r.jsx(T,{ps:.5,w:zs.time,alignItems:"center",children:r.jsx(q,{variant:"subtext",children:e("queue.time")})}),r.jsx(T,{ps:.5,w:zs.batchId,alignItems:"center",children:r.jsx(q,{variant:"subtext",children:e("queue.batch")})}),r.jsx(T,{ps:.5,w:zs.fieldValues,alignItems:"center",children:r.jsx(q,{variant:"subtext",children:e("queue.batchFieldValues")})})]})},O3e=u.memo(R3e),N3e=(e,t)=>t.item_id,F3e={List:kK},B3e=(e,t,n)=>r.jsx(D3e,{index:e,item:t,context:n}),$3e=()=>{const e=I(roe),t=I(ioe),n=G(),s=u.useRef(null),[i,o]=u.useState(null),[a,l]=LR(Ul),{t:c}=A();u.useEffect(()=>{const{current:C}=s;return i&&C&&a({target:C,elements:{viewport:i}}),()=>{var x;return(x=l())==null?void 0:x.destroy()}},[i,a,l]);const{data:d,isLoading:h}=ooe({cursor:e,priority:t}),f=u.useMemo(()=>d?aoe.selectAll(d):[],[d]),p=u.useCallback(()=>{if(!(d!=null&&d.has_more))return;const C=f[f.length-1];C&&(n(Uw(C.item_id)),n(qw(C.priority)))},[n,d==null?void 0:d.has_more,f]),[g,m]=u.useState([]),y=u.useCallback(C=>{m(x=>x.includes(C)?x.filter(v=>v!==C):[...x,C])},[]),b=u.useMemo(()=>({openQueueItems:g,toggleQueueItem:y}),[g,y]);return h?r.jsx(xb,{}):f.length?r.jsxs(T,{w:"full",h:"full",flexDir:"column",children:[r.jsx(O3e,{}),r.jsx(T,{ref:s,w:"full",h:"full",alignItems:"center",justifyContent:"center",children:r.jsx(u3e,{data:f,endReached:p,scrollerRef:o,itemContent:B3e,computeItemKey:N3e,components:F3e,context:b})})]}):r.jsx(T,{w:"full",h:"full",alignItems:"center",justifyContent:"center",children:r.jsx(Ft,{color:"base.500",children:c("queue.queueEmpty")})})},V3e=u.memo($3e),z3e=()=>{const{data:e}=oi(),{t}=A();return r.jsxs($q,{"data-testid":"queue-status",children:[r.jsx(Ui,{label:t("queue.in_progress"),value:(e==null?void 0:e.queue.in_progress)??0}),r.jsx(Ui,{label:t("queue.pending"),value:(e==null?void 0:e.queue.pending)??0}),r.jsx(Ui,{label:t("queue.completed"),value:(e==null?void 0:e.queue.completed)??0}),r.jsx(Ui,{label:t("queue.failed"),value:(e==null?void 0:e.queue.failed)??0}),r.jsx(Ui,{label:t("queue.canceled"),value:(e==null?void 0:e.queue.canceled)??0}),r.jsx(Ui,{label:t("queue.total"),value:(e==null?void 0:e.queue.total)??0})]})},G3e=u.memo(z3e),_K=u.memo(e=>{const{t}=A(),n=mg();return r.jsx(r.Fragment,{children:r.jsx(de,{onClick:n.openDialog,isLoading:n.isLoading,isDisabled:n.isDisabled,tooltip:t("queue.cancelAllExceptCurrentTooltip"),leftIcon:r.jsx(fb,{}),colorScheme:"error","data-testid":t("queue.clear"),...e,children:t("queue.clear")})})});_K.displayName="CancelAllExceptCurrentButton";const H3e=()=>{const e=Bt("modelCache"),[t,{isLoading:n}]=loe(),{t:s}=A(),i=u.useCallback(async()=>{try{await t().unwrap(),ge({status:"success",title:s("modelCache.clearSucceeded")})}catch{ge({status:"error",title:s("modelCache.clearFailed")})}},[t,s]);return e?r.jsx(de,{size:"sm",colorScheme:"red",onClick:i,isLoading:n,children:s("modelCache.clear")}):r.jsx(r.Fragment,{})},W3e=u.memo(H3e),U3e=e=>{const{t}=A(),n=yg();return r.jsx(r.Fragment,{children:r.jsx(de,{isDisabled:n.isDisabled,isLoading:n.isLoading,tooltip:t("queue.clearTooltip"),leftIcon:r.jsx(hb,{}),colorScheme:"error",onClick:n.openDialog,"data-testid":t("queue.clear"),...e,children:t("queue.clear")})})},q3e=u.memo(U3e),K3e=({label:e,tooltip:t,icon:n,onClick:s,isDisabled:i,colorScheme:o,asIconButton:a,isLoading:l,loadingText:c,sx:d})=>a?r.jsx(oe,{"aria-label":e,tooltip:t,icon:n,onClick:s,isDisabled:i,colorScheme:o,isLoading:l,sx:d,"data-testid":e}):r.jsx(de,{"aria-label":e,tooltip:t,leftIcon:n,onClick:s,isDisabled:i,colorScheme:o,isLoading:l,loadingText:c??e,flexGrow:1,sx:d,"data-testid":e,children:e}),L4=u.memo(K3e),Z3e=({asIconButton:e})=>{const{t}=A(),{pauseProcessor:n,isLoading:s,isDisabled:i}=yU();return r.jsx(L4,{asIconButton:e,label:t("queue.pause"),tooltip:t("queue.pauseTooltip"),isDisabled:i,isLoading:s,icon:r.jsx(a7,{}),onClick:n,colorScheme:"gold"})},Y3e=u.memo(Z3e),X3e=()=>{const e=G(),{t}=A(),n=ae(Yn),[s,{isLoading:i}]=UP({fixedCacheKey:"pruneQueue"}),{finishedCount:o}=oi(void 0,{selectFromResult:({data:c})=>c?{finishedCount:c.queue.completed+c.queue.canceled+c.queue.failed}:{finishedCount:0}}),a=u.useCallback(async()=>{if(o)try{const c=await s().unwrap();ge({id:"PRUNE_SUCCEEDED",title:t("queue.pruneSucceeded",{item_count:c.deleted}),status:"success"}),e(Uw(void 0)),e(qw(void 0))}catch{ge({id:"PRUNE_FAILED",title:t("queue.pruneFailed"),status:"error"})}},[o,s,e,t]),l=u.useMemo(()=>!n||!o,[o,n]);return{pruneQueue:a,isLoading:i,finishedCount:o,isDisabled:l}},Q3e=({asIconButton:e})=>{const{t}=A(),{pruneQueue:n,isLoading:s,finishedCount:i,isDisabled:o}=X3e();return r.jsx(L4,{isDisabled:o,isLoading:s,asIconButton:e,label:t("queue.prune"),tooltip:t("queue.pruneTooltip",{item_count:i}),icon:r.jsx(Ade,{}),onClick:n,colorScheme:"invokeBlue"})},J3e=u.memo(Q3e),eMe=({asIconButton:e})=>{const{t}=A(),{resumeProcessor:n,isLoading:s,isDisabled:i}=bU();return r.jsx(L4,{asIconButton:e,label:t("queue.resume"),tooltip:t("queue.resumeTooltip"),isDisabled:i,isLoading:s,icon:r.jsx(l7,{}),onClick:n,colorScheme:"green"})},tMe=u.memo(eMe),nMe=()=>{const e=Bt("pauseQueue"),t=Bt("resumeQueue"),n=Bt("cancelAndClearAll");return r.jsxs(T,{flexDir:"column",layerStyle:"first",borderRadius:"base",p:2,gap:2,children:[r.jsxs(T,{gap:2,children:[e||t?r.jsxs(Zn,{w:28,orientation:"vertical",size:"sm",children:[t?r.jsx(tMe,{}):r.jsx(r.Fragment,{}),e?r.jsx(Y3e,{}):r.jsx(r.Fragment,{})]}):r.jsx(r.Fragment,{}),r.jsxs(Zn,{w:28,orientation:"vertical",size:"sm",children:[r.jsx(J3e,{}),n&&r.jsx(q3e,{}),!n&&r.jsx(_K,{})]})]}),r.jsx(W3e,{})]})},sMe=u.memo(nMe),rMe=()=>{const e=Bt("invocationCache"),t=I(An);return r.jsxs(T,{display:t==="queue"?void 0:"none",hidden:t!=="queue",borderRadius:"base",w:"full",h:"full",flexDir:"column",gap:2,children:[r.jsxs(T,{gap:2,w:"full",children:[r.jsx(sMe,{}),r.jsx(G3e,{}),e&&r.jsx(t8e,{})]}),r.jsx(Se,{layerStyle:"first",p:2,borderRadius:"base",w:"full",h:"full",children:r.jsx(V3e,{})})]})},iMe=u.memo(rMe),oMe=()=>r.jsx(T,{layerStyle:"body",w:"full",h:"full",children:r.jsx(iMe,{})}),aMe=u.memo(oMe);var Y8=1,lMe=.9,cMe=.8,uMe=.17,h2=.1,f2=.999,dMe=.9999,hMe=.99,fMe=/[\\\/_+.#"@\[\(\{&]/,pMe=/[\\\/_+.#"@\[\(\{&]/g,gMe=/[\s-]/,IK=/[\s-]/g;function Fw(e,t,n,s,i,o,a){if(o===t.length)return i===e.length?Y8:hMe;var l=`${i},${o}`;if(a[l]!==void 0)return a[l];for(var c=s.charAt(o),d=n.indexOf(c,i),h=0,f,p,g,m;d>=0;)f=Fw(e,t,n,s,d+1,o+1,a),f>h&&(d===i?f*=Y8:fMe.test(e.charAt(d-1))?(f*=cMe,g=e.slice(i,d-1).match(pMe),g&&i>0&&(f*=Math.pow(f2,g.length))):gMe.test(e.charAt(d-1))?(f*=lMe,m=e.slice(i,d-1).match(IK),m&&i>0&&(f*=Math.pow(f2,m.length))):(f*=uMe,i>0&&(f*=Math.pow(f2,d-i))),e.charAt(d)!==t.charAt(o)&&(f*=dMe)),(f<h2&&n.charAt(d-1)===s.charAt(o+1)||s.charAt(o+1)===s.charAt(o)&&n.charAt(d-1)!==s.charAt(o))&&(p=Fw(e,t,n,s,d+1,o+2,a),p*h2>f&&(f=p*h2)),f>h&&(h=f),d=n.indexOf(c,d+1);return a[l]=h,h}function X8(e){return e.toLowerCase().replace(IK," ")}function mMe(e,t,n){return e=n&&n.length>0?`${e+" "+n.join(" ")}`:e,Fw(e,t,X8(e),X8(t),0,0,{})}function Pu(e,t,{checkForDefaultPrevented:n=!0}={}){return function(i){if(e==null||e(i),n===!1||!i.defaultPrevented)return t==null?void 0:t(i)}}function yMe(e,t){typeof e=="function"?e(t):e!=null&&(e.current=t)}function TK(...e){return t=>e.forEach(n=>yMe(n,t))}function Yg(...e){return u.useCallback(TK(...e),e)}function bMe(e,t){const n=u.createContext(t);function s(o){const{children:a,...l}=o,c=u.useMemo(()=>l,Object.values(l));return u.createElement(n.Provider,{value:c},a)}function i(o){const a=u.useContext(n);if(a)return a;if(t!==void 0)return t;throw new Error(`\`${o}\` must be used within \`${e}\``)}return s.displayName=e+"Provider",[s,i]}function xMe(e,t=[]){let n=[];function s(o,a){const l=u.createContext(a),c=n.length;n=[...n,a];function d(f){const{scope:p,children:g,...m}=f,y=(p==null?void 0:p[e][c])||l,b=u.useMemo(()=>m,Object.values(m));return u.createElement(y.Provider,{value:b},g)}function h(f,p){const g=(p==null?void 0:p[e][c])||l,m=u.useContext(g);if(m)return m;if(a!==void 0)return a;throw new Error(`\`${f}\` must be used within \`${o}\``)}return d.displayName=o+"Provider",[d,h]}const i=()=>{const o=n.map(a=>u.createContext(a));return function(l){const c=(l==null?void 0:l[e])||o;return u.useMemo(()=>({[`__scope${e}`]:{...l,[e]:c}}),[l,c])}};return i.scopeName=e,[s,vMe(i,...t)]}function vMe(...e){const t=e[0];if(e.length===1)return t;const n=()=>{const s=e.map(i=>({useScope:i(),scopeName:i.scopeName}));return function(o){const a=s.reduce((l,{useScope:c,scopeName:d})=>{const f=c(o)[`__scope${d}`];return{...l,...f}},{});return u.useMemo(()=>({[`__scope${t.scopeName}`]:a}),[a])}};return n.scopeName=t.scopeName,n}const Bw=globalThis!=null&&globalThis.document?u.useLayoutEffect:()=>{},CMe=ES.useId||(()=>{});let wMe=0;function p2(e){const[t,n]=u.useState(CMe());return Bw(()=>{n(s=>s??String(wMe++))},[e]),e||(t?`radix-${t}`:"")}function ec(e){const t=u.useRef(e);return u.useEffect(()=>{t.current=e}),u.useMemo(()=>(...n)=>{var s;return(s=t.current)===null||s===void 0?void 0:s.call(t,...n)},[])}function SMe({prop:e,defaultProp:t,onChange:n=()=>{}}){const[s,i]=jMe({defaultProp:t,onChange:n}),o=e!==void 0,a=o?e:s,l=ec(n),c=u.useCallback(d=>{if(o){const f=typeof d=="function"?d(e):d;f!==e&&l(f)}else i(d)},[o,e,i,l]);return[a,c]}function jMe({defaultProp:e,onChange:t}){const n=u.useState(e),[s]=n,i=u.useRef(s),o=ec(t);return u.useEffect(()=>{i.current!==s&&(o(s),i.current=s)},[s,i,o]),n}const D4=u.forwardRef((e,t)=>{const{children:n,...s}=e,i=u.Children.toArray(n),o=i.find(_Me);if(o){const a=o.props.children,l=i.map(c=>c===o?u.Children.count(a)>1?u.Children.only(null):u.isValidElement(a)?a.props.children:null:c);return u.createElement($w,Ds({},s,{ref:t}),u.isValidElement(a)?u.cloneElement(a,void 0,l):null)}return u.createElement($w,Ds({},s,{ref:t}),n)});D4.displayName="Slot";const $w=u.forwardRef((e,t)=>{const{children:n,...s}=e;return u.isValidElement(n)?u.cloneElement(n,{...IMe(s,n.props),ref:t?TK(t,n.ref):n.ref}):u.Children.count(n)>1?u.Children.only(null):null});$w.displayName="SlotClone";const kMe=({children:e})=>u.createElement(u.Fragment,null,e);function _Me(e){return u.isValidElement(e)&&e.type===kMe}function IMe(e,t){const n={...t};for(const s in t){const i=e[s],o=t[s];/^on[A-Z]/.test(s)?i&&o?n[s]=(...l)=>{o(...l),i(...l)}:i&&(n[s]=i):s==="style"?n[s]={...i,...o}:s==="className"&&(n[s]=[i,o].filter(Boolean).join(" "))}return{...e,...n}}const TMe=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],ci=TMe.reduce((e,t)=>{const n=u.forwardRef((s,i)=>{const{asChild:o,...a}=s,l=o?D4:t;return u.useEffect(()=>{window[Symbol.for("radix-ui")]=!0},[]),u.createElement(l,Ds({},a,{ref:i}))});return n.displayName=`Primitive.${t}`,{...e,[t]:n}},{});function AMe(e,t){e&&mc.flushSync(()=>e.dispatchEvent(t))}function EMe(e,t=globalThis==null?void 0:globalThis.document){const n=ec(e);u.useEffect(()=>{const s=i=>{i.key==="Escape"&&n(i)};return t.addEventListener("keydown",s),()=>t.removeEventListener("keydown",s)},[n,t])}const Vw="dismissableLayer.update",MMe="dismissableLayer.pointerDownOutside",PMe="dismissableLayer.focusOutside";let Q8;const LMe=u.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),DMe=u.forwardRef((e,t)=>{var n;const{disableOutsidePointerEvents:s=!1,onEscapeKeyDown:i,onPointerDownOutside:o,onFocusOutside:a,onInteractOutside:l,onDismiss:c,...d}=e,h=u.useContext(LMe),[f,p]=u.useState(null),g=(n=f==null?void 0:f.ownerDocument)!==null&&n!==void 0?n:globalThis==null?void 0:globalThis.document,[,m]=u.useState({}),y=Yg(t,E=>p(E)),b=Array.from(h.layers),[C]=[...h.layersWithOutsidePointerEventsDisabled].slice(-1),x=b.indexOf(C),v=f?b.indexOf(f):-1,w=h.layersWithOutsidePointerEventsDisabled.size>0,S=v>=x,j=RMe(E=>{const D=E.target,M=[...h.branches].some(R=>R.contains(D));!S||M||(o==null||o(E),l==null||l(E),E.defaultPrevented||c==null||c())},g),P=OMe(E=>{const D=E.target;[...h.branches].some(R=>R.contains(D))||(a==null||a(E),l==null||l(E),E.defaultPrevented||c==null||c())},g);return EMe(E=>{v===h.layers.size-1&&(i==null||i(E),!E.defaultPrevented&&c&&(E.preventDefault(),c()))},g),u.useEffect(()=>{if(f)return s&&(h.layersWithOutsidePointerEventsDisabled.size===0&&(Q8=g.body.style.pointerEvents,g.body.style.pointerEvents="none"),h.layersWithOutsidePointerEventsDisabled.add(f)),h.layers.add(f),J8(),()=>{s&&h.layersWithOutsidePointerEventsDisabled.size===1&&(g.body.style.pointerEvents=Q8)}},[f,g,s,h]),u.useEffect(()=>()=>{f&&(h.layers.delete(f),h.layersWithOutsidePointerEventsDisabled.delete(f),J8())},[f,h]),u.useEffect(()=>{const E=()=>m({});return document.addEventListener(Vw,E),()=>document.removeEventListener(Vw,E)},[]),u.createElement(ci.div,Ds({},d,{ref:y,style:{pointerEvents:w?S?"auto":"none":void 0,...e.style},onFocusCapture:Pu(e.onFocusCapture,P.onFocusCapture),onBlurCapture:Pu(e.onBlurCapture,P.onBlurCapture),onPointerDownCapture:Pu(e.onPointerDownCapture,j.onPointerDownCapture)}))});function RMe(e,t=globalThis==null?void 0:globalThis.document){const n=ec(e),s=u.useRef(!1),i=u.useRef(()=>{});return u.useEffect(()=>{const o=l=>{if(l.target&&!s.current){let d=function(){AK(MMe,n,c,{discrete:!0})};const c={originalEvent:l};l.pointerType==="touch"?(t.removeEventListener("click",i.current),i.current=d,t.addEventListener("click",i.current,{once:!0})):d()}else t.removeEventListener("click",i.current);s.current=!1},a=window.setTimeout(()=>{t.addEventListener("pointerdown",o)},0);return()=>{window.clearTimeout(a),t.removeEventListener("pointerdown",o),t.removeEventListener("click",i.current)}},[t,n]),{onPointerDownCapture:()=>s.current=!0}}function OMe(e,t=globalThis==null?void 0:globalThis.document){const n=ec(e),s=u.useRef(!1);return u.useEffect(()=>{const i=o=>{o.target&&!s.current&&AK(PMe,n,{originalEvent:o},{discrete:!1})};return t.addEventListener("focusin",i),()=>t.removeEventListener("focusin",i)},[t,n]),{onFocusCapture:()=>s.current=!0,onBlurCapture:()=>s.current=!1}}function J8(){const e=new CustomEvent(Vw);document.dispatchEvent(e)}function AK(e,t,n,{discrete:s}){const i=n.originalEvent.target,o=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:n});t&&i.addEventListener(e,t,{once:!0}),s?AMe(i,o):i.dispatchEvent(o)}const g2="focusScope.autoFocusOnMount",m2="focusScope.autoFocusOnUnmount",e3={bubbles:!1,cancelable:!0},NMe=u.forwardRef((e,t)=>{const{loop:n=!1,trapped:s=!1,onMountAutoFocus:i,onUnmountAutoFocus:o,...a}=e,[l,c]=u.useState(null),d=ec(i),h=ec(o),f=u.useRef(null),p=Yg(t,y=>c(y)),g=u.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;u.useEffect(()=>{if(s){let y=function(v){if(g.paused||!l)return;const w=v.target;l.contains(w)?f.current=w:ya(f.current,{select:!0})},b=function(v){if(g.paused||!l)return;const w=v.relatedTarget;w!==null&&(l.contains(w)||ya(f.current,{select:!0}))},C=function(v){if(document.activeElement===document.body)for(const S of v)S.removedNodes.length>0&&ya(l)};document.addEventListener("focusin",y),document.addEventListener("focusout",b);const x=new MutationObserver(C);return l&&x.observe(l,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",y),document.removeEventListener("focusout",b),x.disconnect()}}},[s,l,g.paused]),u.useEffect(()=>{if(l){n3.add(g);const y=document.activeElement;if(!l.contains(y)){const C=new CustomEvent(g2,e3);l.addEventListener(g2,d),l.dispatchEvent(C),C.defaultPrevented||(FMe(GMe(EK(l)),{select:!0}),document.activeElement===y&&ya(l))}return()=>{l.removeEventListener(g2,d),setTimeout(()=>{const C=new CustomEvent(m2,e3);l.addEventListener(m2,h),l.dispatchEvent(C),C.defaultPrevented||ya(y??document.body,{select:!0}),l.removeEventListener(m2,h),n3.remove(g)},0)}}},[l,d,h,g]);const m=u.useCallback(y=>{if(!n&&!s||g.paused)return;const b=y.key==="Tab"&&!y.altKey&&!y.ctrlKey&&!y.metaKey,C=document.activeElement;if(b&&C){const x=y.currentTarget,[v,w]=BMe(x);v&&w?!y.shiftKey&&C===w?(y.preventDefault(),n&&ya(v,{select:!0})):y.shiftKey&&C===v&&(y.preventDefault(),n&&ya(w,{select:!0})):C===x&&y.preventDefault()}},[n,s,g.paused]);return u.createElement(ci.div,Ds({tabIndex:-1},a,{ref:p,onKeyDown:m}))});function FMe(e,{select:t=!1}={}){const n=document.activeElement;for(const s of e)if(ya(s,{select:t}),document.activeElement!==n)return}function BMe(e){const t=EK(e),n=t3(t,e),s=t3(t.reverse(),e);return[n,s]}function EK(e){const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:s=>{const i=s.tagName==="INPUT"&&s.type==="hidden";return s.disabled||s.hidden||i?NodeFilter.FILTER_SKIP:s.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function t3(e,t){for(const n of e)if(!$Me(n,{upTo:t}))return n}function $Me(e,{upTo:t}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(t!==void 0&&e===t)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function VMe(e){return e instanceof HTMLInputElement&&"select"in e}function ya(e,{select:t=!1}={}){if(e&&e.focus){const n=document.activeElement;e.focus({preventScroll:!0}),e!==n&&VMe(e)&&t&&e.select()}}const n3=zMe();function zMe(){let e=[];return{add(t){const n=e[0];t!==n&&(n==null||n.pause()),e=s3(e,t),e.unshift(t)},remove(t){var n;e=s3(e,t),(n=e[0])===null||n===void 0||n.resume()}}}function s3(e,t){const n=[...e],s=n.indexOf(t);return s!==-1&&n.splice(s,1),n}function GMe(e){return e.filter(t=>t.tagName!=="A")}const HMe=u.forwardRef((e,t)=>{var n;const{container:s=globalThis==null||(n=globalThis.document)===null||n===void 0?void 0:n.body,...i}=e;return s?$L.createPortal(u.createElement(ci.div,Ds({},i,{ref:t})),s):null});function WMe(e,t){return u.useReducer((n,s)=>{const i=t[n][s];return i??n},e)}const px=e=>{const{present:t,children:n}=e,s=UMe(t),i=typeof n=="function"?n({present:s.isPresent}):u.Children.only(n),o=Yg(s.ref,i.ref);return typeof n=="function"||s.isPresent?u.cloneElement(i,{ref:o}):null};px.displayName="Presence";function UMe(e){const[t,n]=u.useState(),s=u.useRef({}),i=u.useRef(e),o=u.useRef("none"),a=e?"mounted":"unmounted",[l,c]=WMe(a,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return u.useEffect(()=>{const d=Ym(s.current);o.current=l==="mounted"?d:"none"},[l]),Bw(()=>{const d=s.current,h=i.current;if(h!==e){const p=o.current,g=Ym(d);e?c("MOUNT"):g==="none"||(d==null?void 0:d.display)==="none"?c("UNMOUNT"):c(h&&p!==g?"ANIMATION_OUT":"UNMOUNT"),i.current=e}},[e,c]),Bw(()=>{if(t){const d=f=>{const g=Ym(s.current).includes(f.animationName);f.target===t&&g&&mc.flushSync(()=>c("ANIMATION_END"))},h=f=>{f.target===t&&(o.current=Ym(s.current))};return t.addEventListener("animationstart",h),t.addEventListener("animationcancel",d),t.addEventListener("animationend",d),()=>{t.removeEventListener("animationstart",h),t.removeEventListener("animationcancel",d),t.removeEventListener("animationend",d)}}else c("ANIMATION_END")},[t,c]),{isPresent:["mounted","unmountSuspended"].includes(l),ref:u.useCallback(d=>{d&&(s.current=getComputedStyle(d)),n(d)},[])}}function Ym(e){return(e==null?void 0:e.animationName)||"none"}let y2=0;function qMe(){u.useEffect(()=>{var e,t;const n=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",(e=n[0])!==null&&e!==void 0?e:r3()),document.body.insertAdjacentElement("beforeend",(t=n[1])!==null&&t!==void 0?t:r3()),y2++,()=>{y2===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(s=>s.remove()),y2--}},[])}function r3(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.cssText="outline: none; opacity: 0; position: fixed; pointer-events: none",e}var A0="right-scroll-bar-position",E0="width-before-scroll-bar",KMe="with-scroll-bars-hidden",ZMe="--removed-body-scroll-bar-size";function b2(e,t){return typeof e=="function"?e(t):e&&(e.current=t),e}function YMe(e,t){var n=u.useState(function(){return{value:e,callback:t,facade:{get current(){return n.value},set current(s){var i=n.value;i!==s&&(n.value=s,n.callback(s,i))}}}})[0];return n.callback=t,n.facade}var XMe=typeof window<"u"?u.useLayoutEffect:u.useEffect,i3=new WeakMap;function QMe(e,t){var n=YMe(null,function(s){return e.forEach(function(i){return b2(i,s)})});return XMe(function(){var s=i3.get(n);if(s){var i=new Set(s),o=new Set(e),a=n.current;i.forEach(function(l){o.has(l)||b2(l,null)}),o.forEach(function(l){i.has(l)||b2(l,a)})}i3.set(n,e)},[e]),n}function JMe(e){return e}function ePe(e,t){t===void 0&&(t=JMe);var n=[],s=!1,i={read:function(){if(s)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:e},useMedium:function(o){var a=t(o,s);return n.push(a),function(){n=n.filter(function(l){return l!==a})}},assignSyncMedium:function(o){for(s=!0;n.length;){var a=n;n=[],a.forEach(o)}n={push:function(l){return o(l)},filter:function(){return n}}},assignMedium:function(o){s=!0;var a=[];if(n.length){var l=n;n=[],l.forEach(o),a=n}var c=function(){var h=a;a=[],h.forEach(o)},d=function(){return Promise.resolve().then(c)};d(),n={push:function(h){a.push(h),d()},filter:function(h){return a=a.filter(h),n}}}};return i}function tPe(e){e===void 0&&(e={});var t=ePe(null);return t.options=Yi({async:!0,ssr:!1},e),t}var MK=function(e){var t=e.sideCar,n=pO(e,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var s=t.read();if(!s)throw new Error("Sidecar medium not found");return u.createElement(s,Yi({},n))};MK.isSideCarExport=!0;function nPe(e,t){return e.useMedium(t),MK}var PK=tPe(),x2=function(){},gx=u.forwardRef(function(e,t){var n=u.useRef(null),s=u.useState({onScrollCapture:x2,onWheelCapture:x2,onTouchMoveCapture:x2}),i=s[0],o=s[1],a=e.forwardProps,l=e.children,c=e.className,d=e.removeScrollBar,h=e.enabled,f=e.shards,p=e.sideCar,g=e.noIsolation,m=e.inert,y=e.allowPinchZoom,b=e.as,C=b===void 0?"div":b,x=pO(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as"]),v=p,w=QMe([n,t]),S=Yi(Yi({},x),i);return u.createElement(u.Fragment,null,h&&u.createElement(v,{sideCar:PK,removeScrollBar:d,shards:f,noIsolation:g,inert:m,setCallbacks:o,allowPinchZoom:!!y,lockRef:n}),a?u.cloneElement(u.Children.only(l),Yi(Yi({},S),{ref:w})):u.createElement(C,Yi({},S,{className:c,ref:w}),l))});gx.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};gx.classNames={fullWidth:E0,zeroRight:A0};var sPe=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function rPe(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=sPe();return t&&e.setAttribute("nonce",t),e}function iPe(e,t){e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t))}function oPe(e){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(e)}var aPe=function(){var e=0,t=null;return{add:function(n){e==0&&(t=rPe())&&(iPe(t,n),oPe(t)),e++},remove:function(){e--,!e&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},lPe=function(){var e=aPe();return function(t,n){u.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&n])}},LK=function(){var e=lPe(),t=function(n){var s=n.styles,i=n.dynamic;return e(s,i),null};return t},cPe={left:0,top:0,right:0,gap:0},v2=function(e){return parseInt(e||"",10)||0},uPe=function(e){var t=window.getComputedStyle(document.body),n=t[e==="padding"?"paddingLeft":"marginLeft"],s=t[e==="padding"?"paddingTop":"marginTop"],i=t[e==="padding"?"paddingRight":"marginRight"];return[v2(n),v2(s),v2(i)]},dPe=function(e){if(e===void 0&&(e="margin"),typeof window>"u")return cPe;var t=uPe(e),n=document.documentElement.clientWidth,s=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,s-n+t[2]-t[0])}},hPe=LK(),Lu="data-scroll-locked",fPe=function(e,t,n,s){var i=e.left,o=e.top,a=e.right,l=e.gap;return n===void 0&&(n="margin"),`
  .`.concat(KMe,` {
   overflow: hidden `).concat(s,`;
   padding-right: `).concat(l,"px ").concat(s,`;
  }
  body[`).concat(Lu,`] {
    overflow: hidden `).concat(s,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(s,";"),n==="margin"&&`
    padding-left: `.concat(i,`px;
    padding-top: `).concat(o,`px;
    padding-right: `).concat(a,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(l,"px ").concat(s,`;
    `),n==="padding"&&"padding-right: ".concat(l,"px ").concat(s,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(A0,` {
    right: `).concat(l,"px ").concat(s,`;
  }
  
  .`).concat(E0,` {
    margin-right: `).concat(l,"px ").concat(s,`;
  }
  
  .`).concat(A0," .").concat(A0,` {
    right: 0 `).concat(s,`;
  }
  
  .`).concat(E0," .").concat(E0,` {
    margin-right: 0 `).concat(s,`;
  }
  
  body[`).concat(Lu,`] {
    `).concat(ZMe,": ").concat(l,`px;
  }
`)},o3=function(){var e=parseInt(document.body.getAttribute(Lu)||"0",10);return isFinite(e)?e:0},pPe=function(){u.useEffect(function(){return document.body.setAttribute(Lu,(o3()+1).toString()),function(){var e=o3()-1;e<=0?document.body.removeAttribute(Lu):document.body.setAttribute(Lu,e.toString())}},[])},gPe=function(e){var t=e.noRelative,n=e.noImportant,s=e.gapMode,i=s===void 0?"margin":s;pPe();var o=u.useMemo(function(){return dPe(i)},[i]);return u.createElement(hPe,{styles:fPe(o,!t,i,n?"":"!important")})},zw=!1;if(typeof window<"u")try{var Xm=Object.defineProperty({},"passive",{get:function(){return zw=!0,!0}});window.addEventListener("test",Xm,Xm),window.removeEventListener("test",Xm,Xm)}catch{zw=!1}var Wc=zw?{passive:!1}:!1,mPe=function(e){return e.tagName==="TEXTAREA"},DK=function(e,t){var n=window.getComputedStyle(e);return n[t]!=="hidden"&&!(n.overflowY===n.overflowX&&!mPe(e)&&n[t]==="visible")},yPe=function(e){return DK(e,"overflowY")},bPe=function(e){return DK(e,"overflowX")},a3=function(e,t){var n=t;do{typeof ShadowRoot<"u"&&n instanceof ShadowRoot&&(n=n.host);var s=RK(e,n);if(s){var i=OK(e,n),o=i[1],a=i[2];if(o>a)return!0}n=n.parentNode}while(n&&n!==document.body);return!1},xPe=function(e){var t=e.scrollTop,n=e.scrollHeight,s=e.clientHeight;return[t,n,s]},vPe=function(e){var t=e.scrollLeft,n=e.scrollWidth,s=e.clientWidth;return[t,n,s]},RK=function(e,t){return e==="v"?yPe(t):bPe(t)},OK=function(e,t){return e==="v"?xPe(t):vPe(t)},CPe=function(e,t){return e==="h"&&t==="rtl"?-1:1},wPe=function(e,t,n,s,i){var o=CPe(e,window.getComputedStyle(t).direction),a=o*s,l=n.target,c=t.contains(l),d=!1,h=a>0,f=0,p=0;do{var g=OK(e,l),m=g[0],y=g[1],b=g[2],C=y-b-o*m;(m||C)&&RK(e,l)&&(f+=C,p+=m),l=l.parentNode}while(!c&&l!==document.body||c&&(t.contains(l)||t===l));return(h&&f===0||!h&&p===0)&&(d=!0),d},Qm=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},l3=function(e){return[e.deltaX,e.deltaY]},c3=function(e){return e&&"current"in e?e.current:e},SPe=function(e,t){return e[0]===t[0]&&e[1]===t[1]},jPe=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},kPe=0,Uc=[];function _Pe(e){var t=u.useRef([]),n=u.useRef([0,0]),s=u.useRef(),i=u.useState(kPe++)[0],o=u.useState(function(){return LK()})[0],a=u.useRef(e);u.useEffect(function(){a.current=e},[e]),u.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(i));var y=EC([e.lockRef.current],(e.shards||[]).map(c3),!0).filter(Boolean);return y.forEach(function(b){return b.classList.add("allow-interactivity-".concat(i))}),function(){document.body.classList.remove("block-interactivity-".concat(i)),y.forEach(function(b){return b.classList.remove("allow-interactivity-".concat(i))})}}},[e.inert,e.lockRef.current,e.shards]);var l=u.useCallback(function(y,b){if("touches"in y&&y.touches.length===2)return!a.current.allowPinchZoom;var C=Qm(y),x=n.current,v="deltaX"in y?y.deltaX:x[0]-C[0],w="deltaY"in y?y.deltaY:x[1]-C[1],S,j=y.target,P=Math.abs(v)>Math.abs(w)?"h":"v";if("touches"in y&&P==="h"&&j.type==="range")return!1;var E=a3(P,j);if(!E)return!0;if(E?S=P:(S=P==="v"?"h":"v",E=a3(P,j)),!E)return!1;if(!s.current&&"changedTouches"in y&&(v||w)&&(s.current=S),!S)return!0;var D=s.current||S;return wPe(D,b,y,D==="h"?v:w)},[]),c=u.useCallback(function(y){var b=y;if(!(!Uc.length||Uc[Uc.length-1]!==o)){var C="deltaY"in b?l3(b):Qm(b),x=t.current.filter(function(S){return S.name===b.type&&S.target===b.target&&SPe(S.delta,C)})[0];if(x&&x.should){b.cancelable&&b.preventDefault();return}if(!x){var v=(a.current.shards||[]).map(c3).filter(Boolean).filter(function(S){return S.contains(b.target)}),w=v.length>0?l(b,v[0]):!a.current.noIsolation;w&&b.cancelable&&b.preventDefault()}}},[]),d=u.useCallback(function(y,b,C,x){var v={name:y,delta:b,target:C,should:x};t.current.push(v),setTimeout(function(){t.current=t.current.filter(function(w){return w!==v})},1)},[]),h=u.useCallback(function(y){n.current=Qm(y),s.current=void 0},[]),f=u.useCallback(function(y){d(y.type,l3(y),y.target,l(y,e.lockRef.current))},[]),p=u.useCallback(function(y){d(y.type,Qm(y),y.target,l(y,e.lockRef.current))},[]);u.useEffect(function(){return Uc.push(o),e.setCallbacks({onScrollCapture:f,onWheelCapture:f,onTouchMoveCapture:p}),document.addEventListener("wheel",c,Wc),document.addEventListener("touchmove",c,Wc),document.addEventListener("touchstart",h,Wc),function(){Uc=Uc.filter(function(y){return y!==o}),document.removeEventListener("wheel",c,Wc),document.removeEventListener("touchmove",c,Wc),document.removeEventListener("touchstart",h,Wc)}},[]);var g=e.removeScrollBar,m=e.inert;return u.createElement(u.Fragment,null,m?u.createElement(o,{styles:jPe(i)}):null,g?u.createElement(gPe,{gapMode:"margin"}):null)}const IPe=nPe(PK,_Pe);var NK=u.forwardRef(function(e,t){return u.createElement(gx,Yi({},e,{ref:t,sideCar:IPe}))});NK.classNames=gx.classNames;var TPe=function(e){if(typeof document>"u")return null;var t=Array.isArray(e)?e[0]:e;return t.ownerDocument.body},qc=new WeakMap,Jm=new WeakMap,e0={},C2=0,FK=function(e){return e&&(e.host||FK(e.parentNode))},APe=function(e,t){return t.map(function(n){if(e.contains(n))return n;var s=FK(n);return s&&e.contains(s)?s:(console.error("aria-hidden",n,"in not contained inside",e,". Doing nothing"),null)}).filter(function(n){return!!n})},EPe=function(e,t,n,s){var i=APe(t,Array.isArray(e)?e:[e]);e0[n]||(e0[n]=new WeakMap);var o=e0[n],a=[],l=new Set,c=new Set(i),d=function(f){!f||l.has(f)||(l.add(f),d(f.parentNode))};i.forEach(d);var h=function(f){!f||c.has(f)||Array.prototype.forEach.call(f.children,function(p){if(l.has(p))h(p);else try{var g=p.getAttribute(s),m=g!==null&&g!=="false",y=(qc.get(p)||0)+1,b=(o.get(p)||0)+1;qc.set(p,y),o.set(p,b),a.push(p),y===1&&m&&Jm.set(p,!0),b===1&&p.setAttribute(n,"true"),m||p.setAttribute(s,"true")}catch(C){console.error("aria-hidden: cannot operate on ",p,C)}})};return h(t),l.clear(),C2++,function(){a.forEach(function(f){var p=qc.get(f)-1,g=o.get(f)-1;qc.set(f,p),o.set(f,g),p||(Jm.has(f)||f.removeAttribute(s),Jm.delete(f)),g||f.removeAttribute(n)}),C2--,C2||(qc=new WeakMap,qc=new WeakMap,Jm=new WeakMap,e0={})}},MPe=function(e,t,n){n===void 0&&(n="data-aria-hidden");var s=Array.from(Array.isArray(e)?e:[e]),i=TPe(e);return i?(s.push.apply(s,Array.from(i.querySelectorAll("[aria-live]"))),EPe(s,i,n,"aria-hidden")):function(){return null}};const BK="Dialog",[$K,S9e]=xMe(BK),[PPe,Mc]=$K(BK),LPe=e=>{const{__scopeDialog:t,children:n,open:s,defaultOpen:i,onOpenChange:o,modal:a=!0}=e,l=u.useRef(null),c=u.useRef(null),[d=!1,h]=SMe({prop:s,defaultProp:i,onChange:o});return u.createElement(PPe,{scope:t,triggerRef:l,contentRef:c,contentId:p2(),titleId:p2(),descriptionId:p2(),open:d,onOpenChange:h,onOpenToggle:u.useCallback(()=>h(f=>!f),[h]),modal:a},n)},VK="DialogPortal",[DPe,zK]=$K(VK,{forceMount:void 0}),RPe=e=>{const{__scopeDialog:t,forceMount:n,children:s,container:i}=e,o=Mc(VK,t);return u.createElement(DPe,{scope:t,forceMount:n},u.Children.map(s,a=>u.createElement(px,{present:n||o.open},u.createElement(HMe,{asChild:!0,container:i},a))))},Gw="DialogOverlay",OPe=u.forwardRef((e,t)=>{const n=zK(Gw,e.__scopeDialog),{forceMount:s=n.forceMount,...i}=e,o=Mc(Gw,e.__scopeDialog);return o.modal?u.createElement(px,{present:s||o.open},u.createElement(NPe,Ds({},i,{ref:t}))):null}),NPe=u.forwardRef((e,t)=>{const{__scopeDialog:n,...s}=e,i=Mc(Gw,n);return u.createElement(NK,{as:D4,allowPinchZoom:!0,shards:[i.contentRef]},u.createElement(ci.div,Ds({"data-state":HK(i.open)},s,{ref:t,style:{pointerEvents:"auto",...s.style}})))}),Xu="DialogContent",FPe=u.forwardRef((e,t)=>{const n=zK(Xu,e.__scopeDialog),{forceMount:s=n.forceMount,...i}=e,o=Mc(Xu,e.__scopeDialog);return u.createElement(px,{present:s||o.open},o.modal?u.createElement(BPe,Ds({},i,{ref:t})):u.createElement($Pe,Ds({},i,{ref:t})))}),BPe=u.forwardRef((e,t)=>{const n=Mc(Xu,e.__scopeDialog),s=u.useRef(null),i=Yg(t,n.contentRef,s);return u.useEffect(()=>{const o=s.current;if(o)return MPe(o)},[]),u.createElement(GK,Ds({},e,{ref:i,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Pu(e.onCloseAutoFocus,o=>{var a;o.preventDefault(),(a=n.triggerRef.current)===null||a===void 0||a.focus()}),onPointerDownOutside:Pu(e.onPointerDownOutside,o=>{const a=o.detail.originalEvent,l=a.button===0&&a.ctrlKey===!0;(a.button===2||l)&&o.preventDefault()}),onFocusOutside:Pu(e.onFocusOutside,o=>o.preventDefault())}))}),$Pe=u.forwardRef((e,t)=>{const n=Mc(Xu,e.__scopeDialog),s=u.useRef(!1),i=u.useRef(!1);return u.createElement(GK,Ds({},e,{ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:o=>{var a;if((a=e.onCloseAutoFocus)===null||a===void 0||a.call(e,o),!o.defaultPrevented){var l;s.current||(l=n.triggerRef.current)===null||l===void 0||l.focus(),o.preventDefault()}s.current=!1,i.current=!1},onInteractOutside:o=>{var a,l;(a=e.onInteractOutside)===null||a===void 0||a.call(e,o),o.defaultPrevented||(s.current=!0,o.detail.originalEvent.type==="pointerdown"&&(i.current=!0));const c=o.target;((l=n.triggerRef.current)===null||l===void 0?void 0:l.contains(c))&&o.preventDefault(),o.detail.originalEvent.type==="focusin"&&i.current&&o.preventDefault()}}))}),GK=u.forwardRef((e,t)=>{const{__scopeDialog:n,trapFocus:s,onOpenAutoFocus:i,onCloseAutoFocus:o,...a}=e,l=Mc(Xu,n),c=u.useRef(null),d=Yg(t,c);return qMe(),u.createElement(u.Fragment,null,u.createElement(NMe,{asChild:!0,loop:!0,trapped:s,onMountAutoFocus:i,onUnmountAutoFocus:o},u.createElement(DMe,Ds({role:"dialog",id:l.contentId,"aria-describedby":l.descriptionId,"aria-labelledby":l.titleId,"data-state":HK(l.open)},a,{ref:d,onDismiss:()=>l.onOpenChange(!1)}))),!1)}),VPe="DialogTitle";function HK(e){return e?"open":"closed"}const zPe="DialogTitleWarning";bMe(zPe,{contentName:Xu,titleName:VPe,docsSlug:"dialog"});const GPe=LPe,HPe=RPe,WPe=OPe,UPe=FPe;var sf='[cmdk-group=""]',w2='[cmdk-group-items=""]',qPe='[cmdk-group-heading=""]',R4='[cmdk-item=""]',u3=`${R4}:not([aria-disabled="true"])`,Hw="cmdk-item-select",_l="data-value",KPe=(e,t,n)=>mMe(e,t,n),WK=u.createContext(void 0),Xg=()=>u.useContext(WK),UK=u.createContext(void 0),O4=()=>u.useContext(UK),qK=u.createContext(void 0),N4=u.forwardRef((e,t)=>{let n=nu(()=>{var H,V;return{search:"",value:(V=(H=e.value)!=null?H:e.defaultValue)!=null?V:"",filtered:{count:0,items:new Map,groups:new Set}}}),s=nu(()=>new Set),i=nu(()=>new Map),o=nu(()=>new Map),a=nu(()=>new Set),l=XK(e),{label:c,children:d,value:h,onValueChange:f,filter:p,shouldFilter:g,loop:m,disablePointerSelection:y=!1,vimBindings:b=!0,...C}=e,x=u.useId(),v=u.useId(),w=u.useId(),S=u.useRef(null),j=nLe();tc(()=>{if(h!==void 0){let H=h.trim();n.current.value=H,P.emit()}},[h]),tc(()=>{j(6,_)},[]);let P=u.useMemo(()=>({subscribe:H=>(a.current.add(H),()=>a.current.delete(H)),snapshot:()=>n.current,setState:(H,V,X)=>{var W,Y,$;if(!Object.is(n.current[H],V)){if(n.current[H]=V,H==="search")F(),M(),j(1,R);else if(H==="value"&&(X||j(5,_),((W=l.current)==null?void 0:W.value)!==void 0)){let N=V??"";($=(Y=l.current).onValueChange)==null||$.call(Y,N);return}P.emit()}},emit:()=>{a.current.forEach(H=>H())}}),[]),E=u.useMemo(()=>({value:(H,V,X)=>{var W;V!==((W=o.current.get(H))==null?void 0:W.value)&&(o.current.set(H,{value:V,keywords:X}),n.current.filtered.items.set(H,D(V,X)),j(2,()=>{M(),P.emit()}))},item:(H,V)=>(s.current.add(H),V&&(i.current.has(V)?i.current.get(V).add(H):i.current.set(V,new Set([H]))),j(3,()=>{F(),M(),n.current.value||R(),P.emit()}),()=>{o.current.delete(H),s.current.delete(H),n.current.filtered.items.delete(H);let X=L();j(4,()=>{F(),(X==null?void 0:X.getAttribute("id"))===H&&R(),P.emit()})}),group:H=>(i.current.has(H)||i.current.set(H,new Set),()=>{o.current.delete(H),i.current.delete(H)}),filter:()=>l.current.shouldFilter,label:c||e["aria-label"],disablePointerSelection:y,listId:x,inputId:w,labelId:v,listInnerRef:S}),[]);function D(H,V){var X,W;let Y=(W=(X=l.current)==null?void 0:X.filter)!=null?W:KPe;return H?Y(H,n.current.search,V):0}function M(){if(!n.current.search||l.current.shouldFilter===!1)return;let H=n.current.filtered.items,V=[];n.current.filtered.groups.forEach(W=>{let Y=i.current.get(W),$=0;Y.forEach(N=>{let U=H.get(N);$=Math.max(U,$)}),V.push([W,$])});let X=S.current;O().sort((W,Y)=>{var $,N;let U=W.getAttribute("id"),ie=Y.getAttribute("id");return(($=H.get(ie))!=null?$:0)-((N=H.get(U))!=null?N:0)}).forEach(W=>{let Y=W.closest(w2);Y?Y.appendChild(W.parentElement===Y?W:W.closest(`${w2} > *`)):X.appendChild(W.parentElement===X?W:W.closest(`${w2} > *`))}),V.sort((W,Y)=>Y[1]-W[1]).forEach(W=>{let Y=S.current.querySelector(`${sf}[${_l}="${encodeURIComponent(W[0])}"]`);Y==null||Y.parentElement.appendChild(Y)})}function R(){let H=O().find(X=>X.getAttribute("aria-disabled")!=="true"),V=H==null?void 0:H.getAttribute(_l);P.setState("value",V||void 0)}function F(){var H,V,X,W;if(!n.current.search||l.current.shouldFilter===!1){n.current.filtered.count=s.current.size;return}n.current.filtered.groups=new Set;let Y=0;for(let $ of s.current){let N=(V=(H=o.current.get($))==null?void 0:H.value)!=null?V:"",U=(W=(X=o.current.get($))==null?void 0:X.keywords)!=null?W:[],ie=D(N,U);n.current.filtered.items.set($,ie),ie>0&&Y++}for(let[$,N]of i.current)for(let U of N)if(n.current.filtered.items.get(U)>0){n.current.filtered.groups.add($);break}n.current.filtered.count=Y}function _(){var H,V,X;let W=L();W&&(((H=W.parentElement)==null?void 0:H.firstChild)===W&&((X=(V=W.closest(sf))==null?void 0:V.querySelector(qPe))==null||X.scrollIntoView({block:"nearest"})),W.scrollIntoView({block:"nearest"}))}function L(){var H;return(H=S.current)==null?void 0:H.querySelector(`${R4}[aria-selected="true"]`)}function O(){var H;return Array.from((H=S.current)==null?void 0:H.querySelectorAll(u3))}function B(H){let V=O()[H];V&&P.setState("value",V.getAttribute(_l))}function z(H){var V;let X=L(),W=O(),Y=W.findIndex(N=>N===X),$=W[Y+H];(V=l.current)!=null&&V.loop&&($=Y+H<0?W[W.length-1]:Y+H===W.length?W[0]:W[Y+H]),$&&P.setState("value",$.getAttribute(_l))}function ee(H){let V=L(),X=V==null?void 0:V.closest(sf),W;for(;X&&!W;)X=H>0?eLe(X,sf):tLe(X,sf),W=X==null?void 0:X.querySelector(u3);W?P.setState("value",W.getAttribute(_l)):z(H)}let ne=()=>B(O().length-1),re=H=>{H.preventDefault(),H.metaKey?ne():H.altKey?ee(1):z(1)},te=H=>{H.preventDefault(),H.metaKey?B(0):H.altKey?ee(-1):z(-1)};return u.createElement(ci.div,{ref:t,tabIndex:-1,...C,"cmdk-root":"",onKeyDown:H=>{var V;if((V=C.onKeyDown)==null||V.call(C,H),!H.defaultPrevented)switch(H.key){case"n":case"j":{b&&H.ctrlKey&&re(H);break}case"ArrowDown":{re(H);break}case"p":case"k":{b&&H.ctrlKey&&te(H);break}case"ArrowUp":{te(H);break}case"Home":{H.preventDefault(),B(0);break}case"End":{H.preventDefault(),ne();break}case"Enter":if(!H.nativeEvent.isComposing&&H.keyCode!==229){H.preventDefault();let X=L();if(X){let W=new Event(Hw);X.dispatchEvent(W)}}}}},u.createElement("label",{"cmdk-label":"",htmlFor:E.inputId,id:E.labelId,style:rLe},c),mx(e,H=>u.createElement(UK.Provider,{value:P},u.createElement(WK.Provider,{value:E},H))))}),KK=u.forwardRef((e,t)=>{var n,s;let i=u.useId(),o=u.useRef(null),a=u.useContext(qK),l=Xg(),c=XK(e),d=(s=(n=c.current)==null?void 0:n.forceMount)!=null?s:a==null?void 0:a.forceMount;tc(()=>{if(!d)return l.item(i,a==null?void 0:a.id)},[d]);let h=QK(i,o,[e.value,e.children,o],e.keywords),f=O4(),p=nc(j=>j.value&&j.value===h.current),g=nc(j=>d||l.filter()===!1?!0:j.search?j.filtered.items.get(i)>0:!0);u.useEffect(()=>{let j=o.current;if(!(!j||e.disabled))return j.addEventListener(Hw,m),()=>j.removeEventListener(Hw,m)},[g,e.onSelect,e.disabled]);function m(){var j,P;y(),(P=(j=c.current).onSelect)==null||P.call(j,h.current)}function y(){f.setState("value",h.current,!0)}if(!g)return null;let{disabled:b,value:C,onSelect:x,forceMount:v,keywords:w,...S}=e;return u.createElement(ci.div,{ref:Cp([o,t]),...S,id:i,"cmdk-item":"",role:"option","aria-disabled":!!b,"aria-selected":!!p,"data-disabled":!!b,"data-selected":!!p,onPointerMove:b||l.disablePointerSelection?void 0:y,onClick:b?void 0:m},e.children)}),ZPe=u.forwardRef((e,t)=>{let{heading:n,children:s,forceMount:i,...o}=e,a=u.useId(),l=u.useRef(null),c=u.useRef(null),d=u.useId(),h=Xg(),f=nc(g=>i||h.filter()===!1?!0:g.search?g.filtered.groups.has(a):!0);tc(()=>h.group(a),[]),QK(a,l,[e.value,e.heading,c]);let p=u.useMemo(()=>({id:a,forceMount:i}),[i]);return u.createElement(ci.div,{ref:Cp([l,t]),...o,"cmdk-group":"",role:"presentation",hidden:f?void 0:!0},n&&u.createElement("div",{ref:c,"cmdk-group-heading":"","aria-hidden":!0,id:d},n),mx(e,g=>u.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":n?d:void 0},u.createElement(qK.Provider,{value:p},g))))}),YPe=u.forwardRef((e,t)=>{let{alwaysRender:n,...s}=e,i=u.useRef(null),o=nc(a=>!a.search);return!n&&!o?null:u.createElement(ci.div,{ref:Cp([i,t]),...s,"cmdk-separator":"",role:"separator"})}),XPe=u.forwardRef((e,t)=>{let{onValueChange:n,...s}=e,i=e.value!=null,o=O4(),a=nc(h=>h.search),l=nc(h=>h.value),c=Xg(),d=u.useMemo(()=>{var h;let f=(h=c.listInnerRef.current)==null?void 0:h.querySelector(`${R4}[${_l}="${encodeURIComponent(l)}"]`);return f==null?void 0:f.getAttribute("id")},[]);return u.useEffect(()=>{e.value!=null&&o.setState("search",e.value)},[e.value]),u.createElement(ci.input,{ref:t,...s,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":c.listId,"aria-labelledby":c.labelId,"aria-activedescendant":d,id:c.inputId,type:"text",value:i?e.value:a,onChange:h=>{i||o.setState("search",h.target.value),n==null||n(h.target.value)}})}),ZK=u.forwardRef((e,t)=>{let{children:n,label:s="Suggestions",...i}=e,o=u.useRef(null),a=u.useRef(null),l=Xg();return u.useEffect(()=>{if(a.current&&o.current){let c=a.current,d=o.current,h,f=new ResizeObserver(()=>{h=requestAnimationFrame(()=>{let p=c.offsetHeight;d.style.setProperty("--cmdk-list-height",p.toFixed(1)+"px")})});return f.observe(c),()=>{cancelAnimationFrame(h),f.unobserve(c)}}},[]),u.createElement(ci.div,{ref:Cp([o,t]),...i,"cmdk-list":"",role:"listbox","aria-label":s,id:l.listId},mx(e,c=>u.createElement("div",{ref:Cp([a,l.listInnerRef]),"cmdk-list-sizer":""},c)))}),QPe=u.forwardRef((e,t)=>{let{open:n,onOpenChange:s,overlayClassName:i,contentClassName:o,container:a,...l}=e;return u.createElement(GPe,{open:n,onOpenChange:s},u.createElement(HPe,{container:a},u.createElement(WPe,{"cmdk-overlay":"",className:i}),u.createElement(UPe,{"aria-label":e.label,"cmdk-dialog":"",className:o},u.createElement(N4,{ref:t,...l}))))}),YK=u.forwardRef((e,t)=>nc(n=>n.filtered.count===0)?u.createElement(ci.div,{ref:t,...e,"cmdk-empty":"",role:"presentation"}):null),JPe=u.forwardRef((e,t)=>{let{progress:n,children:s,label:i="Loading...",...o}=e;return u.createElement(ci.div,{ref:t,...o,"cmdk-loading":"",role:"progressbar","aria-valuenow":n,"aria-valuemin":0,"aria-valuemax":100,"aria-label":i},mx(e,a=>u.createElement("div",{"aria-hidden":!0},a)))});Object.assign(N4,{List:ZK,Item:KK,Input:XPe,Group:ZPe,Separator:YPe,Dialog:QPe,Empty:YK,Loading:JPe});function eLe(e,t){let n=e.nextElementSibling;for(;n;){if(n.matches(t))return n;n=n.nextElementSibling}}function tLe(e,t){let n=e.previousElementSibling;for(;n;){if(n.matches(t))return n;n=n.previousElementSibling}}function XK(e){let t=u.useRef(e);return tc(()=>{t.current=e}),t}var tc=typeof window>"u"?u.useEffect:u.useLayoutEffect;function nu(e){let t=u.useRef();return t.current===void 0&&(t.current=e()),t}function Cp(e){return t=>{e.forEach(n=>{typeof n=="function"?n(t):n!=null&&(n.current=t)})}}function nc(e){let t=O4(),n=()=>e(t.snapshot());return u.useSyncExternalStore(t.subscribe,n,n)}function QK(e,t,n,s=[]){let i=u.useRef(),o=Xg();return tc(()=>{var a;let l=(()=>{var d;for(let h of n){if(typeof h=="string")return h.trim();if(typeof h=="object"&&"current"in h)return h.current?(d=h.current.textContent)==null?void 0:d.trim():i.current}})(),c=s.map(d=>d.trim());o.value(e,l,c),(a=t.current)==null||a.setAttribute(_l,l),i.current=l}),i}var nLe=()=>{let[e,t]=u.useState(),n=nu(()=>new Map);return tc(()=>{n.current.forEach(s=>s()),n.current=new Map},[e]),(s,i)=>{n.current.set(s,i),t({})}};function sLe(e){let t=e.type;return typeof t=="function"?t(e.props):"render"in t?t.render(e.props):e}function mx({asChild:e,children:t},n){return e&&u.isValidElement(t)?u.cloneElement(sLe(t),{ref:t.ref},n(t.props.children)):n(t)}var rLe={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};const iLe=e=>{const t=Gf();return{...VL,id:t,type:"current_image",position:e,data:{id:t,type:"current_image",isOpen:!0,label:"Current Image"}}},oLe=e=>{const t=Gf();return{...VL,id:t,type:"notes",position:e,data:{id:t,isOpen:!0,label:"Notes",notes:"",type:"notes"}}},aLe=()=>{const e=ae(sn);return u.useCallback(t=>{var c;const n=Cf.get();we(n!==null);let s=window.innerWidth/2,i=window.innerHeight/2;const o=(c=document.querySelector("#workflow-editor"))==null?void 0:c.getBoundingClientRect();o&&(s=o.width/2-K2/2+o.left,i=o.height/2-K2/2+o.top);const a=n.screenToFlowPosition({x:s,y:i});if(t==="current_image")return iLe(a);if(t==="notes")return oLe(a);const l=e[t];return coe(a,l)},[e])},JK=(e,t,n)=>{let s=t,i=n;for(;e.find(o=>o.position.x===s&&o.position.y===i);)s=Math.floor(s+50),i=Math.floor(i+50);return{x:s,y:i}},eZ=(e,t)=>{const n="originalType"in e?Yo(e,"originalType"):e,s="originalType"in t?Yo(t,"originalType"):t,i="originalType"in e?e.originalType:null,o="originalType"in t?t.originalType:null;return!!(Al(n,s)||o&&Al(n,o)||i&&Al(i,s)||i&&o&&Al(i,o))},lLe=(e,t,n,s)=>{const i=n.find(c=>c.target===s&&c.targetHandle==="item");if(!(i!=null&&i.sourceHandle))return null;const o=t.find(c=>c.id===i.source);if(!o)return null;const a=e[o.data.type];if(!a)return null;const l=a.outputs[i.sourceHandle];return l?l.type:null};var cLe=uoe();const d3=Qu(cLe),uLe=(e,t,n,s)=>{const i=new d3.Graph;return n.forEach(o=>{i.setNode(o.id)}),s.forEach(o=>{i.setEdge(o.source,o.target)}),i.setEdge(e,t),!d3.alg.isAcyclic(i)},tZ=(e,t)=>{if(eZ(e,t))return!0;if(e.batch!==t.batch)return!1;const n=e.name==="CollectionItemField"&&!Zc(t),s=am(e)&&t.name==="CollectionItemField",i=Ca(t)&&e.name===t.name,o=e.name==="CollectionField"&&!am(t),a=t.name==="CollectionField"&&Zc(e),l=am(e),c=am(t),d=l&&c,h=l&&Ca(t),f=Zc(e)&&Zc(t),p=Zc(e)&&Ca(t),g=Ca(e)&&Ca(t),m=d||f||p||g||h,y=e.name==="IntegerField"&&t.name==="FloatField",b=e.name==="IntegerField"&&t.name==="StringField",C=e.name==="FloatField"&&t.name==="StringField",x=m&&(y||b||C),v=t.name==="AnyField";return n||s||i||o||a||x||v},dLe=e=>t=>t.target===e.target&&t.targetHandle===e.targetHandle&&t.source===e.source&&t.sourceHandle===e.sourceHandle,hLe=e=>t=>t.target===e.target&&t.targetHandle===e.targetHandle,Qg=(e,t,n,s,i,o=!0)=>{if(e.source===e.target)return"nodes.cannotConnectToSelf";if(o){const a=n.filter(g=>g.id!==(i==null?void 0:i.id));if(a.some(dLe(e)))return"nodes.cannotDuplicateConnection";const l=t.find(g=>g.id===e.source);if(!l)return"nodes.missingNode";const c=t.find(g=>g.id===e.target);if(!c)return"nodes.missingNode";const d=s[l.data.type];if(!d)return"nodes.missingInvocationTemplate";const h=s[c.data.type];if(!h)return"nodes.missingInvocationTemplate";const f=d.outputs[e.sourceHandle];if(!f)return"nodes.missingFieldTemplate";const p=h.inputs[e.targetHandle];if(!p)return"nodes.missingFieldTemplate";if(p.input==="direct")return"nodes.cannotConnectToDirectInput";if(c.data.type==="collect"&&e.targetHandle==="item"){const g=lLe(s,t,n,c.id);if(g&&!eZ(f.type,g))return"nodes.cannotMixAndMatchCollectionItemTypes"}if(a.find(hLe(e))&&p.type.name!=="CollectionItemField")return"nodes.inputMayOnlyHaveOneConnection";if(!tZ(f.type,p.type))return"nodes.fieldTypesMustMatch"}return uLe(e.source,e.target,t,n)?"nodes.connectionWouldCreateCycle":null},nZ=(e,t,n,s,i,o,a,l)=>{if(e===n)return null;if(t&&s)return{source:e,sourceHandle:t,target:n,targetHandle:s};if(t&&!s){const d=fLe(e,t,n,i,o,a,l)[0];return d?{source:e,sourceHandle:t,target:n,targetHandle:d.name}:null}if(!t&&s){const d=pLe(n,s,e,i,o,a,l)[0];return d?{source:e,sourceHandle:d.name,target:n,targetHandle:s}:null}return null},fLe=(e,t,n,s,i,o,a)=>{const l=s.find(g=>g.id===e),c=s.find(g=>g.id===n);if(!l||!c)return[];const d=o[l.data.type],h=o[c.data.type];return!d||!h?[]:d.outputs[t]?fo(h.inputs).filter(g=>{const m={source:e,sourceHandle:t,target:n,targetHandle:g.name};return Qg(m,s,i,o,a,!0)===null}):[]},pLe=(e,t,n,s,i,o,a)=>{const l=s.find(g=>g.id===e),c=s.find(g=>g.id===n);if(!c||!l)return[];const d=o[c.data.type],h=o[l.data.type];return!d||!h?[]:h.inputs[t]?fo(d.outputs).filter(g=>{const m={source:n,sourceHandle:g.name,target:e,targetHandle:t};return Qg(m,s,i,o,a,!0)===null}):[]},gLe=e=>{const{source:t,sourceHandle:n,target:s,targetHandle:i}=e;return`reactflow__edge-${t}${n||""}-${s}${i||""}`},uy=e=>{const{source:t,sourceHandle:n,target:s,targetHandle:i}=e;return we(t&&n&&s&&i,"Invalid connection"),{source:t,sourceHandle:n,target:s,targetHandle:i,id:gLe({source:t,sourceHandle:n,target:s,targetHandle:i})}},mLe=()=>{const{t:e}=A(),t=gc(),n=aLe(),s=ae(sn),i=ae(xr);return u.useCallback(a=>{const l=n(a);if(!l){const g=e("nodes.unknownNode",{nodeType:a});ge({status:"error",title:g});return}const c=rj.get(),{nodes:d,edges:h}=Qe(t.getState());l.position=JK(d,(c==null?void 0:c.x)??l.position.x,(c==null?void 0:c.y)??l.position.y),l.selected=!0;const f=[{type:"add",item:l}],p=[];if(d.forEach(({id:g,selected:m})=>{m&&f.push({type:"select",id:g,selected:!1})}),h.forEach(({id:g,selected:m})=>{m&&p.push({type:"select",id:g,selected:!1})}),f.length>0&&t.dispatch(Cu(f)),p.length>0&&t.dispatch(Zi(p)),i&&Pn(l)){const g=$l.get(),{handleType:m}=i,y=m==="source"?i.nodeId:l.id,b=m==="source"?i.handleId:null,C=m==="target"?i.nodeId:l.id,x=m==="target"?i.handleId:null,{nodes:v,edges:w}=Qe(t.getState()),S=nZ(y,b,C,x,v,w,s,g);if(S){const j=uy(S);t.dispatch(Zi([{type:"add",item:j}]))}}},[n,i,t,e,s])},yLe={"[cmdk-root]":{w:"full",h:"full"},"[cmdk-list]":{w:"full",h:"full"}},sZ=u.memo(()=>{const{t:e}=A(),t=u.useRef(null),[n,s]=u.useState(""),i=mLe(),o=I(An),a=wo(),[l]=vc(n,300),c=ae(vu),d=u.useCallback(()=>{vu.set(!0)},[]),h=u.useCallback(()=>{vu.set(!1)},[]);Re({id:"addNode",category:"workflows",callback:d,options:{enabled:o==="workflows"&&!a,preventDefault:!0},dependencies:[d,o,a]});const f=u.useCallback(m=>{s(m.target.value)},[]),p=u.useCallback(()=>{h(),s(""),xr.set(null)},[h]),g=u.useCallback(m=>{i(m),p()},[i,p]);return r.jsxs(Dr,{isOpen:c,onClose:p,useInert:!1,initialFocusRef:t,size:"xl",isCentered:!0,children:[r.jsx(ar,{}),r.jsx(Rr,{h:"512",maxH:"70%",children:r.jsx(Ws,{p:2,h:"full",sx:yLe,children:r.jsx(N4,{loop:!0,shouldFilter:!1,children:r.jsxs(T,{flexDir:"column",h:"full",gap:2,children:[r.jsx(kt,{ref:t,value:n,onChange:f,placeholder:e("nodes.nodeSearch")}),r.jsx(Se,{w:"full",h:"full",children:r.jsxs(os,{children:[r.jsx(YK,{children:r.jsx(Pt,{position:"absolute",top:0,right:0,bottom:0,left:0,icon:null,label:"No matching items"})}),r.jsx(ZK,{children:r.jsx(rZ,{searchTerm:l,onSelect:g})})]})})]})})})})]})});sZ.displayName="AddNodeCmdk";const bLe={'&[data-selected="true"]':{bg:"base.700"}},xLe=Wn(sn,e=>Object.values(e).filter(t=>t.classification!=="deprecated")),vLe=zL(e=>new RegExp(e.trim().replace(/[-[\]{}()*+!<=:?./\\^$|#,]/g,"").split(" ").join(".*"),"gi")),S2=zL((e,t)=>{const n=vLe(t);if(!t||e.title.includes(t)||n.test(e.title)||e.type.includes(t)||n.test(e.type)||e.description.includes(t)||n.test(e.description)||e.nodePack.includes(t)||n.test(e.nodePack)||e.classification.includes(t)||n.test(e.classification))return!0;for(const s of e.tags)if(s.includes(t)||n.test(s))return!0;return!1},(e,t)=>`${e.type}-${t}`),rZ=u.memo(({searchTerm:e,onSelect:t})=>{const{t:n}=A(),s=ae(xLe),i=ae(xr),o=u.useMemo(()=>({type:"current_image",title:n("nodes.currentImage"),description:n("nodes.currentImageDescription"),tags:["progress","image","current"],classification:"stable",nodePack:"invokeai"}),[n]),a=u.useMemo(()=>({type:"notes",title:n("nodes.notes"),description:n("nodes.notesDescription"),tags:["notes"],classification:"stable",nodePack:"invokeai"}),[n]),l=u.useMemo(()=>{const c=[];if(i){for(const d of s)if(S2(d,e)){const h=i.handleType==="source"?d.inputs:d.outputs;for(const[f,p]of Hae(h)){const g=i.handleType==="source"?i.fieldTemplate.type:p.type,m=i.handleType==="target"?i.fieldTemplate.type:p.type;if(tZ(g,m)){c.push({label:d.title,value:d.type,description:d.description,classification:d.classification,nodePack:d.nodePack});break}}}}else{for(const d of s)S2(d,e)&&c.push({label:d.title,value:d.type,description:d.description,classification:d.classification,nodePack:d.nodePack});for(const d of[o,a])S2(d,e)&&c.push({label:d.title,value:d.type,description:d.description,classification:d.classification,nodePack:d.nodePack})}return c},[i,s,e,o,a]);return r.jsx(r.Fragment,{children:l.map(c=>r.jsx(KK,{value:c.value,onSelect:t,asChild:!0,children:r.jsxs(T,{role:"button",flexDir:"column",sx:bLe,py:1,px:2,borderRadius:"base",children:[r.jsxs(T,{alignItems:"center",gap:2,children:[c.classification==="beta"&&r.jsx(lt,{boxSize:4,color:"invokeYellow.300",as:qR}),c.classification==="prototype"&&r.jsx(lt,{boxSize:4,color:"invokeRed.300",as:Fj}),c.classification==="internal"&&r.jsx(lt,{boxSize:4,color:"invokePurple.300",as:VR}),c.classification==="special"&&r.jsx(lt,{boxSize:4,color:"invokeGreen.300",as:vd}),r.jsx(q,{fontWeight:"semibold",children:c.label}),r.jsx(it,{}),r.jsx(q,{variant:"subtext",fontWeight:"semibold",children:c.nodePack})]}),c.description&&r.jsx(q,{color:"base.200",children:c.description})]})},c.value))})});rZ.displayName="CommandListItems";const CLe=hn(Qe,e=>({name:e.name,description:e.description,notes:e.notes,author:e.author,tags:e.tags})),wLe=()=>{const{name:e,description:t,notes:n,author:s,tags:i}=I(CLe),{t:o}=A();return r.jsxs(T,{flexDir:"column",gap:"2",children:[!!e.length&&r.jsxs(Se,{children:[r.jsx(q,{fontWeight:"semibold",children:o("nodes.workflowName")}),r.jsx(q,{opacity:.7,fontStyle:"oblique 5deg",children:e})]}),!!s.length&&r.jsxs(Se,{children:[r.jsx(q,{fontWeight:"semibold",children:o("nodes.workflowAuthor")}),r.jsx(q,{opacity:.7,fontStyle:"oblique 5deg",children:s})]}),!!i.length&&r.jsxs(Se,{children:[r.jsx(q,{fontWeight:"semibold",children:o("nodes.workflowTags")}),r.jsx(q,{opacity:.7,fontStyle:"oblique 5deg",children:i})]}),!!t.length&&r.jsxs(Se,{children:[r.jsx(q,{fontWeight:"semibold",children:o("nodes.workflowDescription")}),r.jsx(q,{opacity:.7,fontStyle:"oblique 5deg",children:t})]}),!!n.length&&r.jsxs(Se,{children:[r.jsx(q,{fontWeight:"semibold",children:o("nodes.workflowNotes")}),r.jsx(q,{opacity:.7,fontStyle:"oblique 5deg",children:n})]})]})},SLe=u.memo(wLe),iZ=()=>{const e=ae(sn),t=u.useMemo(()=>fe(Qe,s=>s.nodes.filter(Pn).some(i=>{const o=e[i.data.type];return o?GL(i.data,o):!1})),[e]);return I(t)},jLe=()=>{const{t:e}=A();return r.jsx(T,{flexDir:"column",gap:"2",children:r.jsxs(T,{flexDir:"column",gap:"2",children:[r.jsx(q,{fontWeight:"semibold",children:e("toast.loadedWithWarnings")}),r.jsxs(T,{flexDir:"column",children:[r.jsxs(q,{children:[e("common.toResolve"),":"]}),r.jsxs(q,{children:[e("nodes.editMode")," >> ",e("nodes.updateAllNodes")," >> ",e("common.save")]})]})]})})},kLe=()=>iZ()?r.jsx(Ee,{label:r.jsx(jLe,{}),children:r.jsx(T,{h:"full",alignItems:"center",gap:"2",children:r.jsx(lt,{color:"warning.400",as:ug})})}):r.jsx(r.Fragment,{}),_Le=()=>{const{t:e}=A(),t=I($y),n=fc(),s=I(Co);return r.jsxs(T,{gap:"1",alignItems:"center",children:[t.length?r.jsx(Ee,{label:r.jsx(SLe,{}),placement:"top",children:r.jsx(q,{fontSize:"lg",userSelect:"none",noOfLines:1,wordBreak:"break-all",fontWeight:"semibold",children:t})}):r.jsx(q,{fontSize:"lg",fontStyle:"italic",fontWeight:"semibold",children:e("workflows.unnamedWorkflow")}),n&&s==="edit"&&r.jsx(Ee,{label:e("nodes.newWorkflowDesc2"),children:r.jsx(T,{children:r.jsx(lt,{as:dhe,boxSize:"20px",color:"invokeYellow.500"})})}),r.jsx(kLe,{})]})},oZ=u.memo(()=>{const e=I($y);return r.jsx(T,{gap:2,top:2,left:"50%",transform:"translateX(-50%)",position:"absolute",pointerEvents:"none",children:!!e.length&&r.jsx(_Le,{})})});oZ.displayName="TopCenterPanel";const ILe=()=>{const{t:e}=A(),t=u.useCallback(()=>{vu.set(!0)},[]);return r.jsx(oe,{tooltip:e("nodes.addNodeToolTip"),"aria-label":e("nodes.addNode"),icon:r.jsx(Vt,{}),onClick:t,pointerEvents:"auto"})},TLe=u.memo(ILe),ALe=$n("workflows"),ELe=()=>{const e=gc(),{t}=A();return u.useCallback(()=>{const s=Ju(e.getState()),i=sn.get();let o=0;s.filter(Pn).forEach(a=>{const l=i[a.data.type];if(!l){o++;return}if(GL(a.data,l))try{const c=doe(a,l);e.dispatch(Cu([{type:"remove",id:c.id},{type:"add",item:c}]))}catch(c){c instanceof hoe&&o++}}),o?(ALe.warn(t("nodes.unableToUpdateNodes",{count:o})),ge({id:"UNABLE_TO_UPDATE_NODES",title:t("nodes.unableToUpdateNodes",{count:o})})):ge({id:"ALL_NODES_UPDATED",title:t("nodes.allNodesUpdated"),status:"success"})},[e,t])},MLe=()=>{const{t:e}=A(),t=iZ(),n=ELe();return t?r.jsx(oe,{tooltip:e("nodes.updateAllNodes"),"aria-label":e("nodes.updateAllNodes"),icon:r.jsx(ug,{}),onClick:n,pointerEvents:"auto",colorScheme:"warning"}):null},PLe=u.memo(MLe),aZ=u.memo(()=>{const e=wo(),t=ae(na),n=bc(),s=fD(),i=ae(Ha),{t:o}=A();return r.jsxs(T,{gap:2,top:2,left:2,position:"absolute",alignItems:"flex-start",pointerEvents:"none",children:[!e&&r.jsxs(T,{gap:"2",children:[r.jsx(TLe,{}),r.jsx(PLe,{})]}),e&&r.jsxs(ac,{status:"info",borderRadius:"base",fontSize:"sm",shadow:"md",w:"fit-content",children:[r.jsx(lc,{}),r.jsxs(Se,{children:[r.jsx($p,{children:o("workflows.builder.workflowLocked")}),s&&r.jsx(Ta,{whiteSpace:"pre-wrap",children:o("workflows.builder.publishingValidationRunInProgress")}),t&&!s&&!i&&r.jsx(Ta,{whiteSpace:"pre-wrap",children:o("workflows.builder.workflowLockedDuringPublishing")}),t&&!s&&i&&r.jsx(Ta,{whiteSpace:"pre-wrap",children:o("workflows.builder.selectingOutputNodeDesc")}),n&&r.jsx(Ta,{whiteSpace:"pre-wrap",children:o("workflows.builder.workflowLockedPublished")})]})]})]})});aZ.displayName="TopLeftPanel";const LLe=()=>{const e=G(),{t}=A(),{isOpen:n,onOpen:s,onClose:i}=cr(),o=fc(),a=u.useCallback(()=>{e(VM()),ge({id:"WORKFLOW_CLEARED",title:t("workflows.workflowCleared"),status:"success"}),i()},[e,i,t]),l=u.useCallback(()=>{if(o){a();return}s()},[o,a,s]);return r.jsxs(r.Fragment,{children:[r.jsx(oe,{tooltip:t("nodes.clearWorkflow"),"aria-label":t("nodes.clearWorkflow"),icon:r.jsx(hb,{}),onClick:l,pointerEvents:"auto"}),r.jsx(ai,{isOpen:n,onClose:i,title:t("nodes.clearWorkflow"),acceptCallback:a,useInert:!1,children:r.jsxs(T,{flexDir:"column",gap:2,children:[r.jsx(q,{children:t("nodes.clearWorkflowDesc")}),r.jsx(q,{variant:"subtext",children:t("nodes.clearWorkflowDesc2")})]})})]})},DLe=u.memo(LLe),RLe=()=>{const{t:e}=A(),t=fc(),n=ox();return r.jsx(oe,{tooltip:e("workflows.saveWorkflow"),"aria-label":e("workflows.saveWorkflow"),icon:r.jsx(so,{}),isDisabled:!t,onClick:n,pointerEvents:"auto"})},OLe=u.memo(RLe),NLe=()=>{const{t:e}=A(),[t]=foe(),n=u.useCallback(()=>{t()},[t]);return r.jsx(de,{leftIcon:r.jsx(jde,{}),tooltip:e("nodes.reloadNodeTemplates"),"aria-label":e("nodes.reloadNodeTemplates"),onClick:n,children:e("nodes.reloadNodeTemplates")})},FLe=u.memo(NLe),BLe={flexGrow:1},[lZ]=dc(!1),$Le=()=>{const e=G(),t=lZ(),n=I(HL),s=I(WL),i=I(UL),o=I(Wy),a=I(qL),l=I(KL),c=u.useCallback(y=>{e(poe(y.target.checked))},[e]),d=u.useCallback(y=>{e(goe(y.target.checked))},[e]),h=u.useCallback(y=>{e(moe(y.target.checked))},[e]),f=u.useCallback(y=>{e(yoe(y.target.checked))},[e]),p=u.useCallback(y=>{e(boe(y.target.checked))},[e]),g=u.useCallback(y=>{e(xoe(y.target.checked))},[e]),{t:m}=A();return r.jsxs(Dr,{isOpen:t.isTrue,onClose:t.setFalse,size:"2xl",isCentered:!0,useInert:!1,children:[r.jsx(ar,{}),r.jsxs(Rr,{children:[r.jsx(lr,{children:m("nodes.workflowSettings")}),r.jsx(Pi,{}),r.jsx(Ws,{children:r.jsxs(T,{flexDirection:"column",gap:4,py:4,children:[r.jsx(Ft,{size:"sm",children:m("parameters.general")}),r.jsxs(ks,{orientation:"vertical",formLabelProps:BLe,children:[r.jsxs(K,{children:[r.jsxs(T,{w:"full",children:[r.jsx(J,{children:m("nodes.animatedEdges")}),r.jsx(et,{onChange:d,isChecked:o})]}),r.jsx(Js,{children:m("nodes.animatedEdgesHelp")})]}),r.jsx(wt,{}),r.jsxs(K,{children:[r.jsxs(T,{w:"full",children:[r.jsx(J,{children:m("nodes.snapToGrid")}),r.jsx(et,{isChecked:n,onChange:h})]}),r.jsx(Js,{children:m("nodes.snapToGridHelp")})]}),r.jsx(wt,{}),r.jsxs(K,{children:[r.jsxs(T,{w:"full",children:[r.jsx(J,{children:m("nodes.colorCodeEdges")}),r.jsx(et,{isChecked:i,onChange:f})]}),r.jsx(Js,{children:m("nodes.colorCodeEdgesHelp")})]}),r.jsx(wt,{}),r.jsxs(K,{children:[r.jsxs(T,{w:"full",children:[r.jsx(J,{children:m("nodes.fullyContainNodes")}),r.jsx(et,{isChecked:s===voe.Full,onChange:p})]}),r.jsx(Js,{children:m("nodes.fullyContainNodesHelp")})]}),r.jsx(wt,{}),r.jsxs(K,{children:[r.jsxs(T,{w:"full",children:[r.jsx(J,{children:m("nodes.showEdgeLabels")}),r.jsx(et,{isChecked:a,onChange:g})]}),r.jsx(Js,{children:m("nodes.showEdgeLabelsHelp")})]}),r.jsx(wt,{}),r.jsx(Ft,{size:"sm",pt:4,children:m("common.advanced")}),r.jsxs(K,{children:[r.jsxs(T,{w:"full",children:[r.jsx(J,{children:m("nodes.validateConnections")}),r.jsx(et,{isChecked:l,onChange:c})]}),r.jsx(Js,{children:m("nodes.validateConnectionsHelp")})]}),r.jsx(wt,{})]}),r.jsx(FLe,{})]})})]})]})},VLe=u.memo($Le),cZ=u.memo(()=>{const e=lZ(),t=wo(),{t:n}=A();return t?null:r.jsxs(T,{gap:2,top:2,right:2,position:"absolute",alignItems:"flex-end",pointerEvents:"none",children:[r.jsx(DLe,{}),r.jsx(OLe,{}),r.jsx(oe,{pointerEvents:"auto","aria-label":n("workflows.workflowEditorMenu"),icon:r.jsx(xd,{}),onClick:e.setTrue})]})});cZ.displayName="TopRightPanel";const zLe=()=>{const e=gc(),t=ae(sn),n=ij(),s=u.useCallback((l,{nodeId:c,handleId:d,handleType:h})=>{we(c&&d&&h,"Invalid connection start event");const p=Ju(e.getState()).find(b=>b.id===c);if(!p)return;const g=t[p.data.type];if(!g)return;const y=g[h==="source"?"outputs":"inputs"][d];y&&xr.set({nodeId:c,handleId:d,handleType:h,fieldTemplate:y})},[e,t]),i=u.useCallback(l=>{const{dispatch:c}=e,d=uy(l);c(Zi([{type:"add",item:d}])),n([d.source,d.target]),xr.set(null)},[e,n]),o=u.useCallback(()=>{const{dispatch:l}=e,c=xr.get(),d=$l.get(),h=k0.get();if(d&&!h||ou.get()){xr.set(null);return}if(!c)return;const{nodes:f,edges:p}=Qe(e.getState());if(h){const{handleType:g}=c,m=g==="source"?c.nodeId:h,y=g==="source"?c.handleId:null,b=g==="target"?c.nodeId:h,C=g==="target"?c.handleId:null,x=nZ(m,y,b,C,f,p,t,d);if(x){const v=uy(x),w=[{type:"add",item:v}],S=[v.source,v.target];d&&(ou.set(!0),w.push({type:"remove",id:d.id}),S.push(d.source,d.target)),l(Zi(w)),n(S)}xr.set(null)}else vu.set(!0)},[e,t,n]);return u.useMemo(()=>({onConnectStart:s,onConnect:i,onConnectEnd:o}),[s,i,o])},GLe=()=>{const e=gc(),t=ae(sn),n=I(KL);return u.useCallback(({source:i,sourceHandle:o,target:a,targetHandle:l})=>{if(!(i&&o&&a&&l))return!1;const c=$l.get(),{nodes:d,edges:h}=Qe(e.getState());return Qg({source:i,sourceHandle:o,target:a,targetHandle:l},d,h,t,c,n)===null},[t,n,e])},t0=$n("workflows"),HLe=()=>{const{getState:e}=Fp(),{nodes:t,edges:n}=Qe(e()),s=t.filter(a=>a.selected),i=n.filter(a=>a.selected),o=n.filter(a=>s.some(l=>l.id===a.target));ZL.set(s),YL.set(i),XL.set(o)},uZ=e=>{const{getState:t,dispatch:n}=Fp(),{nodes:s,edges:i}=Qe(t()),o=sn.get(),a=rj.get(),l=gt(ZL.get());let c=gt(YL.get());if(e){const v=gt(XL.get());c=uD([...c,...v],Al)}const d=l.map(v=>v.position.x),h=l.map(v=>v.position.y),f=Math.min(...d),p=Math.min(...h),g=a?a.x-f:50,m=a?a.y-p:50;l.forEach(v=>{const{x:w,y:S}=JK(s,v.position.x+g,v.position.y+m);v.position.x=w,v.position.y=S,v.selected=!0;const j=Gf();for(const P of c)P.source===v.id?P.source=j:P.target===v.id&&(P.target=j);v.id=j,v.data.id=j}),c.forEach(v=>{v.id=Gf()});const y=[],b=[];s.forEach(({id:v,selected:w})=>{w&&y.push({type:"select",id:v,selected:!1})}),l.forEach(v=>{y.push({type:"add",item:v})}),i.forEach(({id:v,selected:w})=>{w&&b.push({type:"select",id:v,selected:!1})});const C=[...s,...l],x=[...i];c.forEach(v=>{if(v.type==="collapsed"){const{type:w,source:S,target:j}=v;if(C.find(P=>P.id===v.source)===void 0||C.find(P=>P.id===v.target)===void 0){t0.warn({edge:{type:w,source:S,target:j}},`Invalid collapsed edge, cannot paste: ${Pe("nodes.missingSourceOrTargetNode")}`);return}}else if(v.type==="default"){const{type:w,source:S,sourceHandle:j,target:P,targetHandle:E}=v;if(!j||!E){t0.warn({edge:{type:w,source:S,sourceHandle:j,target:P,targetHandle:E}},`Invalid edge, cannot paste: ${Pe("nodes.missingSourceOrTargetHandle")}`);return}const D=Qg({source:S,sourceHandle:j,target:P,targetHandle:E},C,x,o,null,!0);if(D!==null){t0.warn({edge:{source:S,sourceHandle:j,target:P,targetHandle:E}},`Invalid edge, cannot paste: ${Pe(D)}`);return}}else{const{type:w}=v;t0.warn({edge:{type:w}},"Invalid edge type, cannot paste");return}b.push({type:"add",item:v}),x.push(v)}),y.length>0&&n(Cu(y)),b.length>0&&n(Zi(b))},WLe=()=>{uZ(!1)},ULe=()=>{uZ(!0)},qLe={copySelection:HLe,pasteSelection:WLe,pasteSelectionWithEdges:ULe},KLe=()=>qLe,yx=e=>{if(!e)return lo("base.500");const t=Coe[e.name];return lo(t||"base.500")},ZLe={opacity:.8},YLe=({fromX:e,fromY:t,fromPosition:n,toX:s,toY:i,toPosition:o})=>{const a=ae(xr),l=I(UL),c=I(Wy),d=u.useMemo(()=>l&&a?yx(a.fieldTemplate.type):lo("base.500"),[a,l]),h=u.useMemo(()=>c?"react-flow__custom_connection-path animated":"react-flow__custom_connection-path",[c]),f={sourceX:e,sourceY:t,sourcePosition:n,targetX:s,targetY:i,targetPosition:o},[p]=oj(f);return r.jsx("g",{children:r.jsx("path",{fill:"none",stroke:d,strokeWidth:2,className:h,d:p,style:ZLe})})},XLe=u.memo(YLe),dZ=(e,t)=>fe(Qe,n=>{const s=n.nodes.find(o=>o.id===e),i=n.nodes.find(o=>o.id===t);return!!(s!=null&&s.selected||i!=null&&i.selected)}),QLe=(e,t,n,s,i)=>fe(Qe,iM,(o,a)=>{const{shouldColorEdges:l}=a,c=o.nodes.find(m=>m.id===t),d=o.nodes.find(m=>m.id===s);if(!c||!n||!d||!i)return lo("base.500");const h=e[c.data.type],f=Pn(c)&&Pn(d),p=h==null?void 0:h.outputs[n],g=f?p==null?void 0:p.type:void 0;return g&&l?yx(g):lo("base.500")}),JLe=(e,t,n,s,i)=>fe(Qe,o=>{var h,f;const a=o.nodes.find(p=>p.id===t),l=o.nodes.find(p=>p.id===s);if(!a||!n||!l||!i)return null;const c=e[a.data.type],d=e[l.data.type];return`${(c==null?void 0:c.title)||((h=a.data)==null?void 0:h.label)} -> ${(d==null?void 0:d.title)||((f=l.data)==null?void 0:f.label)}`}),eDe=vo(JL),tDe={strokeWidth:"3px !important",stroke:"base.500 !important",opacity:"0.5 !important",strokeDasharray:"none",'&[data-selected="true"]':{opacity:"1 !important"},'&[data-selected="true"], &[data-are-connected-nodes-selected="true"]':{strokeDasharray:"5 !important"},'&[data-should-animate-edges="true"]':{animation:"dashdraw 0.5s linear infinite !important"}},nDe={bg:"base.500",opacity:.5,shadow:"base",'&[data-selected="true"]':{opacity:1}},sDe=({sourceX:e,sourceY:t,targetX:n,targetY:s,sourcePosition:i,targetPosition:o,markerEnd:a,data:l,selected:c=!1,source:d,target:h})=>{const f=I(Wy),p=u.useMemo(()=>dZ(d,h),[d,h]),g=I(p),[m,y,b]=oj({sourceX:e,sourceY:t,sourcePosition:i,targetX:n,targetY:s,targetPosition:o});return r.jsxs(r.Fragment,{children:[r.jsx(eDe,{path:m,markerEnd:a,sx:tDe,"data-selected":c,"data-are-connected-nodes-selected":g,"data-should-animate-edges":f}),(l==null?void 0:l.count)!==void 0&&r.jsx(QL,{children:r.jsx(Se,{position:"absolute",transform:`translate(-50%, -50%) translate(${y}px,${b}px)`,className:`edge-label-renderer__custom-edge ${Ve} ${si}`,zIndex:1001,children:r.jsx(Kn,{variant:"solid",sx:nDe,"data-selected":c,children:l.count})})})]})},rDe=u.memo(sDe),iDe=vo(JL),oDe={strokeWidth:"3px !important",opacity:"0.5 !important",strokeDasharray:"none",'&[data-selected="true"]':{opacity:"1 !important"},'&[data-should-animate-edges="true"]':{animation:"dashdraw 0.5s linear infinite !important",'&[data-selected="true"], &[data-are-connected-nodes-selected="true"]':{strokeDasharray:"5 !important"}}},aDe={pointerEvents:"all",position:"absolute",bg:"base.800",borderRadius:"base",borderWidth:1,opacity:.5,borderColor:"transparent",py:1,px:3,shadow:"md",'&[data-selected="true"]':{opacity:1,borderColor:void 0}},lDe={fontWeight:"semibold",color:"base.300",'&[data-selected="true"]':{color:"base.100"}},cDe=({sourceX:e,sourceY:t,targetX:n,targetY:s,sourcePosition:i,targetPosition:o,markerEnd:a,selected:l=!1,source:c,target:d,sourceHandleId:h,targetHandleId:f})=>{const p=ae(sn),g=I(Wy),m=I(qL),y=u.useMemo(()=>dZ(c,d),[c,d]),b=u.useMemo(()=>QLe(p,c,h,d,f),[p,c,h,d,f]),C=u.useMemo(()=>JLe(p,c,h,d,f),[p,c,h,d,f]),x=I(y),v=I(b),w=I(C),[S,j,P]=oj({sourceX:e,sourceY:t,sourcePosition:i,targetX:n,targetY:s,targetPosition:o});return r.jsxs(r.Fragment,{children:[r.jsx(iDe,{path:S,markerEnd:a,sx:oDe,stroke:`${v} !important`,"data-selected":l,"data-are-connected-nodes-selected":x,"data-should-animate-edges":g}),w&&m&&r.jsx(QL,{children:r.jsx(T,{className:`${Ve} ${si}`,transform:`translate(-50%, -50%) translate(${j}px,${P}px)`,"data-selected":l,sx:aDe,children:r.jsx(q,{size:"sm",sx:lDe,"data-selected":l,children:w})})})]})},uDe=u.memo(cDe),dDe={h:"full",position:"relative",borderRadius:"base",transitionProperty:"none",cursor:"grab","& .node-selection-overlay":{display:"none",position:"absolute",top:0,insetInlineEnd:0,bottom:0,insetInlineStart:0,borderRadius:"base",transitionProperty:"none",pointerEvents:"none",opacity:.5},'&[data-is-mouse-over-node="true"] .node-selection-overlay':{opacity:1,display:"block"},'&[data-is-mouse-over-form-field="true"] .node-selection-overlay':{opacity:1,display:"block",bg:"invokeBlueAlpha.100"},_hover:{"& .node-selection-overlay":{display:"block",shadow:"0 0 0 2px var(--invoke-colors-blue-300)"},'&[data-is-selected="true"] .node-selection-overlay':{display:"block",opacity:1,shadow:"0 0 0 3px var(--invoke-colors-blue-300)"}},'&[data-is-selected="true"] .node-selection-overlay':{display:"block",shadow:"0 0 0 3px var(--invoke-colors-blue-300)"},'&[data-is-editor-locked="true"]':{"& *":{cursor:"not-allowed",pointerEvents:"none"}}},hDe={position:"absolute",top:0,insetInlineEnd:0,bottom:0,insetInlineStart:0,borderRadius:"base",pointerEvents:"none",zIndex:-1,shadow:"var(--invoke-shadows-xl), var(--invoke-shadows-base), var(--invoke-shadows-base)"},fDe={position:"absolute",top:0,insetInlineEnd:0,bottom:0,insetInlineStart:0,borderRadius:"md",pointerEvents:"none",transitionProperty:"none",opacity:.7,zIndex:-1,display:"none",shadow:"0 0 0 2px var(--invoke-colors-yellow-400), 0 0 20px 2px var(--invoke-colors-orange-700)",'&[data-is-in-progress="true"]':{display:"block"}},pDe=e=>{const{nodeId:t,width:n,children:s,selected:i}=e,o=vH(t),a=Bg(t),l=Jb(t),c=wo(),d=FS(t),h=(d==null?void 0:d.status)===er.enum.IN_PROGRESS,f=I(eD),p=Bp(),g=u.useCallback(m=>{m.target instanceof HTMLElement&&(m.target instanceof HTMLInputElement||m.target instanceof HTMLTextAreaElement||m.target instanceof HTMLSelectElement||m.target instanceof HTMLButtonElement||m.target instanceof HTMLAnchorElement||m.target.closest(`.${yc}`)===null&&l())},[l]);return r.jsxs(Se,{onClick:p.onCloseGlobal,onDoubleClick:g,onMouseOver:o.handleMouseOver,onMouseOut:o.handleMouseOut,className:tg,sx:dDe,width:n||K2,opacity:f,"data-is-editor-locked":c,"data-is-selected":i,"data-is-mouse-over-form-field":a.isMouseOverFormField,children:[r.jsx(Se,{sx:hDe}),r.jsx(Se,{sx:fDe,"data-is-in-progress":h}),s,r.jsx(Se,{className:"node-selection-overlay"})]})},dy=u.memo(pDe),gDe=e=>{const t=I(Lp),n=ae(Bo);return n!=null&&n.image?r.jsx(j2,{nodeProps:e,children:r.jsx(Wt,{src:n==null?void 0:n.image.dataURL,w:"full",h:"full",objectFit:"contain",borderRadius:"base"})}):t?r.jsx(j2,{nodeProps:e,children:r.jsx(ul,{imageDTO:t})}):r.jsx(j2,{nodeProps:e,children:r.jsx(Pt,{})})},mDe=u.memo(gDe),j2=e=>{const[t,n]=u.useState(!1),s=u.useCallback(()=>{n(!0)},[]),i=u.useCallback(()=>{n(!1)},[]),{t:o}=A();return r.jsx(dy,{nodeId:e.nodeProps.id,selected:e.nodeProps.selected,width:384,children:r.jsxs(T,{onMouseEnter:s,onMouseLeave:i,className:tg,position:"relative",flexDirection:"column",children:[r.jsx(T,{layerStyle:"nodeHeader",borderTopRadius:"base",alignItems:"center",justifyContent:"center",h:8,children:r.jsx(q,{fontSize:"sm",fontWeight:"semibold",color:"base.200",children:o("nodes.currentImage")})}),r.jsxs(T,{layerStyle:"nodeBody",w:"full",h:"full",borderBottomRadius:"base",p:2,children:[e.children,t&&r.jsx(s_.div,{initial:yDe,animate:bDe,exit:xDe,style:vDe,children:r.jsx(RV,{inset:2})},"nextPrevButtons")]})]})})},yDe={opacity:0},bDe={opacity:1,transition:{duration:.1}},xDe={opacity:0,transition:{duration:.1}},vDe={position:"absolute",top:40,left:-2,right:-2,bottom:0,pointerEvents:"none"},CDe={position:"relative",minH:8,py:.5,alignItems:"center",justifyContent:"flex-end"},F4=u.memo(({children:e})=>r.jsx(T,{sx:CDe,children:e}));F4.displayName="OutputFieldWrapper";const wDe=(e,t)=>{const n=ae(sn),s=u.useMemo(()=>fe(Qe,o=>{const a=OS(o,e),l=n[a.data.type],c=l==null?void 0:l.outputs[t];return(c==null?void 0:c.title)||t}),[t,e,n]);return I(s)},SDe=(e,t)=>{const n=ae(sn),s=u.useMemo(()=>fe(Qe,o=>{const a=ld(o,e);if(!a)return!1;const l=n[a.data.type];return!!(l==null?void 0:l.outputs[t])}),[t,e,n]);return I(s)},hZ=u.memo(({nodeId:e,fieldName:t,children:n})=>SDe(e,t)?n:r.jsx(fZ,{nodeId:e,fieldName:t}));hZ.displayName="OutputFieldGate";const fZ=u.memo(({nodeId:e,fieldName:t})=>{const{t:n}=A(),s=wDe(e,t);return r.jsx(F4,{children:r.jsx(K,{isInvalid:!0,alignItems:"stretch",justifyContent:"space-between",gap:2,h:"full",w:"full",children:r.jsx(J,{display:"flex",alignItems:"center",h:"full",color:"error.300",mb:0,px:1,gap:2,children:n("nodes.unexpectedField_withName",{name:s})})})})});fZ.displayName="Fallback";const jDe=(e,t,n,s,i,o)=>fe(Qe,a=>{const{nodes:l,edges:c}=a;if(!i)return"nodes.noConnectionInProgress";if(s===i.handleType)return s==="source"?"nodes.cannotConnectOutputToOutput":"nodes.cannotConnectInputToInput";const d=s==="source"?t:i.nodeId,h=s==="source"?n:i.handleId,f=s==="target"?t:i.nodeId,p=s==="target"?n:i.handleId;return Qg({source:d,sourceHandle:h,target:f,targetHandle:p},l,c,e,o)}),bx=(e,t,n)=>{const s=ae(xr),i=ae(sn),o=ae($l),a=u.useMemo(()=>jDe(i,e,t,n,s,o),[i,e,t,n,s,o]);return I(a)},xx=(e,t,n)=>{const s=ae(xr);return u.useMemo(()=>!s||s.nodeId!==e||s.handleId!==t?!1:n==="source"&&s.fieldTemplate.fieldKind==="output"||n==="target"&&s.fieldTemplate.fieldKind==="input",[t,n,e,s])},vx=()=>ae(woe),Cx=e=>{const{t}=A();return u.useMemo(()=>{const{name:s}=e;return Zc(e)?t("nodes.collectionFieldType",{name:s}):Ca(e)?t("nodes.collectionOrScalarFieldType",{name:s}):t("nodes.singleFieldType",{name:s})},[e,t])},pZ={position:"relative",width:"full",height:"full",borderStyle:"solid",borderWidth:4,pointerEvents:"none",'&[data-cardinality="SINGLE"]':{borderWidth:0},borderRadius:"100%",'&[data-is-model-field="true"], &[data-is-batch-field="true"]':{borderRadius:4},'&[data-is-batch-field="true"]':{transform:"rotate(45deg)"},'&[data-is-connection-in-progress="true"][data-is-connection-start-field="false"][data-is-connection-valid="false"]':{filter:"opacity(0.4) grayscale(0.7)",cursor:"not-allowed"},'&[data-is-connection-in-progress="true"][data-is-connection-start-field="true"][data-is-connection-valid="false"]':{cursor:"grab"},'&[data-is-connection-in-progress="false"] &[data-is-connection-valid="true"]':{cursor:"crosshair"}},gZ={position:"absolute",width:"1rem",height:"1rem",zIndex:1,background:"none",border:"none",insetInlineEnd:"-0.5rem"},mZ=u.memo(({nodeId:e,fieldName:t})=>{const n=ix(e,t),s=Cx(n.type),i=u.useMemo(()=>yx(n.type),[n.type]),o=u.useMemo(()=>tD(n.type),[n.type]);return vx()?r.jsx(bZ,{nodeId:e,fieldName:t,fieldTemplate:n,fieldTypeName:s,fieldColor:i,isModelField:o}):r.jsx(yZ,{nodeId:e,fieldName:t,fieldTemplate:n,fieldTypeName:s,fieldColor:i,isModelField:o})});mZ.displayName="OutputFieldHandle";const yZ=u.memo(({fieldTemplate:e,fieldTypeName:t,fieldColor:n,isModelField:s})=>{const i=wo();return r.jsx(Ee,{label:t,placement:"start",openDelay:dd,children:r.jsx(Ea,{type:"source",id:e.name,position:Ma.Right,style:gZ,isConnectable:!i,children:r.jsx(Se,{sx:pZ,"data-cardinality":e.type.cardinality,"data-is-batch-field":e.type.batch,"data-is-model-field":s,"data-is-connection-in-progress":!1,"data-is-connection-start-field":!1,"data-is-connection-valid":!1,backgroundColor:e.type.cardinality==="SINGLE"?n:"base.900",borderColor:n})})})});yZ.displayName="IdleHandle";const bZ=u.memo(({nodeId:e,fieldName:t,fieldTemplate:n,fieldTypeName:s,fieldColor:i,isModelField:o})=>{const{t:a}=A(),l=xx(e,t,"target"),c=bx(e,t,"target"),d=wo(),h=u.useMemo(()=>c!==null?a(c):s,[s,a,c]);return r.jsx(Ee,{label:h,placement:"start",openDelay:dd,children:r.jsx(Ea,{type:"source",id:n.name,position:Ma.Right,style:gZ,isConnectable:!d,children:r.jsx(Se,{sx:pZ,"data-cardinality":n.type.cardinality,"data-is-batch-field":n.type.batch,"data-is-model-field":o,"data-is-connection-in-progress":!0,"data-is-connection-start-field":l,"data-is-connection-valid":c===null,backgroundColor:n.type.cardinality==="SINGLE"?i:"base.900",borderColor:i})})})});bZ.displayName="ConnectionInProgressHandle";const xZ=u.memo(({nodeId:e,fieldName:t})=>{const n=ix(e,t),s=Cx(n.type),{t:i}=A();return r.jsxs(T,{flexDir:"column",children:[r.jsx(q,{fontWeight:"semibold",children:n.title}),r.jsx(q,{opacity:.7,fontStyle:"oblique 5deg",children:n.description}),r.jsxs(q,{children:[i("parameters.type"),": ",s]})]})});xZ.displayName="OutputFieldTooltipContent";const B4=(e,t)=>{const n=u.useMemo(()=>fe(Qe,i=>i.edges.find(a=>a.target===e&&a.targetHandle===t)!==void 0),[t,e]);return I(n)},kDe={fontSize:"sm",color:"base.300",fontWeight:"semibold",pe:2,'&[data-is-disabled="true"]':{opacity:.5}},vZ=u.memo(({nodeId:e,fieldName:t})=>{const n=ix(e,t),s=B4(e,t),i=xx(e,t,"source"),o=vx(),a=bx(e,t,"source");return r.jsx(Ee,{label:r.jsx(xZ,{nodeId:e,fieldName:t}),openDelay:dd,placement:"top",children:r.jsx(q,{"data-is-disabled":o&&a!==null&&!i||s,sx:kDe,children:n.title})})});vZ.displayName="OutputFieldTitle";const CZ=u.memo(({nodeId:e,fieldName:t})=>r.jsxs(F4,{children:[r.jsx(vZ,{nodeId:e,fieldName:t}),r.jsx(mZ,{nodeId:e,fieldName:t})]}));CZ.displayName="OutputFieldNodesEditorView";const _De=e=>{const t=u.useMemo(()=>fe(Qe,s=>ed(s,e)),[e]);return I(t)},IDe=e=>e.input==="connection"&&!Ca(e.type)||!(e.type.name in nD),TDe=e=>(["any","direct"].includes(e.input)||Ca(e.type))&&e.type.name in nD,ADe=e=>{const t=Rs(e),n=_De(e);return u.useMemo(()=>{const i=new Set(Object.keys(n.inputs)),o=new Set(Object.keys(t.inputs));return Array.from(i.difference(o))},[n.inputs,t.inputs])},EDe=e=>{const t=Rs(e);return u.useMemo(()=>{const s=[];for(const[i,o]of Object.entries(t.inputs))TDe(o)&&s.push(i);return s},[t.inputs])},MDe=e=>{const t=Rs(e);return u.useMemo(()=>{const s=[];for(const[i,o]of Object.entries(t.inputs))IDe(o)&&s.push(i);return s},[t.inputs])},wZ=e=>{const t=Rs(e);return u.useMemo(()=>!Soe(t.type)&&!joe(t.type),[t])},$4=e=>{const t=Rs(e);return u.useMemo(()=>Ss(t==null?void 0:t.outputs,s=>s.type.name==="ImageField"&&(t==null?void 0:t.type)!=="image"),[t])},PDe=e=>{const t=$4(e),n=wZ(e),s=Bt("invocationCache");return u.useMemo(()=>n&&(t||s),[t,s,n])},LDe=(e,t)=>{const n=G(),s=I($S),i=Ni(e,t),o=Ic(e,t);return u.useCallback(()=>{const l=tL(e,t,i.type);n(z2({element:l,parentId:s,initialValue:o.value}))},[e,t,i.type,n,s,o.value])},SZ=u.memo(({nodeId:e,fieldName:t})=>{const{t:n}=A(),s=LDe(e,t);return r.jsx(oe,{variant:"ghost",tooltip:n("workflows.builder.addToForm"),"aria-label":n("workflows.builder.addToForm"),icon:r.jsx(Vt,{}),pointerEvents:"auto",size:"xs",onClick:s})});SZ.displayName="InputFieldAddToFormRoot";const jZ=u.memo(({nodeId:e,fieldName:t})=>{const{t:n}=A();return r.jsxs(rs,{isLazy:!0,lazyBehavior:"unmount",children:[r.jsx(gs,{children:r.jsx(oe,{variant:"ghost",tooltip:n("nodes.description"),"aria-label":n("nodes.description"),icon:r.jsx(ehe,{}),pointerEvents:"auto",size:"xs"})}),r.jsx(is,{p:2,w:256,children:r.jsx(kZ,{nodeId:e,fieldName:t})})]})});jZ.displayName="InputFieldDescriptionPopover";const kZ=u.memo(({nodeId:e,fieldName:t})=>{const n=G(),{t:s}=A(),i=sx(e,t),o=u.useCallback(a=>{n(dL({nodeId:e,fieldName:t,val:a.target.value}))},[n,t,e]);return r.jsxs(K,{orientation:"vertical",children:[r.jsx(J,{children:s("nodes.description")}),r.jsx(ss,{className:`${Ve} ${si} ${rt}`,fontSize:"sm",value:i??"",onChange:o,p:2,resize:"none",rows:5})]})});kZ.displayName="Content";const _Z={position:"relative",width:"full",height:"full",borderStyle:"solid",borderWidth:4,pointerEvents:"none",'&[data-cardinality="SINGLE"]':{borderWidth:0},borderRadius:"100%",'&[data-is-model-field="true"], &[data-is-batch-field="true"]':{borderRadius:4},'&[data-is-batch-field="true"]':{transform:"rotate(45deg)"},'&[data-is-connection-in-progress="true"][data-is-connection-start-field="false"][data-is-connection-valid="false"]':{filter:"opacity(0.4) grayscale(0.7)",cursor:"not-allowed"},'&[data-is-connection-in-progress="true"][data-is-connection-start-field="true"][data-is-connection-valid="false"]':{cursor:"grab"},'&[data-is-connection-in-progress="false"] &[data-is-connection-valid="true"]':{cursor:"crosshair"}},IZ={position:"absolute",width:"1rem",height:"1rem",zIndex:1,background:"none",border:"none",insetInlineStart:"-0.5rem"},V4=u.memo(({nodeId:e,fieldName:t})=>{const n=Ni(e,t),s=Cx(n.type),i=u.useMemo(()=>yx(n.type),[n.type]),o=u.useMemo(()=>tD(n.type),[n.type]);return vx()?r.jsx(AZ,{nodeId:e,fieldName:t,fieldTemplate:n,fieldTypeName:s,fieldColor:i,isModelField:o}):r.jsx(TZ,{nodeId:e,fieldName:t,fieldTemplate:n,fieldTypeName:s,fieldColor:i,isModelField:o})});V4.displayName="InputFieldHandle";const TZ=u.memo(({fieldTemplate:e,fieldTypeName:t,fieldColor:n,isModelField:s})=>{const i=wo();return r.jsx(Ee,{label:t,placement:"start",openDelay:dd,children:r.jsx(Ea,{type:"target",id:e.name,position:Ma.Left,style:IZ,isConnectable:!i,children:r.jsx(Se,{sx:_Z,"data-cardinality":e.type.cardinality,"data-is-batch-field":e.type.batch,"data-is-model-field":s,"data-is-connection-in-progress":!1,"data-is-connection-start-field":!1,"data-is-connection-valid":!1,backgroundColor:e.type.cardinality==="SINGLE"?n:"base.900",borderColor:n})})})});TZ.displayName="IdleHandle";const AZ=u.memo(({nodeId:e,fieldName:t,fieldTemplate:n,fieldTypeName:s,fieldColor:i,isModelField:o})=>{const{t:a}=A(),l=xx(e,t,"target"),c=bx(e,t,"target"),d=wo(),h=u.useMemo(()=>c!==null?a(c):s,[s,a,c]);return r.jsx(Ee,{label:h,placement:"start",openDelay:dd,children:r.jsx(Ea,{type:"target",id:n.name,position:Ma.Left,style:IZ,isConnectable:!d,children:r.jsx(Se,{sx:_Z,"data-cardinality":n.type.cardinality,"data-is-batch-field":n.type.batch,"data-is-model-field":o,"data-is-connection-in-progress":!0,"data-is-connection-start-field":l,"data-is-connection-valid":c===null,backgroundColor:n.type.cardinality==="SINGLE"?i:"base.900",borderColor:i})})})});AZ.displayName="ConnectionInProgressHandle";const DDe=(e,t)=>{const n=G(),s=Ni(e,t),i=u.useMemo(()=>fe(Qe,l=>{var h;const c=l.nodes.find(f=>f.id===e);if(!Pn(c))return;const d=(h=c.data.inputs[t])==null?void 0:h.value;return!Al(d,s.default)}),[t,s.default,e]),o=I(i),a=u.useCallback(()=>{n(US({nodeId:e,fieldName:t,value:s.default}))},[n,t,s.default,e]);return{defaultValue:s.default,isValueChanged:o,resetToDefaultValue:a}},EZ=u.memo(({nodeId:e,fieldName:t})=>{const{t:n}=A(),{isValueChanged:s,resetToDefaultValue:i}=DDe(e,t);return r.jsx(oe,{variant:"ghost",tooltip:n("nodes.resetToDefaultValue"),"aria-label":n("nodes.resetToDefaultValue"),icon:r.jsx(ur,{}),pointerEvents:"auto",size:"xs",onClick:i,isDisabled:!s})});EZ.displayName="InputFieldResetToDefaultValueIconButton";const RDe=(e,t)=>{const n=ae(sn),s=u.useMemo(()=>fe(Qe,o=>{const a=ld(o,e);if(!a)return[];const l=HS(o,e,t),c=n[a.data.type];we(c,`Template for input node type ${a.data.type} not found.`);const d=c.inputs[t];return we(d,`Template for input field ${t} not found.`),cj(a,c,l,d,o)}),[e,t,n]);return HH(s)},MZ=u.memo(({nodeId:e,fieldName:t})=>{const{t:n}=A(),s=Ic(e,t),i=Ni(e,t),o=Cx(i.type),a=RDe(e,t),l=u.useMemo(()=>s.label&&i.title?`${s.label} (${i.title})`:s.label&&!i.title?s.label:i.title,[s,i]);return r.jsxs(T,{flexDir:"column",children:[r.jsx(q,{fontWeight:"semibold",children:l}),r.jsx(q,{opacity:.7,fontStyle:"oblique 5deg",children:i.description}),r.jsxs(q,{children:[n("parameters.type"),": ",o]}),r.jsxs(q,{children:[n("common.input"),": ",r0(i.input)]}),a.length>0&&r.jsxs(r.Fragment,{children:[r.jsxs(q,{color:"error.500",children:[n("common.error_withCount",{count:a.length}),":"]}),r.jsx(or,{children:a.map(({issue:c})=>r.jsx(Rt,{children:c},c))})]})]})});MZ.displayName="InputFieldTooltipContent";const ODe={p:0,fontWeight:"semibold",textAlign:"left",color:"base.300",_hover:{fontWeight:"semibold !important"},'&[data-is-invalid="true"]':{color:"error.300"},'&[data-is-disabled="true"]':{opacity:.5}},z4=u.memo(e=>{const{nodeId:t,fieldName:n,isInvalid:s,isDragging:i}=e,o=u.useRef(null),a=c4(t,n),l=GW(t,n),{t:c}=A(),d=B4(t,n),h=xx(t,n,"target"),f=vx(),p=bx(t,n,"target"),g=G(),m=u.useMemo(()=>l||c("nodes.unknownField"),[l,c]),y=u.useCallback(v=>{g(hL({nodeId:t,fieldName:n,label:v}))},[g,t,n]),b=aa({value:a||m,defaultValue:m,onChange:y,inputRef:o}),C=u.useMemo(()=>f&&p!==null&&!h||d,[f,p,h,d]),x=u.useCallback(v=>{v.stopPropagation(),b.startEditing()},[b]);return b.isEditing?r.jsx(kt,{ref:o,variant:"outline",...b.inputProps,_focusVisible:{borderRadius:"base",h:"unset",px:2}}):r.jsx(Ee,{label:r.jsx(MZ,{nodeId:t,fieldName:n}),openDelay:dd,placement:"top",isDisabled:i,children:r.jsx(q,{className:yc,sx:ODe,noOfLines:1,"data-is-invalid":s,"data-is-disabled":C,onDoubleClick:x,children:b.value})})});z4.displayName="InputFieldTitle";const wx=u.memo(({nodeId:e,fieldName:t})=>{const n=Ni(e,t),s=Gg(e,t),i=B4(e,t);return n.input==="connection"||i?r.jsx(PZ,{nodeId:e,fieldName:t,isInvalid:s,isConnected:i,fieldTemplate:n}):r.jsx(LZ,{nodeId:e,fieldName:t,isInvalid:s,isConnected:i,fieldTemplate:n})});wx.displayName="InputFieldEditModeNodes";const PZ=u.memo(({nodeId:e,fieldName:t,isInvalid:n})=>r.jsxs(Qb,{children:[r.jsx(T,{px:2,children:r.jsx(z4,{nodeId:e,fieldName:t,isInvalid:n})}),r.jsx(V4,{nodeId:e,fieldName:t})]}));PZ.displayName="ConnectedOrConnectionField";const NDe={w:"full",px:2,flexDir:"column",gap:1,'&[data-is-dragging="true"]':{opacity:.3},pointerEvents:"auto",'&[data-is-connected="true"]':{pointerEvents:"none"},"& .direct-field-action-buttons":{display:"none"},_hover:{"& .direct-field-action-buttons":{display:"inline-flex"}}},LZ=u.memo(({nodeId:e,fieldName:t,isInvalid:n,isConnected:s,fieldTemplate:i})=>{const o=u.useRef(null),a=u.useRef(null),l=f4e(e,t,i,o,a);return r.jsxs(Qb,{children:[r.jsxs(T,{ref:o,sx:NDe,"data-is-connected":s,"data-is-dragging":l,children:[r.jsxs(T,{gap:1,children:[r.jsx(T,{className:Ve,ref:a,children:r.jsx(z4,{nodeId:e,fieldName:t,isInvalid:n,isDragging:l})}),r.jsx(it,{}),r.jsxs(T,{className:"direct-field-action-buttons",children:[r.jsx(jZ,{nodeId:e,fieldName:t}),r.jsx(EZ,{nodeId:e,fieldName:t}),r.jsx(SZ,{nodeId:e,fieldName:t})]})]}),r.jsx(nx,{nodeId:e,fieldName:t})]}),i.input!=="direct"&&r.jsx(V4,{nodeId:e,fieldName:t})]})});LZ.displayName="DirectField";const FDe=e=>{const t=u.useMemo(()=>fe(Qe,s=>{var i;return((i=ed(s,e))==null?void 0:i.isIntermediate)??!1}),[e]);return I(t)},BDe=({nodeId:e})=>{const{t}=A(),n=G(),s=$4(e),i=FDe(e),o=u.useCallback(a=>{n(koe({nodeId:e,isIntermediate:!a.target.checked}))},[n,e]);return s?r.jsxs(K,{className:si,children:[r.jsxs(J,{m:0,children:[t("nodes.saveToGallery")," "]}),r.jsx(Sn,{onChange:o,isChecked:!i})]}):null},$De=u.memo(BDe),VDe=e=>{const t=u.useMemo(()=>fe(Qe,s=>{var i;return((i=ed(s,e))==null?void 0:i.useCache)??!1}),[e]);return I(t)},zDe=({nodeId:e})=>{const t=G(),n=VDe(e),s=u.useCallback(o=>{t(_oe({nodeId:e,useCache:o.target.checked}))},[t,e]),{t:i}=A();return r.jsxs(K,{className:yc,children:[r.jsx(J,{m:0,children:i("invocationCache.useCache")}),r.jsx(Sn,{className:si,onChange:s,isChecked:n})]})},GDe=u.memo(zDe),h3={w:"unset"},HDe=({nodeId:e})=>{const t=$4(e),n=wZ(e),s=Bt("invocationCache");return r.jsx(T,{className:tg,layerStyle:"nodeFooter",w:"full",borderBottomRadius:"base",gap:4,px:2,py:0,h:8,justifyContent:"space-between",children:r.jsxs(ks,{formControlProps:h3,formLabelProps:h3,children:[n&&s&&r.jsx(GDe,{nodeId:e}),n&&t&&r.jsx($De,{nodeId:e})]})})},WDe=u.memo(HDe),UDe={transitionProperty:"transform",transitionDuration:"normal",transform:"rotate(180deg)",'&[data-is-open="true"]':{transform:"rotate(0deg)"}},qDe=({nodeId:e,isOpen:t})=>{const n=G(),s=ij(),i=u.useCallback(()=>{n(Ioe({nodeId:e,isOpen:!t})),s(e)},[n,t,e,s]);return r.jsx(oe,{className:`${Ve} ${yc}`,onClick:i,"aria-label":"Minimize",minW:8,w:8,h:8,variant:"link",icon:r.jsx(lt,{as:$R,sx:UDe,"data-is-open":t})})},G4=u.memo(qDe),KDe=e=>u.useMemo(()=>{switch(e){case"Group 1":return"invokeGreen.300";case"Group 2":return"invokeBlue.300";case"Group 3":return"invokePurple.200";case"Group 4":return"invokeRed.300";case"Group 5":return"invokeYellow.300";default:return}},[e]),ZDe=e=>{const t=u.useMemo(()=>fe(Qe,s=>{var o;const i=Toe(s,e);if(Pn(i)&&jp(i))return(o=i.data.inputs.batch_group_id)==null?void 0:o.value}),[e]);return I(t)},YDe=({nodeId:e,title:t})=>{const n=G(),s=Z_(e),i=ZDe(e),o=KDe(i),a=ZG(e),{t:l}=A(),c=u.useRef(null),d=u.useCallback(p=>{n(eL({nodeId:e,label:p}))},[n,e]),h=aa({value:s||t||a||l("nodes.problemSettingTitle"),defaultValue:t||a||l("nodes.problemSettingTitle"),onChange:d,inputRef:c}),f=u.useMemo(()=>i?i==="None"?`${h.value} (${l("nodes.noBatchGroup")})`:`${h.value} (${i})`:h.value,[i,h.value,l]);return r.jsxs(T,{overflow:"hidden",w:"full",h:"full",alignItems:"center",justifyContent:"center",children:[!h.isEditing&&r.jsx(q,{className:yc,fontWeight:"semibold",color:o,onDoubleClick:h.startEditing,noOfLines:1,children:f}),h.isEditing&&r.jsx(kt,{ref:c,...h.inputProps,variant:"outline",_focusVisible:{borderRadius:"base",h:"unset"}})]})},DZ=u.memo(YDe),XDe=e=>{const t=Rs(e);return u.useMemo(()=>t.classification,[t])},QDe=({nodeId:e})=>{const t=XDe(e);return!t||t==="stable"?null:r.jsx(Ee,{label:r.jsx(RZ,{classification:t}),placement:"top",shouldWrapChildren:!0,children:r.jsx(eRe,{classification:t})})},JDe=u.memo(QDe),RZ=u.memo(({classification:e})=>{const{t}=A();return e==="beta"?t("nodes.betaDesc"):e==="prototype"?t("nodes.prototypeDesc"):e==="internal"?t("nodes.internalDesc"):e==="special"?t("nodes.specialDesc"):null});RZ.displayName="ClassificationTooltipContent";const eRe=({classification:e})=>e==="beta"?r.jsx(lt,{as:qR,display:"block",boxSize:4,color:"invokeYellow.300"}):e==="prototype"?r.jsx(lt,{as:Fj,display:"block",boxSize:4,color:"invokeRed.300"}):e==="internal"?r.jsx(lt,{as:VR,display:"block",boxSize:4,color:"invokePurple.300"}):e==="special"?r.jsx(lt,{as:vd,display:"block",boxSize:4,color:"invokeGreen.300"}):null,tRe=e=>{const t=ae(sn),n=u.useMemo(()=>fe(Qe,i=>bD(e,t,i).length>0),[e,t]);return I(n)},f3={visibility:"hidden"},p3={borderWidth:0,borderRadius:"3px",width:"1rem",height:"1rem",backgroundColor:"var(--invoke-colors-base-600)",zIndex:-1},nRe=({nodeId:e})=>{const t=Rs(e);return t?r.jsxs(r.Fragment,{children:[r.jsx(Ea,{type:"target",id:`${e}-collapsed-target`,isConnectable:!1,position:Ma.Left,style:p3}),fo(t.inputs,n=>r.jsx(Ea,{type:"target",id:n.name,isConnectable:!1,position:Ma.Left,style:f3},`${e}-${n.name}-collapsed-input-handle`)),r.jsx(Ea,{type:"source",id:`${e}-collapsed-source`,isConnectable:!1,position:Ma.Right,style:p3}),fo(t.outputs,n=>r.jsx(Ea,{type:"source",id:n.name,isConnectable:!1,position:Ma.Right,style:f3},`${e}-${n.name}-collapsed-output-handle`))]}):null},sRe=u.memo(nRe),OZ=u.memo(({nodeId:e})=>{const t=KG(e);return r.jsx(Ee,{label:r.jsx(NZ,{nodeId:e}),placement:"top",shouldWrapChildren:!0,children:r.jsx(lt,{as:bd,display:"block",boxSize:4,w:8,color:t?"error.400":"base.400"})})});OZ.displayName="InvocationNodeInfoIcon";const NZ=u.memo(({nodeId:e})=>{const t=WG(e),n=Z_(e),s=K_(e),i=Rs(e),{t:o}=A(),a=u.useMemo(()=>n?`${n} (${i.title})`:i.title,[n,i.title]);return r.jsxs(T,{flexDir:"column",children:[r.jsx(q,{as:"span",fontWeight:"semibold",children:a}),r.jsxs(q,{opacity:.7,children:[o("nodes.nodePack"),": ",i.nodePack]}),r.jsx(q,{opacity:.7,fontStyle:"oblique 5deg",children:i.description}),r.jsx(rRe,{nodeVersion:s,templateVersion:i.version}),t&&r.jsx(q,{children:t})]})});NZ.displayName="TooltipContent";const rRe=({nodeVersion:e,templateVersion:t})=>{const{t:n}=A();return VI(e,t,"<")?r.jsxs(q,{as:"span",color:"error.500",children:[n("nodes.version")," ",e," (",n("nodes.updateNode"),")"]}):VI(e,t,">")?r.jsxs(q,{as:"span",color:"error.500",children:[n("nodes.version")," ",e," (",n("nodes.updateApp"),")"]}):r.jsxs(q,{as:"span",children:[n("nodes.version")," ",e]})},k2=3,g3={circle:{transitionProperty:"none",transitionDuration:"0s"},".chakra-progress__track":{stroke:"transparent"}},iRe=({nodeId:e})=>{const t=FS(e);return t?r.jsx(Ee,{label:r.jsx(FZ,{nodeExecutionState:t}),placement:"top",children:r.jsx(T,{className:tg,w:5,h:"full",alignItems:"center",justifyContent:"flex-end",children:r.jsx(BZ,{nodeExecutionState:t})})}):null},oRe=u.memo(iRe),FZ=u.memo(({nodeExecutionState:e})=>{const{status:t,progress:n,progressImage:s}=e,{t:i}=A();return t===er.enum.PENDING?r.jsx(q,{children:i("queue.pending")}):t===er.enum.IN_PROGRESS?s?r.jsxs(T,{pos:"relative",pt:1.5,pb:.5,children:[r.jsx(Wt,{src:s.dataURL,w:32,h:32,borderRadius:"base",objectFit:"contain"}),n!==null&&r.jsxs(Kn,{variant:"solid",pos:"absolute",top:2.5,insetInlineEnd:1,children:[Math.round(n*100),"%"]})]}):n!==null?r.jsxs(q,{children:[i("nodes.executionStateInProgress")," (",Math.round(n*100),"%)"]}):r.jsx(q,{children:i("nodes.executionStateInProgress")}):t===er.enum.COMPLETED?r.jsx(q,{children:i("nodes.executionStateCompleted")}):t===er.enum.FAILED?r.jsx(q,{children:i("nodes.executionStateError")}):null});FZ.displayName="TooltipLabel";const BZ=u.memo(e=>{const{progress:t,status:n}=e.nodeExecutionState;return n===er.enum.PENDING?r.jsx(lt,{as:Gj,boxSize:k2,color:"base.300"}):n===er.enum.IN_PROGRESS?t===null?r.jsx(zI,{isIndeterminate:!0,size:"14px",color:"base.500",thickness:14,sx:g3}):r.jsx(zI,{value:Math.round(t*100),size:"14px",color:"base.500",thickness:14,sx:g3}):n===er.enum.COMPLETED?r.jsx(lt,{as:og,boxSize:k2,color:"ok.300"}):n===er.enum.FAILED?r.jsx(lt,{as:ug,boxSize:k2,color:"error.300"}):null});BZ.displayName="StatusIcon";const aRe={borderTopRadius:"base",alignItems:"center",justifyContent:"space-between",h:8,textAlign:"center",color:"base.200",borderBottomRadius:"base",'&[data-is-open="true"]':{borderBottomRadius:0},'&[data-is-invalid="true"]':{color:"error.300"}},lRe=({nodeId:e,isOpen:t})=>{const n=tRe(e);return r.jsxs(T,{layerStyle:"nodeHeader",sx:aRe,"data-is-open":t,"data-is-invalid":n,children:[r.jsx(G4,{nodeId:e,isOpen:t}),r.jsx(JDe,{nodeId:e}),r.jsx(DZ,{nodeId:e}),r.jsxs(T,{alignItems:"center",children:[r.jsx(oRe,{nodeId:e}),r.jsx(OZ,{nodeId:e})]}),!t&&r.jsx(sRe,{nodeId:e})]})},cRe=u.memo(lRe),uRe={flexDirection:"column",w:"full",h:"full",py:2,gap:1,borderBottomRadius:"base",'&[data-with-footer="true"]':{borderBottomRadius:0},'&[data-with-footer="false"]':{pb:4}},dRe=({nodeId:e,isOpen:t})=>{const n=PDe(e);return r.jsxs(r.Fragment,{children:[r.jsx(cRe,{nodeId:e,isOpen:t}),t&&r.jsxs(r.Fragment,{children:[r.jsx(T,{layerStyle:"nodeBody",sx:uRe,"data-with-footer":n,children:r.jsxs(T,{flexDir:"column",px:2,w:"full",h:"full",children:[r.jsxs(Ar,{gridTemplateColumns:"1fr auto",gridAutoRows:"1fr",children:[r.jsx($Z,{nodeId:e}),r.jsx(GZ,{nodeId:e})]}),r.jsx(VZ,{nodeId:e}),r.jsx(zZ,{nodeId:e})]})}),n&&r.jsx(WDe,{nodeId:e})]})]})},hRe=u.memo(dRe),$Z=u.memo(({nodeId:e})=>{const t=MDe(e);return r.jsx(r.Fragment,{children:t.map((n,s)=>r.jsx(xt,{gridColumnStart:1,gridRowStart:s+1,children:r.jsx(_c,{nodeId:e,fieldName:n,children:r.jsx(wx,{nodeId:e,fieldName:n})})},`${e}.${n}.input-field`))})});$Z.displayName="ConnectionFields";const VZ=u.memo(({nodeId:e})=>{const t=EDe(e);return r.jsx(r.Fragment,{children:t.map(n=>r.jsx(_c,{nodeId:e,fieldName:n,children:r.jsx(wx,{nodeId:e,fieldName:n})},`${e}.${n}.input-field`))})});VZ.displayName="AnyOrDirectFields";const zZ=u.memo(({nodeId:e})=>{const t=ADe(e);return r.jsx(r.Fragment,{children:t.map(n=>r.jsx(_c,{nodeId:e,fieldName:n,children:r.jsx(wx,{nodeId:e,fieldName:n})},`${e}.${n}.input-field`))})});zZ.displayName="MissingFields";const GZ=u.memo(({nodeId:e})=>{const t=UW(e);return r.jsx(r.Fragment,{children:t.map((n,s)=>r.jsx(xt,{gridColumnStart:2,gridRowStart:s+1,children:r.jsx(hZ,{nodeId:e,fieldName:n,children:r.jsx(CZ,{nodeId:e,fieldName:n})})},`${e}.${n}.output-field`))})});GZ.displayName="OutputFields";const fRe=e=>{const t=u.useMemo(()=>fe(Qe,s=>{var i;return((i=ed(s,e))==null?void 0:i.nodePack)??null}),[e]);return I(t)},pRe=({nodeId:e,isOpen:t,label:n,type:s})=>{const{t:i}=A(),o=fRe(e);return r.jsxs(r.Fragment,{children:[r.jsxs(T,{className:tg,layerStyle:"nodeHeader",borderTopRadius:"base",borderBottomRadius:t?0:"base",alignItems:"center",h:8,fontWeight:"semibold",fontSize:"sm",children:[r.jsx(G4,{nodeId:e,isOpen:t}),r.jsx(q,{w:"full",textAlign:"center",pe:8,color:"error.300",children:n?`${n} (${s})`:s})]}),t&&r.jsx(T,{layerStyle:"nodeBody",userSelect:"auto",flexDirection:"column",w:"full",h:"full",p:4,gap:1,borderBottomRadius:"base",fontSize:"sm",children:r.jsxs(T,{gap:2,flexDir:"column",children:[r.jsxs(q,{as:"span",children:[i("nodes.unknownNodeType"),":"," ",r.jsx(q,{as:"span",fontWeight:"semibold",children:s})]}),o&&r.jsxs(q,{as:"span",children:[i("nodes.nodePack"),":"," ",r.jsx(q,{as:"span",fontWeight:"semibold",children:o})]})]})})]})},gRe=u.memo(pRe),mRe=e=>{const{data:t,selected:n}=e,{id:s,type:i,isOpen:o,label:a}=t,l=ae(sn),c=u.useMemo(()=>!!l[i],[l,i]),d=u.useMemo(()=>fe(Ju,f=>!!f.find(p=>p.id===s)),[s]);return I(d)?c?r.jsx(dy,{nodeId:s,selected:n,children:r.jsx(hRe,{nodeId:s,isOpen:o})}):r.jsx(dy,{nodeId:s,selected:n,children:r.jsx(gRe,{nodeId:s,isOpen:o,label:a,type:i})}):null},yRe=u.memo(mRe),bRe=e=>{const{id:t,data:n,selected:s}=e,{notes:i,isOpen:o}=n,a=G(),l=u.useCallback(h=>{a(Aoe({nodeId:t,value:h.target.value}))},[a,t]),c=u.useMemo(()=>fe(Ju,h=>!!h.find(f=>f.id===t)),[t]);return I(c)?r.jsxs(dy,{nodeId:t,selected:s,children:[r.jsxs(T,{layerStyle:"nodeHeader",borderTopRadius:"base",borderBottomRadius:o?0:"base",alignItems:"center",justifyContent:"space-between",h:8,children:[r.jsx(G4,{nodeId:t,isOpen:o}),r.jsx(DZ,{nodeId:t,title:"Notes"}),r.jsx(Se,{minW:8})]}),o&&r.jsx(r.Fragment,{children:r.jsx(T,{layerStyle:"nodeBody",className:si,cursor:"auto",flexDirection:"column",borderBottomRadius:"base",w:"full",h:"full",p:2,gap:1,children:r.jsx(T,{className:si,w:"full",h:"full",flexDir:"column",children:r.jsx(ss,{className:Ve,value:i,onChange:l,rows:8,resize:"none",fontSize:"sm"})})})})]}):null},xRe=u.memo(bRe),vRe={collapsed:rDe,default:uDe},CRe={invocation:yRe,current_image:mDe,notes:xRe},wRe={hideAttribution:!0},SRe=[25,25],jRe=e=>e.cancelConnection,HZ=u.memo(()=>{const e=G(),t=I(Ju),n=I(Eoe),s=ae(GI),i=ae(HI),o=I(Moe),a=I(Poe),l=I(HL),c=I(WL),{onConnectStart:d,onConnect:h,onConnectEnd:f}=zLe(),p=u.useRef(null),g=GLe(),m=Loe(jRe),y=ij(),b=gc(),C=Ms("workflows"),x=wo();sg("workflows",p),Doe();const[v]=PS("radii",["base"]),w=u.useMemo(()=>({borderRadius:v}),[v]),S=u.useCallback(H=>{e(Cu(H));const V=Cf.get();V&&i&&(HI.set(!1),V.fitView())},[e,i]),j=u.useCallback(H=>{H.length>0&&e(Zi(H))},[e]),P=u.useCallback((H,V)=>{GI.set(V)},[]),{onCloseGlobal:E}=Bp(),D=u.useCallback(()=>{E()},[E]),M=u.useCallback(H=>{Cf.set(H),H.fitView()},[]),R=u.useCallback(H=>{var V,X;(V=p.current)!=null&&V.getBoundingClientRect()&&rj.set(((X=Cf.get())==null?void 0:X.screenToFlowPosition({x:H.clientX,y:H.clientY}))??null)},[]),F=u.useCallback((H,V,X)=>{$l.set(V),ou.set(!1),Lx.set(H)},[]),_=u.useCallback((H,V)=>{ou.set(!0);const X=uy(V);e(Zi([{type:"remove",id:H.id},{type:"add",item:X}])),y([H.source,H.target,X.source,X.target])},[e,y]),L=u.useCallback((H,V,X)=>{const W=ou.get(),Y=Lx.get()??{clientX:0,clientY:0},$=!("touches"in H)&&Math.hypot(H.clientX-Y.clientX,H.clientY-Y.clientY)>5;!W&&$&&e(Zi([{type:"remove",id:V.id}])),$l.set(null),ou.set(!1),xr.set(null),Lx.set(null)},[e]),{copySelection:O,pasteSelection:B,pasteSelectionWithEdges:z}=KLe();Re({id:"copySelection",category:"workflows",callback:O,options:{enabled:C&&!x,preventDefault:!0},dependencies:[O]});const ee=u.useCallback(()=>{const{nodes:H,edges:V}=Qe(b.getState()),X=[],W=[];H.forEach(({id:Y,selected:$})=>{$||X.push({type:"select",id:Y,selected:!0})}),V.forEach(({id:Y,selected:$})=>{$||W.push({type:"select",id:Y,selected:!0})}),X.length>0&&e(Cu(X)),W.length>0&&e(Zi(W))},[e,b]);Re({id:"selectAll",category:"workflows",callback:ee,options:{enabled:C&&!x,preventDefault:!0},dependencies:[ee,C,x]}),Re({id:"pasteSelection",category:"workflows",callback:B,options:{enabled:C&&!x,preventDefault:!0},dependencies:[B,x,C]}),Re({id:"pasteSelectionWithEdges",category:"workflows",callback:z,options:{enabled:C&&!x,preventDefault:!0},dependencies:[z,x,C]}),Re({id:"undo",category:"workflows",callback:()=>{e(Roe())},options:{enabled:C&&!x&&o,preventDefault:!0},dependencies:[o,x,C]}),Re({id:"redo",category:"workflows",callback:()=>{e(Ooe())},options:{enabled:C&&!x&&a,preventDefault:!0},dependencies:[a,x,C]});const ne=u.useCallback(()=>{$l.get()||(xr.set(null),vu.set(!1),m())},[m]);Ii("esc",ne);const re=u.useCallback(()=>{const{nodes:H,edges:V}=Qe(b.getState()),X=[],W=[];H.filter(Y=>Y.selected).forEach(({id:Y})=>{X.push({type:"remove",id:Y})}),V.filter(Y=>Y.selected).forEach(({id:Y})=>{W.push({type:"remove",id:Y})}),X.length>0&&e(Cu(X)),W.length>0&&e(Zi(W))},[e,b]);Re({id:"deleteSelection",category:"workflows",callback:re,options:{preventDefault:!0,enabled:C&&!x},dependencies:[re,C,x]});const te=u.useCallback((H,V)=>{if(!Ha.get()||!Pn(V))return;const{id:X}=V.data;Xo.set(X),Ha.set(!1)},[]);return r.jsx(Noe,{id:"workflow-editor",ref:p,defaultViewport:s,nodeTypes:CRe,edgeTypes:vRe,nodes:t,edges:n,onInit:M,onNodeClick:te,onMouseMove:R,onNodesChange:S,onEdgesChange:j,onReconnect:_,onReconnectStart:F,onReconnectEnd:L,onConnectStart:d,onConnect:h,onConnectEnd:f,onMoveEnd:P,connectionLineComponent:XLe,isValidConnection:g,edgesFocusable:!x,edgesReconnectable:!x,nodesDraggable:!x,nodesConnectable:!x,nodesFocusable:!x,elementsSelectable:!x,minZoom:.1,snapToGrid:l,snapGrid:SRe,connectionRadius:30,proOptions:wRe,style:w,onPaneClick:D,deleteKeyCode:null,selectionMode:c,elevateEdgesOnSelect:!0,nodeDragThreshold:1,noDragClassName:Ve,noWheelClassName:rt,noPanClassName:si,children:r.jsx(Foe,{})})});HZ.displayName="Flow";const kRe=()=>{const e=G(),t=I(eD),{t:n}=A(),s=u.useCallback(i=>{e(Boe(i))},[e]);return r.jsx(T,{alignItems:"center",children:r.jsx(Ze,{"aria-label":n("nodes.nodeOpacity"),value:t,defaultValue:1,min:.5,max:1,step:.01,onChange:s,orientation:"vertical",h:"calc(100% - 0.5rem)"})})},_Re=u.memo(kRe),IRe=()=>{const{t:e}=A(),{zoomIn:t,zoomOut:n,fitView:s}=$oe(),i=G(),o=I(sD),a=u.useCallback(()=>{t({duration:300})},[t]),l=u.useCallback(()=>{n({duration:300})},[n]),c=u.useCallback(()=>{s({duration:300})},[s]),d=u.useCallback(()=>{i(Voe(!o))},[o,i]);return r.jsxs(Zn,{orientation:"vertical",children:[r.jsx(oe,{tooltip:e("nodes.zoomInNodes"),"aria-label":e("nodes.zoomInNodes"),onClick:a,icon:r.jsx(QR,{})}),r.jsx(oe,{tooltip:e("nodes.zoomOutNodes"),"aria-label":e("nodes.zoomOutNodes"),onClick:l,icon:r.jsx(XR,{})}),r.jsx(oe,{tooltip:e("nodes.fitViewportNodes"),"aria-label":e("nodes.fitViewportNodes"),onClick:c,icon:r.jsx(ag,{})}),r.jsx(oe,{tooltip:e(o?"nodes.hideMinimapnodes":"nodes.showMinimapnodes"),"aria-label":e(o?"nodes.hideMinimapnodes":"nodes.showMinimapnodes"),isChecked:o,onClick:d,icon:r.jsx(Jde,{})})]})},TRe=u.memo(IRe),ARe=()=>r.jsxs(T,{gap:2,position:"absolute",bottom:2,insetInlineStart:2,children:[r.jsx(TRe,{}),r.jsx(_Re,{})]}),ERe=u.memo(ARe),MRe=vo(zoe),PRe={m:"0 !important",borderRadius:"base",backgroundColor:"base.500 !important",svg:{borderRadius:"inherit"}},LRe=()=>{const e=I(sD);return r.jsx(T,{gap:2,position:"absolute",bottom:2,insetInlineEnd:2,children:e&&r.jsx(MRe,{pannable:!0,zoomable:!0,nodeBorderRadius:15,sx:PRe,nodeColor:"var(--invoke-colors-base-600)",maskColor:"var(--invoke-colors-blackAlpha-600)"})})},DRe=u.memo(LRe),RRe={display:"flex",position:"relative",width:"full",height:"full",alignItems:"center",justifyContent:"center"},ORe=()=>{const{data:e,isLoading:t}=vy(),{t:n}=A();return r.jsxs(_d,{region:"workflows",layerStyle:"first",sx:RRe,children:[e&&r.jsxs(r.Fragment,{children:[r.jsx(HZ,{}),r.jsx(sZ,{}),r.jsx(aZ,{}),r.jsx(oZ,{}),r.jsx(cZ,{}),r.jsx(ERe,{}),r.jsx(DRe,{})]}),r.jsx(VLe,{}),t&&r.jsx(Pt,{label:n("nodes.loadingNodes"),icon:lb})]})},NRe=u.memo(ORe),WZ=u.memo(()=>I(Co)==="edit"?r.jsx(Goe,{children:r.jsx(NRe,{})}):r.jsx(Wb,{}));WZ.displayName="WorkflowsMainPanel";const UZ="data:image/svg+xml,%3csvg%20width='44'%20height='44'%20viewBox='0%200%2044%2044'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M29.1951%2010.6667H42V2H2V10.6667H14.8049L29.1951%2033.3333H42V42H2V33.3333H14.8049'%20stroke='%23E6FD13'%20stroke-width='2.8'/%3e%3c/svg%3e",FRe=()=>{const{data:e}=Uy(),t=u.useRef(null),n=ae(Hoe),s=u.useMemo(()=>e?r.jsxs(q,{fontWeight:"semibold",children:["v",e.version]}):null,[e]);return n||r.jsx(Ee,{placement:"right",label:s,p:1,px:2,gutter:16,children:r.jsx(Wt,{ref:t,src:UZ,alt:"invoke-logo",w:"24px",h:"24px",minW:"24px",minH:"24px",userSelect:"none"})})},BRe=u.memo(FRe),$Re="data:image/svg+xml,%3csvg%20width='231'%20height='100'%20viewBox='0%200%20231%20100'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20clip-path='url(%23clip0_659_3578)'%3e%3crect%20width='100'%20height='100'%20fill='%23E6FD13'/%3e%3cpath%20d='M57.1951%2038.6667H70V30H30V38.6667H42.8049L57.1951%2061.3333H70V70H30V61.3333H42.8049'%20stroke='%23181818'%20stroke-width='2.8'/%3e%3crect%20width='131'%20height='100'%20transform='translate(100)'%20fill='%23E6FD13'/%3e%3cpath%20d='M111.37%2043.34H107.89V39.65H111.37V43.34ZM116.38%2060.5H102.76V58.16H108.22V47.84H103.36V45.5H111.07V58.16H116.38V60.5ZM120.538%2060.5V45.5H123.388V47.6C124.288%2046.25%20125.788%2045.2%20128.188%2045.2C131.638%2045.2%20133.588%2047.3%20133.588%2050.45V60.5H130.738V51.05C130.738%2048.95%20129.838%2047.6%20127.708%2047.6H127.468C125.338%2047.6%20123.388%2049.25%20123.388%2052.1V60.5H120.538ZM141.786%2060.5L136.236%2045.5H139.176L143.526%2057.71L147.876%2045.5H150.786L145.236%2060.5H141.786ZM159.723%2060.8C155.673%2060.8%20152.523%2057.65%20152.523%2053C152.523%2048.35%20155.673%2045.2%20159.723%2045.2C163.773%2045.2%20166.923%2048.35%20166.923%2053C166.923%2057.65%20163.773%2060.8%20159.723%2060.8ZM155.373%2053C155.373%2056.45%20157.173%2058.4%20159.603%2058.4H159.843C162.273%2058.4%20164.073%2056.45%20164.073%2053C164.073%2049.55%20162.273%2047.6%20159.843%2047.6H159.603C157.173%2047.6%20155.373%2049.55%20155.373%2053ZM170.804%2060.5V39.5H173.654V51.98L180.254%2045.5H184.004L177.764%2051.47L184.304%2060.5H180.794L175.724%2053.42L173.654%2055.43V60.5H170.804ZM192.459%2060.8C188.739%2060.8%20185.379%2058.22%20185.379%2052.97C185.379%2047.78%20188.829%2045.2%20192.369%2045.2C196.269%2045.2%20198.729%2047.9%20198.729%2051.8V53.45H188.229C188.409%2056.87%20190.599%2058.4%20192.429%2058.4H192.669C194.139%2058.4%20195.549%2057.65%20195.849%2056.06H198.699C198.159%2059.09%20195.549%2060.8%20192.459%2060.8ZM188.409%2051.2H195.879C195.759%2048.59%20194.199%2047.6%20192.489%2047.6H192.249C190.689%2047.6%20188.949%2048.53%20188.409%2051.2Z'%20fill='%23181818'/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='clip0_659_3578'%3e%3crect%20width='231'%20height='100'%20rx='5'%20fill='white'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e",VRe=({children:e})=>{const{isOpen:t,onOpen:n,onClose:s}=cr(),{t:i}=A(),{data:o}=Woe(),{data:a}=Uoe(),{data:l}=Uy(),c=u.useMemo(()=>{const d=gt(o);return d&&d.config.remote_api_tokens&&d.config.remote_api_tokens.forEach(h=>{h.token="REDACTED"}),{version:l==null?void 0:l.version,dependencies:a,config:d==null?void 0:d.config,set_config_fields:d==null?void 0:d.set_fields}},[l,a,o]);return r.jsxs(r.Fragment,{children:[u.cloneElement(e,{onClick:n}),r.jsxs(Dr,{isOpen:t,onClose:s,isCentered:!0,size:"2xl",useInert:!1,children:[r.jsx(ar,{}),r.jsxs(Rr,{maxH:"80vh",h:"34rem",children:[r.jsx(lr,{children:i("accessibility.about")}),r.jsx(Pi,{}),r.jsx(Ws,{display:"flex",flexDir:"column",gap:4,children:r.jsxs(Ar,{templateColumns:"repeat(2, 1fr)",h:"full",children:[r.jsx(xt,{backgroundColor:"base.750",borderRadius:"base",p:"4",h:"full",children:r.jsx(yo,{label:i("common.systemInformation"),data:c})}),r.jsx(xt,{children:r.jsxs(T,{flexDir:"column",gap:3,justifyContent:"center",alignItems:"center",h:"full",children:[r.jsx(Wt,{src:$Re,alt:"invoke-logo",w:"120px"}),l&&r.jsx(q,{children:`v${l==null?void 0:l.version}`}),r.jsxs(Ar,{templateColumns:"repeat(2, 1fr)",gap:"3",children:[r.jsx(xt,{children:r.jsx(sr,{href:NC,label:i("common.githubLabel")})}),r.jsx(xt,{children:r.jsx(sr,{href:Sk,label:i("common.discordLabel")})})]}),r.jsx(Ft,{fontSize:"large",children:i("common.aboutHeading")}),r.jsx(q,{fontSize:"sm",children:i("common.aboutDesc")}),r.jsx(sr,{href:BT,label:BT})]})})]})}),r.jsx(xo,{})]})]})]})},zRe=u.memo(VRe),GRe=({hotkey:e})=>{const{t}=A(),{id:n,platformKeys:s,title:i,desc:o}=e;return r.jsxs(T,{flexDir:"column",gap:2,px:2,children:[r.jsxs(T,{lineHeight:1,gap:1,alignItems:"center",children:[r.jsx(q,{fontWeight:"semibold",children:i}),r.jsx(it,{}),s.map((a,l)=>r.jsxs(u.Fragment,{children:[a.map((c,d)=>r.jsxs(u.Fragment,{children:[r.jsx(cf,{textTransform:"lowercase",children:c}),d!==a.length-1&&r.jsx(q,{as:"span",fontWeight:"semibold",children:"+"})]},`${n}-${c}-${l}-${d}`)),l!==s.length-1&&r.jsx(q,{as:"span",px:2,variant:"subtext",fontWeight:"semibold",children:t("common.or")})]},`${n}-${l}`))]}),r.jsx(q,{variant:"subtext",children:o})]})},HRe=u.memo(GRe),WRe=({children:e})=>{const{isOpen:t,onOpen:n,onClose:s}=cr(),{t:i}=A(),[o,a]=u.useState(""),l=u.useRef(null),c=u.useCallback(()=>a(""),[]),d=u.useCallback(p=>a(p.target.value),[]),h=kD(),f=u.useMemo(()=>{const p=o.trim().toLowerCase(),g=[];return Object.values(h).forEach(m=>{const y={title:m.title,hotkeys:[]};Object.values(m.hotkeys).forEach(b=>{p.length?(b.title.toLowerCase().includes(p)||b.desc.toLowerCase().includes(p)||b.category.toLowerCase().includes(p)||b.platformKeys.some(C=>C.some(x=>x.toLowerCase().includes(p))))&&y.hotkeys.push(b):y.hotkeys.push(b)}),y.hotkeys.length&&g.push(y)}),g},[h,o]);return r.jsxs(r.Fragment,{children:[u.cloneElement(e,{onClick:n}),r.jsxs(Dr,{isOpen:t,onClose:s,isCentered:!0,size:"2xl",useInert:!1,initialFocusRef:l,children:[r.jsx(ar,{}),r.jsxs(Rr,{maxH:"80vh",h:"80vh",children:[r.jsx(lr,{children:i("hotkeys.hotkeys")}),r.jsx(Pi,{}),r.jsxs(Ws,{display:"flex",flexDir:"column",gap:4,children:[r.jsxs(ta,{children:[r.jsx(kt,{ref:l,placeholder:i("hotkeys.searchHotkeys"),value:o,onChange:d}),o.length&&r.jsx(co,{h:"full",pe:2,children:r.jsx(oe,{onClick:c,size:"sm",variant:"ghost","aria-label":i("hotkeys.clearSearch"),boxSize:4,icon:r.jsx(Ot,{})})})]}),r.jsx(os,{children:r.jsxs(T,{flexDir:"column",gap:4,children:[f.map(p=>r.jsx(Wi,{title:p.title,children:p.hotkeys.map((g,m)=>r.jsxs(u.Fragment,{children:[r.jsx(HRe,{hotkey:g}),m<p.hotkeys.length-1&&r.jsx(wt,{})]},g.id))},p.title)),!f.length&&r.jsx(Pt,{label:i("hotkeys.noHotkeysFound"),icon:null})]})})]}),r.jsx(xo,{})]})]})]})},URe=u.memo(WRe);function qRe(e){return he({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M19.3034 5.33716C17.9344 4.71103 16.4805 4.2547 14.9629 4C14.7719 4.32899 14.5596 4.77471 14.411 5.12492C12.7969 4.89144 11.1944 4.89144 9.60255 5.12492C9.45397 4.77471 9.2311 4.32899 9.05068 4C7.52251 4.2547 6.06861 4.71103 4.70915 5.33716C1.96053 9.39111 1.21766 13.3495 1.5891 17.2549C3.41443 18.5815 5.17612 19.388 6.90701 19.9187C7.33151 19.3456 7.71356 18.73 8.04255 18.0827C7.41641 17.8492 6.82211 17.5627 6.24904 17.2231C6.39762 17.117 6.5462 17.0003 6.68416 16.8835C10.1438 18.4648 13.8911 18.4648 17.3082 16.8835C17.4568 17.0003 17.5948 17.117 17.7434 17.2231C17.1703 17.5627 16.576 17.8492 15.9499 18.0827C16.2789 18.73 16.6609 19.3456 17.0854 19.9187C18.8152 19.388 20.5875 18.5815 22.4033 17.2549C22.8596 12.7341 21.6806 8.80747 19.3034 5.33716ZM8.5201 14.8459C7.48007 14.8459 6.63107 13.9014 6.63107 12.7447C6.63107 11.5879 7.45884 10.6434 8.5201 10.6434C9.57071 10.6434 10.4303 11.5879 10.4091 12.7447C10.4091 13.9014 9.57071 14.8459 8.5201 14.8459ZM15.4936 14.8459C14.4535 14.8459 13.6034 13.9014 13.6034 12.7447C13.6034 11.5879 14.4323 10.6434 15.4936 10.6434C16.5442 10.6434 17.4038 11.5879 17.3825 12.7447C17.3825 13.9014 16.5548 14.8459 15.4936 14.8459Z"},child:[]}]})(e)}function KRe(e){return he({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M12.001 2C6.47598 2 2.00098 6.475 2.00098 12C2.00098 16.425 4.86348 20.1625 8.83848 21.4875C9.33848 21.575 9.52598 21.275 9.52598 21.0125C9.52598 20.775 9.51348 19.9875 9.51348 19.15C7.00098 19.6125 6.35098 18.5375 6.15098 17.975C6.03848 17.6875 5.55098 16.8 5.12598 16.5625C4.77598 16.375 4.27598 15.9125 5.11348 15.9C5.90098 15.8875 6.46348 16.625 6.65098 16.925C7.55098 18.4375 8.98848 18.0125 9.56348 17.75C9.65098 17.1 9.91348 16.6625 10.201 16.4125C7.97598 16.1625 5.65098 15.3 5.65098 11.475C5.65098 10.3875 6.03848 9.4875 6.67598 8.7875C6.57598 8.5375 6.22598 7.5125 6.77598 6.1375C6.77598 6.1375 7.61348 5.875 9.52598 7.1625C10.326 6.9375 11.176 6.825 12.026 6.825C12.876 6.825 13.726 6.9375 14.526 7.1625C16.4385 5.8625 17.276 6.1375 17.276 6.1375C17.826 7.5125 17.476 8.5375 17.376 8.7875C18.0135 9.4875 18.401 10.375 18.401 11.475C18.401 15.3125 16.0635 16.1625 13.8385 16.4125C14.201 16.725 14.5135 17.325 14.5135 18.2625C14.5135 19.6 14.501 20.675 14.501 21.0125C14.501 21.275 14.6885 21.5875 15.1885 21.4875C19.259 20.1133 21.9999 16.2963 22.001 12C22.001 6.475 17.526 2 12.001 2Z"},child:[]}]})(e)}const qZ=u.memo(()=>{const{t:e}=A(),t=Iy(),n=I(R3),s=u.useCallback(i=>{t(qoe(i.target.checked))},[t]);return r.jsxs(K,{children:[r.jsx(J,{children:e("system.enableLogging")}),r.jsx(et,{isChecked:n,onChange:s})]})});qZ.displayName="SettingsDeveloperLogIsEnabled";const KZ=u.memo(()=>{const{t:e}=A(),t=G(),n=I(L3),s=u.useMemo(()=>Koe.options.map(a=>({label:e(`system.logLevel.${a}`),value:a})),[e]),i=u.useMemo(()=>s.find(a=>a.value===n),[n,s]),o=u.useCallback(a=>{Zoe(a==null?void 0:a.value)&&t(Yoe(a.value))},[t]);return r.jsxs(K,{children:[r.jsx(J,{children:e("system.logLevel.logLevel")}),r.jsx(Ne,{value:i,options:s,onChange:o,isSearchable:!1})]})});KZ.displayName="SettingsDeveloperLogLevel";const ZZ=u.memo(()=>{const{t:e}=A(),t=I(D3),n=u.useMemo(()=>Zae(Xoe.options,t),[t]);return r.jsxs(K,{orientation:"vertical",children:[r.jsx(J,{children:e("system.logNamespaces.logNamespaces")}),r.jsx(T,{w:"full",gap:2,flexWrap:"wrap",minH:"32px",borderRadius:"base",borderWidth:1,p:2,alignItems:"center",children:t.map(s=>r.jsx(m3,{namespace:s,isEnabled:!0},`enabled-${s}`))}),r.jsx(T,{gap:2,flexWrap:"wrap",children:n.map(s=>r.jsx(m3,{namespace:s,isEnabled:!1},`disabled-${s}`))})]})});ZZ.displayName="SettingsDeveloperLogNamespaces";const m3=({namespace:e,isEnabled:t})=>{const{t:n}=A(),s=Iy(),i=u.useCallback(()=>{s(Qoe(e))},[s,e]);return r.jsxs(DS,{h:"min-content",borderRadius:"base",onClick:i,colorScheme:t?"invokeBlue":"base",userSelect:"none",role:"button",size:"md",color:"base.900",bg:t?"invokeBlue.300":"base.300",children:[r.jsx(q,{fontSize:"sm",fontWeight:"semibold",children:n(`system.logNamespaces.${e}`)}),t&&r.jsx(RS,{})]})},ZRe=e=>{const{t}=A(),{data:n,refetch:s}=Joe(void 0,{refetchOnMountOrArgChange:!0,skip:!e}),[i,{isLoading:o}]=eae(),{data:a}=oi(),l=u.useMemo(()=>!!(a&&(a.queue.in_progress>0||a.queue.pending>0)),[a]),c=u.useCallback(()=>{l||i().unwrap().then(d=>{ge({id:"INTERMEDIATES_CLEARED",title:t("settings.intermediatesCleared",{count:d}),status:"info"})}).catch(()=>{ge({id:"INTERMEDIATES_CLEAR_FAILED",title:t("settings.intermediatesClearedFailed"),status:"error"})})},[t,i,l]);return{intermediatesCount:n,clearIntermediates:c,isLoading:o,hasPendingItems:l,refetchIntermediatesCount:s}},YRe=Ge.enum(["ar","az","de","en","es","fi","fr","he","hu","it","ja","ko","nl","pl","pt","pt_BR","ru","sv","tr","ua","vi","zh_CN","zh_Hant"]),XRe=e=>YRe.safeParse(e).success,QRe={ar:"",az:"Azrbaycan dili",de:"Deutsch",en:"English",es:"Espaol",fi:"Suomi",fr:"Franais",he:"",hu:"Magyar Nyelv",it:"Italiano",ja:"",ko:"",nl:"Nederlands",pl:"Polski",pt:"Portugus",pt_BR:"Portugus do Brasil",ru:"",sv:"Svenska",tr:"Trke",ua:"",vi:"Ting Vit",zh_CN:"",zh_Hant:""},y3=fo(QRe,(e,t)=>({label:e,value:t})),YZ=u.memo(()=>{const{t:e}=A(),t=G(),n=I(Y7),s=Bt("localization"),i=u.useMemo(()=>y3.find(a=>a.value===n),[n]),o=u.useCallback(a=>{XRe(a==null?void 0:a.value)&&t(tae(a.value))},[t]);return r.jsxs(K,{isDisabled:!s,children:[r.jsx(J,{children:e("common.languagePickerLabel")}),r.jsx(Ne,{value:i,options:y3,onChange:o})]})});YZ.displayName="SettingsLanguageSelect";const JRe={shouldShowDeveloperSettings:!0,shouldShowResetWebUiText:!0,shouldShowClearIntermediates:!0,shouldShowLocalizationToggle:!0,shouldShowInvocationProgressDetailSetting:!0},[e7e]=dc(!1),t7e=({config:e=JRe,children:t})=>{const n=G(),{t:s}=A(),{isNSFWCheckerAvailable:i,isWatermarkerAvailable:o}=EL(void 0,{selectFromResult:({data:te})=>({isNSFWCheckerAvailable:(te==null?void 0:te.nsfw_methods.includes("nsfw_checker"))??!1,isWatermarkerAvailable:(te==null?void 0:te.watermarking_methods.includes("invisible_watermark"))??!1})}),{clearIntermediates:a,hasPendingItems:l,intermediatesCount:c,isLoading:d,refetchIntermediatesCount:h}=ZRe(!!(e!=null&&e.shouldShowClearIntermediates)),f=e7e(),p=WO(),g=I(nae),m=I(sae),y=I(uj),b=I(rae),C=I(iae),x=I(oae),v=I(aae),w=I(My),S=I(XM),j=I(Np),P=I($P),E=u.useCallback(()=>{n(hS())},[n]),D=rN();u.useEffect(()=>{f.isTrue&&(e!=null&&e.shouldShowClearIntermediates)&&h()},[e==null?void 0:e.shouldShowClearIntermediates,h,f.isTrue]);const M=u.useCallback(()=>{D(),f.setFalse(),p.setTrue()},[D,f,p]),R=u.useCallback(te=>{n(EM(te.target.checked))},[n]),F=u.useCallback(te=>{n(lae(te.target.checked))},[n]),_=u.useCallback(te=>{n(cae(te.target.checked))},[n]),L=u.useCallback(te=>{n(zP(te.target.checked))},[n]),O=u.useCallback(te=>{n(uae(te.target.checked))},[n]),B=u.useCallback(te=>{n(RM(te.target.checked))},[n]),z=u.useCallback(te=>{n(dae(te.target.checked))},[n]),ee=u.useCallback(te=>{n(hae(te.target.checked))},[n]),ne=u.useCallback(te=>{n(fae(te.target.checked))},[n]),re=u.useCallback(te=>{n(pae(te.target.checked))},[n]);return r.jsxs(r.Fragment,{children:[u.cloneElement(t,{onClick:f.setTrue}),r.jsxs(Dr,{isOpen:f.isTrue,onClose:f.setFalse,size:"2xl",isCentered:!0,useInert:!1,children:[r.jsx(ar,{}),r.jsxs(Rr,{maxH:"80vh",h:"68rem",children:[r.jsx(lr,{bg:"none",children:s("common.settingsLabel")}),r.jsx(Pi,{}),r.jsx(Ws,{display:"flex",flexDir:"column",gap:4,children:r.jsx(os,{children:r.jsx(T,{flexDir:"column",gap:4,children:r.jsxs(ks,{formLabelProps:{flexGrow:1},children:[r.jsxs(Wi,{title:s("settings.general"),children:[r.jsxs(K,{children:[r.jsx(J,{children:s("settings.confirmOnDelete")}),r.jsx(et,{isChecked:m,onChange:R})]}),r.jsxs(K,{children:[r.jsx(J,{children:s("settings.confirmOnNewSession")}),r.jsx(et,{isChecked:j,onChange:E})]})]}),r.jsxs(Wi,{title:s("settings.generation"),children:[r.jsxs(K,{isDisabled:!i,children:[r.jsx(J,{children:s("settings.enableNSFWChecker")}),r.jsx(et,{isChecked:C,onChange:F})]}),r.jsxs(K,{isDisabled:!o,children:[r.jsx(J,{children:s("settings.enableInvisibleWatermark")}),r.jsx(et,{isChecked:x,onChange:_})]})]}),r.jsxs(Wi,{title:s("settings.ui"),children:[r.jsxs(K,{children:[r.jsx(J,{children:s("settings.showProgressInViewer")}),r.jsx(et,{isChecked:y,onChange:L})]}),r.jsxs(K,{children:[r.jsx(J,{children:s("settings.antialiasProgressImages")}),r.jsx(et,{isChecked:b,onChange:O})]}),!!(e!=null&&e.shouldShowInvocationProgressDetailSetting)&&r.jsxs(K,{children:[r.jsx(J,{children:s("settings.showDetailedInvocationProgress")}),r.jsx(et,{isChecked:P,onChange:ne})]}),r.jsxs(K,{children:[r.jsx(ze,{feature:"noiseUseCPU",inPortal:!1,children:r.jsx(J,{children:s("parameters.useCpuNoise")})}),r.jsx(et,{isChecked:g,onChange:ee})]}),!!(e!=null&&e.shouldShowLocalizationToggle)&&r.jsx(YZ,{}),r.jsxs(K,{children:[r.jsx(J,{children:s("settings.enableInformationalPopovers")}),r.jsx(et,{isChecked:v,onChange:B})]}),r.jsxs(K,{children:[r.jsx(J,{children:s("settings.enableModelDescriptions")}),r.jsx(et,{isChecked:w,onChange:z})]}),r.jsxs(K,{children:[r.jsx(J,{children:s("settings.enableHighlightFocusedRegions")}),r.jsx(et,{isChecked:S,onChange:re})]})]}),!!(e!=null&&e.shouldShowDeveloperSettings)&&r.jsxs(Wi,{title:s("settings.developer"),children:[r.jsx(qZ,{}),r.jsx(KZ,{}),r.jsx(ZZ,{})]}),!!(e!=null&&e.shouldShowClearIntermediates)&&r.jsxs(Wi,{title:s("settings.clearIntermediates"),children:[r.jsx(de,{tooltip:l?s("settings.clearIntermediatesDisabled"):void 0,colorScheme:"warning",onClick:a,isLoading:d,isDisabled:!c||l,children:s("settings.clearIntermediatesWithCount",{count:c??0})}),r.jsx(q,{fontWeight:"bold",children:s("settings.clearIntermediatesDesc1")}),r.jsx(q,{variant:"subtext",children:s("settings.clearIntermediatesDesc2")}),r.jsx(q,{variant:"subtext",children:s("settings.clearIntermediatesDesc3")})]}),r.jsxs(Wi,{title:s("settings.resetWebUI"),children:[r.jsx(de,{colorScheme:"error",onClick:M,children:s("settings.resetWebUI")}),!!(e!=null&&e.shouldShowResetWebUiText)&&r.jsxs(r.Fragment,{children:[r.jsx(q,{variant:"subtext",children:s("settings.resetWebUIDesc1")}),r.jsx(q,{variant:"subtext",children:s("settings.resetWebUIDesc2")})]})]})]})})})}),r.jsx(xo,{})]})]})]})},n7e=u.memo(t7e),b3=({menuText:e,menuIcon:t})=>{const{t:n}=A();return r.jsx(Ee,{label:n("upsell.professionalUpsell"),placement:"right",gutter:16,children:r.jsx(pe,{as:"a",href:"http://invoke.com/pricing",target:"_blank",icon:t({}),children:r.jsxs(T,{gap:"1",alignItems:"center",justifyContent:"space-between",children:[r.jsx(q,{children:e}),r.jsx(lt,{as:FR,color:"invokeYellow.500"})]})})})},s7e=()=>{const{t:e}=A(),{isOpen:t,onOpen:n,onClose:s}=cr();Bp(s);const i=Bt("bugLink"),o=Bt("discordLink"),a=Bt("githubLink");return r.jsxs(en,{isOpen:t,onOpen:n,onClose:s,autoSelect:!1,children:[r.jsx(tn,{as:oe,variant:"link","aria-label":e("accessibility.menu"),icon:r.jsx(xd,{fontSize:20}),boxSize:8}),r.jsx(hc,{children:r.jsxs(Tt,{children:[r.jsxs(Sr,{title:e("upsell.professional"),children:[r.jsx(b3,{menuText:e("upsell.inviteTeammates"),menuIcon:zj}),r.jsx(b3,{menuText:e("upsell.shareAccess"),menuIcon:mhe})]}),r.jsxs(Sr,{title:e("common.communityLabel"),children:[a&&r.jsx(pe,{as:"a",href:NC,target:"_blank",icon:r.jsx(KRe,{}),children:e("common.githubLabel")}),i&&r.jsx(pe,{as:"a",href:`${NC}/issues`,target:"_blank",icon:r.jsx(Ede,{}),children:e("common.reportBugLabel")}),o&&r.jsx(pe,{as:"a",href:Sk,target:"_blank",icon:r.jsx(qRe,{}),children:e("common.discordLabel")})]}),r.jsxs(Sr,{title:e("common.settingsLabel"),children:[r.jsx(URe,{children:r.jsx(pe,{as:"button",icon:r.jsx(Ude,{}),children:e("common.hotkeysLabel")})}),r.jsx(n7e,{children:r.jsx(pe,{as:"button",icon:r.jsx(yhe,{}),children:e("common.settingsLabel")})})]}),r.jsx(Sr,{title:e("accessibility.about"),children:r.jsx(zRe,{children:r.jsx(pe,{as:"button",icon:r.jsx(bd,{}),children:e("accessibility.about")})})})]})})]})},r7e=u.memo(s7e),i7e=()=>{const e=ae(Yn),{t}=A();return e?null:r.jsx(Ee,{label:t("common.statusDisconnected"),placement:"end",shouldWrapChildren:!0,gutter:10,children:r.jsx(lt,{as:ug,color:"error.300"})})},o7e=u.memo(i7e),XZ=u.memo(()=>{const{t:e}=A(),t=G(),n=YO(),s=u.useCallback(()=>{t(K0e()),n.open()},[n,t]);return r.jsx(oe,{"aria-label":e("supportVideos.supportVideos"),variant:"link",icon:r.jsx(xhe,{fontSize:20}),boxSize:8,onClick:s})});XZ.displayName="VideosModalButton";const su=u.memo(({tab:e,children:t})=>{const n=u.useMemo(()=>fe(Pr,i=>!i.disabledTabs.includes(e)),[e]);return I(n)?t:null});su.displayName="TabMountGate";const a7e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAACXBIWXMAACxLAAAsSwGlPZapAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAANISURBVHgB7ZvBSxRRHMe/763rmolu1CEjcaWjB4WgyEuuEHRTQroGgtcyvLdud1O7Ch46RoHegqDyIhQE+w+EE0J2KBhNMl13Xu83pc6sovMcZ97gmw8s7Lx97PL77e/7e7/3ezMMdayKS/3CwSAghuRlAWcAwVgFQlQ4z5bb2XfL+xnbfbMsCvkc1ktw2BjOMpxNb6Gl3MUsmy5dB5DxjWLjPROiFwZAEbHNWorkBE4D9M+bYjxBtuawUXLfr4rLBeFUl2EgzGFFDqdagqHUuBjiAsyY0K9H6n+QfatdFDAYDsNJHQDDMd4BDVDkSuYnkoxM6krzUwnAcNIcgJCoau60CZuTUgnAcEJLYGlxJ9C8tjaG7t4MgrJiOVj56iBqQjtgeGAt0LzWPMPbz3l0FIIF3csXW5gs/0bUxCaBdVvg8cgGkkasOWBpsYo3C9tIEsoS6OvPKs13tWzV9q7HZBR8+nLBlcRRXO3kyr91EiJviJAD7lxfkxLYT2ijD5tQnjqPJBC5BCjpjT7K+cZmn/8JvHpETWwtsZvXbJ8UyDG0KhwnhaiJLQlOzflDnqRBkaCb2BzQdzsrpdDkG6N1nhyhk1iXwfEnzTL0/dWg7togVgeQ3svPmn1jVBvMzuiTgpZzgeGBddfwXVTL5NNEy25waq5FGr3/0zrLZC0OoH96vHTON6arTNZ6NFYvBR21gdaGCEnBCy2JcWyBvWh1wGFSiLtM1n46TAmQNkv1ZfJHuWOMA+09QdL7YWXy5NNNxEEimqKHlcmzM5uxlMnKEqDMrcr9Bzn3dRQkhRtyx+jtG5AUOjqDN1KJV+9aleYrd4S8y1ZQbgXo7JAUpqUURu792hv7102KNgoSdS5wd7DRlUOcJO5gpL5MjprQ5wJBNKeiY9L9a/mda3aw0D9JTvIS2gFRhGx3DzlMLfmdlPRwFIYTWgJJv2foOFIJwHDSHABFdN8TdNqkEoDhpA6A4ZADLJgKYxUu91wLMBRBT5NmHDYPQ+G8Vubt2R8fHAczMAyyuZ3ZlpsEqw21CTBRgSHQo7Ouzfi/CnQx295iTtGESCAbt9lOkWym6wOnkKsiXxC1zAQ468HZeZ7YkoYvZMDmSfLeD/4CAK41g1vx5woAAAAASUVORK5CYII=",l7e=fe(Pr,e=>e.isLocal),c7e={StrongComponent:r.jsx(q,{as:"span",color:"white",fontSize:"sm",fontWeight:"semibold"})},u7e=()=>{const{t:e}=A(),{data:t}=Uy(),n=I(l7e),s=u.useMemo(()=>{var o;return(o=t==null?void 0:t.highlights)!=null&&o.length?t.highlights.map((a,l)=>r.jsx(Rt,{children:a},`${a}-${l}`)):e("whatsNew.items",{returnObjects:!0}).map((a,l)=>r.jsx(Rt,{children:r.jsx(Ut,{i18nKey:a,components:c7e})},`${a}-${l}`))},[t==null?void 0:t.highlights,e]);return r.jsxs(T,{gap:4,flexDir:"column",children:[r.jsx(or,{fontSize:"sm",children:s}),r.jsxs(T,{flexDir:"column",gap:1,children:[r.jsx(sr,{fontSize:"sm",fontWeight:"semibold",label:e("whatsNew.readReleaseNotes"),href:n?`https://github.com/invoke-ai/InvokeAI/releases/tag/v${t==null?void 0:t.version}`:"https://support.invoke.ai/support/solutions/articles/151000178246"}),r.jsx(sr,{fontSize:"sm",fontWeight:"semibold",label:e("whatsNew.watchRecentReleaseVideos"),href:"https://www.youtube.com/@invokeai/videos"})]})]})},d7e=fe(Pr,e=>e.isLocal),h7e=()=>{const{t:e}=A(),t=ae(rD),n=G(),s=I(l=>l.ui.shouldShowNotificationV2),i=u.useCallback(()=>{n(gae(!1))},[n]),{data:o}=Uy(),a=I(d7e);return!o||!t?null:r.jsxs(rs,{onClose:i,placement:"top-start",autoFocus:!1,defaultIsOpen:s,children:[r.jsx(gs,{children:r.jsx(T,{pos:"relative",children:r.jsx(oe,{"aria-label":"Notifications",variant:"link",icon:r.jsx(qde,{fontSize:20}),boxSize:8})})}),r.jsxs(is,{p:2,children:[r.jsx(Li,{}),r.jsx(OM,{}),r.jsx(mae,{fontSize:"md",fontWeight:"semibold",pt:5,children:r.jsxs(T,{alignItems:"center",gap:3,children:[r.jsx(Wt,{src:a7e,boxSize:6}),e("whatsNew.whatsNewInInvoke"),!!o.version.length&&(a?r.jsx(q,{variant:"subtext",children:`v${o.version}`}):r.jsx(q,{variant:"subtext",children:o.version}))]})}),r.jsx(ms,{p:2,maxW:300,children:r.jsx(u7e,{})})]})]})},ru=u.memo(u.forwardRef(({tab:e,icon:t,label:n},s)=>{const i=G(),o=I(An),a=u.useCallback(()=>{i(Qt(e))},[i,e]);return r.jsx(Ee,{label:n,placement:"end",children:r.jsx(oe,{ref:s,p:0,onClick:a,icon:t,size:"md",fontSize:"24px",variant:"appTab","data-selected":o===e,"aria-label":n,"data-testid":n})})}));ru.displayName="TabButton";const QZ=u.memo(()=>{const{t:e}=A(),t=ae(yae);return r.jsxs(T,{flexDir:"column",alignItems:"center",py:2,gap:4,minW:0,children:[r.jsx(BRe,{}),r.jsxs(T,{gap:4,pt:6,h:"full",flexDir:"column",children:[r.jsx(su,{tab:"canvas",children:r.jsx(ru,{tab:"canvas",icon:r.jsx(rl,{}),label:e("ui.tabs.canvas")})}),r.jsx(su,{tab:"upscaling",children:r.jsx(ru,{tab:"upscaling",icon:r.jsx(ag,{}),label:e("ui.tabs.upscaling")})}),r.jsx(su,{tab:"workflows",children:r.jsx(ru,{tab:"workflows",icon:r.jsx(lb,{}),label:e("ui.tabs.workflows")})}),r.jsx(su,{tab:"models",children:r.jsx(ru,{tab:"models",icon:r.jsx(Dde,{}),label:e("ui.tabs.models")})}),r.jsx(su,{tab:"queue",children:r.jsx(ru,{tab:"queue",icon:r.jsx(e7,{}),label:e("ui.tabs.queue")})})]}),r.jsx(it,{}),r.jsx(o7e,{}),r.jsx(h7e,{}),r.jsx(XZ,{}),t||r.jsx(r7e,{})]})});QZ.displayName="VerticalNavBar";const x3=0,JZ=-10,eY=10,f7e=-10,p7e=10,v3=1,C3=1,g7e=[JZ,0,eY],m7e=()=>{const e=I(bae),t=G(),{t:n}=A(),s=u.useCallback(i=>{t(xae(i))},[t]);return r.jsxs(K,{children:[r.jsx(ze,{feature:"creativity",children:r.jsx(J,{children:n("upscaling.creativity")})}),r.jsx(Ze,{value:e,defaultValue:x3,min:JZ,max:eY,step:v3,fineStep:C3,onChange:s,marks:g7e}),r.jsx(Ie,{value:e,defaultValue:x3,min:f7e,max:p7e,step:v3,fineStep:C3,onChange:s})]})},y7e=u.memo(m7e),b7e=()=>{const{t:e}=A(),[t,{isLoading:n}]=fg(),s=I(iD),i=G(),o=u.useMemo(()=>{var p;if(!(!t.length||!s))return(p=t.find(g=>g.key===(s==null?void 0:s.key)))==null?void 0:p.description},[t,s]),a=u.useCallback(p=>{i(vae(p))},[i]),{options:l,value:c,onChange:d,placeholder:h,noOptionsMessage:f}=ll({modelConfigs:t,onChange:a,selectedModel:s,isLoading:n});return r.jsxs(K,{orientation:"vertical",children:[r.jsx(ze,{feature:"upscaleModel",children:r.jsx(J,{children:e("upscaling.upscaleModel")})}),r.jsx(Ee,{label:o,children:r.jsx(Se,{w:"full",children:r.jsx(Ne,{value:c,placeholder:h,options:l,onChange:d,noOptionsMessage:f,isDisabled:l.length===0})})})]})},x7e=u.memo(b7e),w3=0,tY=-10,nY=10,v7e=-10,C7e=10,S3=1,j3=1,w7e=[tY,0,nY],S7e=()=>{const e=I(Cae),t=G(),{t:n}=A(),s=u.useCallback(i=>{t(wae(i))},[t]);return r.jsxs(K,{children:[r.jsx(ze,{feature:"structure",children:r.jsx(J,{children:n("upscaling.structure")})}),r.jsx(Ze,{value:e,defaultValue:w3,min:tY,max:nY,step:S3,fineStep:j3,onChange:s,marks:w7e}),r.jsx(Ie,{value:e,defaultValue:w3,min:v7e,max:C7e,step:S3,fineStep:j3,onChange:s})]})},j7e=u.memo(S7e),k7e=[2,4,8],k3=e=>`${e}x`,sY=u.memo(()=>{const e=G(),{t}=A(),n=I(Sae),s=u.useCallback(i=>{e(jae(i))},[e]);return r.jsxs(K,{orientation:"vertical",gap:0,children:[r.jsx(ze,{feature:"scale",children:r.jsx(J,{m:0,children:t("upscaling.scale")})}),r.jsxs(T,{w:"full",gap:4,children:[r.jsx(Ze,{min:2,max:8,value:n,onChange:s,marks:k7e,formatValue:k3,defaultValue:4}),r.jsx(Ie,{maxW:20,value:n,onChange:s,defaultValue:4,min:2,max:16,format:k3})]})]})});sY.displayName="UpscaleScaleSlider";const _7e=()=>{const e=G(),t=I(oD),n=u.useMemo(()=>ew.getData(),[]),s=u.useCallback(()=>{e(N0(null))},[e]),i=u.useCallback(o=>{e(N0(o))},[e]);return r.jsx(T,{justifyContent:"flex-start",children:r.jsxs(T,{position:"relative",w:36,h:36,alignItems:"center",justifyContent:"center",children:[!t&&r.jsx(F_,{w:"full",h:"full",isError:!t,onUpload:i,fontSize:36}),t&&r.jsxs(r.Fragment,{children:[r.jsx(ul,{imageDTO:t}),r.jsx(T,{position:"absolute",flexDir:"column",top:1,insetInlineEnd:1,gap:1,children:r.jsx(ea,{onClick:s,icon:r.jsx(ur,{size:16}),tooltip:Pe("common.reset")})}),r.jsx(q,{position:"absolute",background:"base.900",color:"base.50",fontSize:"sm",fontWeight:"semibold",bottom:0,left:0,opacity:.7,px:2,lineHeight:1.25,borderTopEndRadius:"base",borderBottomStartRadius:"base",pointerEvents:"none",children:`${t.width}x${t.height}`})]}),r.jsx(Is,{dndTarget:ew,dndTargetData:n,label:Pe("gallery.drop")})]})})},I7e=e=>hn(_p,Pr,(t,n)=>{const{upscaleModel:s,scale:i}=t,{maxUpscaleDimension:o}=n;if(!o||!s||!e)return!1;const{width:a,height:l}=e,c=o**2;return a*i*l*i>c}),T7e=e=>{const t=u.useMemo(()=>I7e(e),[e]);return I(t)},A7e=()=>{const{t:e}=A(),t=I(Ny),n=I(iD),s=I(kae),i=I(oD),o=G(),[a,{isLoading:l}]=Qj(),c=I(WS),d=I(_ae),h=T7e(i);u.useEffect(()=>{const b=a.find(C=>C.base===(t==null?void 0:t.base)&&C.name.toLowerCase().includes("tile"));o(Iae(b||null))},[t==null?void 0:t.base,a,o]);const f=u.useMemo(()=>t&&["sd-1","sdxl"].includes(t.base),[t]),p=u.useMemo(()=>{const b=[];return f&&(t||b.push(e("upscaling.mainModelDesc")),s||b.push(e("upscaling.tileControlNetModelDesc")),n||b.push(e("upscaling.upscaleModelDesc"))),b},[f,t,s,n,e]),g=u.useMemo(()=>{const b=[];return h&&d&&b.push(e("upscaling.exceedsMaxSizeDetails",{maxUpscaleDimension:d.toLocaleString()})),b},[h,e,d]),m=u.useMemo(()=>[...p,...g],[p,g]),y=u.useCallback(()=>{o(Qt("models")),ql.set(3)},[o]);return f&&p.length>0&&c||f&&m.length===0||l?null:r.jsxs(T,{bg:"error.500",borderRadius:"base",padding:4,direction:"column",fontSize:"sm",gap:2,children:[!f&&r.jsx(q,{children:e("upscaling.incompatibleBaseModelDesc")}),p.length>0&&r.jsx(q,{children:r.jsx(Ut,{i18nKey:"upscaling.missingModelsWarning",components:{LinkComponent:r.jsx(de,{size:"sm",flexGrow:0,variant:"link",color:"base.50",onClick:y})}})}),m.length>0&&r.jsx(or,{children:m.map(b=>r.jsx(Rt,{children:b},b))})]})},E7e=hn([_p],e=>{const{upscaleModel:t,upscaleInitialImage:n,scale:s}=e,i=[];if(t&&i.push(t.name),n){const o=t?L0(t.base):L0(null),a=Fu(n.width*s,o),l=Fu(n.height*s,o);i.push(`${a}${l}`)}return{badges:i}}),rY=u.memo(()=>{const{t:e}=A(),{badges:t}=I(E7e),{isOpen:n,onToggle:s}=Ud({id:"upscale-settings",defaultIsOpen:!0}),{isOpen:i,onToggle:o}=x4({id:"upscale-settings-advanced",defaultIsOpen:!1});return r.jsx(ud,{label:e("upscaling.upscale"),badges:t,isOpen:n,onToggle:s,children:r.jsxs(T,{pt:4,px:4,w:"full",h:"full",flexDir:"column","data-testid":"upscale-settings-accordion",children:[r.jsxs(T,{flexDir:"column",gap:4,children:[r.jsxs(T,{gap:4,children:[r.jsx(_7e,{}),r.jsxs(T,{direction:"column",w:"full",alignItems:"center",gap:2,minW:0,children:[r.jsx(x7e,{}),r.jsx(sY,{})]})]}),r.jsx(A7e,{})]}),r.jsx(nj,{label:e("accordions.advanced.options"),isOpen:i,onToggle:o,children:r.jsxs(T,{gap:4,pb:4,flexDir:"column",children:[r.jsx(y7e,{}),r.jsx(j7e,{})]})})]})})});rY.displayName="UpscaleSettingsAccordion";const _3={height:"100%",width:"100%"},M7e=()=>{const e=ae(Uf);return r.jsxs(T,{w:"full",h:"full",flexDir:"column",gap:2,children:[r.jsx(mq,{}),r.jsx(T,{w:"full",h:"full",position:"relative",children:r.jsxs(Se,{position:"absolute",top:0,left:0,right:0,bottom:0,children:[e&&r.jsx(ps,{defer:!0,style:_3,options:Ul.options,children:r.jsx(T,{gap:2,flexDirection:"column",h:"full",w:"full",children:r.jsx(gq,{})})}),r.jsx(ps,{defer:!0,style:_3,options:Ul.options,children:r.jsxs(T,{gap:2,flexDirection:"column",h:"full",w:"full",children:[r.jsx(p4,{}),r.jsx(rY,{}),r.jsx(v4,{}),r.jsx(b4,{})]})})]})})]})},P7e=u.memo(M7e),n0={position:"relative",height:"100%",width:"100%",minWidth:0},L7e=e=>W2.set(!e),D7e=e=>Eae.set(!e),iY=u.memo(()=>{const e=u.useRef(null);$_e();const t=I(Tae),n=u.useMemo(()=>({id:"left-panel",minSizePx:WI,defaultSizePx:WI,imperativePanelGroupRef:e,panelGroupDirection:"horizontal",onCollapse:L7e}),[]),s=vw(n);Re({id:"toggleLeftPanel",category:"app",callback:s.toggle,options:{enabled:t},dependencies:[s.toggle,t]});const i=I(Aae),o=u.useMemo(()=>({id:"right-panel",minSizePx:UI,defaultSizePx:UI,imperativePanelGroupRef:e,panelGroupDirection:"horizontal",onCollapse:D7e}),[]),a=vw(o);return Re({id:"toggleRightPanel",category:"app",callback:a.toggle,options:{enabled:i},dependencies:[a.toggle,i]}),Re({id:"resetPanelLayout",category:"app",callback:()=>{s.reset(),a.reset()},dependencies:[s.reset,a.reset]}),Re({id:"togglePanels",category:"app",callback:()=>{s.isCollapsed||a.isCollapsed?(s.expand(),a.expand()):(s.collapse(),a.collapse())},dependencies:[s.isCollapsed,a.isCollapsed,s.expand,a.expand,s.collapse,a.collapse]}),r.jsxs(T,{id:"invoke-app-tabs",w:"full",h:"full",gap:4,p:4,overflow:"hidden",children:[r.jsx(QZ,{}),r.jsxs(Eg,{ref:e,id:"app-panel-group",autoSaveId:"app-panel-group",direction:"horizontal",style:n0,children:[t&&r.jsxs(r.Fragment,{children:[r.jsx(ao,{order:0,collapsible:!0,style:n0,...s.panelProps,children:r.jsxs(T,{flexDir:"column",w:"full",h:"full",gap:2,children:[r.jsx(O6e,{}),r.jsx(Se,{position:"relative",w:"full",h:"full",children:r.jsx(aY,{})})]})}),r.jsx(M1,{id:"left-main-handle",...s.resizeHandleProps})]}),r.jsxs(ao,{id:"main-panel",order:1,minSize:20,style:n0,children:[r.jsx(lY,{}),t&&r.jsx(V6e,{togglePanel:s.toggle}),i&&r.jsx(F6e,{panelApi:a})]}),i&&r.jsxs(r.Fragment,{children:[r.jsx(M1,{id:"main-right-handle",...a.resizeHandleProps}),r.jsx(ao,{order:2,style:n0,collapsible:!0,...a.panelProps,children:r.jsx(oY,{})})]})]})]})});iY.displayName="AppContent";const oY=u.memo(()=>{const e=I(An);return e==="canvas"?r.jsx(GG,{}):e==="upscaling"||e==="workflows"?r.jsx(zG,{}):null});oY.displayName="RightPanelContent";const aY=u.memo(()=>{const e=I(An);return e==="canvas"?r.jsx(tEe,{}):e==="upscaling"?r.jsx(P7e,{}):e==="workflows"?r.jsx(M6e,{}):null});aY.displayName="LeftPanelContent";const lY=u.memo(()=>{const e=I(An);return e==="canvas"?r.jsx(wz,{}):e==="upscaling"?r.jsx(Wb,{}):e==="workflows"?r.jsx(WZ,{}):e==="models"?r.jsx(GEe,{}):e==="queue"?r.jsx(aMe,{}):null});lY.displayName="MainPanelContent";const R7e=u.createContext(null),_2={didCatch:!1,error:null};class O7e extends u.Component{constructor(t){super(t),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=_2}static getDerivedStateFromError(t){return{didCatch:!0,error:t}}resetErrorBoundary(){const{error:t}=this.state;if(t!==null){for(var n,s,i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];(n=(s=this.props).onReset)===null||n===void 0||n.call(s,{args:o,reason:"imperative-api"}),this.setState(_2)}}componentDidCatch(t,n){var s,i;(s=(i=this.props).onError)===null||s===void 0||s.call(i,t,n)}componentDidUpdate(t,n){const{didCatch:s}=this.state,{resetKeys:i}=this.props;if(s&&n.error!==null&&N7e(t.resetKeys,i)){var o,a;(o=(a=this.props).onReset)===null||o===void 0||o.call(a,{next:i,prev:t.resetKeys,reason:"keys"}),this.setState(_2)}}render(){const{children:t,fallbackRender:n,FallbackComponent:s,fallback:i}=this.props,{didCatch:o,error:a}=this.state;let l=t;if(o){const c={error:a,resetErrorBoundary:this.resetErrorBoundary};if(typeof n=="function")l=n(c);else if(s)l=u.createElement(s,c);else if(i===null||u.isValidElement(i))l=i;else throw a}return u.createElement(R7e.Provider,{value:{didCatch:o,error:a,resetErrorBoundary:this.resetErrorBoundary}},l)}}function N7e(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return e.length!==t.length||e.some((n,s)=>!Object.is(n,t[s]))}function F7e(e={}){let t;if(e.repoUrl)t=e.repoUrl;else if(e.user&&e.repo)t=`https://github.com/${e.user}/${e.repo}`;else throw new Error("You need to specify either the `repoUrl` option or both the `user` and `repo` options");const n=new URL(`${t}/issues/new`),s=["body","title","labels","template","milestone","assignee","projects"];for(const i of s){let o=e[i];if(o!==void 0){if(i==="labels"||i==="projects"){if(!Array.isArray(o))throw new TypeError(`The \`${i}\` option should be an array`);o=o.join(",")}n.searchParams.set(i,o)}}return n.toString()}const B7e=fe(Pr,e=>e.isLocal),$7e=({error:e,resetErrorBoundary:t})=>{const{t:n}=A(),s=I(B7e),i=il(),o=u.useCallback(()=>{const l=JSON.stringify(Un(e),null,2);i.writeText(`\`\`\`
${l}
\`\`\``,()=>{ge({id:"ERROR_COPIED",title:n("toast.errorCopied")})})},[i,e,n]),a=u.useMemo(()=>s?F7e({user:"invoke-ai",repo:"InvokeAI",template:"BUG_REPORT.yml",title:`[bug]: ${e.name}: ${e.message}`}):"https://support.invoke.ai/support/tickets/new",[e.message,e.name,s]);return r.jsx(T,{layerStyle:"body",w:"100dvw",h:"100dvh",alignItems:"center",justifyContent:"center",p:4,children:r.jsxs(T,{layerStyle:"first",flexDir:"column",borderRadius:"base",justifyContent:"center",gap:8,p:16,children:[r.jsxs(T,{alignItems:"center",gap:"2",children:[r.jsx(Wt,{src:UZ,alt:"invoke-logo",w:"24px",h:"24px",minW:"24px",minH:"24px",userSelect:"none"}),r.jsx(Ft,{fontSize:"2xl",children:n("common.somethingWentWrong")})]}),r.jsx(T,{layerStyle:"second",px:8,py:4,gap:4,borderRadius:"base",justifyContent:"space-between",alignItems:"center",children:r.jsxs(q,{fontWeight:"semibold",color:"error.400",children:[e.name,": ",e.message]})}),r.jsxs(T,{gap:4,children:[r.jsx(de,{leftIcon:r.jsx(ur,{}),onClick:t,children:n("accessibility.resetUI")}),r.jsx(de,{leftIcon:r.jsx(un,{}),onClick:o,children:n("common.copyError")}),r.jsx(by,{href:a,isExternal:!0,children:r.jsx(de,{leftIcon:r.jsx(ib,{}),children:n(s?"accessibility.createIssue":"accessibility.submitSupportTicket")})})]})]})})},V7e=u.memo($7e),z7e={},G7e=({config:e=z7e,studioInitAction:t})=>{const n=ae(rD),s=rN(),i=u.useCallback(()=>(s(),location.reload(),!1),[s]);return r.jsxs(O7e,{onReset:i,FallbackComponent:V7e,children:[r.jsxs(Se,{id:"invoke-app-wrapper",w:"100dvw",h:"100dvh",position:"relative",overflow:"hidden",children:[r.jsx(iY,{}),!n&&r.jsx(Mae,{})]}),r.jsx(f9,{config:e,studioInitAction:t}),r.jsx(sN,{})]})},j9e=u.memo(G7e);export{j9e as default};
